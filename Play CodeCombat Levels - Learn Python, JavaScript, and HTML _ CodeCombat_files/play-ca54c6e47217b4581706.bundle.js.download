(window.webpackJsonp=window.webpackJsonp||[]).push([[112],{119:function(e,t,i){var n,o;function s(e,t,i,n,o){this.x=null!=e?e:0,this.y=null!=t?t:0,this.width=null!=i?i:0,this.height=null!=n?n:0,this.rotation=null!=o?o:0}o=i(47),i(82),n=i(94),s.className="Ellipse",s.prototype.isEllipse=!0,s.prototype.apiProperties=["x","y","width","height","rotation","distanceToPoint","distanceSquaredToPoint","distanceToRectangle","distanceSquaredToRectangle","distanceToEllipse","distanceSquaredToEllipse","distanceToShape","distanceSquaredToShape","containsPoint","intersectsLineSegment","intersectsRectangle","intersectsEllipse","getPos","containsPoint","copy"],s.prototype.copy=function(){return new s(this.x,this.y,this.width,this.height,this.rotation)},s.prototype.getPos=function(){return new o(this.x,this.y)},s.prototype.rectangle=function(){return new n(this.x,this.y,this.width,this.height,this.rotation)},s.prototype.axisAlignedBoundingBox=function(e){return null==e&&(e=!0),this.rectangle().axisAlignedBoundingBox()},s.prototype.distanceToPoint=function(e){return this.rectangle().distanceToPoint(e)},s.prototype.distanceSquaredToPoint=function(e){return this.rectangle().distanceSquaredToPoint(e)},s.prototype.distanceToRectangle=function(e){return Math.sqrt(this.distanceSquaredToRectangle(e))},s.prototype.distanceSquaredToRectangle=function(e){return this.rectangle().distanceSquaredToRectangle(e)},s.prototype.distanceToEllipse=function(e){return Math.sqrt(this.distanceSquaredToEllipse(e))},s.prototype.distanceSquaredToEllipse=function(e){return this.rectangle().distanceSquaredToEllipse(e)},s.prototype.distanceToShape=function(e){return Math.sqrt(this.distanceSquaredToShape(e))},s.prototype.distanceSquaredToShape=function(e){return e.isEllipse?this.distanceSquaredToEllipse(e):this.distanceSquaredToRectangle(e)},s.prototype.containsPoint=function(e,t){var i,n=(i=[e.x-this.x,e.y-this.y])[0],e=i[1];return(t=null==t?!0:t)&&this.rotation&&(n=(t=[n*(i=Math.cos(this.rotation))+e*(t=Math.sin(this.rotation)),e*i-n*t])[0],e=t[1]),(n=n/this.width*2)*n+(e=e/this.height*2)*e<=1},s.prototype.intersectsLineSegment=function(e,t){var i,n,o,s,r,a,l,c,h,u=[e.x,e.y,t.x,t.y],p=u[0],d=u[1],m=u[2],f=u[3],g=(d-f)/(p-m),y=Math.pow(g,2),v=d-g*p,b=Math.pow(v,2),_=[this.width/2,this.height/2],w=_[0],k=_[1],x=[this.x,this.y],S=x[0],C=x[1],T=Math.pow(w,2),e=Math.pow(w,2),t=Math.pow(k,2),u=Math.pow(k,4),_=Math.pow(S,2),x=Math.pow(C,2),w=(Math.sin(this.rotation),Math.sin(2*this.rotation)),k=(Math.cos(this.rotation),Math.cos(2*this.rotation));if(isNaN(g)||g==1/0||g==-1/0){if(c=p,h=Math.pow(c,2),l=((o=-T*S*w+T*C*k+T*C+T*c*w)-(s=Math.SQRT2*Math.sqrt(e*t*k+e*t-T*u*k+T*u-2*T*t*_+4*T*t*S*c-2*T*t*h))+(r=t*S*w-t*C*k+t*C-t*c*w))/(n=T*k+T-t*k+t),h=(o+s+r)/n,isNaN(l)&&isNaN(h))return!1;if(c=isNaN(l)?h:l,(d=d<f?[d,f]:[f,d])[0]<=c&&c<=d[1])return!0}else{if(l=(-(o=-T*v*g*k-T*v*g+T*v*w-T*S*g*w-T*S*k+T*S+T*C*g*k+T*C*g-T*C*w)-(s=Math.SQRT2*Math.sqrt(e*t*y*k+e*t*y-2*e*t*g*w-e*t*k+e*t-T*u*y*k+T*u*y+2*T*u*g*w+T*u*k+T*u-2*T*t*b-4*T*t*v*S*g+4*T*t*v*C-2*T*t*_*y+4*T*t*S*C*g-2*T*t*x))+(r=t*v*g*k-t*v*g-t*v*w+t*S*g*w+t*S*k+t*S-t*C*g*k+t*C*g+t*C*w))/(n=T*y*k+T*y-2*T*g*w-T*k+T-t*y*k+t*y+2*t*g*w+t*k+t),h=(-o+s+r)/n,!isNaN(l)&&!isNaN(h)&&(i=(a=p<m?[p,m]:[m,p])[1],(a=a[0])<=l&&l<=i||a<=h&&h<=i))return!0;if(isNaN(l)&&isNaN(h))return!1;if(c=isNaN(l)?h:l,i=(p=p<m?[p,m]:[m,p])[1],(a=p[0])<=c&&c<=i)return!0}return!1},s.prototype.intersectsRectangle=function(e){return e.intersectsEllipse(this)},s.prototype.intersectsEllipse=function(e){return this.rectangle().intersectsEllipse(e)},s.prototype.intersectsShape=function(e){return e.isEllipse?this.intersectsEllipse(e):this.intersectsRectangle(e)},s.prototype.toString=function(){return"{x: "+this.x.toFixed(0)+", y: "+this.y.toFixed(0)+", w: "+this.width.toFixed(0)+", h: "+this.height.toFixed(0)+", rot: "+this.rotation.toFixed(3)+"}"},s.prototype.serialize=function(){return{CN:this.constructor.className,x:this.x,y:this.y,w:this.width,h:this.height,r:this.rotation}},s.deserialize=function(e,t,i){return new s(e.x,e.y,e.w,e.h,e.r)},s.prototype.serializeForAether=function(){return this.serialize()},s.deserializeFromAether=function(e){return this.deserialize(e)},e.exports=s},120:function(e,t){function i(e,t){return function(){return e.apply(t,arguments)}}function n(e){var t;this.seed=e,this.choice=i(this.choice,this),this.shuffleCompat=i(this.shuffleCompat,this),this.shuffle=i(this.shuffle,this),this.randfRange=i(this.randfRange,this),this.randf2=i(this.randf2,this),this.rand2=i(this.rand2,this),this.rand=i(this.rand,this),this.randf=i(this.randf,this),this.randn=i(this.randn,this),this.multiplier=1664525,this.modulo=4294967296,this.offset=1013904223,null!=this.seed&&0<=(t=this.seed)&&t<this.modulo||(this.seed=(new Date).valueOf()*(new Date).getMilliseconds()%this.modulo)}n.className="Rand",n.prototype.setSeed=function(e){return this.seed=(e%this.modulo+this.modulo)%this.modulo},n.prototype.randn=function(){return this.seed=(this.multiplier*this.seed+this.offset)%this.modulo},n.prototype.randf=function(){return this.randn()/this.modulo},n.prototype.rand=function(e){return Math.floor(this.randf()*e)},n.prototype.rand2=function(e,t){return e+this.rand(t-e)},n.prototype.randf2=function(e,t){return e+this.randf()*(t-e)},n.prototype.randfRange=function(e,t){return e+(-.5+this.randf())*t},n.prototype.shuffle=function(e){var t,i,n,o,s;if(!(2<e.length))return e;for(t=n=o=e.length-1;o<=1?n<=1:1<=n;t=o<=1?++n:--n)s=e[i=Math.floor(this.randf()*(t+1))],e[i]=e[t],e[t]=s;return e},n.prototype.shuffleCompat=function(e){for(var t,i,n=-1,o=e.length||0,s=new Array(o),r=0,a=e.length;r<a;r++)t=e[r],i=this.rand(++n+1),s[n]=s[i],s[i]=t;return s},n.prototype.choice=function(e){return e[this.rand(e.length)]},e.exports=n},1225:function(te,e,ie){!function(w,k){function e(e,t){for(var i in t)Y.call(t,i)&&(e[i]=t[i]);function n(){this.constructor=e}return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e}var t,i,n,o,s,r,h,u,p,d,a,l,m,g,c,f,y,v,b,x,S,C,T,L,M,D,I,A,R,P,E,B,F,N,U,V,O,G,z,H,W,q,j,$,J,Y={}.hasOwnProperty,K=function(e,t){return function(){return e.apply(t,arguments)}},X=[].indexOf||function(e){for(var t=0,i=this.length;t<i;t++)if(t in this&&this[t]===e)return t;return-1};function Z(e){Z.__super__.constructor.call(this),this.url="/db/user/"+me.id+"/level.sessions?project=state.complete,levelID,state.difficulty,playtime,state.topScores,codeLanguage,level"}function Q(){return Q.__super__.constructor.apply(this,arguments)}function ee(e,t){var i,n,o,s,r,a,f,l,c;if(this.terrain=t,this.onWindowResize=K(this.onWindowResize,this),this.onMouseMovePortals=K(this.onMouseMovePortals,this),ee.__super__.constructor.call(this,e),/^classCode/.test(this.terrain)&&(this.terrain=""),window.serverConfig.picoCTF&&(this.terrain="picoctf"),this.editorMode=null!=e?e.editorMode:void 0,this.requiresSubscription=!me.isPremium(),this.editorMode&&null==this.terrain&&(this.terrain="dungeon"),this.levelStatusMap={},this.levelPlayCountMap={},this.levelDifficultyMap={},this.levelScoreMap={},"hoc-2018"===this.terrain&&w("body").append(w("<img src='https://code.org/api/hour/begin_codecombat_play.png' style='visibility: hidden;'>")),J.getQueryVariable("hour_of_code")){if((me.isStudent()||me.isTeacher())&&"dungeon"===this.terrain)return void z.users.getCourseInstances({userID:me.id,campaignSlug:"intro"},{data:{project:"_id"}}).then(function(e){return e.length?(e=_.first(e)._id,k.router.navigate("/play/intro?course-instance="+e,{trigger:!0,replace:!0})):(k.router.navigate(me.isStudent()?"/students":"/teachers",{trigger:!0,replace:!0}),noty({text:"Please create or join a classroom first",layout:"topCenter",timeout:8e3,type:"success"}))});"game-dev-hoc"===this.terrain&&null!=(o=window.tracker)&&o.trackEvent("Start HoC Campaign",{label:"game-dev-hoc"}),me.set("hourOfCode",!0),me.patch(),o=function(){switch(this.terrain){case"game-dev-hoc":return"code_combat_gamedev";case"game-dev-hoc-2":return"code_combat_build_arcade";case"ai-league-hoc":return"cc_ai";default:return"code_combat"}}.call(this),w("body").append(w("<img src='https://code.org/api/hour/begin_"+o+".png' style='visibility: hidden;'>"))}else{if(me.isTeacher()&&!J.getQueryVariable("course-instance")&&!k.getHocCampaign()&&"hoc-2018"===!this.terrain)return void k.router.navigate("/teachers",{trigger:!0,replace:!0});"/paypal/subscribe-callback"===location.pathname&&(this.payPalToken=J.getQueryVariable("token"),z.users.executeBillingAgreement({userID:me.id,token:this.payPalToken}).then((r=this,function(e){var t,i,n=Math.round(100*parseFloat(null!=(i=null!=e&&null!=(t=e.plan)&&null!=(i=t.payment_definitions)&&null!=(n=i[0].amount)?n.value:void 0)?i:0));return null!=(i=k.tracker)&&i.trackEvent("Finished subscription purchase",{value:n,service:"paypal"}),noty({text:w.i18n.t("subscribe.confirmation"),layout:"topCenter",timeout:8e3}),me.fetch({cache:!1,success:function(){return"function"==typeof r.render?r.render():void 0}})})).catch(function(e){return console.error(e)}))}if(window.serverConfig.picoCTF)this.supermodel.addRequestResource({url:"/picoctf/problems",success:(a=this,function(e){a.picoCTFProblems=e})}).load();else if(this.editorMode||(this.sessions=this.supermodel.loadCollection(new C,"your_sessions",{cache:!1},1).model,this.listenToOnce(this.sessions,"sync",this.onSessionsLoaded)),!this.terrain)return this.campaigns=this.supermodel.loadCollection(new u,"campaigns",null,1).model,void this.listenToOnce(this.campaigns,"sync",this.onCampaignsLoaded);this.campaign=new h({_id:this.terrain}),this.campaign=this.supermodel.loadModel(this.campaign).model,this.earnedAchievements=new d([],{url:"/db/earned_achievement",model:y,project:["earnedRewards"]}),this.listenToOnce(this.earnedAchievements,"sync",function(){for(var e,t,i,n,o,s,r,a,l,c,h=me.get("earned"),u=!1,p=this.earnedAchievements.models,d=0,m=p.length;d<m;d++)if(n=p[d].get("earnedRewards"))for(o=0,t=(r=["heroes","levels","items"]).length;o<t;o++)if(n[e=r[o]])for(s=0,i=(a=n[e]).length;s<i;s++)c=a[s],X.call(h[e],c)<0&&(console.warn("Filling in a gap for reward",e,c),h[e].push(c),u=!0);if(u)return null!=(l=window.tracker)?l.trackEvent("Fixed Missing Achievement Reward",{category:"World Map",label:this.terrain}):void 0}),this.supermodel.loadCollection(this.earnedAchievements,"achievements",{cache:!1}),null!=J.getQueryVariable("course-instance")&&(this.courseLevelsFake={},this.courseInstanceID=J.getQueryVariable("course-instance"),this.courseInstance=new g({_id:this.courseInstanceID}),s=this.courseInstance.fetch(),this.supermodel.trackRequest(s),new Promise(s.then).then((f=this,function(){var e,t=f.courseInstance.get("courseID");if(f.course=new m({_id:t}),f.supermodel.trackRequest(f.course.fetch()),f.courseInstance.get("classroomID"))return e=f.courseInstance.get("classroomID"),f.classroom=new p({_id:e}),f.supermodel.trackRequest(f.classroom.fetch()),f.listenToOnce(f.classroom,"sync",function(){return f.updateClassroomSessions(),f.render(),f.courseInstance.sessions=new d([],{url:f.courseInstance.url()+"/course-level-sessions/"+me.id,model:S}),f.supermodel.loadCollection(f.courseInstance.sessions,{data:{project:"state.complete,level.original,playtime,changed,state.topScores"}}),f.courseInstance.sessions.comparator="changed",f.listenToOnce(f.courseInstance.sessions,"sync",function(){return f.courseStats=f.classroom.statsForSessions(f.courseInstance.sessions,f.course.id),f.render()}),f.courseLevels=new L,f.supermodel.trackRequest(f.courseLevels.fetchForClassroomAndCourse(e,t,{data:{project:"concepts,practice,assessment,primerLanguage,type,slug,name,original,description,shareable,i18n"}})),f.listenToOnce(f.courseLevels,"sync",function(){for(var e,t,i,n,o,s,r,a,l,c=f.campaign.get("levels"),h=f.courseLevels.toArray(),u={},p=_.find(W.currentView.classroom.get("courses"),{_id:W.currentView.course.id}).levels,d=0,m=p.length;d<m;d++)(i=p[d]).position&&(u[i.original]=i.position);for(t in h)c[e=(a=h[t]).get("original")]?(f.courseLevelsFake[e]=c[e],u[e]&&(f.courseLevelsFake[e].position=u[e])):f.courseLevelsFake[e]=a.toJSON(),f.courseLevelsFake[e].courseIdx=parseInt(t),f.courseLevelsFake[e].requiresSubscription=!1;for(t in h)a=h[t],t=parseInt(t),e=a.get("original"),f.courseLevelsFake[e].position||(s=h[t-1],n=h[t+1],s&&n&&(o=s.get("original"),l=n.get("original"),r=f.courseLevelsFake[o].position,o=f.courseLevelsFake[l].position),r&&o?f.courseLevelsFake[e].position={x:(r.x+o.x)/2,y:(r.y+o.y)/2}:(l=10+t/h.length*80,f.courseLevelsFake[e].position={x:l,y:10}));return f.render()})})}))),this.listenToOnce(this.campaign,"sync",this.getLevelPlayCounts),w(window).on("resize",this.onWindowResize),this.probablyCachedMusic=j.load("loaded-menu-music"),n=this.probablyCachedMusic?1e3:1e4,i=function(){return _.delay(function(){if(!l.destroyed)return l.playMusic()},n)},(l=this).playMusicTimeout=i(),this.hadEverChosenHero=null!=(s=me.get("heroConfig"))?s.thangType:void 0,this.listenTo(me,"change:purchased",function(){return this.renderSelectors("#gems-count")}),this.listenTo(me,"change:spent",function(){return this.renderSelectors("#gems-count")}),this.listenTo(me,"change:earned",function(){return this.renderSelectors("#gems-count")}),this.listenTo(me,"change:heroConfig",function(){return this.updateHero()}),!J.getQueryVariable("hour_of_code")&&"hoc-2018"!==this.terrain||sessionStorage.getItem(this.terrain)||(sessionStorage.setItem(this.terrain,"seen-modal"),clearTimeout(this.playMusicTimeout),setTimeout((c=this,function(){return c.openModalView(new v({activity:"hoc-2018"===c.terrain?"teacher-gd":"ai-league",showVideo:"hoc-2018"===c.terrain,onDestroy:function(){if(!c.destroyed)return i(),c.highlightElement(".level.next",{delay:500,duration:6e4,rotation:0,sides:["top"]})}}))}),0)),null!=(s=window.tracker)&&s.trackEvent("Loaded World Map",{category:"World Map",label:this.terrain})}ie(1606),N=ie(618),$=ie(1608),S=ie(1375),y=ie(624),d=ie(115),t=ie(1521),h=ie(1378),s=ie(1390),T=ie(1488),O=ie(1374),I=ie(1479),j=ie(32),f=ie(118),V=ie(622),b=ie(1627),x=ie(267),J=ie(6),U=ie(1552),G=ie(1395),E=ie(1394),B=ie(1553),n=ie(1639),M=ie(1643),a=ie(1647),D=ie(1651),z=ie(46),p=ie(116),m=ie(1376),g=ie(166),L=ie(117),ie(640),H=ie(1373),P=ie(1554),R=ie(1497),A=ie(1656),r=ie(1437),l=ie(1480),o=ie(1660),i=ie(1555),F=ie(1667),ie(1391),ie(1392),v=ie(1671),c=ie(1556),W=ie(53),q=ie(178),ie(1415),e(Z,d),Z.prototype.url="",Z.prototype.model=S,C=Z,e(Q,d),Q.prototype.url="/db/campaign/-/overworld?project=slug,adjacentCampaigns,name,fullName,description,i18n,color,levels",Q.prototype.model=h,u=Q,te.exports=(e(ee,N),ee.prototype.id="campaign-view",ee.prototype.template=$,ee.prototype.getMeta=function(){return{title:w.i18n.t("play.title"),meta:[{vmid:"meta-description",name:"description",content:w.i18n.t("play.meta_description")}],link:[{vmid:"rel-canonical",rel:"canonical",content:"/play"}]}},ee.prototype.subscriptions={"subscribe-modal:subscribed":"onSubscribed"},ee.prototype.events={"click #amazon-campaign-logo":"onClickAmazonCampaign","click #anon-classroom-signup-close":"onClickAnonClassroomClose","click #anon-classroom-join-btn":"onClickAnonClassroomJoin","click #anon-classroom-signup-btn":"onClickAnonClassroomSignup","click .cube-level":"onSpinningCubeClick","click .map-background":"onClickMap","click .level":"onClickLevel","dblclick .level":"onDoubleClickLevel","click .level-info-container .start-level":"onClickStartLevel","click .level-info-container .view-solutions":"onClickViewSolutions","click .level-info-container .course-version button":"onClickCourseVersion","click #volume-button":"onToggleVolume","click #back-button":"onClickBack","click #clear-storage-button":"onClickClearStorage","click .portal .campaign":"onClickPortalCampaign","click .portal .beta-campaign":"onClickPortalCampaign","click a .campaign-switch":"onClickCampaignSwitch","mouseenter .portals":"onMouseEnterPortals","mouseleave .portals":"onMouseLeavePortals","mousemove .portals":"onMouseMovePortals","click .poll":"showPoll","click #brain-pop-replay-btn":"onClickBrainPopReplayButton","click .premium-menu-icon":"onClickPremiumButton",'click [data-toggle="coco-modal"][data-target="play/modal/PromotionModal"]':"openPromotionModal",'click [data-toggle="coco-modal"][data-target="play/modal/PlayItemsModal"]':"openPlayItemsModal",'click [data-toggle="coco-modal"][data-target="play/modal/PlayHeroesModal"]':"openPlayHeroesModal",'click [data-toggle="coco-modal"][data-target="play/modal/PlayAchievementsModal"]':"openPlayAchievementsModal",'click [data-toggle="coco-modal"][data-target="play/modal/BuyGemsModal"]':"openBuyGemsModal",'click [data-toggle="coco-modal"][data-target="core/ContactModal"]':"openContactModal",'click [data-toggle="coco-modal"][data-target="core/CreateAccountModal"]':"openCreateAccountModal",'click [data-toggle="coco-modal"][data-target="core/AnonymousTeacherModal"]':"openAnonymousTeacherModal","click #videos-button":"onClickVideosButton","click #esports-arena":"onClickEsportsButton","click a.start-esports":"onClickEsportsLink"},ee.prototype.shortcuts={"shift+s":"onShiftS"},ee.prototype.destroy=function(){var e,t;return null!=(t=this.setupManager)&&t.destroy(),this.$el.find(".ui-draggable").off().draggable("destroy"),w(window).off("resize",this.onWindowResize),(e=this.ambientSound)&&H.Tween.get(e).to({volume:0},1500).call(function(){return e.stop()}),null!=(t=this.musicPlayer)&&t.destroy(),clearTimeout(this.playMusicTimeout),clearInterval(this.portalScrollInterval),Backbone.Mediator.unsubscribe("audio-player:loaded",this.playAmbientSound,this),ee.__super__.destroy.call(this)},ee.prototype.showLoading=function(e){if(!this.campaign)return this.$el.find(".game-controls, .user-status").addClass("hidden"),this.$el.find(".portal .campaign-name span").text(w.i18n.t("common.loading"))},ee.prototype.hideLoading=function(){if(!this.campaign)return this.$el.find(".game-controls, .user-status").removeClass("hidden")},ee.prototype.openPromotionModal=function(e){var t;return e&&null!=(t=window.tracker)&&t.trackEvent("Click Promotion Modal Button"),this.openModalView(new F)},ee.prototype.openPlayItemsModal=function(e){return e.stopPropagation(),this.openModalView(new P)},ee.prototype.openPlayHeroesModal=function(e){return e.stopPropagation(),this.openModalView(new R)},ee.prototype.openPlayAchievementsModal=function(e){return e.stopPropagation(),this.openModalView(new A)},ee.prototype.openBuyGemsModal=function(e){return e.stopPropagation(),this.openModalView(new r)},ee.prototype.openContactModal=function(e){return e.stopPropagation(),this.openModalView(new l)},ee.prototype.openCreateAccountModal=function(e){return e.stopPropagation(),this.openModalView(new f)},ee.prototype.openAnonymousTeacherModal=function(e){return e.stopPropagation(),this.openModalView(new o),this.endHighlight()},ee.prototype.onClickAmazonCampaign=function(e){var t;return null!=(t=window.tracker)&&t.trackEvent("Click Amazon Modal Button"),this.openModalView(new i({hideCongratulation:!0}))},ee.prototype.onClickAnonClassroomClose=function(){var e;return null!=(e=this.$el.find("#anonymous-classroom-signup-dialog"))?e.hide():void 0},ee.prototype.onClickAnonClassroomJoin=function(){var e,t=null!=(e=this.$el.find("#anon-classroom-signup-code"))?e.val():void 0;if(!_.isEmpty(t))return null!=(e=window.tracker)&&e.trackEvent("Anonymous Classroom Signup Modal Join Class",{category:"Signup"},t),k.router.navigate("/students?_cc="+t,{trigger:!0})},ee.prototype.onClickAnonClassroomSignup=function(){var e;return null!=(e=window.tracker)&&e.trackEvent("Anonymous Classroom Signup Modal Create Teacher",{category:"Signup"}),this.openModalView(new f({startOnPath:"teacher"}))},ee.prototype.onClickVideosButton=function(){return this.openModalView(new c({courseInstanceID:this.courseInstanceID,courseID:this.course.get("_id")}))},ee.prototype.onClickEsportsButton=function(e){var t,i;return null!=(i=this.$levelInfo)&&i.hide(),t=w(e.target).data("arena"),null!=(i=window.tracker)&&i.trackEvent("Click LevelInfo AI League Button",{category:"World Map",label:t}),this.$levelInfo=this.$el.find(".level-info-container.league-arena-tooltip[data-arena='"+t+"']").show(),console.log(this.$levelInfo,"click it",t),this.adjustLevelInfoPosition(e)},ee.prototype.onClickEsportsLink=function(e){var t=w(e.target).data("arena");return null!=(e=window.tracker)?e.trackEvent("Click Play AI League Button",{category:"World Map",label:t}):void 0},ee.prototype.getLevelPlayCounts=function(){me.isAdmin()},ee.prototype.onLoaded=function(){var e,t,i,n,o,s,r,a;if(this.isOldBrowser()&&(j.load("hideBrowserRecommendation")||(o=ie(1677),this.openModalView(new o))),this.isClassroom())this.updateClassroomSessions();else if(!this.editorMode)for(e=0,t=(i=this.sessions.models).length;e<t;e++)a=i[e],"complete"!==this.levelStatusMap[a.get("levelID")]&&(this.levelStatusMap[a.get("levelID")]=null!=(n=a.get("state"))&&n.complete?"complete":"started"),null!=(n=a.get("state"))&&n.difficulty&&(this.levelDifficultyMap[a.get("levelID")]=a.get("state").difficulty);if(this.editorMode||this.buildLevelScoreMap(),"hoc"===(null!=(o=this.campaign)?o.get("type"):void 0)||me.isStudent()&&!this.courseInstance&&"intro"===(null!=(s=this.campaign)?s.get("slug"):void 0)?k.setHocCampaign(this.campaign.get("slug")):k.setHocCampaign(""),!this.fullyRendered)return this.fullyRendered=!0,this.render(),this.checkForUnearnedAchievements(),null!=(s=me.get("heroConfig"))&&s.thangType||this.preloadTopHeroes(),"forest"!==(s=this.terrain)&&"desert"!==s||this.$el.find("#campaign-status").delay(4e3).animate({top:"-=58"},1e3),this.campaign&&this.isRTL(J.i18n(this.campaign.attributes,"fullName"))&&this.$(".campaign-name").attr("dir","rtl"),me.isInHourOfCode()||!this.terrain?this.maybeShowPendingAnnouncement():me.get("name")&&("forgetful-gemsmith"===(s=me.get("lastLevel"))||"signs-and-portents"===s||"true-names"===s)&&me.level()<5&&"18-24"!==(r=me.get("ageRange"))&&"25-34"!==r&&"35-44"!==r&&"45-100"!==r&&!j.load("sent-parent-email")&&!(me.isPremium()||me.isStudent()||me.isTeacher())?this.openModalView(new U):void 0},ee.prototype.updateClassroomSessions=function(){var e,t,i,n,o,s,r,a,l,c,h;if(this.classroom){for(e=this.classroom.getLevels(),this.classroomLevelMap=_.zipObject(e.map(function(e){return e.get("original")}),e.models),t=this.classroom.get("aceConfig").language,n=0,o=(a=this.sessions.slice()).length;n<o;n++)h=a[n],(i=this.classroomLevelMap[h.get("level").original])&&(i=i.get("primerLanguage")||t,h.get("codeLanguage")===i||this.sessions.remove(h));if(!this.editorMode){for(r=0,s=(l=this.sessions.models).length;r<s;r++)h=l[r],"complete"!==this.levelStatusMap[h.get("levelID")]&&(this.levelStatusMap[h.get("levelID")]=null!=(c=h.get("state"))&&c.complete?"complete":"started"),null!=(c=h.get("state"))&&c.difficulty&&(this.levelDifficultyMap[h.get("levelID")]=h.get("state").difficulty);if("5d12e7e36eea5a00ac71dc8f"===this.courseInstance.get("classroomID")&&!this.levelStatusMap["game-dev-2-final-project"])return this.levelStatusMap["game-dev-2-final-project"]="started"}}},ee.prototype.buildLevelScoreMap=function(){for(var e,t,i,n=this.sessions.models,o=0,s=n.length;o<s;o++){if(t=n[o],!(i=this.getLevels()))return;(e=null!=(e=t.get("level"))?e.original:void 0)&&(i=i[e],i=_.first(S.getTopScores({session:t.toJSON(),level:i})),this.levelScoreMap[e]=i)}},ee.prototype.maybeShowMinecraftModal=function(){var e;return!me.freeOnly()&&(function(e){return!!e.isAdmin()||!e.isPremium()&&(!e.isAnonymous()&&e.get("testGroupNumber")%5==1)}(me)&&this.campaign&&this.campaign.get("levels")&&(e=this.campaign.get("levels"),_.find(e,{slug:"the-second-kithmaze"})&&"complete"===this.levelStatusMap["the-second-kithmaze"]&&/^en/i.test(me.get("preferredLanguage",!0)))?w(".cube-level").show():void 0)},ee.prototype.onSpinningCubeClick=function(e){var t;return null!=(t=window.tracker)&&t.trackEvent("Mine Explored",{engageAction:"campaign_level_click"}),this.openModalView(new D)},ee.prototype.setCampaign=function(e){return this.campaign=e,this.render()},ee.prototype.onSubscribed=function(){return this.requiresSubscription=!1,this.render()},ee.prototype.getRenderData=function(e){var t,i,n,o,s,r,a,l,c,h,u,p,d,m,f,g,y,v,b;if((e=ee.__super__.getRenderData.call(this,e=null==e?{}:e)).campaign=this.campaign,e.levels=_.values(w.extend(!0,{},null!=(u=this.getLevels())?u:{})),me.level()<12&&"dungeon"===this.terrain&&!this.editorMode&&(e.levels=_.reject(e.levels,{slug:"signs-and-portents"})),me.freeOnly()&&(e.levels=_.reject(e.levels,(v=this,function(e){var t;return!("course"!==(t=e.type)&&"course-ladder"!==t||!me.isStudent()||v.courseInstance)||e.requiresSubscription}))),features.brainPop&&(e.levels=_.filter(e.levels,function(e){return"dungeons-of-kithgard"===(e=e.slug)||"gems-in-the-deep"===e||"shadow-guard"===e||"enemy-mine"===e||"true-names"===e})),this.annotateLevels(e.levels),o=this.countLevels(e.levels),null!=this.courseStats?(e.levelsCompleted=this.courseStats.levels.numDone,e.levelsTotal=this.courseStats.levels.size):(e.levelsCompleted=o.completed,e.levelsTotal=o.total),(null!=(u=this.sessions)&&u.loaded||this.editorMode)&&this.determineNextLevel(e.levels),e.levels=_.sortBy(e.levels,function(e){return e.position.y}).reverse(),this.campaign&&(this.campaign.renderedLevels=e.levels),e.levelStatusMap=this.levelStatusMap,e.levelDifficultyMap=this.levelDifficultyMap,e.levelPlayCountMap=this.levelPlayCountMap,e.isIPadApp=k.isIPadApp,e.picoCTF=window.serverConfig.picoCTF,e.requiresSubscription=this.requiresSubscription,e.editorMode=this.editorMode,e.adjacentCampaigns=_.filter(_.values(_.cloneDeep((null!=(u=this.campaign)?u.get("adjacentCampaigns"):void 0)||{})),(b=this,function(e){var t;if(me.isStudent()||me.isTeacher())return!1;if(e.showIfUnlocked&&!b.editorMode){if(_.isString(e.showIfUnlocked)&&(t=e.showIfUnlocked,X.call(me.levels(),t)<0))return!1;if(_.isArray(e.showIfUnlocked)&&_.intersection(e.showIfUnlocked,me.levels()).length<=0)return!1}return e.name=J.i18n(e,"name"),t=[],e.color&&t.push("color: "+e.color),e.rotation&&t.push("transform: rotate("+e.rotation+"deg)"),null==e.position&&(e.position={x:10,y:10}),t.push("left: "+e.position.x+"%"),t.push("top: "+e.position.y+"%"),e.style=t.join("; "),!0})),e.marked=marked,e.i18n=J.i18n,this.campaigns){for(e.campaigns={},s=0,r=(p=this.campaigns.models).length;s<r;s++)"auditions"!==(n=p[s]).get("slug")&&(e.campaigns[n.get("slug")]=n,null!=(d=this.sessions)&&d.loaded&&(d=_.values(w.extend(!0,{},null!=(d=n.get("levels"))?d:{})),me.level()<12&&"dungeon"===n.get("slug")&&!this.editorMode&&(d=_.reject(d,{slug:"signs-and-portents"})),me.freeOnly()&&(d=_.reject(d,function(e){return e.requiresSubscription})),o=this.countLevels(d),n.levelsTotal=o.total,n.levelsCompleted=o.completed,"dungeon"===n.get("slug")?n.locked=!1:(n.levelsTotal,n.locked=!0)));for(l=0,a=(m=this.campaigns.models).length;l<a;l++)for(i in g=null!=(f=(n=m[l]).get("adjacentCampaigns"))?f:{})t=g[i],_.isString(t.showIfUnlocked)?(y=t.showIfUnlocked,0<=X.call(me.levels(),y)&&null!=(c=_.find(this.campaigns.models,{id:i}))&&(c.locked=!1)):_.isArray(t.showIfUnlocked)&&0<_.intersection(t.showIfUnlocked,me.levels()).length&&null!=(h=_.find(this.campaigns.models,{id:i}))&&(h.locked=!1)}return this.terrain&&_.string.contains(this.terrain,"hoc")&&me.isTeacher()&&(e.showGameDevAlert=!0),e},ee.prototype.afterRender=function(){var e,t,i;return ee.__super__.afterRender.call(this),this.onWindowResize(),w("#anon-classroom-signup-code").keydown(function(e){if(13===e.keyCode)return w("#anon-classroom-join-btn").click()}),k.isIPadApp||(_.defer((i=this,function(){var e;return null!=(e=i.$el)?e.find(".game-controls .btn:not(.poll)").addClass("has-tooltip").tooltip():void 0})),(t=this).$el.find(".level, .campaign-switch").addClass("has-tooltip").tooltip().each(function(){if(me.isAdmin()&&t.editorMode)return w(this).draggable().on("dragstop",function(){var e=w(".map-background"),e={position:{x:100*((w(this).offset().left-e.offset().left+w(this).outerWidth()/2)/e.width()),y:100*(1-(w(this).offset().top-e.offset().top+w(this).outerHeight()/2)/e.height())},levelOriginal:w(this).data("level-original"),campaignID:w(this).data("campaign-id")};if(e.levelOriginal&&t.trigger("level-moved",e),e.campaignID)return t.trigger("adjacent-campaign-moved",e)})})),this.updateVolume(),this.updateHero(),!window.currentModal&&this.fullyRendered&&(this.highlightElement(".level.next",{delay:500,duration:6e4,rotation:0,sides:["top"]}),this.editorMode&&this.createLines(),this.options.showLeaderboard?this.showLeaderboard(null!=(e=this.options.justBeatLevel)?e.get("slug"):void 0):this.shouldShow("promotion")&&((e=j.load("pointed-out-promotion")||0)?e<5&&(this.$el.find("button.promotion-menu-icon").addClass("highlighted").tooltip("show"),j.save("pointed-out-promotion",e+1)):(this.openPromotionModal(),j.save("pointed-out-promotion",e+1)))),this.applyCampaignStyles()},ee.prototype.onShiftS=function(e){if(this.editorMode)return this.generateCompletionRates()},ee.prototype.generateCompletionRates=function(){var e,t,i,n,o,s,r,a;if(me.isAdmin()){for(a=J.getUTCDay(-14),e=J.getUTCDay(-1),w(".map-background").css("background-image","none"),w(".gradient").remove(),w("#campaign-view").css("background-color","black"),r=[],t=0,i=(o=null!=(n=null!=(n=this.campaign)?n.renderedLevels:void 0)?n:[]).length;t<i;t++)s=o[t],w("div[data-level-slug="+s.slug+"] .level-kind").text("Loading..."),s=this.supermodel.addRequestResource("level_completions",{url:"/db/analytics_perday/-/level_completions",data:{startDay:a,endDay:e,slug:s.slug},method:"POST",success:this.onLevelCompletionsLoaded.bind(this,s)},0),r.push(s.load());return r}},ee.prototype.onLevelCompletionsLoaded=function(e,t){var i,n,o,s,r,a,l,c,h;if(!this.destroyed){for(n=i=h=0,o=t.length;n<o;n++)h+=null!=(l=(c=t[n]).started)?l:0,i+=null!=(c=c.finished)?c:0;return r=(100*(a=0===h?0:i/h)).toFixed(1)+"%",w("div[data-level-slug="+e.slug+"] .level-kind").html((h<1e3?h:(h/1e3).toFixed(1)+"k")+"<br>"+r),s=a<=.5?"rgb(255, 0, 0)":.5<a&&a<=.85?(s=(a-.5)/.35,"rgb(255, "+Math.round(256*s)+", 0)"):.85<a&&a<=.95?(s=(a-.85)/.1,"rgb("+Math.round(256*(1-s))+", 256, 0)"):"rgb(0, 256, 0)",w("div[data-level-slug="+e.slug+"] .level-kind").css({color:s,width:"256px",transform:"translateX(-50%) translateX(15px)"}),w("div[data-level-slug="+e.slug+"]").css("background-color",s)}},ee.prototype.afterInsert=function(){var e,o;return ee.__super__.afterInsert.call(this),o=["/images/pages/base/modal_background.png","/images/level/popover_background.png","/images/level/code_palette_wood_background.png","/images/level/code_editor_background_border.png"],_.delay(function(){for(var e,t=[],i=0,n=o.length;i<n;i++)e=o[i],t.push(w("<img/>")[0].src=e);return t},2e3),J.getQueryVariable("signup")&&!me.get("email")?this.promptForSignup():me.isPremium()||!this.isPremiumCampaign()&&(!this.options.worldComplete||features.noAuth||me.isInHourOfCode())?void 0:me.get("email")?(e=window.location.pathname.split("/")[2],this.promptForSubscription(e,"premium campaign visited")):this.promptForSignup()},ee.prototype.promptForSignup=function(){var e;if(!(this.terrain&&0<=X.call(this.terrain,"hoc")||features.noAuth||"hoc"===(null!=(e=this.campaign)?e.get("type"):void 0)))return this.endHighlight(),this.openModalView(new f({supermodel:this.supermodel}))},ee.prototype.promptForSubscription=function(e,t){var i;return"hoc"===(null!=(i=this.campaign)?i.get("type"):void 0)?console.log("Game dev HoC does not encourage subscribing."):me.isStudent()?console.log("Students shouldn't be prompted to subscribe"):(this.endHighlight(),this.openModalView(new V),null!=(i=window.tracker)?i.trackEvent("Show subscription modal",{category:"Subscription",label:t,level:e,levelID:e}):void 0)},ee.prototype.isPremiumCampaign=function(e){if(e=e||window.location.pathname.split("/")[2])return!(0<=X.call(e,"hoc"))&&/campaign-(game|web)-dev-\d/.test(e)},ee.prototype.annotateLevels=function(n){var e,t,s,i,r,o,a,l,c,h,u,p,d;if(!this.isClassroom()){for(p=[],i=e=0,t=n.length;e<t;i=++e)null==(s=n[i]).position&&(s.position={x:10,y:10}),s.locked=!me.ownsLevel(s.original),"kithgard-mastery"===s.slug&&0===this.calculateExperienceScore()&&(s.locked=!0),s.requiresSubscription&&this.requiresSubscription&&me.isInHourOfCode()&&(s.locked=!0),"started"!==(a=this.levelStatusMap[s.slug])&&"complete"!==a||(s.locked=!1),this.editorMode&&(s.locked=!1),"Auditions"!==(a=null!=(a=this.campaign)?a.get("name"):void 0)&&"Intro"!==a||(s.locked=!1),me.isInGodMode()&&(s.locked=!1),s.adminOnly&&"started"!==(l=this.levelStatusMap[s.slug])&&"complete"!==l&&(s.disabled=!0),me.isInGodMode()&&(s.disabled=!1),s.color="rgb(255, 80, 60)",this.isClassroom()||"hoc"===(null!=(c=this.campaign)?c.get("type"):void 0)||s.requiresSubscription&&(s.color="rgb(80, 130, 200)"),s.locked&&(s.color="rgb(193, 193, 193)"),s.unlocksHero=null!=(c=_.find(s.rewards,"hero"))?c.hero:void 0,s.unlocksHero&&(s.purchasedHero=(h=s.unlocksHero,0<=X.call((null!=(c=me.get("purchased"))?c.heroes:void 0)||[],h))),s.unlocksItem=null!=(h=_.find(s.rewards,"item"))?h.item:void 0,s.unlocksPet=-1!==J.petThangIDs.indexOf(s.unlocksItem),null!=this.classroom&&(s.unlocksItem=!1,s.unlocksPet=!1),window.serverConfig.picoCTF&&(o=_.find(this.picoCTFProblems||[],{pid:s.picoCTFProblem}))&&(!o.unlocked&&"digital-graffiti"!==s.slug||(s.locked=!1),s.description="### "+o.name+"\n"+(s.description||o.description)+"\n\n"+o.category+" - "+o.score+" points",o.solved&&(s.color="rgb(80, 130, 200)")),s.hidden=s.locked&&"hoc"!==(null!=(u=this.campaign)?u.get("type"):void 0),null!=(u=s.concepts)&&u.length&&(s.displayConcepts=s.concepts,6<s.displayConcepts.length&&(s.displayConcepts=s.displayConcepts.slice(-6))),s.unlockedInSameCampaign=i<5,p.push(function(){for(var e=[],t=0,i=n.length;t<i;t++)r=n[t],s.unlockedInSameCampaign||r===s||e.push(function(){for(var e,t=null!=(e=r.rewards)?e:[],i=[],n=0,o=t.length;n<o;n++)(d=t[n]).level&&i.push(s.unlockedInSameCampaign||(s.unlockedInSameCampaign=d.level===s.original));return i}());return e}());return p}},ee.prototype.countLevels=function(e){var t,i,n,o,s,r,a,l,c,h={total:0,completed:0};if("hoc"===(null!=(l=this.campaign)?l.get("type"):void 0)){for(i=0,n=(e=_.sortBy(e,function(e){return e.position.x})).length;i<n;i++)s=e[i],"complete"===this.levelStatusMap[s.slug]&&h.completed++;return h.total=e.length,h}for(r=a=0,o=e.length;a<o;r=++a)null==(s=e[r]).locked&&this.annotateLevels(e),s.disabled||(t="complete"===this.levelStatusMap[s.slug],c="started"===this.levelStatusMap[s.slug],!s.unlockedInSameCampaign&&s.locked||!c&&!t&&s.locked&&s.practice&&("-a"===(c=s.slug.substring(s.slug.length-2))||"-b"===c||"-c"===c||"-d"===c)||++h.total,t&&++h.completed);return h},ee.prototype.showLeaderboard=function(e){e=new b({supermodel:this.supermodel,levelSlug:e});return this.openModalView(e)},ee.prototype.isClassroom=function(){return null!=this.courseInstanceID},ee.prototype.determineNextLevel=function(a){var l,e,t,i,n,o,s,r,c,h,u,p,d,m,f,g,y;if(this.isClassroom())return null!=this.courseStats&&this.applyCourseLogicToLevels(a),!0;if(l=["lost-viking","kithgard-mastery"],g=[{slug:"boom-and-bust",unless:"defense-of-plainswood"}],"hoc"===(null!=(m=this.campaign)?m.get("type"):void 0))for(i=0,n=(a=_.sortBy(a,function(e){return e.position.x})).length;i<n;i++)if(r=a[i],"complete"!==this.levelStatusMap[r.slug])return r.next=!0,r.locked=!1,r.hidden=r.locked,r.disabled=!1,void(r.color="rgb(255, 80, 60)");for(y=this,t=!(e=function(e,t){for(var i,n,o=e.nextLevels,s=0,r=o.length;s<r;s++)if(n=o[s],(i=_.find(a,{original:n}))&&!i.locked&&(!t||y.campaign.levelIsPractice(i))&&!y.campaign.levelIsAssessment(i)&&(!y.campaign.levelIsAssessment(e)||!y.campaign.levelIsPractice(i))&&!i.disabled&&"complete"!==y.levelStatusMap[i.slug]&&(n=i.slug,X.call(l,n)<0)&&!i.replayable&&(me.isPremium()||!i.requiresSubscription||_.any(g,function(e){return i.slug===e.slug&&!y.levelStatusMap[e.unless]})))return i.next=!0;return!1}),c=h=0,o=a.length;h<o;c=++h){if(r=a[c],"course"===this.campaign.get("type")){for(r.nextLevels=[],p=d=0,s=a.length;d<s;p=++d)if(u=a[p],c<p&&(!u.practice||!r.nextLevels.length)){if(r.practice&&!u.practice)break;if(r.nextLevels.push(u.original),!u.practice)break}}else r.nextLevels=function(){for(var e,t=null!=(e=r.rewards)?e:[],i=[],n=0,o=t.length;n<o;n++)(f=t[n]).level&&i.push(f.level);return i}();t=(t=!t&&!this.campaign.levelIsAssessment(r)?e(r,!0):t)||e(r,!1)}return t||!a[0]||a[0].locked||"complete"===this.levelStatusMap[a[0].slug]?void 0:a[0].next=!0},ee.prototype.calculateExperienceScore=function(){for(var t,e,i,n="18-24"===(n=me.get("ageRange"))||"25-34"===n||"35-44"===n||"45-100"===n,o=0,s=[["dungeons-of-kithgard",50],["gems-in-the-deep",55],["shadow-guard",55],["forgetful-gemsmith",40],["true-names",40]],r=0,a=s.length;r<a;r++)t=(e=s[r])[0],i=e[1],(null!=(e=_.find(null!=(e=this.sessions)?e.models:void 0,function(e){return e.get("levelID")===t}))?e.attributes.playtime:void 0)<=i&&++o;return n+o},ee.prototype.createLines=function(){for(var s,r,e,t=null!=(e=null!=(e=this.campaign)?e.renderedLevels:void 0)?e:[],i=[],n=0,o=t.length;n<o;n++)s=t[n],i.push(function(){for(var e,t=null!=(e=s.nextLevels)?e:[],i=[],n=0,o=t.length;n<o;n++)r=t[n],(r=_.find(this.campaign.renderedLevels,{original:r}))?i.push(this.createLine(s.position,r.position)):i.push(void 0);return i}.call(this));return i},ee.prototype.createLine=function(e,t){var i=parseFloat(w(".map").css("height")),n=parseFloat(w(".map").css("width"));if(0<i)return i={x:e.x,y:e.y/(n=n/i)},t={x:t.x,y:t.y/n},n=Math.sqrt(Math.pow(i.x-t.x,2)+Math.pow(i.y-t.y,2)),i="translateY(-50%) translateX(-50%) rotate("+180*Math.atan2(i.y-t.y,t.x-i.x)/Math.PI+"deg) translateX(50%)",w("<div>").appendTo(".map").addClass("next-level-line").css({transform:i,width:n+"%",left:e.x+"%",bottom:e.y-.5+"%"}).append(w('<div class="line">')).append(w('<div class="point">'))},ee.prototype.applyCampaignStyles=function(){var e,t,i,n,o,s,r,a,l,c,h,u,p,d;if(null!=(h=this.campaign)&&h.loaded){if((n=this.campaign.get("backgroundImage"))&&n.length){for((n=_.sortBy(n,"width")).reverse(),d=[],o=s=0,r=n.length;s<r;o=++s)p="#campaign-view .map-background { background-image: url(/file/"+(e=n[o]).image+"); }",o&&(p="@media screen and (max-width: "+e.width+"px) { "+p+" }"),d.push(p);J.injectCSS(d.join("\n"))}if(t=this.campaign.get("backgroundColor"))for(i=this.campaign.get("backgroundColorTransparent"),this.$el.css("background-color",t),l=0,a=(u=["top","right","bottom","left"]).length;l<a;l++)this.$el.find("."+(c=u[l])+"-gradient").css("background-image","linear-gradient(to "+c+", "+i+" 0%, "+t+" 100%)");return this.playAmbientSound()}},ee.prototype.onMouseEnterPortals=function(e){var t,i;if(null!=(t=this.campaigns)&&t.loaded&&null!=(i=this.sessions)&&i.loaded)return this.portalScrollInterval=setInterval(this.onMouseMovePortals,100),this.onMouseMovePortals(e)},ee.prototype.onMouseLeavePortals=function(e){if(this.portalScrollInterval)return clearInterval(this.portalScrollInterval),this.portalScrollInterval=null},ee.prototype.onMouseMovePortals=function(e){var t,i,n,o;if(this.portalScrollInterval&&(n=this.$el.find(".portal"),t=this.$el.find(".portals"),e&&(this.portalOffsetX=Math.round(Math.max(0,e.clientX-n.offset().left))),i=w("body").innerWidth(),!(.2<(o=this.portalOffsetX/i)&&o<.8)))return o=.2*i*(-1==(n=o<.5?1:-1)?o-.8:.2-o)/.2,o=t.offset().left+n*o,o=Math.max(i-2853,o),o=Math.min(0,o),t.stop().animate({marginLeft:o},100,"linear")},ee.prototype.onSessionsLoaded=function(e){if(!this.editorMode)return this.render(),me.get("anonymous")||me.inEU()||window.serverConfig.picoCTF?void 0:this.loadUserPollsRecord()},ee.prototype.onCampaignsLoaded=function(e){return this.render()},ee.prototype.preloadLevel=function(e){var t="/db/level/"+e,t=(new x).setURL(t);return this.supermodel.loadModel(t,null,0).model,t="/db/level/"+e+"/session?campaign="+this.campaign.id,this.preloadedSession=(new S).setURL(t),this.listenToOnce(this.preloadedSession,"sync",this.onSessionPreloaded),this.preloadedSession=this.supermodel.loadModel(this.preloadedSession,{cache:!1}).model,this.preloadedSession.levelSlug=e},ee.prototype.onSessionPreloaded=function(e){var t,i;if(e.url=function(){return"/db/level.session/"+this.id},t=this.$el.find(".level-info-container:visible"),e.levelSlug===t.data("level-slug")&&(i=null!=(i=e.get("state"))?i.difficulty:void 0))return i=w("<span class='badge'>"+i+"</span>"),t.find(".start-level .badge").remove(),t.find(".start-level").append(i)},ee.prototype.onClickMap=function(e){var t;if(null!=(t=this.$levelInfo)&&t.hide(),(null!=(t=this.sessions)?t.models.length:void 0)<3)return this.highlightElement(".level.next",{delay:500,duration:6e4,rotation:0,sides:["top"]})},ee.prototype.onClickLevel=function(e){var t,i;if(e.preventDefault(),e.stopPropagation(),null!=(i=this.$levelInfo)&&i.hide(),i=(t=w(e.target).parents(".level")).data("level-slug"))return t=t.data("level-original"),this.editorMode?this.trigger("level-clicked",t):(this.$levelInfo=this.$el.find(".level-info-container[data-level-slug="+i+"]").show(),this.checkForCourseOption(t),this.adjustLevelInfoPosition(e),this.endHighlight(),this.preloadLevel(i))},ee.prototype.onDoubleClickLevel=function(e){if(this.editorMode)return e=w(e.target).parents(".level").data("level-original"),this.trigger("level-double-clicked",e)},ee.prototype.onClickStartLevel=function(e){var o,s,t,i=w(e.target).parents(".level-info-container"),n=i.data("level-slug"),r=(i.data("level-original"),_.find(_.values(this.getLevels()),{slug:n})),a=me.get("hourOfCode")||"hoc"===(null!=(e=this.campaign)?e.get("type"):void 0)||"intro"===(null!=(a=this.campaign)?a.get("slug"):void 0)?"long":"short";return new Date(me.get("dateCreated"))<new Date("2021-09-21")&&(a="all"),o=me.getExperimentValue("home-content",a),a=function(){for(var e=J.freeAccessLevels,t=[],i=0,n=e.length;i<n;i++)s=e[i],_.any(["short"===s.access,"medium"===s.access&&("medium"===o||"long"===o||"extended"===o),"long"===s.access&&("long"===o||"extended"===o),"extended"===s.access&&"extended"===o])&&t.push(s.slug);return t}(),t=r.requiresSubscription||"all"!==o&&(t=r.slug,X.call(a,t)<0),r=_.any([!this.requiresSubscription,this.levelStatusMap[r.slug],"hoc"===this.campaign.get("type")]),t&&!r?this.promptForSubscription(n,"map level clicked"):(this.startLevel(i),null!=(i=window.tracker)?i.trackEvent("Clicked Start Level",{category:"World Map",levelID:n}):void 0)},ee.prototype.onClickCourseVersion=function(e){var t=w(e.target).parents(".level-info-container"),i=w(e.target).parents(".level-info-container").data("level-slug"),n=t.data("level-original"),o=w(e.target).parents(".course-version").data("course-id"),s=w(e.target).parents(".course-version").data("course-instance-id"),n=null!=(e=this.classroomLevelMap)?e[n]:void 0;return!me.showHeroAndInventoryModalsToStudents()||null!=n&&n.isAssessment()?Backbone.Mediator.publish("router:navigate",{route:"/play/level/"+i+"?course="+o+"&course-instance="+s}):(this.startLevel(t,o,s),null!=(s=window.tracker)?s.trackEvent("Clicked Start Level",{category:"World Map",levelID:i}):void 0)},ee.prototype.startLevel=function(e,t,i){var n,o,s,r,a,l;if(null==t&&(t=null),null==i&&(i=null),null!=(r=this.setupManager)&&r.destroy(),o=e.data("level-slug"),n=e.data("level-original"),r=null!=(r=this.classroomLevelMap)?r[n]:void 0,a=!me.showHeroAndInventoryModalsToStudents()||null!=r&&r.isAssessment()?(null!=(r=this.preloadedSession)&&r.loaded&&this.preloadedSession.levelSlug===o&&(l=this.preloadedSession),{supermodel:this.supermodel,levelID:o,levelPath:e.data("level-path"),levelName:e.data("level-name"),hadEverChosenHero:this.hadEverChosenHero,parent:this,session:l}):(a=(null!=(l=this.classroomLevelMap)&&null!=(s=l[n])?s.get("primerLanguage"):void 0)||(null!=(s=this.classroom)&&null!=(a=s.get("aceConfig"))?a.language:void 0),{supermodel:this.supermodel,levelID:o,levelPath:e.data("level-path"),levelName:e.data("level-name"),hadEverChosenHero:this.hadEverChosenHero,parent:this,courseID:t,courseInstanceID:i,codeLanguage:a}),this.setupManager=new T(a),null==(a=this.setupManager)||!a.navigatingToPlay)return null!=(a=this.$levelInfo)&&a.find(".level-info, .progress").toggleClass("hide"),this.listenToOnce(this.setupManager,"open",function(){var e;return null!=(e=this.$levelInfo)&&e.find(".level-info, .progress").toggleClass("hide"),null!=(e=this.$levelInfo)?e.hide():void 0}),this.setupManager.open()},ee.prototype.onClickViewSolutions=function(e){var t=w(e.target).parents(".level-info-container").data("level-slug");return"ladder"===(e=_.find(_.values(this.getLevels()),{slug:t}).type)||"hero-ladder"===e||"course-ladder"===e?Backbone.Mediator.publish("router:navigate",{route:"/play/ladder/"+t,viewClass:"views/ladder/LadderView",viewArgs:[{supermodel:this.supermodel},t]}):this.showLeaderboard(t)},ee.prototype.adjustLevelInfoPosition=function(e){var t,i;if(this.$levelInfo)return null==this.$map&&(this.$map=this.$el.find(".map")),i=this.$map.offset(),t=e.pageX-i.left,e=e.pageY-i.top,i=this.$levelInfo.outerWidth(),this.$levelInfo.css("left",Math.min(Math.max(20,t-i/2),this.$map.width()-i-20)),this.$levelInfo.outerHeight(),i=e-this.$levelInfo.outerHeight()-60,this.$levelInfo.css("top",i=i<100?60+e:i)},ee.prototype.onWindowResize=function(e){var t,i,n={dungeon:2350,forest:2500,auditions:2500,desert:2411,mountain:2422,glacier:2421}[this.terrain]||2350,o=n/1536,s=this.$el.width(),r=this.$el.height();return r/1536<=s/n?i=(t=r)*o:t=(i=s)/o,s=(s-i)/2,r=(r-t)/2,this.$el.find(".map").css({width:i,height:t,"margin-left":s,"margin-top":r})},ee.prototype.playAmbientSound=function(){var e,t;if(me.get("volume")&&!this.ambientSound&&(e=null!=(e=this.campaign)&&null!=(t=e.get("ambientSound"))?t[s.ext.substr(1)]:void 0))return null!=(e=s.getStatus(t="/file/"+e))&&e.loaded?(this.ambientSound=H.Sound.play(t,{loop:-1,volume:.1}),H.Tween.get(this.ambientSound).to({volume:.5},1e3)):(s.preloadSound(t),void Backbone.Mediator.subscribeOnce("audio-player:loaded",this.playAmbientSound,this))},ee.prototype.playMusic=function(){if(this.musicPlayer=new I,Backbone.Mediator.publish("music-player:play-music",{play:!0,file:"/music/music-menu"}),!this.probablyCachedMusic)return j.save("loaded-menu-music",!0)},ee.prototype.checkForCourseOption=function(t){var i,e,n,o,s=function(e){return n.$el.find(".course-version[data-level-original='"+t+"']").removeClass("hidden").data({"course-id":e.get("courseID"),"course-instance-id":e.id})};return null!=(n=this).courseInstance?s(this.courseInstance):null!=(e=me.get("courseInstances"))&&e.length&&(null==this.courseOptionsChecked&&(this.courseOptionsChecked={}),!this.courseOptionsChecked[t])?(this.courseOptionsChecked[t]=!0,(i=new d([],{url:"/db/course_instance/-/find_by_level/"+t,model:g})).comparator=function(e){return-(null!=(e=e.get("members"))?e:[]).length},this.supermodel.loadCollection(i,"course_instances"),this.listenToOnce(i,"sync",(o=this,function(){var e;if(!o.destroyed&&(e=i.models[0]))return s(e)}))):void 0},ee.prototype.preloadTopHeroes=function(){var e,t,i,n,o,s;if(!window.serverConfig.picoCTF){for(o=[],t=0,i=(n=["captain","knight"]).length;t<i;t++)s="/db/thang.type/"+O.heroes[n[t]]+"/version",this.supermodel.getModel(s)||((e=new O).setURL(s),o.push(this.supermodel.loadModel(e)));return o}},ee.prototype.updateVolume=function(e){var t;if(null==e&&(e=null!=(t=me.get("volume"))?t:1),(t=w("#volume-button",this.$el)).toggleClass("vol-off",e<=0),t.toggleClass("vol-down",0<e&&e<1),t.toggleClass("vol-up",1<=e),H.Sound.volume=1===e?.6:e,e!==me.get("volume")&&(me.set("volume",e),me.patch(),e))return this.playAmbientSound()},ee.prototype.onToggleVolume=function(e){for(var t,i,n=w(e.target).closest("#volume-button"),o=["vol-off","vol-down","vol-up"],e=[0,.4,1],s=t=0,r=o.length;t<r;s=++t){if(n.hasClass(o[s])){i=(s+1)%o.length;break}s===o.length-1&&(i=2)}return this.updateVolume(e[i])},ee.prototype.onClickBack=function(e){return Backbone.Mediator.publish("router:navigate",{route:"/play",viewClass:ee,viewArgs:[{supermodel:this.supermodel}]})},ee.prototype.onClickClearStorage=function(e){return localStorage.clear(),noty({text:"Local storage cleared. Reload to view the original campaign.",layout:"topCenter",timeout:5e3,type:"information"})},ee.prototype.updateHero=function(){var e,t,i,n;if(e=null!=(t=me.get("heroConfig"))?t.thangType:void 0){for(n in i=O.heroes)if(i[n]===e)return void this.$el.find(".player-hero-icon").removeClass().addClass("player-hero-icon "+n);return console.error("CampaignView hero update couldn't find hero slug for original:",e)}},ee.prototype.onClickPortalCampaign=function(e){var e=w(e.target).closest(".campaign, .beta-campaign");if(!e.is(".locked")&&!e.is(".silhouette"))return e=e.data("campaign-slug"),this.isPremiumCampaign(e)&&!me.isPremium()?this.promptForSubscription(e,"premium campaign clicked"):Backbone.Mediator.publish("router:navigate",{route:"/play/"+e,viewClass:ee,viewArgs:[{supermodel:this.supermodel},e]})},ee.prototype.onClickCampaignSwitch=function(e){var t=w(e.target).data("campaign-slug");if(console.log(t,this.isPremiumCampaign(t)),this.isPremiumCampaign(t)&&!me.isPremium())return e.preventDefault(),e.stopImmediatePropagation(),this.promptForSubscription(t,"premium campaign switch clicked")},ee.prototype.loadUserPollsRecord=function(){var e;if(!j.load("ignored-poll"))return e="/db/user.polls.record/-/user/"+me.id,this.userPollsRecord=(new G).setURL(e),e=function(){var e;if(!this.destroyed)return this.userPollsRecord.url=function(){return"/db/user.polls.record/"+this.id},e=new Date(this.userPollsRecord.get("changed")||0),792e5<(e=new Date-e)?this.loadPoll():console.log("Poll will be ready in",(792e5-e)/36e5,"hours.")},this.listenToOnce(this.userPollsRecord,"sync",e),this.userPollsRecord=this.supermodel.loadModel(this.userPollsRecord,null,0).model,this.userPollsRecord.loaded?e.call(this):void 0},ee.prototype.loadPoll=function(e,i){var t,n;if(null==i&&(i=!1),null==e&&(e="/db/poll/"+this.userPollsRecord.id+"/next"),n=(new E).setURL(e),t=function(){var e,t;if(!this.destroyed)return n.url=function(){return"/db/poll/"+this.id},this.poll=n,e=i?1e3:5e3,_.delay((t=this,function(){return"function"==typeof t.activatePoll?t.activatePoll(i):void 0}),e)},e=function(e,t,i){if(404===t.status?console.log("There are no more polls left."):console.error("Couldn't load poll:",t.status,t.statusText),this.poll)return delete this.poll},this.listenToOnce(n,"sync",t),this.listenToOnce(n,"error",e),(n=this.supermodel.loadModel(n,null,0).model).loaded)return t.call(this)},ee.prototype.activatePoll=function(e){var t,i,n;if(null==e&&(e=!1),!this.shouldShow("promotion"))return i=J.i18n(this.poll.attributes,"name"),t=this.$el.find("button.poll").removeClass("hidden").addClass("highlighted").attr({title:i}).addClass("has-tooltip").tooltip({title:i}),"shadow-guard"===me.get("lastLevel")||e?this.showPoll():(t.tooltip("show"),_.delay((n=this,function(){if(null!=t&&t.tooltip("hide"),!n.destroyed)return j.save("ignored-poll",!0,5)}),2e4))},ee.prototype.showPoll=function(){var e,t,i,n,o;return!!this.shouldShow("poll")&&(t=new B({supermodel:this.supermodel,poll:this.poll,userPollsRecord:this.userPollsRecord}),this.openModalView(t),e=this.$el.find("button.poll"),t.on("vote-updated",function(){return e.removeClass("highlighted").tooltip("hide")}),t.once("trigger-next-poll",(i=this,function(e){return i.loadPoll("/db/poll/"+e,!0)})),t.once("trigger-show-live-classes",(n=this,function(){return n.openModalView(new M)})),t.once("trigger-codequest-modal",(o=this,function(){return o.openModalView(new a)})))},ee.prototype.onClickPremiumButton=function(e){var t;return this.openModalView(new V),null!=(t=window.tracker)?t.trackEvent("Show subscription modal",{category:"Subscription",label:"campaignview premium button"}):void 0},ee.prototype.getLoadTrackingTag=function(){var e;return(null!=(e=this.campaign)&&"function"==typeof e.get?e.get("slug"):void 0)||"overworld"},ee.prototype.mergeWithPrerendered=function(e){return!0},ee.prototype.checkForUnearnedAchievements=function(){var g;if(this.campaign&&W.currentView.sessions)return(new t).fetchForCampaign(this.campaign.get("slug"),{data:{project:"related,rewards,name"}}).done((g=this,function(e){var t,i,n,o,s,r,a,l,c,h,u,p,d,m,f;if(!g.destroyed){for(m=_(W.currentView.sessions.models).filter(function(e){return e.get("levelID")}).filter(function(e){return e.get("state")&&e.get("state").complete}).map(function(e){return[e.get("levelID"),e.id]}).value(),f=_.zipObject(m),i=g.getLevels(),m=_(null!=(m=me.get("earned"))?m.levels:void 0).filter(function(e){return i[e]}).map(function(e){return i[e].slug}).filter().value(),l=_.zipObject(m,_.times(m.length,function(){return!0})),n=!1,o=0,s=(a=_.filter(e,function(e){return e.rewards&&e.rewards.levels&&e.rewards.levels.length})).length;o<s;o++)if(t=a[o],i[t.related])for(p=i[t.related].slug,c=0,r=(h=t.rewards.levels).length;c<r;c++)d=h[c],i[d]&&(d=i[d].slug,f[p]&&!l[d]&&((d=new y({achievement:t._id,triggeredBy:f[p],collection:"level.sessions"})).notyErrors=!(n=!0),d.save().error(function(){return console.warn("Achievement NOT complete:",t.name)})));return n&&null!=(u=window.tracker)?u.trackEvent("Fixed Unearned Achievement",{category:"World Map",label:g.terrain}):void 0}}))},ee.prototype.maybeShowPendingAnnouncement=function(){var e,t;return!me.freeOnly()&&(!this.payPalToken&&(!me.isStudent()&&(!k.getHocCampaign()&&(!me.isInHourOfCode()&&(e=window.serverConfig.latestAnnouncement,t=me.get("lastAnnouncementSeen"),"number"==typeof e&&18<(new Date-new Date(me.get("dateCreated")))/36e5&&(t<e||null==t)?(me.set("lastAnnouncementSeen",e),me.save(),null!=(t=window.tracker)&&t.trackEvent("Show announcement modal",{label:e+""}),this.openModalView(new n({announcementId:e}))):void 0)))))},ee.prototype.onClickBrainPopReplayButton=function(){return z.users.resetProgress({userId:me.id}).then(function(){return document.location.reload()})},ee.prototype.getLevels=function(){var e;return null!=this.courseLevels?this.courseLevelsFake:null!=(e=this.campaign)?e.get("levels"):void 0},ee.prototype.applyCourseLogicToLevels=function(e){var t,i,n,o,s,r,a,l,c,h,u,p=null!=(u=this.courseStats.levels.next)?u.get("slug"):void 0;if(p=null==p?null!=(u=this.courseStats.levels.first)?u.get("slug"):void 0:p){for(o=h=null,l=i=!1,a=n=0,s=(t=_.sortBy(e,"courseIdx")).length;n<s;a=++n)r=t[a],c=this.levelStatusMap[r.slug],r.color="rgb(255, 80, 60)",r.disabled=!1,r.slug===p?(r.locked=!1,r.hidden=!1,i=r.next=!0):"started"===c||"complete"===c?(r.hidden=!1,r.locked=!1):r.practice?null!=h&&h.next?(r.hidden=!(null!=h&&h.practice),r.locked=!0):h?(r.hidden=h.hidden,r.locked=h.locked):(r.hidden=!0,r.locked=!0):r.assessment?(r.hidden=!1,r.locked="complete"!==this.levelStatusMap[null!=o?o.slug:void 0]):(r.locked=i,r.hidden=!1),r.noFlag=!r.next,(l=r.slug===this.courseInstance.get("startLockedLevel")?!0:l)&&(r.locked=!0),r.locked?r.color="rgb(193, 193, 193)":r.practice?r.color="rgb(45, 145, 81)":r.assessment&&(r.color="#AD62F8","complete"!==c&&(r.noFlag=!1)),r.unlocksHero=!1,r.unlocksItem=!1,h=r,this.campaign.levelIsPractice(r)||this.campaign.levelIsAssessment(r)||(o=r);return!0}},ee.prototype.shouldShow=function(e){var t,i,n=me.isStudent()||me.isTeacher(),o=me.get("iosIdentifierForVendor")||k.isIPadApp;return"classroom-level-play-button"===e?(t=me.isStudent()&&(this.courseInstance||(null!=(i=me.get("courseInstances"))?i.length:void 0)&&"intro"!==this.campaign.get("slug")),i=me.isTeacher(),(t||i)&&!k.getHocCampaign()):(!features.noAuth||"status-line"!==e)&&("promotion"===e?me.finishedAnyLevels()&&!features.noAds&&!n&&"united-states"===me.get("country")&&"en-US"===me.get("preferredLanguage",!0)&&new Date<new Date(2019,11,20):"status-line"===e||"gems"===e||"level"===e||"xp"===e?me.showGemsAndXp()||!n:"settings"===e||"leaderboard"===e||"back-to-campaigns"===e||"poll"===e||"items"===e||"heros"===e||"achievements"===e||"clans"===e?!n:"back-to-classroom"===e?n&&(!k.getHocCampaign()||"intro"===this.terrain):"videos"===e?me.isStudent()&&(null!=(i=this.course)?i.get("_id"):void 0)===J.courseIDs.INTRODUCTION_TO_COMPUTER_SCIENCE:"buy-gems"===e?!(o||me.freeOnly()||n||!me.canBuyGems()||k.getHocCampaign()&&me.isAnonymous()):"premium"===e?!(me.isPremium()||o||me.freeOnly()||n||k.getHocCampaign()&&me.isAnonymous()||q.hasTemporaryPremiumAccess()):"anonymous-classroom-signup"===e?me.isAnonymous()&&me.level()<8&&me.promptForClassroomSignup()&&!this.editorMode:"amazon-campaign"===e?"game-dev-hoc"===(null!=(n=this.campaign)?n.get("slug"):void 0):"league-arena"!==e||!me.isAnonymous()&&(null!=(e=this.campaign)?e.get("slug"):void 0))},ee.prototype.activeArenas=J.activeArenas,ee)}.call(this,ie(3),ie(17))},1328:function(ee,e,te){!function(n,s){var u,t,o,i,r,a,l,c,h,p,d,m,f,g,y,v,b,e,w,k,x,S,C,T,L,M,D,I,A,R,P,E,B,F,N,U,V,O,G,z,H,W,q,j,$,J,Y,K=function(e,t){return function(){return e.apply(t,arguments)}},X={}.hasOwnProperty,Z=[].indexOf||function(e){for(var t=0,i=this.length;t<i;t++)if(t in this&&this[t]===e)return t;return-1};function Q(e,t){var o,i;this.levelID=t,this.onSubmissionComplete=K(this.onSubmissionComplete,this),this.onWindowResize=K(this.onWindowResize,this),M&&"function"==typeof console.profile&&console.profile(),Q.__super__.constructor.call(this,e),this.courseID=e.courseID||Y.getQueryVariable("course"),this.courseInstanceID=e.courseInstanceID||Y.getQueryVariable("course-instance"),this.isEditorPreview=Y.getQueryVariable("dev"),this.sessionID=Y.getQueryVariable("session")||this.options.sessionID,this.observing=Y.getQueryVariable("observing"),this.opponentSessionID=Y.getQueryVariable("opponent"),null==this.opponentSessionID&&(this.opponentSessionID=this.options.opponent),this.gameUIState=new c,s("flying-focus").remove(),s(window).on("resize",this.onWindowResize),this.isEditorPreview?(this.supermodel.shouldSaveBackups=function(e){return"Level"===(e=e.constructor.className)||"LevelComponent"===e||"LevelSystem"===e||"ThangType"===e},i=this,setTimeout(function(){if(!i.levelLoader)return"function"==typeof i.load?i.load():void 0},100)):(this.load(),this.observing||null!=(e=n.tracker)&&e.trackEvent("Started Level Load",{category:"Play Level",level:this.levelID,label:this.levelID})),this.calcTimeOffset(),this.mandate=this.supermodel.loadModel(new L).model,features.china&&(this.checkTournamentEndInterval=setInterval(this.checkTournamentEnd.bind(this),3e3)),o=["/images/level/code_palette_wood_background.png","/images/level/code_editor_background_border.png"],_.delay(function(){for(var e,t=[],i=0,n=o.length;i<n;i++)e=o[i],t.push(s("<img/>")[0].src=e);return t},1e3)}te(2223),te(2545),te(2547),A=te(618),J=te(2549),q=te(44).me,V=te(1374),Y=te(6),j=te(32),te(167).createAetherOptions,W=te(1430),F=te(1450),d=te(1481),h=te(272),P=te(1684),e=te(2224),x=te(1451),te(1375),te(267),te(619),te(1384),L=te(1412),te(1407),u=te(1390),E=te(1914),c=te(1381),H=te(1373),S=te(2225),I=te(2557),O=te(2227),t=te(2231),f=te(2232),w=te(2613),i=te(2233),C=te(2234),p=te(2235),k=te(2627),m=te(2236),l=te(2237),a=te(2238),G=te(2239),g=te(2646),r=te(2650),D=te(2660),b=te(2241),T=te(1488),o=te(1480),v=te(1942),N=te(2663),y=te(2667),z=te(1743),B=te(2228),$=te(52),te(1415),window.Box2D=te(712),M=!1,U=[2,3],R=[0,2],ee.exports=(function(e,t){for(var i in t)X.call(t,i)&&(e[i]=t[i]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(Q,A),Q.prototype.id="level-view",Q.prototype.template=J,Q.prototype.cache=!1,Q.prototype.shortcutsEnabled=!0,Q.prototype.isEditorPreview=!1,Q.prototype.subscriptions={"level:set-volume":"onSetVolume","level:show-victory":"onShowVictory","level:restart":"onRestartLevel","level:highlight-dom":"onHighlightDOM","level:end-highlight-dom":"onEndHighlight","level:focus-dom":"onFocusDom","level:disable-controls":"onDisableControls","level:enable-controls":"onEnableControls","god:world-load-progress-changed":"onWorldLoadProgressChanged","god:new-world-created":"onNewWorld","god:streaming-world-updated":"onNewWorld","god:infinite-loop":"onInfiniteLoop","level:reload-from-data":"onLevelReloadFromData","level:reload-thang-type":"onLevelReloadThangType","level:started":"onLevelStarted","level:loading-view-unveiling":"onLoadingViewUnveiling","level:loading-view-unveiled":"onLoadingViewUnveiled","level:loaded":"onLevelLoaded","level:session-loaded":"onSessionLoaded","playback:real-time-playback-started":"onRealTimePlaybackStarted","playback:real-time-playback-ended":"onRealTimePlaybackEnded","playback:cinematic-playback-started":"onCinematicPlaybackStarted","playback:cinematic-playback-ended":"onCinematicPlaybackEnded","ipad:memory-warning":"onIPadMemoryWarning","store:item-purchased":"onItemPurchased","tome:manual-cast":"onRunCode"},Q.prototype.events={"click #level-done-button":"onDonePressed","click #stop-real-time-playback-button":function(){return Backbone.Mediator.publish("playback:stop-real-time-playback",{})},"click #stop-cinematic-playback-button":function(){return Backbone.Mediator.publish("playback:stop-cinematic-playback",{})},"click #fullscreen-editor-background-screen":function(e){return Backbone.Mediator.publish("tome:toggle-maximize",{})},"click .contact-link":"onContactClicked","contextmenu #webgl-surface":"onSurfaceContextMenu",click:"onClick"},Q.prototype.onClick=function(){if(n.userIsIdle&&n.idleTracker.onVisible(),this.$("#surface-context-menu-view").is(":visible"))return Backbone.Mediator.publish("level:surface-context-menu-hide",{})},Q.prototype.shortcuts={"ctrl+s":"onCtrlS",esc:"onEscapePressed"},Q.prototype.getMeta=function(){return{link:[{vmid:"rel-canonical",rel:"canonical",content:"/play"}]}},Q.prototype.setLevel=function(e,t){return this.level=e,this.supermodel.models=t.models,this.supermodel.collections=t.collections,this.supermodel.shouldSaveBackups=t.shouldSaveBackups,e=this.level.serialize({supermodel:this.supermodel,session:this.session,otherSession:this.otherSession,headless:!1,sessionless:!1}),q.constrainHeroHealth()&&(e.constrainHeroHealth=!0),null!=(t=this.god)&&t.setLevel(e),this.world?this.world.loadFromLevel(e,!1):this.load()},Q.prototype.load=function(){var e;return this.loadStartTime=new Date,e={supermodel:this.supermodel,levelID:this.levelID,sessionID:this.sessionID,opponentSessionID:this.opponentSessionID,team:Y.getQueryVariable("team"),observing:this.observing,courseID:this.courseID,courseInstanceID:this.courseInstanceID},q.isSessionless()&&(e.fakeSessionConfig={}),console.debug("PlayLevelView: Create LevelLoader"),this.levelLoader=new x(e),this.listenToOnce(this.levelLoader,"world-necessities-loaded",this.onWorldNecessitiesLoaded),this.listenTo(this.levelLoader,"world-necessity-load-failed",this.onWorldNecessityLoadFailed)},Q.prototype.hasAccessThroughClan=function(e){return _.intersection(null!=(e=e.get("clans"))?e:[],null!=(e=q.get("clans"))?e:[]).length},Q.prototype.onLevelLoaded=function(e){var t;if(!this.destroyed)return _.all([(q.isStudent()||q.isTeacher())&&!n.getHocCampaign(),!this.courseID,!e.level.isType("course-ladder","ladder"),!this.hasAccessThroughClan(e.level),"peasants-and-munchkins"!==(t=e.level.get("slug"))&&"game-dev-2-tournament-project"!==t&&"game-dev-3-tournament-project"!==t])?_.defer(function(){return n.router.redirectHome()}):(e.level.isType("web-dev")||(this.god=new d({gameUIState:this.gameUIState,indefiniteLength:e.level.isType("game-dev")})),this.waitingToSetUpGod&&this.setupGod(),this.levelSlug=e.level.get("slug"))},Q.prototype.checkTournamentEnd=function(){var e,t,i;if(this.timeOffset&&this.mandate.loaded&&this.levelSlug&&"course-ladder"===this.level.get("type"))return e=this.courseInstanceID||Y.getQueryVariable("league"),i=2,(t=this.mandate.get("0"))&&(i=this.getTournamentState(t,e,this.levelSlug,this.timeOffset),q.isAdmin()||0<=Z.call(U,i)||(window.location.href="/play/ladder/"+this.levelSlug+(e?"/course/"+e:""))),0<=Z.call(R,i)?clearInterval(this.checkTournamentEndInterval):void 0},Q.prototype.getTournamentState=function(e,t,i,n){var o,s=_.find(e.currentTournament||[],function(e){return e.courseInstanceID===t&&e.level===i});return s?(n=(Date.now()+n)/1e3,console.log("Current time:",new Date(1e3*n)),n<s.startAt?(o=s.startAt-n,console.log("Tournament will start at: "+new Date(1e3*s.startAt)+", Time left: "+parseInt(o/60/60)+":"+parseInt(o/60)%60+":"+parseInt(o)%60),1):n>s.endAt?(console.log("Tournament ended at: "+new Date(1e3*s.endAt)),0):(o=s.endAt-n,console.log("Tournament will end at: "+new Date(1e3*s.endAt)+", Time left: "+parseInt(o/60/60)+":"+parseInt(o/60)%60+":"+parseInt(o)%60),3)):0<=Z.call(e.tournamentOnlyLevels||[],i)?0:2},Q.prototype.calcTimeOffset=function(){return s.ajax({type:"HEAD",success:(n=this,function(e,t,i){return n.timeOffset=new Date(i.getResponseHeader("Date")).getTime()-Date.now()})});var n},Q.prototype.trackLevelLoadEnd=function(){var e;if(!this.isEditorPreview)return this.loadEndTime=new Date,this.loadDuration=this.loadEndTime-this.loadStartTime,console.debug("Level unveiled after "+(this.loadDuration/1e3).toFixed(2)+"s"),this.observing||this.isEditorPreview?void 0:(null!=(e=n.tracker)&&e.trackEvent("Finished Level Load",{category:"Play Level",label:this.levelID,level:this.levelID,loadDuration:this.loadDuration}),null!=(e=n.tracker)?e.trackTiming(this.loadDuration,"Level Load Time",this.levelID,this.levelID):void 0)},Q.prototype.isCourseMode=function(){return this.courseID&&this.courseInstanceID},Q.prototype.getRenderData=function(){var e=Q.__super__.getRenderData.call(this);return e.world=this.world,e},Q.prototype.toggleSpellPalette=function(){return this.$el.toggleClass("no-api"),s(window).trigger("resize")},Q.prototype.afterRender=function(){var e;if(Q.__super__.afterRender.call(this),"function"==typeof window.onPlayLevelViewLoaded&&window.onPlayLevelViewLoaded(this),this.insertSubView(this.loadingView=new S({autoUnveil:this.options.autoUnveil||this.observing,level:null!=(e=null!=(e=this.levelLoader)?e.level:void 0)?e:this.level,session:null!=(e=null!=(e=this.levelLoader)?e.session:void 0)?e:this.session})),this.$el.find("#level-done-button").hide(),s("body").addClass("is-playing"),this.isIPadApp())return s("body").bind("touchmove",!1)},Q.prototype.afterInsert=function(){return Q.__super__.afterInsert.call(this)},Q.prototype.onWorldNecessitiesLoaded=function(){var e,t;return console.debug("PlayLevelView: world necessities loaded"),this.grabLevelLoaderData(),this.setMeta({title:s.i18n.t("play.level_title",{level:this.level.get("name")})}),this.level.isType("ladder")||(t=null!=(e=this.world)?e.teamForPlayer():void 0),t=null!=(t=null!=(e=null!=(e=Y.getQueryVariable("team"))?e:this.session.get("team"))?e:t)?t:"humans",this.loadOpponentTeam(t),this.setupGod(),this.setTeam(t),this.initGoalManager(),this.insertSubviews(),this.initVolume(),this.register(),this.controlBar.setBus(this.bus),this.initScriptManager()},Q.prototype.onWorldNecessityLoadFailed=function(e){return this.loadingView.onLoadError(e)},Q.prototype.grabLevelLoaderData=function(){var e;if(this.session=this.levelLoader.session,this.level=this.levelLoader.level,$.commit("game/setLevel",this.level.attributes),!this.level.isType("web-dev")){if(this.world=this.levelLoader.world,this.level.isType("game-dev")&&(this.$el.addClass("game-dev"),this.howToPlayText=Y.i18n(this.level.attributes,"studentPlayInstructions"),null==this.howToPlayText&&(this.howToPlayText=s.i18n.t("play_game_dev_level.default_student_instructions")),this.howToPlayText=marked(this.howToPlayText,{sanitize:!0}),this.renderSelectors("#how-to-play-game-dev-panel")),!_.any(this.world.thangs,function(e){return e.programmableProperties&&0<=Z.call(e.programmableProperties,"findFlags")||(null!=(e=e.inventory)?e.flag:void 0)})&&"sky-span"!==this.level.get("slug")||this.$el.addClass("flags"),this.otherSession=this.levelLoader.opponentSession,!this.level.isType("game-dev"))for(this.worldLoadFakeResources=[],e=1;e<=100;++e)this.worldLoadFakeResources.push(this.supermodel.addSomethingResource(1));return this.renderSelectors("#stop-real-time-playback-button")}this.$el.addClass("web-dev")},Q.prototype.onWorldLoadProgressChanged=function(e){var t,i,n;if(e.god===this.god&&this.worldLoadFakeResources){for(null==this.lastWorldLoadPercent&&(this.lastWorldLoadPercent=0),e=Math.floor(100*e.progress),i=t=this.lastWorldLoadPercent+1,n=e;t<=n;i=t+=1)this.worldLoadFakeResources[i-1].markLoaded();return 100===(this.lastWorldLoadPercent=e)?this.worldFakeLoadResources=null:void 0}},Q.prototype.loadOpponentTeam=function(e){var t,i,n,o,s,r,a,l,c,h,u=[],p=Y.teamSpells;for(l in p)c=p[l],l!==e&&e&&(u=u.concat(c));for(this.session.get("teamSpells")||this.session.set("teamSpells",Y.teamSpells),o=(null!=(s=this.otherSession)?s.get("code"):void 0)||{},n=this.session.get("code")||{},t=0,i=u.length;t<i;t++)h=(r=(a=u[t]).split("/"))[0],a=r[1],r=null!=(r=o[h])?r[a]:void 0,null==n[h]&&(n[h]={}),r?n[h][a]=r:delete n[h][a];return this.session.set("code",n)},Q.prototype.setupGod=function(){var e;if(!this.level.isType("web-dev"))return this.god?(this.waitingToSetUpGod=void 0,e=this.level.serialize({supermodel:this.supermodel,session:this.session,otherSession:this.otherSession,headless:!1,sessionless:!1}),q.constrainHeroHealth()&&(e.constrainHeroHealth=!0),this.god.setLevel(e),this.god.setLevelSessionIDs(this.otherSession?[this.session.id,this.otherSession.id]:[this.session.id]),this.god.setWorldClassMap(this.world.classMap)):this.waitingToSetUpGod=!0},Q.prototype.setTeam=function(e){return _.isString(e)||(e=null!=e?e.team:void 0),q.team=e=null==e?"humans":e,this.session.set("team",e),Backbone.Mediator.publish("level:team-set",{team:e}),this.team=e},Q.prototype.initGoalManager=function(){var e={};return"cumulative"===this.level.get("assessment")&&(e.minGoalsToComplete=1),this.goalManager=new h(this.world,this.level.get("goals"),this.team,e),null!=(e=this.god)?e.setGoalManager(this.goalManager):void 0},Q.prototype.updateGoals=function(e){return this.level.set("goals",e),this.goalManager.destroy(),this.initGoalManager()},Q.prototype.updateSpellPalette=function(e,t){var i;if(e&&(null!=(i=this.spellPaletteView)?i.thang:void 0)!==e&&(e.programmableProperties||e.apiProperties||e.programmableHTMLProperties))return i=/hero/.test(t.getSource())||!/(self[\.\:]|this\.|\@)/.test(t.getSource()),this.spellPaletteView&&this.removeSubview(this.spellPaletteView),this.spellPaletteView=this.insertSubView(new B({thang:e,supermodel:this.supermodel,programmable:null!=t?t.canRead():void 0,language:null!=(t=null!=t?t.language:void 0)?t:this.session.get("codeLanguage"),session:this.session,level:this.level,courseID:this.courseID,courseInstanceID:this.courseInstanceID,useHero:i}))},Q.prototype.insertSubviews=function(){var e;if(this.hintsState=new y({hidden:!0},{session:this.session,level:this.level,supermodel:this.supermodel}),$.commit("game/setHintsVisible",!1),this.hintsState.on("change:hidden",function(e,t){return $.commit("game/setHintsVisible",!t)}),this.insertSubView(this.tome=new O({levelID:this.levelID,session:this.session,otherSession:this.otherSession,playLevelView:this,thangs:null!=(e=null!=(e=this.world)?e.thangs:void 0)?e:[],supermodel:this.supermodel,level:this.level,observing:this.observing,courseID:this.courseID,courseInstanceID:this.courseInstanceID,god:this.god,hintsState:this.hintsState})),this.level.isType("web-dev")||this.insertSubView(new C({session:this.session,level:this.level})),this.insertSubView(new p({level:this.level,session:this.session})),this.$el.hasClass("flags")&&this.insertSubView(new k({levelID:this.levelID,world:this.world})),e="wakka-maul"===(e=this.level.get("slug"))||"cross-bones"===e,this.level.isType("web-dev","game-dev")||e||this.insertSubView(new m({})),this.level.isType("game-dev")&&this.insertSubView(new l({})),this.level.isType("web-dev")||this.insertSubView(new f({level:this.level})),this.insertSubView(new w({level:this.level,sessionID:this.session.id})),this.insertSubView(new t({levelID:this.levelID,sessionID:this.session.id,session:this.session})),this.insertSubView(new I({session:this.session,level:this.level,supermodel:this.supermodel})),this.insertSubView(new N({session:this.session,level:this.level})),this.level.isLadder()&&this.insertSubView(new a({level:this.level,session:this.session,otherSession:this.otherSession,supermodel:this.supermodel,thangs:this.world.thangs,showsGold:e})),this.insertSubView(this.controlBar=new i({worldName:Y.i18n(this.level.attributes,"name"),session:this.session,level:this.level,supermodel:this.supermodel,courseID:this.courseID,courseInstanceID:this.courseInstanceID})),this.insertSubView(this.hintsView=new v({session:this.session,level:this.level,hintsState:this.hintsState}),this.$(".hints-view")),this.level.isType("web-dev"))return this.insertSubView(this.webSurface=new z({level:this.level,goalManager:this.goalManager}))},Q.prototype.initVolume=function(){var e=q.get("volume");return null==e&&(e=1),Backbone.Mediator.publish("level:set-volume",{volume:e})},Q.prototype.initScriptManager=function(){if(!this.level.isType("web-dev"))return this.scriptManager=new P({scripts:this.world.scripts||[],view:this,session:this.session,levelID:this.level.get("slug")}),this.scriptManager.loadFromSession()},Q.prototype.register=function(){return this.bus=e.get(this.levelID,this.session.id),this.bus.setSession(this.session),this.bus.setSpells(this.tome.spells)},Q.prototype.onSessionLoaded=function(t){var e,i;if(console.log("PlayLevelView: loaded session",t.session),$.commit("game/setTimesCodeRun",t.session.get("timesCodeRun")||0),$.commit("game/setTimesAutocompleteUsed",t.session.get("timesAutocompleteUsed")||0),!this.session)return Backbone.Mediator.publish("ipad:language-chosen",{language:null!=(e=t.session.get("codeLanguage"))?e:"python"}),t.level.isType("hero","hero-ladder","hero-coop")&&!_.size(null!=(e=null!=(e=t.session.get("heroConfig"))?e.inventory:void 0)?e:{})&&"open-ended"!==t.level.get("assessment")?_.defer((i=this,function(){var e;if(!i.destroyed&&!_.size(null!=(e=null!=(e=t.session.get("heroConfig"))?e.inventory:void 0)?e:{}))return null!=(e=i.setupManager)&&e.destroy(),i.setupManager=new T({supermodel:i.supermodel,level:t.level,levelID:i.levelID,parent:i,session:t.session,courseID:i.courseID,courseInstanceID:i.courseInstanceID}),i.setupManager.open()})):void 0},Q.prototype.onLoaded=function(){return _.defer((e=this,function(){return"function"==typeof e.onLevelLoaderLoaded?e.onLevelLoaderLoaded():void 0}));var e},Q.prototype.onLevelLoaderLoaded=function(){var e;if(1===this.levelLoader.progress())return this.observing||this.isEditorPreview||this.levelLoader.level.isType("ladder-tutorial")||(q.set("lastLevel",this.levelID),q.save(),null!=(e=n.tracker)&&e.identify()),this.otherSession&&this.saveRecentMatch(),this.levelLoader.destroy(),this.levelLoader=null,this.level.isType("web-dev")?Backbone.Mediator.publish("level:started",{}):this.initSurface()},Q.prototype.saveRecentMatch=function(){var e=null!=(t=j.load("recently-played-matches"))?t:{},t=null!=(t=e[this.levelID])?t:[];return e[this.levelID]=t,_.find(t,{otherSessionID:this.otherSession.id})||t.unshift({yourTeam:q.team,otherSessionID:this.otherSession.id,opponentName:this.otherSession.get("creatorName")}),t.splice(8),j.save("recently-played-matches",e)},Q.prototype.initSurface=function(){var e=s("canvas#webgl-surface",this.$el),t=s("canvas#normal-surface",this.$el),i={thangTypes:this.supermodel.getModels(V),observing:this.observing,playerNames:this.findPlayerNames(),levelType:this.level.get("type",!0),gameUIState:this.gameUIState,level:this.level};return this.surface=new F(this.world,t,e,i),i=[{x:(i=this.world.getBounds()).left,y:i.top},{x:i.right,y:i.bottom}],this.surface.camera.setBounds(i),this.surface.camera.zoomTo({x:0,y:0},.1,0),this.listenTo(this.surface,"resize",function(e){e=e.height;return this.$("#stop-real-time-playback-button").css({top:e-30}),this.$("#how-to-play-game-dev-panel").css({height:e})})},Q.prototype.findPlayerNames=function(){var e,t,i,n,o;if(!this.level.isType("ladder","hero-ladder","course-ladder"))return{};for(i={},e=0,t=(n=[this.session,this.otherSession]).length;e<t;e++)null!=(o=n[e])&&o.get("team")&&(i[o.get("team")]=o.get("creatorName")||"Anonymous");return i},Q.prototype.onLevelStarted=function(){var e;if(null!=this.surface||null!=this.webSurface)return console.log("PlayLevelView: level started"),this.loadingView.showReady(),this.trackLevelLoadEnd(),window.currentModal&&!window.currentModal.destroyed&&-1===[G,r,g].indexOf(window.currentModal.constructor)?Backbone.Mediator.subscribeOnce("modal:closed",this.onLevelStarted,this):(null!=(e=this.surface)&&e.showLevel(),Backbone.Mediator.publish("level:set-time",{time:0}),!this.isEditorPreview&&!this.observing||Y.getQueryVariable("intro")?null!=(e=this.scriptManager)?e.initializeCamera():void 0:(this.loadingView.startUnveiling(),this.loadingView.unveil(!0)))},Q.prototype.onLoadingViewUnveiling=function(e){return this.selectHero()},Q.prototype.onLoadingViewUnveiled=function(e){var t,i;return(this.level.isType("course-ladder","hero-ladder","ladder")||this.observing)&&Backbone.Mediator.publish("level:set-playing",{playing:!0}),this.loadingView.$el.remove(),this.removeSubView(this.loadingView),this.loadingView=null,this.playAmbientSound(),this.observing||this.isEditorPreview||null!=(t=n.tracker)&&t.trackEvent("Started Level",{category:"Play Level",label:this.levelID,levelID:this.levelID,ls:null!=(t=this.session)?t.get("_id"):void 0}),s(window).trigger("resize"),_.delay((i=this,function(){return"function"==typeof i.perhapsStartSimulating?i.perhapsStartSimulating():void 0}),1e4)},Q.prototype.onSetVolume=function(e){if(H.Sound.volume=1===e.volume?.6:e.volume,e.volume&&!this.ambientSound)return this.playAmbientSound()},Q.prototype.playAmbientSound=function(){var e,t;if(!this.destroyed&&!this.ambientSound&&q.get("volume")&&(e={Dungeon:"ambient-dungeon",Grass:"ambient-grass"}[this.level.get("terrain")]))return t="/file/interface/"+e+u.ext,null!=(e=u.getStatus(t))&&e.loaded?(this.ambientSound=H.Sound.play(t,{loop:-1,volume:.1}),H.Tween.get(this.ambientSound).to({volume:1},1e4)):(u.preloadSound(t),void Backbone.Mediator.subscribeOnce("audio-player:loaded",this.playAmbientSound,this))},Q.prototype.selectHero=function(){var e;return Backbone.Mediator.publish("level:suppress-selection-sounds",{suppress:!0}),Backbone.Mediator.publish("tome:select-primary-sprite",{}),Backbone.Mediator.publish("level:suppress-selection-sounds",{suppress:!1}),null!=(e=this.surface)?e.focusOnHero():void 0},Q.prototype.perhapsStartSimulating=function(){var e,t,n,i,o;if(this.shouldSimulate()){for(o=[],e=0,i=(n=["javascript","python","coffeescript","lua"]).length;e<i;e++)t=n[e],o.push(function(i){return function(t){return W(t).then(function(e){if(!(n=_.without(n,t)).length)return i.simulateNextGame()})}}(this)(t));return o}},Q.prototype.simulateNextGame=function(){var e,t,i;return this.simulator||(t={background:!0,leagueID:this.courseInstanceID},this.level.isLadder()&&(t.levelID=this.level.get("slug")),this.simulator=new E(t),e=this.simulator.fetchAndSimulateOneGame,this.simulator.fetchAndSimulateOneGame=(i=this,function(){return 10<=i.simulator.simulatedByYou?(console.log("------------------- Destroying Simulator and making a new one -----------------"),i.simulator.destroy(),i.simulator=null,i.simulateNextGame()):e.apply(i.simulator)})),this.simulator.fetchAndSimulateOneGame()},Q.prototype.shouldSimulate=function(){return!0===Y.getQueryVariable("simulate")},Q.prototype.onCtrlS=function(e){return e.preventDefault()},Q.prototype.onEscapePressed=function(e){return this.$el.hasClass("real-time")?Backbone.Mediator.publish("playback:stop-real-time-playback",{}):this.$el.hasClass("cinematic")?Backbone.Mediator.publish("playback:stop-cinematic-playback",{}):void 0},Q.prototype.onLevelReloadFromData=function(e){var t,i,n,o=Boolean(this.world);if(o)for(n in i=this.supermodel.models)t=i[n],e.supermodel.models[n]||e.supermodel.registerModel(t);if(this.setLevel(e.level,e.supermodel),o)return this.scriptManager.setScripts(e.level.get("scripts")),this.updateGoals(e.level.get("goals")),Backbone.Mediator.publish("tome:cast-spell",{})},Q.prototype.onLevelReloadThangType=function(e){var t,i,n,o,s,r=e.thangType,a=this.supermodel.models;for(o in a)if((i=a[o]).id===r.id){for(t in n=r.attributes)s=n[t],i.attributes[t]=s;break}return Backbone.Mediator.publish("tome:cast-spell",{})},Q.prototype.onWindowResize=function(e){return this.endHighlight()},Q.prototype.onDisableControls=function(e){if(!e.controls||0<=Z.call(e.controls,"level"))return this.shortcutsEnabled=!1,this.wasFocusedOn=document.activeElement,s("body").focus()},Q.prototype.onEnableControls=function(e){if(null==e.controls||0<=Z.call(e.controls,"level"))return this.shortcutsEnabled=!0,this.wasFocusedOn&&s(this.wasFocusedOn).focus(),this.wasFocusedOn=null},Q.prototype.onDonePressed=function(){return this.showVictory()},Q.prototype.onShowVictory=function(e){var t,i;if(null==e&&(e={}),this.level.isType("hero","hero-ladder","hero-coop","course","course-ladder","game-dev","web-dev","ladder")||s("#level-done-button").show(),e.showModal&&this.showVictory(_.pick(e,"manual")),!this.victorySeen)return this.victorySeen=!0,i=new Date-this.loadEndTime,!this.observing&&!this.isEditorPreview&&1e4<i?(null!=(e=n.tracker)&&e.trackEvent("Saw Victory",{category:"Play Level",level:this.level.get("name"),label:this.level.get("name"),levelID:this.levelID,ls:null!=(t=this.session)?t.get("_id"):void 0,playtime:null!=(t=this.session)?t.get("playtime"):void 0}),null!=(t=n.tracker)?t.trackTiming(i,"Level Victory Time",this.levelID,this.levelID):void 0):void 0},Q.prototype.showVictory=function(e){var t,i;if((null==e&&(e={}),!this.level.hasLocalChanges())&&((!this.level.isType("game-dev")||!this.level.get("shareable")||e.manual)&&!this.showVictoryHandlingInProgress))return this.showVictoryHandlingInProgress=!0,this.endHighlight(),e={level:this.level,supermodel:this.supermodel,session:this.session,hasReceivedMemoryWarning:this.hasReceivedMemoryWarning,courseID:this.courseID,courseInstanceID:this.courseInstanceID,world:this.world,parent:this},t=this.level.isType("hero","hero-ladder","hero-coop","course","course-ladder","game-dev","web-dev","ladder")?g:G,(this.isCourseMode()||q.isSessionless())&&(t=r),this.level.isType("course-ladder")&&(t=r,e.courseInstanceID=Y.getQueryVariable("course-instance")||Y.getQueryVariable("league")),e=new(t=window.serverConfig.picoCTF?D:t)(e),this.openModalView(e),e.once("hidden",(i=this,function(){return i.showVictoryHandlingInProgress=!1})),q.get("anonymous")?window.nextURL="/play/"+(null!=(e=this.level.get("campaign"))?e:""):void 0},Q.prototype.onRestartLevel=function(){var e;if(this.tome.reloadAllCode(),Backbone.Mediator.publish("level:restarted",{}),s("#level-done-button",this.$el).hide(),!this.observing&&!this.isEditorPreview)return null!=(e=n.tracker)?e.trackEvent("Confirmed Restart",{category:"Play Level",level:this.level.get("name"),label:this.level.get("name")}):void 0},Q.prototype.onInfiniteLoop=function(e){var t;if(e.firstWorld&&e.god===this.god)return this.openModalView(new b({nonUserCodeProblem:e.nonUserCodeProblem})),!this.observing&&!this.isEditorPreview&&null!=(t=n.tracker)?t.trackEvent("Saw Initial Infinite Loop",{category:"Play Level",level:this.level.get("name"),label:this.level.get("name")}):void 0},Q.prototype.onHighlightDOM=function(e){return this.highlightElement(e.selector,{delay:e.delay,sides:e.sides,offset:e.offset,rotation:e.rotation})},Q.prototype.onEndHighlight=function(){return this.endHighlight()},Q.prototype.onFocusDom=function(e){return s(e.selector).focus()},Q.prototype.onContactClicked=function(e){var t,i,n;if(!q.isStudent())return Backbone.Mediator.publish("level:contact-button-pressed",{}),this.openModalView(i=new o({levelID:this.level.get("slug")||this.level.id,courseID:this.courseID,courseInstanceID:this.courseInstanceID})),t={b64png:(n=this.surface.screenshot(1,"image/png",1,1)).replace("data:image/png;base64,",""),filename:"screenshot-"+this.levelID+"-"+_.string.slugify((new Date).toString())+".png",path:"db/user/"+q.id,mimetype:"image/png"},i.screenshotURL="http://codecombat.com/file/"+t.path+"/"+t.filename,window.screenshot=n,window.screenshotURL=i.screenshotURL,s.ajax("/file",{type:"POST",data:t,success:function(e){return"function"==typeof i.updateScreenshot?i.updateScreenshot():void 0}});console.error("Student clicked contact modal.")},Q.prototype.onSurfaceContextMenu=function(e){var t;if(null!=e&&"function"==typeof e.preventDefault&&e.preventDefault(),!this.$el.hasClass("real-time")&&this.surface.showCoordinates&&(navigator.clipboard||document.queryCommandSupported("copy")))return t={x:e.clientX,y:e.clientY},e=this.surface.coordinateDisplay.lastPos,Backbone.Mediator.publish("level:surface-context-menu-pressed",{posX:t.x,posY:t.y,wopX:e.x,wopY:e.y})},Q.prototype.onNewWorld=function(e){var t,i,n,o,s,r,a,l,c,h;if(!this.headless){for(l=this.world.scripts,this.world=e.world,0<this.world.age&&this.willUpdateStudentGoals&&(this.willUpdateStudentGoals=!1,this.updateStudentGoals(),this.updateLevelName()),this.world.scripts=l,h=this.supermodel.getModels(V),l=null!=(o=this.lastWorldFramesLoaded)?o:0,o=this.world.frames.length===this.world.totalFrames,this.realTimePlaybackWaitingForFrames=!1,o?(this.lastWorldFramesLoaded=0,this.waitingForSubmissionComplete&&(_.defer(this.onSubmissionComplete),this.waitingForSubmissionComplete=!1)):this.lastWorldFramesLoaded=this.world.frames.length,t=0,i=(s=this.world.thangDialogueSounds(l)).length;t<i;t++)c=s[t],a=c[0],n=c[1],(c=_.find(h,function(e){return e.get("name")===a}))&&(r=u.soundForDialogue(n,c.get("soundTriggers")))&&u.preloadSoundReference(r);return this.level.isType("game-dev")?this.session.updateKeyValueDb(e.keyValueDb):void 0}},Q.prototype.onRealTimePlaybackStarted=function(e){return this.$el.addClass("real-time").focus(),this.willUpdateStudentGoals=!0,this.updateStudentGoals(),this.updateLevelName(),this.onWindowResize(),this.realTimePlaybackWaitingForFrames=!0},Q.prototype.updateStudentGoals=function(){var e,t;if(this.level.isType("game-dev"))return null!=(e=this.world.uiText)&&(null!=(t=e.directions)&&t.length)?this.studentGoals=this.world.uiText.directions.map(function(e){return{type:"user_defined",direction:e}}):this.studentGoals=null!=(t=this.world.thangMap["Hero Placeholder"].stringGoals)?t.map(function(e){return JSON.parse(e)}):void 0,this.renderSelectors("#how-to-play-game-dev-panel"),this.$("#how-to-play-game-dev-panel").removeClass("hide")},Q.prototype.updateLevelName=function(){var e;if(null!=(e=this.world.uiText)&&e.levelName)return this.controlBar.setLevelName(this.world.uiText.levelName)},Q.prototype.onRealTimePlaybackEnded=function(e){var t;if(this.$el.hasClass("real-time"))return this.level.isType("game-dev")&&this.$("#how-to-play-game-dev-panel").addClass("hide"),this.$el.removeClass("real-time"),this.onWindowResize(),this.level.isType("game-dev")&&this.session.saveKeyValueDb(),this.world.frames.length!==this.world.totalFrames||null!=(t=this.surface.countdownScreen)&&t.showing||this.realTimePlaybackWaitingForFrames?this.waitingForSubmissionComplete=!0:_.delay(this.onSubmissionComplete,750)},Q.prototype.onCinematicPlaybackStarted=function(e){return this.$el.addClass("cinematic").focus(),this.onWindowResize()},Q.prototype.onCinematicPlaybackEnded=function(e){if(this.$el.hasClass("cinematic"))return this.$el.removeClass("cinematic"),this.onWindowResize()},Q.prototype.onSubmissionComplete=function(){var e;if(!this.destroyed&&(Backbone.Mediator.publish("level:set-time",{ratio:1}),!this.level.hasLocalChanges()))return"success"===this.goalManager.checkOverallStatus()?(e=function(){return Backbone.Mediator.publish("level:show-victory",{showModal:!0})},this.session.recordScores(this.world.scores,this.level),this.level.get("replayable")?this.session.increaseDifficulty(e):e()):void 0},Q.prototype.destroy=function(){var e,t;return null!=(t=this.levelLoader)&&t.destroy(),null!=(t=this.surface)&&t.destroy(),null!=(t=this.god)&&t.destroy(),null!=(t=this.goalManager)&&t.destroy(),null!=(t=this.scriptManager)&&t.destroy(),null!=(t=this.setupManager)&&t.destroy(),null!=(t=this.simulator)&&t.destroy(),(e=this.ambientSound)&&H.Tween.get(e).to({volume:0},1500).call(function(){return e.stop()}),s(window).off("resize",this.onWindowResize),delete window.world,null!=(t=this.bus)&&t.destroy(),delete window.nextURL,M&&"function"==typeof console.profileEnd&&console.profileEnd(),this.checkTournamentEndInterval&&clearInterval(this.checkTournamentEndInterval),Backbone.Mediator.unsubscribe("modal:closed",this.onLevelStarted,this),Backbone.Mediator.unsubscribe("audio-player:loaded",this.playAmbientSound,this),Q.__super__.destroy.call(this)},Q.prototype.onIPadMemoryWarning=function(e){return this.hasReceivedMemoryWarning=!0},Q.prototype.onItemPurchased=function(e){var t=null!=(t=(null!=(t=this.session.get("heroConfig"))?t:{}).inventory)?t:{},e=e.item.getAllowedSlots()[0];if(e&&!t[e])return null!=(e=this.setupManager)&&e.destroy(),this.setupManager=new T({supermodel:this.supermodel,level:this.level,levelID:this.levelID,parent:this,session:this.session,hadEverChosenHero:!0}),this.setupManager.open()},Q.prototype.getLoadTrackingTag=function(){var e;return null!=(e=this.level)?e.get("slug"):void 0},Q.prototype.onRunCode=function(){return $.commit("game/incrementTimesCodeRun")},Q)}.call(this,te(17),te(3))},1329:function(e,t,i){var n,o,s,r={}.hasOwnProperty;function a(){return a.__super__.constructor.apply(this,arguments)}o=i(1406),n=i(1947).default,s=i(6),e.exports=(function(e,t){for(var i in t)r.call(t,i)&&(e[i]=t[i]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(a,o),a.prototype.id="play-level-video-view",a.prototype.template=i(1400),a.prototype.VueComponent=n,a.prototype.skipMetaBinding=!0,a.prototype.initialize=function(e,t){return this.levelID=t,null==this.propsData&&(this.propsData={}),this.propsData.levelSlug=this.levelID,this.propsData.courseID=s.getQueryVariable("course"),this.propsData.courseInstanceID=s.getQueryVariable("course-instance"),this.propsData.codeLanguage=s.getQueryVariable("codeLanguage"),this.propsData.levelOriginalID=s.getQueryVariable("level"),a.__super__.initialize.call(this,e)},a.prototype.destroy=function(){return"function"==typeof this.onDestroy&&this.onDestroy(),a.__super__.destroy.call(this)},a)},1330:function(t,e,n){!function(l){var c,h,i,u,p,d,m,f,g,e,y,v,b,w,k,x,S,C,T,o={}.hasOwnProperty;function L(){return L.__super__.constructor.apply(this,arguments)}n(2668),e=n(618),u=n(1381),d=n(1481),f=n(1451),p=n(272),y=n(1684),b=n(1450),k=n(1374),m=n(267),g=n(1375),v=n(57),T=n(6),C=n(1421),c=n(1376),i=n(2670),x=n(167),h=n(2237),S=n(46),n(1415),window.Box2D=n(712),w="humans",t.exports=(function(e,t){for(var i in t)o.call(t,i)&&(e[i]=t[i]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(L,e),L.prototype.id="play-game-dev-level-view",L.prototype.template=n(2674),L.prototype.subscriptions={"god:new-world-created":"onNewWorld","god:streaming-world-updated":"onStreamingWorldUpdated"},L.prototype.events={"click #edit-level-btn":"onEditLevelButton","click #play-btn":"onClickPlayButton","click #copy-url-btn":"onClickCopyURLButton","click #play-more-codecombat-btn":"onClickPlayMoreCodeCombatButton"},L.prototype.initialize=function(e,t){var i,n,s,o,r,a;return this.options=e,this.sessionID=t,L.__super__.initialize.call(this,this.options),this.state=new v({loading:!0,progress:0,creatorString:"",isOwner:!1}),l(window).keydown(function(e){if(32===e.keyCode&&e.target===document.body)return e.preventDefault()}),T.getQueryVariable("dev")&&(this.supermodel.shouldSaveBackups=function(e){return"Level"===(e=e.constructor.className)||"LevelComponent"===e||"LevelSystem"===e||"ThangType"===e}),this.supermodel.on("update-progress",(i=this,function(e){return i.state.set({progress:(100*e).toFixed(1)+"%"})})),this.level=new m,this.session=new g({_id:this.sessionID}),this.gameUIState=new u,this.courseID=T.getQueryVariable("course"),this.courseInstanceID=T.getQueryVariable("course-instance"),this.god=new d({gameUIState:this.gameUIState,indefiniteLength:!0}),this.supermodel.registerModel(this.session),new Promise((a=this,function(e,t){return a.session.fetch({cache:!1}).then(e,t)})).then(function(e){return S.levels.getByOriginal(e.level.original)}).then((r=this,function(e){return r.levelID=e.slug,r.levelLoader=new f({supermodel:r.supermodel,levelID:r.levelID,sessionID:r.sessionID,observing:!0,team:w,courseID:r.courseID}),r.supermodel.setMaxProgress(1),r.listenTo(r.state,"change",_.debounce(r.renderAllButCanvas)),r.updateDb=_.throttle(r.updateDb,1e3),r.levelLoader.loadWorldNecessities()})).then((o=this,function(e){return o.level=e.level,o.session=e.session,o.world=e.world,o.setMeta({title:l.i18n.t("play.game_development_title",{level:o.level.get("name")})}),o.god.setLevel(o.level.serialize({supermodel:o.supermodel,session:o.session})),o.god.setWorldClassMap(o.world.classMap),o.goalManager=new p(o.world,o.level.get("goals"),o.team),o.god.setGoalManager(o.goalManager),o.god.angelsShare.firstWorld=!1,me.team=w,o.session.set("team",w),o.scriptManager=new y({scripts:o.world.scripts||[],view:o,session:o.session,levelID:o.level.get("slug")}),o.scriptManager.loadFromSession(),o.howToPlayText=T.i18n(o.level.attributes,"studentPlayInstructions"),null==o.howToPlayText&&(o.howToPlayText=l.i18n.t("play_game_dev_level.default_student_instructions")),o.howToPlayText=marked(o.howToPlayText,{sanitize:!0}),o.renderAllButCanvas(),o.supermodel.finishLoading()})).then((s=this,function(e){var o,t,i,n;return s.levelLoader.destroy(),s.levelLoader=null,i=s.$("canvas#webgl-surface"),t=s.$("canvas#normal-surface"),s.surface=new b(s.world,t,i,{thangTypes:s.supermodel.getModels(k),levelType:s.level.get("type",!0),gameUIState:s.gameUIState,resizeStrategy:"wrapper-size"}),s.listenTo(s.surface,"resize",s.onSurfaceResize),t=[{x:(n=s.world.getBounds()).left,y:n.top},{x:n.right,y:n.bottom}],s.surface.camera.setBounds(t),s.surface.camera.zoomTo({x:0,y:0},.1,0),s.surface.setWorld(s.world),s.scriptManager.initializeCamera(),s.renderSelectors("#info-col"),s.spells=x.generateSpellsObject({level:s.level,levelSession:s.session}),i=function(){for(var e=this.goalManager.goals,t=[],i=0,n=e.length;i<n;i++)o=e[i],t.push(T.i18n(o,"name"));return t}.call(s),n=s.courseID?new c({_id:s.courseID}):null,t=C.playDevLevel({level:s.level,session:s.session,course:n}),n=s.session.get("creatorName")?l.i18n.t("play_game_dev_level.created_by").replace("{{name}}",s.session.get("creatorName")):l.i18n.t("play_game_dev_level.created_during_hoc"),s.state.set({loading:!1,goalNames:i,shareURL:t,creatorString:n,isOwner:me.id===s.session.get("creator")}),s.eventProperties={category:"Play GameDev Level",courseID:s.courseID,sessionID:s.session.id,levelID:s.level.id,levelSlug:s.level.get("slug")},null!=(n=window.tracker)&&n.trackEvent("Play GameDev Level - Load",s.eventProperties,["Mixpanel"]),s.level.isType("game-dev")&&s.insertSubView(new h({})),n={spells:s.spells,preload:!1,realTime:!0,justBegin:!1,keyValueDb:null!=(n=s.session.get("keyValueDb"))?n:{},synchronous:!0},s.god.createWorld(n),s.willUpdateFrontEnd=!0})).catch((n=this,function(e){if(e.stack)throw e;return n.state.set("errorMessage",e.message)}))},L.prototype.getMeta=function(){return{links:[{vmid:"rel-canonical",rel:"canonical",href:"/play"}]}},L.prototype.onEditLevelButton=function(){var e="/play/level/"+this.level.get("slug");return this.courseID&&this.courseInstanceID&&(e+="?course="+this.courseID+"&course-instance="+this.courseInstanceID),Backbone.Mediator.publish("router:navigate",{route:e,viewClass:"views/play/level/PlayLevelView",viewArgs:[{},this.levelID]})},L.prototype.onClickPlayButton=function(){var e,t;return l("#play-btn").blur(),t={spells:this.spells,preload:!1,realTime:!0,justBegin:!1,keyValueDb:null!=(e=this.session.get("keyValueDb"))?e:{},synchronous:!0},this.god.createWorld(t),Backbone.Mediator.publish("playback:real-time-playback-started",{}),Backbone.Mediator.publish("level:set-playing",{playing:!0}),e=this.state.get("playing")?"Play GameDev Level - Restart Level":"Play GameDev Level - Start Level",null!=(t=window.tracker)&&t.trackEvent(e,this.eventProperties,["Mixpanel"]),this.state.set("playing",!0)},L.prototype.onClickCopyURLButton=function(){var e;return this.$("#copy-url-input").val(this.state.get("shareURL")).select(),this.tryCopy(),null!=(e=window.tracker)?e.trackEvent("Play GameDev Level - Copy URL",this.eventProperties,["Mixpanel"]):void 0},L.prototype.onClickPlayMoreCodeCombatButton=function(){var e;return null!=(e=window.tracker)?e.trackEvent("Play GameDev Level - Click Play More CodeCombat",this.eventProperties,["Mixpanel"]):void 0},L.prototype.onSurfaceResize=function(e){e=e.height;return this.state.set("surfaceHeight",e)},L.prototype.renderAllButCanvas=function(){if(this.renderSelectors("#info-col","#share-row"),this.state.get("surfaceHeight"))return this.$el.find("#info-col").css("height",this.state.get("surfaceHeight"))},L.prototype.onNewWorld=function(e){var t;if("success"===this.goalManager.checkOverallStatus())return t=new i({shareURL:this.state.get("shareURL"),eventProperties:this.eventProperties,victoryMessage:this.victoryMessage}),this.openModalView(t),t.once("replay",this.onClickPlayButton,this)},L.prototype.updateStudentGoals=function(){var e,t;if(!this.studentGoals&&(null!=(e=this.world.uiText)&&(null!=(e=e.directions)&&e.length)?this.studentGoals=this.world.uiText.directions.map(function(e){return{type:"user_defined",direction:e}}):this.studentGoals=null!=(t=this.world.thangMap["Hero Placeholder"].stringGoals)?t.map(function(e){return JSON.parse(e)}):void 0,_.size(this.studentGoals)))return this.updateRealTimeGoals(),t={spells:this.spells,preload:!1,realTime:!1,justBegin:!0,keyValueDb:null!=(t=this.session.get("keyValueDb"))?t:{}},this.god.createWorld(t)},L.prototype.updateRealTimeGoals=function(e){return null!=e&&(this.studentGoals=null!=e?e.map(function(e){return JSON.parse(e)}):void 0),this.renderSelectors("#directions")},L.prototype.onStreamingWorldUpdated=function(e){return this.world=e.world,0<this.world.age&&this.willUpdateFrontEnd&&(this.willUpdateFrontEnd=!1,this.updateStudentGoals(),this.updateLevelName(),this.updateVictoryMessage()),this.updateDb()},L.prototype.updateLevelName=function(){var e;if(null!=(e=this.world.uiText)&&e.levelName)return this.levelName=this.world.uiText.levelName,this.renderSelectors("#directions")},L.prototype.updateVictoryMessage=function(){var e;if(null!=(e=this.world.uiText)&&e.victoryMessage)return this.victoryMessage=null!=(e=this.world.uiText)?e.victoryMessage:void 0},L.prototype.getLevelName=function(){var e;return null!=(e=this.levelName)?e:this.level.get("name")},L.prototype.updateDb=function(){var e;if(null!=(e=this.state)&&e.get("playing"))return this.surface.world.keyValueDb&&!_.isEqual(this.surface.world.keyValueDb,this.session.attributes.keyValueDb)?(this.session.updateKeyValueDb(_.cloneDeep(this.surface.world.keyValueDb)),this.session.saveKeyValueDb()):void 0},L.prototype.destroy=function(){var e;return null!=(e=this.levelLoader)&&e.destroy(),null!=(e=this.surface)&&e.destroy(),null!=(e=this.god)&&e.destroy(),null!=(e=this.goalManager)&&e.destroy(),null!=(e=this.scriptManager)&&e.destroy(),delete window.world,l(window).off("keydown"),L.__super__.destroy.call(this)},L)}.call(this,n(3))},1331:function(i,e,h){!function(n){var o,s,e,t,r,a,l={}.hasOwnProperty;function c(){return c.__super__.constructor.apply(this,arguments)}h(2675),e=h(618),o=h(267),s=h(1375),t=h(1743),r=h(46),h(1415),a=h(6),i.exports=(function(e,t){for(var i in t)l.call(t,i)&&(e[i]=t[i]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(c,e),c.prototype.id="play-web-dev-level-view",c.prototype.template=h(2677),c.prototype.initialize=function(e,t){return this.options=e,this.sessionID=t,c.__super__.initialize.call(this,this.options),this.courseID=a.getQueryVariable("course"),this.session=this.supermodel.loadModel(new s({_id:this.sessionID})).model,this.level=new o,this.session.once("sync",(i=this,function(){var t=i.supermodel.addSomethingResource("level");return r.levels.getByOriginal(i.session.get("level").original).then(function(e){return i.levelID=e.slug,i.level.set({_id:i.levelID}),i.level.fetch(),i.level.once("sync",function(){return t.markLoaded(),i.setMeta({title:n.i18n.t("play.web_development_title",{level:i.level.get("name")})})})})}));var i},c.prototype.getMeta=function(){return{links:[{vmid:"rel-canonical",rel:"canonical",href:"/play"}]}},c.prototype.onLoaded=function(){var e;return c.__super__.onLoaded.call(this),this.insertSubView(this.webSurface=new t({level:this.level})),Backbone.Mediator.publish("tome:html-updated",{html:null!=(e=this.getHTML())?e:"<h1>Player has no HTML</h1>",create:!0}),this.$el.find("#info-bar").delay(4e3).fadeOut(2e3),n("body").css("overflow","hidden"),this.eventProperties={category:"Play WebDev Level",courseID:this.courseID,sessionID:this.session.id,levelID:this.level.id,levelSlug:this.level.get("slug")},null!=(e=window.tracker)?e.trackEvent("Play WebDev Level - Load",this.eventProperties):void 0},c.prototype.showError=function(e){return n("h1").text(e.statusText)},c.prototype.getHTML=function(){var e,t=null!=(t=this.session.get("code"))&&null!=(e=t["hero-placeholder"])?e.plan:void 0;return(e=_.find(this.level.get("thangs"),{id:"Hero Placeholder"}))&&(e=_.find(e.components,function(e){return null!=(e=e.config)?e.programmableMethods:void 0}).config)?e.programmableMethods.plan.languages.html.replace(/<playercode>[\s\S]*<\/playercode>/,t):t},c.prototype.destroy=function(){var e;return null!=(e=this.webSurface)&&e.destroy(),n("body").css("overflow","initial"),c.__super__.destroy.call(this)},c)}.call(this,h(3))},1332:function(L,e,M){!function(o){var u,t,i,e,n,s,r,a,l,c,h,p,d,m,f,g,y,v,b,w,k,x,S=function(e,t){return function(){return e.apply(t,arguments)}},C={}.hasOwnProperty;function T(e,t){var i;this.levelID=t,this.saveScreenshot=S(this.saveScreenshot,this),this.onSupermodelLoadedOne=S(this.onSupermodelLoadedOne,this),h&&"function"==typeof console.profile&&console.profile(),T.__super__.constructor.call(this,e),this.isEditorPreview=x.getQueryVariable("dev"),this.sessionOne=x.getQueryVariable("session-one"),this.sessionTwo=x.getQueryVariable("session-two"),this.tournament=x.getQueryVariable("tournament"),e.spectateSessions&&(this.sessionOne=e.spectateSessions.sessionOne,this.sessionTwo=e.spectateSessions.sessionTwo),this.isEditorPreview?(this.supermodel.shouldSaveBackups=function(e){return"Level"===(e=e.constructor.className)||"LevelComponent"===e||"LevelSystem"===e||"ThangType"===e},i=this,setTimeout(function(){if(!i.levelLoader)return"function"==typeof i.loadRandomSessions?i.loadRandomSessions():void 0},100)):this.loadRandomSessions()}M(2678),d=M(618),k=M(2680),w=M(44).me,g=M(1374),x=M(6),M(271),f=M(1450),n=M(1481),e=M(272),m=M(1684),l=M(1451),M(1375),M(267),M(619),M(1384),M(1407),u=M(1390),b=M(1373),v=M(1403),c=M(2225),y=M(2227),M(2231),r=M(2232),t=M(2233),p=M(2234),M(2235),s=M(2236),i=M(2238),M(2239),a=M(2241),M(1415),h=!1,L.exports=(function(e,t){for(var i in t)C.call(t,i)&&(e[i]=t[i]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(T,d),T.prototype.id="spectate-level-view",T.prototype.template=k,T.prototype.cache=!1,T.prototype.isEditorPreview=!1,T.prototype.subscriptions={"level:set-volume":function(e){return b.Sound.volume=1===e.volume?.6:e.volume},"god:new-world-created":"onNewWorld","god:streaming-world-updated":"onNewWorld","god:infinite-loop":"onInfiniteLoop","level:next-game-pressed":"onNextGamePressed","level:started":"onLevelStarted","level:loading-view-unveiled":"onLoadingViewUnveiled","level:session-will-save":"onSessionWillSave"},T.prototype.events={"mouseenter .spectate-code":"onMouseEnterSpectateCode","mouseleave .spectate-code":"onMouseLeaveSpectateCode"},T.prototype.loadRandomSessions=function(){return this.sessionOne&&this.sessionTwo?this.load():this.fetchRandomSessionPair((i=this,function(e,t){return null!=e?console.log("There was an error fetching the random session pair: "+t):(i.setSessions(t[0]._id,t[1]._id),i.load())}));var i},T.prototype.setLevel=function(e,t){return this.level=e,this.supermodel=t,e=this.level.serialize({supermodel:this.supermodel,session:this.session,otherSession:this.otherSession,headless:!1,sessionless:!1}),null!=(t=this.god)&&t.setLevel(e),this.world?this.world.loadFromLevel(e,!1):this.load()},T.prototype.load=function(){return this.levelLoader=new l({supermodel:this.supermodel,levelID:this.levelID,sessionID:this.sessionOne,opponentSessionID:this.sessionTwo,tournament:this.tournament,spectateMode:!0,team:x.getQueryVariable("team")}),this.god=new n({maxAngels:1,spectate:!0})},T.prototype.getRenderData=function(){var e=T.__super__.getRenderData.call(this);return e.world=this.world,e},T.prototype.afterRender=function(){var e;return"function"==typeof window.onPlayLevelViewLoaded&&window.onPlayLevelViewLoaded(this),this.insertSubView(this.loadingView=new c({autoUnveil:!0,level:null!=(e=null!=(e=this.levelLoader)?e.level:void 0)?e:this.level})),this.$el.find("#level-done-button").hide(),T.__super__.afterRender.call(this),o("body").addClass("is-playing")},T.prototype.onLoaded=function(){return _.defer((e=this,function(){return e.onLevelLoaderLoaded()}));var e},T.prototype.onLevelLoaderLoaded=function(){return this.grabLevelLoaderData(),this.loadOpponentTeam("humans"),this.god.setLevel(this.level.serialize({supermodel:this.supermodel,session:this.session,otherSession:this.otherSession,headless:!1,sessionless:!1})),this.god.setLevelSessionIDs(this.otherSession?[this.session.id,this.otherSession.id]:[this.session.id]),this.god.setWorldClassMap(this.world.classMap),this.setTeam("humans"),this.initSurface(),this.initGoalManager(),this.initScriptManager(),this.insertSubviews(),this.initVolume(),this.initSpectateCode(),this.originalSessionState=o.extend(!0,{},this.session.get("state")),this.register(),this.controlBar.setBus(this.bus),this.surface.showLevel()},T.prototype.grabLevelLoaderData=function(){return this.session=this.levelLoader.session,this.world=this.levelLoader.world,this.level=this.levelLoader.level,this.otherSession=this.levelLoader.opponentSession,this.levelLoader.destroy(),this.levelLoader=null},T.prototype.loadOpponentTeam=function(e){var t,i,n,o,s,r,a,l,c,h,u,p;for(h in e!==this.session.get("team")&&console.error("Team mismatch. Expected session one to be '"+e+"'. Got '"+this.session.get("team")+"'"),s=[],r=x.teamSpells)u=r[h],h!==e&&e&&(s=s.concat(u));for(o=(null!=(a=this.otherSession)?a.get("code"):void 0)||{},n=this.session.get("code")||{},t=0,i=s.length;t<i;t++)p=(l=(c=s[t]).split("/"))[0],c=l[1],l=null!=(l=o[p])?l[c]:void 0,null==n[p]&&(n[p]={}),l?n[p][c]=l:delete n[p][c];return this.session.set("code",n)},T.prototype.onLevelStarted=function(e){var t;return t=this,_.delay(function(){var e;return null!=(e=t.loadingView)&&e.startUnveiling(),null!=(e=t.loadingView)?e.unveil(!0):void 0},1e3)},T.prototype.onLoadingViewUnveiled=function(e){return Backbone.Mediator.publish("level:set-playing",{playing:!1}),Backbone.Mediator.publish("level:set-time",{time:1})},T.prototype.onSupermodelLoadedOne=function(){return null==this.modelsLoaded&&(this.modelsLoaded=0),this.modelsLoaded+=1,this.updateInitString()},T.prototype.updateInitString=function(){var e,t;if(!this.surface)return null==this.modelsLoaded&&(this.modelsLoaded=0),(t=(e=this.$el.find("#surface")[0]).getContext("2d")).font="20px Georgia",t.clearRect(0,0,e.width,e.height),t.fillText("Loaded "+this.modelsLoaded+" thingies",50,50)},T.prototype.insertSubviews=function(){var e;return this.insertSubView(this.tome=new y({levelID:this.levelID,session:this.session,otherSession:this.otherSession,thangs:this.world.thangs,supermodel:this.supermodel,spectateView:!0,spectateOpponentCodeLanguage:null!=(e=this.otherSession)?e.get("submittedCodeLanguage"):void 0,level:this.level,god:this.god})),this.insertSubView(new p({session:this.session,level:this.level})),(e="wakka-maul"===(e=this.level.get("slug"))||"cross-bones"===e)||this.insertSubView(new s({})),this.insertSubView(new r({level:this.level})),this.level.isLadder()&&this.insertSubView(new i({level:this.level,session:this.session,otherSession:this.otherSession,supermodel:this.supermodel,thangs:this.world.thangs,showsGold:e})),this.insertSubView(this.controlBar=new t({worldName:x.i18n(this.level.attributes,"name"),session:this.session,level:this.level,supermodel:this.supermodel,spectateGame:!0}))},T.prototype.onInfiniteLoop=function(e){if(e.firstWorld&&e.god===this.god)return this.openModalView(new a),null!=(e=window.tracker)?e.trackEvent("Saw Initial Infinite Loop",{level:this.world.name,label:this.world.name}):void 0},T.prototype.initSurface=function(){var t,i,e=o("canvas#webgl-surface",this.$el),n=o("canvas#normal-surface",this.$el);return this.surface=new f(this.world,n,e,{thangTypes:this.supermodel.getModels(g),spectateGame:!0,playerNames:this.findPlayerNames(),levelType:this.level.get("type",!0)}),e=[{x:(t=this.world.getBounds()).left,y:t.top},{x:t.right,y:t.bottom}],this.surface.camera.setBounds(e),i=this,_.delay(function(){var e;return null!=(e=i.surface)?e.camera.zoomTo({x:(t.right-t.left)/2,y:(t.top-t.bottom)/2},.1,0):void 0},4e3)},T.prototype.findPlayerNames=function(){for(var e,t={},i=[this.session,this.otherSession],n=0,o=i.length;n<o;n++)null!=(e=i[n])&&e.get("team")&&(t[e.get("team")]=e.get("creatorName")||"Anonymous");return t},T.prototype.initGoalManager=function(){return this.goalManager=new e(this.world,this.level.get("goals")),this.god.setGoalManager(this.goalManager)},T.prototype.initScriptManager=function(){var e=this.world.scripts?_.reject(this.world.scripts,function(e){return!/(Set Camera Boundaries|Introduction)/.test(e.id)}):(console.log("World scripts don't exist!"),[]);return this.scriptManager=new m({scripts:e,view:this,session:this.session}),this.scriptManager.loadFromSession()},T.prototype.initVolume=function(){var e=w.get("volume");return null==e&&(e=1),Backbone.Mediator.publish("level:set-volume",{volume:e})},T.prototype.initSpectateCode=function(){var e,t,i,n,o,s,r,a;if(!w.isAdmin())return this.$el.find(".spectate-code").remove();for(this.editors={},t=0,i=(n=["humans","ogres"]).length;t<i;t++)r="humans"===(a=n[t])?this.session:this.otherSession,this.$el.find(".spectate-code.team-"+a+" .programming-language").text(x.capitalLanguages[r.get("codeLanguage")]),(o=(e=this.editors[a]=ace.edit(this.$el.find(".spectate-code.team-"+a+" .ace")[0])).getSession()).getDocument(),o.setMode(v.aceEditModes[r.get("submittedCodeLanguage")]),o.setWrapLimitRange(null),o.setUseWrapMode(!1),o.setNewLineMode("unix"),o.setUseSoftTabs(!0),e.setFontSize("10px"),e.setTheme("ace/theme/textmate"),e.setDisplayIndentGuides(!1),e.setShowPrintMargin(!1),e.setShowInvisibles(!1),e.setAnimatedScroll(!0),e.setShowFoldWidgets(!0),e.$blockScrolling=1/0,e.setReadOnly(!0),a=this.level.isType("ladder")?"humans":null!=(o=r.get("team"))?o:a,e.setValue(null!=(a=null!=(r=r.get("submittedCode"))&&null!=(s=r["hero-placeholder"+("ogres"===a?"-1":"")])?s.plan:void 0)?a:""),e.clearSelection();return this.$el.find(".spectate-code").addClass("shown"),this.$el.addClass("showing-code")},T.prototype.onMouseEnterSpectateCode=function(e){e=o(e.target).closest(".spectate-code").hasClass("team-humans")?"humans":"ogres";return this.editors[e].setFontSize("16px")},T.prototype.onMouseLeaveSpectateCode=function(e){e=o(e.target).closest(".spectate-code").hasClass("team-humans")?"humans":"ogres";return this.editors[e].setFontSize("10px")},T.prototype.register=function(){},T.prototype.onSessionWillSave=function(e){return console.warn("Session is saving but shouldn't save!!!!!!!")},T.prototype.saveScreenshot=function(e){var t;if(t=null!=(t=this.surface)?t.screenshot():void 0)return e.save({screenshot:t},{patch:!0,type:"PUT"})},T.prototype.setTeam=function(e){return _.isString(e)||(e=null!=e?e.team:void 0),w.team=e=null==e?"humans":e,Backbone.Mediator.publish("level:team-set",{team:e})},T.prototype.onNewWorld=function(e){var t,i,n,o,s,r,a,l,c,h;if(!this.headless){for(l=this.world.scripts,this.world=e.world,this.world.scripts=l,h=this.supermodel.getModels(g),l=null!=(l=this.lastWorldFramesLoaded)?l:0,this.world.frames.length===this.world.totalFrames?(this.lastWorldFramesLoaded=0,!1!==x.getQueryVariable("autoplay")&&Backbone.Mediator.publish("level:set-playing",{playing:!0})):this.lastWorldFramesLoaded=this.world.frames.length,s=[],t=0,i=(o=this.world.thangDialogueSounds(l)).length;t<i;t++)c=o[t],a=c[0],n=c[1],(c=_.find(h,function(e){return e.get("name")===a}))&&(r=u.soundForDialogue(n,c.get("soundTriggers")))&&s.push(u.preloadSoundReference(r));return s}},T.prototype.setSessions=function(e,t){return this.sessionOne=e,this.sessionTwo=t},T.prototype.onNextGamePressed=function(e){return this.fetchRandomSessionPair((i=this,function(e,t){if(!i.destroyed)return null!=e?console.log("There was an error fetching the random session pair: "+t):(i.setSessions(t[0]._id,t[1]._id),e="/play/spectate/"+i.levelID+"?session-one="+i.sessionOne+"&session-two="+i.sessionTwo,(t=x.getQueryVariable("league"))&&(e+="&league="+t),Backbone.Mediator.publish("router:navigate",{route:e,viewClass:T,viewArgs:[{spectateSessions:{sessionOne:i.sessionOne,sessionTwo:i.sessionTwo},supermodel:i.supermodel},i.levelID]}),"undefined"!=typeof history&&null!==history&&"function"==typeof history.pushState?history.pushState({},"",e):void 0)}));var i},T.prototype.fetchRandomSessionPair=function(i){var e,t;return console.log("Fetching random session pair!"),t="/db/level/"+this.levelID+"/random_session_pair",(e=x.getQueryVariable("league"))&&(t+="?league="+e),o.ajax({url:t,type:"GET",cache:!1,complete:function(e,t){return"success"!==t?i("error",e.statusText):i(null,o.parseJSON(e.responseText))}})},T.prototype.destroy=function(){var e,t,i,n;for(n in null!=(t=this.levelLoader)&&t.destroy(),null!=(t=this.surface)&&t.destroy(),null!=(t=this.god)&&t.destroy(),null!=(t=this.goalManager)&&t.destroy(),null!=(t=this.scriptManager)&&t.destroy(),delete window.world,i=null!=(t=this.editors)?t:{})e=i[n],this.destroyAceEditor(e);return h&&"function"==typeof console.profileEnd&&console.profileEnd(),T.__super__.destroy.call(this)},T)}.call(this,M(3))},1381:function(e,t,i){var o={}.hasOwnProperty;function n(){return n.__super__.constructor.apply(this,arguments)}i=i(25),e.exports=(function(e,t){for(var i in t)o.call(t,i)&&(e[i]=t[i]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(n,i),n.className="GameUIState",n.schema={type:"object",properties:{canDragCamera:{type:"boolean",description:"Serves as a lock to enable or disable camera movement."},selected:{type:"object",description:"Array of selected thangs",properties:{sprite:{description:"Lank instance"},thang:{description:"Thang object generated by the world"}}}}},n.prototype.defaults=function(){return{selected:[],canDragCamera:!0,realTimeInputEvents:new Backbone.Collection}},n)},1384:function(e,t,i){var n,o={}.hasOwnProperty;function s(){return s.__super__.constructor.apply(this,arguments)}n=i(25),e.exports=(function(e,t){for(var i in t)o.call(t,i)&&(e[i]=t[i]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(s,n),s.className="Article",s.schema=i(1441),s.prototype.urlRoot="/db/article",s.prototype.saveBackups=!0,s.prototype.editableByArtisans=!0,s)},1388:function(e,t,i){var n,o={}.hasOwnProperty;function s(){return s.__super__.constructor.apply(this,arguments)}n=i(25),e.exports=(function(e,t){for(var i in t)o.call(t,i)&&(e[i]=t[i]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(s,n),s.className="Purchase",s.prototype.urlRoot="/db/purchase",s.schema=i(1445),s.makeFor=function(e){return new s({recipient:me.id,purchaser:me.id,purchased:{original:e.get("original"),collection:_.string.underscored(e.constructor.className)}})},s)},1390:function(e,t,i){var n,o,s,r,a,l,c,h,u,p=[].indexOf||function(e){for(var t=0,i=this.length;t<i;t++)if(t in this&&this[t]===e)return t;return-1},d=function(e,t){return function(){return e.apply(t,arguments)}},m={}.hasOwnProperty;function f(){this.storage={}}function g(e){e&&(this.name=e)}function y(){this.onSoundLoadError=d(this.onSoundLoadError,this),this.onSoundLoaded=d(this.onSoundLoaded,this),y.__super__.constructor.call(this),this.ext=a.Sound.capabilities.mp3?".mp3":".ogg",this.camera=null,this.listenToSound(),this.createNewManifest(),this.soundsToPlayWhenLoaded={}}n=i(45),r={},l=i(44).me,a=i(1373),c=function(e){return e.replace(/[A-z]/g,function(e){return String.fromCharCode(e.charCodeAt(0)+(e.toUpperCase()<="M"?13:-13))})},u=function(){for(var e=["nefrubyr","nffubyr","onfgneq","ovgpu","oybbql","obyybpxf","ohttre","pbpx","penc","phag","qnza","qnea","qvpx","qbhpur","snt","shpx","cvff","chffl","fuvg","fyhg","svqqyrfgvpxf"],t=[],i=0,n=e.length;i<n;i++)h=e[i],t.push(c(h));return t}(),i=[a.WebAudioPlugin,a.HTMLAudioPlugin],a.Sound.registerPlugins(i),f.prototype.add=function(e,t){if(null==this.storage[t=null==t?"misc":t]&&(this.storage[t]=[]),!(0<=p.call(this.storage[t],e)))return this.storage[t].push(e)},f.prototype.addPrimarySound=function(e){return this.add(e,"primarySounds")},f.prototype.addSecondarySound=function(e){return this.add(e,"secondarySounds")},f.prototype.getData=function(){return this.storage},o=f,g.prototype.loaded=!1,g.prototype.data=null,g.prototype.progress=0,g.prototype.error=null,g.prototype.name="",s=g,function(e,t){for(var i in t)m.call(t,i)&&(e[i]=t[i]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(y,n),y.prototype.subscriptions={"audio-player:play-sound":function(e){return this.playInterfaceSound(e.trigger,e.volume)}},y.prototype.createNewManifest=function(){return this.manifest=new o},y.prototype.listenToSound=function(){return a.Sound.on("fileload",this.onSoundLoaded)},y.prototype.applyPanning=function(e,t){var i=this.camera.worldToSurface(t),n=this.camera.surfaceViewport,n=Math.max(-1,Math.min(1,(i.x-n.x-n.width/2)/n.width));return _.isNaN(n)&&(n=0),t=this.camera.distanceRatioTo(t),_.isNaN(t)&&(t=.8),Math.min(1,e.volume/Math.pow(t+.2,2)),{volume:e.volume,delay:e.delay,pan:n}},y.prototype.soundForDialogue=function(t,e){var i,n;return _.isArray(t)&&(t=t.join(" ")),_.isString(t)?(i=null!=e?e.say:void 0)?(n=i[t=_.string.slugify(t)])||_.string.startsWith(t,"attack")&&(n=i.attack)||-1!==t.indexOf("i-dont-see-anyone")&&(n=i["i-dont-see-anyone"])||-1!==t.indexOf("i-see-you")&&(n=i["i-see-you"])||-1!==t.indexOf("repeating-loop")&&(n=i["repeating-loop"])||/move(up|down|left|right)/.test(t)&&(n=i["move-"+t.slice(4)])||"cleave"===t&&(n=i["take-that"])?n:(e=i.defaultSimlish,null!=(e=null!=(n=i.swearingSimlish)&&n.length&&_.find(u,function(e){return-1!==t.search(e)})?i.swearingSimlish:e)&&e.length?e[t.length%e.length]:null):null:t},y.prototype.preloadInterfaceSounds=function(e){var t,i,n,o,s;if(l.get("volume")){for(s=[],i=0,n=e.length;i<n;i++)t="/file/interface/"+(o=e[i])+this.ext,s.push(this.preloadSound(t,o));return s}},y.prototype.playInterfaceSound=function(e,t){var i;if((t=null==t?1:t)&&l.get("volume"))return i="/file/interface/"+e+this.ext,this.hasLoadedSound(i)?this.playSound(e,t):(i in r||this.preloadInterfaceSounds([e]),this.soundsToPlayWhenLoaded[e]=t)},y.prototype.playSound=function(e,t,i,n){return null==t&&(t=1),null==i&&(i=0),null==n&&(n=null),e?t&&l.get("volume")?(t={volume:t,delay:i},i=_.string.startsWith(e,"/file/")?e:"/file/"+e,this.hasLoadedSound(i)||(this.soundsToPlayWhenLoaded[e]=t.volume),this.camera&&!this.camera.destroyed&&n&&(t=this.applyPanning(t,n)),a.Sound.play(e,t)):void 0:console.error("Trying to play empty sound?")},y.prototype.hasLoadedSound=function(e,t){return e in r&&!!a.Sound.loadComplete(e)},y.prototype.preloadSoundReference=function(e){var t;if(l.get("volume")&&(t=this.nameForSoundReference(e)))return this.preloadSound(e="/file/"+t,t),e},y.prototype.nameForSoundReference=function(e){return e[this.ext.slice(1)]},y.prototype.preloadSound=function(e,t){if(e&&!(e in r))return a.Sound.registerSound(e,t=null==t?e:t,1),r[e]=new s(t)},y.prototype.onSoundLoaded=function(e){var t=r[e.src];if(t)return t.loaded=!0,t.progress=1,(e=this.soundsToPlayWhenLoaded[t.name])&&(this.playSound(t.name,e),this.soundsToPlayWhenLoaded[t.name]=!1),this.notifyProgressChanged()},y.prototype.onSoundLoadError=function(e){return console.error("Could not load sound",e)},y.prototype.notifyProgressChanged=function(){return Backbone.Mediator.publish("audio-player:loaded",{sender:this})},y.prototype.getStatus=function(e){return r[e]||null},e.exports=new y},1391:function(e,t,i){var n;n=[i(3)],void 0===(i="function"==typeof(i=function(M){function n(e,t){var i,n,o,s=e.nodeName.toLowerCase();if("area"===s){i=e.parentNode;n=i.name;if(!e.href||!n||i.nodeName.toLowerCase()!=="map")return false;o=M("img[usemap='#"+n+"']")[0];return!!o&&r(o)}return(/input|select|textarea|button|object/.test(s)?!e.disabled:"a"===s?e.href||t:t)&&r(e)}function r(e){return M.expr.filters.visible(e)&&!M(e).parents().addBack().filter(function(){return M.css(this,"visibility")==="hidden"}).length}if(
/*!
 * jQuery UI Core 1.11.1
 * http://jqueryui.com
 *
 * Copyright 2014 jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 *
 * http://api.jqueryui.com/category/ui-core/
 */
M.ui=M.ui||{},M.extend(M.ui,{version:"1.11.1",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}}),M.fn.extend({scrollParent:function(e){var t=this.css("position"),i=t==="absolute",n=e?/(auto|scroll|hidden)/:/(auto|scroll)/,o=this.parents().filter(function(){var e=M(this);if(i&&e.css("position")==="static")return false;return n.test(e.css("overflow")+e.css("overflow-y")+e.css("overflow-x"))}).eq(0);return t==="fixed"||!o.length?M(this[0].ownerDocument||document):o},uniqueId:function(){var e=0;return function(){return this.each(function(){if(!this.id)this.id="ui-id-"+ ++e})}}(),removeUniqueId:function(){return this.each(function(){if(/^ui-id-\d+$/.test(this.id))M(this).removeAttr("id")})}}),M.extend(M.expr[":"],{data:M.expr.createPseudo?M.expr.createPseudo(function(t){return function(e){return!!M.data(e,t)}}):function(e,t,i){return!!M.data(e,i[3])},focusable:function(e){return n(e,!isNaN(M.attr(e,"tabindex")))},tabbable:function(e){var t=M.attr(e,"tabindex"),i=isNaN(t);return(i||t>=0)&&n(e,!i)}}),!M("<a>").outerWidth(1).jquery)M.each(["Width","Height"],function(e,i){var o=i==="Width"?["Left","Right"]:["Top","Bottom"],n=i.toLowerCase(),s={innerWidth:M.fn.innerWidth,innerHeight:M.fn.innerHeight,outerWidth:M.fn.outerWidth,outerHeight:M.fn.outerHeight};function r(e,t,i,n){M.each(o,function(){t-=parseFloat(M.css(e,"padding"+this))||0;if(i)t-=parseFloat(M.css(e,"border"+this+"Width"))||0;if(n)t-=parseFloat(M.css(e,"margin"+this))||0});return t}M.fn["inner"+i]=function(e){if(e===undefined)return s["inner"+i].call(this);return this.each(function(){M(this).css(n,r(this,e)+"px")})};M.fn["outer"+i]=function(e,t){if(typeof e!=="number")return s["outer"+i].call(this,e);return this.each(function(){M(this).css(n,r(this,e,true,t)+"px")})}});if(!M.fn.addBack)M.fn.addBack=function(e){return this.add(e==null?this.prevObject:this.prevObject.filter(e))};if(M("<a>").data("a-b","a").removeData("a-b").data("a-b"))M.fn.removeData=function(t){return function(e){if(arguments.length)return t.call(this,M.camelCase(e));else return t.call(this)}}(M.fn.removeData);M.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase()),M.fn.extend({focus:function(e){return function(t,i){return typeof t==="number"?this.each(function(){var e=this;setTimeout(function(){M(e).focus();if(i)i.call(e)},t)}):e.apply(this,arguments)}}(M.fn.focus),disableSelection:function(){var e="onselectstart"in document.createElement("div")?"selectstart":"mousedown";return function(){return this.bind(e+".ui-disableSelection",function(e){e.preventDefault()})}}(),enableSelection:function(){return this.unbind(".ui-disableSelection")},zIndex:function(e){if(e!==undefined)return this.css("zIndex",e);if(this.length){var t=M(this[0]),i,n;while(t.length&&t[0]!==document){i=t.css("position");if(i==="absolute"||i==="relative"||i==="fixed"){n=parseInt(t.css("zIndex"),10);if(!isNaN(n)&&n!==0)return n}t=t.parent()}}return 0}}),M.ui.plugin={add:function(e,t,i){var n,o=M.ui[e].prototype;for(n in i){o.plugins[n]=o.plugins[n]||[];o.plugins[n].push([t,i[n]])}},call:function(e,t,i,n){var o,s=e.plugins[t];if(!s)return;if(!n&&(!e.element[0].parentNode||e.element[0].parentNode.nodeType===11))return;for(o=0;o<s.length;o++)if(e.options[s[o][0]])s[o][1].apply(e.element,i)}};
/*!
 * jQuery UI Widget 1.11.1
 * http://jqueryui.com
 *
 * Copyright 2014 jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 *
 * http://api.jqueryui.com/jQuery.widget/
 */
var i=0,a=Array.prototype.slice;M.cleanData=function(o){return function(e){var t,i,n;for(n=0;(i=e[n])!=null;n++)try{t=M._data(i,"events");if(t&&t.remove)M(i).triggerHandler("remove")}catch(e){}o(e)}}(M.cleanData),M.widget=function(e,i,t){var n,o,s,r,a={},l=e.split(".")[0];e=e.split(".")[1];n=l+"-"+e;if(!t){t=i;i=M.Widget}M.expr[":"][n.toLowerCase()]=function(e){return!!M.data(e,n)};M[l]=M[l]||{};o=M[l][e];s=M[l][e]=function(e,t){if(!this._createWidget)return new s(e,t);if(arguments.length)this._createWidget(e,t)};M.extend(s,o,{version:t.version,_proto:M.extend({},t),_childConstructors:[]});r=new i;r.options=M.widget.extend({},r.options);M.each(t,function(t,s){if(!M.isFunction(s)){a[t]=s;return}a[t]=function(){var n=function(){return i.prototype[t].apply(this,arguments)},o=function(e){return i.prototype[t].apply(this,e)};return function(){var e=this._super,t=this._superApply,i;this._super=n;this._superApply=o;i=s.apply(this,arguments);this._super=e;this._superApply=t;return i}}()});s.prototype=M.widget.extend(r,{widgetEventPrefix:o?r.widgetEventPrefix||e:e},a,{constructor:s,namespace:l,widgetName:e,widgetFullName:n});if(o){M.each(o._childConstructors,function(e,t){var i=t.prototype;M.widget(i.namespace+"."+i.widgetName,s,t._proto)});delete o._childConstructors}else i._childConstructors.push(s);M.widget.bridge(e,s);return s},M.widget.extend=function(e){var t=a.call(arguments,1),i=0,n=t.length,o,s;for(;i<n;i++)for(o in t[i]){s=t[i][o];if(t[i].hasOwnProperty(o)&&s!==undefined)if(M.isPlainObject(s))e[o]=M.isPlainObject(e[o])?M.widget.extend({},e[o],s):M.widget.extend({},s);else e[o]=s}return e},M.widget.bridge=function(s,t){var r=t.prototype.widgetFullName||s;M.fn[s]=function(i){var e=typeof i==="string",n=a.call(arguments,1),o=this;i=!e&&n.length?M.widget.extend.apply(null,[i].concat(n)):i;if(e)this.each(function(){var e,t=M.data(this,r);if(i==="instance"){o=t;return false}if(!t)return M.error("cannot call methods on "+s+" prior to initialization; "+"attempted to call method '"+i+"'");if(!M.isFunction(t[i])||i.charAt(0)==="_")return M.error("no such method '"+i+"' for "+s+" widget instance");e=t[i].apply(t,n);if(e!==t&&e!==undefined){o=e&&e.jquery?o.pushStack(e.get()):e;return false}});else this.each(function(){var e=M.data(this,r);if(e){e.option(i||{});if(e._init)e._init()}else M.data(this,r,new t(i,this))});return o}},M.Widget=function(){},M.Widget._childConstructors=[],M.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:false,create:null},_createWidget:function(e,t){t=M(t||this.defaultElement||this)[0];this.element=M(t);this.uuid=i++;this.eventNamespace="."+this.widgetName+this.uuid;this.options=M.widget.extend({},this.options,this._getCreateOptions(),e);this.bindings=M();this.hoverable=M();this.focusable=M();if(t!==this){M.data(t,this.widgetFullName,this);this._on(true,this.element,{remove:function(e){if(e.target===t)this.destroy()}});this.document=M(t.style?t.ownerDocument:t.document||t);this.window=M(this.document[0].defaultView||this.document[0].parentWindow)}this._create();this._trigger("create",null,this._getCreateEventData());this._init()},_getCreateOptions:M.noop,_getCreateEventData:M.noop,_create:M.noop,_init:M.noop,destroy:function(){this._destroy();this.element.unbind(this.eventNamespace).removeData(this.widgetFullName).removeData(M.camelCase(this.widgetFullName));this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled "+"ui-state-disabled");this.bindings.unbind(this.eventNamespace);this.hoverable.removeClass("ui-state-hover");this.focusable.removeClass("ui-state-focus")},_destroy:M.noop,widget:function(){return this.element},option:function(e,t){var i=e,n,o,s;if(arguments.length===0)return M.widget.extend({},this.options);if(typeof e==="string"){i={};n=e.split(".");e=n.shift();if(n.length){o=i[e]=M.widget.extend({},this.options[e]);for(s=0;s<n.length-1;s++){o[n[s]]=o[n[s]]||{};o=o[n[s]]}e=n.pop();if(arguments.length===1)return o[e]===undefined?null:o[e];o[e]=t}else{if(arguments.length===1)return this.options[e]===undefined?null:this.options[e];i[e]=t}}this._setOptions(i);return this},_setOptions:function(e){var t;for(t in e)this._setOption(t,e[t]);return this},_setOption:function(e,t){this.options[e]=t;if(e==="disabled"){this.widget().toggleClass(this.widgetFullName+"-disabled",!!t);if(t){this.hoverable.removeClass("ui-state-hover");this.focusable.removeClass("ui-state-focus")}}return this},enable:function(){return this._setOptions({disabled:false})},disable:function(){return this._setOptions({disabled:true})},_on:function(r,a,e){var l,c=this;if(typeof r!=="boolean"){e=a;a=r;r=false}if(!e){e=a;a=this.element;l=this.widget()}else{a=l=M(a);this.bindings=this.bindings.add(a)}M.each(e,function(e,t){function i(){if(!r&&(c.options.disabled===true||M(this).hasClass("ui-state-disabled")))return;return(typeof t==="string"?c[t]:t).apply(c,arguments)}if(typeof t!=="string")i.guid=t.guid=t.guid||i.guid||M.guid++;var n=e.match(/^([\w:-]*)\s*(.*)$/),o=n[1]+c.eventNamespace,s=n[2];if(s)l.delegate(s,o,i);else a.bind(o,i)})},_off:function(e,t){t=(t||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace;e.unbind(t).undelegate(t)},_delay:function(e,t){function i(){return(typeof e==="string"?n[e]:e).apply(n,arguments)}var n=this;return setTimeout(i,t||0)},_hoverable:function(e){this.hoverable=this.hoverable.add(e);this._on(e,{mouseenter:function(e){M(e.currentTarget).addClass("ui-state-hover")},mouseleave:function(e){M(e.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(e){this.focusable=this.focusable.add(e);this._on(e,{focusin:function(e){M(e.currentTarget).addClass("ui-state-focus")},focusout:function(e){M(e.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(e,t,i){var n,o,s=this.options[e];i=i||{};t=M.Event(t);t.type=(e===this.widgetEventPrefix?e:this.widgetEventPrefix+e).toLowerCase();t.target=this.element[0];o=t.originalEvent;if(o)for(n in o)if(!(n in t))t[n]=o[n];this.element.trigger(t,i);return!(M.isFunction(s)&&s.apply(this.element[0],[t].concat(i))===false||t.isDefaultPrevented())}},M.each({show:"fadeIn",hide:"fadeOut"},function(s,r){M.Widget.prototype["_"+s]=function(t,e,i){if(typeof e==="string")e={effect:e};var n,o=!e?s:e===true||typeof e==="number"?r:e.effect||r;e=e||{};if(typeof e==="number")e={duration:e};n=!M.isEmptyObject(e);e.complete=i;if(e.delay)t.delay(e.delay);if(n&&M.effects&&M.effects.effect[o])t[s](e);else if(o!==s&&t[o])t[o](e.duration,e.easing,i);else t.queue(function(e){M(this)[s]();if(i)i.call(t[0]);e()})}});var e=M.widget,o=false;
/*!
 * jQuery UI Mouse 1.11.1
 * http://jqueryui.com
 *
 * Copyright 2014 jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 *
 * http://api.jqueryui.com/mouse/
 */M(document).mouseup(function(){o=false});var t=M.widget("ui.mouse",{version:"1.11.1",options:{cancel:"input,textarea,button,select,option",distance:1,delay:0},_mouseInit:function(){var t=this;this.element.bind("mousedown."+this.widgetName,function(e){return t._mouseDown(e)}).bind("click."+this.widgetName,function(e){if(true===M.data(e.target,t.widgetName+".preventClickEvent")){M.removeData(e.target,t.widgetName+".preventClickEvent");e.stopImmediatePropagation();return false}});this.started=false},_mouseDestroy:function(){this.element.unbind("."+this.widgetName);if(this._mouseMoveDelegate)this.document.unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(e){if(o)return;this._mouseStarted&&this._mouseUp(e);this._mouseDownEvent=e;var t=this,i=e.which===1,n=typeof this.options.cancel==="string"&&e.target.nodeName?M(e.target).closest(this.options.cancel).length:false;if(!i||n||!this._mouseCapture(e))return true;this.mouseDelayMet=!this.options.delay;if(!this.mouseDelayMet)this._mouseDelayTimer=setTimeout(function(){t.mouseDelayMet=true},this.options.delay);if(this._mouseDistanceMet(e)&&this._mouseDelayMet(e)){this._mouseStarted=this._mouseStart(e)!==false;if(!this._mouseStarted){e.preventDefault();return true}}if(true===M.data(e.target,this.widgetName+".preventClickEvent"))M.removeData(e.target,this.widgetName+".preventClickEvent");this._mouseMoveDelegate=function(e){return t._mouseMove(e)};this._mouseUpDelegate=function(e){return t._mouseUp(e)};this.document.bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate);e.preventDefault();o=true;return true},_mouseMove:function(e){if(M.ui.ie&&(!document.documentMode||document.documentMode<9)&&!e.button)return this._mouseUp(e);else if(!e.which)return this._mouseUp(e);if(this._mouseStarted){this._mouseDrag(e);return e.preventDefault()}if(this._mouseDistanceMet(e)&&this._mouseDelayMet(e)){this._mouseStarted=this._mouseStart(this._mouseDownEvent,e)!==false;this._mouseStarted?this._mouseDrag(e):this._mouseUp(e)}return!this._mouseStarted},_mouseUp:function(e){this.document.unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate);if(this._mouseStarted){this._mouseStarted=false;if(e.target===this._mouseDownEvent.target)M.data(e.target,this.widgetName+".preventClickEvent",true);this._mouseStop(e)}o=false;return false},_mouseDistanceMet:function(e){return Math.max(Math.abs(this._mouseDownEvent.pageX-e.pageX),Math.abs(this._mouseDownEvent.pageY-e.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return true}});
/*!
 * jQuery UI Position 1.11.1
 * http://jqueryui.com
 *
 * Copyright 2014 jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 *
 * http://api.jqueryui.com/position/
 */
(function(){M.ui=M.ui||{};var o,k,x=Math.max,S=Math.abs,C=Math.round,n=/left|center|right/,s=/top|center|bottom/,r=/[\+\-]\d+(\.[\d]+)?%?/,a=/^\w+/,l=/%$/,t=M.fn.position;function T(e,t,i){return[parseFloat(e[0])*(l.test(e[0])?t/100:1),parseFloat(e[1])*(l.test(e[1])?i/100:1)]}function L(e,t){return parseInt(M.css(e,t),10)||0}function i(e){var t=e[0];if(t.nodeType===9)return{width:e.width(),height:e.height(),offset:{top:0,left:0}};if(M.isWindow(t))return{width:e.width(),height:e.height(),offset:{top:e.scrollTop(),left:e.scrollLeft()}};if(t.preventDefault)return{width:0,height:0,offset:{top:t.pageY,left:t.pageX}};return{width:e.outerWidth(),height:e.outerHeight(),offset:e.offset()}}M.position={scrollbarWidth:function(){if(o!==undefined)return o;var e,t,i=M("<div style='display:block;position:absolute;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'></div></div>"),n=i.children()[0];M("body").append(i);e=n.offsetWidth;i.css("overflow","scroll");t=n.offsetWidth;if(e===t)t=i[0].clientWidth;i.remove();return o=e-t},getScrollInfo:function(e){var t=e.isWindow||e.isDocument?"":e.element.css("overflow-x"),i=e.isWindow||e.isDocument?"":e.element.css("overflow-y"),n=t==="scroll"||t==="auto"&&e.width<e.element[0].scrollWidth,o=i==="scroll"||i==="auto"&&e.height<e.element[0].scrollHeight;return{width:o?M.position.scrollbarWidth():0,height:n?M.position.scrollbarWidth():0}},getWithinInfo:function(e){var t=M(e||window),i=M.isWindow(t[0]),n=!!t[0]&&t[0].nodeType===9;return{element:t,isWindow:i,isDocument:n,offset:t.offset()||{left:0,top:0},scrollLeft:t.scrollLeft(),scrollTop:t.scrollTop(),width:i||n?t.width():t.outerWidth(),height:i||n?t.height():t.outerHeight()}}};M.fn.position=function(u){if(!u||!u.of)return t.apply(this,arguments);u=M.extend({},u);var p,d,m,f,g,e,y=M(u.of),v=M.position.getWithinInfo(u.within),b=M.position.getScrollInfo(v),_=(u.collision||"flip").split(" "),w={};e=i(y);if(y[0].preventDefault)u.at="left top";d=e.width;m=e.height;f=e.offset;g=M.extend({},f);M.each(["my","at"],function(){var e=(u[this]||"").split(" "),t,i;if(e.length===1)e=n.test(e[0])?e.concat(["center"]):s.test(e[0])?["center"].concat(e):["center","center"];e[0]=n.test(e[0])?e[0]:"center";e[1]=s.test(e[1])?e[1]:"center";t=r.exec(e[0]);i=r.exec(e[1]);w[this]=[t?t[0]:0,i?i[0]:0];u[this]=[a.exec(e[0])[0],a.exec(e[1])[0]]});if(_.length===1)_[1]=_[0];if(u.at[0]==="right")g.left+=d;else if(u.at[0]==="center")g.left+=d/2;if(u.at[1]==="bottom")g.top+=m;else if(u.at[1]==="center")g.top+=m/2;p=T(w.at,d,m);g.left+=p[0];g.top+=p[1];return this.each(function(){var i,e,r=M(this),a=r.outerWidth(),l=r.outerHeight(),t=L(this,"marginLeft"),n=L(this,"marginTop"),o=a+t+L(this,"marginRight")+b.width,s=l+n+L(this,"marginBottom")+b.height,c=M.extend({},g),h=T(w.my,r.outerWidth(),r.outerHeight());if(u.my[0]==="right")c.left-=a;else if(u.my[0]==="center")c.left-=a/2;if(u.my[1]==="bottom")c.top-=l;else if(u.my[1]==="center")c.top-=l/2;c.left+=h[0];c.top+=h[1];if(!k){c.left=C(c.left);c.top=C(c.top)}i={marginLeft:t,marginTop:n};M.each(["left","top"],function(e,t){if(M.ui.position[_[e]])M.ui.position[_[e]][t](c,{targetWidth:d,targetHeight:m,elemWidth:a,elemHeight:l,collisionPosition:i,collisionWidth:o,collisionHeight:s,offset:[p[0]+h[0],p[1]+h[1]],my:u.my,at:u.at,within:v,elem:r})});if(u.using)e=function(e){var t=f.left-c.left,i=t+d-a,n=f.top-c.top,o=n+m-l,s={target:{element:y,left:f.left,top:f.top,width:d,height:m},element:{element:r,left:c.left,top:c.top,width:a,height:l},horizontal:i<0?"left":t>0?"right":"center",vertical:o<0?"top":n>0?"bottom":"middle"};if(d<a&&S(t+i)<d)s.horizontal="center";if(m<l&&S(n+o)<m)s.vertical="middle";if(x(S(t),S(i))>x(S(n),S(o)))s.important="horizontal";else s.important="vertical";u.using.call(this,e,s)};r.offset(M.extend(c,{using:e}))})};M.ui.position={fit:{left:function(e,t){var i=t.within,n=i.isWindow?i.scrollLeft:i.offset.left,o=i.width,s=e.left-t.collisionPosition.marginLeft,r=n-s,a=s+t.collisionWidth-o-n,l;if(t.collisionWidth>o)if(r>0&&a<=0){l=e.left+r+t.collisionWidth-o-n;e.left+=r-l}else if(a>0&&r<=0)e.left=n;else if(r>a)e.left=n+o-t.collisionWidth;else e.left=n;else if(r>0)e.left+=r;else if(a>0)e.left-=a;else e.left=x(e.left-s,e.left)},top:function(e,t){var i=t.within,n=i.isWindow?i.scrollTop:i.offset.top,o=t.within.height,s=e.top-t.collisionPosition.marginTop,r=n-s,a=s+t.collisionHeight-o-n,l;if(t.collisionHeight>o)if(r>0&&a<=0){l=e.top+r+t.collisionHeight-o-n;e.top+=r-l}else if(a>0&&r<=0)e.top=n;else if(r>a)e.top=n+o-t.collisionHeight;else e.top=n;else if(r>0)e.top+=r;else if(a>0)e.top-=a;else e.top=x(e.top-s,e.top)}},flip:{left:function(e,t){var i=t.within,n=i.offset.left+i.scrollLeft,o=i.width,s=i.isWindow?i.scrollLeft:i.offset.left,r=e.left-t.collisionPosition.marginLeft,a=r-s,l=r+t.collisionWidth-o-s,c=t.my[0]==="left"?-t.elemWidth:t.my[0]==="right"?t.elemWidth:0,h=t.at[0]==="left"?t.targetWidth:t.at[0]==="right"?-t.targetWidth:0,u=-2*t.offset[0],p,d;if(a<0){p=e.left+c+h+u+t.collisionWidth-o-n;if(p<0||p<S(a))e.left+=c+h+u}else if(l>0){d=e.left-t.collisionPosition.marginLeft+c+h+u-s;if(d>0||S(d)<l)e.left+=c+h+u}},top:function(e,t){var i=t.within,n=i.offset.top+i.scrollTop,o=i.height,s=i.isWindow?i.scrollTop:i.offset.top,r=e.top-t.collisionPosition.marginTop,a=r-s,l=r+t.collisionHeight-o-s,c=t.my[1]==="top",h=c?-t.elemHeight:t.my[1]==="bottom"?t.elemHeight:0,u=t.at[1]==="top"?t.targetHeight:t.at[1]==="bottom"?-t.targetHeight:0,p=-2*t.offset[1],d,m;if(a<0){m=e.top+h+u+p+t.collisionHeight-o-n;if(e.top+h+u+p>a&&(m<0||m<S(a)))e.top+=h+u+p}else if(l>0){d=e.top-t.collisionPosition.marginTop+h+u+p-s;if(e.top+h+u+p>l&&(d>0||S(d)<l))e.top+=h+u+p}}},flipfit:{left:function(){M.ui.position.flip.left.apply(this,arguments);M.ui.position.fit.left.apply(this,arguments)},top:function(){M.ui.position.flip.top.apply(this,arguments);M.ui.position.fit.top.apply(this,arguments)}}};(function(){var e,t,i,n,o,s=document.getElementsByTagName("body")[0],r=document.createElement("div");e=document.createElement(s?"div":"body");i={visibility:"hidden",width:0,height:0,border:0,margin:0,background:"none"};if(s)M.extend(i,{position:"absolute",left:"-1000px",top:"-1000px"});for(o in i)e.style[o]=i[o];e.appendChild(r);t=s||document.documentElement;t.insertBefore(e,t.firstChild);r.style.cssText="position: absolute; left: 10.7432222px;";n=M(r).offset().left;k=n>10&&n<11;e.innerHTML="";t.removeChild(e)})()})();var s=M.ui.position;
/*!
 * jQuery UI Draggable 1.11.1
 * http://jqueryui.com
 *
 * Copyright 2014 jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 *
 * http://api.jqueryui.com/draggable/
 */M.widget("ui.draggable",M.ui.mouse,{version:"1.11.1",widgetEventPrefix:"drag",options:{addClasses:true,appendTo:"parent",axis:false,connectToSortable:false,containment:false,cursor:"auto",cursorAt:false,grid:false,handle:false,helper:"original",iframeFix:false,opacity:false,refreshPositions:false,revert:false,revertDuration:500,scope:"default",scroll:true,scrollSensitivity:20,scrollSpeed:20,snap:false,snapMode:"both",snapTolerance:20,stack:false,zIndex:false,drag:null,start:null,stop:null},_create:function(){if(this.options.helper==="original"&&!/^(?:r|a|f)/.test(this.element.css("position")))this.element[0].style.position="relative";if(this.options.addClasses)this.element.addClass("ui-draggable");if(this.options.disabled)this.element.addClass("ui-draggable-disabled");this._setHandleClassName();this._mouseInit()},_setOption:function(e,t){this._super(e,t);if(e==="handle"){this._removeHandleClassName();this._setHandleClassName()}},_destroy:function(){if((this.helper||this.element).is(".ui-draggable-dragging")){this.destroyOnClear=true;return}this.element.removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled");this._removeHandleClassName();this._mouseDestroy()},_mouseCapture:function(e){var t=this.document[0],i=this.options;try{if(t.activeElement&&t.activeElement.nodeName.toLowerCase()!=="body")M(t.activeElement).blur()}catch(e){}if(this.helper||i.disabled||M(e.target).closest(".ui-resizable-handle").length>0)return false;this.handle=this._getHandle(e);if(!this.handle)return false;M(i.iframeFix===true?"iframe":i.iframeFix).each(function(){M("<div class='ui-draggable-iframeFix' style='background: #fff;'></div>").css({width:this.offsetWidth+"px",height:this.offsetHeight+"px",position:"absolute",opacity:"0.001",zIndex:1e3}).css(M(this).offset()).appendTo("body")});return true},_mouseStart:function(e){var t=this.options;this.helper=this._createHelper(e);this.helper.addClass("ui-draggable-dragging");this._cacheHelperProportions();if(M.ui.ddmanager)M.ui.ddmanager.current=this;this._cacheMargins();this.cssPosition=this.helper.css("position");this.scrollParent=this.helper.scrollParent(true);this.offsetParent=this.helper.offsetParent();this.offsetParentCssPosition=this.offsetParent.css("position");this.offset=this.positionAbs=this.element.offset();this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left};this.offset.scroll=false;M.extend(this.offset,{click:{left:e.pageX-this.offset.left,top:e.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()});this.originalPosition=this.position=this._generatePosition(e,false);this.originalPageX=e.pageX;this.originalPageY=e.pageY;t.cursorAt&&this._adjustOffsetFromHelper(t.cursorAt);this._setContainment();if(this._trigger("start",e)===false){this._clear();return false}this._cacheHelperProportions();if(M.ui.ddmanager&&!t.dropBehaviour)M.ui.ddmanager.prepareOffsets(this,e);this._mouseDrag(e,true);if(M.ui.ddmanager)M.ui.ddmanager.dragStart(this,e);return true},_mouseDrag:function(e,t){if(this.offsetParentCssPosition==="fixed")this.offset.parent=this._getParentOffset();this.position=this._generatePosition(e,true);this.positionAbs=this._convertPositionTo("absolute");if(!t){var i=this._uiHash();if(this._trigger("drag",e,i)===false){this._mouseUp({});return false}this.position=i.position}this.helper[0].style.left=this.position.left+"px";this.helper[0].style.top=this.position.top+"px";if(M.ui.ddmanager)M.ui.ddmanager.drag(this,e);return false},_mouseStop:function(e){var t=this,i=false;if(M.ui.ddmanager&&!this.options.dropBehaviour)i=M.ui.ddmanager.drop(this,e);if(this.dropped){i=this.dropped;this.dropped=false}if(this.options.revert==="invalid"&&!i||this.options.revert==="valid"&&i||this.options.revert===true||M.isFunction(this.options.revert)&&this.options.revert.call(this.element,i))M(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){if(t._trigger("stop",e)!==false)t._clear()});else if(this._trigger("stop",e)!==false)this._clear();return false},_mouseUp:function(e){M("div.ui-draggable-iframeFix").each(function(){this.parentNode.removeChild(this)});if(M.ui.ddmanager)M.ui.ddmanager.dragStop(this,e);this.element.focus();return M.ui.mouse.prototype._mouseUp.call(this,e)},cancel:function(){if(this.helper.is(".ui-draggable-dragging"))this._mouseUp({});else this._clear();return this},_getHandle:function(e){return this.options.handle?!!M(e.target).closest(this.element.find(this.options.handle)).length:true},_setHandleClassName:function(){this.handleElement=this.options.handle?this.element.find(this.options.handle):this.element;this.handleElement.addClass("ui-draggable-handle")},_removeHandleClassName:function(){this.handleElement.removeClass("ui-draggable-handle")},_createHelper:function(e){var t=this.options,i=M.isFunction(t.helper)?M(t.helper.apply(this.element[0],[e])):t.helper==="clone"?this.element.clone().removeAttr("id"):this.element;if(!i.parents("body").length)i.appendTo(t.appendTo==="parent"?this.element[0].parentNode:t.appendTo);if(i[0]!==this.element[0]&&!/(fixed|absolute)/.test(i.css("position")))i.css("position","absolute");return i},_adjustOffsetFromHelper:function(e){if(typeof e==="string")e=e.split(" ");if(M.isArray(e))e={left:+e[0],top:+e[1]||0};if("left"in e)this.offset.click.left=e.left+this.margins.left;if("right"in e)this.offset.click.left=this.helperProportions.width-e.right+this.margins.left;if("top"in e)this.offset.click.top=e.top+this.margins.top;if("bottom"in e)this.offset.click.top=this.helperProportions.height-e.bottom+this.margins.top},_isRootNode:function(e){return/(html|body)/i.test(e.tagName)||e===this.document[0]},_getParentOffset:function(){var e=this.offsetParent.offset(),t=this.document[0];if(this.cssPosition==="absolute"&&this.scrollParent[0]!==t&&M.contains(this.scrollParent[0],this.offsetParent[0])){e.left+=this.scrollParent.scrollLeft();e.top+=this.scrollParent.scrollTop()}if(this._isRootNode(this.offsetParent[0]))e={top:0,left:0};return{top:e.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:e.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if(this.cssPosition!=="relative")return{top:0,left:0};var e=this.element.position(),t=this._isRootNode(this.scrollParent[0]);return{top:e.top-(parseInt(this.helper.css("top"),10)||0)+(!t?this.scrollParent.scrollTop():0),left:e.left-(parseInt(this.helper.css("left"),10)||0)+(!t?this.scrollParent.scrollLeft():0)}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var e,t,i,n=this.options,o=this.document[0];this.relativeContainer=null;if(!n.containment){this.containment=null;return}if(n.containment==="window"){this.containment=[M(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,M(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,M(window).scrollLeft()+M(window).width()-this.helperProportions.width-this.margins.left,M(window).scrollTop()+(M(window).height()||o.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top];return}if(n.containment==="document"){this.containment=[0,0,M(o).width()-this.helperProportions.width-this.margins.left,(M(o).height()||o.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top];return}if(n.containment.constructor===Array){this.containment=n.containment;return}if(n.containment==="parent")n.containment=this.helper[0].parentNode;t=M(n.containment);i=t[0];if(!i)return;e=t.css("overflow")!=="hidden";this.containment=[(parseInt(t.css("borderLeftWidth"),10)||0)+(parseInt(t.css("paddingLeft"),10)||0),(parseInt(t.css("borderTopWidth"),10)||0)+(parseInt(t.css("paddingTop"),10)||0),(e?Math.max(i.scrollWidth,i.offsetWidth):i.offsetWidth)-(parseInt(t.css("borderRightWidth"),10)||0)-(parseInt(t.css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(e?Math.max(i.scrollHeight,i.offsetHeight):i.offsetHeight)-(parseInt(t.css("borderBottomWidth"),10)||0)-(parseInt(t.css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom];this.relativeContainer=t},_convertPositionTo:function(e,t){if(!t)t=this.position;var i=e==="absolute"?1:-1,n=this._isRootNode(this.scrollParent[0]);return{top:t.top+this.offset.relative.top*i+this.offset.parent.top*i-(this.cssPosition==="fixed"?-this.offset.scroll.top:n?0:this.offset.scroll.top)*i,left:t.left+this.offset.relative.left*i+this.offset.parent.left*i-(this.cssPosition==="fixed"?-this.offset.scroll.left:n?0:this.offset.scroll.left)*i}},_generatePosition:function(e,t){var i,n,o,s,r=this.options,a=this._isRootNode(this.scrollParent[0]),l=e.pageX,c=e.pageY;if(!a||!this.offset.scroll)this.offset.scroll={top:this.scrollParent.scrollTop(),left:this.scrollParent.scrollLeft()};if(t){if(this.containment){if(this.relativeContainer){n=this.relativeContainer.offset();i=[this.containment[0]+n.left,this.containment[1]+n.top,this.containment[2]+n.left,this.containment[3]+n.top]}else i=this.containment;if(e.pageX-this.offset.click.left<i[0])l=i[0]+this.offset.click.left;if(e.pageY-this.offset.click.top<i[1])c=i[1]+this.offset.click.top;if(e.pageX-this.offset.click.left>i[2])l=i[2]+this.offset.click.left;if(e.pageY-this.offset.click.top>i[3])c=i[3]+this.offset.click.top}if(r.grid){o=r.grid[1]?this.originalPageY+Math.round((c-this.originalPageY)/r.grid[1])*r.grid[1]:this.originalPageY;c=i?o-this.offset.click.top>=i[1]||o-this.offset.click.top>i[3]?o:o-this.offset.click.top>=i[1]?o-r.grid[1]:o+r.grid[1]:o;s=r.grid[0]?this.originalPageX+Math.round((l-this.originalPageX)/r.grid[0])*r.grid[0]:this.originalPageX;l=i?s-this.offset.click.left>=i[0]||s-this.offset.click.left>i[2]?s:s-this.offset.click.left>=i[0]?s-r.grid[0]:s+r.grid[0]:s}if(r.axis==="y")l=this.originalPageX;if(r.axis==="x")c=this.originalPageY}return{top:c-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+(this.cssPosition==="fixed"?-this.offset.scroll.top:a?0:this.offset.scroll.top),left:l-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+(this.cssPosition==="fixed"?-this.offset.scroll.left:a?0:this.offset.scroll.left)}},_clear:function(){this.helper.removeClass("ui-draggable-dragging");if(this.helper[0]!==this.element[0]&&!this.cancelHelperRemoval)this.helper.remove();this.helper=null;this.cancelHelperRemoval=false;if(this.destroyOnClear)this.destroy()},_trigger:function(e,t,i){i=i||this._uiHash();M.ui.plugin.call(this,e,[t,i,this],true);if(e==="drag")this.positionAbs=this._convertPositionTo("absolute");return M.Widget.prototype._trigger.call(this,e,t,i)},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}}),M.ui.plugin.add("draggable","connectToSortable",{start:function(t,e,i){var n=i.options,o=M.extend({},e,{item:i.element});i.sortables=[];M(n.connectToSortable).each(function(){var e=M(this).sortable("instance");if(e&&!e.options.disabled){i.sortables.push({instance:e,shouldRevert:e.options.revert});e.refreshPositions();e._trigger("activate",t,o)}})},stop:function(e,t,i){var n=M.extend({},t,{item:i.element});M.each(i.sortables,function(){if(this.instance.isOver){this.instance.isOver=0;i.cancelHelperRemoval=true;this.instance.cancelHelperRemoval=false;if(this.shouldRevert)this.instance.options.revert=this.shouldRevert;this.instance._mouseStop(e);this.instance.options.helper=this.instance.options._helper;if(i.options.helper==="original")this.instance.currentItem.css({top:"auto",left:"auto"})}else{this.instance.cancelHelperRemoval=false;this.instance._trigger("deactivate",e,n)}})},drag:function(i,n,o){var s=this;M.each(o.sortables,function(){var e=false,t=this;this.instance.positionAbs=o.positionAbs;this.instance.helperProportions=o.helperProportions;this.instance.offset.click=o.offset.click;if(this.instance._intersectsWith(this.instance.containerCache)){e=true;M.each(o.sortables,function(){this.instance.positionAbs=o.positionAbs;this.instance.helperProportions=o.helperProportions;this.instance.offset.click=o.offset.click;if(this!==t&&this.instance._intersectsWith(this.instance.containerCache)&&M.contains(t.instance.element[0],this.instance.element[0]))e=false;return e})}if(e){if(!this.instance.isOver){this.instance.isOver=1;this.instance.currentItem=M(s).clone().removeAttr("id").appendTo(this.instance.element).data("ui-sortable-item",true);this.instance.options._helper=this.instance.options.helper;this.instance.options.helper=function(){return n.helper[0]};i.target=this.instance.currentItem[0];this.instance._mouseCapture(i,true);this.instance._mouseStart(i,true,true);this.instance.offset.click.top=o.offset.click.top;this.instance.offset.click.left=o.offset.click.left;this.instance.offset.parent.left-=o.offset.parent.left-this.instance.offset.parent.left;this.instance.offset.parent.top-=o.offset.parent.top-this.instance.offset.parent.top;o._trigger("toSortable",i);o.dropped=this.instance.element;o.currentItem=o.element;this.instance.fromOutside=o}if(this.instance.currentItem)this.instance._mouseDrag(i)}else if(this.instance.isOver){this.instance.isOver=0;this.instance.cancelHelperRemoval=true;this.instance.options.revert=false;this.instance._trigger("out",i,this.instance._uiHash(this.instance));this.instance._mouseStop(i,true);this.instance.options.helper=this.instance.options._helper;this.instance.currentItem.remove();if(this.instance.placeholder)this.instance.placeholder.remove();o._trigger("fromSortable",i);o.dropped=false}})}}),M.ui.plugin.add("draggable","cursor",{start:function(e,t,i){var n=M("body"),o=i.options;if(n.css("cursor"))o._cursor=n.css("cursor");n.css("cursor",o.cursor)},stop:function(e,t,i){var n=i.options;if(n._cursor)M("body").css("cursor",n._cursor)}}),M.ui.plugin.add("draggable","opacity",{start:function(e,t,i){var n=M(t.helper),o=i.options;if(n.css("opacity"))o._opacity=n.css("opacity");n.css("opacity",o.opacity)},stop:function(e,t,i){var n=i.options;if(n._opacity)M(t.helper).css("opacity",n._opacity)}}),M.ui.plugin.add("draggable","scroll",{start:function(e,t,i){if(!i.scrollParentNotHidden)i.scrollParentNotHidden=i.helper.scrollParent(false);if(i.scrollParentNotHidden[0]!==i.document[0]&&i.scrollParentNotHidden[0].tagName!=="HTML")i.overflowOffset=i.scrollParentNotHidden.offset()},drag:function(e,t,i){var n=i.options,o=false,s=i.scrollParentNotHidden[0],r=i.document[0];if(s!==r&&s.tagName!=="HTML"){if(!n.axis||n.axis!=="x")if(i.overflowOffset.top+s.offsetHeight-e.pageY<n.scrollSensitivity)s.scrollTop=o=s.scrollTop+n.scrollSpeed;else if(e.pageY-i.overflowOffset.top<n.scrollSensitivity)s.scrollTop=o=s.scrollTop-n.scrollSpeed;if(!n.axis||n.axis!=="y")if(i.overflowOffset.left+s.offsetWidth-e.pageX<n.scrollSensitivity)s.scrollLeft=o=s.scrollLeft+n.scrollSpeed;else if(e.pageX-i.overflowOffset.left<n.scrollSensitivity)s.scrollLeft=o=s.scrollLeft-n.scrollSpeed}else{if(!n.axis||n.axis!=="x")if(e.pageY-M(r).scrollTop()<n.scrollSensitivity)o=M(r).scrollTop(M(r).scrollTop()-n.scrollSpeed);else if(M(window).height()-(e.pageY-M(r).scrollTop())<n.scrollSensitivity)o=M(r).scrollTop(M(r).scrollTop()+n.scrollSpeed);if(!n.axis||n.axis!=="y")if(e.pageX-M(r).scrollLeft()<n.scrollSensitivity)o=M(r).scrollLeft(M(r).scrollLeft()-n.scrollSpeed);else if(M(window).width()-(e.pageX-M(r).scrollLeft())<n.scrollSensitivity)o=M(r).scrollLeft(M(r).scrollLeft()+n.scrollSpeed)}if(o!==false&&M.ui.ddmanager&&!n.dropBehaviour)M.ui.ddmanager.prepareOffsets(i,e)}}),M.ui.plugin.add("draggable","snap",{start:function(e,t,i){var n=i.options;i.snapElements=[];M(n.snap.constructor!==String?n.snap.items||":data(ui-draggable)":n.snap).each(function(){var e=M(this),t=e.offset();if(this!==i.element[0])i.snapElements.push({item:this,width:e.outerWidth(),height:e.outerHeight(),top:t.top,left:t.left})})},drag:function(e,t,i){var n,o,s,r,a,l,c,h,u,p,d=i.options,m=d.snapTolerance,f=t.offset.left,g=f+i.helperProportions.width,y=t.offset.top,v=y+i.helperProportions.height;for(u=i.snapElements.length-1;u>=0;u--){a=i.snapElements[u].left;l=a+i.snapElements[u].width;c=i.snapElements[u].top;h=c+i.snapElements[u].height;if(g<a-m||f>l+m||v<c-m||y>h+m||!M.contains(i.snapElements[u].item.ownerDocument,i.snapElements[u].item)){if(i.snapElements[u].snapping)i.options.snap.release&&i.options.snap.release.call(i.element,e,M.extend(i._uiHash(),{snapItem:i.snapElements[u].item}));i.snapElements[u].snapping=false;continue}if(d.snapMode!=="inner"){n=Math.abs(c-v)<=m;o=Math.abs(h-y)<=m;s=Math.abs(a-g)<=m;r=Math.abs(l-f)<=m;if(n)t.position.top=i._convertPositionTo("relative",{top:c-i.helperProportions.height,left:0}).top-i.margins.top;if(o)t.position.top=i._convertPositionTo("relative",{top:h,left:0}).top-i.margins.top;if(s)t.position.left=i._convertPositionTo("relative",{top:0,left:a-i.helperProportions.width}).left-i.margins.left;if(r)t.position.left=i._convertPositionTo("relative",{top:0,left:l}).left-i.margins.left}p=n||o||s||r;if(d.snapMode!=="outer"){n=Math.abs(c-y)<=m;o=Math.abs(h-v)<=m;s=Math.abs(a-f)<=m;r=Math.abs(l-g)<=m;if(n)t.position.top=i._convertPositionTo("relative",{top:c,left:0}).top-i.margins.top;if(o)t.position.top=i._convertPositionTo("relative",{top:h-i.helperProportions.height,left:0}).top-i.margins.top;if(s)t.position.left=i._convertPositionTo("relative",{top:0,left:a}).left-i.margins.left;if(r)t.position.left=i._convertPositionTo("relative",{top:0,left:l-i.helperProportions.width}).left-i.margins.left}if(!i.snapElements[u].snapping&&(n||o||s||r||p))i.options.snap.snap&&i.options.snap.snap.call(i.element,e,M.extend(i._uiHash(),{snapItem:i.snapElements[u].item}));i.snapElements[u].snapping=n||o||s||r||p}}}),M.ui.plugin.add("draggable","stack",{start:function(e,t,i){var n,o=i.options,s=M.makeArray(M(o.stack)).sort(function(e,t){return(parseInt(M(e).css("zIndex"),10)||0)-(parseInt(M(t).css("zIndex"),10)||0)});if(!s.length)return;n=parseInt(M(s[0]).css("zIndex"),10)||0;M(s).each(function(e){M(this).css("zIndex",n+e)});this.css("zIndex",n+s.length)}}),M.ui.plugin.add("draggable","zIndex",{start:function(e,t,i){var n=M(t.helper),o=i.options;if(n.css("zIndex"))o._zIndex=n.css("zIndex");n.css("zIndex",o.zIndex)},stop:function(e,t,i){var n=i.options;if(n._zIndex)M(t.helper).css("zIndex",n._zIndex)}});var l=M.ui.draggable;
/*!
 * jQuery UI Droppable 1.11.1
 * http://jqueryui.com
 *
 * Copyright 2014 jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 *
 * http://api.jqueryui.com/droppable/
 */M.widget("ui.droppable",{version:"1.11.1",widgetEventPrefix:"drop",options:{accept:"*",activeClass:false,addClasses:true,greedy:false,hoverClass:false,scope:"default",tolerance:"intersect",activate:null,deactivate:null,drop:null,out:null,over:null},_create:function(){var e,t=this.options,i=t.accept;this.isover=false;this.isout=true;this.accept=M.isFunction(i)?i:function(e){return e.is(i)};this.proportions=function(){if(arguments.length)e=arguments[0];else return e?e:e={width:this.element[0].offsetWidth,height:this.element[0].offsetHeight}};this._addToManager(t.scope);t.addClasses&&this.element.addClass("ui-droppable")},_addToManager:function(e){M.ui.ddmanager.droppables[e]=M.ui.ddmanager.droppables[e]||[];M.ui.ddmanager.droppables[e].push(this)},_splice:function(e){var t=0;for(;t<e.length;t++)if(e[t]===this)e.splice(t,1)},_destroy:function(){var e=M.ui.ddmanager.droppables[this.options.scope];this._splice(e);this.element.removeClass("ui-droppable ui-droppable-disabled")},_setOption:function(e,t){if(e==="accept")this.accept=M.isFunction(t)?t:function(e){return e.is(t)};else if(e==="scope"){var i=M.ui.ddmanager.droppables[this.options.scope];this._splice(i);this._addToManager(t)}this._super(e,t)},_activate:function(e){var t=M.ui.ddmanager.current;if(this.options.activeClass)this.element.addClass(this.options.activeClass);if(t)this._trigger("activate",e,this.ui(t))},_deactivate:function(e){var t=M.ui.ddmanager.current;if(this.options.activeClass)this.element.removeClass(this.options.activeClass);if(t)this._trigger("deactivate",e,this.ui(t))},_over:function(e){var t=M.ui.ddmanager.current;if(!t||(t.currentItem||t.element)[0]===this.element[0])return;if(this.accept.call(this.element[0],t.currentItem||t.element)){if(this.options.hoverClass)this.element.addClass(this.options.hoverClass);this._trigger("over",e,this.ui(t))}},_out:function(e){var t=M.ui.ddmanager.current;if(!t||(t.currentItem||t.element)[0]===this.element[0])return;if(this.accept.call(this.element[0],t.currentItem||t.element)){if(this.options.hoverClass)this.element.removeClass(this.options.hoverClass);this._trigger("out",e,this.ui(t))}},_drop:function(t,e){var i=e||M.ui.ddmanager.current,n=false;if(!i||(i.currentItem||i.element)[0]===this.element[0])return false;this.element.find(":data(ui-droppable)").not(".ui-draggable-dragging").each(function(){var e=M(this).droppable("instance");if(e.options.greedy&&!e.options.disabled&&e.options.scope===i.options.scope&&e.accept.call(e.element[0],i.currentItem||i.element)&&M.ui.intersect(i,M.extend(e,{offset:e.element.offset()}),e.options.tolerance,t)){n=true;return false}});if(n)return false;if(this.accept.call(this.element[0],i.currentItem||i.element)){if(this.options.activeClass)this.element.removeClass(this.options.activeClass);if(this.options.hoverClass)this.element.removeClass(this.options.hoverClass);this._trigger("drop",t,this.ui(i));return this.element}return false},ui:function(e){return{draggable:e.currentItem||e.element,helper:e.helper,position:e.position,offset:e.positionAbs}}}),M.ui.intersect=function(){function p(e,t,i){return e>=t&&e<t+i}return function(e,t,i,n){if(!t.offset)return false;var o=(e.positionAbs||e.position.absolute).left,s=(e.positionAbs||e.position.absolute).top,r=o+e.helperProportions.width,a=s+e.helperProportions.height,l=t.offset.left,c=t.offset.top,h=l+t.proportions().width,u=c+t.proportions().height;switch(i){case"fit":return l<=o&&r<=h&&c<=s&&a<=u;case"intersect":return l<o+e.helperProportions.width/2&&r-e.helperProportions.width/2<h&&c<s+e.helperProportions.height/2&&a-e.helperProportions.height/2<u;case"pointer":return p(n.pageY,c,t.proportions().height)&&p(n.pageX,l,t.proportions().width);case"touch":return(s>=c&&s<=u||a>=c&&a<=u||s<c&&a>u)&&(o>=l&&o<=h||r>=l&&r<=h||o<l&&r>h);default:return false}}}(),M.ui.ddmanager={current:null,droppables:{default:[]},prepareOffsets:function(e,t){var i,n,o=M.ui.ddmanager.droppables[e.options.scope]||[],s=t?t.type:null,r=(e.currentItem||e.element).find(":data(ui-droppable)").addBack();e:for(i=0;i<o.length;i++){if(o[i].options.disabled||e&&!o[i].accept.call(o[i].element[0],e.currentItem||e.element))continue;for(n=0;n<r.length;n++)if(r[n]===o[i].element[0]){o[i].proportions().height=0;continue e}o[i].visible=o[i].element.css("display")!=="none";if(!o[i].visible)continue;if(s==="mousedown")o[i]._activate.call(o[i],t);o[i].offset=o[i].element.offset();o[i].proportions({width:o[i].element[0].offsetWidth,height:o[i].element[0].offsetHeight})}},drop:function(e,t){var i=false;M.each((M.ui.ddmanager.droppables[e.options.scope]||[]).slice(),function(){if(!this.options)return;if(!this.options.disabled&&this.visible&&M.ui.intersect(e,this,this.options.tolerance,t))i=this._drop.call(this,t)||i;if(!this.options.disabled&&this.visible&&this.accept.call(this.element[0],e.currentItem||e.element)){this.isout=true;this.isover=false;this._deactivate.call(this,t)}});return i},dragStart:function(e,t){e.element.parentsUntil("body").bind("scroll.droppable",function(){if(!e.options.refreshPositions)M.ui.ddmanager.prepareOffsets(e,t)})},drag:function(s,r){if(s.options.refreshPositions)M.ui.ddmanager.prepareOffsets(s,r);M.each(M.ui.ddmanager.droppables[s.options.scope]||[],function(){if(this.options.disabled||this.greedyChild||!this.visible)return;var e,t,i,n=M.ui.intersect(s,this,this.options.tolerance,r),o=!n&&this.isover?"isout":n&&!this.isover?"isover":null;if(!o)return;if(this.options.greedy){t=this.options.scope;i=this.element.parents(":data(ui-droppable)").filter(function(){return M(this).droppable("instance").options.scope===t});if(i.length){e=M(i[0]).droppable("instance");e.greedyChild=o==="isover"}}if(e&&o==="isover"){e.isover=false;e.isout=true;e._out.call(e,r)}this[o]=true;this[o==="isout"?"isover":"isout"]=false;this[o==="isover"?"_over":"_out"].call(this,r);if(e&&o==="isout"){e.isout=false;e.isover=true;e._over.call(e,r)}})},dragStop:function(e,t){e.element.parentsUntil("body").unbind("scroll.droppable");if(!e.options.refreshPositions)M.ui.ddmanager.prepareOffsets(e,t)}};var c=M.ui.droppable;
/*!
 * jQuery UI Resizable 1.11.1
 * http://jqueryui.com
 *
 * Copyright 2014 jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 *
 * http://api.jqueryui.com/resizable/
 */M.widget("ui.resizable",M.ui.mouse,{version:"1.11.1",widgetEventPrefix:"resize",options:{alsoResize:false,animate:false,animateDuration:"slow",animateEasing:"swing",aspectRatio:false,autoHide:false,containment:false,ghost:false,grid:false,handles:"e,s,se",helper:false,maxHeight:null,maxWidth:null,minHeight:10,minWidth:10,zIndex:90,resize:null,start:null,stop:null},_num:function(e){return parseInt(e,10)||0},_isNumber:function(e){return!isNaN(parseInt(e,10))},_hasScroll:function(e,t){if(M(e).css("overflow")==="hidden")return false;var i=t&&t==="left"?"scrollLeft":"scrollTop",n=false;if(e[i]>0)return true;e[i]=1;n=e[i]>0;e[i]=0;return n},_create:function(){var e,t,i,n,o,s=this,r=this.options;this.element.addClass("ui-resizable");M.extend(this,{_aspectRatio:!!r.aspectRatio,aspectRatio:r.aspectRatio,originalElement:this.element,_proportionallyResizeElements:[],_helper:r.helper||r.ghost||r.animate?r.helper||"ui-resizable-helper":null});if(this.element[0].nodeName.match(/canvas|textarea|input|select|button|img/i)){this.element.wrap(M("<div class='ui-wrapper' style='overflow: hidden;'></div>").css({position:this.element.css("position"),width:this.element.outerWidth(),height:this.element.outerHeight(),top:this.element.css("top"),left:this.element.css("left")}));this.element=this.element.parent().data("ui-resizable",this.element.resizable("instance"));this.elementIsWrapper=true;this.element.css({marginLeft:this.originalElement.css("marginLeft"),marginTop:this.originalElement.css("marginTop"),marginRight:this.originalElement.css("marginRight"),marginBottom:this.originalElement.css("marginBottom")});this.originalElement.css({marginLeft:0,marginTop:0,marginRight:0,marginBottom:0});this.originalResizeStyle=this.originalElement.css("resize");this.originalElement.css("resize","none");this._proportionallyResizeElements.push(this.originalElement.css({position:"static",zoom:1,display:"block"}));this.originalElement.css({margin:this.originalElement.css("margin")});this._proportionallyResize()}this.handles=r.handles||(!M(".ui-resizable-handle",this.element).length?"e,s,se":{n:".ui-resizable-n",e:".ui-resizable-e",s:".ui-resizable-s",w:".ui-resizable-w",se:".ui-resizable-se",sw:".ui-resizable-sw",ne:".ui-resizable-ne",nw:".ui-resizable-nw"});if(this.handles.constructor===String){if(this.handles==="all")this.handles="n,e,s,w,se,sw,ne,nw";e=this.handles.split(",");this.handles={};for(t=0;t<e.length;t++){i=M.trim(e[t]);o="ui-resizable-"+i;n=M("<div class='ui-resizable-handle "+o+"'></div>");n.css({zIndex:r.zIndex});if("se"===i)n.addClass("ui-icon ui-icon-gripsmall-diagonal-se");this.handles[i]=".ui-resizable-"+i;this.element.append(n)}}this._renderAxis=function(e){var t,i,n,o;e=e||this.element;for(t in this.handles){if(this.handles[t].constructor===String)this.handles[t]=this.element.children(this.handles[t]).first().show();if(this.elementIsWrapper&&this.originalElement[0].nodeName.match(/textarea|input|select|button/i)){i=M(this.handles[t],this.element);o=/sw|ne|nw|se|n|s/.test(t)?i.outerHeight():i.outerWidth();n=["padding",/ne|nw|n/.test(t)?"Top":/se|sw|s/.test(t)?"Bottom":/^e$/.test(t)?"Right":"Left"].join("");e.css(n,o);this._proportionallyResize()}if(!M(this.handles[t]).length)continue}};this._renderAxis(this.element);this._handles=M(".ui-resizable-handle",this.element).disableSelection();this._handles.mouseover(function(){if(!s.resizing){if(this.className)n=this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i);s.axis=n&&n[1]?n[1]:"se"}});if(r.autoHide){this._handles.hide();M(this.element).addClass("ui-resizable-autohide").mouseenter(function(){if(r.disabled)return;M(this).removeClass("ui-resizable-autohide");s._handles.show()}).mouseleave(function(){if(r.disabled)return;if(!s.resizing){M(this).addClass("ui-resizable-autohide");s._handles.hide()}})}this._mouseInit()},_destroy:function(){this._mouseDestroy();var e,t=function(e){M(e).removeClass("ui-resizable ui-resizable-disabled ui-resizable-resizing").removeData("resizable").removeData("ui-resizable").unbind(".resizable").find(".ui-resizable-handle").remove()};if(this.elementIsWrapper){t(this.element);e=this.element;this.originalElement.css({position:e.css("position"),width:e.outerWidth(),height:e.outerHeight(),top:e.css("top"),left:e.css("left")}).insertAfter(e);e.remove()}this.originalElement.css("resize",this.originalResizeStyle);t(this.originalElement);return this},_mouseCapture:function(e){var t,i,n=false;for(t in this.handles){i=M(this.handles[t])[0];if(i===e.target||M.contains(i,e.target))n=true}return!this.options.disabled&&n},_mouseStart:function(e){var t,i,n,o=this.options,s=this.element;this.resizing=true;this._renderProxy();t=this._num(this.helper.css("left"));i=this._num(this.helper.css("top"));if(o.containment){t+=M(o.containment).scrollLeft()||0;i+=M(o.containment).scrollTop()||0}this.offset=this.helper.offset();this.position={left:t,top:i};this.size=this._helper?{width:this.helper.width(),height:this.helper.height()}:{width:s.width(),height:s.height()};this.originalSize=this._helper?{width:s.outerWidth(),height:s.outerHeight()}:{width:s.width(),height:s.height()};this.sizeDiff={width:s.outerWidth()-s.width(),height:s.outerHeight()-s.height()};this.originalPosition={left:t,top:i};this.originalMousePosition={left:e.pageX,top:e.pageY};this.aspectRatio=typeof o.aspectRatio==="number"?o.aspectRatio:this.originalSize.width/this.originalSize.height||1;n=M(".ui-resizable-"+this.axis).css("cursor");M("body").css("cursor",n==="auto"?this.axis+"-resize":n);s.addClass("ui-resizable-resizing");this._propagate("start",e);return true},_mouseDrag:function(e){var t,i,n=this.originalMousePosition,o=this.axis,s=e.pageX-n.left||0,r=e.pageY-n.top||0,a=this._change[o];this._updatePrevProperties();if(!a)return false;t=a.apply(this,[e,s,r]);this._updateVirtualBoundaries(e.shiftKey);if(this._aspectRatio||e.shiftKey)t=this._updateRatio(t,e);t=this._respectSize(t,e);this._updateCache(t);this._propagate("resize",e);i=this._applyChanges();if(!this._helper&&this._proportionallyResizeElements.length)this._proportionallyResize();if(!M.isEmptyObject(i)){this._updatePrevProperties();this._trigger("resize",e,this.ui());this._applyChanges()}return false},_mouseStop:function(e){this.resizing=false;var t,i,n,o,s,r,a,l=this.options,c=this;if(this._helper){t=this._proportionallyResizeElements;i=t.length&&/textarea/i.test(t[0].nodeName);n=i&&this._hasScroll(t[0],"left")?0:c.sizeDiff.height;o=i?0:c.sizeDiff.width;s={width:c.helper.width()-o,height:c.helper.height()-n};r=parseInt(c.element.css("left"),10)+(c.position.left-c.originalPosition.left)||null;a=parseInt(c.element.css("top"),10)+(c.position.top-c.originalPosition.top)||null;if(!l.animate)this.element.css(M.extend(s,{top:a,left:r}));c.helper.height(c.size.height);c.helper.width(c.size.width);if(this._helper&&!l.animate)this._proportionallyResize()}M("body").css("cursor","auto");this.element.removeClass("ui-resizable-resizing");this._propagate("stop",e);if(this._helper)this.helper.remove();return false},_updatePrevProperties:function(){this.prevPosition={top:this.position.top,left:this.position.left};this.prevSize={width:this.size.width,height:this.size.height}},_applyChanges:function(){var e={};if(this.position.top!==this.prevPosition.top)e.top=this.position.top+"px";if(this.position.left!==this.prevPosition.left)e.left=this.position.left+"px";if(this.size.width!==this.prevSize.width)e.width=this.size.width+"px";if(this.size.height!==this.prevSize.height)e.height=this.size.height+"px";this.helper.css(e);return e},_updateVirtualBoundaries:function(e){var t,i,n,o,s,r=this.options;s={minWidth:this._isNumber(r.minWidth)?r.minWidth:0,maxWidth:this._isNumber(r.maxWidth)?r.maxWidth:Infinity,minHeight:this._isNumber(r.minHeight)?r.minHeight:0,maxHeight:this._isNumber(r.maxHeight)?r.maxHeight:Infinity};if(this._aspectRatio||e){t=s.minHeight*this.aspectRatio;n=s.minWidth/this.aspectRatio;i=s.maxHeight*this.aspectRatio;o=s.maxWidth/this.aspectRatio;if(t>s.minWidth)s.minWidth=t;if(n>s.minHeight)s.minHeight=n;if(i<s.maxWidth)s.maxWidth=i;if(o<s.maxHeight)s.maxHeight=o}this._vBoundaries=s},_updateCache:function(e){this.offset=this.helper.offset();if(this._isNumber(e.left))this.position.left=e.left;if(this._isNumber(e.top))this.position.top=e.top;if(this._isNumber(e.height))this.size.height=e.height;if(this._isNumber(e.width))this.size.width=e.width},_updateRatio:function(e){var t=this.position,i=this.size,n=this.axis;if(this._isNumber(e.height))e.width=e.height*this.aspectRatio;else if(this._isNumber(e.width))e.height=e.width/this.aspectRatio;if(n==="sw"){e.left=t.left+(i.width-e.width);e.top=null}if(n==="nw"){e.top=t.top+(i.height-e.height);e.left=t.left+(i.width-e.width)}return e},_respectSize:function(e){var t=this._vBoundaries,i=this.axis,n=this._isNumber(e.width)&&t.maxWidth&&t.maxWidth<e.width,o=this._isNumber(e.height)&&t.maxHeight&&t.maxHeight<e.height,s=this._isNumber(e.width)&&t.minWidth&&t.minWidth>e.width,r=this._isNumber(e.height)&&t.minHeight&&t.minHeight>e.height,a=this.originalPosition.left+this.originalSize.width,l=this.position.top+this.size.height,c=/sw|nw|w/.test(i),h=/nw|ne|n/.test(i);if(s)e.width=t.minWidth;if(r)e.height=t.minHeight;if(n)e.width=t.maxWidth;if(o)e.height=t.maxHeight;if(s&&c)e.left=a-t.minWidth;if(n&&c)e.left=a-t.maxWidth;if(r&&h)e.top=l-t.minHeight;if(o&&h)e.top=l-t.maxHeight;if(!e.width&&!e.height&&!e.left&&e.top)e.top=null;else if(!e.width&&!e.height&&!e.top&&e.left)e.left=null;return e},_getPaddingPlusBorderDimensions:function(e){var t=0,i=[],n=[e.css("borderTopWidth"),e.css("borderRightWidth"),e.css("borderBottomWidth"),e.css("borderLeftWidth")],o=[e.css("paddingTop"),e.css("paddingRight"),e.css("paddingBottom"),e.css("paddingLeft")];for(;t<4;t++){i[t]=parseInt(n[t],10)||0;i[t]+=parseInt(o[t],10)||0}return{height:i[0]+i[2],width:i[1]+i[3]}},_proportionallyResize:function(){if(!this._proportionallyResizeElements.length)return;var e,t=0,i=this.helper||this.element;for(;t<this._proportionallyResizeElements.length;t++){e=this._proportionallyResizeElements[t];if(!this.outerDimensions)this.outerDimensions=this._getPaddingPlusBorderDimensions(e);e.css({height:i.height()-this.outerDimensions.height||0,width:i.width()-this.outerDimensions.width||0})}},_renderProxy:function(){var e=this.element,t=this.options;this.elementOffset=e.offset();if(this._helper){this.helper=this.helper||M("<div style='overflow:hidden;'></div>");this.helper.addClass(this._helper).css({width:this.element.outerWidth()-1,height:this.element.outerHeight()-1,position:"absolute",left:this.elementOffset.left+"px",top:this.elementOffset.top+"px",zIndex:++t.zIndex});this.helper.appendTo("body").disableSelection()}else this.helper=this.element},_change:{e:function(e,t){return{width:this.originalSize.width+t}},w:function(e,t){var i=this.originalSize,n=this.originalPosition;return{left:n.left+t,width:i.width-t}},n:function(e,t,i){var n=this.originalSize,o=this.originalPosition;return{top:o.top+i,height:n.height-i}},s:function(e,t,i){return{height:this.originalSize.height+i}},se:function(e,t,i){return M.extend(this._change.s.apply(this,arguments),this._change.e.apply(this,[e,t,i]))},sw:function(e,t,i){return M.extend(this._change.s.apply(this,arguments),this._change.w.apply(this,[e,t,i]))},ne:function(e,t,i){return M.extend(this._change.n.apply(this,arguments),this._change.e.apply(this,[e,t,i]))},nw:function(e,t,i){return M.extend(this._change.n.apply(this,arguments),this._change.w.apply(this,[e,t,i]))}},_propagate:function(e,t){M.ui.plugin.call(this,e,[t,this.ui()]);e!=="resize"&&this._trigger(e,t,this.ui())},plugins:{},ui:function(){return{originalElement:this.originalElement,element:this.element,helper:this.helper,position:this.position,size:this.size,originalSize:this.originalSize,originalPosition:this.originalPosition}}}),M.ui.plugin.add("resizable","animate",{stop:function(t){var i=M(this).resizable("instance"),e=i.options,n=i._proportionallyResizeElements,o=n.length&&/textarea/i.test(n[0].nodeName),s=o&&i._hasScroll(n[0],"left")?0:i.sizeDiff.height,r=o?0:i.sizeDiff.width,a={width:i.size.width-r,height:i.size.height-s},l=parseInt(i.element.css("left"),10)+(i.position.left-i.originalPosition.left)||null,c=parseInt(i.element.css("top"),10)+(i.position.top-i.originalPosition.top)||null;i.element.animate(M.extend(a,c&&l?{top:c,left:l}:{}),{duration:e.animateDuration,easing:e.animateEasing,step:function(){var e={width:parseInt(i.element.css("width"),10),height:parseInt(i.element.css("height"),10),top:parseInt(i.element.css("top"),10),left:parseInt(i.element.css("left"),10)};if(n&&n.length)M(n[0]).css({width:e.width,height:e.height});i._updateCache(e);i._propagate("resize",t)}})}}),M.ui.plugin.add("resizable","containment",{start:function(){var i,n,e,t,o,s,r,a=M(this).resizable("instance"),l=a.options,c=a.element,h=l.containment,u=h instanceof M?h.get(0):/parent/.test(h)?c.parent().get(0):h;if(!u)return;a.containerElement=M(u);if(/document/.test(h)||h===document){a.containerOffset={left:0,top:0};a.containerPosition={left:0,top:0};a.parentData={element:M(document),left:0,top:0,width:M(document).width(),height:M(document).height()||document.body.parentNode.scrollHeight}}else{i=M(u);n=[];M(["Top","Right","Left","Bottom"]).each(function(e,t){n[e]=a._num(i.css("padding"+t))});a.containerOffset=i.offset();a.containerPosition=i.position();a.containerSize={height:i.innerHeight()-n[3],width:i.innerWidth()-n[1]};e=a.containerOffset;t=a.containerSize.height;o=a.containerSize.width;s=a._hasScroll(u,"left")?u.scrollWidth:o;r=a._hasScroll(u)?u.scrollHeight:t;a.parentData={element:u,left:e.left,top:e.top,width:s,height:r}}},resize:function(e){var t,i,n,o,s=M(this).resizable("instance"),r=s.options,a=s.containerOffset,l=s.position,c=s._aspectRatio||e.shiftKey,h={top:0,left:0},u=s.containerElement,p=true;if(u[0]!==document&&/static/.test(u.css("position")))h=a;if(l.left<(s._helper?a.left:0)){s.size.width=s.size.width+(s._helper?s.position.left-a.left:s.position.left-h.left);if(c){s.size.height=s.size.width/s.aspectRatio;p=false}s.position.left=r.helper?a.left:0}if(l.top<(s._helper?a.top:0)){s.size.height=s.size.height+(s._helper?s.position.top-a.top:s.position.top);if(c){s.size.width=s.size.height*s.aspectRatio;p=false}s.position.top=s._helper?a.top:0}n=s.containerElement.get(0)===s.element.parent().get(0);o=/relative|absolute/.test(s.containerElement.css("position"));if(n&&o){s.offset.left=s.parentData.left+s.position.left;s.offset.top=s.parentData.top+s.position.top}else{s.offset.left=s.element.offset().left;s.offset.top=s.element.offset().top}t=Math.abs(s.sizeDiff.width+(s._helper?s.offset.left-h.left:s.offset.left-a.left));i=Math.abs(s.sizeDiff.height+(s._helper?s.offset.top-h.top:s.offset.top-a.top));if(t+s.size.width>=s.parentData.width){s.size.width=s.parentData.width-t;if(c){s.size.height=s.size.width/s.aspectRatio;p=false}}if(i+s.size.height>=s.parentData.height){s.size.height=s.parentData.height-i;if(c){s.size.width=s.size.height*s.aspectRatio;p=false}}if(!p){s.position.left=s.prevPosition.left;s.position.top=s.prevPosition.top;s.size.width=s.prevSize.width;s.size.height=s.prevSize.height}},stop:function(){var e=M(this).resizable("instance"),t=e.options,i=e.containerOffset,n=e.containerPosition,o=e.containerElement,s=M(e.helper),r=s.offset(),a=s.outerWidth()-e.sizeDiff.width,l=s.outerHeight()-e.sizeDiff.height;if(e._helper&&!t.animate&&/relative/.test(o.css("position")))M(this).css({left:r.left-n.left-i.left,width:a,height:l});if(e._helper&&!t.animate&&/static/.test(o.css("position")))M(this).css({left:r.left-n.left-i.left,width:a,height:l})}}),M.ui.plugin.add("resizable","alsoResize",{start:function(){var e=M(this).resizable("instance"),t=e.options,i=function(e){M(e).each(function(){var e=M(this);e.data("ui-resizable-alsoresize",{width:parseInt(e.width(),10),height:parseInt(e.height(),10),left:parseInt(e.css("left"),10),top:parseInt(e.css("top"),10)})})};if(typeof t.alsoResize==="object"&&!t.alsoResize.parentNode)if(t.alsoResize.length){t.alsoResize=t.alsoResize[0];i(t.alsoResize)}else M.each(t.alsoResize,function(e){i(e)});else i(t.alsoResize)},resize:function(e,s){var t=M(this).resizable("instance"),i=t.options,n=t.originalSize,o=t.originalPosition,r={height:t.size.height-n.height||0,width:t.size.width-n.width||0,top:t.position.top-o.top||0,left:t.position.left-o.left||0},a=function(e,i){M(e).each(function(){var e=M(this),n=M(this).data("ui-resizable-alsoresize"),o={},t=i&&i.length?i:e.parents(s.originalElement[0]).length?["width","height"]:["width","height","top","left"];M.each(t,function(e,t){var i=(n[t]||0)+(r[t]||0);if(i&&i>=0)o[t]=i||null});e.css(o)})};if(typeof i.alsoResize==="object"&&!i.alsoResize.nodeType)M.each(i.alsoResize,function(e,t){a(e,t)});else a(i.alsoResize)},stop:function(){M(this).removeData("resizable-alsoresize")}}),M.ui.plugin.add("resizable","ghost",{start:function(){var e=M(this).resizable("instance"),t=e.options,i=e.size;e.ghost=e.originalElement.clone();e.ghost.css({opacity:.25,display:"block",position:"relative",height:i.height,width:i.width,margin:0,left:0,top:0}).addClass("ui-resizable-ghost").addClass(typeof t.ghost==="string"?t.ghost:"");e.ghost.appendTo(e.helper)},resize:function(){var e=M(this).resizable("instance");if(e.ghost)e.ghost.css({position:"relative",height:e.size.height,width:e.size.width})},stop:function(){var e=M(this).resizable("instance");if(e.ghost&&e.helper)e.helper.get(0).removeChild(e.ghost.get(0))}}),M.ui.plugin.add("resizable","grid",{resize:function(){var e,t=M(this).resizable("instance"),i=t.options,n=t.size,o=t.originalSize,s=t.originalPosition,r=t.axis,a=typeof i.grid==="number"?[i.grid,i.grid]:i.grid,l=a[0]||1,c=a[1]||1,h=Math.round((n.width-o.width)/l)*l,u=Math.round((n.height-o.height)/c)*c,p=o.width+h,d=o.height+u,m=i.maxWidth&&i.maxWidth<p,f=i.maxHeight&&i.maxHeight<d,g=i.minWidth&&i.minWidth>p,y=i.minHeight&&i.minHeight>d;i.grid=a;if(g)p+=l;if(y)d+=c;if(m)p-=l;if(f)d-=c;if(/^(se|s|e)$/.test(r)){t.size.width=p;t.size.height=d}else if(/^(ne)$/.test(r)){t.size.width=p;t.size.height=d;t.position.top=s.top-u}else if(/^(sw)$/.test(r)){t.size.width=p;t.size.height=d;t.position.left=s.left-h}else{if(d-c<=0||p-l<=0)e=t._getPaddingPlusBorderDimensions(this);if(d-c>0){t.size.height=d;t.position.top=s.top-u}else{d=c-e.height;t.size.height=d;t.position.top=s.top+o.height-d}if(p-l>0){t.size.width=p;t.position.left=s.left-h}else{p=c-e.height;t.size.width=p;t.position.left=s.left+o.width-p}}}});var h=M.ui.resizable,u=M.widget("ui.sortable",M.ui.mouse,{version:"1.11.1",widgetEventPrefix:"sort",ready:false,options:{appendTo:"parent",axis:false,connectWith:false,containment:false,cursor:"auto",cursorAt:false,dropOnEmpty:true,forcePlaceholderSize:false,forceHelperSize:false,grid:false,handle:false,helper:"original",items:"> *",opacity:false,placeholder:false,revert:false,scroll:true,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1e3,activate:null,beforeStop:null,change:null,deactivate:null,out:null,over:null,receive:null,remove:null,sort:null,start:null,stop:null,update:null},_isOverAxis:function(e,t,i){return e>=t&&e<t+i},_isFloating:function(e){return/left|right/.test(e.css("float"))||/inline|table-cell/.test(e.css("display"))},_create:function(){var e=this.options;this.containerCache={};this.element.addClass("ui-sortable");this.refresh();this.floating=this.items.length?e.axis==="x"||this._isFloating(this.items[0].item):false;this.offset=this.element.offset();this._mouseInit();this._setHandleClassName();this.ready=true},_setOption:function(e,t){this._super(e,t);if(e==="handle")this._setHandleClassName()},_setHandleClassName:function(){this.element.find(".ui-sortable-handle").removeClass("ui-sortable-handle");M.each(this.items,function(){(this.instance.options.handle?this.item.find(this.instance.options.handle):this.item).addClass("ui-sortable-handle")})},_destroy:function(){this.element.removeClass("ui-sortable ui-sortable-disabled").find(".ui-sortable-handle").removeClass("ui-sortable-handle");this._mouseDestroy();for(var e=this.items.length-1;e>=0;e--)this.items[e].item.removeData(this.widgetName+"-item");return this},_mouseCapture:function(e,t){var i=null,n=false,o=this;if(this.reverting)return false;if(this.options.disabled||this.options.type==="static")return false;this._refreshItems(e);M(e.target).parents().each(function(){if(M.data(this,o.widgetName+"-item")===o){i=M(this);return false}});if(M.data(e.target,o.widgetName+"-item")===o)i=M(e.target);if(!i)return false;if(this.options.handle&&!t){M(this.options.handle,i).find("*").addBack().each(function(){if(this===e.target)n=true});if(!n)return false}this.currentItem=i;this._removeCurrentsFromItems();return true},_mouseStart:function(e,t,i){var n,o,s=this.options;this.currentContainer=this;this.refreshPositions();this.helper=this._createHelper(e);this._cacheHelperProportions();this._cacheMargins();this.scrollParent=this.helper.scrollParent();this.offset=this.currentItem.offset();this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left};M.extend(this.offset,{click:{left:e.pageX-this.offset.left,top:e.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()});this.helper.css("position","absolute");this.cssPosition=this.helper.css("position");this.originalPosition=this._generatePosition(e);this.originalPageX=e.pageX;this.originalPageY=e.pageY;s.cursorAt&&this._adjustOffsetFromHelper(s.cursorAt);this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]};if(this.helper[0]!==this.currentItem[0])this.currentItem.hide();this._createPlaceholder();if(s.containment)this._setContainment();if(s.cursor&&s.cursor!=="auto"){o=this.document.find("body");this.storedCursor=o.css("cursor");o.css("cursor",s.cursor);this.storedStylesheet=M("<style>*{ cursor: "+s.cursor+" !important; }</style>").appendTo(o)}if(s.opacity){if(this.helper.css("opacity"))this._storedOpacity=this.helper.css("opacity");this.helper.css("opacity",s.opacity)}if(s.zIndex){if(this.helper.css("zIndex"))this._storedZIndex=this.helper.css("zIndex");this.helper.css("zIndex",s.zIndex)}if(this.scrollParent[0]!==document&&this.scrollParent[0].tagName!=="HTML")this.overflowOffset=this.scrollParent.offset();this._trigger("start",e,this._uiHash());if(!this._preserveHelperProportions)this._cacheHelperProportions();if(!i)for(n=this.containers.length-1;n>=0;n--)this.containers[n]._trigger("activate",e,this._uiHash(this));if(M.ui.ddmanager)M.ui.ddmanager.current=this;if(M.ui.ddmanager&&!s.dropBehaviour)M.ui.ddmanager.prepareOffsets(this,e);this.dragging=true;this.helper.addClass("ui-sortable-helper");this._mouseDrag(e);return true},_mouseDrag:function(e){var t,i,n,o,s=this.options,r=false;this.position=this._generatePosition(e);this.positionAbs=this._convertPositionTo("absolute");if(!this.lastPositionAbs)this.lastPositionAbs=this.positionAbs;if(this.options.scroll){if(this.scrollParent[0]!==document&&this.scrollParent[0].tagName!=="HTML"){if(this.overflowOffset.top+this.scrollParent[0].offsetHeight-e.pageY<s.scrollSensitivity)this.scrollParent[0].scrollTop=r=this.scrollParent[0].scrollTop+s.scrollSpeed;else if(e.pageY-this.overflowOffset.top<s.scrollSensitivity)this.scrollParent[0].scrollTop=r=this.scrollParent[0].scrollTop-s.scrollSpeed;if(this.overflowOffset.left+this.scrollParent[0].offsetWidth-e.pageX<s.scrollSensitivity)this.scrollParent[0].scrollLeft=r=this.scrollParent[0].scrollLeft+s.scrollSpeed;else if(e.pageX-this.overflowOffset.left<s.scrollSensitivity)this.scrollParent[0].scrollLeft=r=this.scrollParent[0].scrollLeft-s.scrollSpeed}else{if(e.pageY-M(document).scrollTop()<s.scrollSensitivity)r=M(document).scrollTop(M(document).scrollTop()-s.scrollSpeed);else if(M(window).height()-(e.pageY-M(document).scrollTop())<s.scrollSensitivity)r=M(document).scrollTop(M(document).scrollTop()+s.scrollSpeed);if(e.pageX-M(document).scrollLeft()<s.scrollSensitivity)r=M(document).scrollLeft(M(document).scrollLeft()-s.scrollSpeed);else if(M(window).width()-(e.pageX-M(document).scrollLeft())<s.scrollSensitivity)r=M(document).scrollLeft(M(document).scrollLeft()+s.scrollSpeed)}if(r!==false&&M.ui.ddmanager&&!s.dropBehaviour)M.ui.ddmanager.prepareOffsets(this,e)}this.positionAbs=this._convertPositionTo("absolute");if(!this.options.axis||this.options.axis!=="y")this.helper[0].style.left=this.position.left+"px";if(!this.options.axis||this.options.axis!=="x")this.helper[0].style.top=this.position.top+"px";for(t=this.items.length-1;t>=0;t--){i=this.items[t];n=i.item[0];o=this._intersectsWithPointer(i);if(!o)continue;if(i.instance!==this.currentContainer)continue;if(n!==this.currentItem[0]&&this.placeholder[o===1?"next":"prev"]()[0]!==n&&!M.contains(this.placeholder[0],n)&&(this.options.type==="semi-dynamic"?!M.contains(this.element[0],n):true)){this.direction=o===1?"down":"up";if(this.options.tolerance==="pointer"||this._intersectsWithSides(i))this._rearrange(e,i);else break;this._trigger("change",e,this._uiHash());break}}this._contactContainers(e);if(M.ui.ddmanager)M.ui.ddmanager.drag(this,e);this._trigger("sort",e,this._uiHash());this.lastPositionAbs=this.positionAbs;return false},_mouseStop:function(e,t){if(!e)return;if(M.ui.ddmanager&&!this.options.dropBehaviour)M.ui.ddmanager.drop(this,e);if(this.options.revert){var i=this,n=this.placeholder.offset(),o=this.options.axis,s={};if(!o||o==="x")s.left=n.left-this.offset.parent.left-this.margins.left+(this.offsetParent[0]===document.body?0:this.offsetParent[0].scrollLeft);if(!o||o==="y")s.top=n.top-this.offset.parent.top-this.margins.top+(this.offsetParent[0]===document.body?0:this.offsetParent[0].scrollTop);this.reverting=true;M(this.helper).animate(s,parseInt(this.options.revert,10)||500,function(){i._clear(e)})}else this._clear(e,t);return false},cancel:function(){if(this.dragging){this._mouseUp({target:null});if(this.options.helper==="original")this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper");else this.currentItem.show();for(var e=this.containers.length-1;e>=0;e--){this.containers[e]._trigger("deactivate",null,this._uiHash(this));if(this.containers[e].containerCache.over){this.containers[e]._trigger("out",null,this._uiHash(this));this.containers[e].containerCache.over=0}}}if(this.placeholder){if(this.placeholder[0].parentNode)this.placeholder[0].parentNode.removeChild(this.placeholder[0]);if(this.options.helper!=="original"&&this.helper&&this.helper[0].parentNode)this.helper.remove();M.extend(this,{helper:null,dragging:false,reverting:false,_noFinalSort:null});if(this.domPosition.prev)M(this.domPosition.prev).after(this.currentItem);else M(this.domPosition.parent).prepend(this.currentItem)}return this},serialize:function(t){var e=this._getItemsAsjQuery(t&&t.connected),i=[];t=t||{};M(e).each(function(){var e=(M(t.item||this).attr(t.attribute||"id")||"").match(t.expression||/(.+)[\-=_](.+)/);if(e)i.push((t.key||e[1]+"[]")+"="+(t.key&&t.expression?e[1]:e[2]))});if(!i.length&&t.key)i.push(t.key+"=");return i.join("&")},toArray:function(e){var t=this._getItemsAsjQuery(e&&e.connected),i=[];e=e||{};t.each(function(){i.push(M(e.item||this).attr(e.attribute||"id")||"")});return i},_intersectsWith:function(e){var t=this.positionAbs.left,i=t+this.helperProportions.width,n=this.positionAbs.top,o=n+this.helperProportions.height,s=e.left,r=s+e.width,a=e.top,l=a+e.height,c=this.offset.click.top,h=this.offset.click.left,u=this.options.axis==="x"||n+c>a&&n+c<l,p=this.options.axis==="y"||t+h>s&&t+h<r,d=u&&p;if(this.options.tolerance==="pointer"||this.options.forcePointerForContainers||this.options.tolerance!=="pointer"&&this.helperProportions[this.floating?"width":"height"]>e[this.floating?"width":"height"])return d;else return s<t+this.helperProportions.width/2&&i-this.helperProportions.width/2<r&&a<n+this.helperProportions.height/2&&o-this.helperProportions.height/2<l},_intersectsWithPointer:function(e){var t=this.options.axis==="x"||this._isOverAxis(this.positionAbs.top+this.offset.click.top,e.top,e.height),i=this.options.axis==="y"||this._isOverAxis(this.positionAbs.left+this.offset.click.left,e.left,e.width),n=t&&i,o=this._getDragVerticalDirection(),s=this._getDragHorizontalDirection();if(!n)return false;return this.floating?s&&s==="right"||o==="down"?2:1:o&&(o==="down"?2:1)},_intersectsWithSides:function(e){var t=this._isOverAxis(this.positionAbs.top+this.offset.click.top,e.top+e.height/2,e.height),i=this._isOverAxis(this.positionAbs.left+this.offset.click.left,e.left+e.width/2,e.width),n=this._getDragVerticalDirection(),o=this._getDragHorizontalDirection();if(this.floating&&o)return o==="right"&&i||o==="left"&&!i;else return n&&(n==="down"&&t||n==="up"&&!t)},_getDragVerticalDirection:function(){var e=this.positionAbs.top-this.lastPositionAbs.top;return e!==0&&(e>0?"down":"up")},_getDragHorizontalDirection:function(){var e=this.positionAbs.left-this.lastPositionAbs.left;return e!==0&&(e>0?"right":"left")},refresh:function(e){this._refreshItems(e);this._setHandleClassName();this.refreshPositions();return this},_connectWith:function(){var e=this.options;return e.connectWith.constructor===String?[e.connectWith]:e.connectWith},_getItemsAsjQuery:function(e){var t,i,n,o,s=[],r=[],a=this._connectWith();if(a&&e)for(t=a.length-1;t>=0;t--){n=M(a[t]);for(i=n.length-1;i>=0;i--){o=M.data(n[i],this.widgetFullName);if(o&&o!==this&&!o.options.disabled)r.push([M.isFunction(o.options.items)?o.options.items.call(o.element):M(o.options.items,o.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),o])}}r.push([M.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):M(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]);function l(){s.push(this)}for(t=r.length-1;t>=0;t--)r[t][0].each(l);return M(s)},_removeCurrentsFromItems:function(){var i=this.currentItem.find(":data("+this.widgetName+"-item)");this.items=M.grep(this.items,function(e){for(var t=0;t<i.length;t++)if(i[t]===e.item[0])return false;return true})},_refreshItems:function(e){this.items=[];this.containers=[this];var t,i,n,o,s,r,a,l,c=this.items,h=[[M.isFunction(this.options.items)?this.options.items.call(this.element[0],e,{item:this.currentItem}):M(this.options.items,this.element),this]],u=this._connectWith();if(u&&this.ready)for(t=u.length-1;t>=0;t--){n=M(u[t]);for(i=n.length-1;i>=0;i--){o=M.data(n[i],this.widgetFullName);if(o&&o!==this&&!o.options.disabled){h.push([M.isFunction(o.options.items)?o.options.items.call(o.element[0],e,{item:this.currentItem}):M(o.options.items,o.element),o]);this.containers.push(o)}}}for(t=h.length-1;t>=0;t--){s=h[t][1];r=h[t][0];for(i=0,l=r.length;i<l;i++){a=M(r[i]);a.data(this.widgetName+"-item",s);c.push({item:a,instance:s,width:0,height:0,left:0,top:0})}}},refreshPositions:function(e){if(this.offsetParent&&this.helper)this.offset.parent=this._getParentOffset();var t,i,n,o;for(t=this.items.length-1;t>=0;t--){i=this.items[t];if(i.instance!==this.currentContainer&&this.currentContainer&&i.item[0]!==this.currentItem[0])continue;n=this.options.toleranceElement?M(this.options.toleranceElement,i.item):i.item;if(!e){i.width=n.outerWidth();i.height=n.outerHeight()}o=n.offset();i.left=o.left;i.top=o.top}if(this.options.custom&&this.options.custom.refreshContainers)this.options.custom.refreshContainers.call(this);else for(t=this.containers.length-1;t>=0;t--){o=this.containers[t].element.offset();this.containers[t].containerCache.left=o.left;this.containers[t].containerCache.top=o.top;this.containers[t].containerCache.width=this.containers[t].element.outerWidth();this.containers[t].containerCache.height=this.containers[t].element.outerHeight()}return this},_createPlaceholder:function(i){i=i||this;var n,o=i.options;if(!o.placeholder||o.placeholder.constructor===String){n=o.placeholder;o.placeholder={element:function(){var e=i.currentItem[0].nodeName.toLowerCase(),t=M("<"+e+">",i.document[0]).addClass(n||i.currentItem[0].className+" ui-sortable-placeholder").removeClass("ui-sortable-helper");if(e==="tr")i.currentItem.children().each(function(){M("<td>&#160;</td>",i.document[0]).attr("colspan",M(this).attr("colspan")||1).appendTo(t)});else if(e==="img")t.attr("src",i.currentItem.attr("src"));if(!n)t.css("visibility","hidden");return t},update:function(e,t){if(n&&!o.forcePlaceholderSize)return;if(!t.height())t.height(i.currentItem.innerHeight()-parseInt(i.currentItem.css("paddingTop")||0,10)-parseInt(i.currentItem.css("paddingBottom")||0,10));if(!t.width())t.width(i.currentItem.innerWidth()-parseInt(i.currentItem.css("paddingLeft")||0,10)-parseInt(i.currentItem.css("paddingRight")||0,10))}}}i.placeholder=M(o.placeholder.element.call(i.element,i.currentItem));i.currentItem.after(i.placeholder);o.placeholder.update(i,i.placeholder)},_contactContainers:function(e){var t,i,n,o,s,r,a,l,c,h,u=null,p=null;for(t=this.containers.length-1;t>=0;t--){if(M.contains(this.currentItem[0],this.containers[t].element[0]))continue;if(this._intersectsWith(this.containers[t].containerCache)){if(u&&M.contains(this.containers[t].element[0],u.element[0]))continue;u=this.containers[t];p=t}else if(this.containers[t].containerCache.over){this.containers[t]._trigger("out",e,this._uiHash(this));this.containers[t].containerCache.over=0}}if(!u)return;if(this.containers.length===1){if(!this.containers[p].containerCache.over){this.containers[p]._trigger("over",e,this._uiHash(this));this.containers[p].containerCache.over=1}}else{n=1e4;o=null;c=u.floating||this._isFloating(this.currentItem);s=c?"left":"top";r=c?"width":"height";h=c?"clientX":"clientY";for(i=this.items.length-1;i>=0;i--){if(!M.contains(this.containers[p].element[0],this.items[i].item[0]))continue;if(this.items[i].item[0]===this.currentItem[0])continue;a=this.items[i].item.offset()[s];l=false;if(e[h]-a>this.items[i][r]/2)l=true;if(Math.abs(e[h]-a)<n){n=Math.abs(e[h]-a);o=this.items[i];this.direction=l?"up":"down"}}if(!o&&!this.options.dropOnEmpty)return;if(this.currentContainer===this.containers[p])return;o?this._rearrange(e,o,null,true):this._rearrange(e,null,this.containers[p].element,true);this._trigger("change",e,this._uiHash());this.containers[p]._trigger("change",e,this._uiHash(this));this.currentContainer=this.containers[p];this.options.placeholder.update(this.currentContainer,this.placeholder);this.containers[p]._trigger("over",e,this._uiHash(this));this.containers[p].containerCache.over=1}},_createHelper:function(e){var t=this.options,i=M.isFunction(t.helper)?M(t.helper.apply(this.element[0],[e,this.currentItem])):t.helper==="clone"?this.currentItem.clone():this.currentItem;if(!i.parents("body").length)M(t.appendTo!=="parent"?t.appendTo:this.currentItem[0].parentNode)[0].appendChild(i[0]);if(i[0]===this.currentItem[0])this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")};if(!i[0].style.width||t.forceHelperSize)i.width(this.currentItem.width());if(!i[0].style.height||t.forceHelperSize)i.height(this.currentItem.height());return i},_adjustOffsetFromHelper:function(e){if(typeof e==="string")e=e.split(" ");if(M.isArray(e))e={left:+e[0],top:+e[1]||0};if("left"in e)this.offset.click.left=e.left+this.margins.left;if("right"in e)this.offset.click.left=this.helperProportions.width-e.right+this.margins.left;if("top"in e)this.offset.click.top=e.top+this.margins.top;if("bottom"in e)this.offset.click.top=this.helperProportions.height-e.bottom+this.margins.top},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var e=this.offsetParent.offset();if(this.cssPosition==="absolute"&&this.scrollParent[0]!==document&&M.contains(this.scrollParent[0],this.offsetParent[0])){e.left+=this.scrollParent.scrollLeft();e.top+=this.scrollParent.scrollTop()}if(this.offsetParent[0]===document.body||this.offsetParent[0].tagName&&this.offsetParent[0].tagName.toLowerCase()==="html"&&M.ui.ie)e={top:0,left:0};return{top:e.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:e.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if(this.cssPosition==="relative"){var e=this.currentItem.position();return{top:e.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:e.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}else return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var e,t,i,n=this.options;if(n.containment==="parent")n.containment=this.helper[0].parentNode;if(n.containment==="document"||n.containment==="window")this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,M(n.containment==="document"?document:window).width()-this.helperProportions.width-this.margins.left,(M(n.containment==="document"?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top];if(!/^(document|window|parent)$/.test(n.containment)){e=M(n.containment)[0];t=M(n.containment).offset();i=M(e).css("overflow")!=="hidden";this.containment=[t.left+(parseInt(M(e).css("borderLeftWidth"),10)||0)+(parseInt(M(e).css("paddingLeft"),10)||0)-this.margins.left,t.top+(parseInt(M(e).css("borderTopWidth"),10)||0)+(parseInt(M(e).css("paddingTop"),10)||0)-this.margins.top,t.left+(i?Math.max(e.scrollWidth,e.offsetWidth):e.offsetWidth)-(parseInt(M(e).css("borderLeftWidth"),10)||0)-(parseInt(M(e).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,t.top+(i?Math.max(e.scrollHeight,e.offsetHeight):e.offsetHeight)-(parseInt(M(e).css("borderTopWidth"),10)||0)-(parseInt(M(e).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top]}},_convertPositionTo:function(e,t){if(!t)t=this.position;var i=e==="absolute"?1:-1,n=this.cssPosition==="absolute"&&!(this.scrollParent[0]!==document&&M.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent,o=/(html|body)/i.test(n[0].tagName);return{top:t.top+this.offset.relative.top*i+this.offset.parent.top*i-(this.cssPosition==="fixed"?-this.scrollParent.scrollTop():o?0:n.scrollTop())*i,left:t.left+this.offset.relative.left*i+this.offset.parent.left*i-(this.cssPosition==="fixed"?-this.scrollParent.scrollLeft():o?0:n.scrollLeft())*i}},_generatePosition:function(e){var t,i,n=this.options,o=e.pageX,s=e.pageY,r=this.cssPosition==="absolute"&&!(this.scrollParent[0]!==document&&M.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent,a=/(html|body)/i.test(r[0].tagName);if(this.cssPosition==="relative"&&!(this.scrollParent[0]!==document&&this.scrollParent[0]!==this.offsetParent[0]))this.offset.relative=this._getRelativeOffset();if(this.originalPosition){if(this.containment){if(e.pageX-this.offset.click.left<this.containment[0])o=this.containment[0]+this.offset.click.left;if(e.pageY-this.offset.click.top<this.containment[1])s=this.containment[1]+this.offset.click.top;if(e.pageX-this.offset.click.left>this.containment[2])o=this.containment[2]+this.offset.click.left;if(e.pageY-this.offset.click.top>this.containment[3])s=this.containment[3]+this.offset.click.top}if(n.grid){t=this.originalPageY+Math.round((s-this.originalPageY)/n.grid[1])*n.grid[1];s=this.containment?t-this.offset.click.top>=this.containment[1]&&t-this.offset.click.top<=this.containment[3]?t:t-this.offset.click.top>=this.containment[1]?t-n.grid[1]:t+n.grid[1]:t;i=this.originalPageX+Math.round((o-this.originalPageX)/n.grid[0])*n.grid[0];o=this.containment?i-this.offset.click.left>=this.containment[0]&&i-this.offset.click.left<=this.containment[2]?i:i-this.offset.click.left>=this.containment[0]?i-n.grid[0]:i+n.grid[0]:i}}return{top:s-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+(this.cssPosition==="fixed"?-this.scrollParent.scrollTop():a?0:r.scrollTop()),left:o-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+(this.cssPosition==="fixed"?-this.scrollParent.scrollLeft():a?0:r.scrollLeft())}},_rearrange:function(e,t,i,n){i?i[0].appendChild(this.placeholder[0]):t.item[0].parentNode.insertBefore(this.placeholder[0],this.direction==="down"?t.item[0]:t.item[0].nextSibling);this.counter=this.counter?++this.counter:1;var o=this.counter;this._delay(function(){if(o===this.counter)this.refreshPositions(!n)})},_clear:function(e,t){this.reverting=false;var i,n=[];if(!this._noFinalSort&&this.currentItem.parent().length)this.placeholder.before(this.currentItem);this._noFinalSort=null;if(this.helper[0]===this.currentItem[0]){for(i in this._storedCSS)if(this._storedCSS[i]==="auto"||this._storedCSS[i]==="static")this._storedCSS[i]="";this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper")}else this.currentItem.show();if(this.fromOutside&&!t)n.push(function(e){this._trigger("receive",e,this._uiHash(this.fromOutside))});if((this.fromOutside||this.domPosition.prev!==this.currentItem.prev().not(".ui-sortable-helper")[0]||this.domPosition.parent!==this.currentItem.parent()[0])&&!t)n.push(function(e){this._trigger("update",e,this._uiHash())});if(this!==this.currentContainer)if(!t){n.push(function(e){this._trigger("remove",e,this._uiHash())});n.push(function(t){return function(e){t._trigger("receive",e,this._uiHash(this))}}.call(this,this.currentContainer));n.push(function(t){return function(e){t._trigger("update",e,this._uiHash(this))}}.call(this,this.currentContainer))}function o(t,i,n){return function(e){n._trigger(t,e,i._uiHash(i))}}for(i=this.containers.length-1;i>=0;i--){if(!t)n.push(o("deactivate",this,this.containers[i]));if(this.containers[i].containerCache.over){n.push(o("out",this,this.containers[i]));this.containers[i].containerCache.over=0}}if(this.storedCursor){this.document.find("body").css("cursor",this.storedCursor);this.storedStylesheet.remove()}if(this._storedOpacity)this.helper.css("opacity",this._storedOpacity);if(this._storedZIndex)this.helper.css("zIndex",this._storedZIndex==="auto"?"":this._storedZIndex);this.dragging=false;if(this.cancelHelperRemoval){if(!t){this._trigger("beforeStop",e,this._uiHash());for(i=0;i<n.length;i++)n[i].call(this,e);this._trigger("stop",e,this._uiHash())}this.fromOutside=false;return false}if(!t)this._trigger("beforeStop",e,this._uiHash());this.placeholder[0].parentNode.removeChild(this.placeholder[0]);if(this.helper[0]!==this.currentItem[0])this.helper.remove();this.helper=null;if(!t){for(i=0;i<n.length;i++)n[i].call(this,e);this._trigger("stop",e,this._uiHash())}this.fromOutside=false;return true},_trigger:function(){if(M.Widget.prototype._trigger.apply(this,arguments)===false)this.cancel()},_uiHash:function(e){var t=e||this;return{helper:t.helper,placeholder:t.placeholder||M([]),position:t.position,originalPosition:t.originalPosition,offset:t.positionAbs,item:t.currentItem,sender:e?e.element:null}}}),p=M.widget("ui.menu",{version:"1.11.1",defaultElement:"<ul>",delay:300,options:{icons:{submenu:"ui-icon-carat-1-e"},items:"> *",menus:"ul",position:{my:"left-1 top",at:"right top"},role:"menu",blur:null,focus:null,select:null},_create:function(){this.activeMenu=this.element;this.mouseHandled=false;this.element.uniqueId().addClass("ui-menu ui-widget ui-widget-content").toggleClass("ui-menu-icons",!!this.element.find(".ui-icon").length).attr({role:this.options.role,tabIndex:0});if(this.options.disabled)this.element.addClass("ui-state-disabled").attr("aria-disabled","true");this._on({"mousedown .ui-menu-item":function(e){e.preventDefault()},"click .ui-menu-item":function(e){var t=M(e.target);if(!this.mouseHandled&&t.not(".ui-state-disabled").length){this.select(e);if(!e.isPropagationStopped())this.mouseHandled=true;if(t.has(".ui-menu").length)this.expand(e);else if(!this.element.is(":focus")&&M(this.document[0].activeElement).closest(".ui-menu").length){this.element.trigger("focus",[true]);if(this.active&&this.active.parents(".ui-menu").length===1)clearTimeout(this.timer)}}},"mouseenter .ui-menu-item":function(e){var t=M(e.currentTarget);t.siblings(".ui-state-active").removeClass("ui-state-active");this.focus(e,t)},mouseleave:"collapseAll","mouseleave .ui-menu":"collapseAll",focus:function(e,t){var i=this.active||this.element.find(this.options.items).eq(0);if(!t)this.focus(e,i)},blur:function(e){this._delay(function(){if(!M.contains(this.element[0],this.document[0].activeElement))this.collapseAll(e)})},keydown:"_keydown"});this.refresh();this._on(this.document,{click:function(e){if(this._closeOnDocumentClick(e))this.collapseAll(e);this.mouseHandled=false}})},_destroy:function(){this.element.removeAttr("aria-activedescendant").find(".ui-menu").addBack().removeClass("ui-menu ui-widget ui-widget-content ui-menu-icons ui-front").removeAttr("role").removeAttr("tabIndex").removeAttr("aria-labelledby").removeAttr("aria-expanded").removeAttr("aria-hidden").removeAttr("aria-disabled").removeUniqueId().show();this.element.find(".ui-menu-item").removeClass("ui-menu-item").removeAttr("role").removeAttr("aria-disabled").removeUniqueId().removeClass("ui-state-hover").removeAttr("tabIndex").removeAttr("role").removeAttr("aria-haspopup").children().each(function(){var e=M(this);if(e.data("ui-menu-submenu-carat"))e.remove()});this.element.find(".ui-menu-divider").removeClass("ui-menu-divider ui-widget-content")},_keydown:function(e){var t,i,n,o,s,r=true;function a(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}switch(e.keyCode){case M.ui.keyCode.PAGE_UP:this.previousPage(e);break;case M.ui.keyCode.PAGE_DOWN:this.nextPage(e);break;case M.ui.keyCode.HOME:this._move("first","first",e);break;case M.ui.keyCode.END:this._move("last","last",e);break;case M.ui.keyCode.UP:this.previous(e);break;case M.ui.keyCode.DOWN:this.next(e);break;case M.ui.keyCode.LEFT:this.collapse(e);break;case M.ui.keyCode.RIGHT:if(this.active&&!this.active.is(".ui-state-disabled"))this.expand(e);break;case M.ui.keyCode.ENTER:case M.ui.keyCode.SPACE:this._activate(e);break;case M.ui.keyCode.ESCAPE:this.collapse(e);break;default:r=false;i=this.previousFilter||"";n=String.fromCharCode(e.keyCode);o=false;clearTimeout(this.filterTimer);if(n===i)o=true;else n=i+n;s=new RegExp("^"+a(n),"i");t=this.activeMenu.find(this.options.items).filter(function(){return s.test(M(this).text())});t=o&&t.index(this.active.next())!==-1?this.active.nextAll(".ui-menu-item"):t;if(!t.length){n=String.fromCharCode(e.keyCode);s=new RegExp("^"+a(n),"i");t=this.activeMenu.find(this.options.items).filter(function(){return s.test(M(this).text())})}if(t.length){this.focus(e,t);if(t.length>1){this.previousFilter=n;this.filterTimer=this._delay(function(){delete this.previousFilter},1e3)}else delete this.previousFilter}else delete this.previousFilter}if(r)e.preventDefault()},_activate:function(e){if(!this.active.is(".ui-state-disabled"))if(this.active.is("[aria-haspopup='true']"))this.expand(e);else this.select(e)},refresh:function(){var e,t,i=this,n=this.options.icons.submenu,o=this.element.find(this.options.menus);this.element.toggleClass("ui-menu-icons",!!this.element.find(".ui-icon").length);o.filter(":not(.ui-menu)").addClass("ui-menu ui-widget ui-widget-content ui-front").hide().attr({role:this.options.role,"aria-hidden":"true","aria-expanded":"false"}).each(function(){var e=M(this),t=e.parent(),i=M("<span>").addClass("ui-menu-icon ui-icon "+n).data("ui-menu-submenu-carat",true);t.attr("aria-haspopup","true").prepend(i);e.attr("aria-labelledby",t.attr("id"))});e=o.add(this.element);t=e.find(this.options.items);t.not(".ui-menu-item").each(function(){var e=M(this);if(i._isDivider(e))e.addClass("ui-widget-content ui-menu-divider")});t.not(".ui-menu-item, .ui-menu-divider").addClass("ui-menu-item").uniqueId().attr({tabIndex:-1,role:this._itemRole()});t.filter(".ui-state-disabled").attr("aria-disabled","true");if(this.active&&!M.contains(this.element[0],this.active[0]))this.blur()},_itemRole:function(){return{menu:"menuitem",listbox:"option"}[this.options.role]},_setOption:function(e,t){if(e==="icons")this.element.find(".ui-menu-icon").removeClass(this.options.icons.submenu).addClass(t.submenu);if(e==="disabled")this.element.toggleClass("ui-state-disabled",!!t).attr("aria-disabled",t);this._super(e,t)},focus:function(e,t){var i,n;this.blur(e,e&&e.type==="focus");this._scrollIntoView(t);this.active=t.first();n=this.active.addClass("ui-state-focus").removeClass("ui-state-active");if(this.options.role)this.element.attr("aria-activedescendant",n.attr("id"));this.active.parent().closest(".ui-menu-item").addClass("ui-state-active");if(e&&e.type==="keydown")this._close();else this.timer=this._delay(function(){this._close()},this.delay);i=t.children(".ui-menu");if(i.length&&e&&/^mouse/.test(e.type))this._startOpening(i);this.activeMenu=t.parent();this._trigger("focus",e,{item:t})},_scrollIntoView:function(e){var t,i,n,o,s,r;if(this._hasScroll()){t=parseFloat(M.css(this.activeMenu[0],"borderTopWidth"))||0;i=parseFloat(M.css(this.activeMenu[0],"paddingTop"))||0;n=e.offset().top-this.activeMenu.offset().top-t-i;o=this.activeMenu.scrollTop();s=this.activeMenu.height();r=e.outerHeight();if(n<0)this.activeMenu.scrollTop(o+n);else if(n+r>s)this.activeMenu.scrollTop(o+n-s+r)}},blur:function(e,t){if(!t)clearTimeout(this.timer);if(!this.active)return;this.active.removeClass("ui-state-focus");this.active=null;this._trigger("blur",e,{item:this.active})},_startOpening:function(e){clearTimeout(this.timer);if(e.attr("aria-hidden")!=="true")return;this.timer=this._delay(function(){this._close();this._open(e)},this.delay)},_open:function(e){var t=M.extend({of:this.active},this.options.position);clearTimeout(this.timer);this.element.find(".ui-menu").not(e.parents(".ui-menu")).hide().attr("aria-hidden","true");e.show().removeAttr("aria-hidden").attr("aria-expanded","true").position(t)},collapseAll:function(t,i){clearTimeout(this.timer);this.timer=this._delay(function(){var e=i?this.element:M(t&&t.target).closest(this.element.find(".ui-menu"));if(!e.length)e=this.element;this._close(e);this.blur(t);this.activeMenu=e},this.delay)},_close:function(e){if(!e)e=this.active?this.active.parent():this.element;e.find(".ui-menu").hide().attr("aria-hidden","true").attr("aria-expanded","false").end().find(".ui-state-active").not(".ui-state-focus").removeClass("ui-state-active")},_closeOnDocumentClick:function(e){return!M(e.target).closest(".ui-menu").length},_isDivider:function(e){return!/[^\-\u2014\u2013\s]/.test(e.text())},collapse:function(e){var t=this.active&&this.active.parent().closest(".ui-menu-item",this.element);if(t&&t.length){this._close();this.focus(e,t)}},expand:function(e){var t=this.active&&this.active.children(".ui-menu ").find(this.options.items).first();if(t&&t.length){this._open(t.parent());this._delay(function(){this.focus(e,t)})}},next:function(e){this._move("next","first",e)},previous:function(e){this._move("prev","last",e)},isFirstItem:function(){return this.active&&!this.active.prevAll(".ui-menu-item").length},isLastItem:function(){return this.active&&!this.active.nextAll(".ui-menu-item").length},_move:function(e,t,i){var n;if(this.active)if(e==="first"||e==="last")n=this.active[e==="first"?"prevAll":"nextAll"](".ui-menu-item").eq(-1);else n=this.active[e+"All"](".ui-menu-item").eq(0);if(!n||!n.length||!this.active)n=this.activeMenu.find(this.options.items)[t]();this.focus(i,n)},nextPage:function(e){var t,i,n;if(!this.active){this.next(e);return}if(this.isLastItem())return;if(this._hasScroll()){i=this.active.offset().top;n=this.element.height();this.active.nextAll(".ui-menu-item").each(function(){t=M(this);return t.offset().top-i-n<0});this.focus(e,t)}else this.focus(e,this.activeMenu.find(this.options.items)[!this.active?"first":"last"]())},previousPage:function(e){var t,i,n;if(!this.active){this.next(e);return}if(this.isFirstItem())return;if(this._hasScroll()){i=this.active.offset().top;n=this.element.height();this.active.prevAll(".ui-menu-item").each(function(){t=M(this);return t.offset().top-i+n>0});this.focus(e,t)}else this.focus(e,this.activeMenu.find(this.options.items).first())},_hasScroll:function(){return this.element.outerHeight()<this.element.prop("scrollHeight")},select:function(e){this.active=this.active||M(e.target).closest(".ui-menu-item");var t={item:this.active};if(!this.active.has(".ui-menu").length)this.collapseAll(e,true);this._trigger("select",e,t)}});
/*!
 * jQuery UI Sortable 1.11.1
 * http://jqueryui.com
 *
 * Copyright 2014 jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 *
 * http://api.jqueryui.com/sortable/
 */
/*!
 * jQuery UI Autocomplete 1.11.1
 * http://jqueryui.com
 *
 * Copyright 2014 jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 *
 * http://api.jqueryui.com/autocomplete/
 */
M.widget("ui.autocomplete",{version:"1.11.1",defaultElement:"<input>",options:{appendTo:null,autoFocus:false,delay:300,minLength:1,position:{my:"left top",at:"left bottom",collision:"none"},source:null,change:null,close:null,focus:null,open:null,response:null,search:null,select:null},requestIndex:0,pending:0,_create:function(){var i,n,o,e=this.element[0].nodeName.toLowerCase(),t=e==="textarea",s=e==="input";this.isMultiLine=t?true:s?false:this.element.prop("isContentEditable");this.valueMethod=this.element[t||s?"val":"text"];this.isNewMenu=true;this.element.addClass("ui-autocomplete-input").attr("autocomplete","off");this._on(this.element,{keydown:function(e){if(this.element.prop("readOnly")){i=true;o=true;n=true;return}i=false;o=false;n=false;var t=M.ui.keyCode;switch(e.keyCode){case t.PAGE_UP:i=true;this._move("previousPage",e);break;case t.PAGE_DOWN:i=true;this._move("nextPage",e);break;case t.UP:i=true;this._keyEvent("previous",e);break;case t.DOWN:i=true;this._keyEvent("next",e);break;case t.ENTER:if(this.menu.active){i=true;e.preventDefault();this.menu.select(e)}break;case t.TAB:if(this.menu.active)this.menu.select(e);break;case t.ESCAPE:if(this.menu.element.is(":visible")){if(!this.isMultiLine)this._value(this.term);this.close(e);e.preventDefault()}break;default:n=true;this._searchTimeout(e);break}},keypress:function(e){if(i){i=false;if(!this.isMultiLine||this.menu.element.is(":visible"))e.preventDefault();return}if(n)return;var t=M.ui.keyCode;switch(e.keyCode){case t.PAGE_UP:this._move("previousPage",e);break;case t.PAGE_DOWN:this._move("nextPage",e);break;case t.UP:this._keyEvent("previous",e);break;case t.DOWN:this._keyEvent("next",e);break}},input:function(e){if(o){o=false;e.preventDefault();return}this._searchTimeout(e)},focus:function(){this.selectedItem=null;this.previous=this._value()},blur:function(e){if(this.cancelBlur){delete this.cancelBlur;return}clearTimeout(this.searching);this.close(e);this._change(e)}});this._initSource();this.menu=M("<ul>").addClass("ui-autocomplete ui-front").appendTo(this._appendTo()).menu({role:null}).hide().menu("instance");this._on(this.menu.element,{mousedown:function(e){e.preventDefault();this.cancelBlur=true;this._delay(function(){delete this.cancelBlur});var i=this.menu.element[0];if(!M(e.target).closest(".ui-menu-item").length)this._delay(function(){var t=this;this.document.one("mousedown",function(e){if(e.target!==t.element[0]&&e.target!==i&&!M.contains(i,e.target))t.close()})})},menufocus:function(e,t){var i,n;if(this.isNewMenu){this.isNewMenu=false;if(e.originalEvent&&/^mouse/.test(e.originalEvent.type)){this.menu.blur();this.document.one("mousemove",function(){M(e.target).trigger(e.originalEvent)});return}}n=t.item.data("ui-autocomplete-item");if(false!==this._trigger("focus",e,{item:n}))if(e.originalEvent&&/^key/.test(e.originalEvent.type))this._value(n.value);i=t.item.attr("aria-label")||n.value;if(i&&M.trim(i).length){this.liveRegion.children().hide();M("<div>").text(i).appendTo(this.liveRegion)}},menuselect:function(e,t){var i=t.item.data("ui-autocomplete-item"),n=this.previous;if(this.element[0]!==this.document[0].activeElement){this.element.focus();this.previous=n;this._delay(function(){this.previous=n;this.selectedItem=i})}if(false!==this._trigger("select",e,{item:i}))this._value(i.value);this.term=this._value();this.close(e);this.selectedItem=i}});this.liveRegion=M("<span>",{role:"status","aria-live":"assertive","aria-relevant":"additions"}).addClass("ui-helper-hidden-accessible").appendTo(this.document[0].body);this._on(this.window,{beforeunload:function(){this.element.removeAttr("autocomplete")}})},_destroy:function(){clearTimeout(this.searching);this.element.removeClass("ui-autocomplete-input").removeAttr("autocomplete");this.menu.element.remove();this.liveRegion.remove()},_setOption:function(e,t){this._super(e,t);if(e==="source")this._initSource();if(e==="appendTo")this.menu.element.appendTo(this._appendTo());if(e==="disabled"&&t&&this.xhr)this.xhr.abort()},_appendTo:function(){var e=this.options.appendTo;if(e)e=e.jquery||e.nodeType?M(e):this.document.find(e).eq(0);if(!e||!e[0])e=this.element.closest(".ui-front");if(!e.length)e=this.document[0].body;return e},_initSource:function(){var i,n,o=this;if(M.isArray(this.options.source)){i=this.options.source;this.source=function(e,t){t(M.ui.autocomplete.filter(i,e.term))}}else if(typeof this.options.source==="string"){n=this.options.source;this.source=function(e,t){if(o.xhr)o.xhr.abort();o.xhr=M.ajax({url:n,data:e,dataType:"json",success:function(e){t(e)},error:function(){t([])}})}}else this.source=this.options.source},_searchTimeout:function(n){clearTimeout(this.searching);this.searching=this._delay(function(){var e=this.term===this._value(),t=this.menu.element.is(":visible"),i=n.altKey||n.ctrlKey||n.metaKey||n.shiftKey;if(!e||e&&!t&&!i){this.selectedItem=null;this.search(null,n)}},this.options.delay)},search:function(e,t){e=e!=null?e:this._value();this.term=this._value();if(e.length<this.options.minLength)return this.close(t);if(this._trigger("search",t)===false)return;return this._search(e)},_search:function(e){this.pending++;this.element.addClass("ui-autocomplete-loading");this.cancelSearch=false;this.source({term:e},this._response())},_response:function(){var t=++this.requestIndex;return M.proxy(function(e){if(t===this.requestIndex)this.__response(e);this.pending--;if(!this.pending)this.element.removeClass("ui-autocomplete-loading")},this)},__response:function(e){if(e)e=this._normalize(e);this._trigger("response",null,{content:e});if(!this.options.disabled&&e&&e.length&&!this.cancelSearch){this._suggest(e);this._trigger("open")}else this._close()},close:function(e){this.cancelSearch=true;this._close(e)},_close:function(e){if(this.menu.element.is(":visible")){this.menu.element.hide();this.menu.blur();this.isNewMenu=true;this._trigger("close",e)}},_change:function(e){if(this.previous!==this._value())this._trigger("change",e,{item:this.selectedItem})},_normalize:function(e){if(e.length&&e[0].label&&e[0].value)return e;return M.map(e,function(e){if(typeof e==="string")return{label:e,value:e};return M.extend({},e,{label:e.label||e.value,value:e.value||e.label})})},_suggest:function(e){var t=this.menu.element.empty();this._renderMenu(t,e);this.isNewMenu=true;this.menu.refresh();t.show();this._resizeMenu();t.position(M.extend({of:this.element},this.options.position));if(this.options.autoFocus)this.menu.next()},_resizeMenu:function(){var e=this.menu.element;e.outerWidth(Math.max(e.width("").outerWidth()+1,this.element.outerWidth()))},_renderMenu:function(i,e){var n=this;M.each(e,function(e,t){n._renderItemData(i,t)})},_renderItemData:function(e,t){return this._renderItem(e,t).data("ui-autocomplete-item",t)},_renderItem:function(e,t){return M("<li>").text(t.label).appendTo(e)},_move:function(e,t){if(!this.menu.element.is(":visible")){this.search(null,t);return}if(this.menu.isFirstItem()&&/^previous/.test(e)||this.menu.isLastItem()&&/^next/.test(e)){if(!this.isMultiLine)this._value(this.term);this.menu.blur();return}this.menu[e](t)},widget:function(){return this.menu.element},_value:function(){return this.valueMethod.apply(this.element,arguments)},_keyEvent:function(e,t){if(!this.isMultiLine||this.menu.element.is(":visible")){this._move(e,t);t.preventDefault()}}}),M.extend(M.ui.autocomplete,{escapeRegex:function(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")},filter:function(e,t){var i=new RegExp(M.ui.autocomplete.escapeRegex(t),"i");return M.grep(e,function(e){return i.test(e.label||e.value||e)})}}),M.widget("ui.autocomplete",M.ui.autocomplete,{options:{messages:{noResults:"No search results.",results:function(e){return e+(e>1?" results are":" result is")+" available, use up and down arrow keys to navigate."}}},__response:function(e){var t;this._superApply(arguments);if(this.options.disabled||this.cancelSearch)return;if(e&&e.length)t=this.options.messages.results(e.length);else t=this.options.messages.noResults;this.liveRegion.children().hide();M("<div>").text(t).appendTo(this.liveRegion)}});var d=M.ui.autocomplete,m=M.widget("ui.slider",M.ui.mouse,{version:"1.11.1",widgetEventPrefix:"slide",options:{animate:false,distance:0,max:100,min:0,orientation:"horizontal",range:false,step:1,value:0,values:null,change:null,slide:null,start:null,stop:null},numPages:5,_create:function(){this._keySliding=false;this._mouseSliding=false;this._animateOff=true;this._handleIndex=null;this._detectOrientation();this._mouseInit();this.element.addClass("ui-slider"+" ui-slider-"+this.orientation+" ui-widget"+" ui-widget-content"+" ui-corner-all");this._refresh();this._setOption("disabled",this.options.disabled);this._animateOff=false},_refresh:function(){this._createRange();this._createHandles();this._setupEvents();this._refreshValue()},_createHandles:function(){var e,t,i=this.options,n=this.element.find(".ui-slider-handle").addClass("ui-state-default ui-corner-all"),o="<span class='ui-slider-handle ui-state-default ui-corner-all' tabindex='0'></span>",s=[];t=i.values&&i.values.length||1;if(n.length>t){n.slice(t).remove();n=n.slice(0,t)}for(e=n.length;e<t;e++)s.push(o);this.handles=n.add(M(s.join("")).appendTo(this.element));this.handle=this.handles.eq(0);this.handles.each(function(e){M(this).data("ui-slider-handle-index",e)})},_createRange:function(){var e=this.options,t="";if(e.range){if(e.range===true)if(!e.values)e.values=[this._valueMin(),this._valueMin()];else if(e.values.length&&e.values.length!==2)e.values=[e.values[0],e.values[0]];else if(M.isArray(e.values))e.values=e.values.slice(0);if(!this.range||!this.range.length){this.range=M("<div></div>").appendTo(this.element);t="ui-slider-range"+" ui-widget-header ui-corner-all"}else this.range.removeClass("ui-slider-range-min ui-slider-range-max").css({left:"",bottom:""});this.range.addClass(t+(e.range==="min"||e.range==="max"?" ui-slider-range-"+e.range:""))}else{if(this.range)this.range.remove();this.range=null}},_setupEvents:function(){this._off(this.handles);this._on(this.handles,this._handleEvents);this._hoverable(this.handles);this._focusable(this.handles)},_destroy:function(){this.handles.remove();if(this.range)this.range.remove();this.element.removeClass("ui-slider"+" ui-slider-horizontal"+" ui-slider-vertical"+" ui-widget"+" ui-widget-content"+" ui-corner-all");this._mouseDestroy()},_mouseCapture:function(e){var t,i,n,o,s,r,a,l,c=this,h=this.options;if(h.disabled)return false;this.elementSize={width:this.element.outerWidth(),height:this.element.outerHeight()};this.elementOffset=this.element.offset();t={x:e.pageX,y:e.pageY};i=this._normValueFromMouse(t);n=this._valueMax()-this._valueMin()+1;this.handles.each(function(e){var t=Math.abs(i-c.values(e));if(n>t||n===t&&(e===c._lastChangedValue||c.values(e)===h.min)){n=t;o=M(this);s=e}});r=this._start(e,s);if(r===false)return false;this._mouseSliding=true;this._handleIndex=s;o.addClass("ui-state-active").focus();a=o.offset();l=!M(e.target).parents().addBack().is(".ui-slider-handle");this._clickOffset=l?{left:0,top:0}:{left:e.pageX-a.left-o.width()/2,top:e.pageY-a.top-o.height()/2-(parseInt(o.css("borderTopWidth"),10)||0)-(parseInt(o.css("borderBottomWidth"),10)||0)+(parseInt(o.css("marginTop"),10)||0)};if(!this.handles.hasClass("ui-state-hover"))this._slide(e,s,i);this._animateOff=true;return true},_mouseStart:function(){return true},_mouseDrag:function(e){var t={x:e.pageX,y:e.pageY},i=this._normValueFromMouse(t);this._slide(e,this._handleIndex,i);return false},_mouseStop:function(e){this.handles.removeClass("ui-state-active");this._mouseSliding=false;this._stop(e,this._handleIndex);this._change(e,this._handleIndex);this._handleIndex=null;this._clickOffset=null;this._animateOff=false;return false},_detectOrientation:function(){this.orientation=this.options.orientation==="vertical"?"vertical":"horizontal"},_normValueFromMouse:function(e){var t,i,n,o,s;if(this.orientation==="horizontal"){t=this.elementSize.width;i=e.x-this.elementOffset.left-(this._clickOffset?this._clickOffset.left:0)}else{t=this.elementSize.height;i=e.y-this.elementOffset.top-(this._clickOffset?this._clickOffset.top:0)}n=i/t;if(n>1)n=1;if(n<0)n=0;if(this.orientation==="vertical")n=1-n;o=this._valueMax()-this._valueMin();s=this._valueMin()+n*o;return this._trimAlignValue(s)},_start:function(e,t){var i={handle:this.handles[t],value:this.value()};if(this.options.values&&this.options.values.length){i.value=this.values(t);i.values=this.values()}return this._trigger("start",e,i)},_slide:function(e,t,i){var n,o,s;if(this.options.values&&this.options.values.length){n=this.values(t?0:1);if(this.options.values.length===2&&this.options.range===true&&(t===0&&i>n||t===1&&i<n))i=n;if(i!==this.values(t)){o=this.values();o[t]=i;s=this._trigger("slide",e,{handle:this.handles[t],value:i,values:o});n=this.values(t?0:1);if(s!==false)this.values(t,i)}}else if(i!==this.value()){s=this._trigger("slide",e,{handle:this.handles[t],value:i});if(s!==false)this.value(i)}},_stop:function(e,t){var i={handle:this.handles[t],value:this.value()};if(this.options.values&&this.options.values.length){i.value=this.values(t);i.values=this.values()}this._trigger("stop",e,i)},_change:function(e,t){if(!this._keySliding&&!this._mouseSliding){var i={handle:this.handles[t],value:this.value()};if(this.options.values&&this.options.values.length){i.value=this.values(t);i.values=this.values()}this._lastChangedValue=t;this._trigger("change",e,i)}},value:function(e){if(arguments.length){this.options.value=this._trimAlignValue(e);this._refreshValue();this._change(null,0);return}return this._value()},values:function(e,t){var i,n,o;if(arguments.length>1){this.options.values[e]=this._trimAlignValue(t);this._refreshValue();this._change(null,e);return}if(arguments.length)if(M.isArray(arguments[0])){i=this.options.values;n=arguments[0];for(o=0;o<i.length;o+=1){i[o]=this._trimAlignValue(n[o]);this._change(null,o)}this._refreshValue()}else if(this.options.values&&this.options.values.length)return this._values(e);else return this.value();else return this._values()},_setOption:function(e,t){var i,n=0;if(e==="range"&&this.options.range===true)if(t==="min"){this.options.value=this._values(0);this.options.values=null}else if(t==="max"){this.options.value=this._values(this.options.values.length-1);this.options.values=null}if(M.isArray(this.options.values))n=this.options.values.length;if(e==="disabled")this.element.toggleClass("ui-state-disabled",!!t);this._super(e,t);switch(e){case"orientation":this._detectOrientation();this.element.removeClass("ui-slider-horizontal ui-slider-vertical").addClass("ui-slider-"+this.orientation);this._refreshValue();this.handles.css(t==="horizontal"?"bottom":"left","");break;case"value":this._animateOff=true;this._refreshValue();this._change(null,0);this._animateOff=false;break;case"values":this._animateOff=true;this._refreshValue();for(i=0;i<n;i+=1)this._change(null,i);this._animateOff=false;break;case"min":case"max":this._animateOff=true;this._refreshValue();this._animateOff=false;break;case"range":this._animateOff=true;this._refresh();this._animateOff=false;break}},_value:function(){var e=this.options.value;e=this._trimAlignValue(e);return e},_values:function(e){var t,i,n;if(arguments.length){t=this.options.values[e];t=this._trimAlignValue(t);return t}else if(this.options.values&&this.options.values.length){i=this.options.values.slice();for(n=0;n<i.length;n+=1)i[n]=this._trimAlignValue(i[n]);return i}else return[]},_trimAlignValue:function(e){if(e<=this._valueMin())return this._valueMin();if(e>=this._valueMax())return this._valueMax();var t=this.options.step>0?this.options.step:1,i=(e-this._valueMin())%t,n=e-i;if(Math.abs(i)*2>=t)n+=i>0?t:-t;return parseFloat(n.toFixed(5))},_valueMin:function(){return this.options.min},_valueMax:function(){return this.options.max},_refreshValue:function(){var t,i,e,n,o,s=this.options.range,r=this.options,a=this,l=!this._animateOff?r.animate:false,c={};if(this.options.values&&this.options.values.length)this.handles.each(function(e){i=(a.values(e)-a._valueMin())/(a._valueMax()-a._valueMin())*100;c[a.orientation==="horizontal"?"left":"bottom"]=i+"%";M(this).stop(1,1)[l?"animate":"css"](c,r.animate);if(a.options.range===true)if(a.orientation==="horizontal"){if(e===0)a.range.stop(1,1)[l?"animate":"css"]({left:i+"%"},r.animate);if(e===1)a.range[l?"animate":"css"]({width:i-t+"%"},{queue:false,duration:r.animate})}else{if(e===0)a.range.stop(1,1)[l?"animate":"css"]({bottom:i+"%"},r.animate);if(e===1)a.range[l?"animate":"css"]({height:i-t+"%"},{queue:false,duration:r.animate})}t=i});else{e=this.value();n=this._valueMin();o=this._valueMax();i=o!==n?(e-n)/(o-n)*100:0;c[this.orientation==="horizontal"?"left":"bottom"]=i+"%";this.handle.stop(1,1)[l?"animate":"css"](c,r.animate);if(s==="min"&&this.orientation==="horizontal")this.range.stop(1,1)[l?"animate":"css"]({width:i+"%"},r.animate);if(s==="max"&&this.orientation==="horizontal")this.range[l?"animate":"css"]({width:100-i+"%"},{queue:false,duration:r.animate});if(s==="min"&&this.orientation==="vertical")this.range.stop(1,1)[l?"animate":"css"]({height:i+"%"},r.animate);if(s==="max"&&this.orientation==="vertical")this.range[l?"animate":"css"]({height:100-i+"%"},{queue:false,duration:r.animate})}},_handleEvents:{keydown:function(e){var t,i,n,o,s=M(e.target).data("ui-slider-handle-index");switch(e.keyCode){case M.ui.keyCode.HOME:case M.ui.keyCode.END:case M.ui.keyCode.PAGE_UP:case M.ui.keyCode.PAGE_DOWN:case M.ui.keyCode.UP:case M.ui.keyCode.RIGHT:case M.ui.keyCode.DOWN:case M.ui.keyCode.LEFT:e.preventDefault();if(!this._keySliding){this._keySliding=true;M(e.target).addClass("ui-state-active");t=this._start(e,s);if(t===false)return}break}o=this.options.step;if(this.options.values&&this.options.values.length)i=n=this.values(s);else i=n=this.value();switch(e.keyCode){case M.ui.keyCode.HOME:n=this._valueMin();break;case M.ui.keyCode.END:n=this._valueMax();break;case M.ui.keyCode.PAGE_UP:n=this._trimAlignValue(i+(this._valueMax()-this._valueMin())/this.numPages);break;case M.ui.keyCode.PAGE_DOWN:n=this._trimAlignValue(i-(this._valueMax()-this._valueMin())/this.numPages);break;case M.ui.keyCode.UP:case M.ui.keyCode.RIGHT:if(i===this._valueMax())return;n=this._trimAlignValue(i+o);break;case M.ui.keyCode.DOWN:case M.ui.keyCode.LEFT:if(i===this._valueMin())return;n=this._trimAlignValue(i-o);break}this._slide(e,s,n)},keyup:function(e){var t=M(e.target).data("ui-slider-handle-index");if(this._keySliding){this._keySliding=false;this._stop(e,t);this._change(e,t);M(e.target).removeClass("ui-state-active")}}}}),f="ui-effects-",g=M;
/*!
 * jQuery UI Slider 1.11.1
 * http://jqueryui.com
 *
 * Copyright 2014 jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 *
 * http://api.jqueryui.com/slider/
 */M.effects={effect:{}},
/*!
 * jQuery Color Animations v2.1.2
 * https://github.com/jquery/jquery-color
 *
 * Copyright 2014 jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 *
 * Date: Wed Jan 16 08:47:09 2013 -0600
 */
function(h,u){var e="backgroundColor borderBottomColor borderLeftColor borderRightColor borderTopColor color columnRuleColor outlineColor textDecorationColor textEmphasisColor",p=/^([\-+])=\s*(\d+\.?\d*)/,t=[{re:/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(e){return[e[1],e[2],e[3],e[4]]}},{re:/rgba?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(e){return[e[1]*2.55,e[2]*2.55,e[3]*2.55,e[4]]}},{re:/#([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})/,parse:function(e){return[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16)]}},{re:/#([a-f0-9])([a-f0-9])([a-f0-9])/,parse:function(e){return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16)]}},{re:/hsla?\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,space:"hsla",parse:function(e){return[e[1],e[2]/100,e[3]/100,e[4]]}}],d=h.Color=function(e,t,i,n){return new h.Color.fn.parse(e,t,i,n)},m={rgba:{props:{red:{idx:0,type:"byte"},green:{idx:1,type:"byte"},blue:{idx:2,type:"byte"}}},hsla:{props:{hue:{idx:0,type:"degrees"},saturation:{idx:1,type:"percent"},lightness:{idx:2,type:"percent"}}}},f={byte:{floor:true,max:255},percent:{max:1},degrees:{mod:360,floor:true}},r=d.support={},i=h("<p>")[0],c,g=h.each;i.style.cssText="background-color:rgba(1,1,1,.5)";r.rgba=i.style.backgroundColor.indexOf("rgba")>-1;g(m,function(e,t){t.cache="_"+e;t.props.alpha={idx:3,type:"percent",def:1}});function y(e,t,i){var n=f[t.type]||{};if(e==null)return i||!t.def?null:t.def;e=n.floor?~~e:parseFloat(e);if(isNaN(e))return t.def;if(n.mod)return(e+n.mod)%n.mod;return 0>e?0:n.max<e?n.max:e}function a(r){var a=d(),l=a._rgba=[];r=r.toLowerCase();g(t,function(e,t){var i,n=t.re.exec(r),o=n&&t.parse(n),s=t.space||"rgba";if(o){i=a[s](o);a[m[s].cache]=i[m[s].cache];l=a._rgba=i._rgba;return false}});if(l.length){if(l.join()==="0,0,0,0")h.extend(l,c.transparent);return a}return c[r]}d.fn=h.extend(d.prototype,{parse:function(o,e,t,i){if(o===u){this._rgba=[null,null,null,null];return this}if(o.jquery||o.nodeType){o=h(o).css(e);e=u}var s=this,n=h.type(o),r=this._rgba=[];if(e!==u){o=[o,e,t,i];n="array"}if(n==="string")return this.parse(a(o)||c._default);if(n==="array"){g(m.rgba.props,function(e,t){r[t.idx]=y(o[t.idx],t)});return this}if(n==="object"){if(o instanceof d)g(m,function(e,t){if(o[t.cache])s[t.cache]=o[t.cache].slice()});else g(m,function(e,i){var n=i.cache;g(i.props,function(e,t){if(!s[n]&&i.to){if(e==="alpha"||o[e]==null)return;s[n]=i.to(s._rgba)}s[n][t.idx]=y(o[e],t,true)});if(s[n]&&h.inArray(null,s[n].slice(0,3))<0){s[n][3]=1;if(i.from)s._rgba=i.from(s[n])}});return this}},is:function(e){var o=d(e),s=true,r=this;g(m,function(e,t){var i,n=o[t.cache];if(n){i=r[t.cache]||t.to&&t.to(r._rgba)||[];g(t.props,function(e,t){if(n[t.idx]!=null){s=n[t.idx]===i[t.idx];return s}})}return s});return s},_space:function(){var i=[],n=this;g(m,function(e,t){if(n[t.cache])i.push(e)});return i.pop()},transition:function(e,r){var a=d(e),t=a._space(),i=m[t],n=this.alpha()===0?d("transparent"):this,l=n[i.cache]||i.to(n._rgba),c=l.slice();a=a[i.cache];g(i.props,function(e,t){var i=t.idx,n=l[i],o=a[i],s=f[t.type]||{};if(o===null)return;if(n===null)c[i]=o;else{if(s.mod)if(o-n>s.mod/2)n+=s.mod;else if(n-o>s.mod/2)n-=s.mod;c[i]=y((o-n)*r+n,t)}});return this[t](c)},blend:function(e){if(this._rgba[3]===1)return this;var t=this._rgba.slice(),i=t.pop(),n=d(e)._rgba;return d(h.map(t,function(e,t){return(1-i)*n[t]+i*e}))},toRgbaString:function(){var e="rgba(",t=h.map(this._rgba,function(e,t){return e==null?t>2?1:0:e});if(t[3]===1){t.pop();e="rgb("}return e+t.join()+")"},toHslaString:function(){var e="hsla(",t=h.map(this.hsla(),function(e,t){if(e==null)e=t>2?1:0;if(t&&t<3)e=Math.round(e*100)+"%";return e});if(t[3]===1){t.pop();e="hsl("}return e+t.join()+")"},toHexString:function(e){var t=this._rgba.slice(),i=t.pop();if(e)t.push(~~(i*255));return"#"+h.map(t,function(e){e=(e||0).toString(16);return e.length===1?"0"+e:e}).join("")},toString:function(){return this._rgba[3]===0?"transparent":this.toRgbaString()}});d.fn.parse.prototype=d.fn;function l(e,t,i){i=(i+1)%1;if(i*6<1)return e+(t-e)*i*6;if(i*2<1)return t;if(i*3<2)return e+(t-e)*(2/3-i)*6;return e}m.hsla.to=function(e){if(e[0]==null||e[1]==null||e[2]==null)return[null,null,null,e[3]];var t=e[0]/255,i=e[1]/255,n=e[2]/255,o=e[3],s=Math.max(t,i,n),r=Math.min(t,i,n),a=s-r,l=s+r,c=l*.5,h,u;if(r===s)h=0;else if(t===s)h=60*(i-n)/a+360;else if(i===s)h=60*(n-t)/a+120;else h=60*(t-i)/a+240;if(a===0)u=0;else if(c<=.5)u=a/l;else u=a/(2-l);return[Math.round(h)%360,u,c,o==null?1:o]};m.hsla.from=function(e){if(e[0]==null||e[1]==null||e[2]==null)return[null,null,null,e[3]];var t=e[0]/360,i=e[1],n=e[2],o=e[3],s=n<=.5?n*(1+i):n+i-n*i,r=2*n-s;return[Math.round(l(r,s,t+1/3)*255),Math.round(l(r,s,t)*255),Math.round(l(r,s,t-1/3)*255),o]};g(m,function(l,e){var i=e.props,r=e.cache,a=e.to,c=e.from;d.fn[l]=function(e){if(a&&!this[r])this[r]=a(this._rgba);if(e===u)return this[r].slice();var t,n=h.type(e),o=n==="array"||n==="object"?e:arguments,s=this[r].slice();g(i,function(e,t){var i=o[n==="object"?e:t.idx];if(i==null)i=s[t.idx];s[t.idx]=y(i,t)});if(c){t=d(c(s));t[r]=s;return t}else return d(s)};g(i,function(r,a){if(d.fn[r])return;d.fn[r]=function(e){var t=h.type(e),i=r==="alpha"?this._hsla?"hsla":"rgba":l,n=this[i](),o=n[a.idx],s;if(t==="undefined")return o;if(t==="function"){e=e.call(this,o);t=h.type(e)}if(e==null&&a.empty)return this;if(t==="string"){s=p.exec(e);if(s)e=o+parseFloat(s[2])*(s[1]==="+"?1:-1)}n[a.idx]=e;return this[i](n)}})});d.hook=function(e){var t=e.split(" ");g(t,function(e,s){h.cssHooks[s]={set:function(e,t){var i,n,o="";if(t!=="transparent"&&(h.type(t)!=="string"||(i=a(t)))){t=d(i||t);if(!r.rgba&&t._rgba[3]!==1){n=s==="backgroundColor"?e.parentNode:e;while((o===""||o==="transparent")&&n&&n.style)try{o=h.css(n,"backgroundColor");n=n.parentNode}catch(e){}t=t.blend(o&&o!=="transparent"?o:"_default")}t=t.toRgbaString()}try{e.style[s]=t}catch(e){}}};h.fx.step[s]=function(e){if(!e.colorInit){e.start=d(e.elem,s);e.end=d(e.end);e.colorInit=true}h.cssHooks[s].set(e.elem,e.start.transition(e.end,e.pos))}})};d.hook(e);h.cssHooks.borderColor={expand:function(i){var n={};g(["Top","Right","Bottom","Left"],function(e,t){n["border"+t+"Color"]=i});return n}};c=h.Color.names={aqua:"#00ffff",black:"#000000",blue:"#0000ff",fuchsia:"#ff00ff",gray:"#808080",green:"#008000",lime:"#00ff00",maroon:"#800000",navy:"#000080",olive:"#808000",purple:"#800080",red:"#ff0000",silver:"#c0c0c0",teal:"#008080",white:"#ffffff",yellow:"#ffff00",transparent:[null,null,null,0],_default:"#ffffff"}}(g),function(){var r=["add","remove","toggle"],s={border:1,borderBottom:1,borderColor:1,borderLeft:1,borderRight:1,borderTop:1,borderWidth:1,margin:1,padding:1};M.each(["borderLeftStyle","borderRightStyle","borderBottomStyle","borderTopStyle"],function(e,t){M.fx.step[t]=function(e){if(e.end!=="none"&&!e.setAttr||e.pos===1&&!e.setAttr){g.style(e.elem,t,e.end);e.setAttr=true}}});function a(e){var t,i,n=e.ownerDocument.defaultView?e.ownerDocument.defaultView.getComputedStyle(e,null):e.currentStyle,o={};if(n&&n.length&&n[0]&&n[n[0]]){i=n.length;while(i--){t=n[i];if(typeof n[t]==="string")o[M.camelCase(t)]=n[t]}}else for(t in n)if(typeof n[t]==="string")o[t]=n[t];return o}function l(e,t){var i={},n,o;for(n in t){o=t[n];if(e[n]!==o)if(!s[n])if(M.fx.step[n]||!isNaN(parseFloat(o)))i[n]=o}return i}if(!M.fn.addBack)M.fn.addBack=function(e){return this.add(e==null?this.prevObject:this.prevObject.filter(e))};M.effects.animateClass=function(o,e,t,i){var s=M.speed(e,t,i);return this.queue(function(){var i=M(this),e=i.attr("class")||"",t,n=s.children?i.find("*").addBack():i;n=n.map(function(){var e=M(this);return{el:e,start:a(this)}});t=function(){M.each(r,function(e,t){if(o[t])i[t+"Class"](o[t])})};t();n=n.map(function(){this.end=a(this.el[0]);this.diff=l(this.start,this.end);return this});i.attr("class",e);n=n.map(function(){var e=this,t=M.Deferred(),i=M.extend({},s,{queue:false,complete:function(){t.resolve(e)}});this.el.animate(this.diff,i);return t.promise()});M.when.apply(M,n.get()).done(function(){t();M.each(arguments,function(){var t=this.el;M.each(this.diff,function(e){t.css(e,"")})});s.complete.call(i[0])})})};M.fn.extend({addClass:function(o){return function(e,t,i,n){return t?M.effects.animateClass.call(this,{add:e},t,i,n):o.apply(this,arguments)}}(M.fn.addClass),removeClass:function(o){return function(e,t,i,n){return arguments.length>1?M.effects.animateClass.call(this,{remove:e},t,i,n):o.apply(this,arguments)}}(M.fn.removeClass),toggleClass:function(s){return function(e,t,i,n,o){if(typeof t==="boolean"||t===undefined)if(!i)return s.apply(this,arguments);else return M.effects.animateClass.call(this,t?{add:e}:{remove:e},i,n,o);else return M.effects.animateClass.call(this,{toggle:e},t,i,n)}}(M.fn.toggleClass),switchClass:function(e,t,i,n,o){return M.effects.animateClass.call(this,{add:t,remove:e},i,n,o)}})}(),function(){M.extend(M.effects,{version:"1.11.1",save:function(e,t){for(var i=0;i<t.length;i++)if(t[i]!==null)e.data(f+t[i],e[0].style[t[i]])},restore:function(e,t){var i,n;for(n=0;n<t.length;n++)if(t[n]!==null){i=e.data(f+t[n]);if(i===undefined)i="";e.css(t[n],i)}},setMode:function(e,t){if(t==="toggle")t=e.is(":hidden")?"show":"hide";return t},getBaseline:function(e,t){var i,n;switch(e[0]){case"top":i=0;break;case"middle":i=.5;break;case"bottom":i=1;break;default:i=e[0]/t.height}switch(e[1]){case"left":n=0;break;case"center":n=.5;break;case"right":n=1;break;default:n=e[1]/t.width}return{x:n,y:i}},createWrapper:function(i){if(i.parent().is(".ui-effects-wrapper"))return i.parent();var n={width:i.outerWidth(true),height:i.outerHeight(true),float:i.css("float")},e=M("<div></div>").addClass("ui-effects-wrapper").css({fontSize:"100%",background:"transparent",border:"none",margin:0,padding:0}),t={width:i.width(),height:i.height()},o=document.activeElement;try{o.id}catch(e){o=document.body}i.wrap(e);if(i[0]===o||M.contains(i[0],o))M(o).focus();e=i.parent();if(i.css("position")==="static"){e.css({position:"relative"});i.css({position:"relative"})}else{M.extend(n,{position:i.css("position"),zIndex:i.css("z-index")});M.each(["top","left","bottom","right"],function(e,t){n[t]=i.css(t);if(isNaN(parseInt(n[t],10)))n[t]="auto"});i.css({position:"relative",top:0,left:0,right:"auto",bottom:"auto"})}i.css(t);return e.css(n).show()},removeWrapper:function(e){var t=document.activeElement;if(e.parent().is(".ui-effects-wrapper")){e.parent().replaceWith(e);if(e[0]===t||M.contains(e[0],t))M(t).focus()}return e},setTransition:function(n,e,o,s){s=s||{};M.each(e,function(e,t){var i=n.cssUnit(t);if(i[0]>0)s[t]=i[0]*o+i[1]});return s}});function n(e,t,i,n){if(M.isPlainObject(e)){t=e;e=e.effect}e={effect:e};if(t==null)t={};if(M.isFunction(t)){n=t;i=null;t={}}if(typeof t==="number"||M.fx.speeds[t]){n=i;i=t;t={}}if(M.isFunction(i)){n=i;i=null}if(t)M.extend(e,t);i=i||t.duration;e.duration=M.fx.off?0:typeof i==="number"?i:i in M.fx.speeds?M.fx.speeds[i]:M.fx.speeds._default;e.complete=n||t.complete;return e}function o(e){if(!e||typeof e==="number"||M.fx.speeds[e])return true;if(typeof e==="string"&&!M.effects.effect[e])return true;if(M.isFunction(e))return true;if(typeof e==="object"&&!e.effect)return true;return false}M.fn.extend({effect:function(){var s=n.apply(this,arguments),e=s.mode,t=s.queue,r=M.effects.effect[s.effect];if(M.fx.off||!r)if(e)return this[e](s.duration,s.complete);else return this.each(function(){if(s.complete)s.complete.call(this)});function i(e){var t=M(this),i=s.complete,n=s.mode;function o(){if(M.isFunction(i))i.call(t[0]);if(M.isFunction(e))e()}if(t.is(":hidden")?n==="hide":n==="show"){t[n]();o()}else r.call(t[0],s,o)}return t===false?this.each(i):this.queue(t||"fx",i)},show:function(i){return function(e){if(o(e))return i.apply(this,arguments);else{var t=n.apply(this,arguments);t.mode="show";return this.effect.call(this,t)}}}(M.fn.show),hide:function(i){return function(e){if(o(e))return i.apply(this,arguments);else{var t=n.apply(this,arguments);t.mode="hide";return this.effect.call(this,t)}}}(M.fn.hide),toggle:function(i){return function(e){if(o(e)||typeof e==="boolean")return i.apply(this,arguments);else{var t=n.apply(this,arguments);t.mode="toggle";return this.effect.call(this,t)}}}(M.fn.toggle),cssUnit:function(e){var i=this.css(e),n=[];M.each(["em","px","%","pt"],function(e,t){if(i.indexOf(t)>0)n=[parseFloat(i),t]});return n}})}(),function(){var i={};M.each(["Quad","Cubic","Quart","Quint","Expo"],function(t,e){i[e]=function(e){return Math.pow(e,t+2)}});M.extend(i,{Sine:function(e){return 1-Math.cos(e*Math.PI/2)},Circ:function(e){return 1-Math.sqrt(1-e*e)},Elastic:function(e){return e===0||e===1?e:-Math.pow(2,8*(e-1))*Math.sin(((e-1)*80-7.5)*Math.PI/15)},Back:function(e){return e*e*(3*e-2)},Bounce:function(e){var t,i=4;while(e<((t=Math.pow(2,--i))-1)/11);return 1/Math.pow(4,3-i)-7.5625*Math.pow((t*3-2)/22-e,2)}});M.each(i,function(e,t){M.easing["easeIn"+e]=t;M.easing["easeOut"+e]=function(e){return 1-t(1-e)};M.easing["easeInOut"+e]=function(e){return e<.5?t(e*2)/2:1-t(e*-2+2)/2}})}();var y=M.effects,v=M.effects.effect.bounce=function(e,t){var i=M(this),n=["position","top","bottom","left","right","height","width"],o=M.effects.setMode(i,e.mode||"effect"),s=o==="hide",r=o==="show",a=e.direction||"up",l=e.distance,c=e.times||5,h=c*2+(r||s?1:0),u=e.duration/h,p=e.easing,d=a==="up"||a==="down"?"top":"left",m=a==="up"||a==="left",f,g,y,v=i.queue(),b=v.length;if(r||s)n.push("opacity");M.effects.save(i,n);i.show();M.effects.createWrapper(i);if(!l)l=i[d==="top"?"outerHeight":"outerWidth"]()/3;if(r){y={opacity:1};y[d]=0;i.css("opacity",0).css(d,m?-l*2:l*2).animate(y,u,p)}if(s)l=l/Math.pow(2,c-1);y={};y[d]=0;for(f=0;f<c;f++){g={};g[d]=(m?"-=":"+=")+l;i.animate(g,u,p).animate(y,u,p);l=s?l*2:l/2}if(s){g={opacity:0};g[d]=(m?"-=":"+=")+l;i.animate(g,u,p)}i.queue(function(){if(s)i.hide();M.effects.restore(i,n);M.effects.removeWrapper(i);t()});if(b>1)v.splice.apply(v,[1,0].concat(v.splice(b,h+1)));i.dequeue()},b=M.effects.effect.highlight=function(e,t){var i=M(this),n=["backgroundImage","backgroundColor","opacity"],o=M.effects.setMode(i,e.mode||"show"),s={backgroundColor:i.css("backgroundColor")};if(o==="hide")s.opacity=0;M.effects.save(i,n);i.show().css({backgroundImage:"none",backgroundColor:e.color||"#ffff99"}).animate(s,{queue:false,duration:e.duration,easing:e.easing,complete:function(){if(o==="hide")i.hide();M.effects.restore(i,n);t()}})},_=M.effects.effect.pulsate=function(e,t){var i=M(this),n=M.effects.setMode(i,e.mode||"show"),o=n==="show",s=n==="hide",r=o||n==="hide",a=(e.times||5)*2+(r?1:0),l=e.duration/a,c=0,h=i.queue(),u=h.length,p;if(o||!i.is(":visible")){i.css("opacity",0).show();c=1}for(p=1;p<a;p++){i.animate({opacity:c},l,e.easing);c=1-c}i.animate({opacity:c},l,e.easing);i.queue(function(){if(s)i.hide();t()});if(u>1)h.splice.apply(h,[1,0].concat(h.splice(u,a+1)));i.dequeue()},w=M.effects.effect.shake=function(e,t){var i=M(this),n=["position","top","bottom","left","right","height","width"],o=M.effects.setMode(i,e.mode||"effect"),s=e.direction||"left",r=e.distance||20,a=e.times||3,l=a*2+1,c=Math.round(e.duration/l),h=s==="up"||s==="down"?"top":"left",u=s==="up"||s==="left",p={},d={},m={},f,g=i.queue(),y=g.length;M.effects.save(i,n);i.show();M.effects.createWrapper(i);p[h]=(u?"-=":"+=")+r;d[h]=(u?"+=":"-=")+r*2;m[h]=(u?"-=":"+=")+r*2;i.animate(p,c,e.easing);for(f=1;f<a;f++)i.animate(d,c,e.easing).animate(m,c,e.easing);i.animate(d,c,e.easing).animate(p,c/2,e.easing).queue(function(){if(o==="hide")i.hide();M.effects.restore(i,n);M.effects.removeWrapper(i);t()});if(y>1)g.splice.apply(g,[1,0].concat(g.splice(y,l+1)));i.dequeue()},k=M.effects.effect.transfer=function(e,t){var i=M(this),n=M(e.to),o=n.css("position")==="fixed",s=M("body"),r=o?s.scrollTop():0,a=o?s.scrollLeft():0,l=n.offset(),c={top:l.top-r,left:l.left-a,height:n.innerHeight(),width:n.innerWidth()},h=i.offset(),u=M("<div class='ui-effects-transfer'></div>").appendTo(document.body).addClass(e.className).css({top:h.top-r,left:h.left-a,height:i.innerHeight(),width:i.innerWidth(),position:o?"fixed":"absolute"}).animate(c,e.duration,e.easing,function(){u.remove();t()})},x;
/*!
 * jQuery UI Effects Bounce 1.11.1
 * http://jqueryui.com
 *
 * Copyright 2014 jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 *
 * http://api.jqueryui.com/bounce-effect/
 */function S(e){var t,i;while(e.length&&e[0]!==document){t=e.css("position");if(t==="absolute"||t==="relative"||t==="fixed"){i=parseInt(e.css("zIndex"),10);if(!isNaN(i)&&i!==0)return i}e=e.parent()}return 0}function C(){this._curInst=null;this._keyEvent=false;this._disabledInputs=[];this._datepickerShowing=false;this._inDialog=false;this._mainDivId="ui-datepicker-div";this._inlineClass="ui-datepicker-inline";this._appendClass="ui-datepicker-append";this._triggerClass="ui-datepicker-trigger";this._dialogClass="ui-datepicker-dialog";this._disableClass="ui-datepicker-disabled";this._unselectableClass="ui-datepicker-unselectable";this._currentClass="ui-datepicker-current-day";this._dayOverClass="ui-datepicker-days-cell-over";this.regional=[];this.regional[""]={closeText:"Done",prevText:"Prev",nextText:"Next",currentText:"Today",monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],dayNamesMin:["Su","Mo","Tu","We","Th","Fr","Sa"],weekHeader:"Wk",dateFormat:"mm/dd/yy",firstDay:0,isRTL:false,showMonthAfterYear:false,yearSuffix:""};this._defaults={showOn:"focus",showAnim:"fadeIn",showOptions:{},defaultDate:null,appendText:"",buttonText:"...",buttonImage:"",buttonImageOnly:false,hideIfNoPrevNext:false,navigationAsDateFormat:false,gotoCurrent:false,changeMonth:false,changeYear:false,yearRange:"c-10:c+10",showOtherMonths:false,selectOtherMonths:false,showWeek:false,calculateWeek:this.iso8601Week,shortYearCutoff:"+10",minDate:null,maxDate:null,duration:"fast",beforeShowDay:null,beforeShow:null,onSelect:null,onChangeMonthYear:null,onClose:null,numberOfMonths:1,showCurrentAtPos:0,stepMonths:1,stepBigMonths:12,altField:"",altFormat:"",constrainInput:true,showButtonPanel:false,autoSize:false,disabled:false};M.extend(this._defaults,this.regional[""]);this.regional.en=M.extend(true,{},this.regional[""]);this.regional["en-US"]=M.extend(true,{},this.regional.en);this.dpDiv=T(M("<div id='"+this._mainDivId+"' class='ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>"))}function T(e){var t="button, .ui-datepicker-prev, .ui-datepicker-next, .ui-datepicker-calendar td a";return e.on("mouseout",t,function(){M(this).removeClass("ui-state-hover");if(this.className.indexOf("ui-datepicker-prev")!==-1)M(this).removeClass("ui-datepicker-prev-hover");if(this.className.indexOf("ui-datepicker-next")!==-1)M(this).removeClass("ui-datepicker-next-hover")}).on("mouseover",t,L)}function L(){if(!M.datepicker._isDisabledDatepicker(x.inline?x.dpDiv.parent()[0]:x.input[0])){M(this).parents(".ui-datepicker-calendar").find("a").removeClass("ui-state-hover");M(this).addClass("ui-state-hover");if(this.className.indexOf("ui-datepicker-prev")!==-1)M(this).addClass("ui-datepicker-prev-hover");if(this.className.indexOf("ui-datepicker-next")!==-1)M(this).addClass("ui-datepicker-next-hover")}}function D(e,t){M.extend(e,t);for(var i in t)if(t[i]==null)e[i]=t[i];return e}
/*!
 * jQuery UI Datepicker 1.12.1
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */
M.extend(M.ui,{datepicker:{version:"1.12.1"}}),M.extend(C.prototype,{markerClassName:"hasDatepicker",maxRows:4,_widgetDatepicker:function(){return this.dpDiv},setDefaults:function(e){D(this._defaults,e||{});return this},_attachDatepicker:function(e,t){var i,n,o;i=e.nodeName.toLowerCase();n=i==="div"||i==="span";if(!e.id){this.uuid+=1;e.id="dp"+this.uuid}o=this._newInst(M(e),n);o.settings=M.extend({},t||{});if(i==="input")this._connectDatepicker(e,o);else if(n)this._inlineDatepicker(e,o)},_newInst:function(e,t){var i=e[0].id.replace(/([^A-Za-z0-9_\-])/g,"\\\\$1");return{id:i,input:e,selectedDay:0,selectedMonth:0,selectedYear:0,drawMonth:0,drawYear:0,inline:t,dpDiv:!t?this.dpDiv:T(M("<div class='"+this._inlineClass+" ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>"))}},_connectDatepicker:function(e,t){var i=M(e);t.append=M([]);t.trigger=M([]);if(i.hasClass(this.markerClassName))return;this._attachments(i,t);i.addClass(this.markerClassName).on("keydown",this._doKeyDown).on("keypress",this._doKeyPress).on("keyup",this._doKeyUp);this._autoSize(t);M.data(e,"datepicker",t);if(t.settings.disabled)this._disableDatepicker(e)},_attachments:function(e,t){var i,n,o,s=this._get(t,"appendText"),r=this._get(t,"isRTL");if(t.append)t.append.remove();if(s){t.append=M("<span class='"+this._appendClass+"'>"+s+"</span>");e[r?"before":"after"](t.append)}e.off("focus",this._showDatepicker);if(t.trigger)t.trigger.remove();i=this._get(t,"showOn");if(i==="focus"||i==="both")e.on("focus",this._showDatepicker);if(i==="button"||i==="both"){n=this._get(t,"buttonText");o=this._get(t,"buttonImage");t.trigger=M(this._get(t,"buttonImageOnly")?M("<img/>").addClass(this._triggerClass).attr({src:o,alt:n,title:n}):M("<button type='button'></button>").addClass(this._triggerClass).html(!o?n:M("<img/>").attr({src:o,alt:n,title:n})));e[r?"before":"after"](t.trigger);t.trigger.on("click",function(){if(M.datepicker._datepickerShowing&&M.datepicker._lastInput===e[0])M.datepicker._hideDatepicker();else if(M.datepicker._datepickerShowing&&M.datepicker._lastInput!==e[0]){M.datepicker._hideDatepicker();M.datepicker._showDatepicker(e[0])}else M.datepicker._showDatepicker(e[0]);return false})}},_autoSize:function(e){if(this._get(e,"autoSize")&&!e.inline){var t,i,n,o,s=new Date(2009,12-1,20),r=this._get(e,"dateFormat");if(r.match(/[DM]/)){t=function(e){i=0;n=0;for(o=0;o<e.length;o++)if(e[o].length>i){i=e[o].length;n=o}return n};s.setMonth(t(this._get(e,r.match(/MM/)?"monthNames":"monthNamesShort")));s.setDate(t(this._get(e,r.match(/DD/)?"dayNames":"dayNamesShort"))+20-s.getDay())}e.input.attr("size",this._formatDate(e,s).length)}},_inlineDatepicker:function(e,t){var i=M(e);if(i.hasClass(this.markerClassName))return;i.addClass(this.markerClassName).append(t.dpDiv);M.data(e,"datepicker",t);this._setDate(t,this._getDefaultDate(t),true);this._updateDatepicker(t);this._updateAlternate(t);if(t.settings.disabled)this._disableDatepicker(e);t.dpDiv.css("display","block")},_dialogDatepicker:function(e,t,i,n,o){var s,r,a,l,c,h=this._dialogInst;if(!h){this.uuid+=1;s="dp"+this.uuid;this._dialogInput=M("<input type='text' id='"+s+"' style='position: absolute; top: -100px; width: 0px;'/>");this._dialogInput.on("keydown",this._doKeyDown);M("body").append(this._dialogInput);h=this._dialogInst=this._newInst(this._dialogInput,false);h.settings={};M.data(this._dialogInput[0],"datepicker",h)}D(h.settings,n||{});t=t&&t.constructor===Date?this._formatDate(h,t):t;this._dialogInput.val(t);this._pos=o?o.length?o:[o.pageX,o.pageY]:null;if(!this._pos){r=document.documentElement.clientWidth;a=document.documentElement.clientHeight;l=document.documentElement.scrollLeft||document.body.scrollLeft;c=document.documentElement.scrollTop||document.body.scrollTop;this._pos=[r/2-100+l,a/2-150+c]}this._dialogInput.css("left",this._pos[0]+20+"px").css("top",this._pos[1]+"px");h.settings.onSelect=i;this._inDialog=true;this.dpDiv.addClass(this._dialogClass);this._showDatepicker(this._dialogInput[0]);if(M.blockUI)M.blockUI(this.dpDiv);M.data(this._dialogInput[0],"datepicker",h);return this},_destroyDatepicker:function(e){var t,i=M(e),n=M.data(e,"datepicker");if(!i.hasClass(this.markerClassName))return;t=e.nodeName.toLowerCase();M.removeData(e,"datepicker");if(t==="input"){n.append.remove();n.trigger.remove();i.removeClass(this.markerClassName).off("focus",this._showDatepicker).off("keydown",this._doKeyDown).off("keypress",this._doKeyPress).off("keyup",this._doKeyUp)}else if(t==="div"||t==="span")i.removeClass(this.markerClassName).empty();if(x===n)x=null},_enableDatepicker:function(t){var e,i,n=M(t),o=M.data(t,"datepicker");if(!n.hasClass(this.markerClassName))return;e=t.nodeName.toLowerCase();if(e==="input"){t.disabled=false;o.trigger.filter("button").each(function(){this.disabled=false}).end().filter("img").css({opacity:"1.0",cursor:""})}else if(e==="div"||e==="span"){i=n.children("."+this._inlineClass);i.children().removeClass("ui-state-disabled");i.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",false)}this._disabledInputs=M.map(this._disabledInputs,function(e){return e===t?null:e})},_disableDatepicker:function(t){var e,i,n=M(t),o=M.data(t,"datepicker");if(!n.hasClass(this.markerClassName))return;e=t.nodeName.toLowerCase();if(e==="input"){t.disabled=true;o.trigger.filter("button").each(function(){this.disabled=true}).end().filter("img").css({opacity:"0.5",cursor:"default"})}else if(e==="div"||e==="span"){i=n.children("."+this._inlineClass);i.children().addClass("ui-state-disabled");i.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",true)}this._disabledInputs=M.map(this._disabledInputs,function(e){return e===t?null:e});this._disabledInputs[this._disabledInputs.length]=t},_isDisabledDatepicker:function(e){if(!e)return false;for(var t=0;t<this._disabledInputs.length;t++)if(this._disabledInputs[t]===e)return true;return false},_getInst:function(e){try{return M.data(e,"datepicker")}catch(e){throw"Missing instance data for this datepicker"}},_optionDatepicker:function(e,t,i){var n,o,s,r,a=this._getInst(e);if(arguments.length===2&&typeof t==="string")return t==="defaults"?M.extend({},M.datepicker._defaults):a?t==="all"?M.extend({},a.settings):this._get(a,t):null;n=t||{};if(typeof t==="string"){n={};n[t]=i}if(a){if(this._curInst===a)this._hideDatepicker();o=this._getDateDatepicker(e,true);s=this._getMinMaxDate(a,"min");r=this._getMinMaxDate(a,"max");D(a.settings,n);if(s!==null&&n.dateFormat!==undefined&&n.minDate===undefined)a.settings.minDate=this._formatDate(a,s);if(r!==null&&n.dateFormat!==undefined&&n.maxDate===undefined)a.settings.maxDate=this._formatDate(a,r);if("disabled"in n)if(n.disabled)this._disableDatepicker(e);else this._enableDatepicker(e);this._attachments(M(e),a);this._autoSize(a);this._setDate(a,o);this._updateAlternate(a);this._updateDatepicker(a)}},_changeDatepicker:function(e,t,i){this._optionDatepicker(e,t,i)},_refreshDatepicker:function(e){var t=this._getInst(e);if(t)this._updateDatepicker(t)},_setDateDatepicker:function(e,t){var i=this._getInst(e);if(i){this._setDate(i,t);this._updateDatepicker(i);this._updateAlternate(i)}},_getDateDatepicker:function(e,t){var i=this._getInst(e);if(i&&!i.inline)this._setDateFromField(i,t);return i?this._getDate(i):null},_doKeyDown:function(e){var t,i,n,o=M.datepicker._getInst(e.target),s=true,r=o.dpDiv.is(".ui-datepicker-rtl");o._keyEvent=true;if(M.datepicker._datepickerShowing)switch(e.keyCode){case 9:M.datepicker._hideDatepicker();s=false;break;case 13:n=M("td."+M.datepicker._dayOverClass+":not(."+M.datepicker._currentClass+")",o.dpDiv);if(n[0])M.datepicker._selectDay(e.target,o.selectedMonth,o.selectedYear,n[0]);t=M.datepicker._get(o,"onSelect");if(t){i=M.datepicker._formatDate(o);t.apply(o.input?o.input[0]:null,[i,o])}else M.datepicker._hideDatepicker();return false;case 27:M.datepicker._hideDatepicker();break;case 33:M.datepicker._adjustDate(e.target,e.ctrlKey?-M.datepicker._get(o,"stepBigMonths"):-M.datepicker._get(o,"stepMonths"),"M");break;case 34:M.datepicker._adjustDate(e.target,e.ctrlKey?+M.datepicker._get(o,"stepBigMonths"):+M.datepicker._get(o,"stepMonths"),"M");break;case 35:if(e.ctrlKey||e.metaKey)M.datepicker._clearDate(e.target);s=e.ctrlKey||e.metaKey;break;case 36:if(e.ctrlKey||e.metaKey)M.datepicker._gotoToday(e.target);s=e.ctrlKey||e.metaKey;break;case 37:if(e.ctrlKey||e.metaKey)M.datepicker._adjustDate(e.target,r?+1:-1,"D");s=e.ctrlKey||e.metaKey;if(e.originalEvent.altKey)M.datepicker._adjustDate(e.target,e.ctrlKey?-M.datepicker._get(o,"stepBigMonths"):-M.datepicker._get(o,"stepMonths"),"M");break;case 38:if(e.ctrlKey||e.metaKey)M.datepicker._adjustDate(e.target,-7,"D");s=e.ctrlKey||e.metaKey;break;case 39:if(e.ctrlKey||e.metaKey)M.datepicker._adjustDate(e.target,r?-1:+1,"D");s=e.ctrlKey||e.metaKey;if(e.originalEvent.altKey)M.datepicker._adjustDate(e.target,e.ctrlKey?+M.datepicker._get(o,"stepBigMonths"):+M.datepicker._get(o,"stepMonths"),"M");break;case 40:if(e.ctrlKey||e.metaKey)M.datepicker._adjustDate(e.target,+7,"D");s=e.ctrlKey||e.metaKey;break;default:s=false}else if(e.keyCode===36&&e.ctrlKey)M.datepicker._showDatepicker(this);else s=false;if(s){e.preventDefault();e.stopPropagation()}},_doKeyPress:function(e){var t,i,n=M.datepicker._getInst(e.target);if(M.datepicker._get(n,"constrainInput")){t=M.datepicker._possibleChars(M.datepicker._get(n,"dateFormat"));i=String.fromCharCode(e.charCode==null?e.keyCode:e.charCode);return e.ctrlKey||e.metaKey||(i<" "||!t||t.indexOf(i)>-1)}},_doKeyUp:function(e){var t,i=M.datepicker._getInst(e.target);if(i.input.val()!==i.lastVal)try{t=M.datepicker.parseDate(M.datepicker._get(i,"dateFormat"),i.input?i.input.val():null,M.datepicker._getFormatConfig(i));if(t){M.datepicker._setDateFromField(i);M.datepicker._updateAlternate(i);M.datepicker._updateDatepicker(i)}}catch(e){}return true},_showDatepicker:function(e){e=e.target||e;if(e.nodeName.toLowerCase()!=="input")e=M("input",e.parentNode)[0];if(M.datepicker._isDisabledDatepicker(e)||M.datepicker._lastInput===e)return;var t,i,n,o,s,r,a;t=M.datepicker._getInst(e);if(M.datepicker._curInst&&M.datepicker._curInst!==t){M.datepicker._curInst.dpDiv.stop(true,true);if(t&&M.datepicker._datepickerShowing)M.datepicker._hideDatepicker(M.datepicker._curInst.input[0])}i=M.datepicker._get(t,"beforeShow");n=i?i.apply(e,[e,t]):{};if(n===false)return;D(t.settings,n);t.lastVal=null;M.datepicker._lastInput=e;M.datepicker._setDateFromField(t);if(M.datepicker._inDialog)e.value="";if(!M.datepicker._pos){M.datepicker._pos=M.datepicker._findPos(e);M.datepicker._pos[1]+=e.offsetHeight}o=false;M(e).parents().each(function(){o|=M(this).css("position")==="fixed";return!o});s={left:M.datepicker._pos[0],top:M.datepicker._pos[1]};M.datepicker._pos=null;t.dpDiv.empty();t.dpDiv.css({position:"absolute",display:"block",top:"-1000px"});M.datepicker._updateDatepicker(t);s=M.datepicker._checkOffset(t,s,o);t.dpDiv.css({position:M.datepicker._inDialog&&M.blockUI?"static":o?"fixed":"absolute",display:"none",left:s.left+"px",top:s.top+"px"});if(!t.inline){r=M.datepicker._get(t,"showAnim");a=M.datepicker._get(t,"duration");t.dpDiv.css("z-index",S(M(e))+1);M.datepicker._datepickerShowing=true;if(M.effects&&M.effects.effect[r])t.dpDiv.show(r,M.datepicker._get(t,"showOptions"),a);else t.dpDiv[r||"show"](r?a:null);if(M.datepicker._shouldFocusInput(t))t.input.trigger("focus");M.datepicker._curInst=t}},_updateDatepicker:function(e){this.maxRows=4;x=e;e.dpDiv.empty().append(this._generateHTML(e));this._attachHandlers(e);var t,i=this._getNumberOfMonths(e),n=i[1],o=17,s=e.dpDiv.find("."+this._dayOverClass+" a");if(s.length>0)L.apply(s.get(0));e.dpDiv.removeClass("ui-datepicker-multi-2 ui-datepicker-multi-3 ui-datepicker-multi-4").width("");if(n>1)e.dpDiv.addClass("ui-datepicker-multi-"+n).css("width",o*n+"em");e.dpDiv[(i[0]!==1||i[1]!==1?"add":"remove")+"Class"]("ui-datepicker-multi");e.dpDiv[(this._get(e,"isRTL")?"add":"remove")+"Class"]("ui-datepicker-rtl");if(e===M.datepicker._curInst&&M.datepicker._datepickerShowing&&M.datepicker._shouldFocusInput(e))e.input.trigger("focus");if(e.yearshtml){t=e.yearshtml;setTimeout(function(){if(t===e.yearshtml&&e.yearshtml)e.dpDiv.find("select.ui-datepicker-year:first").replaceWith(e.yearshtml);t=e.yearshtml=null},0)}},_shouldFocusInput:function(e){return e.input&&e.input.is(":visible")&&!e.input.is(":disabled")&&!e.input.is(":focus")},_checkOffset:function(e,t,i){var n=e.dpDiv.outerWidth(),o=e.dpDiv.outerHeight(),s=e.input?e.input.outerWidth():0,r=e.input?e.input.outerHeight():0,a=document.documentElement.clientWidth+(i?0:M(document).scrollLeft()),l=document.documentElement.clientHeight+(i?0:M(document).scrollTop());t.left-=this._get(e,"isRTL")?n-s:0;t.left-=i&&t.left===e.input.offset().left?M(document).scrollLeft():0;t.top-=i&&t.top===e.input.offset().top+r?M(document).scrollTop():0;t.left-=Math.min(t.left,t.left+n>a&&a>n?Math.abs(t.left+n-a):0);t.top-=Math.min(t.top,t.top+o>l&&l>o?Math.abs(o+r):0);return t},_findPos:function(e){var t,i=this._getInst(e),n=this._get(i,"isRTL");while(e&&(e.type==="hidden"||e.nodeType!==1||M.expr.filters.hidden(e)))e=e[n?"previousSibling":"nextSibling"];t=M(e).offset();return[t.left,t.top]},_hideDatepicker:function(e){var t,i,n,o,s=this._curInst;if(!s||e&&s!==M.data(e,"datepicker"))return;if(this._datepickerShowing){t=this._get(s,"showAnim");i=this._get(s,"duration");n=function(){M.datepicker._tidyDialog(s)};if(M.effects&&(M.effects.effect[t]||M.effects[t]))s.dpDiv.hide(t,M.datepicker._get(s,"showOptions"),i,n);else s.dpDiv[t==="slideDown"?"slideUp":t==="fadeIn"?"fadeOut":"hide"](t?i:null,n);if(!t)n();this._datepickerShowing=false;o=this._get(s,"onClose");if(o)o.apply(s.input?s.input[0]:null,[s.input?s.input.val():"",s]);this._lastInput=null;if(this._inDialog){this._dialogInput.css({position:"absolute",left:"0",top:"-100px"});if(M.blockUI){M.unblockUI();M("body").append(this.dpDiv)}}this._inDialog=false}},_tidyDialog:function(e){e.dpDiv.removeClass(this._dialogClass).off(".ui-datepicker-calendar")},_checkExternalClick:function(e){if(!M.datepicker._curInst)return;var t=M(e.target),i=M.datepicker._getInst(t[0]);if(t[0].id!==M.datepicker._mainDivId&&t.parents("#"+M.datepicker._mainDivId).length===0&&!t.hasClass(M.datepicker.markerClassName)&&!t.closest("."+M.datepicker._triggerClass).length&&M.datepicker._datepickerShowing&&!(M.datepicker._inDialog&&M.blockUI)||t.hasClass(M.datepicker.markerClassName)&&M.datepicker._curInst!==i)M.datepicker._hideDatepicker()},_adjustDate:function(e,t,i){var n=M(e),o=this._getInst(n[0]);if(this._isDisabledDatepicker(n[0]))return;this._adjustInstDate(o,t+(i==="M"?this._get(o,"showCurrentAtPos"):0),i);this._updateDatepicker(o)},_gotoToday:function(e){var t,i=M(e),n=this._getInst(i[0]);if(this._get(n,"gotoCurrent")&&n.currentDay){n.selectedDay=n.currentDay;n.drawMonth=n.selectedMonth=n.currentMonth;n.drawYear=n.selectedYear=n.currentYear}else{t=new Date;n.selectedDay=t.getDate();n.drawMonth=n.selectedMonth=t.getMonth();n.drawYear=n.selectedYear=t.getFullYear()}this._notifyChange(n);this._adjustDate(i)},_selectMonthYear:function(e,t,i){var n=M(e),o=this._getInst(n[0]);o["selected"+(i==="M"?"Month":"Year")]=o["draw"+(i==="M"?"Month":"Year")]=parseInt(t.options[t.selectedIndex].value,10);this._notifyChange(o);this._adjustDate(n)},_selectDay:function(e,t,i,n){var o,s=M(e);if(M(n).hasClass(this._unselectableClass)||this._isDisabledDatepicker(s[0]))return;o=this._getInst(s[0]);o.selectedDay=o.currentDay=M("a",n).html();o.selectedMonth=o.currentMonth=t;o.selectedYear=o.currentYear=i;this._selectDate(e,this._formatDate(o,o.currentDay,o.currentMonth,o.currentYear))},_clearDate:function(e){var t=M(e);this._selectDate(t,"")},_selectDate:function(e,t){var i,n=M(e),o=this._getInst(n[0]);t=t!=null?t:this._formatDate(o);if(o.input)o.input.val(t);this._updateAlternate(o);i=this._get(o,"onSelect");if(i)i.apply(o.input?o.input[0]:null,[t,o]);else if(o.input)o.input.trigger("change");if(o.inline)this._updateDatepicker(o);else{this._hideDatepicker();this._lastInput=o.input[0];if(typeof o.input[0]!=="object")o.input.trigger("focus");this._lastInput=null}},_updateAlternate:function(e){var t,i,n,o=this._get(e,"altField");if(o){t=this._get(e,"altFormat")||this._get(e,"dateFormat");i=this._getDate(e);n=this.formatDate(t,i,this._getFormatConfig(e));M(o).val(n)}},noWeekends:function(e){var t=e.getDay();return[t>0&&t<6,""]},iso8601Week:function(e){var t,i=new Date(e.getTime());i.setDate(i.getDate()+4-(i.getDay()||7));t=i.getTime();i.setMonth(0);i.setDate(1);return Math.floor(Math.round((t-i)/864e5)/7)+1},parseDate:function(i,r,e){if(i==null||r==null)throw"Invalid arguments";r=typeof r==="object"?r.toString():r+"";if(r==="")return null;var n,t,o,a=0,s=(e?e.shortYearCutoff:null)||this._defaults.shortYearCutoff,l=typeof s!=="string"?s:(new Date).getFullYear()%100+parseInt(s,10),c=(e?e.dayNamesShort:null)||this._defaults.dayNamesShort,h=(e?e.dayNames:null)||this._defaults.dayNames,u=(e?e.monthNamesShort:null)||this._defaults.monthNamesShort,p=(e?e.monthNames:null)||this._defaults.monthNames,d=-1,m=-1,f=-1,g=-1,y=false,v,b=function(e){var t=n+1<i.length&&i.charAt(n+1)===e;if(t)n++;return t},_=function(e){var t=b(e),i=e==="@"?14:e==="!"?20:e==="y"&&t?4:e==="o"?3:2,n=e==="y"?i:1,o=new RegExp("^\\d{"+n+","+i+"}"),s=r.substring(a).match(o);if(!s)throw"Missing number at position "+a;a+=s[0].length;return parseInt(s[0],10)},w=function(e,t,i){var n=-1,o=M.map(b(e)?i:t,function(e,t){return[[t,e]]}).sort(function(e,t){return-(e[1].length-t[1].length)});M.each(o,function(e,t){var i=t[1];if(r.substr(a,i.length).toLowerCase()===i.toLowerCase()){n=t[0];a+=i.length;return false}});if(n!==-1)return n+1;else throw"Unknown name at position "+a},k=function(){if(r.charAt(a)!==i.charAt(n))throw"Unexpected literal at position "+a;a++};for(n=0;n<i.length;n++)if(y)if(i.charAt(n)==="'"&&!b("'"))y=false;else k();else switch(i.charAt(n)){case"d":f=_("d");break;case"D":w("D",c,h);break;case"o":g=_("o");break;case"m":m=_("m");break;case"M":m=w("M",u,p);break;case"y":d=_("y");break;case"@":v=new Date(_("@"));d=v.getFullYear();m=v.getMonth()+1;f=v.getDate();break;case"!":v=new Date((_("!")-this._ticksTo1970)/1e4);d=v.getFullYear();m=v.getMonth()+1;f=v.getDate();break;case"'":if(b("'"))k();else y=true;break;default:k()}if(a<r.length){o=r.substr(a);if(!/^\s+/.test(o))throw"Extra/unparsed characters found in date: "+o}if(d===-1)d=(new Date).getFullYear();else if(d<100)d+=(new Date).getFullYear()-(new Date).getFullYear()%100+(d<=l?0:-100);if(g>-1){m=1;f=g;do{t=this._getDaysInMonth(d,m-1);if(f<=t)break;m++;f-=t}while(true)}v=this._daylightSavingAdjust(new Date(d,m-1,f));if(v.getFullYear()!==d||v.getMonth()+1!==m||v.getDate()!==f)throw"Invalid date";return v},ATOM:"yy-mm-dd",COOKIE:"D, dd M yy",ISO_8601:"yy-mm-dd",RFC_822:"D, d M y",RFC_850:"DD, dd-M-y",RFC_1036:"D, d M y",RFC_1123:"D, d M yy",RFC_2822:"D, d M yy",RSS:"D, d M y",TICKS:"!",TIMESTAMP:"@",W3C:"yy-mm-dd",_ticksTo1970:((1970-1)*365+Math.floor(1970/4)-Math.floor(1970/100)+Math.floor(1970/400))*24*60*60*1e7,formatDate:function(i,e,t){if(!e)return"";var n,o=(t?t.dayNamesShort:null)||this._defaults.dayNamesShort,s=(t?t.dayNames:null)||this._defaults.dayNames,r=(t?t.monthNamesShort:null)||this._defaults.monthNamesShort,a=(t?t.monthNames:null)||this._defaults.monthNames,l=function(e){var t=n+1<i.length&&i.charAt(n+1)===e;if(t)n++;return t},c=function(e,t,i){var n=""+t;if(l(e))while(n.length<i)n="0"+n;return n},h=function(e,t,i,n){return l(e)?n[t]:i[t]},u="",p=false;if(e)for(n=0;n<i.length;n++)if(p)if(i.charAt(n)==="'"&&!l("'"))p=false;else u+=i.charAt(n);else switch(i.charAt(n)){case"d":u+=c("d",e.getDate(),2);break;case"D":u+=h("D",e.getDay(),o,s);break;case"o":u+=c("o",Math.round((new Date(e.getFullYear(),e.getMonth(),e.getDate()).getTime()-new Date(e.getFullYear(),0,0).getTime())/864e5),3);break;case"m":u+=c("m",e.getMonth()+1,2);break;case"M":u+=h("M",e.getMonth(),r,a);break;case"y":u+=l("y")?e.getFullYear():(e.getFullYear()%100<10?"0":"")+e.getFullYear()%100;break;case"@":u+=e.getTime();break;case"!":u+=e.getTime()*1e4+this._ticksTo1970;break;case"'":if(l("'"))u+="'";else p=true;break;default:u+=i.charAt(n)}return u},_possibleChars:function(i){var n,e="",t=false,o=function(e){var t=n+1<i.length&&i.charAt(n+1)===e;if(t)n++;return t};for(n=0;n<i.length;n++)if(t)if(i.charAt(n)==="'"&&!o("'"))t=false;else e+=i.charAt(n);else switch(i.charAt(n)){case"d":case"m":case"y":case"@":e+="0123456789";break;case"D":case"M":return null;case"'":if(o("'"))e+="'";else t=true;break;default:e+=i.charAt(n)}return e},_get:function(e,t){return e.settings[t]!==undefined?e.settings[t]:this._defaults[t]},_setDateFromField:function(e,t){if(e.input.val()===e.lastVal)return;var i=this._get(e,"dateFormat"),n=e.lastVal=e.input?e.input.val():null,o=this._getDefaultDate(e),s=o,r=this._getFormatConfig(e);try{s=this.parseDate(i,n,r)||o}catch(e){n=t?"":n}e.selectedDay=s.getDate();e.drawMonth=e.selectedMonth=s.getMonth();e.drawYear=e.selectedYear=s.getFullYear();e.currentDay=n?s.getDate():0;e.currentMonth=n?s.getMonth():0;e.currentYear=n?s.getFullYear():0;this._adjustInstDate(e)},_getDefaultDate:function(e){return this._restrictMinMax(e,this._determineDate(e,this._get(e,"defaultDate"),new Date))},_determineDate:function(a,e,t){var i=function(e){var t=new Date;t.setDate(t.getDate()+e);return t},n=function(e){try{return M.datepicker.parseDate(M.datepicker._get(a,"dateFormat"),e,M.datepicker._getFormatConfig(a))}catch(e){}var t=(e.toLowerCase().match(/^c/)?M.datepicker._getDate(a):null)||new Date,i=t.getFullYear(),n=t.getMonth(),o=t.getDate(),s=/([+\-]?[0-9]+)\s*(d|D|w|W|m|M|y|Y)?/g,r=s.exec(e);while(r){switch(r[2]||"d"){case"d":case"D":o+=parseInt(r[1],10);break;case"w":case"W":o+=parseInt(r[1],10)*7;break;case"m":case"M":n+=parseInt(r[1],10);o=Math.min(o,M.datepicker._getDaysInMonth(i,n));break;case"y":case"Y":i+=parseInt(r[1],10);o=Math.min(o,M.datepicker._getDaysInMonth(i,n));break}r=s.exec(e)}return new Date(i,n,o)},o=e==null||e===""?t:typeof e==="string"?n(e):typeof e==="number"?isNaN(e)?t:i(e):new Date(e.getTime());o=o&&o.toString()==="Invalid Date"?t:o;if(o){o.setHours(0);o.setMinutes(0);o.setSeconds(0);o.setMilliseconds(0)}return this._daylightSavingAdjust(o)},_daylightSavingAdjust:function(e){if(!e)return null;e.setHours(e.getHours()>12?e.getHours()+2:0);return e},_setDate:function(e,t,i){var n=!t,o=e.selectedMonth,s=e.selectedYear,r=this._restrictMinMax(e,this._determineDate(e,t,new Date));e.selectedDay=e.currentDay=r.getDate();e.drawMonth=e.selectedMonth=e.currentMonth=r.getMonth();e.drawYear=e.selectedYear=e.currentYear=r.getFullYear();if((o!==e.selectedMonth||s!==e.selectedYear)&&!i)this._notifyChange(e);this._adjustInstDate(e);if(e.input)e.input.val(n?"":this._formatDate(e))},_getDate:function(e){var t=!e.currentYear||e.input&&e.input.val()===""?null:this._daylightSavingAdjust(new Date(e.currentYear,e.currentMonth,e.currentDay));return t},_attachHandlers:function(e){var t=this._get(e,"stepMonths"),i="#"+e.id.replace(/\\\\/g,"\\");e.dpDiv.find("[data-handler]").map(function(){var e={prev:function(){M.datepicker._adjustDate(i,-t,"M")},next:function(){M.datepicker._adjustDate(i,+t,"M")},hide:function(){M.datepicker._hideDatepicker()},today:function(){M.datepicker._gotoToday(i)},selectDay:function(){M.datepicker._selectDay(i,+this.getAttribute("data-month"),+this.getAttribute("data-year"),this);return false},selectMonth:function(){M.datepicker._selectMonthYear(i,this,"M");return false},selectYear:function(){M.datepicker._selectMonthYear(i,this,"Y");return false}};M(this).on(this.getAttribute("data-event"),e[this.getAttribute("data-handler")])})},_generateHTML:function(e){var t,i,n,o,s,r,a,l,c,h,u,p,d,m,f,g,y,v,b,_,w,k,x,S,C,T,L,M,D,I,A,R,P,E,B,F,N,U,V,O=new Date,G=this._daylightSavingAdjust(new Date(O.getFullYear(),O.getMonth(),O.getDate())),z=this._get(e,"isRTL"),H=this._get(e,"showButtonPanel"),W=this._get(e,"hideIfNoPrevNext"),q=this._get(e,"navigationAsDateFormat"),j=this._getNumberOfMonths(e),$=this._get(e,"showCurrentAtPos"),J=this._get(e,"stepMonths"),Y=j[0]!==1||j[1]!==1,K=this._daylightSavingAdjust(!e.currentDay?new Date(9999,9,9):new Date(e.currentYear,e.currentMonth,e.currentDay)),X=this._getMinMaxDate(e,"min"),Z=this._getMinMaxDate(e,"max"),Q=e.drawMonth-$,ee=e.drawYear;if(Q<0){Q+=12;ee--}if(Z){t=this._daylightSavingAdjust(new Date(Z.getFullYear(),Z.getMonth()-j[0]*j[1]+1,Z.getDate()));t=X&&t<X?X:t;while(this._daylightSavingAdjust(new Date(ee,Q,1))>t){Q--;if(Q<0){Q=11;ee--}}}e.drawMonth=Q;e.drawYear=ee;i=this._get(e,"prevText");i=!q?i:this.formatDate(i,this._daylightSavingAdjust(new Date(ee,Q-J,1)),this._getFormatConfig(e));n=this._canAdjustMonth(e,-1,ee,Q)?"<a class='ui-datepicker-prev ui-corner-all' data-handler='prev' data-event='click'"+" title='"+i+"'><span class='ui-icon ui-icon-circle-triangle-"+(z?"e":"w")+"'>"+i+"</span></a>":W?"":"<a class='ui-datepicker-prev ui-corner-all ui-state-disabled' title='"+i+"'><span class='ui-icon ui-icon-circle-triangle-"+(z?"e":"w")+"'>"+i+"</span></a>";o=this._get(e,"nextText");o=!q?o:this.formatDate(o,this._daylightSavingAdjust(new Date(ee,Q+J,1)),this._getFormatConfig(e));s=this._canAdjustMonth(e,+1,ee,Q)?"<a class='ui-datepicker-next ui-corner-all' data-handler='next' data-event='click'"+" title='"+o+"'><span class='ui-icon ui-icon-circle-triangle-"+(z?"w":"e")+"'>"+o+"</span></a>":W?"":"<a class='ui-datepicker-next ui-corner-all ui-state-disabled' title='"+o+"'><span class='ui-icon ui-icon-circle-triangle-"+(z?"w":"e")+"'>"+o+"</span></a>";r=this._get(e,"currentText");a=this._get(e,"gotoCurrent")&&e.currentDay?K:G;r=!q?r:this.formatDate(r,a,this._getFormatConfig(e));l=!e.inline?"<button type='button' class='ui-datepicker-close ui-state-default ui-priority-primary ui-corner-all' data-handler='hide' data-event='click'>"+this._get(e,"closeText")+"</button>":"";c=H?"<div class='ui-datepicker-buttonpane ui-widget-content'>"+(z?l:"")+(this._isInRange(e,a)?"<button type='button' class='ui-datepicker-current ui-state-default ui-priority-secondary ui-corner-all' data-handler='today' data-event='click'"+">"+r+"</button>":"")+(z?"":l)+"</div>":"";h=parseInt(this._get(e,"firstDay"),10);h=isNaN(h)?0:h;u=this._get(e,"showWeek");p=this._get(e,"dayNames");d=this._get(e,"dayNamesMin");m=this._get(e,"monthNames");f=this._get(e,"monthNamesShort");g=this._get(e,"beforeShowDay");y=this._get(e,"showOtherMonths");v=this._get(e,"selectOtherMonths");b=this._getDefaultDate(e);_="";for(k=0;k<j[0];k++){x="";this.maxRows=4;for(S=0;S<j[1];S++){C=this._daylightSavingAdjust(new Date(ee,Q,e.selectedDay));T=" ui-corner-all";L="";if(Y){L+="<div class='ui-datepicker-group";if(j[1]>1)switch(S){case 0:L+=" ui-datepicker-group-first";T=" ui-corner-"+(z?"right":"left");break;case j[1]-1:L+=" ui-datepicker-group-last";T=" ui-corner-"+(z?"left":"right");break;default:L+=" ui-datepicker-group-middle";T="";break}L+="'>"}L+="<div class='ui-datepicker-header ui-widget-header ui-helper-clearfix"+T+"'>"+(/all|left/.test(T)&&k===0?z?s:n:"")+(/all|right/.test(T)&&k===0?z?n:s:"")+this._generateMonthYearHeader(e,Q,ee,X,Z,k>0||S>0,m,f)+"</div><table class='ui-datepicker-calendar'><thead>"+"<tr>";M=u?"<th class='ui-datepicker-week-col'>"+this._get(e,"weekHeader")+"</th>":"";for(w=0;w<7;w++){D=(w+h)%7;M+="<th scope='col'"+((w+h+6)%7>=5?" class='ui-datepicker-week-end'":"")+">"+"<span title='"+p[D]+"'>"+d[D]+"</span></th>"}L+=M+"</tr></thead><tbody>";I=this._getDaysInMonth(ee,Q);if(ee===e.selectedYear&&Q===e.selectedMonth)e.selectedDay=Math.min(e.selectedDay,I);A=(this._getFirstDayOfMonth(ee,Q)-h+7)%7;R=Math.ceil((A+I)/7);P=Y?this.maxRows>R?this.maxRows:R:R;this.maxRows=P;E=this._daylightSavingAdjust(new Date(ee,Q,1-A));for(B=0;B<P;B++){L+="<tr>";F=!u?"":"<td class='ui-datepicker-week-col'>"+this._get(e,"calculateWeek")(E)+"</td>";for(w=0;w<7;w++){N=g?g.apply(e.input?e.input[0]:null,[E]):[true,""];U=E.getMonth()!==Q;V=U&&!v||!N[0]||X&&E<X||Z&&E>Z;F+="<td class='"+((w+h+6)%7>=5?" ui-datepicker-week-end":"")+(U?" ui-datepicker-other-month":"")+(E.getTime()===C.getTime()&&Q===e.selectedMonth&&e._keyEvent||b.getTime()===E.getTime()&&b.getTime()===C.getTime()?" "+this._dayOverClass:"")+(V?" "+this._unselectableClass+" ui-state-disabled":"")+(U&&!y?"":" "+N[1]+(E.getTime()===K.getTime()?" "+this._currentClass:"")+(E.getTime()===G.getTime()?" ui-datepicker-today":""))+"'"+((!U||y)&&N[2]?" title='"+N[2].replace(/'/g,"&#39;")+"'":"")+(V?"":" data-handler='selectDay' data-event='click' data-month='"+E.getMonth()+"' data-year='"+E.getFullYear()+"'")+">"+(U&&!y?"&#xa0;":V?"<span class='ui-state-default'>"+E.getDate()+"</span>":"<a class='ui-state-default"+(E.getTime()===G.getTime()?" ui-state-highlight":"")+(E.getTime()===K.getTime()?" ui-state-active":"")+(U?" ui-priority-secondary":"")+"' href='#'>"+E.getDate()+"</a>")+"</td>";E.setDate(E.getDate()+1);E=this._daylightSavingAdjust(E)}L+=F+"</tr>"}Q++;if(Q>11){Q=0;ee++}L+="</tbody></table>"+(Y?"</div>"+(j[0]>0&&S===j[1]-1?"<div class='ui-datepicker-row-break'></div>":""):"");x+=L}_+=x}_+=c;e._keyEvent=false;return _},_generateMonthYearHeader:function(e,t,i,n,o,s,r,a){var l,c,h,u,p,d,m,f,g=this._get(e,"changeMonth"),y=this._get(e,"changeYear"),v=this._get(e,"showMonthAfterYear"),b="<div class='ui-datepicker-title'>",_="";if(s||!g)_+="<span class='ui-datepicker-month'>"+r[t]+"</span>";else{l=n&&n.getFullYear()===i;c=o&&o.getFullYear()===i;_+="<select class='ui-datepicker-month' data-handler='selectMonth' data-event='change'>";for(h=0;h<12;h++)if((!l||h>=n.getMonth())&&(!c||h<=o.getMonth()))_+="<option value='"+h+"'"+(h===t?" selected='selected'":"")+">"+a[h]+"</option>";_+="</select>"}if(!v)b+=_+(s||!(g&&y)?"&#xa0;":"");if(!e.yearshtml){e.yearshtml="";if(s||!y)b+="<span class='ui-datepicker-year'>"+i+"</span>";else{u=this._get(e,"yearRange").split(":");p=(new Date).getFullYear();d=function(e){var t=e.match(/c[+\-].*/)?i+parseInt(e.substring(1),10):e.match(/[+\-].*/)?p+parseInt(e,10):parseInt(e,10);return isNaN(t)?p:t};m=d(u[0]);f=Math.max(m,d(u[1]||""));m=n?Math.max(m,n.getFullYear()):m;f=o?Math.min(f,o.getFullYear()):f;e.yearshtml+="<select class='ui-datepicker-year' data-handler='selectYear' data-event='change'>";for(;m<=f;m++)e.yearshtml+="<option value='"+m+"'"+(m===i?" selected='selected'":"")+">"+m+"</option>";e.yearshtml+="</select>";b+=e.yearshtml;e.yearshtml=null}}b+=this._get(e,"yearSuffix");if(v)b+=(s||!(g&&y)?"&#xa0;":"")+_;b+="</div>";return b},_adjustInstDate:function(e,t,i){var n=e.selectedYear+(i==="Y"?t:0),o=e.selectedMonth+(i==="M"?t:0),s=Math.min(e.selectedDay,this._getDaysInMonth(n,o))+(i==="D"?t:0),r=this._restrictMinMax(e,this._daylightSavingAdjust(new Date(n,o,s)));e.selectedDay=r.getDate();e.drawMonth=e.selectedMonth=r.getMonth();e.drawYear=e.selectedYear=r.getFullYear();if(i==="M"||i==="Y")this._notifyChange(e)},_restrictMinMax:function(e,t){var i=this._getMinMaxDate(e,"min"),n=this._getMinMaxDate(e,"max"),o=i&&t<i?i:t;return n&&o>n?n:o},_notifyChange:function(e){var t=this._get(e,"onChangeMonthYear");if(t)t.apply(e.input?e.input[0]:null,[e.selectedYear,e.selectedMonth+1,e])},_getNumberOfMonths:function(e){var t=this._get(e,"numberOfMonths");return t==null?[1,1]:typeof t==="number"?[1,t]:t},_getMinMaxDate:function(e,t){return this._determineDate(e,this._get(e,t+"Date"),null)},_getDaysInMonth:function(e,t){return 32-this._daylightSavingAdjust(new Date(e,t,32)).getDate()},_getFirstDayOfMonth:function(e,t){return new Date(e,t,1).getDay()},_canAdjustMonth:function(e,t,i,n){var o=this._getNumberOfMonths(e),s=this._daylightSavingAdjust(new Date(i,n+(t<0?t:o[0]*o[1]),1));if(t<0)s.setDate(this._getDaysInMonth(s.getFullYear(),s.getMonth()));return this._isInRange(e,s)},_isInRange:function(e,t){var i,n,o=this._getMinMaxDate(e,"min"),s=this._getMinMaxDate(e,"max"),r=null,a=null,l=this._get(e,"yearRange");if(l){i=l.split(":");n=(new Date).getFullYear();r=parseInt(i[0],10);a=parseInt(i[1],10);if(i[0].match(/[+\-].*/))r+=n;if(i[1].match(/[+\-].*/))a+=n}return(!o||t.getTime()>=o.getTime())&&(!s||t.getTime()<=s.getTime())&&(!r||t.getFullYear()>=r)&&(!a||t.getFullYear()<=a)},_getFormatConfig:function(e){var t=this._get(e,"shortYearCutoff");t=typeof t!=="string"?t:(new Date).getFullYear()%100+parseInt(t,10);return{shortYearCutoff:t,dayNamesShort:this._get(e,"dayNamesShort"),dayNames:this._get(e,"dayNames"),monthNamesShort:this._get(e,"monthNamesShort"),monthNames:this._get(e,"monthNames")}},_formatDate:function(e,t,i,n){if(!t){e.currentDay=e.selectedDay;e.currentMonth=e.selectedMonth;e.currentYear=e.selectedYear}var o=t?typeof t==="object"?t:this._daylightSavingAdjust(new Date(n,i,t)):this._daylightSavingAdjust(new Date(e.currentYear,e.currentMonth,e.currentDay));return this.formatDate(this._get(e,"dateFormat"),o,this._getFormatConfig(e))}}),M.fn.datepicker=function(e){if(!this.length)return this;if(!M.datepicker.initialized){M(document).on("mousedown",M.datepicker._checkExternalClick);M.datepicker.initialized=true}if(M("#"+M.datepicker._mainDivId).length===0)M("body").append(M.datepicker.dpDiv);var t=Array.prototype.slice.call(arguments,1);if(typeof e==="string"&&(e==="isDisabled"||e==="getDate"||e==="widget"))return M.datepicker["_"+e+"Datepicker"].apply(M.datepicker,[this[0]].concat(t));if(e==="option"&&arguments.length===2&&typeof arguments[1]==="string")return M.datepicker["_"+e+"Datepicker"].apply(M.datepicker,[this[0]].concat(t));return this.each(function(){typeof e==="string"?M.datepicker["_"+e+"Datepicker"].apply(M.datepicker,[this].concat(t)):M.datepicker._attachDatepicker(this,e)})},M.datepicker=new C,M.datepicker.initialized=false,M.datepicker.uuid=(new Date).getTime(),M.datepicker.version="1.12.1";var I=M.datepicker})?i.apply(t,n):i)||(e.exports=i)},1392:function(e,t,i){var n=i(1440);"string"==typeof n&&(n=[[e.i,n,""]]);i(93)(n,{});n.locals&&(e.exports=n.locals)},1394:function(i,e,n){!function(k){var e,t,o={}.hasOwnProperty;function x(){return x.__super__.constructor.apply(this,arguments)}e=n(25),t=n(633),i.exports=(function(e,t){for(var i in t)o.call(t,i)&&(e[i]=t[i]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(x,e),x.className="Poll",x.schema=t,x.prototype.urlRoot="/db/poll",x.prototype.applyDelta=function(e){var t,i,n,o,s,r,a,l,c,h,u,p,d,m,f,g,y,v,b,w={};for(i in e.i18n&&(w.i18n=k.extend(!0,{},e.i18n)),m=null!=(e=e.answers)?e:{})if(t=m[i],null==w.answers&&(w.answers={}),_.isArray(t))for(null==(n=w.answers)[i]&&(n[i]=[]),r=0,h=t.length;r<h;r++){if(s=t[r],_.isNumber(s))d=s;else for(l in d=k.extend(!0,{},s))if(a=parseInt(i.replace("_",""),10),!_.isNaN(a)){if(p=this.get("answers")[a][l],a=_.string.startsWith(i,"_"),"i18n"===l&&!a)for(c in b=d[l],f=null!=p?p:{})for(y in g=null!=(u=f[c])?u:{})v=g[y],null==b[c]&&(b[c]={}),null==(o=b[c])[y]&&(o[y]=v);else b=p;d[l]=b}w.answers[i].push(d)}else null!=(w.answers[i]=t)&&t.votes&&(w.answers[i]=_.omit(t,"votes"));return x.__super__.applyDelta.call(this,w)},x)}.call(this,n(3))},1395:function(e,t,i){var n,o={}.hasOwnProperty;function s(){return s.__super__.constructor.apply(this,arguments)}n=i(25),i=i(1447),e.exports=(function(e,t){for(var i in t)o.call(t,i)&&(e[i]=t[i]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(s,n),s.className="UserPollsRecord",s.schema=i,s.prototype.urlRoot="/db/user.polls.record",s)},1398:function(e,t,i){var n,o={}.hasOwnProperty;function s(){return s.__super__.constructor.apply(this,arguments)}n=i(115),i=i(1375),e.exports=(function(e,t){for(var i in t)o.call(t,i)&&(e[i]=t[i]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(s,n),s.prototype.url="/db/level.session",s.prototype.model=i,s.prototype.fetchForCourseInstance=function(e,t){var i=(null!=t?t.userID:void 0)||me.id;return t=_.extend({url:"/db/course_instance/"+e+"/course-level-sessions/"+i},t),this.fetch(t)},s.prototype.fetchForClassroomMembers=function(e,t){return t=_.extend({url:"/db/classroom/"+e+"/member-sessions"},t),this.fetch(t)},s.prototype.fetchForAllClassroomMembers=function(e,t){var i,n,o;for(null==t&&(t={}),o=0,n=_.size(e.get("members")),null==t.data&&(t.data={}),t.data.memberLimit=10,t.remove=!1,i=[];o<n;)(t=_.cloneDeep(t)).data.memberSkip=o,i.push(this.fetchForClassroomMembers(e.id,t)),o+=10;return i},s.prototype.fetchRecentSessions=function(e){return null==e&&(e={}),e=_.extend({url:"/db/level.session/-/recent"},e),this.fetch(e)},s.prototype.fetchForLevelSlug=function(e,t){return null==t&&(t={}),t=_.extend({url:"/db/level/"+e+"/my_sessions"},t),this.fetch(t)},s)},1400:function(e,t,a){var l=a(11);e.exports=function(e){var s,r=[],e=e||{};return function(e,t,i,n){var o;r.push('<div class="style-flat"><nav id="main-nav"'+l.cls(["navbar","navbar-default","navbar-fixed-top","text-center",!i.static&&/^\/(league|play\/ladder)/.test(e.location.pathname)?"dark-mode":""],[null,null,null,null,!0])+'><div class="container-fluid"><div class="row"><div class="col-md-12"><div class="navbar-header"><button data-toggle="collapse" data-target="#navbar-collapse" aria-expanded="false" class="navbar-toggle collapsed"><span data-i18n="nav.toggle_nav" class="sr-only"></span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button>'),t.useTarenaLogo()?r.push('<a href="http://kidtts.tmooc.cn/ttsPage/login.html" class="navbar-brand"><img id="logo-img" src="/images/pages/base/logo.png" alt="CodeCombat logo" class="powered-by"><img id="tarena-logo" src="/images/pages/base/logo-tarena.png" alt="Tarena logo"></a>'):i.codeNinjas?r.push('<a href="/home" class="navbar-brand"><img id="logo-img" src="/images/pages/base/logo.png" alt="CodeCombat logo" class="powered-by"><img src="/images/pages/base/code-ninjas-logo-right.png" alt="Code Ninjas logo" class="code-ninjas-logo"></a>'):t.showChinaResourceInfo()?r.push('<a href="/home" class="navbar-brand"><img id="logo-img" src="/images/pages/base/logo-en+cn.png" alt="CodeCombat logo"></a>'):r.push('<a href="/home" class="navbar-brand"><img id="logo-img" src="/images/pages/base/logo.png" alt="CodeCombat logo"></a>'),r.push("</div>"),n.isOldBrowser()&&r.push('<div class="navbar-browser-recommendation navbar-header"><div class="nav-spacer"><div class="navbar-nav"><a href="https://www.google.cn/intl/zh-CN/chrome/" data-i18n="nav.browser_recommendation" class="text-p"></a></div></div></div>'),r.push('</div></div></div></nav><div id="site-content-area"><p>If this is showing, you dun goofed</p></div><div id="footer" class="small">'),t.hideFooter()||(r.push('<div class="container"><div class="row">'),t.showChinaResourceInfo()?(r.push('<div class="col-lg-12"><div class="row"><div class="col-lg-3"><h3 data-i18n="nav.general"></h3><ul class="list-unstyled"><li><a href="/about" data-i18n="nav.about"></a></li>\x3c!--li--\x3e\x3c!--  a(href="/about#careers", data-i18n="nav.careers")--\x3e'),t.isStudent()||r.push('<li><a href="/contact-cn" data-i18n="nav.contact"></a></li>'),r.push('<li><a href="/parents" data-i18n="nav.parent"></a></li><li><a href="http://blog.koudashijie.com/" data-i18n="nav.blog"></a></li><li><a href="http://beian.miit.gov.cn/">ICP19012263</a></li></ul></div><div class="col-lg-3">'),t.isStudent()||(r.push('<h3 data-i18n="nav.educators"></h3><ul class="list-unstyled"><li>'),o="/teachers/resources/faq","nl-NL"!=t.get("preferredLanguage")&&"nl-BE"!=t.get("preferredLanguage")||(o="/teachers/resources/faq-nl-NL"),"he"==t.get("preferredLanguage")&&(o="/teachers/resources/faq-HE"),"pt-BR"!=t.get("preferredLanguage")&&"pt-PT"!=t.get("preferredLanguage")||(o="/teachers/resources/faq-pt-BR"),"zh-HANS"!=t.get("preferredLanguage")&&"zh-HANT"!=t.get("preferredLanguage")||(o="/teachers/resources/faq-zh-HANS"),r.push("<a"+l.attr("href",o,!0,!0)+' data-i18n="teacher.educator_faq"></a></li><li><a href="/teachers/resources" data-i18n="nav.resource_hub"></a></li><li><a href="https://ozaria.com" data-i18n="new_home.try_ozaria"></a></li><li><a href="/teachers/classes" data-i18n="nav.my_classrooms"></a></li></ul>')),r.push('</div><div class="col-lg-3"><h3></h3><ul class="list-unstyled"><li><a href="https://codecombat.163.com"></a></li><li><a href="https://aojiarui.com"> - CodeCombat</a></li><li><a href="https://codecombat.com">CodeCombat</a></li></ul></div><div class="col-lg-3"><h3 data-i18n="nav.follow_us"></h3><img src="https://assets.koudashijie.com/images/mpqrcode.jpeg" class="mpqr"></div></div></div>')):(r.push('<div class="col-lg-12"><div class="row"><div class="col-lg-3"><h3 data-i18n="nav.general"></h3><ul class="list-unstyled"><li><a href="/about" data-i18n="nav.about"></a></li><li><a href="/about#careers" data-i18n="nav.careers"></a></li>'),t.showChinaResourceInfo()||r.push('<li><a tabindex="-1" data-i18n="nav.contact" class="contact-modal"></a></li>'),r.push('<li><a href="/parents" data-i18n="nav.parent"></a></li><li><a href="http://blog.codecombat.com/" data-i18n="nav.blog"></a></li></ul></div><div class="col-lg-3">'),t.isStudent()||(r.push('<h3 data-i18n="nav.educators"></h3><ul class="list-unstyled"><li>'),o="/teachers/resources/faq","nl-NL"!=t.get("preferredLanguage")&&"nl-BE"!=t.get("preferredLanguage")||(o="/teachers/resources/faq-nl-NL"),"he"==t.get("preferredLanguage")&&(o="/teachers/resources/faq-HE"),"pt-BR"!=t.get("preferredLanguage")&&"pt-PT"!=t.get("preferredLanguage")||(o="/teachers/resources/faq-pt-BR"),"zh-HANS"!=t.get("preferredLanguage")&&"zh-HANT"!=t.get("preferredLanguage")||(o="/teachers/resources/faq-zh-HANS"),r.push("<a"+l.attr("href",o,!0,!0)+' data-i18n="teacher.educator_faq"></a></li><li><a href="/teachers/resources" data-i18n="nav.resource_hub"></a></li><li><a href="https://ozaria.com" data-i18n="new_home.try_ozaria"></a></li><li><a href="/teachers/classes" data-i18n="nav.my_classrooms"></a></li></ul>')),r.push('</div><div class="col-lg-3"><h3 data-i18n="nav.get_involved"></h3><ul class="list-unstyled"><li><a href="/community" data-i18n="nav.community"></a></li><li><a href="/league" data-i18n="game_menu.multiplayer_tab"></a></li><li><a href="https://github.com/codecombat/codecombat">GitHub</a></li>'),!t.isStudent()&&t.showForumLink()&&r.push("<li><a"+l.attr("href",n.forumLink(),!0,!0)+' data-i18n="nav.forum"></a></li>'),r.push('</ul></div><div class="col-lg-3">'),!t.showingStaticPagesWhileLoading()&&t.useSocialSignOn()&&r.push('<h3 data-i18n="nav.follow_us"></h3><div class="social-buttons"><a href="https://www.youtube.com/channel/UCEl7Rs_jtl3hcbnp0xZclQA" target="_blank"><img src="/images/pages/base/youtube_symbol_button.png" width="40"></a><a href="https://twitter.com/codecombat" target="_blank"><img src="/images/pages/base/twitter_logo_btn.png" width="40"></a><a href="https://www.facebook.com/codecombat" target="_blank"><img src="/images/pages/base/facebook_logo_btn.png" width="40"></a></div>'),r.push("</div></div></div>")),r.push('</div></div><div id="final-footer" dir="ltr"><img src="/images/pages/base/logo.png" alt="CodeCombat"><div class="float-right">'),t.showChinaResourceInfo()&&({COCO_CHINA_CONST:t}=a(268),r.push('<span class="contact">'+l.escape(null==(s=""+t.CONTACT_EMAIL)?"":s)+'</span><span class="contact">'+l.escape(null==(s=""+t.CONTACT_PHONE)?"":s)+"</span>")),r.push('<span data-i18n="nav.copyright_prefix"></span><span>'+l.escape(s=" 2021 CodeCombat Inc. ")+'</span><span data-i18n="nav.copyright_suffix" class="spl"></span><a href="/legal" class="small">Terms of Service</a><a href="/privacy" class="small">Privacy</a></div></div>')),r.push("</div></div>")}.call(this,"document"in e?e.document:"undefined"!=typeof document?document:void 0,"me"in e?e.me:"undefined"!=typeof me?me:void 0,"serverConfig"in e?e.serverConfig:"undefined"!=typeof serverConfig?serverConfig:void 0,"view"in e?e.view:"undefined"!=typeof view?view:void 0),r.join("")}},1404:function(e,t,i){var n,o={}.hasOwnProperty;function s(){return s.__super__.constructor.apply(this,arguments)}n=i(25),e.exports=(function(e,t){for(var i in t)o.call(t,i)&&(e[i]=t[i]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(s,n),s.className="CodeLog",s.schema=i(1442),s.prototype.urlRoot="/db/codelogs",s)},1405:function(e,t,i){var n,o={}.hasOwnProperty;function s(){return s.__super__.constructor.apply(this,arguments)}n=i(25),e.exports=(function(e,t){for(var i in t)o.call(t,i)&&(e[i]=t[i]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(s,n),s.className="LevelFeedback",s.schema=i(1443),s.prototype.urlRoot="/db/level.feedback",s)},1406:function(e,t,i){var n,o,s,r={}.hasOwnProperty;function a(){return a.__super__.constructor.apply(this,arguments)}n=i(618),s=i(52),o={commit:_.noop,dispatch:_.noop},e.exports=(function(e,t){for(var i in t)r.call(t,i)&&(e[i]=t[i]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(a,n),a.prototype.VueComponent=null,a.prototype.vuexModule=null,a.prototype.propsData=null,a.prototype.afterRender=function(){if(this.vueComponent)this.$el.find("#site-content-area").replaceWith(this.vueComponent.$el);else{if(this.vuexModule){if(!_.isFunction(this.vuexModule))throw new Error("@vuexModule should be a function");s.registerModule("page",this.vuexModule())}this.vueComponent=new this.VueComponent({el:this.$el.find("#site-content-area")[0],propsData:this.propsData,store:s}),window.rootComponent=this.vueComponent}return a.__super__.afterRender.apply(this,arguments)},a.prototype.destroy=function(){return this.vuexModule&&s.unregisterModule("page"),this.vueComponent.$destroy(),this.vueComponent.$store=o,a.__super__.destroy.call(this)},a)},1407:function(e,t,i){var n,o,s,r,a,l=function(e,t){return function(){return e.apply(t,arguments)}},c={}.hasOwnProperty;function h(e,t){var i;this.canvas=e,this.options=null!=t?t:{},this.finishTween=l(this.finishTween,this),i=Math.asin(.75),e=r(30),h.__super__.constructor.call(this),this.gameUIState=this.options.gameUIState||new o,this.listenTo(this.gameUIState,"surface:stage-mouse-move",this.onMouseMove),this.listenTo(this.gameUIState,"surface:stage-mouse-down",this.onMouseDown),this.listenTo(this.gameUIState,"surface:stage-mouse-up",this.onMouseUp),this.listenTo(this.gameUIState,"surface:mouse-scrolled",this.onMouseScrolled),this.handleEvents=null==(t=this.options.handleEvents)||t,this.canvasWidth=parseInt(this.canvas.attr("width"),10),this.canvasHeight=parseInt(this.canvas.attr("height"),10),this.offset={x:0,y:0},this.calculateViewingAngle(i),this.calculateFieldOfView(e),this.calculateAxisConversionFactors(),this.calculateMinMaxZoom(),this.updateViewports()}n=i(45),o=i(1381),s=i(1373),a=function(e){return 180*e/Math.PI},r=function(e){return e/180*Math.PI},i={x:0,y:0},e.exports=(function(e,t){for(var i in t)c.call(t,i)&&(e[i]=t[i]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(h,n),h.PPM=10,h.MPP=.1,h.prototype.bounds=null,h.prototype.target=i,h.prototype.zoom=2,h.prototype.canvasScaleFactorX=1,h.prototype.canvasScaleFactorY=1,h.prototype.oldZoom=null,h.prototype.newZoom=null,h.prototype.oldTarget=null,h.prototype.newTarget=null,h.prototype.tweenProgress=0,h.prototype.instant=!1,h.prototype.subscriptions={"camera:zoom-in":"onZoomIn","camera:zoom-out":"onZoomOut","camera:zoom-to":"onZoomTo","level:restarted":"onLevelRestarted"},h.prototype.onResize=function(e,t){return this.canvasScaleFactorX=e/this.canvasWidth,this.canvasScaleFactorY=t/this.canvasHeight,Backbone.Mediator.publish("camera:zoom-updated",{camera:this,zoom:this.zoom,surfaceViewport:this.surfaceViewport})},h.prototype.calculateViewingAngle=function(e){if(this.angle=Math.max(Math.min(Math.PI/2-1e-6,e),1e-6),this.angle!==e&&0!==e&&e!==Math.PI/2)return console.log("Restricted given camera angle of "+a(e)+" to "+a(this.angle)+".")},h.prototype.calculateFieldOfView=function(e){if(this.hFOV=Math.max(Math.min(Math.PI-1e-6,e),1e-6),this.hFOV!==e&&0!==e&&e!==Math.PI&&console.log("Restricted given horizontal field of view to "+a(e)+" to "+a(this.hFOV)+"."),this.vFOV=2*Math.atan(Math.tan(this.hFOV/2)*this.canvasHeight/this.canvasWidth),this.vFOV>Math.PI)return console.log("Vertical field of view problem: expected canvas not to be taller than it is wide with high field of view."),this.vFOV=Math.PI-1e-6},h.prototype.calculateAxisConversionFactors=function(){return this.y2x=Math.sin(this.angle),this.z2x=Math.cos(this.angle),this.z2y=this.z2x/this.y2x,this.x2y=1/this.y2x,this.x2z=1/this.z2x,this.y2z=1/this.z2y},h.prototype.worldToSurface=function(e){var t=e.x*h.PPM,i=-e.y*this.y2x*h.PPM;return e.z&&(i-=this.z2y*this.y2x*e.z*h.PPM),{x:t,y:i}},h.prototype.surfaceToCanvas=function(e){return{x:(e.x-this.surfaceViewport.x)*this.zoom,y:(e.y-this.surfaceViewport.y)*this.zoom}},h.prototype.canvasToScreen=function(e){return{x:e.x*this.canvasScaleFactorX,y:e.y*this.canvasScaleFactorY}},h.prototype.screenToCanvas=function(e){return{x:e.x/this.canvasScaleFactorX,y:e.y/this.canvasScaleFactorY}},h.prototype.canvasToSurface=function(e){return{x:e.x/this.zoom+this.surfaceViewport.x,y:e.y/this.zoom+this.surfaceViewport.y}},h.prototype.surfaceToWorld=function(e){return{x:e.x*h.MPP,y:-e.y*h.MPP*this.x2y,z:0}},h.prototype.canvasToWorld=function(e){return this.surfaceToWorld(this.canvasToSurface(e))},h.prototype.worldToCanvas=function(e){return this.surfaceToCanvas(this.worldToSurface(e))},h.prototype.worldToScreen=function(e){return this.canvasToScreen(this.worldToCanvas(e))},h.prototype.surfaceToScreen=function(e){return this.canvasToScreen(this.surfaceToCanvas(e))},h.prototype.screenToSurface=function(e){return this.canvasToSurface(this.screenToCanvas(e))},h.prototype.screenToWorld=function(e){return this.surfaceToWorld(this.screenToSurface(e))},h.prototype.cameraWorldPos=function(){var e=this.x2y*this.vFOV/(this.y2x+this.x2y),e=(this.y2x,this.vFOV,this.y2x,this.x2y,this.worldViewport.height/2*Math.sin(this.angle)/Math.sin(e)*Math.sin(this.angle+e));return{x:this.worldViewport.cx,y:this.worldViewport.cy-e*this.z2y,z:e}},h.prototype.distanceTo=function(e){var t=this.cameraWorldPos(),i=e.x-t.x,n=e.y-t.y,t=(e.z||0)-t.z;return Math.sqrt(i*i+n*n+t*t)},h.prototype.distanceRatioTo=function(e){var t=this.cameraWorldPos(),i=this.worldViewport.cy-t.y,t=Math.sqrt(i*i+t.z*t.z);return this.distanceTo(e)/t},h.prototype.onZoomIn=function(e){return this.zoomTo(this.target,1.15*this.zoom,300)},h.prototype.onZoomOut=function(e){return this.zoomTo(this.target,this.zoom/1.15,300)},h.prototype.onMouseDown=function(e){if(!this.dragDisabled)return this.lastPos={x:e.originalEvent.rawX,y:e.originalEvent.rawY},this.mousePressed=!0},h.prototype.onMouseMove=function(e){var t;if(this.mousePressed&&this.gameUIState.get("canDragCamera")&&!this.dragDisabled)return t={x:(t=this.boundTarget(this.target,this.zoom)).x+(this.lastPos.x-e.originalEvent.rawX)/this.zoom,y:t.y+(this.lastPos.y-e.originalEvent.rawY)/this.zoom},this.zoomTo(t,this.zoom,0),this.lastPos={x:e.originalEvent.rawX,y:e.originalEvent.rawY},Backbone.Mediator.publish("camera:dragged",{})},h.prototype.onMouseUp=function(e){return this.mousePressed=!1},h.prototype.onMouseScrolled=function(e){var t,i,n,o,s=1+.05*Math.sqrt(Math.abs(e.deltaY));return 0<e.deltaY&&(s=1/s),i=this.zoom*s,o=e.screenPos&&!this.focusedOnSprite()?(n=((t=this.screenToSurface(e.screenPos)).x-this.surfaceViewport.x)/this.surfaceViewport.width,s=(t.y-this.surfaceViewport.y)/this.surfaceViewport.height,e=this.canvasWidth/i,o=this.canvasHeight/i,{x:t.x-e*n+e/2,y:t.y-o*s+o/2}):this.target,this.zoomTo(o,i,0)},h.prototype.onLevelRestarted=function(){return this.setBounds(this.firstBounds,!1)},h.prototype.setBounds=function(e,t){if(null==t&&(t=!0),this.firstBounds||(this.firstBounds=e),this.bounds=this.normalizeBounds(e),this.calculateMinMaxZoom(),t&&this.updateZoom(!0),!this.focusedOnSprite())return this.target=this.currentTarget},h.prototype.normalizeBounds=function(e){var t,i,n;return e?(n=Math.max(e[0].y,e[1].y),t=Math.min(e[0].x,e[1].x),n===(i=Math.min(e[0].y,e[1].y))&&--i,t===(e=Math.max(e[0].x,e[1].x))&&(e+=1),n=this.worldToSurface({x:t,y:n}),i=this.worldToSurface({x:e,y:i}),{x:n.x,y:n.y,width:i.x-n.x,height:i.y-n.y}):null},h.prototype.calculateMinMaxZoom=function(){return this.maxZoom=8,this.bounds?(this.minZoom=Math.max(this.canvasWidth/this.bounds.width,this.canvasHeight/this.bounds.height),this.zoom?(this.zoom=Math.max(this.minZoom,this.zoom),this.zoom=Math.min(this.maxZoom,this.zoom)):void 0):this.minZoom=.25},h.prototype.zoomTo=function(e,t,i){var n,o;if(null==t&&(t=1),null==i&&(i=1500),this.instant&&(i=0),null==(e=null==e?null:e)&&(e={x:0,y:0}),this.locked&&(e=this.newTarget||this.target),t=Math.max(t,this.minZoom),t=Math.min(t,this.maxZoom),(o=null!=(o=this.target)&&null!=(n=o.sprite)?n.thangType:void 0)?(this.offset=_.clone((null!=(n=o.get("positions"))?n.torso:void 0)||{x:0,y:0}),o=o.get("scale")||1,this.offset.x*=o,this.offset.y*=o):this.offset={x:0,y:0},this.zoom!==t||e!==e.x||e.y!=e.y)return this.finishTween(!0),i?(this.newTarget=e,this.oldTarget=this.boundTarget(this.target,this.zoom),this.oldZoom=this.zoom,this.newZoom=t,this.tweenProgress=.01,s.Tween.get(this).to({tweenProgress:1},i,s.Ease.getPowOut(4)).call(this.finishTween)):(this.target=e,this.zoom=t,this.updateZoom(!0))},h.prototype.focusedOnSprite=function(){var e;return null!=(e=this.target)?e.name:void 0},h.prototype.finishTween=function(e){if(null==e&&(e=!1),s.Tween.removeTweens(this),this.newTarget)return!0!==e&&(this.target=this.newTarget,this.zoom=this.newZoom),this.newZoom=this.oldZoom=this.newTarget=this.newTarget=this.tweenProgress=null,this.updateZoom(!0)},h.prototype.updateZoom=function(e){var t,i,n;if((e=null==e?!1:e)||!this.locked&&(this.newTarget||this.focusedOnSprite())){if(this.newTarget)i=this.tweenProgress,this.zoom=this.oldZoom+i*(this.newZoom-this.oldZoom),t=[this.oldTarget,this.boundTarget(this.newTarget,this.newZoom)],n=this.target={x:(n=t[0]).x+i*((t=t[1]).x-n.x),y:n.y+i*(t.y-n.y)};else if(n=this.boundTarget(this.target,this.zoom),!e&&_.isEqual(n,this.currentTarget))return;return this.currentTarget=n,.1<this.updateViewports(n)?Backbone.Mediator.publish("camera:zoom-updated",{camera:this,zoom:this.zoom,surfaceViewport:this.surfaceViewport,minZoom:this.minZoom}):void 0}},h.prototype.boundTarget=function(e,t){var i,n;return this.bounds?(n=e.y,(i=null!=(i=e.sprite)?i.thang:void 0)&&(n=this.worldToSurface({x:i.pos.x,y:i.pos.y}).y),i=this.canvasWidth/t/2,t=this.canvasHeight/t/2,{x:Math.min(Math.max(i+this.bounds.x,e.x+this.offset.x),this.bounds.x+this.bounds.width-i),y:n=Math.min(Math.max(t+this.bounds.y,n+this.offset.y),this.bounds.y+this.bounds.height-t)}):e},h.prototype.updateViewports=function(e){var t,i;return null==e&&(e=this.target),(t={width:this.canvasWidth/this.zoom,height:this.canvasHeight/this.zoom,cx:e.x,cy:e.y}).x=t.cx-t.width/2,t.y=t.cy-t.height/2,i=this.surfaceViewport?Math.abs(this.surfaceViewport.x-t.x)+1.01*Math.abs(this.surfaceViewport.y-t.y)+1.02*Math.abs(this.surfaceViewport.width-t.width):9001,this.surfaceViewport=t,(e=this.surfaceToWorld(t)).width=t.width*h.MPP,e.height=t.height*h.MPP*this.x2y,e.cx=e.x+e.width/2,e.cy=e.y+e.height/2,this.worldViewport=e,i},h.prototype.lock=function(){return this.target=this.currentTarget,this.locked=!0},h.prototype.unlock=function(){return this.locked=!1},h.prototype.destroy=function(){return s.Tween.removeTweens(this),h.__super__.destroy.call(this)},h.prototype.onZoomTo=function(e){return this.zoomTo(this.worldToSurface(e.pos),this.zoom,e.duration)},h)},1412:function(e,t,i){var n,o={}.hasOwnProperty;function s(){return s.__super__.constructor.apply(this,arguments)}n=i(25),e.exports=(function(e,t){for(var i in t)o.call(t,i)&&(e[i]=t[i]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(s,n),s.className="Mandate",s.schema=i(1444),s.prototype.urlRoot="/db/mandate",s)},1414:function(e,t,i){var n,o={}.hasOwnProperty;function s(){return s.__super__.constructor.apply(this,arguments)}n=i(25),e.exports=(function(e,t){for(var i in t)o.call(t,i)&&(e[i]=t[i]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(s,n),s.className="UserCodeProblem",s.schema=i(1446),s.prototype.urlRoot="/db/user.code.problem",s)},1415:function(e,t,i){i(1373);i(1516),i(1485),i(643)},1420:function(t,e,y){!function(i){var l,d,e,r,o,n,s,m,a,c,h,u=function(e,t){return function(){return e.apply(t,arguments)}},p={}.hasOwnProperty,f=[].indexOf||function(e){for(var t=0,i=this.length;t<i;t++)if(t in this&&this[t]===e)return t;return-1};function g(e,t){this.thangType=e,null==t&&(t={}),this.move=u(this.move,this),this.rotateEffect=u(this.rotateEffect,this),this.playNextAction=u(this.playNextAction,this),g.__super__.constructor.call(this),e=this.thangType.get("name"),this.isMissile=/(Missile|Arrow|Spear|Bolt)/.test(e)&&!/(Tower|Charge)/.test(e),this.options=_.extend(i.extend(!0,{},this.options),t),this.gameUIState=this.options.gameUIState,this.handleEvents=this.options.handleEvents,this.isCinematicLank=this.options.isCinematic||!1,this.setThang(this.options.thang),this.setColorConfig(),this.thangType||console.error(this.toString(),"has no ThangType!"),this.sprite=new m.Container,this.actionQueue=[],this.marks={},this.labels={},this.ranges=[],this.handledDisplayEvents={},this.age=0,this.stillLoading=!0,this.thangType.isFullyLoaded()?this.onThangTypeLoaded():this.listenToOnce(this.thangType,"sync",this.onThangTypeLoaded)}e=y(45),s=y(1598).createProgressBar,d=y(1407),o=y(1495),r=y(1599),l=y(1390),c=y(44).me,n=y(1374),h=y(6),m=y(1373),a={ogres:[64,128,212],humans:[255,0,0],neutral:[64,212,128]},t.exports=(function(e,t){for(var i in t)p.call(t,i)&&(e[i]=t[i]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(g,e),g.prototype.thangType=null,g.prototype.sprite=null,g.prototype.healthBar=null,g.prototype.marks=null,g.prototype.labels=null,g.prototype.ranges=null,g.prototype.options={groundLayer:null,textLayer:null,floatingLayer:null,thang:null,camera:null,showInvisible:!1,preloadSounds:!0},g.prototype.possessed=!1,g.prototype.flipped=!1,g.prototype.flippedCount=0,g.prototype.actionQueue=null,g.prototype.actions=null,g.prototype.rotation=0,g.prototype.scaleFactorX=1,g.prototype.scaleFactorY=1,g.prototype.targetScaleFactorX=1,g.prototype.targetScaleFactorY=1,g.prototype.currentRootAction=null,g.prototype.currentAction=null,g.prototype.subscriptions={"level:sprite-dialogue":"onDialogue","level:sprite-clear-dialogue":"onClearDialogue","level:set-letterbox":"onSetLetterbox","surface:ticked":"onSurfaceTicked","sprite:move":"onMove"},g.prototype.toString=function(){var e;return"<Lank: "+(null!=(e=this.thang)?e.id:void 0)+">"},g.prototype.setColorConfig=function(){var e,t;if(e=null!=(t=this.thang)&&"function"==typeof t.getLankOptions?t.getLankOptions().colorConfig:void 0)return this.thangType.get("original")===n.heroes["code-ninja"]&&(t=c.levels(),0<=f.call(t,"5522b98685fca53105544b53")?e.belt={hue:.4,saturation:.75,lightness:.25}:0<=f.call(t,"56fc56ac7cd2381f00d758b4")?e.belt={hue:.067,saturation:.75,lightness:.5}:e.belt={hue:.167,saturation:.75,lightness:.4}),this.options.colorConfig=e},g.prototype.onThangTypeLoaded=function(){var e,t,i,n,o,s,r;if(this.stillLoading=!1,this.options.preloadSounds)for(r in i=this.thangType.get("soundTriggers")||{})if(s=i[r],"say"!==r)for(e=0,t=s.length;e<t;e++)(o=s[e])&&l.preloadSoundReference(o);if(this.thangType.get("raster")?(this.actions={},this.isRaster=!0):(this.actions=this.thangType.getActions(),this.createMarks()),null!=(null!=(n=this.thang)?n.scaleFactorX:void 0)&&(this.scaleFactorX=this.thang.scaleFactorX),null!=(null!=(n=this.thang)?n.scaleFactor:void 0)&&(this.scaleFactorX=this.thang.scaleFactor),null!=(null!=(n=this.thang)?n.scaleFactorY:void 0)&&(this.scaleFactorY=this.thang.scaleFactorY),null!=(null!=(n=this.thang)?n.scaleFactor:void 0)&&(this.scaleFactorY=this.thang.scaleFactor),!this.currentAction)return this.updateAction()},g.prototype.setSprite=function(e){var t,i,n,o;for(this.sprite&&(this.sprite.off("animationend",this.playNextAction),"function"==typeof(n=this.sprite).destroy&&n.destroy(),(n=this.sprite.parent)&&(n.removeChild(this.sprite),n.spriteSheet===e.spriteSheet&&n.addChild(e))),t=0,i=(o=["lastPos","currentRootAction"]).length;t<i;t++)delete this[o[t]];return this.sprite=e,this.thang&&!1===this.thang.stateChanged&&(this.thang.stateChanged=!0),this.configureMouse(),this.sprite.on("animationend",this.playNextAction),this.currentAction&&!this.stillLoading&&this.playAction(this.currentAction),this.trigger("new-sprite",this.sprite)},g.prototype.queueAction=function(e){var t,i,n;return null==(e=_.isString(e)?this.actions[e]:e)&&(e=this.actions.idle),this.actionQueue=[],null!=(i=this.currentRootAction)&&(null!=(n=i.relatedActions)&&n.end)&&this.actionQueue.push(this.currentRootAction.relatedActions.end),null!=(n=e.relatedActions)&&n.begin&&this.actionQueue.push(e.relatedActions.begin),this.actionQueue.push(e),e.goesTo&&(t=this.actions[e.goesTo])&&t&&this.actionQueue.push(t),this.currentRootAction=e,this.playNextAction()},g.prototype.onSurfaceTicked=function(e){return this.age+=e.dt},g.prototype.playNextAction=function(){if(!this.destroyed)return this.actionQueue.length?this.playAction(this.actionQueue.splice(0,1)[0]):void 0},g.prototype.playAction=function(e){var t,i;if(!this.isRaster)return(this.currentAction=e).animation||e.container||e.relatedActions||e.goesTo?(this.show(),e.animation||e.container||e.goesTo?this.sprite.placeholder?void 0:(i=e.container?"gotoAndStop":"gotoAndPlay","function"==typeof(t=this.sprite)[i]&&t[i](e.name),this.updateScale(),this.updateRotation()):this.updateActionDirection()):this.hide()},g.prototype.hide=function(){return this.hiding=!0,this.updateAlpha()},g.prototype.show=function(){return this.hiding=!1,this.updateAlpha()},g.prototype.stop=function(){var e,t,i;for(e in null!=(t=this.sprite)&&"function"==typeof t.stop&&t.stop(),i=this.marks)i[e].stop();return this.stopped=!0},g.prototype.play=function(){var e,t,i;for(e in null!=(t=this.sprite)&&"function"==typeof t.play&&t.play(),i=this.marks)i[e].play();return this.stopped=!1},g.prototype.update=function(e){var t;return!this.stillLoading&&(t=this.thang&&!1===this.thang.stateChanged,(e&&!t||this.thang&&this.thang.bobHeight||this.notOfThisWorld)&&this.updatePosition(),!t&&((e=e||this.targetScaleFactorX!==this.scaleFactorX||this.targetScaleFactorY!==this.scaleFactorY)&&(this.handledDisplayEvents={},this.updateScale(),this.updateAlpha(),this.updateRotation(),this.updateAction(),this.updateStats(),this.updateGold(),this.showAreaOfEffects(),this.showTextEvents(),this.updateHealthBar()),this.updateMarks(),this.updateLabels(),this.thang&&!0===this.thang.stateChanged&&(this.thang.stateChanged=!1),!0))},g.prototype.showAreaOfEffects=function(){var t,i,e,n,o,s,r,a,l,c,h,u,p;if(null!=(l=this.thang)&&l.currentEvents){for(u=[],e=0,r=(c=this.thang.currentEvents).length;e<r;e++)i=c[e],_.string.startsWith(i,"aoe-")&&(this.handledDisplayEvents[i]||(this.handledDisplayEvents[i]=!0,h=JSON.parse(i.slice(4)),n="aoe-"+JSON.stringify(h.slice(2)),s=null!=(p=h[6])?p:"ground",(o=this.options[s+"Layer"])||(console.error(this.thang.id+" couldn't find layer "+s+"Layer for AOE effect "+n+"; using ground layer."),o=this.options.groundLayer),f.call(o.spriteSheet.animations,n)<0&&(t=new m.Shape,a=h[2]*d.PPM,4===h.length?t.graphics.beginFill(h[3]).drawCircle(0,0,a):((p=h[4]||0)===(s=h[5]||2*Math.PI)&&(p=0,s=2*Math.PI),t.graphics.beginFill(h[3]).lineTo(0,0).lineTo(a*Math.cos(p),a*Math.sin(p)).arc(0,0,a,p,s).lineTo(0,0)),o.addCustomGraphic(n,t,[-a,-a,2*a,2*a])),(t=new m.Sprite(o.spriteSheet)).gotoAndStop(n),h=this.options.camera.worldToSurface({x:h[0],y:h[1]}),t.x=h.x,t.y=h.y,h=o.resolutionFactor,t.scaleY=.7*this.options.camera.y2x/h,t.scaleX=.7/h,t.alpha=.2,o.addChild(t),u.push(m.Tween.get(t).to({alpha:.6,scaleY:this.options.camera.y2x/h,scaleX:1/h},100,m.Ease.circOut).to({alpha:0,scaleY:0,scaleX:0},700,m.Ease.circIn).call(function(e){return function(){if(!e.destroyed)return o.removeChild(t),delete e.handledDisplayEvents[i]}}(this)))));return u}},g.prototype.showTextEvents=function(){var e,t,i,n,o,s,r;if(null!=(n=this.thang)&&n.currentEvents){for(s=[],e=0,i=(o=this.thang.currentEvents).length;e<i;e++)r=o[e],_.string.startsWith(r,"text-")&&(this.handledDisplayEvents[r]||(this.handledDisplayEvents[r]=!0,r=JSON.parse(r.slice(5)),t=new m.Text(r.text,"bold "+(r.size||16)+"px Arial",r.color||"#FFF"),r=null!=(r={humans:"#F00",ogres:"#00F",neutral:"#0F0",common:"#0F0"}[this.thang.team])?r:"#000",t.shadow=new m.Shadow(r,1,1,3),r=this.getOffset("aboveHead"),r=[this.sprite.x+r.x-t.getMeasuredWidth()/2,this.sprite.y+r.y],t.x=r[0],t.y=r[1],this.options.textLayer.addChild(t),null==window.labels&&(window.labels=[]),window.labels.push(t),t.alpha=0,s.push(m.Tween.get(t).to({y:t.y-2,alpha:1},200,m.Ease.linear).to({y:t.y-12},1e3,m.Ease.linear).to({y:t.y-22,alpha:0},1e3,m.Ease.linear).call(function(e){return function(){if(!e.destroyed)return e.options.textLayer.removeChild(t)}}(this)))));return s}},g.prototype.getBobOffset=function(){return this.thang.bobHeight?this.stopped?this.lastBobOffset:this.lastBobOffset=this.thang.bobHeight*(1+Math.sin(this.age*Math.PI/this.thang.bobTime)):0},g.prototype.getWorldPosition=function(){var e,t=(this.possessed?this.shadow:this.thang).pos;return(e=this.getBobOffset())&&((t=("function"==typeof t.copy?t.copy():void 0)||_.clone(t)).z+=e),{x:t.x,y:t.y,z:this.thang.isLand?0:t.z-this.thang.depth/2}},g.prototype.updatePosition=function(e){if(null==e&&(e=!1),(!this.stillLoading||e)&&null!=(i=this.thang)&&i.pos&&null!=this.options.camera){var t,i=(n=[this.lastPos,this.thang.pos])[0],n=n[1];if(!i||i.x!==n.x||i.y!==n.y||i.z!==n.z||this.thang.bobHeight)return i=this.getWorldPosition(),i=[(i=this.options.camera.worldToSurface(i)).x,i.y],this.sprite.x=i[0],this.sprite.y=i[1],e||(this.lastPos=("function"==typeof n.copy?n.copy():void 0)||_.clone(n)),this.hasMoved=!0,"Flag"!==this.thangType.get("name")||this.notOfThisWorld?void 0:_.defer((t=this,function(){return Backbone.Mediator.publish("surface:flag-appeared",{sprite:t})}))}},g.prototype.updateScale=function(e){var t,i,n,o,s,r;if(this.sprite){if(!(this.thangType.get("matchWorldDimensions")&&this.thang&&this.options.camera))return r=1,this.isMissile&&(r=.5+.5*(90-(t=90<(t=(t=this.getRotation())<0?-t:t)?180-t:t))/90),this.sprite.scaleX=this.sprite.baseScaleX*this.scaleFactorX*r,this.sprite.scaleY=this.sprite.baseScaleY*this.scaleFactorY*1,s=null!=(r=null!=(r=null!=(r=this.thang)?r.scaleFactorX:void 0)?r:null!=(s=this.thang)?s.scaleFactor:void 0)?r:1,i=null!=(r=null!=(r=null!=(r=this.thang)?r.scaleFactorY:void 0)?r:null!=(i=this.thang)?i.scaleFactor:void 0)?r:1,"Land"===(null!=(r=this.layer)?r.name:void 0)||null!=(n=this.thang)&&n.isLand||"Beam"===(null!=(n=this.thang)?n.spriteName:void 0)||this.isCinematicLank?(this.scaleFactorX=s,this.scaleFactorY=i):!this.thang||s===this.targetScaleFactorX&&i===this.targetScaleFactorY?void 0:(this.targetScaleFactorX=s,this.targetScaleFactorY=i,m.Tween.removeTweens(this),m.Tween.get(this).to({scaleFactorX:this.targetScaleFactorX,scaleFactorY:this.targetScaleFactorY},2e3,m.Ease.elasticOut));if(e||this.thang.width!==this.lastThangWidth||this.thang.height!==this.lastThangHeight||this.thang.rotation!==this.lastThangRotation){if(!(e=this.sprite.getBounds()))return;this.sprite.scaleX=this.thang.width*d.PPM/e.width*(this.options.camera.y2x+(1-this.options.camera.y2x)*Math.abs(Math.cos(this.thang.rotation))),this.sprite.scaleY=this.thang.height*d.PPM/e.height*(this.options.camera.y2x+(1-this.options.camera.y2x)*Math.abs(Math.sin(this.thang.rotation))),this.sprite.regX=3*e.width/4,this.sprite.regY=3*e.height/4,"Beam"!==this.thang.spriteName&&(this.sprite.scaleX*=null!=(o=this.thangType.get("scale"))?o:1,this.sprite.scaleY*=null!=(o=this.thangType.get("scale"))?o:1),o=[this.thang.width,this.thang.height,this.thang.rotation],this.lastThangWidth=o[0],this.lastThangHeight=o[1],this.lastThangRotation=o[2]}}},g.prototype.updateAlpha=function(){var e,t,i;if(this.sprite.alpha=this.hiding?0:1,null!=(null!=(i=this.thang)?i.alpha:void 0)&&this.sprite.alpha!==this.thang.alpha){for(e in this.sprite.alpha=this.thang.alpha,this.options.showInvisible&&(this.sprite.alpha=Math.max(.5,this.sprite.alpha)),t=this.marks)t[e].updateAlpha(this.thang.alpha);return null!=(i=this.healthBar)?i.alpha=this.thang.alpha:void 0}},g.prototype.updateRotation=function(e){var t,i,n,o,s=this.thangType.get("rotationType");if("fixed"!==s)return i=this.getRotation(),this.isMissile&&this.thang.velocity&&(o=this.thang.velocity.z)&&this.thang.velocity.magnitude(!0)&&(n=this.thang.velocity.x,t=this.thang.velocity.heading(),i-=Math.cos(t)*(o/Math.sqrt(o*o+n*n))*45),null==e&&(e=this.sprite),"free"!==s&&s?this.updateIsometricRotation(i,e):e.rotation=i},g.prototype.getRotation=function(){var e=this.possessed?this.shadow:this.thang;return null!=e&&e.rotation?(180<(e=(360-180*(e=null!=e?e.rotation:void 0)/Math.PI%360)%360)&&(e-=360),e):this.rotation},g.prototype.updateIsometricRotation=function(e,t){if(this.currentAction&&!_.string.endsWith(this.currentAction.name,"back")&&!_.string.endsWith(this.currentAction.name,"fore"))return 90<=Math.abs(e)?t.scaleX*=-1:void 0},g.prototype.updateAction=function(){var e,t,i;if(!this.isRaster&&!this.actionLocked)return i=(e=this.determineAction())!==this.currentRootAction||null===e,e||null==(t=this.thang)||!t.actionActivated||this.stopLogging||(console.error("action is",e,"for",null!=(t=this.thang)?t.id:void 0,"from",this.currentRootAction,this.thang.action,"function"==typeof(t=this.thang).getActionName?t.getActionName():void 0),this.stopLogging=!0),e&&(i||null!=(i=this.thang)&&i.actionActivated&&"move"!==e.name)&&this.queueAction(e),this.updateActionDirection()},g.prototype.determineAction=function(){var e=null,t=this.possessed?this.shadow:this.thang;return null!=t&&t.acts&&(e=t.action),null!=this.currentRootAction&&null==e&&(e=this.currentRootAction.name),null==this.actions[e=null==e?"idle":e]?(null==this.warnedFor&&(this.warnedFor={}),this.warnedFor[e]||console.warn("Cannot show action",e,"for",this.thangType.get("name"),"because it DNE"),this.warnedFor[e]=!0,"idle"===this.action?null:"idle"):(null!=this.actions.die&&null!=(null!=t?t.health:void 0)&&t.health<=0&&(e="die"),this.actions[e])},g.prototype.updateActionDirection=function(e){if(this.wallGrid=null!=e?e:null,e=this.getActionDirection())return e!==this.currentAction?this.playAction(e):void 0},g.prototype.lockAction=function(){return this.actionLocked=!0},g.prototype.getActionDirection=function(e){var t,i,n,o,s,r,a,l,c,h,u,p,d,m,f,g,y;if(!(d=null!=(c=null!=(e=null==(e=null==e?null:e)?this.currentRootAction:e)?e.relatedActions:void 0)?c:{}))return null;if(e=this.getRotation(),d[111111111111]){if(this.wallGrid){for(this.hadWallGrid=!0,t="",i=(c=[this.thang.pos.x,this.thang.pos.y])[0],o=0,r=(h=[(n=c[1])+4,n,n-4,n-8]).length;o<r;o++)for(y=h[o],s=0,a=(u=[i-4,i,i+4]).length;s<a;s++)0===(f=0<=(g=u[s])&&0<=y&&g<this.wallGrid.width&&y<this.wallGrid.height?this.wallGrid.contents(g,y):["outside of the map yo"]).length?t+=y===n&&g===i?"1":"0":(1===f.length||console.error("Overlapping walls at",g,y,"...",f),t+="1");for(p in l="111111111111",d)if(t.match(p.replace(/\?/g,"."))){l=p;break}return d[l]}return this.hadWallGrid?null:d[(m=_.keys(d))[Math.max(0,Math.floor((179+e)/360*m.length))]]}return m=(m=Math.abs(e))<=45||135<=m?"side":null,e<135&&45<e&&(m="fore"),d[m=-135<e&&e<-45?"back":m]},g.prototype.updateStats=function(){var e,t;if(this.thang&&this.thang.health!==this.lastHealth)return this.lastHealth=this.thang.health,(e=this.healthBar)&&(t=Math.max(this.thang.health/this.thang.maxHealth,0),e.scaleX=t/this.options.floatingLayer.resolutionFactor),this.thang.showsName?this.setNameLabel(this.thang.health<=0?"":this.thang.id):this.options.playerName?this.setNameLabel(this.options.playerName):void 0},g.prototype.configureMouse=function(){var e;if(null!=(e=this.thang)&&e.isSelectable&&(this.sprite.cursor="pointer"),null!=(e=this.thang)&&e.isSelectable||null!=(e=this.thang)&&e.isLand||(this.sprite.mouseEnabled=this.sprite.mouseChildren=!1),this.sprite.mouseEnabled)return this.sprite.on("mousedown",this.onMouseEvent,this,!1,"sprite:mouse-down"),this.sprite.on("click",this.onMouseEvent,this,!1,"sprite:clicked"),this.sprite.on("dblclick",this.onMouseEvent,this,!1,"sprite:double-clicked"),this.sprite.on("pressmove",this.onMouseEvent,this,!1,"sprite:dragged"),this.sprite.on("pressup",this.onMouseEvent,this,!1,"sprite:mouse-up")},g.prototype.onMouseEvent=function(e,t){var i;if(!this.letterboxOn&&this.sprite){for(i=this.sprite;i.parent;)i=i.parent;return e={sprite:this,thang:this.thang,originalEvent:e,canvas:i.canvas},this.trigger(t,e),Backbone.Mediator.publish(t,e),this.gameUIState.trigger(t,e)}},g.prototype.addHealthBar=function(){var e,t,i,n;if(null!=(null!=(t=this.thang)?t.health:void 0)&&0<=f.call(null!=(n=null!=(i=this.thang)?i.hudProperties:void 0)?n:[],"health")&&this.options.floatingLayer)return n=(null!=(i=this.thang)?i.team:void 0)||"neutral",f.call(this.options.floatingLayer.spriteSheet.animations,i=n+"-health-bar")<0&&(e=s(a[n]),this.options.floatingLayer.addCustomGraphic(i,e,e.bounds)),e=this.healthBar,this.healthBar=new m.Sprite(this.options.floatingLayer.spriteSheet),this.healthBar.gotoAndStop(i),this.getOffset("aboveHead"),this.healthBar.scaleX=this.healthBar.scaleY=1/this.options.floatingLayer.resolutionFactor,this.healthBar.name="health bar",this.options.floatingLayer.addChild(this.healthBar),this.updateHealthBar(),this.lastHealth=null,e?void 0:this.listenTo(this.options.floatingLayer,"new-spritesheet",this.addHealthBar)},g.prototype.getActionProp=function(e,t,i){var n,o,s,r,a;for(null==i&&(i=null),n=0,o=(r=[null!=(s=this.currentAction)?s[e]:void 0,this.thangType.get(e)]).length;n<o;n++)if(null!=(a=null!=(a=r[n])&&t?a[t]:a))return a;return i},g.prototype.getOffset=function(e){var t,i=this.getActionProp("positions",e,{x:0,y:{registration:0,torso:-50,mouth:-60,aboveHead:-100}[e]});return i={x:i.x,y:i.y},this.isRaster||(t=this.getActionProp("scale",null,1),"registration"===e&&(t*=this.sprite.parent.resolutionFactor),i.x*=t,i.y*=t),this.thang&&"registration"!==e&&(i.x*=null!=(e=null!=(e=this.thang.scaleFactorX)?e:this.thang.scaleFactor)?e:1,i.y*=null!=(e=null!=(e=this.thang.scaleFactorY)?e:this.thang.scaleFactor)?e:1),i},g.prototype.createMarks=function(){if(this.options.camera)return this.thang&&0!==this.thangType.get("shadow")?this.addMark("shadow").toggle(!0):void 0},g.prototype.updateMarks=function(){var e,t,i,n,o,s,r,a,l,c,h,u;if(this.options.camera){if(null!=(r=this.thang)&&r.erroredOut&&this.addMark("repair",null,"repair"),null!=(r=this.marks.repair)&&r.toggle(null!=(r=this.thang)?r.erroredOut:void 0),this.selected)for(e=0,i=(a=this.ranges).length;e<i;e++)s=a[e],this.marks[s.name].toggle(!0);else for(t=0,n=(l=this.ranges).length;t<n;t++)s=l[t],this.marks[s.name].toggle(!1);for(o in this.isMissile&&"die"===this.thang.action&&null!=(h=this.marks.shadow)&&h.hide(),c=this.marks)c[o].update();return null!=(h=this.thang)&&(null!=(u=h.effectNames)&&u.length)||null!=(u=this.previousEffectNames)&&u.length?this.updateEffectMarks():void 0}},g.prototype.updateEffectMarks=function(){var e,t,i,n,o,s,r,a,l;if(!_.isEqual(this.thang.effectNames,this.previousEffectNames)&&!this.stopped){for(null==(e=this.thang).effectNames&&(e.effectNames=[]),i=0,o=(a=this.thang.effectNames).length;i<o;i++)t=a[i],(r=this.addMark(t,this.options.floatingLayer,t)).statusEffect=!0,r.toggle("on"),r.show();if(this.previousEffectNames)for(n=0,s=(l=this.previousEffectNames).length;n<s;n++)t=l[n],0<=f.call(this.thang.effectNames,t)||(r=this.marks[t]).toggle(!1);return 1<this.thang.effectNames.length&&!this.effectInterval?(this.rotateEffect(),this.effectInterval=setInterval(this.rotateEffect,1500)):this.effectInterval&&this.thang.effectNames.length<=1&&(clearInterval(this.effectInterval),this.effectInterval=null),this.previousEffectNames=this.thang.effectNames}},g.prototype.rotateEffect=function(){var e,t,i,o,n=function(){for(var e=_.values(this.marks),t=[],i=0,n=e.length;i<n;i++)(o=e[i]).on&&o.statusEffect&&o.mark&&t.push(o.name);return t}.call(this);if(n.length){for(n.sort(),null==this.effectIndex&&(this.effectIndex=0),this.effectIndex=(this.effectIndex+1)%n.length,t=0,i=n.length;t<i;t++)e=n[t],this.marks[e].hide();return this.marks[n[this.effectIndex]].show()}},g.prototype.setHighlight=function(e,t){var i;return e&&this.addMark("highlight",this.options.floatingLayer,"highlight"),null!=(i=this.marks.highlight)&&(i.highlightDelay=t),null!=(t=this.marks.highlight)?t.toggle(e&&!this.dimmed):void 0},g.prototype.setDimmed=function(e){return this.dimmed=e,null!=(e=this.marks.highlight)?e.toggle(this.marks.highlight.on&&!this.dimmed):void 0},g.prototype.setThang=function(e){return this.thang=e,this.options.thang=this.thang},g.prototype.setDebug=function(e){var t;if(null!=(t=this.thang)&&t.collides&&null!=this.options.camera)return e&&this.addMark("debug",this.options.floatingLayer),(t=this.marks.debug)?(t.toggle(e),t.updatePosition()):void 0},g.prototype.addLabel=function(e,t,i){var n;return null==i&&(i={}),null==(n=this.labels)[e]&&(n[e]=new r({sprite:this,camera:this.options.camera,layer:this.options.textLayer,style:t,labelOptions:i})),this.labels[e]},g.prototype.addMark=function(e,t,i){var n;return null==i&&(i=null),null==(n=this.marks)[e]&&(n[e]=new o({name:e,lank:this,camera:this.options.camera,layer:null!=t?t:this.options.groundLayer,thangType:i})),this.marks[e]},g.prototype.removeMark=function(e){return this.marks[e].destroy(),delete this.marks[e]},g.prototype.notifySpeechUpdated=function(e){return(e=_.clone(e)).sprite=this,null==e.blurb&&(e.blurb="..."),e.thang=this.thang,Backbone.Mediator.publish("sprite:speech-updated",e)},g.prototype.isTalking=function(){var e;return Boolean((null!=(e=this.labels.dialogue)?e.text:void 0)||(null!=(e=this.labels.say)?e.text:void 0))},g.prototype.onDialogue=function(e){var t,i;if((null!=(t=this.thang)?t.id:void 0)===e.spriteID)return"Hero Placeholder"!==(null!=(i=this.thang)?i.id:void 0)&&this.addLabel("dialogue",r.STYLE_DIALOGUE).setText(e.blurb||"..."),i=null!=(t=e.sound)?t:l.soundForDialogue(e.message,this.thangType.get("soundTriggers")),null!=(t=this.dialogueSoundInstance)&&t.stop(),(this.dialogueSoundInstance=this.playSound(i,!1))&&this.dialogueSoundInstance.addEventListener("complete",function(){return Backbone.Mediator.publish("sprite:dialogue-sound-completed",{})}),this.notifySpeechUpdated(e)},g.prototype.onClearDialogue=function(e){var t;if(null!=(t=this.labels.dialogue)&&t.text)return null!=(t=this.labels.dialogue)&&t.setText(null),null!=(t=this.dialogueSoundInstance)&&t.stop(),this.notifySpeechUpdated({})},g.prototype.onSetLetterbox=function(e){return this.letterboxOn=e.on},g.prototype.setNameLabel=function(e){return this.addLabel("name",r.STYLE_NAME).setText(e)},g.prototype.updateLabels=function(){var e,t,i,n,o,s;if(this.thang){for(t in"For Thoktar!"!==(n=null!=this.thang.health&&this.thang.health<=0?null:this.thang.sayMessage)&&"Bones!"!==n&&"Behead!"!==n&&"Destroy!"!==n&&"Die, humans!"!==n||(n=null),i=/Hero Placeholder/.test(this.thang.id)?r.STYLE_DIALOGUE:null!=(i=this.thang.labelStyle)?i:r.STYLE_SAY,n&&this.addLabel("say",i,this.thang.sayLabelOptions),null!=(i=this.labels.say)&&i.setText(n)&&this.notifySpeechUpdated({blurb:n}),null!=(null!=(n=this.thang)?n.variableNames:void 0)?this.addLabel("variableNames",r.STYLE_VAR).setText(null!=(n=this.thang)?n.variableNames:void 0):this.labels.variableNames&&(this.labels.variableNames.destroy(),delete this.labels.variableNames),s=[],o=this.labels)e=o[t],s.push(e.update());return s}},g.prototype.updateGold=function(){var e;if(this.thang&&this.thang.gold!==this.lastGold&&(e=Math.floor(null!=(e=this.thang.gold)?e:0),(e=0===this.thang.world.age?this.thang.world.initialTeamGold[this.thang.team].gold:e)!==this.lastGold))return this.lastGold=e,Backbone.Mediator.publish("surface:gold-changed",{team:this.thang.team,gold:e,goldEarned:Math.floor(null!=(e=this.thang.goldEarned)?e:0)})},g.prototype.shouldMuteMessage=function(e){var t,i;return"moveRight"!==e&&"moveUp"!==e&&"moveDown"!==e&&"moveLeft"!==e&&(null==this.previouslySaidMessages&&(this.previouslySaidMessages={}),t=null!=(i=this.previouslySaidMessages[e])?i:0,i=new Date,(this.previouslySaidMessages[e]=i)-t<5e3)},g.prototype.playSounds=function(e,t){var i,n,o,s,r,a;for(null==e&&(e=!0),null==t&&(t=1),n=0,o=(r=null!=(s=this.thang.currentEvents)?s:[]).length;n<o;n++)i=r[n],this.playSound(i,e,t),"pay-bounty-gold"===i&&25<this.thang.bountyGold&&this.thang.team!==c.team&&l.playInterfaceSound("coin_1",.25);if(this.thang.actionActivated&&"say"!==(a=this.thang.getActionName())&&this.playSound(a,e,t),this.thang.sayMessage&&e&&!this.thang.silent&&!this.shouldMuteMessage(this.thang.sayMessage)&&Math.abs(this.thang.sayStartTime-this.thang.world.age)/this.thang.world.dt<=2)return a=l.soundForDialogue(this.thang.sayMessage,this.thangType.get("soundTriggers")),this.playSound(a,!1,t)},g.prototype.playSound=function(e,t,i){var n,o;return null==t&&(t=!0),null==i&&(i=1),_.isString(e)&&(e=(null!=(o=h.i18n(this.thangType.attributes,"soundTriggers"))?o[e]:void 0)||(null!=(n=this.thangType.get("soundTriggers"))?n[e]:void 0)),(e=_.isArray(e)?e[Math.floor(Math.random()*e.length)]:e)?(n=t&&e.delay?1e3*e.delay/m.Ticker.framerate:0,t=l.nameForSoundReference(e),l.preloadSoundReference(e),l.playSound(t,i,n,this.getWorldPosition())):null},g.prototype.onMove=function(e){var t,i,n,o;if(e.spriteID===(null!=(n=this.thang)?n.id:void 0)){if(i=e.pos,_.isArray(i))i=function(e,t,i){i.prototype=e.prototype;i=new i,t=e.apply(i,t);return Object(t)===t?t:i}(Vector,i,function(){});else if(_.isString(i)){if(!(i in this.options.sprites))return console.warn("Couldn't find target sprite",i,"from",this.options.sprites);o=this.options.sprites[i].thang,t=Vector.subtract(o.pos,this.thang.pos).normalize(),n=this.thang.pos.distance(o.pos),o=Math.max(o.width,o.height,2)/2+3,i=Vector.add(this.thang.pos,t.multiply(n-o))}return Backbone.Mediator.publish("level:sprite-clear-dialogue",{}),this.onClearDialogue(),i=[i],null!=e.duration&&i.push(e.duration),this.move.apply(this,i)}},g.prototype.move=function(e,t,i){var n,o,s;return null==t&&(t=2e3),null==i&&(i="idle"),this.updateShadow(),t?(this.shadow.action="move",this.shadow.actionActivated=!0,this.pointToward(e),this.possessed=!0,this.update(!0),n=m.Ease.getPowInOut(2.2),this.lastTween&&(n=m.Ease.getPowOut(1.2),m.Tween.removeTweens(this.shadow.pos)),o=function(){return s.lastTween=null,s.stillLoading||s.sprite.gotoAndPlay(i),s.shadow.action="idle",s.update(!0),s.possessed=!1},(s=this).lastTween=m.Tween.get(this.shadow.pos).to({x:e.x,y:e.y},t,n).call(o)):(this.lastTween&&m.Tween.removeTweens(this.shadow.pos),this.lastTween=null,o=this.shadow.pos.z,this.shadow.pos=e,this.shadow.pos.z=o,void("function"==typeof(o=this.sprite).gotoAndPlay&&o.gotoAndPlay(i)))},g.prototype.pointToward=function(e){if(this.shadow.rotation=Math.atan2(e.y-this.shadow.pos.y,e.x-this.shadow.pos.x),180*this.shadow.rotation/Math.PI%90==0)return this.shadow.rotation+=.01},g.prototype.updateShadow=function(){return this.shadow||(this.shadow={}),this.shadow.pos=this.thang.pos,this.shadow.rotation=this.thang.rotation,this.shadow.action=this.thang.action,this.shadow.actionActivated=this.thang.actionActivated},g.prototype.updateHealthBar=function(){var e,t;if(this.healthBar)return e=this.healthBar.getBounds(),t=this.getOffset("aboveHead"),this.healthBar.x=this.sprite.x-(-t.x+e.width/2/this.options.floatingLayer.resolutionFactor),this.healthBar.y=this.sprite.y-(-t.y+e.height/2/this.options.floatingLayer.resolutionFactor)},g.prototype.destroy=function(){var e,t,i,n=this.marks;for(e in n)n[e].destroy();for(e in t=this.labels)t[e].destroy();return(i=null!=(i=this.healthBar)?i.parent:void 0)&&i.removeChild(this.healthBar),null!=(i=this.sprite)&&i.off("animationend",this.playNextAction),null!=(i=this.sprite)&&"function"==typeof i.destroy&&i.destroy(),this.effectInterval&&clearInterval(this.effectInterval),null!=(i=this.dialogueSoundInstance)&&i.removeAllEventListeners(),g.__super__.destroy.call(this)},g)}.call(this,y(3))},1421:function(e,t){e.exports={projectGallery:function(e){return"/students/project-gallery/"+e.courseInstanceID},playDevLevel:function(e){var t=e.level,i=e.session,e=e.course;return t=t.attributes||t,i=i.attributes||i,e=(null!=e?e.attributes:void 0)||e,i=window.location.origin+"/play/"+t.type+"-level/"+t.slug+"/"+i._id,e&&(i+="?course="+e._id),i},courseArenaLadder:function(e){var t=e.level,e=e.courseInstance;return t=t.attributes||t,e=e.attributes||e,"/play/ladder/"+t.slug+"/course/"+e._id},courseLevel:function(e){var t=e.level,e=e.courseInstance,e="/play/level/"+t.get("slug")+"?course="+e.get("courseID")+"&course-instance="+e.id;return t.get("primerLanguage")&&(e+="&codeLanguage="+t.get("primerLanguage")),e},courseWorldMap:function(e){var t=e.course,e=e.courseInstance;return t=t.attributes||t,e=e.attributes||e,"/play/"+t.campaignID+"?course-instance="+e._id},courseProjectGallery:function(e){return"/students/project-gallery/"+e.courseInstance.id}}},1430:function(module,exports){var loadAetherLanguage,loadEsper,loadScript,loadScript=function(e,t){var i=document.createElement("script");return i.src=e,t&&i.addEventListener("load",t,!1),document.head.appendChild(i)},loadEsper=function(){return new Promise(function(accept,reject){var e;if(window.esper)return accept();try{return eval("'use strict'; let test = WeakMap && (class Test { *gen(a=7) { yield yield * () => true ; } });"),loadScript("/javascripts/esper.modern.js",accept)}catch(error){return e=error,loadScript("/javascripts/esper.js",accept)}})},loadAetherLanguage=function(language){return new Promise(function(accept,reject){return loadEsper().then(function(){var e;if("javascript"===language)return accept();if("python"!==language&&"coffeescript"!==language&&"lua"!==language&&"java"!==language&&"cpp"!==language)return reject(new Error("Can't load language '"+language+"'"));try{return eval("'use strict'; let test = WeakMap && (class Test { *gen(a=7) { yield yield * () => true ; } });"),loadScript("/javascripts/app/vendor/aether-"+language+".modern.js",accept)}catch(error){return e=error,loadScript("/javascripts/app/vendor/aether-"+language+".js",accept)}})})};module.exports=loadAetherLanguage},1431:function(t,e,n){!function(s){var e,r,a,ce,l,he,i,o={}.hasOwnProperty,c=[].slice,ue=[].indexOf||function(e){for(var t=0,i=this.length;t<i;t++)if(t in this&&this[t]===e)return t;return-1};function h(e){var t;h.__super__.constructor.call(this),this.name=null!=(t=(e=null==e?{}:e).name)?t:"Unnamed",this.defaultSpriteType="Default"===this.name?"segmented":"singular",this.customGraphics={},this.layerPriority=null!=(t=e.layerPriority)?t:0,this.transformStyle=null!=(t=e.transform)?t:h.TRANSFORM_SURFACE,this.camera=e.camera,this.updateLayerOrder=_.throttle(this.updateLayerOrder,1e3/30),this.webGL=!!e.webGL,this.webGL?(this.initializing=!0,this.spriteSheet=this._renderNewSpriteSheet(!1),this.container=new he.Container(this.spriteSheet),this.actionRenderState={},this.toRenderBundles=[],this.lanks=[],this.initializing=!1):this.container=new he.Container}ce=n(1393),e=n(45),r=n(1549),a=n(1550),l=n(1374),he=n(1373),i=n(6),t.exports=(function(e,t){for(var i in t)o.call(t,i)&&(e[i]=t[i]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(h,e),h.TRANSFORM_SURFACE="surface",h.TRANSFORM_SURFACE_TEXT="surface_text",h.TRANSFORM_SCREEN="screen",h.prototype.actionRenderState=null,h.prototype.needToRerender=!1,h.prototype.toRenderBundles=null,h.prototype.willRender=!1,h.prototype.buildAutomatically=!0,h.prototype.buildAsync=!0,h.prototype.resolutionFactor=SPRITE_RESOLUTION_FACTOR,h.prototype.numThingsLoading=0,h.prototype.lanks=null,h.prototype.spriteSheet=null,h.prototype.container=null,h.prototype.customGraphics=null,h.prototype.subscriptions={"camera:zoom-updated":"onZoomUpdated"},h.prototype.toString=function(){return"<Layer "+this.layerPriority+": "+this.name+">"},h.prototype.updateLayerOrder=function(){if(!this.destroyed)return this.container.sortChildren(this.layerOrderComparator)},h.prototype.layerOrderComparator=function(e,t){var i,n,o,s,r=e.layerPriority||0,a=t.layerPriority||0;return r!==a?r-a:(r=e.z||1e3,a=t.z||1e3,(e=e.lank)&&(n=e.thang)&&(i=n.pos,n.health<0&&n.pos.z<=n.depth/2&&--r),(t=t.lank)&&(s=t.thang)&&(o=s.pos,s.health<0&&s.pos.z<=s.depth/2&&--a),r===a?i&&o?o.y-i.y||o.x-i.x:0:r-a)},h.prototype.onZoomUpdated=function(e){var t,i,n,o,s,r,a;if(e.camera===this.camera&&((s=this.transformStyle)===h.TRANSFORM_SURFACE||s===h.TRANSFORM_SURFACE_TEXT)&&(t=this.container.scaleX/e.zoom,this.container.scaleX=this.container.scaleY=e.zoom,this.webGL&&(this.container.scaleX*=this.camera.canvasScaleFactorX,this.container.scaleY*=this.camera.canvasScaleFactorY),this.container.regX=e.surfaceViewport.x,this.container.regY=e.surfaceViewport.y,this.transformStyle===h.TRANSFORM_SURFACE_TEXT)){for(a=[],n=0,o=(r=this.container.children).length;n<o;n++)(i=r[n]).skipScaling||(i.scaleX*=t,a.push(i.scaleY*=t));return a}},h.prototype.addChild=function(){var e,t,i,n,o,s=1<=arguments.length?c.call(arguments,0):[];if((n=this.container).addChild.apply(n,s),this.transformStyle===h.TRANSFORM_SURFACE_TEXT){for(o=[],t=0,i=s.length;t<i;t++)(e=s[t]).skipScaling||(e.scaleX/=this.container.scaleX,o.push(e.scaleY/=this.container.scaleY));return o}},h.prototype.removeChild=function(){var e,t,i,n,o,s=1<=arguments.length?c.call(arguments,0):[];if((n=this.container).removeChild.apply(n,s),this.transformStyle===h.TRANSFORM_SURFACE_TEXT){for(o=[],t=0,i=s.length;t<i;t++)(e=s[t]).scaleX*=this.container.scaleX,o.push(e.scaleY*=this.container.scaleY);return o}},h.prototype.addLank=function(e){var t;return e.options.resolutionFactor=this.resolutionFactor,(e.layer=this).listenTo(e,"action-needs-render",this.onActionNeedsRender),this.lanks.push(e),i.getQueryVariable("jitSpritesheets")||e.thangType.initPrerenderedSpriteSheets(),null!=(t=e.thangType.getPrerenderedSpriteSheet(e.options.colorConfig,this.defaultSpriteType))&&t.markToLoad(),this.loadThangType(e.thangType),this.addDefaultActionsToRender(e),this.setSpriteToLank(e),this.updateLayerOrder(),e.addHealthBar()},h.prototype.removeLank=function(e){return this.stopListening(e),e.layer=null,this.container.removeChild(e.sprite),this.lanks=_.without(this.lanks,e)},h.prototype.loadThangType=function(e){var t;return e.isFullyLoaded()?e.get("raster")&&!e.loadedRaster?(e.loadRasterImage(),this.listenToOnce(e,"raster-image-loaded",this.somethingLoaded),this.numThingsLoading++):(t=e.getPrerenderedSpriteSheetToLoad())&&t.loadImage()?(this.listenToOnce(t,"image-loaded",function(){return this.somethingLoaded(e)}),this.numThingsLoading++):void 0:(e.setProjection(null),e.loading||e.fetch(),this.numThingsLoading++,this.listenToOnce(e,"sync",this.somethingLoaded))},h.prototype.somethingLoaded=function(e){var t,i,n,o;for(this.numThingsLoading--,this.loadThangType(e),t=0,n=(o=this.lanks).length;t<n;t++)(i=o[t]).thangType===e&&this.addDefaultActionsToRender(i);return this.renderNewSpriteSheet()},h.prototype.onActionNeedsRender=function(e,t){return this.upsertActionToRender(e.thangType,t.name,e.options.colorConfig)},h.prototype.addDefaultActionsToRender=function(e){var t,i,n,o,s;if(e.thangType.get("raster"))return this.upsertActionToRender(e.thangType);for(s=[],i=0,n=(o=_.values(e.thangType.getActions())).length;i<n;i++)t=o[i],_.any(l.defaultActions,function(e){return _.string.startsWith(t.name,e)})&&s.push(this.upsertActionToRender(e.thangType,t.name,e.options.colorConfig));return s},h.prototype.upsertActionToRender=function(e,t,i){var n,o=this.renderGroupingKey(e,t,i);return void 0===this.actionRenderState[o]&&(this.actionRenderState[o]="need-to-render",this.toRenderBundles.push({thangType:e,actionName:t,colorConfig:i}),this.willRender||!this.buildAutomatically||(this.willRender=_.defer((n=this,function(){return n.renderNewSpriteSheet()}))),!0)},h.prototype.addCustomGraphic=function(e,t,i){return!this.customGraphics[e]&&(this.customGraphics[e]={graphic:t,bounds:function(e,t,i){i.prototype=e.prototype;i=new i,t=e.apply(i,t);return Object(t)===t?t:i}(he.Rectangle,i,function(){})},!(!this.willRender&&this.buildAutomatically)||this._renderNewSpriteSheet(!1))},h.prototype.renderNewSpriteSheet=function(){if(this.willRender=!1,!this.numThingsLoading)return this._renderNewSpriteSheet()},h.prototype._renderNewSpriteSheet=function(t){var e,i,n,o,s,r,a,l,c,h,u,p,d,m,f,g;if(!this.destroyed){for(h in this.asyncBuilder&&this.asyncBuilder.stopAsync(),(this.asyncBuilder=null)==t&&(t=this.buildAsync),i=new he.SpriteSheetBuilder,l=_.groupBy(this.toRenderBundles,function(e){return this.renderGroupingKey(e.thangType,"",e.colorConfig)},this),p=this.createPlaceholder(),s=this.resolutionFactor*SPRITE_PLACEHOLDER_WIDTH,p.setBounds(0,0,s,s),i.addFrame(p),r=(null!=(p=this.spriteSheet)?p.resolutionFactor:void 0)===this.resolutionFactor?this.spriteSheet.animations:[],d=this.customGraphics)a=d[h],a=0<=ue.call(r,h)?((a=new he.Sprite(this.spriteSheet)).gotoAndStop(h),i.addFrame(a)):i.addFrame(a.graphic,a.bounds,this.resolutionFactor),i.addAnimation(h,[a],!1);for(0,c=0,u=(m=_.values(l)).length;c<u;c++)e=[g=(o=m[c])[0].thangType,o[0].colorConfig,function(){for(var e=[],t=0,i=o.length;t<i;t++)n=o[t],e.push(n.actionName);return e}(),i],g.get("raw")||g.get("prerenderedSpriteSheetData")?("segmented"===(g.get("spriteType")||this.defaultSpriteType)?this.renderSegmentedThangType:this.renderSingularThangType).apply(this,e):this.renderRasterThangType(g,i);if(t){try{i.buildAsync()}catch(e){return this.resolutionFactor*=.9,this._renderNewSpriteSheet(t)}return i.on("complete",this.onBuildSpriteSheetComplete,this,!0,i),this.asyncBuilder=i}try{f=i.build()}catch(e){return this.resolutionFactor*=.9,this._renderNewSpriteSheet(t)}return this.onBuildSpriteSheetComplete({async:t},i),f}},h.prototype.onBuildSpriteSheetComplete=function(e,t){var i,n,o,s,r,a,l,c,h,u,p,d,m;if(!this.initializing&&!this.destroyed){for((this.asyncBuilder=null)!=t&&t.removeAllEventListeners(),this.spriteSheet&&this.destroySpriteSheet(),this.spriteSheet=t.spriteSheet,t=null,this.spriteSheet.resolutionFactor=this.resolutionFactor,null!=(c=this.container)&&c.removeAllEventListeners(),this.container=new he.Container(this.spriteSheet),i=0,r=(u=this.lanks).length;i<r;i++)(s=u[i]).destroyed&&console.log("zombie sprite found on layer",this.name),s.destroyed||this.setSpriteToLank(s);for(n=0,a=(p=["scaleX","scaleY","regX","regY"]).length;n<a;n++)this.container[h=p[n]]=c[h];for((t=c.parent)&&(d=t.getChildIndex(c),t.removeChildAt(d),t.addChildAt(this.container,d)),null!=(d=this.camera)&&d.updateZoom(!0),this.updateLayerOrder(),o=0,l=(m=this.lanks).length;o<l;o++)(s=m[o]).options.resolutionFactor=this.resolutionFactor,s.updateScale(),s.updateRotation();return this.trigger("new-spritesheet")}},h.prototype.resetSpriteSheet=function(){for(var e,t=this.lanks.slice(0),i=0,n=t.length;i<n;i++)e=t[i],this.removeLank(e);return this.toRenderBundles=[],this.actionRenderState={},this.initializing=!0,this.destroySpriteSheet(),this.spriteSheet=this._renderNewSpriteSheet(!1),this.initializing=!1},h.prototype.createPlaceholder=function(){var e,t,i=new he.Graphics;return i.setStrokeStyle(5),e={Land:[0,50,0],Ground:[230,230,230],Obstacle:[20,70,20],Path:[200,100,200],Default:[64,64,64],Floating:[100,100,200]}[this.name]||[0,0,0],i.beginStroke((t=he.Graphics).getRGB.apply(t,e)),e.push(.7),i.beginFill((t=he.Graphics).getRGB.apply(t,e)),t=this.resolutionFactor*SPRITE_PLACEHOLDER_WIDTH,("Default"===(e=this.name)||"Ground"===e||"Floating"===e||"Path"===e?i.drawEllipse:i.drawRect).apply(i,[0,0,t,t]),new he.Shape(i)},h.prototype.renderSegmentedThangType=function(e,t,i,n){var o,s,r,a,l,c,h,u,p,d,m,f=e.getPrerenderedSpriteSheet(t,"segmented");if(!f||f.loadedImage){for(f&&(o=f.spriteSheet._animations,u=_.zipObject(o,_.times(o.length,function(){return!0}))),a=e.getContainersForActions(i),m=new ce(e,{colorConfig:t}),p=[],c=0,h=a.length;c<h;c++)l=a[c],r=this.renderGroupingKey(e,l,t),l=(null!=(d=this.spriteSheet)?d.resolutionFactor:void 0)===this.resolutionFactor&&0<=ue.call(this.spriteSheet.animations,r)?((s=new he.Sprite(this.spriteSheet)).gotoAndStop(r),n.addFrame(s)):f&&u[l]?((s=new he.Sprite(f.spriteSheet)).gotoAndStop(l),d=this.resolutionFactor/(f.get("resolutionFactor")||1),n.addFrame(s,null,d)):(s=m.buildContainerFromStore(l),n.addFrame(s,null,this.resolutionFactor*(e.get("scale")||1))),p.push(n.addAnimation(r,[l],!1));return p}},h.prototype.renderSingularThangType=function(n,o,e,s){var r,a,l,t,c,i,h,u,p,d,m,f,g,y,v,b,w,k,x,S,C,T,L,M,D,I,A,R,P,E,B,F,N,U,V,O,G,z,H,W,q,j,$,J,Y,K,X,Z,Q,ee,te,ie,ne,oe,se,re,ae=n.getPrerenderedSpriteSheet(o,"singular"),le={};if(ae){if(!ae.loadedImage)return;for(oe=this.resolutionFactor/(ae.get("resolutionFactor")||1),x=C=0,D=(J=ae.spriteSheet._frames).length;C<D;x=++C)y=J[x],(se=new he.Sprite(ae.spriteSheet)).gotoAndStop(x),le[x]=s.addFrame(se,null,oe)}for(i=[],T=0,I=(t=_.values(n.getActions())).length;T<I;T++)(r=t[T]).animation&&(Y=r.name,ue.call(e,Y)<0||i.push(r));for(u in re=new ce(n,{colorConfig:o}),h=_.groupBy(i,function(e){return e.animation}))if(c=h[u],ie=_.any(c,function(e){return void 0===e.frames}),oe=c[0].scale||n.get("scale")||1,l=function(){for(var e=[],t=0,i=c.length;t<i;t++)a=c[t],e.push(this.renderGroupingKey(n,a.name,o));return e}.call(this),(null!=(K=this.spriteSheet)?K.resolutionFactor:void 0)===this.resolutionFactor&&_.all(l,function(t){return function(e){return 0<=ue.call(t.spriteSheet.animations,e)}}(this))){for(w=_.uniq(_.flatten(function(){for(var e=[],t=0,i=l.length;t<i;t++)L=l[t],e.push(this.spriteSheet.getAnimation(L).frames);return e}.call(this))),b={},M=0,A=w.length;M<A;M++)y=w[M],(se=new he.Sprite(this.spriteSheet)).gotoAndStop(y),b[y]=s.addFrame(se);for(S=U=0,R=l.length;U<R;S=++U)L=l[S],a=c[S],v=function(){for(var e=this.spriteSheet.getAnimation(L).frames,t=[],i=0,n=e.length;i<n;i++)g=e[i],t.push(b[g]);return t}.call(this),z=n.nextForAction(a),s.addAnimation(L,v,z)}else if(ae)for(O=0,P=c.length;O<P;O++)a=c[O],G=this.renderGroupingKey(n,a.name,o),(q=null!=(X=ae.get("animations"))&&null!=(Z=X[a.name])?Z.frames:void 0)&&(v=function(){for(var e=[],t=0,i=q.length;t<i;t++)y=q[t],e.push(le[y]);return e}(),z=n.nextForAction(a),s.addAnimation(G,v,z));else{if(V=re.buildMovieClip(u,null,null,null,{temp:0}),ie)s.addMovieClip(V,null,oe*this.resolutionFactor),v=s._animations.temp.frames,b=_.zipObject(_.range(v.length),v);else for(b={},H=0,E=(k=_.uniq(_.flatten(function(){for(var e=[],t=0,i=c.length;t<i;t++)r=c[t],e.push(r.frames.split(","));return e}()))).length;H<E;H++)y=k[H],y=parseInt(y),g=_.bind(V.gotoAndStop,V,y),b[y]=s.addFrame(V,null,oe*this.resolutionFactor,g);for(W=0,B=c.length;W<B;W++)a=c[W],G=this.renderGroupingKey(n,a.name,o),v=a.frames?function(){for(var e=a.frames.split(","),t=[],i=0,n=e.length;i<n;i++)y=e[i],t.push(b[parseInt(y)]);return t}():_.sortBy(_.values(b)),z=n.nextForAction(a),s.addAnimation(G,v,z)}for(d=[],j=0,F=t.length;j<F;j++)(r=t[j]).container&&(Q=r.name,ue.call(e,Q)<0||d.push(r));for(f in ne=[],m=_.groupBy(d,function(e){return e.container}))if(c=m[f],ae)for($=0,N=c.length;$<N;$++)a=c[$],G=this.renderGroupingKey(n,a.name,o),(q=null!=(ee=ae.get("animations"))&&null!=(te=ee[a.name])?te.frames:void 0)&&(y=le[q[0]],s.addAnimation(G,[y],!1));else p=re.buildContainerFromStore(f),oe=c[0].scale||n.get("scale")||1,y=s.addFrame(p,null,oe*this.resolutionFactor),ne.push(function(){for(var e=[],t=0,i=c.length;t<i;t++)a=c[t],G=this.renderGroupingKey(n,a.name,o),e.push(s.addAnimation(G,[y],!1));return e}.call(this));return ne},h.prototype.renderRasterThangType=function(e,t){var i,n,o;return e.rasterImage||console.error("Cannot render the LayerAdapter SpriteSheet until the raster image for <"+e.get("name")+"> is loaded."),i=s(e.rasterImage[0]),s("body").append(i),n=new he.Bitmap(e.rasterImage[0]),o=e.get("scale")||1,o=t.addFrame(n,null,o),t.addAnimation(this.renderGroupingKey(e),[o],!1),i.remove()},h.prototype.setSpriteToLank=function(e){var t,i,n,o;if(e.thangType.isFullyLoaded()?e.thangType.get("raster")?(o=new he.Sprite(this.spriteSheet),n=e.thangType.get("scale")||1,i=e.getOffset("registration"),o.regX=-i.x*n,o.regY=-i.y*n,o.gotoAndStop(this.renderGroupingKey(e.thangType)),o.baseScaleX=o.baseScaleY=1):(n="segmented"===(e.thangType.get("spriteType")||this.defaultSpriteType)?r:a,t=this.renderGroupingKey(e.thangType,null,e.options.colorConfig)+".",o=new n(this.spriteSheet,e.thangType,t,this.resolutionFactor)):((o=new he.Sprite(this.spriteSheet)).gotoAndStop(0),o.placeholder=!0,o.regX=this.resolutionFactor*SPRITE_PLACEHOLDER_WIDTH/2,o.regY=this.resolutionFactor*SPRITE_PLACEHOLDER_WIDTH,o.baseScaleX=o.baseScaleY=o.scaleX=o.scaleY=10/(this.resolutionFactor*SPRITE_PLACEHOLDER_WIDTH)),o.lank=e,o.camera=this.camera,o.layerPriority=null!=(t=null!=(t=e.thang)?t.layerPriority:void 0)?t:e.thangType.get("layerPriority"),o.name=(null!=(t=e.thang)?t.spriteName:void 0)||e.thangType.get("name"),e.setSprite(o),e.update(!0),this.container.addChild(o),e.thangType.get("matchWorldDimensions"))return e.updateScale(!0)},h.prototype.renderGroupingKey=function(e,t,i){var n,o,s=e.get("slug"),r=null!=i?i:{};for(n in r)s+="("+n+":"+(o=r[n]).hue+","+o.saturation+","+o.lightness+")";return t&&(s+="."+t),s},h.prototype.destroySpriteSheet=function(){var e,t,i,n,o,s;if(this.spriteSheet){for(s=[],e=i=0,n=(o=this.spriteSheet._images).length;i<n;e=++i)(t=o[e])&&(t.width=t.height=0,s.push(this.spriteSheet._images[e]=null));return s}},h.prototype.destroy=function(){for(var e,t=this.container.children,i=0,n=t.length;i<n;i++)"function"==typeof(e=t[i]).destroy&&e.destroy();return this.asyncBuilder&&this.asyncBuilder.stopAsync(),this.destroySpriteSheet(),h.__super__.destroy.call(this)},h)}.call(this,n(3))},1432:function(e,t,i){"use strict";i.r(t);var n,o=i(1433),s=i.n(o);for(n in o)["default"].indexOf(n)<0&&function(e){i.d(t,e,function(){return o[e]})}(n);t.default=s.a},1433:function(e,t,i){"use strict";e.exports=Vue.extend({name:"pie-chart",props:{ratio:Number,percent:{type:Number,default:42},strokeWidth:{type:Number,default:1,validator:function(e){return 0<e&&e<=10}},borderStrokeWidth:{type:Number,default:.2},color:{type:String,default:"#40a070"},opacity:{type:Number,default:.7}},computed:{width:function(){return 2+this.strokeWidth/5},viewBox:function(){var e=1+this.strokeWidth/10,t=this.width;return-e+" "+-e+" "+t+" "+t},circle:function(){return this._ratio%1==0},_ratio:function(){var e=this.percent/100;return isFinite(this.ratio)?this.ratio:e},arc:function(){var e=this._ratio,t=2*Math.PI*e,i=+Math.sin(t),n=e<0,e=0;return"A 1 1 0 "+(e=n&&0<i||!n&&i<0?1:e)+" "+(n?0:1)+" "+i+" "+-1*Math.cos(t)},path:function(){return"M 0 -1 "+this.arc}}})},1434:function(e,t,i){var n=i(1523);"string"==typeof n&&(n=[[e.i,n,""]]);i(93)(n,{});n.locals&&(e.exports=n.locals)},1437:function(h,e,u){!function(s,r){var n,e,t,i,o,a,l={}.hasOwnProperty;function c(e){var n;c.__super__.constructor.call(this,e),this.timestampForPurchase=(new Date).getTime(),this.state="standby",this.products=new t,this.products.comparator="amount",s.isIPadApp?(this.products=[],Backbone.Mediator.publish("buy-gems-modal:update-products")):(this.supermodel.loadCollection(this.products,"products"),r.post("/db/payment/check-stripe-charges",(n=this,function(e,t,i){if(201===i.status)return n.state="recovered_charge",n.render()}))),this.trackTimeVisible({trackViewLifecycle:!0})}u(1612),u(1614),e=u(80),a=u(1616),o=u(638),u(6),i=u(622),t=u(274),n=u(118),h.exports=(function(e,t){for(var i in t)l.call(t,i)&&(e[i]=t[i]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(c,e),c.prototype.id="nl"===(me.get("preferredLanguage",!0)||"en-US").split("-")[0]?"buy-gems-modal-nl":"buy-gems-modal",c.prototype.template=a,c.prototype.plain=!0,c.prototype.subscriptions={"ipad:products":"onIPadProducts","ipad:iap-complete":"onIAPComplete","stripe:received-token":"onStripeReceivedToken"},c.prototype.events={"click .product button:not(.start-subscription-button)":"onClickProductButton","click #close-modal":"hide","click .start-subscription-button":"onClickStartSubscription"},c.prototype.onLoaded=function(){return this.basicProduct=this.products.getBasicSubscriptionForUser(me),this.lifetimeProduct=this.products.getLifetimeSubscriptionForUser(me),this.products.reset(this.products.filter(function(e){return _.string.startsWith(e.get("name"),"gems_")})),c.__super__.onLoaded.call(this)},c.prototype.afterRender=function(){if(c.__super__.afterRender.call(this),this.supermodel.finished())return this.playSound("game-menu-open"),this.basicProduct?this.$el.find(".subscription-gem-amount").text(r.i18n.t("buy_gems.price").replace("{{gems}}",this.basicProduct.get("gems"))):void 0},c.prototype.onHidden=function(){return c.__super__.onHidden.call(this),this.playSound("game-menu-close")},c.prototype.onIPadProducts=function(e){},c.prototype.getProductDescription=function(e){switch(e){case"gems_5":return"buy_gems.few_gems";case"gems_10":return"buy_gems.pile_gems";case"gems_20":return"buy_gems.chest_gems";default:return""}},c.prototype.onClickProductButton=function(e){var t,i;return this.playSound("menu-button-click"),me.get("anonymous")?this.openModalView(new n):0!==(i=r(e.target).closest("button").val()).length?(t=this.products.findWhere({name:i}),s.isIPadApp?Backbone.Mediator.publish("buy-gems-modal:purchase-initiated",{productID:i}):(null!=(e=s.tracker)&&e.trackEvent("Started gem purchase",{productID:i}),o.open({description:r.t(this.getProductDescription(t.get("name"))),amount:t.get("amount"),bitcoin:!0,alipay:"china"===me.get("country")||"zh"===(me.get("preferredLanguage")||"en-US").slice(0,2)||"auto"})),this.productBeingPurchased=t):void 0},c.prototype.onStripeReceivedToken=function(t){var i,n,o,e={productID:this.productBeingPurchased.get("name"),stripe:{token:t.token.id,timestamp:this.timestampForPurchase}};return this.state="purchasing",this.render(),(i=r.post("/db/payment",e)).done((n=this,function(){var e;return null!=(e=s.tracker)&&e.trackEvent("Finished gem purchase",{productID:n.productBeingPurchased.get("name"),value:n.productBeingPurchased.get("amount")}),document.location.reload()})),i.fail((o=this,function(){var e;return 402===i.status?(o.state="declined",o.stateMessage=arguments[2]):500===i.status?(o.state="retrying",e=_.bind(o.onStripeReceivedToken,o,t),_.delay(e,2e3)):(o.state="unknown_error",o.stateMessage=i.status+": "+i.responseText),o.render()}))},c.prototype.onIAPComplete=function(e){var t=this.products.findWhere({name:e.productID}),e=null!=(e=me.get("purchased"))?e:{};return null==(e=_.clone(e)).gems&&(e.gems=0),e.gems+=t.gems,me.set("purchased",e),this.hide()},c.prototype.onClickStartSubscription=function(e){var t;return this.openModalView(new i),null!=(t=window.tracker)?t.trackEvent("Show subscription modal",{category:"Subscription",label:"buy gems modal"}):void 0},c)}.call(this,u(17),u(3))},1440:function(e,t,i){(e.exports=i(92)()).push([e.i,'/*! jQuery UI - v1.11.1 - 2014-09-20\n* http://jqueryui.com\n* Includes: core.css, datepicker.css, draggable.css, resizable.css, sortable.css, autocomplete.css, menu.css, slider.css, theme.css\n* To view and modify this theme, visit http://jqueryui.com/themeroller/?ffDefault=Trebuchet%20MS%2CTahoma%2CVerdana%2CArial%2Csans-serif&fwDefault=bold&fsDefault=1.1em&cornerRadius=4px&bgColorHeader=f6a828&bgTextureHeader=gloss_wave&bgImgOpacityHeader=35&borderColorHeader=e78f08&fcHeader=ffffff&iconColorHeader=ffffff&bgColorContent=eeeeee&bgTextureContent=highlight_soft&bgImgOpacityContent=100&borderColorContent=dddddd&fcContent=333333&iconColorContent=222222&bgColorDefault=f6f6f6&bgTextureDefault=glass&bgImgOpacityDefault=100&borderColorDefault=cccccc&fcDefault=1c94c4&iconColorDefault=ef8c08&bgColorHover=fdf5ce&bgTextureHover=glass&bgImgOpacityHover=100&borderColorHover=fbcb09&fcHover=c77405&iconColorHover=ef8c08&bgColorActive=ffffff&bgTextureActive=glass&bgImgOpacityActive=65&borderColorActive=fbd850&fcActive=eb8f00&iconColorActive=ef8c08&bgColorHighlight=ffe45c&bgTextureHighlight=highlight_soft&bgImgOpacityHighlight=75&borderColorHighlight=fed22f&fcHighlight=363636&iconColorHighlight=228ef1&bgColorError=b81900&bgTextureError=diagonals_thick&bgImgOpacityError=18&borderColorError=cd0a0a&fcError=ffffff&iconColorError=ffd27a&bgColorOverlay=666666&bgTextureOverlay=diagonals_thick&bgImgOpacityOverlay=20&opacityOverlay=50&bgColorShadow=000000&bgTextureShadow=flat&bgImgOpacityShadow=10&opacityShadow=20&thicknessShadow=5px&offsetTopShadow=-5px&offsetLeftShadow=-5px&cornerRadiusShadow=5px\n* Copyright 2014 jQuery Foundation and other contributors; Licensed MIT */\n\n/* Layout helpers\n----------------------------------*/\n.ui-helper-hidden {\n\tdisplay: none;\n}\n.ui-helper-hidden-accessible {\n\tborder: 0;\n\tclip: rect(0 0 0 0);\n\theight: 1px;\n\tmargin: -1px;\n\toverflow: hidden;\n\tpadding: 0;\n\tposition: absolute;\n\twidth: 1px;\n}\n.ui-helper-reset {\n\tmargin: 0;\n\tpadding: 0;\n\tborder: 0;\n\toutline: 0;\n\tline-height: 1.3;\n\ttext-decoration: none;\n\tfont-size: 100%;\n\tlist-style: none;\n}\n.ui-helper-clearfix:before,\n.ui-helper-clearfix:after {\n\tcontent: "";\n\tdisplay: table;\n\tborder-collapse: collapse;\n}\n.ui-helper-clearfix:after {\n\tclear: both;\n}\n.ui-helper-clearfix {\n\tmin-height: 0; /* support: IE7 */\n}\n.ui-helper-zfix {\n\twidth: 100%;\n\theight: 100%;\n\ttop: 0;\n\tleft: 0;\n\tposition: absolute;\n\topacity: 0;\n\tfilter:Alpha(Opacity=0); /* support: IE8 */\n}\n\n.ui-front {\n\tz-index: 100;\n}\n\n\n/* Interaction Cues\n----------------------------------*/\n.ui-state-disabled {\n\tcursor: default !important;\n}\n\n\n/* Icons\n----------------------------------*/\n\n/* states and images */\n.ui-icon {\n\tdisplay: block;\n\ttext-indent: -99999px;\n\toverflow: hidden;\n\tbackground-repeat: no-repeat;\n}\n\n\n/* Misc visuals\n----------------------------------*/\n\n/* Overlays */\n.ui-widget-overlay {\n\tposition: fixed;\n\ttop: 0;\n\tleft: 0;\n\twidth: 100%;\n\theight: 100%;\n}\n\n.ui-datepicker {\n\twidth: 17em;\n\tpadding: .2em .2em 0;\n\tdisplay: none;\n}\n.ui-datepicker .ui-datepicker-header {\n\tposition: relative;\n\tpadding: .2em 0;\n}\n.ui-datepicker .ui-datepicker-prev,\n.ui-datepicker .ui-datepicker-next {\n\tposition: absolute;\n\ttop: 2px;\n\twidth: 1.8em;\n\theight: 1.8em;\n}\n.ui-datepicker .ui-datepicker-prev-hover,\n.ui-datepicker .ui-datepicker-next-hover {\n\ttop: 1px;\n}\n.ui-datepicker .ui-datepicker-prev {\n\tleft: 2px;\n}\n.ui-datepicker .ui-datepicker-next {\n\tright: 2px;\n}\n.ui-datepicker .ui-datepicker-prev-hover {\n\tleft: 1px;\n}\n.ui-datepicker .ui-datepicker-next-hover {\n\tright: 1px;\n}\n.ui-datepicker .ui-datepicker-prev span,\n.ui-datepicker .ui-datepicker-next span {\n\tdisplay: block;\n\tposition: absolute;\n\tleft: 50%;\n\tmargin-left: -8px;\n\ttop: 50%;\n\tmargin-top: -8px;\n}\n.ui-datepicker .ui-datepicker-title {\n\tmargin: 0 2.3em;\n\tline-height: 1.8em;\n\ttext-align: center;\n}\n.ui-datepicker .ui-datepicker-title select {\n\tfont-size: 1em;\n\tmargin: 1px 0;\n}\n.ui-datepicker select.ui-datepicker-month,\n.ui-datepicker select.ui-datepicker-year {\n\twidth: 45%;\n}\n.ui-datepicker table {\n\twidth: 100%;\n\tfont-size: .9em;\n\tborder-collapse: collapse;\n\tmargin: 0 0 .4em;\n}\n.ui-datepicker th {\n\tpadding: .7em .3em;\n\ttext-align: center;\n\tfont-weight: bold;\n\tborder: 0;\n}\n.ui-datepicker td {\n\tborder: 0;\n\tpadding: 1px;\n}\n.ui-datepicker td span,\n.ui-datepicker td a {\n\tdisplay: block;\n\tpadding: .2em;\n\ttext-align: right;\n\ttext-decoration: none;\n}\n.ui-datepicker .ui-datepicker-buttonpane {\n\tbackground-image: none;\n\tmargin: .7em 0 0 0;\n\tpadding: 0 .2em;\n\tborder-left: 0;\n\tborder-right: 0;\n\tborder-bottom: 0;\n}\n.ui-datepicker .ui-datepicker-buttonpane button {\n\tfloat: right;\n\tmargin: .5em .2em .4em;\n\tcursor: pointer;\n\tpadding: .2em .6em .3em .6em;\n\twidth: auto;\n\toverflow: visible;\n}\n.ui-datepicker .ui-datepicker-buttonpane button.ui-datepicker-current {\n\tfloat: left;\n}\n\n/* with multiple calendars */\n.ui-datepicker.ui-datepicker-multi {\n\twidth: auto;\n}\n.ui-datepicker-multi .ui-datepicker-group {\n\tfloat: left;\n}\n.ui-datepicker-multi .ui-datepicker-group table {\n\twidth: 95%;\n\tmargin: 0 auto .4em;\n}\n.ui-datepicker-multi-2 .ui-datepicker-group {\n\twidth: 50%;\n}\n.ui-datepicker-multi-3 .ui-datepicker-group {\n\twidth: 33.3%;\n}\n.ui-datepicker-multi-4 .ui-datepicker-group {\n\twidth: 25%;\n}\n.ui-datepicker-multi .ui-datepicker-group-last .ui-datepicker-header,\n.ui-datepicker-multi .ui-datepicker-group-middle .ui-datepicker-header {\n\tborder-left-width: 0;\n}\n.ui-datepicker-multi .ui-datepicker-buttonpane {\n\tclear: left;\n}\n.ui-datepicker-row-break {\n\tclear: both;\n\twidth: 100%;\n\tfont-size: 0;\n}\n\n/* RTL support */\n.ui-datepicker-rtl {\n\tdirection: rtl;\n}\n.ui-datepicker-rtl .ui-datepicker-prev {\n\tright: 2px;\n\tleft: auto;\n}\n.ui-datepicker-rtl .ui-datepicker-next {\n\tleft: 2px;\n\tright: auto;\n}\n.ui-datepicker-rtl .ui-datepicker-prev:hover {\n\tright: 1px;\n\tleft: auto;\n}\n.ui-datepicker-rtl .ui-datepicker-next:hover {\n\tleft: 1px;\n\tright: auto;\n}\n.ui-datepicker-rtl .ui-datepicker-buttonpane {\n\tclear: right;\n}\n.ui-datepicker-rtl .ui-datepicker-buttonpane button {\n\tfloat: left;\n}\n.ui-datepicker-rtl .ui-datepicker-buttonpane button.ui-datepicker-current,\n.ui-datepicker-rtl .ui-datepicker-group {\n\tfloat: right;\n}\n.ui-datepicker-rtl .ui-datepicker-group-last .ui-datepicker-header,\n.ui-datepicker-rtl .ui-datepicker-group-middle .ui-datepicker-header {\n\tborder-right-width: 0;\n\tborder-left-width: 1px;\n}\n\n/* Icons */\n.ui-datepicker .ui-icon {\n\tdisplay: block;\n\ttext-indent: -99999px;\n\toverflow: hidden;\n\tbackground-repeat: no-repeat;\n\tleft: .5em;\n\ttop: .3em;\n}\n\n.ui-draggable-handle {\n\t-ms-touch-action: none;\n\ttouch-action: none;\n}\n.ui-resizable {\n\tposition: relative;\n}\n.ui-resizable-handle {\n\tposition: absolute;\n\tfont-size: 0.1px;\n\tdisplay: block;\n\t-ms-touch-action: none;\n\ttouch-action: none;\n}\n.ui-resizable-disabled .ui-resizable-handle,\n.ui-resizable-autohide .ui-resizable-handle {\n\tdisplay: none;\n}\n.ui-resizable-n {\n\tcursor: n-resize;\n\theight: 7px;\n\twidth: 100%;\n\ttop: -5px;\n\tleft: 0;\n}\n.ui-resizable-s {\n\tcursor: s-resize;\n\theight: 7px;\n\twidth: 100%;\n\tbottom: -5px;\n\tleft: 0;\n}\n.ui-resizable-e {\n\tcursor: e-resize;\n\twidth: 7px;\n\tright: -5px;\n\ttop: 0;\n\theight: 100%;\n}\n.ui-resizable-w {\n\tcursor: w-resize;\n\twidth: 7px;\n\tleft: -5px;\n\ttop: 0;\n\theight: 100%;\n}\n.ui-resizable-se {\n\tcursor: se-resize;\n\twidth: 12px;\n\theight: 12px;\n\tright: 1px;\n\tbottom: 1px;\n}\n.ui-resizable-sw {\n\tcursor: sw-resize;\n\twidth: 9px;\n\theight: 9px;\n\tleft: -5px;\n\tbottom: -5px;\n}\n.ui-resizable-nw {\n\tcursor: nw-resize;\n\twidth: 9px;\n\theight: 9px;\n\tleft: -5px;\n\ttop: -5px;\n}\n.ui-resizable-ne {\n\tcursor: ne-resize;\n\twidth: 9px;\n\theight: 9px;\n\tright: -5px;\n\ttop: -5px;\n}\n.ui-sortable-handle {\n\t-ms-touch-action: none;\n\ttouch-action: none;\n}\n.ui-autocomplete {\n\tposition: absolute;\n\ttop: 0;\n\tleft: 0;\n\tcursor: default;\n}\n.ui-menu {\n\tlist-style: none;\n\tpadding: 0;\n\tmargin: 0;\n\tdisplay: block;\n\toutline: none;\n}\n.ui-menu .ui-menu {\n\tposition: absolute;\n}\n.ui-menu .ui-menu-item {\n\tposition: relative;\n\tmargin: 0;\n\tpadding: 3px 1em 3px .4em;\n\tcursor: pointer;\n\tmin-height: 0; /* support: IE7 */\n\t/* support: IE10, see #8844 */\n\tlist-style-image: url("data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7");\n}\n.ui-menu .ui-menu-divider {\n\tmargin: 5px 0;\n\theight: 0;\n\tfont-size: 0;\n\tline-height: 0;\n\tborder-width: 1px 0 0 0;\n}\n.ui-menu .ui-state-focus,\n.ui-menu .ui-state-active {\n\tmargin: -1px;\n}\n\n/* icon support */\n.ui-menu-icons {\n\tposition: relative;\n}\n.ui-menu-icons .ui-menu-item {\n\tpadding-left: 2em;\n}\n\n/* left-aligned */\n.ui-menu .ui-icon {\n\tposition: absolute;\n\ttop: 0;\n\tbottom: 0;\n\tleft: .2em;\n\tmargin: auto 0;\n}\n\n/* right-aligned */\n.ui-menu .ui-menu-icon {\n\tleft: auto;\n\tright: 0;\n}\n.ui-slider {\n\tposition: relative;\n\ttext-align: left;\n}\n.ui-slider .ui-slider-handle {\n\tposition: absolute;\n\tz-index: 2;\n\twidth: 1.2em;\n\theight: 1.2em;\n\tcursor: default;\n\t-ms-touch-action: none;\n\ttouch-action: none;\n}\n.ui-slider .ui-slider-range {\n\tposition: absolute;\n\tz-index: 1;\n\tfont-size: .7em;\n\tdisplay: block;\n\tborder: 0;\n\tbackground-position: 0 0;\n}\n\n/* support: IE8 - See #6727 */\n.ui-slider.ui-state-disabled .ui-slider-handle,\n.ui-slider.ui-state-disabled .ui-slider-range {\n\tfilter: inherit;\n}\n\n.ui-slider-horizontal {\n\theight: .8em;\n}\n.ui-slider-horizontal .ui-slider-handle {\n\ttop: -.3em;\n\tmargin-left: -.6em;\n}\n.ui-slider-horizontal .ui-slider-range {\n\ttop: 0;\n\theight: 100%;\n}\n.ui-slider-horizontal .ui-slider-range-min {\n\tleft: 0;\n}\n.ui-slider-horizontal .ui-slider-range-max {\n\tright: 0;\n}\n\n.ui-slider-vertical {\n\twidth: .8em;\n\theight: 100px;\n}\n.ui-slider-vertical .ui-slider-handle {\n\tleft: -.3em;\n\tmargin-left: 0;\n\tmargin-bottom: -.6em;\n}\n.ui-slider-vertical .ui-slider-range {\n\tleft: 0;\n\twidth: 100%;\n}\n.ui-slider-vertical .ui-slider-range-min {\n\tbottom: 0;\n}\n.ui-slider-vertical .ui-slider-range-max {\n\ttop: 0;\n}\n\n/* Component containers\n----------------------------------*/\n.ui-widget {\n\tfont-family: Trebuchet MS,Tahoma,Verdana,Arial,sans-serif;\n\tfont-size: 1.1em;\n}\n.ui-widget .ui-widget {\n\tfont-size: 1em;\n}\n.ui-widget input,\n.ui-widget select,\n.ui-widget textarea,\n.ui-widget button {\n\tfont-family: Trebuchet MS,Tahoma,Verdana,Arial,sans-serif;\n\tfont-size: 1em;\n}\n.ui-widget-content {\n\tborder: 1px solid #dddddd;\n\tbackground: #eeeeee url("images/ui-bg_highlight-soft_100_eeeeee_1x100.png") 50% top repeat-x;\n\tcolor: #333333;\n}\n.ui-widget-content a {\n\tcolor: #333333;\n}\n.ui-widget-header {\n\tborder: 1px solid #e78f08;\n\tbackground: #f6a828 url("images/ui-bg_gloss-wave_35_f6a828_500x100.png") 50% 50% repeat-x;\n\tcolor: #ffffff;\n\tfont-weight: bold;\n}\n.ui-widget-header a {\n\tcolor: #ffffff;\n}\n\n/* Interaction states\n----------------------------------*/\n.ui-state-default,\n.ui-widget-content .ui-state-default,\n.ui-widget-header .ui-state-default {\n\tborder: 1px solid #cccccc;\n\tbackground: #f6f6f6 url("images/ui-bg_glass_100_f6f6f6_1x400.png") 50% 50% repeat-x;\n\tfont-weight: bold;\n\tcolor: #1c94c4;\n}\n.ui-state-default a,\n.ui-state-default a:link,\n.ui-state-default a:visited {\n\tcolor: #1c94c4;\n\ttext-decoration: none;\n}\n.ui-state-hover,\n.ui-widget-content .ui-state-hover,\n.ui-widget-header .ui-state-hover,\n.ui-state-focus,\n.ui-widget-content .ui-state-focus,\n.ui-widget-header .ui-state-focus {\n\tborder: 1px solid #fbcb09;\n\tbackground: #fdf5ce url("images/ui-bg_glass_100_fdf5ce_1x400.png") 50% 50% repeat-x;\n\tfont-weight: bold;\n\tcolor: #c77405;\n}\n.ui-state-hover a,\n.ui-state-hover a:hover,\n.ui-state-hover a:link,\n.ui-state-hover a:visited,\n.ui-state-focus a,\n.ui-state-focus a:hover,\n.ui-state-focus a:link,\n.ui-state-focus a:visited {\n\tcolor: #c77405;\n\ttext-decoration: none;\n}\n.ui-state-active,\n.ui-widget-content .ui-state-active,\n.ui-widget-header .ui-state-active {\n\tborder: 1px solid #fbd850;\n\tbackground: #ffffff url("images/ui-bg_glass_65_ffffff_1x400.png") 50% 50% repeat-x;\n\tfont-weight: bold;\n\tcolor: #eb8f00;\n}\n.ui-state-active a,\n.ui-state-active a:link,\n.ui-state-active a:visited {\n\tcolor: #eb8f00;\n\ttext-decoration: none;\n}\n\n/* Interaction Cues\n----------------------------------*/\n.ui-state-highlight,\n.ui-widget-content .ui-state-highlight,\n.ui-widget-header .ui-state-highlight {\n\tborder: 1px solid #fed22f;\n\tbackground: #ffe45c url("images/ui-bg_highlight-soft_75_ffe45c_1x100.png") 50% top repeat-x;\n\tcolor: #363636;\n}\n.ui-state-highlight a,\n.ui-widget-content .ui-state-highlight a,\n.ui-widget-header .ui-state-highlight a {\n\tcolor: #363636;\n}\n.ui-state-error,\n.ui-widget-content .ui-state-error,\n.ui-widget-header .ui-state-error {\n\tborder: 1px solid #cd0a0a;\n\tbackground: #b81900 url("images/ui-bg_diagonals-thick_18_b81900_40x40.png") 50% 50% repeat;\n\tcolor: #ffffff;\n}\n.ui-state-error a,\n.ui-widget-content .ui-state-error a,\n.ui-widget-header .ui-state-error a {\n\tcolor: #ffffff;\n}\n.ui-state-error-text,\n.ui-widget-content .ui-state-error-text,\n.ui-widget-header .ui-state-error-text {\n\tcolor: #ffffff;\n}\n.ui-priority-primary,\n.ui-widget-content .ui-priority-primary,\n.ui-widget-header .ui-priority-primary {\n\tfont-weight: bold;\n}\n.ui-priority-secondary,\n.ui-widget-content .ui-priority-secondary,\n.ui-widget-header .ui-priority-secondary {\n\topacity: .7;\n\tfilter:Alpha(Opacity=70); /* support: IE8 */\n\tfont-weight: normal;\n}\n.ui-state-disabled,\n.ui-widget-content .ui-state-disabled,\n.ui-widget-header .ui-state-disabled {\n\topacity: .35;\n\tfilter:Alpha(Opacity=35); /* support: IE8 */\n\tbackground-image: none;\n}\n.ui-state-disabled .ui-icon {\n\tfilter:Alpha(Opacity=35); /* support: IE8 - See #6059 */\n}\n\n/* Icons\n----------------------------------*/\n\n/* states and images */\n.ui-icon {\n\twidth: 16px;\n\theight: 16px;\n}\n.ui-icon,\n.ui-widget-content .ui-icon {\n\tbackground-image: url("images/ui-icons_222222_256x240.png");\n}\n.ui-widget-header .ui-icon {\n\tbackground-image: url("images/ui-icons_ffffff_256x240.png");\n}\n.ui-state-default .ui-icon {\n\tbackground-image: url("images/ui-icons_ef8c08_256x240.png");\n}\n.ui-state-hover .ui-icon,\n.ui-state-focus .ui-icon {\n\tbackground-image: url("images/ui-icons_ef8c08_256x240.png");\n}\n.ui-state-active .ui-icon {\n\tbackground-image: url("images/ui-icons_ef8c08_256x240.png");\n}\n.ui-state-highlight .ui-icon {\n\tbackground-image: url("images/ui-icons_228ef1_256x240.png");\n}\n.ui-state-error .ui-icon,\n.ui-state-error-text .ui-icon {\n\tbackground-image: url("images/ui-icons_ffd27a_256x240.png");\n}\n\n/* positioning */\n.ui-icon-blank { background-position: 16px 16px; }\n.ui-icon-carat-1-n { background-position: 0 0; }\n.ui-icon-carat-1-ne { background-position: -16px 0; }\n.ui-icon-carat-1-e { background-position: -32px 0; }\n.ui-icon-carat-1-se { background-position: -48px 0; }\n.ui-icon-carat-1-s { background-position: -64px 0; }\n.ui-icon-carat-1-sw { background-position: -80px 0; }\n.ui-icon-carat-1-w { background-position: -96px 0; }\n.ui-icon-carat-1-nw { background-position: -112px 0; }\n.ui-icon-carat-2-n-s { background-position: -128px 0; }\n.ui-icon-carat-2-e-w { background-position: -144px 0; }\n.ui-icon-triangle-1-n { background-position: 0 -16px; }\n.ui-icon-triangle-1-ne { background-position: -16px -16px; }\n.ui-icon-triangle-1-e { background-position: -32px -16px; }\n.ui-icon-triangle-1-se { background-position: -48px -16px; }\n.ui-icon-triangle-1-s { background-position: -64px -16px; }\n.ui-icon-triangle-1-sw { background-position: -80px -16px; }\n.ui-icon-triangle-1-w { background-position: -96px -16px; }\n.ui-icon-triangle-1-nw { background-position: -112px -16px; }\n.ui-icon-triangle-2-n-s { background-position: -128px -16px; }\n.ui-icon-triangle-2-e-w { background-position: -144px -16px; }\n.ui-icon-arrow-1-n { background-position: 0 -32px; }\n.ui-icon-arrow-1-ne { background-position: -16px -32px; }\n.ui-icon-arrow-1-e { background-position: -32px -32px; }\n.ui-icon-arrow-1-se { background-position: -48px -32px; }\n.ui-icon-arrow-1-s { background-position: -64px -32px; }\n.ui-icon-arrow-1-sw { background-position: -80px -32px; }\n.ui-icon-arrow-1-w { background-position: -96px -32px; }\n.ui-icon-arrow-1-nw { background-position: -112px -32px; }\n.ui-icon-arrow-2-n-s { background-position: -128px -32px; }\n.ui-icon-arrow-2-ne-sw { background-position: -144px -32px; }\n.ui-icon-arrow-2-e-w { background-position: -160px -32px; }\n.ui-icon-arrow-2-se-nw { background-position: -176px -32px; }\n.ui-icon-arrowstop-1-n { background-position: -192px -32px; }\n.ui-icon-arrowstop-1-e { background-position: -208px -32px; }\n.ui-icon-arrowstop-1-s { background-position: -224px -32px; }\n.ui-icon-arrowstop-1-w { background-position: -240px -32px; }\n.ui-icon-arrowthick-1-n { background-position: 0 -48px; }\n.ui-icon-arrowthick-1-ne { background-position: -16px -48px; }\n.ui-icon-arrowthick-1-e { background-position: -32px -48px; }\n.ui-icon-arrowthick-1-se { background-position: -48px -48px; }\n.ui-icon-arrowthick-1-s { background-position: -64px -48px; }\n.ui-icon-arrowthick-1-sw { background-position: -80px -48px; }\n.ui-icon-arrowthick-1-w { background-position: -96px -48px; }\n.ui-icon-arrowthick-1-nw { background-position: -112px -48px; }\n.ui-icon-arrowthick-2-n-s { background-position: -128px -48px; }\n.ui-icon-arrowthick-2-ne-sw { background-position: -144px -48px; }\n.ui-icon-arrowthick-2-e-w { background-position: -160px -48px; }\n.ui-icon-arrowthick-2-se-nw { background-position: -176px -48px; }\n.ui-icon-arrowthickstop-1-n { background-position: -192px -48px; }\n.ui-icon-arrowthickstop-1-e { background-position: -208px -48px; }\n.ui-icon-arrowthickstop-1-s { background-position: -224px -48px; }\n.ui-icon-arrowthickstop-1-w { background-position: -240px -48px; }\n.ui-icon-arrowreturnthick-1-w { background-position: 0 -64px; }\n.ui-icon-arrowreturnthick-1-n { background-position: -16px -64px; }\n.ui-icon-arrowreturnthick-1-e { background-position: -32px -64px; }\n.ui-icon-arrowreturnthick-1-s { background-position: -48px -64px; }\n.ui-icon-arrowreturn-1-w { background-position: -64px -64px; }\n.ui-icon-arrowreturn-1-n { background-position: -80px -64px; }\n.ui-icon-arrowreturn-1-e { background-position: -96px -64px; }\n.ui-icon-arrowreturn-1-s { background-position: -112px -64px; }\n.ui-icon-arrowrefresh-1-w { background-position: -128px -64px; }\n.ui-icon-arrowrefresh-1-n { background-position: -144px -64px; }\n.ui-icon-arrowrefresh-1-e { background-position: -160px -64px; }\n.ui-icon-arrowrefresh-1-s { background-position: -176px -64px; }\n.ui-icon-arrow-4 { background-position: 0 -80px; }\n.ui-icon-arrow-4-diag { background-position: -16px -80px; }\n.ui-icon-extlink { background-position: -32px -80px; }\n.ui-icon-newwin { background-position: -48px -80px; }\n.ui-icon-refresh { background-position: -64px -80px; }\n.ui-icon-shuffle { background-position: -80px -80px; }\n.ui-icon-transfer-e-w { background-position: -96px -80px; }\n.ui-icon-transferthick-e-w { background-position: -112px -80px; }\n.ui-icon-folder-collapsed { background-position: 0 -96px; }\n.ui-icon-folder-open { background-position: -16px -96px; }\n.ui-icon-document { background-position: -32px -96px; }\n.ui-icon-document-b { background-position: -48px -96px; }\n.ui-icon-note { background-position: -64px -96px; }\n.ui-icon-mail-closed { background-position: -80px -96px; }\n.ui-icon-mail-open { background-position: -96px -96px; }\n.ui-icon-suitcase { background-position: -112px -96px; }\n.ui-icon-comment { background-position: -128px -96px; }\n.ui-icon-person { background-position: -144px -96px; }\n.ui-icon-print { background-position: -160px -96px; }\n.ui-icon-trash { background-position: -176px -96px; }\n.ui-icon-locked { background-position: -192px -96px; }\n.ui-icon-unlocked { background-position: -208px -96px; }\n.ui-icon-bookmark { background-position: -224px -96px; }\n.ui-icon-tag { background-position: -240px -96px; }\n.ui-icon-home { background-position: 0 -112px; }\n.ui-icon-flag { background-position: -16px -112px; }\n.ui-icon-calendar { background-position: -32px -112px; }\n.ui-icon-cart { background-position: -48px -112px; }\n.ui-icon-pencil { background-position: -64px -112px; }\n.ui-icon-clock { background-position: -80px -112px; }\n.ui-icon-disk { background-position: -96px -112px; }\n.ui-icon-calculator { background-position: -112px -112px; }\n.ui-icon-zoomin { background-position: -128px -112px; }\n.ui-icon-zoomout { background-position: -144px -112px; }\n.ui-icon-search { background-position: -160px -112px; }\n.ui-icon-wrench { background-position: -176px -112px; }\n.ui-icon-gear { background-position: -192px -112px; }\n.ui-icon-heart { background-position: -208px -112px; }\n.ui-icon-star { background-position: -224px -112px; }\n.ui-icon-link { background-position: -240px -112px; }\n.ui-icon-cancel { background-position: 0 -128px; }\n.ui-icon-plus { background-position: -16px -128px; }\n.ui-icon-plusthick { background-position: -32px -128px; }\n.ui-icon-minus { background-position: -48px -128px; }\n.ui-icon-minusthick { background-position: -64px -128px; }\n.ui-icon-close { background-position: -80px -128px; }\n.ui-icon-closethick { background-position: -96px -128px; }\n.ui-icon-key { background-position: -112px -128px; }\n.ui-icon-lightbulb { background-position: -128px -128px; }\n.ui-icon-scissors { background-position: -144px -128px; }\n.ui-icon-clipboard { background-position: -160px -128px; }\n.ui-icon-copy { background-position: -176px -128px; }\n.ui-icon-contact { background-position: -192px -128px; }\n.ui-icon-image { background-position: -208px -128px; }\n.ui-icon-video { background-position: -224px -128px; }\n.ui-icon-script { background-position: -240px -128px; }\n.ui-icon-alert { background-position: 0 -144px; }\n.ui-icon-info { background-position: -16px -144px; }\n.ui-icon-notice { background-position: -32px -144px; }\n.ui-icon-help { background-position: -48px -144px; }\n.ui-icon-check { background-position: -64px -144px; }\n.ui-icon-bullet { background-position: -80px -144px; }\n.ui-icon-radio-on { background-position: -96px -144px; }\n.ui-icon-radio-off { background-position: -112px -144px; }\n.ui-icon-pin-w { background-position: -128px -144px; }\n.ui-icon-pin-s { background-position: -144px -144px; }\n.ui-icon-play { background-position: 0 -160px; }\n.ui-icon-pause { background-position: -16px -160px; }\n.ui-icon-seek-next { background-position: -32px -160px; }\n.ui-icon-seek-prev { background-position: -48px -160px; }\n.ui-icon-seek-end { background-position: -64px -160px; }\n.ui-icon-seek-start { background-position: -80px -160px; }\n/* ui-icon-seek-first is deprecated, use ui-icon-seek-start instead */\n.ui-icon-seek-first { background-position: -80px -160px; }\n.ui-icon-stop { background-position: -96px -160px; }\n.ui-icon-eject { background-position: -112px -160px; }\n.ui-icon-volume-off { background-position: -128px -160px; }\n.ui-icon-volume-on { background-position: -144px -160px; }\n.ui-icon-power { background-position: 0 -176px; }\n.ui-icon-signal-diag { background-position: -16px -176px; }\n.ui-icon-signal { background-position: -32px -176px; }\n.ui-icon-battery-0 { background-position: -48px -176px; }\n.ui-icon-battery-1 { background-position: -64px -176px; }\n.ui-icon-battery-2 { background-position: -80px -176px; }\n.ui-icon-battery-3 { background-position: -96px -176px; }\n.ui-icon-circle-plus { background-position: 0 -192px; }\n.ui-icon-circle-minus { background-position: -16px -192px; }\n.ui-icon-circle-close { background-position: -32px -192px; }\n.ui-icon-circle-triangle-e { background-position: -48px -192px; }\n.ui-icon-circle-triangle-s { background-position: -64px -192px; }\n.ui-icon-circle-triangle-w { background-position: -80px -192px; }\n.ui-icon-circle-triangle-n { background-position: -96px -192px; }\n.ui-icon-circle-arrow-e { background-position: -112px -192px; }\n.ui-icon-circle-arrow-s { background-position: -128px -192px; }\n.ui-icon-circle-arrow-w { background-position: -144px -192px; }\n.ui-icon-circle-arrow-n { background-position: -160px -192px; }\n.ui-icon-circle-zoomin { background-position: -176px -192px; }\n.ui-icon-circle-zoomout { background-position: -192px -192px; }\n.ui-icon-circle-check { background-position: -208px -192px; }\n.ui-icon-circlesmall-plus { background-position: 0 -208px; }\n.ui-icon-circlesmall-minus { background-position: -16px -208px; }\n.ui-icon-circlesmall-close { background-position: -32px -208px; }\n.ui-icon-squaresmall-plus { background-position: -48px -208px; }\n.ui-icon-squaresmall-minus { background-position: -64px -208px; }\n.ui-icon-squaresmall-close { background-position: -80px -208px; }\n.ui-icon-grip-dotted-vertical { background-position: 0 -224px; }\n.ui-icon-grip-dotted-horizontal { background-position: -16px -224px; }\n.ui-icon-grip-solid-vertical { background-position: -32px -224px; }\n.ui-icon-grip-solid-horizontal { background-position: -48px -224px; }\n.ui-icon-gripsmall-diagonal-se { background-position: -64px -224px; }\n.ui-icon-grip-diagonal-se { background-position: -80px -224px; }\n\n\n/* Misc visuals\n----------------------------------*/\n\n/* Corner radius */\n.ui-corner-all,\n.ui-corner-top,\n.ui-corner-left,\n.ui-corner-tl {\n\tborder-top-left-radius: 4px;\n}\n.ui-corner-all,\n.ui-corner-top,\n.ui-corner-right,\n.ui-corner-tr {\n\tborder-top-right-radius: 4px;\n}\n.ui-corner-all,\n.ui-corner-bottom,\n.ui-corner-left,\n.ui-corner-bl {\n\tborder-bottom-left-radius: 4px;\n}\n.ui-corner-all,\n.ui-corner-bottom,\n.ui-corner-right,\n.ui-corner-br {\n\tborder-bottom-right-radius: 4px;\n}\n\n/* Overlays */\n.ui-widget-overlay {\n\tbackground: #666666 url("images/ui-bg_diagonals-thick_20_666666_40x40.png") 50% 50% repeat;\n\topacity: .5;\n\tfilter: Alpha(Opacity=50); /* support: IE8 */\n}\n.ui-widget-shadow {\n\tmargin: -5px 0 0 -5px;\n\tpadding: 5px;\n\tbackground: #000000 url("images/ui-bg_flat_10_000000_40x100.png") 50% 50% repeat-x;\n\topacity: .2;\n\tfilter: Alpha(Opacity=20); /* support: IE8 */\n\tborder-radius: 5px;\n}\n',""])},1441:function(e,t,i){var n=i(12),i=n.object();n.extendNamedProperties(i),i.properties.body={type:"string",title:"Content",format:"markdown"},i.properties.i18n={type:"object",title:"i18n",format:"i18n",props:["name","body"]},n.extendBasicProperties(i,"article"),n.extendSearchableProperties(i),n.extendVersionedProperties(i,"article"),n.extendTranslationCoverageProperties(i),n.extendPatchableProperties(i),n.extendAlgoliaProperties(i),e.exports=i},1442:function(e,t,i){var n=i(12),i=n.object({required:["original","majorVersion"],links:[{rel:"db",href:"/db/level/{(original)}/version/{(majorVersion)}"}]},{original:n.objectId(),majorVersion:{type:"integer",minimum:0}}),n={type:"object",properties:{sessionID:n.objectId(),level:i,levelSlug:{type:"string"},userID:n.objectId(),log:{type:"string"},created:n.date()}};e.exports=n},1443:function(e,t,i){var n=i(12),o=n.object({required:["original","majorVersion"]},{original:n.objectId({}),majorVersion:{type:"integer",minimum:0}}),i=n.object({title:"Feedback",description:"Feedback on a level."});_.extend(i.properties,{creatorName:{type:"string"},levelName:{type:"string"},levelID:{type:"string"},creator:n.objectId({links:[{rel:"extra",href:"/db/user/{($)}"}]}),created:n.date({title:"Created",readOnly:!0}),level:o,rating:{type:"number",minimum:1,maximum:5},review:{type:"string"}}),n.extendBasicProperties(i,"level.feedback"),e.exports=i},1444:function(e,t,i){i=i(12);e.exports=e={type:"object",additionalProperties:!1,default:{simulationThroughputRatio:1,sessionSaveDelay:{registered:{min:4,max:10},anonymous:{min:5,max:15}}},properties:{simulationThroughputRatio:{name:"Simulation Throughput Ratio",description:"0-1 fraction of requests for a match to simulate that should be granted.",type:"number",minimum:0,maximum:1},sessionSaveDelay:{name:"Session Save Delay",description:"How often we save level sessions after code changes--min and max wait in seconds.",type:"object",properties:{registered:{description:"How often to save for registered players.",type:"object",additionalProperties:!1,requiredProperties:["min","max"],properties:{min:{type:"number",minimum:1,exclusiveMinimum:!0,format:"seconds"},max:{type:"number",minimum:5,exclusiveMinimum:!0,format:"seconds"}}},anonymous:{description:"How often to save for anonymous players.",type:"object",additionalProperties:!1,requiredProperties:["min","max"],properties:{min:{type:"number",minimum:1,exclusiveMinimum:!0,format:"seconds"},max:{type:"number",minimum:5,exclusiveMinimum:!0,format:"seconds"}}}}},currentTournament:i.array({description:"The arrays of the current active tournament, if any."},i.object({},{level:"string",courseInstanceID:i.objectId(),startAt:"integer",endAt:"integer",name:"string"})),tournamentOnlyLevels:i.array({description:"levels only accessible during tournament with specific course instance id"},"string")}},i.extendBasicProperties(e,"Mandate")},1445:function(e,t,i){var n=i(12),i=["level","thang_type"],i=n.object({title:"Purchase",required:["purchaser","recipient","purchased"]},{purchaser:n.objectId({links:[{rel:"extra",href:"/db/user/{($)}"}]}),recipient:n.objectId({links:[{rel:"extra",href:"/db/user/{($)}"}]}),purchased:n.object({title:"Target",required:["collection","original"]},{collection:{enum:i},original:n.objectId({title:"Target Original"})}),created:n.date({title:"Created",readOnly:!0}),archived:n.date({description:"Marks this record for automatic online archiving to cold storage by our cloud database."})});n.extendBasicProperties(i,"purchase"),e.exports=i},1446:function(e,t,i){var n=i(12),i=n.object({title:"User Code Problem",description:"Data for a problem in user code."});_.extend(i.properties,{creator:n.objectId({links:[{rel:"extra",href:"/db/user/{($)}"}]}),created:n.date({title:"Created",readOnly:!0}),code:{type:"string"},codeSnippet:{type:"string"},errHint:{type:"string"},errId:{type:"string"},errLevel:{type:"string"},errMessage:{type:"string"},errMessageNoLineInfo:{type:"string"},errRange:{type:"array"},errType:{type:"string"},language:{type:"string"},levelID:{type:"string"}}),n.extendBasicProperties(i,"user.code.problem"),e.exports=i},1447:function(e,t,i){var n=i(12),i=n.object({title:"UserPollsRecord"});_.extend(i.properties,{user:n.stringID({links:[{rel:"extra",href:"/db/user/{($)}"}]}),polls:{type:"object",additionalProperties:n.shortString({pattern:"^[a-z0-9-]+$"})},rewards:{type:"object",additionalProperties:n.object({},{random:{type:"number",minimum:0,maximum:1},level:{type:"integer",minimum:1}})},level:{type:"integer",minimum:1,description:"The player level when last saved."},changed:n.date({title:"Changed",readOnly:!0})}),n.extendBasicProperties(i,"user-polls-record"),e.exports=i},1448:function(e,t,i){var y,n,o,s,r,a=(y=String.fromCharCode,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",s={},r={compressToBase64:function(e){if(null==e)return"";var t=r._compress(e,6,function(e){return n.charAt(e)});switch(t.length%4){default:case 0:return t;case 1:return t+"===";case 2:return t+"==";case 3:return t+"="}},decompressFromBase64:function(t){return null==t?"":""==t?null:r._decompress(t.length,32,function(e){return l(n,t.charAt(e))})},compressToUTF16:function(e){return null==e?"":r._compress(e,15,function(e){return y(e+32)})+" "},decompressFromUTF16:function(t){return null==t?"":""==t?null:r._decompress(t.length,16384,function(e){return t.charCodeAt(e)-32})},compressToUint8Array:function(e){for(var t=r.compress(e),i=new Uint8Array(2*t.length),n=0,o=t.length;n<o;n++){var s=t.charCodeAt(n);i[2*n]=s>>>8,i[2*n+1]=s%256}return i},decompressFromUint8Array:function(e){if(null==e)return r.decompress(e);for(var t=new Array(e.length/2),i=0,n=t.length;i<n;i++)t[i]=256*e[2*i]+e[2*i+1];var o=[];return t.forEach(function(e){o.push(y(e))}),r.decompress(o.join(""))},compressToEncodedURIComponent:function(e){return null==e?"":r._compress(e,6,function(e){return o.charAt(e)})},decompressFromEncodedURIComponent:function(t){return null==t?"":""==t?null:(t=t.replace(/ /g,"+"),r._decompress(t.length,32,function(e){return l(o,t.charAt(e))}))},compress:function(e){return r._compress(e,16,function(e){return y(e)})},_compress:function(e,t,i){if(null==e)return"";for(var n,o,s,r,a={},l={},c="",h=2,u=3,p=2,d=[],m=0,f=0,g=0;g<e.length;g+=1)if(s=e.charAt(g),Object.prototype.hasOwnProperty.call(a,s)||(a[s]=u++,l[s]=!0),r=c+s,Object.prototype.hasOwnProperty.call(a,r))c=r;else{if(Object.prototype.hasOwnProperty.call(l,c)){if(c.charCodeAt(0)<256){for(n=0;n<p;n++)m<<=1,f==t-1?(f=0,d.push(i(m)),m=0):f++;for(o=c.charCodeAt(0),n=0;n<8;n++)m=m<<1|1&o,f==t-1?(f=0,d.push(i(m)),m=0):f++,o>>=1}else{for(o=1,n=0;n<p;n++)m=m<<1|o,f==t-1?(f=0,d.push(i(m)),m=0):f++,o=0;for(o=c.charCodeAt(0),n=0;n<16;n++)m=m<<1|1&o,f==t-1?(f=0,d.push(i(m)),m=0):f++,o>>=1}0==--h&&(h=Math.pow(2,p),p++),delete l[c]}else for(o=a[c],n=0;n<p;n++)m=m<<1|1&o,f==t-1?(f=0,d.push(i(m)),m=0):f++,o>>=1;0==--h&&(h=Math.pow(2,p),p++),a[r]=u++,c=String(s)}if(""!==c){if(Object.prototype.hasOwnProperty.call(l,c)){if(c.charCodeAt(0)<256){for(n=0;n<p;n++)m<<=1,f==t-1?(f=0,d.push(i(m)),m=0):f++;for(o=c.charCodeAt(0),n=0;n<8;n++)m=m<<1|1&o,f==t-1?(f=0,d.push(i(m)),m=0):f++,o>>=1}else{for(o=1,n=0;n<p;n++)m=m<<1|o,f==t-1?(f=0,d.push(i(m)),m=0):f++,o=0;for(o=c.charCodeAt(0),n=0;n<16;n++)m=m<<1|1&o,f==t-1?(f=0,d.push(i(m)),m=0):f++,o>>=1}0==--h&&(h=Math.pow(2,p),p++),delete l[c]}else for(o=a[c],n=0;n<p;n++)m=m<<1|1&o,f==t-1?(f=0,d.push(i(m)),m=0):f++,o>>=1;0==--h&&(h=Math.pow(2,p),p++)}for(o=2,n=0;n<p;n++)m=m<<1|1&o,f==t-1?(f=0,d.push(i(m)),m=0):f++,o>>=1;for(;;){if(m<<=1,f==t-1){d.push(i(m));break}f++}return d.join("")},decompress:function(t){return null==t?"":""==t?null:r._decompress(t.length,32768,function(e){return t.charCodeAt(e)})},_decompress:function(e,t,i){for(var n,o,s,r,a,l,c=[],h=4,u=4,p=3,d="",m=[],f={val:i(0),position:t,index:1},g=0;g<3;g+=1)c[g]=g;for(o=0,r=Math.pow(2,2),a=1;a!=r;)s=f.val&f.position,f.position>>=1,0==f.position&&(f.position=t,f.val=i(f.index++)),o|=(0<s?1:0)*a,a<<=1;switch(o){case 0:for(o=0,r=Math.pow(2,8),a=1;a!=r;)s=f.val&f.position,f.position>>=1,0==f.position&&(f.position=t,f.val=i(f.index++)),o|=(0<s?1:0)*a,a<<=1;l=y(o);break;case 1:for(o=0,r=Math.pow(2,16),a=1;a!=r;)s=f.val&f.position,f.position>>=1,0==f.position&&(f.position=t,f.val=i(f.index++)),o|=(0<s?1:0)*a,a<<=1;l=y(o);break;case 2:return""}for(n=c[3]=l,m.push(l);;){if(f.index>e)return"";for(o=0,r=Math.pow(2,p),a=1;a!=r;)s=f.val&f.position,f.position>>=1,0==f.position&&(f.position=t,f.val=i(f.index++)),o|=(0<s?1:0)*a,a<<=1;switch(l=o){case 0:for(o=0,r=Math.pow(2,8),a=1;a!=r;)s=f.val&f.position,f.position>>=1,0==f.position&&(f.position=t,f.val=i(f.index++)),o|=(0<s?1:0)*a,a<<=1;c[u++]=y(o),l=u-1,h--;break;case 1:for(o=0,r=Math.pow(2,16),a=1;a!=r;)s=f.val&f.position,f.position>>=1,0==f.position&&(f.position=t,f.val=i(f.index++)),o|=(0<s?1:0)*a,a<<=1;c[u++]=y(o),l=u-1,h--;break;case 2:return m.join("")}if(0==h&&(h=Math.pow(2,p),p++),c[l])d=c[l];else{if(l!==u)return null;d=n+n.charAt(0)}m.push(d),c[u++]=n+d.charAt(0),n=d,0==--h&&(h=Math.pow(2,p),p++)}}});function l(e,t){if(!s[e]){s[e]={};for(var i=0;i<e.length;i++)s[e][e.charAt(i)]=i}return s[e][t]}void 0===(t=function(){return a}.call(t,i,t,e))||(e.exports=t)},1450:function(M,e,D){!function(l,c){var i,n,e,t,o,s,r,a,h,u,p,d,m,f,g,y,v,b,w,k,x,S=function(e,t){return function(){return e.apply(t,arguments)}},C={}.hasOwnProperty,T=[].indexOf||function(e){for(var t=0,i=this.length;t<i;t++)if(t in this&&this[t]===e)return t;return-1};function L(e,t,i,n){var o;this.world=e,this.normalCanvas=t,this.webGLCanvas=i,this.onResize=S(this.onResize,this),this.onKeyEvent=S(this.onKeyEvent,this),this.onMouseWheel=S(this.onMouseWheel,this),this.onMouseUp=S(this.onMouseUp,this),this.onWorldMouseMove=S(this.onWorldMouseMove,this),this.onSpriteMouseDown=S(this.onSpriteMouseDown,this),this.onMouseDown=S(this.onMouseDown,this),this.onMouseMove=S(this.onMouseMove,this),this.onFramesScrubbed=S(this.onFramesScrubbed,this),this.tick=S(this.tick,this),L.__super__.constructor.call(this),l(window).on("keydown",this.onKeyEvent),l(window).on("keyup",this.onKeyEvent),this.normalLayers=[],this.options=_.clone(this.defaults),n&&(this.options=_.extend(this.options,n)),this.handleEvents=null==(n=this.options.handleEvents)||n,this.zoomToHero="game-dev"!==this.options.levelType,this.gameUIState=this.options.gameUIState||new u({canDragCamera:!0}),this.realTimeInputEvents=this.gameUIState.get("realTimeInputEvents"),this.listenTo(this.gameUIState,"sprite:mouse-down",this.onSpriteMouseDown),this.world.trackMouseMove&&this.listenTo(this.gameUIState,"surface:stage-mouse-move",this.onWorldMouseMove),this.onResize=_.debounce(this.onResize,x),this.initEasel(),this.initAudio(),l(window).on("resize",this.onResize),this.world.ended&&_.defer((o=this,function(){return o.setWorld(o.world)}))}e=D(45),b=D(1586),h=D(1587),i=D(1390),k=D(44).me,n=D(1407),D(1588),d=D(1431),m=D(1589),a=D(1590),s=D(1591),g=D(1592),r=D(1593),t=D(1594),o=D(1595),p=D(1551),y=D(1600),v=D(1601),f=D(1479),u=D(1381),w=D(1373),D(1602),x=1,M.exports=(function(e,t){for(var i in t)C.call(t,i)&&(e[i]=t[i]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(L,e),L.prototype.stage=null,L.prototype.normalLayers=null,L.prototype.surfaceLayer=null,L.prototype.surfaceTextLayer=null,L.prototype.screenLayer=null,L.prototype.gridLayer=null,L.prototype.lankBoss=null,L.prototype.debugDisplay=null,L.prototype.currentFrame=0,L.prototype.lastFrame=null,L.prototype.totalFramesDrawn=0,L.prototype.playing=!1,L.prototype.dead=!1,L.prototype.imagesLoaded=!1,L.prototype.worldLoaded=!1,L.prototype.scrubbing=!1,L.prototype.debug=!1,L.prototype.defaults={paths:!0,grid:!1,navigateToSelection:!0,choosing:!1,coords:null,showInvisible:!1,frameRate:30,levelType:"hero"},L.prototype.subscriptions={"level:disable-controls":"onDisableControls","level:enable-controls":"onEnableControls","level:set-playing":"onSetPlaying","level:set-debug":"onSetDebug","level:toggle-debug":"onToggleDebug","level:toggle-pathfinding":"onTogglePathFinding","level:set-time":"onSetTime","camera:set-camera":"onSetCamera","level:restarted":"onLevelRestarted","god:new-world-created":"onNewWorld","god:streaming-world-updated":"onNewWorld","tome:cast-spells":"onCastSpells","level:set-letterbox":"onSetLetterbox","application:idle-changed":"onIdleChanged","camera:zoom-updated":"onZoomUpdated","playback:real-time-playback-started":"onRealTimePlaybackStarted","playback:real-time-playback-ended":"onRealTimePlaybackEnded","playback:cinematic-playback-started":"onCinematicPlaybackStarted","playback:cinematic-playback-ended":"onCinematicPlaybackEnded","level:flag-color-selected":"onFlagColorSelected","tome:manual-cast":"onManualCast","playback:stop-real-time-playback":"onStopRealTimePlayback"},L.prototype.shortcuts={"ctrl+\\, +\\":"onToggleDebug","ctrl+o, +o":"onTogglePathFinding"},L.prototype.initEasel=function(){var e,o,t;return this.normalStage=new w.Stage(this.normalCanvas[0]),this.webGLStage=new w.StageGL(this.webGLCanvas[0]),this.normalStage.nextStage=this.webGLStage,this.camera=new n(this.webGLCanvas,{gameUIState:this.gameUIState,handleEvents:this.handleEvents}),this.camera.dragDisabled=this.world.cameraDragDisabled,this.options.choosing||(i.camera=this.camera),this.normalLayers.push(this.surfaceTextLayer=new d({name:"Surface Text",layerPriority:1,transform:d.TRANSFORM_SURFACE_TEXT,camera:this.camera})),this.normalLayers.push(this.gridLayer=new d({name:"Grid",layerPriority:2,transform:d.TRANSFORM_SURFACE,camera:this.camera})),this.normalLayers.push(this.screenLayer=new d({name:"Screen",layerPriority:3,transform:d.TRANSFORM_SCREEN,camera:this.camera})),(t=this.normalStage).addChild.apply(t,function(){for(var e=this.normalLayers,t=[],i=0,n=e.length;i<n;i++)o=e[i],t.push(o.container);return t}.call(this)),e=parseInt(this.normalCanvas.attr("width"),10),t=parseInt(this.normalCanvas.attr("height"),10),this.screenLayer.addChild(new m({canvasWidth:e,canvasHeight:t})),this.lankBoss=new p({camera:this.camera,webGLStage:this.webGLStage,surfaceTextLayer:this.surfaceTextLayer,world:this.world,thangTypes:this.options.thangTypes,choosing:this.options.choosing,navigateToSelection:this.options.navigateToSelection,showInvisible:this.options.showInvisible,playerNames:"course-ladder"===(t=this.options.levelType)||"ladder"===t?this.options.playerNames:null,gameUIState:this.gameUIState,handleEvents:this.handleEvents}),this.countdownScreen=new s({camera:this.camera,layer:this.screenLayer,showsCountdown:this.world.showsCountdown}),"ladder"!==(t=this.options.levelType)&&"hero-ladder"!==t&&"course-ladder"!==t||(this.playbackOverScreen=new g({camera:this.camera,layer:this.screenLayer,playerNames:this.options.playerNames}),this.normalStage.addChildAt(this.playbackOverScreen.dimLayer,0)),this.initCoordinates(),this.webGLStage.enableMouseOver(10),this.webGLStage.addEventListener("stagemousemove",this.onMouseMove),this.webGLStage.addEventListener("stagemousedown",this.onMouseDown),this.webGLStage.addEventListener("stagemouseup",this.onMouseUp),this.webGLCanvas.on("mousewheel",this.onMouseWheel),this.options.choosing&&this.hookUpChooseControls(),w.Ticker.timingMode=w.Ticker.RAF_SYNCHED,w.Ticker.framerate=this.options.frameRate,this.onResize()},L.prototype.initCoordinates=function(){if(null==this.coordinateGrid&&(this.coordinateGrid=new o({camera:this.camera,layer:this.gridLayer,textLayer:this.surfaceTextLayer},this.world.size())),(this.world.showGrid||this.options.grid)&&this.coordinateGrid.showGrid(),this.showCoordinates=null!=this.options.coords?this.options.coords:this.world.showCoordinates,this.showCoordinates)return null!=this.coordinateDisplay?this.coordinateDisplay:this.coordinateDisplay=new t({camera:this.camera,layer:this.surfaceTextLayer})},L.prototype.hookUpChooseControls=function(){var e={stage:this.webGLStage,surfaceLayer:this.surfaceTextLayer,camera:this.camera,restrictRatio:"ratio-region"===this.options.choosing},t="point"===this.options.choosing?y:v;return this.chooser=new t(e)},L.prototype.initAudio=function(){return this.musicPlayer=new f},L.prototype.setWorld=function(e){return this.world=e,this.worldLoaded=!0,this.lankBoss.world=this.world,this.options.choosing||this.restoreWorldState(),this.showLevel(),this.loaded&&this.updateState(!0),this.onFrameChanged()},L.prototype.showLevel=function(){if(!this.destroyed&&!this.loaded)return this.loaded=!0,this.lankBoss.createMarks(),this.updateState(!0),this.drawCurrentFrame(),w.Ticker.addEventListener("tick",this.tick),Backbone.Mediator.publish("level:started",{})},L.prototype.tick=function(e){for(var t,i,n,o=this.currentFrame,s=Math.floor(o),r=this.world.frames.length-1;;){if(h.tick(),(t=this.playing&&this.currentFrame<r||this.totalFramesDrawn<2)&&this.playing&&(i=this.world.frameRate/this.options.frameRate,this.fastForwardingToFrame&&this.currentFrame<this.fastForwardingToFrame-i?i=Math.min(this.currentFrame+i*this.fastForwardingSpeed,this.fastForwardingToFrame)-this.currentFrame:this.fastForwardingToFrame&&(this.fastForwardingToFrame=this.fastForwardingSpeed=null),this.currentFrame+=i,this.currentFrame=Math.min(this.currentFrame,r)),i=Math.floor(this.currentFrame),!h.drop()){(n=i!==s)&&(this.restoreWorldState(),s=i);break}0}if(t&&!n&&this.restoreWorldState(),this.updateState(this.currentFrame!==o),this.drawCurrentFrame(e),this.onFrameChanged(),Backbone.Mediator.publish("surface:ticked",{dt:1/this.options.frameRate}),e=this.webGLStage.mouseInBounds,this.mouseInBounds!==e)return Backbone.Mediator.publish("surface:mouse-"+(e?"over":"out"),{}),this.mouseInBounds=e,this.mouseIsDown=!1},L.prototype.restoreWorldState=function(){var e,t,i;if(this.world.synchronous)parseInt(this.currentFrame)!==parseInt(this.lastFrame)&&this.lankBoss.updateSounds();else if(t=this.world.getFrame(this.getCurrentFrame()))return t.restoreState(),this.restoreScores(t),.01<(e=Math.max(0,Math.min(this.currentFrame,this.world.frames.length-1)))-Math.floor(e)&&Math.ceil(e)<this.world.frames.length-1&&1<(i=Math.ceil(e))&&this.world.frames[i].restorePartialState(e%1),parseInt(this.currentFrame)===parseInt(this.lastFrame)&&t.clearEvents(),parseInt(this.currentFrame)!==parseInt(this.lastFrame)?this.lankBoss.updateSounds():void 0},L.prototype.updateState=function(e){return this.handleEvents&&this.zoomToHero&&this.playing&&this.currentFrame<this.world.frames.length-1&&this.heroLank&&!this.mouseIsDown&&this.camera.newTarget!==this.heroLank.sprite&&this.camera.target!==this.heroLank.sprite&&this.camera.zoomTo(this.heroLank.sprite,this.camera.zoom,750),this.lankBoss.update(e),this.camera.updateZoom(),null!=(e=this.dimmer)?e.setSprites(this.lankBoss.lanks):void 0},L.prototype.drawCurrentFrame=function(e){return++this.totalFramesDrawn,this.normalStage.update(e),this.webGLStage.update(e)},L.prototype.restoreScores=function(e){var t,i,n,o,s,r,a;if(e.scores&&this.options.level){for(a=[],t=0,i=(o=null!=(n=this.options.level.get("scoreTypes"))?n:[]).length;t<i;t++)null!=(s="code-length"===(r=(r=o[t]).type?r.type:r)?null!=(s=this.world.scores)?s["code-length"]:void 0:e.scores[r])&&a.push({type:r,score:s});return Backbone.Mediator.publish("level:scores-updated",{scores:a})}},L.prototype.setProgress=function(e,t){var i,n;if(null==t&&(t=500),e=Math.max(Math.min(e,1),0),this.fastForwardingToFrame=null,this.scrubbing=!0,i=function(){return n.scrubbingTo=null,n.scrubbing=!1,n.scrubbingPlaybackSpeed=null},null!=(n=this).scrubbingTo&&(w.Tween.removeTweens(this),this.currentFrame=this.scrubbingTo),this.scrubbingTo=Math.round(e*(this.world.frames.length-1)),this.scrubbingTo=Math.max(this.scrubbingTo,1),this.scrubbingTo=Math.min(this.scrubbingTo,this.world.frames.length-1),this.scrubbingPlaybackSpeed=Math.sqrt(Math.abs(this.scrubbingTo-this.currentFrame)*this.world.dt/(t||.5)),t?w.Tween.get(this).to({currentFrame:this.scrubbingTo},t,w.Ease.sineInOut).call(i).addEventListener("change",this.onFramesScrubbed):(this.currentFrame=this.scrubbingTo,this.onFramesScrubbed(),i()),this.loaded)return this.updateState(!0),this.onFrameChanged()},L.prototype.onFramesScrubbed=function(e){var t,i,n,o,s,r,a;if(this.loaded){if(e){for(s=this.currentFrame>this.lastFrame,t=this.currentFrame,r=s?Math.ceil(this.lastFrame):Math.floor(this.lastFrame);!(s&&t<r||!s&&r<t);){for(this.currentFrame=r,this.world.getFrame(this.getCurrentFrame()).restoreState(),a=Math.max(.05,Math.min(1,1/this.scrubbingPlaybackSpeed)),i=0,n=(o=this.lankBoss.lankArray).length;i<n;i++)o[i].playSounds(!1,a);r+=s?1:-1}this.currentFrame=t}return this.restoreWorldState(),this.lankBoss.update(!0),this.onFrameChanged()}},L.prototype.getCurrentFrame=function(){return Math.max(0,Math.min(Math.floor(this.currentFrame),this.world.frames.length-1))},L.prototype.setPaused=function(e){var t;if(this.surfacePauseTimeout&&clearTimeout(this.surfacePauseTimeout),this.surfaceZoomPauseTimeout&&clearTimeout(this.surfaceZoomPauseTimeout),"game-dev"!==this.options.levelType&&this.handleEvents){var i,n=function(){return w.Ticker.framerate=e?1:i.options.frameRate,i.surfacePauseTimeout=null};return(i=this).surfacePauseTimeout=this.surfaceZoomPauseTimeout=null,e?(this.surfacePauseTimeout=_.delay(n,2e3),this.lankBoss.stop(),null!=(t=this.trailmaster)&&t.stop(),null!=(t=this.playbackOverScreen)?t.show():void 0):(n(),this.lankBoss.play(),null!=(n=this.trailmaster)&&n.play(),null!=(n=this.playbackOverScreen)?n.hide():void 0)}},L.prototype.onFrameChanged=function(e){var t;if(this.currentFrame=Math.min(this.currentFrame,this.world.frames.length-1),null!=(t=this.debugDisplay)&&t.updateFrame(this.currentFrame),this.currentFrame!==this.lastFrame||e)return t=this.getProgress(),Backbone.Mediator.publish("surface:frame-changed",{selectedThang:null!=(e=this.lankBoss.selectedLank)?e.thang:void 0,progress:t,frame:this.currentFrame,world:this.world}),!this.world.indefiniteLength&&this.lastFrame<this.world.frames.length&&this.currentFrame>=this.world.totalFrames-1?(this.updatePaths(),this.ended=!0,this.setPaused(!0),Backbone.Mediator.publish("surface:playback-ended",{})):this.currentFrame<this.world.totalFrames&&this.ended&&(this.ended=!1,this.setPaused(!1),Backbone.Mediator.publish("surface:playback-restarted",{})),this.lastFrame=this.currentFrame},L.prototype.getProgress=function(){return this.currentFrame/Math.max(1,this.world.frames.length-1)},L.prototype.onToggleDebug=function(e){return null!=e&&"function"==typeof e.preventDefault&&e.preventDefault(),Backbone.Mediator.publish("level:set-debug",{debug:!this.debug})},L.prototype.onSetDebug=function(e){if(e.debug!==this.debug)return this.debug=e.debug,this.debug&&!this.debugDisplay?this.screenLayer.addChild(this.debugDisplay=new r({canvasWidth:this.camera.canvasWidth,canvasHeight:this.camera.canvasHeight})):void 0},L.prototype.onLevelRestarted=function(e){return this.setProgress(0,0)},L.prototype.onSetCamera=function(e){var t;if(e.thangID){if(!(t=null!=(t=this.lankBoss.lankFor(e.thangID))?t.sprite:void 0))return}else t=e.pos?this.camera.worldToSurface(e.pos):null;if(e.bounds&&this.camera.setBounds(e.bounds),this.handleEvents)return this.camera.zoomTo(t,e.zoom,e.duration)},L.prototype.onZoomUpdated=function(e){var t;return this.ended&&(this.setPaused(!1),this.surfaceZoomPauseTimeout=_.delay((t=this,function(){return t.setPaused(!0)}),3e3)),this.zoomedIn=e.zoom>1.1*e.minZoom,this.updateGrabbability()},L.prototype.updateGrabbability=function(){return this.webGLCanvas.toggleClass("grabbable",this.zoomedIn&&!this.playing&&!this.disabled)},L.prototype.onDisableControls=function(e){if(!e.controls||0<=T.call(e.controls,"surface"))return this.setDisabled(!0),null==this.dimmer&&(this.dimmer=new a({camera:this.camera,layer:this.screenLayer})),this.dimmer.setSprites(this.lankBoss.lanks)},L.prototype.onEnableControls=function(e){if(!e.controls||0<=T.call(e.controls,"surface"))return this.setDisabled(!1)},L.prototype.onSetLetterbox=function(e){return this.setDisabled(e.on)},L.prototype.setDisabled=function(e){return this.disabled=e,this.lankBoss.disabled=this.disabled,this.updateGrabbability()},L.prototype.onSetPlaying=function(e){return this.playing=null==(e=(null!=e?e:{}).playing)||e,this.setPlayingCalled=!0,this.playing&&this.currentFrame>=this.world.totalFrames-5&&(this.currentFrame=1),this.fastForwardingToFrame&&!this.playing&&(this.fastForwardingToFrame=null),this.updateGrabbability()},L.prototype.onSetTime=function(e){var t=this.currentFrame;return null!=e.time&&(this.worldLifespan=this.world.frames.length/this.world.frameRate,e.ratio=e.time/this.worldLifespan),null!=e.ratio&&(t=this.world.frames.length*e.ratio),e.frameOffset&&(t+=e.frameOffset),e.ratioOffset&&(t+=this.world.frames.length*e.ratioOffset),!_.isNumber(t)||_.isNaN(t)?console.error("set-time event",e,"produced invalid target frame",t):this.setProgress(t/this.world.frames.length,e.scrubDuration)},L.prototype.onCastSpells=function(e){if(!e.preload)return this.ended&&this.setPaused(!1),this.casting=!0,this.setPlayingCalled=!1,this.frameBeforeCast=this.currentFrame,this.setProgress(0,0)},L.prototype.onNewWorld=function(e){if(e.world.name===this.world.name)return this.onStreamingWorldUpdated(e)},L.prototype.onStreamingWorldUpdated=function(e){var t,i,n;return this.casting=!1,this.lankBoss.play(),e.firstWorld||this.setPlayingCalled||Backbone.Mediator.publish("level:set-playing",{playing:!0}),this.setWorld(e.world),this.onFrameChanged(!0),this.playing&&!this.realTime&&(i=Math.min(e.firstChangedFrame,this.frameBeforeCast,this.world.frames.length-1))&&i>this.currentFrame+2*this.world.frameRate?(this.fastForwardingToFrame=i,this.cinematic?this.fastForwardingSpeed=Math.max(1,Math.min(2,i*this.world.dt/15)):this.fastForwardingSpeed=Math.max(3,this.world.maxTotalFrames*this.world.dt*3/60)):this.realTime&&(t=this.world.indefiniteLength?0:this.world.realTimeBufferMax,n=(this.world.frames.length-1)*this.world.dt-this.world.age,1.2*(i=this.world.dt+t)<n?(this.fastForwardingToFrame=this.world.frames.length-t*this.world.frameRate,this.fastForwardingSpeed=n/i):this.fastForwardingToFrame=this.fastForwardingSpeed=null),e.finished?this.updatePaths():this.hidePaths()},L.prototype.onIdleChanged=function(e){if(!this.ended)return this.setPaused(e.idle)},L.prototype.onMouseMove=function(e){if(this.mouseScreenPos={x:e.stageX,y:e.stageY},w.lastMouseWorldPos=this.camera.screenToWorld({x:e.stageX,y:e.stageY}),!this.disabled)return Backbone.Mediator.publish("surface:mouse-moved",{x:e.stageX,y:e.stageY}),this.gameUIState.trigger("surface:stage-mouse-move",{originalEvent:e})},L.prototype.onMouseDown=function(e){var t,i;if(!this.disabled)return this.camera.screenToCanvas({x:e.stageX,y:e.stageY}),i=this.camera.screenToWorld({x:e.stageX,y:e.stageY}),t={x:e.stageX,y:e.stageY,originalEvent:e,worldPos:i},w.lastMouseWorldPos=i,this.handleEvents||(t.onBackground=!this.webGLStage._getObjectsUnderPoint(e.stageX,e.stageY,null,!0)),Backbone.Mediator.publish("surface:stage-mouse-down",t),Backbone.Mediator.publish("tome:focus-editor",{}),this.gameUIState.trigger("surface:stage-mouse-down",t),this.mouseIsDown=!0},L.prototype.onSpriteMouseDown=function(e){if(this.realTime)return this.realTimeInputEvents.add({type:"mousedown",pos:this.camera.screenToWorld({x:e.originalEvent.stageX,y:e.originalEvent.stageY}),time:this.world.dt*this.world.frames.length,thangID:e.sprite.thang.id})},L.prototype.onWorldMouseMove=function(e){if(this.realTime)return this.realTimeInputEvents.add({type:"mousemove",pos:this.camera.screenToWorld({x:e.originalEvent.stageX,y:e.originalEvent.stageY}),time:this.world.dt*this.world.frames.length})},L.prototype.onMouseUp=function(e){if(!this.disabled)return w.lastMouseWorldPos=this.camera.screenToWorld({x:e.stageX,y:e.stageY}),e={x:e.stageX,y:e.stageY,originalEvent:e},Backbone.Mediator.publish("surface:stage-mouse-up",e),Backbone.Mediator.publish("tome:focus-editor",{}),this.gameUIState.trigger("surface:stage-mouse-up",e),this.mouseIsDown=!1},L.prototype.onMouseWheel=function(e){if(e.preventDefault(),!this.disabled)return e={deltaX:e.deltaX,deltaY:e.deltaY,canvas:this.webGLCanvas},this.mouseScreenPos&&(e.screenPos=this.mouseScreenPos),this.disabled||Backbone.Mediator.publish("surface:mouse-scrolled",e),this.gameUIState.trigger("surface:mouse-scrolled",e)},L.prototype.onKeyEvent=function(e){if(this.realTime)return(e=_.pick(e,"type","keyCode","ctrlKey","metaKey","shiftKey")).time=this.world.dt*this.world.frames.length,this.realTimeInputEvents.add(e)},L.prototype.onResize=function(e){var t,i,n,o,s,r,a;if(!this.destroyed&&!this.options.choosing&&(n=(s=parseInt(this.normalCanvas.attr("width"),10))/(o=parseInt(this.normalCanvas.attr("height"),10)),a=l("#page-container").width()-17,n=c.isIPadApp?(i=1024)/n:"wrapper-size"===this.options.resizeStrategy?(t=l("#canvas-wrapper").width(),r=window.innerHeight-l("#control-bar-view").outerHeight()-l("#playback-view").outerHeight(),(i=Math.min(a,r*n,t))/n):this.realTime||this.cinematic||this.options.spectateGame?(r=window.innerHeight-l("#playback-view").outerHeight(),(this.realTime||this.options.spectateGame)&&(r-=l("#control-bar-view").outerHeight()),(i=Math.min(a,r*n))/n):l("#thangs-tab-view")?(i=l("#canvas-wrapper").width())/n:(i=.55*a)/n,100<i&&100<n))return i*=1,n*=1,this.normalCanvas.add(this.webGLCanvas).attr({width:i,height:n}),this.trigger("resize",{width:i,height:n}),this.webGLStage.updateViewport(this.webGLCanvas[0].width,this.webGLCanvas[0].height),this.normalStage.scaleX*=i/s,this.normalStage.scaleY*=n/o,this.camera.onResize(i,n),this.options.spectateGame?(n=this.webGLCanvas.offset().left-(l("#page-container").innerWidth()-l("#canvas-wrapper").innerWidth())/2,this.normalCanvas.css("left",n)):void 0},L.prototype.focusOnHero=function(){var e=this.heroLank;if(this.heroLank=this.lankBoss.lankFor("Hero Placeholder"),"ogres"===k.team&&(this.heroLank=this.lankBoss.lankFor("Hero Placeholder 1")),!e)return this.updatePaths()},L.prototype.onRealTimePlaybackStarted=function(e){if(!this.realTime)return this.realTimeInputEvents.reset(),this.realTime=!0,this.onResize(),this.playing=!1,this.heroLank?this.previousCameraZoom=this.camera.zoom:void 0},L.prototype.onRealTimePlaybackEnded=function(e){if(this.realTime)return this.realTime=!1,this.onResize(),_.delay(this.onResize,x+100),this.normalCanvas.add(this.webGLCanvas).removeClass("flag-color-selected"),this.handleEvents&&this.previousCameraZoom?this.camera.zoomTo(this.camera.newTarget||this.camera.target,this.previousCameraZoom,3e3):void 0},L.prototype.onCinematicPlaybackStarted=function(e){if(!this.cinematic)return this.cinematic=!0,this.onResize()},L.prototype.onCinematicPlaybackEnded=function(e){if(this.cinematic)return this.cinematic=!1,this.onResize(),_.delay(this.onResize,x+100)},L.prototype.onFlagColorSelected=function(e){if(this.normalCanvas.add(this.webGLCanvas).toggleClass("flag-color-selected",Boolean(e.color)),this.mouseScreenPos)return e.pos=this.camera.screenToWorld(this.mouseScreenPos)},L.prototype.onManualCast=function(){if("game-dev"===this.options.levelType)return console.log("Force resize strategy"),this.options.originalResizeStrategy=this.options.resizeStrategy,this.options.resizeStrategy="wrapper-size"},L.prototype.onStopRealTimePlayback=function(){if("game-dev"===this.options.levelType)return console.log("Reset resize strategy"),this.options.resizeStrategy=this.options.originalResizeStrategy},L.prototype.updatePaths=function(){var e;if(this.options.paths&&this.heroLank&&(this.hidePaths(),"never"!==this.world.showPaths))return e=this.lankBoss.layerAdapters.Path,null==this.trailmaster&&(this.trailmaster=new b(this.camera,e)),this.paths=this.trailmaster.generatePaths(this.world,this.heroLank.thang),this.paths.name="paths",e.addChild(this.paths)},L.prototype.hidePaths=function(){if(this.paths)return this.paths.parent&&this.paths.parent.removeChild(this.paths),this.paths=null},L.prototype.screenshot=function(e,t,i,n){var o,s,r;return null==t&&(t="image/jpeg"),null==i&&(i=.8),s=[this.camera.canvasWidth*this.camera.canvasScaleFactorX,this.camera.canvasHeight*this.camera.canvasScaleFactorY],this.webGLStage.cache((o=(1-1/(n=null==n?2:n))/2)*(r=s[0]),o*(s=s[1]),r/n,s/n,(e=null==e?.25:e)*n),i=this.webGLStage.cacheCanvas.toDataURL(t,i),document.createElement("img").src=i,this.webGLStage.uncache(),i},L.prototype.onTogglePathFinding=function(e){return null!=e&&"function"==typeof e.preventDefault&&e.preventDefault(),this.hidePathFinding(),this.showingPathFinding=!this.showingPathFinding,this.showingPathFinding?this.showPathFinding():this.hidePathFinding()},L.prototype.hidePathFinding=function(){var e=this.gridLayer;return this.navRectangles&&e.removeChild(this.navRectangles),this.navPaths&&e.removeChild(this.navPaths),this.navRectangles=this.navPaths=null},L.prototype.showPathFinding=function(){var e,t;if(this.hidePathFinding(),e=_.values(this.world.navMeshes||{})[0])return t=this.gridLayer,this.navRectangles=new w.Container(t.spriteSheet),this.addMeshRectanglesToContainer(e,this.navRectangles),t.addChild(this.navRectangles),t.updateLayerOrder(),(e=_.values(this.world.graphs||{})[0])&&(this.navPaths=new w.Container(t.spriteSheet),this.addNavPathsToContainer(e,this.navPaths),t.addChild(this.navPaths)),t.updateLayerOrder()},L.prototype.addMeshRectanglesToContainer=function(e,t){for(var i,n,o,s=[],r=0,a=e.length;r<a;r++)n=e[r],o=new w.Shape,i=this.camera.worldToSurface({x:n.x,y:n.y}),n=this.camera.worldToSurface({x:n.width,y:n.height}),o.graphics.setStrokeStyle(3).beginFill("rgba(0,0,128,0.3)").beginStroke("rgba(0,0,128,0.7)").drawRect(i.x-n.x/2,i.y-n.y/2,n.x,n.y),s.push(t.addChild(o));return s},L.prototype.addNavPathsToContainer=function(e,o){for(var s,r,t=_.values(e),i=[],n=0,a=t.length;n<a;n++)r=t[n],i.push(function(){for(var e=r.edges,t=[],i=0,n=e.length;i<n;i++)s=e[i],t.push(this.drawLine(r.vertex,s,o));return t}.call(this));return i},L.prototype.drawLine=function(e,t,i){var n=new w.Shape;return e=this.camera.worldToSurface(e),t=this.camera.worldToSurface(t),n.graphics.setStrokeStyle(1).beginStroke("rgba(128,0,0,0.4)").moveTo(0,0).lineTo(t.x-e.x,t.y-e.y).endStroke(),n.x=e.x,n.y=e.y,i.addChild(n)},L.prototype.destroy=function(){var e,t,i,n;for(null!=(n=this.camera)&&n.destroy(),w.Ticker.removeEventListener("tick",this.tick),w.Sound.stop(),e=0,t=(i=this.normalLayers).length;e<t;e++)i[e].destroy();return this.lankBoss.destroy(),null!=(n=this.chooser)&&n.destroy(),null!=(n=this.dimmer)&&n.destroy(),null!=(n=this.countdownScreen)&&n.destroy(),null!=(n=this.playbackOverScreen)&&n.destroy(),null!=(n=this.coordinateDisplay)&&n.destroy(),null!=(n=this.coordinateGrid)&&n.destroy(),this.normalStage.clear(),this.webGLStage.clear(),null!=(n=this.musicPlayer)&&n.destroy(),null!=(n=this.trailmaster)&&n.destroy(),this.normalStage.removeAllChildren(),this.webGLStage.removeAllChildren(),this.webGLStage.removeEventListener("stagemousemove",this.onMouseMove),this.webGLStage.removeEventListener("stagemousedown",this.onMouseDown),this.webGLStage.removeEventListener("stagemouseup",this.onMouseUp),this.normalStage.removeAllEventListeners(),this.webGLStage.removeAllEventListeners(),this.normalStage.enableDOMEvents(!1),this.webGLStage.enableDOMEvents(!1),this.normalStage.enableMouseOver(0),this.webGLStage.enableMouseOver(0),this.webGLCanvas.off("mousewheel",this.onMouseWheel),this.normalCanvas[0].width=this.normalCanvas[0].height=0,this.webGLCanvas[0].width=this.webGLCanvas[0].height=0,l(window).off("resize",this.onResize),l(window).off("keydown",this.onKeyEvent),l(window).off("keyup",this.onKeyEvent),this.surfacePauseTimeout&&clearTimeout(this.surfacePauseTimeout),this.surfaceZoomPauseTimeout&&clearTimeout(this.surfaceZoomPauseTimeout),L.__super__.destroy.call(this)},L)}.call(this,D(3),D(17))},1451:function(t,e,c){!function(i){var O,w,e,p,G,z,s,H,W,k,o,l,x,d,n=function(e,t){return function(){return e.apply(t,arguments)}},r={}.hasOwnProperty,h=[].indexOf||function(e){for(var t=0,i=this.length;t<i;t++)if(t in this&&this[t]===e)return t;return-1};function a(e){var t;this.buildLoop=n(this.buildLoop,this),this.preloadTokenForOpponentSession=n(this.preloadTokenForOpponentSession,this),this.preloadTeamForSession=n(this.preloadTeamForSession,this),this.t0=(new Date).getTime(),a.__super__.constructor.call(this),this.supermodel=e.supermodel,this.supermodel.setMaxProgress(.2),this.levelID=e.levelID,this.sessionID=e.sessionID,this.opponentSessionID=e.opponentSessionID,this.tournament=null!=(t=e.tournament)&&t,this.team=e.team,this.headless=e.headless,this.loadArticles=e.loadArticles,this.sessionless=e.sessionless,this.fakeSessionConfig=e.fakeSessionConfig,this.spectateMode=null!=(t=e.spectateMode)&&t,this.observing=e.observing,this.courseID=e.courseID,this.courseInstanceID=e.courseInstanceID,this.worldNecessities=[],this.listenTo(this.supermodel,"resource-loaded",this.onWorldNecessityLoaded),this.listenTo(this.supermodel,"failed",this.onWorldNecessityLoadFailed),this.loadLevel(),this.loadAudio(),this.playJingle(),this.supermodel.finished()?this.onSupermodelLoaded():(this.loadTimeoutID=setTimeout(this.reportLoadError.bind(this),3e4),this.listenToOnce(this.supermodel,"loaded-all",this.onSupermodelLoaded))}G=c(267),z=c(619),H=c(621),O=c(1384),s=c(1375),x=c(44).me,k=c(1374),W=c(1519),p=c(1448),e=c(45),w=c(1390),o=c(271),d=c(6),l=c(1430),t.exports=(function(e,t){for(var i in t)r.call(t,i)&&(e[i]=t[i]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(a,e),a.prototype.loadWorldNecessities=function(){return new Promise((t=this,function(e,i){return t.world?e(t):(t.once("world-necessities-loaded",function(){return e(t)}),t.once("world-necessity-load-failed",function(e){var t=e.resource.jqxhr;return i({message:(null!=(e=t.responseJSON)?e.message:void 0)||t.responseText||"Unknown Error"})}))}));var t},a.prototype.loadLevel=function(){return this.level=this.supermodel.getModel(G,this.levelID)||new G({_id:this.levelID}),this.level.loaded?this.onLevelLoaded():(this.level=this.supermodel.loadModel(this.level,"level").model,this.listenToOnce(this.level,"sync",this.onLevelLoaded))},a.prototype.reportLoadError=function(){var e,t;if(!this.destroyed)return null!=(e=window.tracker)?e.trackEvent("LevelLoadError",{category:"Error",levelSlug:null!=(e=this.work)&&null!=(t=e.level)?t.slug:void 0,unloaded:JSON.stringify(this.supermodel.report().map(function(e){return _.result(e.model,"url")}))}):void 0},a.prototype.onLevelLoaded=function(){var e,t,i;return!this.sessionless&&this.level.isType("hero","hero-ladder","hero-coop","course")&&(this.sessionDependenciesRegistered={}),this.level.isType("web-dev")&&(this.headless=!0,this.sessionless&&(e=this.level.get,this.level.get=function(){return"type"===arguments[0]?"hero":"realType"===arguments[0]?"web-dev":e.apply(this,arguments)})),(this.courseID&&!this.level.isType("course","course-ladder","game-dev","web-dev")||window.serverConfig.picoCTF)&&(e=this.level.get,t=this.level.get("type"),this.level.get=function(){return"type"===arguments[0]?"course":"realType"===arguments[0]?t:e.apply(this,arguments)}),window.serverConfig.picoCTF&&this.supermodel.addRequestResource({url:"/picoctf/problems",success:(i=this,function(e){var t;return null!=(t=i.level)?t.picoCTFProblem=_.find(e,{pid:i.level.get("picoCTFProblem")}):void 0})}).load(),this.sessionless||(null!=this.fakeSessionConfig?this.loadFakeSession():this.loadSession()),this.populateLevel()},a.prototype.loadFakeSession=function(){var e,t,i,n,o={level:{original:this.level.get("original"),majorVersion:this.level.get("version").major},creator:x.id,state:{complete:!1,scripts:{}},permissions:[{target:x.id,access:"owner"},{target:"public",access:"write"}],codeLanguage:this.fakeSessionConfig.codeLanguage||(null!=(o=x.get("aceConfig"))?o.language:void 0)||"python",_id:s.fakeID};for(this.session=new s(o),this.session.loaded=!0,"function"==typeof(o=this.fakeSessionConfig).callback&&o.callback(this.session,this.level),e=0,t=(n=["save","patch","put"]).length;e<t;e++)this.session[i=n[e]]=function(){return console.error("We shouldn't be doing a session."+i+", since it's a fake session.")};return this.session.fake=!0,this.loadDependenciesForSession(this.session)},a.prototype.loadSession=function(){var e,t;if(this.sessionID?(t="/db/level.session/"+this.sessionID,this.spectateMode&&(t+="?interpret=true")):(t="/db/level/"+this.levelID+"/session",this.team?(this.level.isType("ladder")?t+="?team=humans":t+="?team="+this.team,e=d.getQueryVariable("league"),this.level.isType("course-ladder")&&e&&!this.courseInstanceID&&(t+="&courseInstance="+e)):this.courseID&&(t+="?course="+this.courseID,this.courseInstanceID&&(t+="&courseInstance="+this.courseInstanceID)),(e=d.getQueryVariable("password"))&&(t+=(/\?/.test(t)?"&":"?")+"password="+e)),this.tournament&&(t="/db/level.session/"+this.sessionID+"/tournament-snapshot/"+this.tournament),e=(new s).setURL(t),this.headless&&!this.level.isType("web-dev")&&(e.project=["creator","team","heroConfig","codeLanguage","submittedCodeLanguage","state","submittedCode","submitted"]),this.sessionResource=this.supermodel.loadModel(e,"level_session",{cache:!1}),this.session=this.sessionResource.model,this.opponentSessionID&&(t="/db/level.session/"+this.opponentSessionID+"?interpret=true",this.tournament&&(t="/db/level.session/"+this.opponentSessionID+"/tournament-snapshot/"+this.tournament),t=(new s).setURL(t),this.headless&&(t.project=e.project),this.opponentSessionResource=this.supermodel.loadModel(t,"opponent_session",{cache:!1}),this.opponentSession=this.opponentSessionResource.model),this.session.loaded?(console.debug("LevelLoader: session already loaded:",this.session),this.session.setURL("/db/level.session/"+this.session.id),this.preloadTeamForSession(this.session)):(console.debug("LevelLoader: loading session:",this.session),this.listenToOnce(this.session,"sync",function(){return this.session.setURL("/db/level.session/"+this.session.id),this.preloadTeamForSession(this.session)})),this.opponentSession)return this.opponentSession.loaded?(console.debug("LevelLoader: opponent session already loaded:",this.opponentSession),this.preloadTokenForOpponentSession(this.opponentSession)):(console.debug("LevelLoader: loading opponent session:",this.opponentSession),this.listenToOnce(this.opponentSession,"sync",this.preloadTokenForOpponentSession))},a.prototype.preloadTeamForSession=function(e){var t;return this.level.isType("ladder")&&"ogres"===this.team&&"humans"===e.get("team")&&(e.set("team","ogres"),e.get("interpret")||(t=e.get("code"),(t=_.isEmpty(t)?e.get("submittedCode"):t)["hero-placeholder-1"]=JSON.parse(JSON.stringify(t["hero-placeholder"])),e.set("code",t))),this.loadDependenciesForSession(e)},a.prototype.preloadTokenForOpponentSession=function(t){var i,e,n,o,s,r;return this.level.isType("ladder")&&"ogres"!==this.team&&"humans"===t.get("team")&&t.set("team","ogres"),n=t.get("codeLanguage"),e=t.get("interpret"),"java"!==n&&"cpp"!==n||!e?this.loadDependenciesForSession(t):(s=p.decompressFromUTF16(e),i=t.get("code"),e={Accept:"application/json","Content-Type":"application/json"},document.cookie.match(/JWT=([a-zA-Z0-9.]+)/),o=("undefined"!=typeof window&&null!==window&&null!=(o=window.localStorage)?o.kodeKeeperService:void 0)||"https://asm14w94nk.execute-api.us-east-1.amazonaws.com/service/parse-code-kodekeeper",fetch(o,{method:"POST",mode:"cors",headers:e,body:JSON.stringify({code:s,language:n})}).then(function(e){return e.json()}).then((r=this,function(e){return i["humans"===t.get("team")?"hero-placeholder":"hero-placeholder-1"].plan=e.token,t.set("code",i),t.unset("interpret"),r.loadDependenciesForSession(t)})))},a.prototype.loadDependenciesForSession=function(e){var t,i,n,o,s,r,a,l,c,h,u;if(console.debug("Loading dependencies for session: ",e),x.id!==e.get("creator")||this.spectateMode?e.patch=e.save=e.put=function(){return console.error("Not saving session, since we didn't create it.")}:(h=d.getQueryVariable("codeLanguage"))&&e.set("codeLanguage",h),this.worldNecessities=this.worldNecessities.concat(this.loadCodeLanguagesForSession(e)),(h=e.get("interpret"))&&(h=p.decompressFromUTF16(h),(c=e.get("code"))["humans"===e.get("team")?"hero-placeholder":"hero-placeholder-1"].plan=h,e.set("code",c),e.unset("interpret")),"io"!==(c=e.get("codeLanguage"))&&"clojure"!==c||e.set("codeLanguage","python"),e===this.session?(this.addSessionBrowserInfo(e),c=null!=(c=this.team)?c:this.session.get("team"),Backbone.Mediator.publish("level:loaded",{level:this.level,team:c}),this.publishedLevelLoaded=!0,Backbone.Mediator.publish("level:session-loaded",{level:this.level,session:this.session}),null!=(c=this.opponentSession)&&c.loaded&&this.consolidateFlagHistory()):e===this.opponentSession&&this.session.loaded&&this.consolidateFlagHistory(),!this.level.isType("course")||x.showHeroAndInventoryModalsToStudents()&&!this.level.isAssessment()||(i=(null!=(a=x.get("heroConfig"))?a.thangType:void 0)||k.heroes.captain,this.level.isAssessment()&&x.showHeroAndInventoryModalsToStudents()&&(i=k.heroes.captain),console.debug("Course mode, loading custom hero: ",i),(t=this.maybeLoadURL(u="/db/thang.type/"+i+"/version",k,"thang"))&&(console.debug("Pushing resource: ",t),this.worldNecessities.push(t)),this.sessionDependenciesRegistered[e.id]=!0),this.level.isType("hero","hero-ladder","hero-coop")||this.level.isType("course")&&x.showHeroAndInventoryModalsToStudents()&&!this.level.isAssessment()){for(a=e.get("heroConfig"),e!==this.session||this.headless||null==a&&(a=x.get("heroConfig")),null==(a=null==a?{}:a).inventory&&(a.inventory={feet:"53e237bf53457600003e3f05"}),null==a.thangType&&(a.thangType="529ffbf1cf1818f2be000001"),_.isEqual(a,e.get("heroConfig"))||e.set("heroConfig",a),u="/db/thang.type/"+a.thangType+"/version",(t=this.maybeLoadURL(u,k,"thang"))?this.worldNecessities.push(t):(i=this.supermodel.getModel(u),this.loadDefaultComponentsForThangType(i),this.loadThangsRequiredByThangType(i)),s=0,r=(l=_.values(a.inventory)).length;s<r;s++)o=l[s],(n=this.maybeLoadURL(u="/db/thang.type/"+o+"/version?project=name,components,original,rasterIcon,kind",k,"thang"))?this.worldNecessities.push(n):(o=this.supermodel.getModel(u),this.loadDefaultComponentsForThangType(o),this.loadThangsRequiredByThangType(o));return this.sessionDependenciesRegistered[e.id]=!0,2===_.size(this.sessionDependenciesRegistered)&&this.checkAllWorldNecessitiesRegisteredAndLoaded()?this.onWorldNecessitiesLoaded():void 0}this.checkAllWorldNecessitiesRegisteredAndLoaded()&&this.onWorldNecessitiesLoaded()},a.prototype.loadCodeLanguagesForSession=function(e){var t,i,n,o,s,r=_.uniq(_.filter([e.get("codeLanguage")||"python",e.get("submittedCodeLanguage")])),a=[];for(s=this,i=function(e){var t=s.supermodel.addSomethingResource("language_module_"+e);return a.push(t),l(e).then(function(e){return t.markLoaded()})},n=0,o=r.length;n<o;n++)"clojure"!==(t=r[n])&&"io"!==t&&i(t);return a},a.prototype.addSessionBrowserInfo=function(e){var t;if(x.id===e.get("creator")&&null!=i.browser&&!this.spectateMode&&!e.fake&&(t={},i.browser.desktop&&(t.desktop=i.browser.desktop),i.browser.name&&(t.name=i.browser.name),i.browser.platform&&(t.platform=i.browser.platform),i.browser.version&&(t.version=i.browser.version),!_.isEqual(e.get("browser"),t)))return e.set("browser",t),e.save({browser:t},{patch:!0,type:"PUT"})},a.prototype.consolidateFlagHistory=function(){var e=null!=(t=this.session.get("state"))?t:{},t=_.filter(null!=(i=e.flagHistory)?i:[],{team:this.session.get("team")}),i=_.filter(null!=(i=null!=(i=this.opponentSession.get("state"))?i.flagHistory:void 0)?i:[],{team:this.opponentSession.get("team")});return e.flagHistory=t.concat(i),this.session.set("state",e)},a.prototype.populateLevel=function(){for(var e,t,i,n,o,s,r,a,l,c,h,u,p,d,m,f,g,y,v,b,w,k,x,S,C,T,L,M,D,I,A,R=[],P=[],E=[],B=[],F={thangType:"53fa25f25bc220000052c2be",id:"Placeholder Flag",components:[]},N=(this.level.get("thangs")||[]).concat([F]),U=0,V=N.length;U<V;U++)for(M=N[U],R.push(M.thangType),this.loadThangsRequiredByLevelThang(M),o=0,s=(y=M.components||[]).length;o<s;o++)t=y[o],P.push(_.pick(t,["original","majorVersion"]));for(p=0,r=(b=this.level.get("systems")||[]).length;p<r;p++)if(L=b[p],E.push(_.pick(L,["original","majorVersion"])),n=null!=L&&null!=(w=L.config)?w.indieSprites:void 0)for(d=0,a=n.length;d<a;d++)i=n[d],R.push(i.thangType);if(!this.headless||this.loadArticles)for(f=0,l=(k=(null!=(x=this.level.get("documentation"))?x.generalArticles:void 0)||[]).length;f<l;f++)e=k[f],B.push(_.pick(e,["original","majorVersion"]));for(F=function(e){return _.uniq(e,!1,function(e){return JSON.stringify(e)})},A=[],this.thangIDs=_.uniq(R),this.thangNames=new W(this.thangIDs),A.push(this.supermodel.loadCollection(this.thangNames,"thang_names")),this.listenToOnce(this.thangNames,"sync",this.onThangNamesLoaded),null!=(x=this.sessionResource)&&x.isLoading&&A.push(this.sessionResource),null!=(x=this.opponentSessionResource)&&x.isLoading&&A.push(this.opponentSessionResource),g=0,c=(S=F(P)).length;g<c;g++)I="/db/level.component/"+(m=S[g]).original+"/version/"+m.majorVersion,A.push(this.maybeLoadURL(I,z,"component"));for(T=0,h=(C=F(E)).length;T<h;T++)I="/db/level.system/"+(m=C[T]).original+"/version/"+m.majorVersion,A.push(this.maybeLoadURL(I,H,"system"));for(D=0,u=(v=F(B)).length;D<u;D++)I="/db/article/"+(m=v[D]).original+"/version/"+m.majorVersion,this.maybeLoadURL(I,O,"article");return(m=this.level.get("nextLevel"))&&(I="/db/level/"+m.original+"/version/"+m.majorVersion,this.maybeLoadURL(I,G,"level")),this.worldNecessities=this.worldNecessities.concat(A)},a.prototype.loadThangsRequiredByLevelThang=function(e){return this.loadThangsRequiredFromComponentList(e.components)},a.prototype.loadThangsRequiredByThangType=function(e){return this.loadThangsRequiredFromComponentList(e.get("components"))},a.prototype.loadThangsRequiredFromComponentList=function(e){var t,i,n,o,s,r,a,l,c,h,u,p,d,m;if(e){for(p=[],o=0,r=e.length;o<r;o++)if((t=e[o]).config)if(t.original===z.EquipsID)for(s=0,a=(u=_.values(null!=(h=t.config.inventory)?h:{})).length;s<a;s++)n=u[s],p.push(n);else t.config.requiredThangTypes&&(p=p.concat(t.config.requiredThangTypes));for((i=_.filter(p)).length<p.length&&console.error("Some Thang had a blank required ThangType in components list:",e),d=[],c=0,l=i.length;c<l;c++)(m=i[c])+""=="[object Object]"?d.push(console.error("Some Thang had an improperly stringified required ThangType in components list:",m,e)):d.push(this.worldNecessities.push(this.maybeLoadURL("/db/thang.type/"+m+"/version?project=name,components,original,rasterIcon,kind,prerenderedSpriteSheetData",k,"thang")));return d}},a.prototype.onThangNamesLoaded=function(e){for(var t,i=e.models,n=0,o=i.length;n<o;n++)t=i[n],this.loadDefaultComponentsForThangType(t),this.loadThangsRequiredByThangType(t);if(this.thangNamesLoaded=!0,this.checkAllWorldNecessitiesRegisteredAndLoaded())return this.onWorldNecessitiesLoaded()},a.prototype.loadDefaultComponentsForThangType=function(e){var t,i,n,o,s;if(t=e.get("components")){for(o=[],i=0,n=t.length;i<n;i++)s="/db/level.component/"+(s=t[i]).original+"/version/"+s.majorVersion,o.push(this.worldNecessities.push(this.maybeLoadURL(s,z,"component")));return o}},a.prototype.onWorldNecessityLoaded=function(e){var o,t=this.worldNecessities.indexOf(e);if("thang"===e.name&&(this.loadDefaultComponentsForThangType(e.model),this.loadThangsRequiredByThangType(e.model)),0<=t)return this.worldNecessities.splice(t,1),this.worldNecessities=function(){for(var e=this.worldNecessities,t=[],i=0,n=e.length;i<n;i++)null!=(o=e[i])&&t.push(o);return t}.call(this),this.checkAllWorldNecessitiesRegisteredAndLoaded()?this.onWorldNecessitiesLoaded():void 0},a.prototype.onWorldNecessityLoadFailed=function(e){return this.reportLoadError(),this.trigger("world-necessity-load-failed",e)},a.prototype.checkAllWorldNecessitiesRegisteredAndLoaded=function(){var e=this.getReasonForNotYetLoaded();return e&&console.debug("LevelLoader: Reason not loaded:",e),!e},a.prototype.getReasonForNotYetLoaded=function(){var e;return 0!==_.filter(this.worldNecessities).length?"worldNecessities still loading":this.thangNamesLoaded?!this.sessionDependenciesRegistered||this.sessionDependenciesRegistered[this.session.id]||this.sessionless?this.sessionDependenciesRegistered&&this.opponentSession&&!this.sessionDependenciesRegistered[this.opponentSession.id]&&!this.sessionless?"not all opponent session dependencies registered":null!=(e=this.session)&&e.loaded||this.sessionless?!this.opponentSession||this.opponentSession.loaded&&!this.opponentSession.get("interpret")?this.publishedLevelLoaded||this.sessionless?this.opponentSession&&this.opponentSession.get("interpret")?"cpp/java token is still fetching":"":"have not published level loaded":"opponent session is not loaded":"session is not loaded":"not all session dependencies registered":"thang names need to load"},a.prototype.onWorldNecessitiesLoaded=function(){var e,o,s;if(console.debug("World necessities loaded."),!this.initialized&&(this.initialized=!0,this.initWorld(),this.supermodel.clearMaxProgress(),this.trigger("world-necessities-loaded"),!this.headless))return _.uniq(function(){for(var e=this.world.thangs,t=[],i=0,n=e.length;i<n;i++)(o=e[i]).exists&&t.push(o.spriteName);return t}.call(this)),e=function(){for(var e=this.thangNames.models,t=[],i=0,n=e.length;i<n;i++)s=e[i],t.push([s.get("name"),s]);return t}.call(this),_.zipObject(e),null==this.spriteSheetsToBuild&&(this.spriteSheetsToBuild=[]),this.spriteSheetsToBuild.length?this.buildLoopInterval=setInterval(this.buildLoop,5):void 0},a.prototype.maybeLoadURL=function(e,t,i){if(!this.supermodel.getModel(e))return e=(new t).setURL(e),this.supermodel.loadModel(e,i)},a.prototype.onSupermodelLoaded=function(){if(clearTimeout(this.loadTimeoutID),!this.destroyed)return console.debug("SuperModel for Level loaded in",(new Date).getTime()-this.t0,"ms"),this.loadLevelSounds(),this.denormalizeSession()},a.prototype.buildLoop=function(){for(var e,t,i,n,o=!1,s=null!=(t=this.spriteSheetsToBuild)?t:[],r=e=0,a=s.length;e<a;r=++e)(i=s[r]).spriteSheetKeys||(o=!0,(n=i.thangType).loaded&&!n.loading&&((n=this.buildSpriteSheetsForThangType(i.thangType))&&n.length?(this.listenTo(i.thangType,"build-complete",this.onBuildComplete),i.spriteSheetKeys=n):i.markLoaded()));if(!o)return clearInterval(this.buildLoopInterval)},a.prototype.onBuildComplete=function(o){for(var s,r=null,e=this.spriteSheetsToBuild,t=0,i=e.length;t<i&&(r=e[t],o.thangType!==r.thangType);t++);return r?(r.spriteSheetKeys=function(){for(var e=r.spriteSheetKeys,t=[],i=0,n=e.length;i<n;i++)(s=e[i])!==o.key&&t.push(s);return t}(),0===r.spriteSheetKeys.length?r.markLoaded():void 0):console.error("Did not find spriteSheetToBuildResource for",o)},a.prototype.denormalizeSession=function(){var e,t,i,n;if(!(this.sessionDenormalized||this.spectateMode||this.sessionless||x.isSessionless())&&(!this.headless||this.level.isType("web-dev"))&&this.session.id){for(t in i={levelName:this.level.get("name"),levelID:this.level.get("slug")||this.level.id},x.id===this.session.get("creator")&&(i.creatorName=x.get("name"),(e=x.age())&&(i.creatorAge=e)),i)n=i[t],this.session.get(t)===n&&delete i[t];if(!_.isEmpty(i)){for(t in this.level.isLadder()&&this.session.get("team")&&(i.team=this.session.get("team"),this.level.isType("ladder")&&(i.team="humans")),i)n=i[t],this.session.set(t,n);new s({_id:this.session.id}).save(i,{patch:!0,type:"PUT"})}return this.sessionDenormalized=!0}},a.prototype.buildSpriteSheetsForThangType=function(e){var t,i,n,o,s,r,a,l;if(!this.headless){for(this.thangTypeTeams||this.grabThangTypeTeams(),i=[],t=0,n=(s=null!=(o=this.thangTypeTeams[e.get("original")])?o:[null]).length;t<n;t++)l=s[t],a={resolutionFactor:SPRITE_RESOLUTION_FACTOR,async:!0},"Floor"===e.get("kind")&&(a.resolutionFactor=2),l&&(r=null!=(r=this.teamConfigs[l])?r.color:void 0)&&(a.colorConfig={team:r}),a=this.buildSpriteSheet(e,a),_.isString(a)&&i.push(a);return i}},a.prototype.grabThangTypeTeams=function(){var e,t,i,n,o,s,r,a,l,c;for(this.grabTeamConfigs(),this.thangTypeTeams={},t=0,n=(s=this.level.get("thangs")).length;t<n;t++)if(c=s[t],!this.level.isType("hero","course")||"Hero Placeholder"!==c.id)for(i=0,o=(r=c.components).length;i<o;i++)if(l=null!=(a=r[i].config)?a.team:void 0){null==(e=this.thangTypeTeams)[a=c.thangType]&&(e[a]=[]),h.call(this.thangTypeTeams[c.thangType],l)<0&&this.thangTypeTeams[c.thangType].push(l);break}return this.thangTypeTeams},a.prototype.grabTeamConfigs=function(){for(var e,t=this.level.get("systems"),i=0,n=t.length;i<n&&(e=t[i],!(this.teamConfigs=null!=(e=e.config)?e.teamConfigs:void 0));i++);return this.teamConfigs||(this.teamConfigs={humans:{superteam:"humans",color:{hue:0,saturation:.75,lightness:.5},playable:!0},ogres:{superteam:"ogres",color:{hue:.66,saturation:.75,lightness:.5},playable:!1},neutral:{superteam:"neutral",color:{hue:.33,saturation:.75,lightness:.5}}}),this.teamConfigs},a.prototype.buildSpriteSheet=function(e,t){var i;return"Wizard"===e.get("name")&&(t.colorConfig=(null!=(i=x.get("wizard"))?i.colorConfig:void 0)||{}),e.buildSpriteSheet(t)},a.prototype.initWorld=function(){var e,t,i,n;if(!this.level.isType("web-dev"))return this.world=new o,this.world.levelSessionIDs=this.opponentSessionID?[this.sessionID,this.opponentSessionID]:[this.sessionID],this.world.submissionCount=null!=(t=null!=(e=this.session)&&null!=(t=e.get("state"))?t.submissionCount:void 0)?t:0,this.world.flagHistory=null!=(i=null!=(t=this.session)&&null!=(i=t.get("state"))?i.flagHistory:void 0)?i:[],this.world.difficulty=null!=(n=null!=(i=this.session)&&null!=(n=i.get("state"))?n.difficulty:void 0)?n:0,this.observing&&(this.world.difficulty=Math.max(0,this.world.difficulty-1)),n=this.level.serialize({supermodel:this.supermodel,session:this.session,opponentSession:this.opponentSession,headless:this.headless,sessionless:this.sessionless}),x.constrainHeroHealth()&&(n.constrainHeroHealth=!0),this.world.loadFromLevel(n,!1),console.debug("World has been initialized from level loader.")},a.prototype.playJingle=function(){var t;if(!this.headless&&x.get("volume"))return t=.5,x.level()<3&&(t=.25),setTimeout(function(){var e=["ident_1","ident_2"];return w.playInterfaceSound(e[Math.floor(Math.random()*e.length)],t)},500)},a.prototype.loadAudio=function(){if(!this.headless&&x.get("volume"))return w.preloadInterfaceSounds(["victory"])},a.prototype.loadLevelSounds=function(){var e,t,i,n,o,s,r,a,l,c,h,u,p,d,m,f,g,y,v,b,_;if(!this.headless&&x.get("volume")&&(m=this.level.get("scripts"))){for(e=0,i=m.length;e<i;e++)if((d=m[e]).noteChain)for(t=0,n=(c=d.noteChain).length;t<n;t++)if((a=c[t]).sprites)for(r=0,o=(h=a.sprites).length;r<o;r++)null!=(u=(y=h[r]).say)&&u.sound&&w.preloadSoundReference(y.say.sound);for(p=[],l=0,s=(b=this.supermodel.getModels(k)).length;l<s;l++)v=b[l],p.push(function(){var e=v.get("soundTriggers")||{},t=[];for(_ in e)g=e[_],"say"!==_&&t.push(function(){for(var e=[],t=0,i=g.length;t<i;t++)f=g[t],e.push(w.preloadSoundReference(f));return e}());return t}());return p}},a.prototype.progress=function(){return this.supermodel.progress},a.prototype.destroy=function(){return this.buildLoopInterval&&clearInterval(this.buildLoopInterval),a.__super__.destroy.call(this)},a)}.call(this,c(3))},1461:function(e,t,i){i(11);e.exports=function(e){var t=[];return t.push('<div role="tooltip" class="popover buy-gems-prompt"><div class="arrow"></div><h2 data-i18n="buy_gems.prompt_title">Not Enough Gems</h2><p data-i18n="buy_gems.prompt_body">Do you want to get more?</p><a data-i18n="buy_gems.prompt_button" class="btn btn-success btn-illustrated btn-lg buy-gems-prompt-button">Enter Shop</a></div>'),t.join("")}},1462:function(e,t,i){i(11);e.exports=function(e){var t=[];return t.push('<div role="tooltip" class="popover buy-gems-prompt"><div class="arrow"></div><h2 data-i18n="earn_gems.prompt_title">Not Enough Gems</h2><p data-i18n="earn_gems.prompt_body">Keep playing to earn more!</p></div>'),t.join("")}},1463:function(e,t,i){i(11);e.exports=function(e){var t=[];return t.push('<div role="tooltip" class="popover buy-gems-prompt"><div class="arrow"></div><h2 data-i18n="subscribe_for_gems.prompt_title">Not Enough Gems!</h2><p data-i18n="subscribe_for_gems.prompt_body">Subscribe to Premium to get gems and access to even more levels!</p><a data-i18n="subscribe.subscribe_title" class="start-subscription-button btn btn-lg btn-illustrated btn-success">Subscribe</a></div>'),t.join("")}},1464:function(e,t,i){"use strict";i.r(t);var n,o=i(1465),s=i.n(o);for(n in o)["default"].indexOf(n)<0&&function(e){i.d(t,e,function(){return o[e]})}(n);t.default=s.a},1465:function(e,t,i){"use strict";e.exports=Vue.extend({props:{clickStudent:{type:Function,required:!0},clickTeacher:{type:Function,required:!0},showVideo:{type:Boolean}}})},1466:function(e,t,i){var n=i(1674);(n="string"==typeof n?[[e.i,n,""]]:n).locals&&(e.exports=n.locals);(0,i(21).default)("491277e7",n,!0,{})},1467:function(e,t,i){"use strict";i.r(t);var n,o=i(1468),s=i.n(o);for(n in o)["default"].indexOf(n)<0&&function(e){i.d(t,e,function(){return o[e]})}(n);t.default=s.a},1468:function(e,i,s){"use strict";!function(n){Object.defineProperty(i,"__esModule",{value:!0}),i.default=void 0;var p=t(s(46)),d=t(s(6)),o=t(s(1489)),e=t(s(628));function t(e){return e&&e.__esModule?e:{default:e}}e=Vue.extend({props:{courseInstanceID:{type:String,required:!0},courseID:{type:String,required:!0}},data:function(){return{videoLevels:[]}},created:e.default.wrap(regeneratorRuntime.mark(function e(){var t,i,n,o,s,r,a,l,c,h,u=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,p.default.courseInstances.get({courseInstanceID:this.courseInstanceID});case 3:return t=e.sent,e.next=6,p.default.classrooms.get({classroomID:t.classroomID});case 6:for(n in t=e.sent,i=t.courses.find(function(e){return e._id==u.courseID}).levels)(o=d.default.videoLevels[i[n].original])&&this.videoLevels.push(o);return e.next=11,p.default.courseInstances.getSessions({courseInstanceID:this.courseInstanceID});case 11:for(l=e.sent,s={},l.map(function(e){return s[e.level.original]=e}),a=!(r=!0),l=void 0,e.prev=17,c=this.videoLevels[Symbol.iterator]();!(r=(h=c.next()).done);r=!0)h=h.value,s[h.original]?Vue.set(h,"videoStatus","unlocked"):Vue.set(h,"videoStatus","locked");e.next=25;break;case 21:e.prev=21,e.t0=e.catch(17),a=!0,l=e.t0;case 25:e.prev=25,e.prev=26,r||null==c.return||c.return();case 28:if(e.prev=28,a)throw l;e.next=31;break;case 31:return e.finish(28);case 32:return e.finish(25);case 33:e.next=38;break;case 35:e.prev=35,e.t1=e.catch(0),console.error("Error in fetching data:",e.t1);case 38:case"end":return e.stop()}},e,this,[[0,35],[17,21,25,33],[26,,28,32]])})),methods:{onImageClick:function(e){var t=(t=e.target.src).slice(t.search("/images")),i=this.videoLevels.find(function(e){return e.thumbnail_unlocked==t})||{},e=n(".video-frame")[0];e.src=me.showChinaVideo()?i.cn_url:i.url,e.style["z-index"]=3,n("#videos-content")[0].style.display="none",n("#video-close-btn")[0].style.display="block",me.showChinaVideo()||new o.default(e).play().catch(function(e){return console.log("Error while playing the video:",e)})}}});i.default=e}.call(this,s(3))},1469:function(e,t,i){var n=i(1676);(n="string"==typeof n?[[e.i,n,""]]:n).locals&&(e.exports=n.locals);(0,i(21).default)("9a66e3fe",n,!0,{})},1470:function(e,t,i){var o={}.hasOwnProperty,a=[].slice;function n(e){this.noteGroup=e,n.__super__.constructor.call(this),this.noteGroup.prepared||(this.analyzeNoteGroup(this.noteGroup),null==(e=this.noteGroup).notes&&(e.notes=[]),this.noteGroup.prepared=!0)}i=i(45),e.exports=(function(e,t){for(var i in t)o.call(t,i)&&(e[i]=t[i]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(n,i),n.neededFor=function(){return!1},n.prototype.startNotes=function(){return[]},n.prototype.endNotes=function(){return[]},n.prototype.skipNotes=function(){return this.endNotes()},n.prototype.analyzeNoteGroup=function(){var e,t;return this.movementTime=this.calculateMovementMax(this.noteGroup),this.scrubbingTime=(null!=(e=this.noteGroup.playback)&&null!=(t=e.scrub)?t.duration:void 0)||0},n.prototype.calculateMovementMax=function(){for(var t,e,i,n={},o=this.noteGroup.sprites,s=0,r=o.length;s<r;s++)null!=(i=o[s]).move&&(null==n[e=i.id]&&(n[e]=0),n[i.id]+=i.move.duration);return n=function(){var e=[];for(t in n)e.push(n[t]);return e}(),Math.max.apply(Math,[0].concat(a.call(n)))},n.prototype.maybeApplyDelayToNote=function(e){return e.delay=this.scrubbingTime+this.movementTime||0},n)},1477:function(t,e){!function(e){t.exports=e}.call(this,{})},1479:function(a,e,l){!function(n){var o,e,i,s,r={}.hasOwnProperty;function t(){t.__super__.constructor.apply(this,arguments),s.on("change:music",this.onMusicSettingChanged,this)}e=l(45),o=l(1390),s=l(44).me,i=l(1373),a.exports=(function(e,t){for(var i in t)r.call(t,i)&&(e[i]=t[i]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(t,e),t.prototype.currentMusic=null,t.prototype.standingBy=null,t.prototype.subscriptions={"music-player:play-music":"onPlayMusic","audio-player:loaded":"onAudioLoaded","playback:real-time-playback-started":"onRealTimePlaybackStarted","playback:real-time-playback-ended":"onRealTimePlaybackEnded","playback:cinematic-playback-started":"onRealTimePlaybackStarted","playback:cinematic-playback-ended":"onRealTimePlaybackEnded","music-player:enter-menu":"onEnterMenu","music-player:exit-menu":"onExitMenu","level:set-volume":"onSetVolume"},t.prototype.onAudioLoaded=function(e){if(this.standingBy)return this.onPlayMusic(this.standingBy)},t.prototype.onPlayMusic=function(e){var t,i;if(!n.isIPadApp)if(s.get("volume")){if(i=e.file,/^http/.test(i)||(i="/file"+i+o.ext),e.file&&i!==(null!=(t=this.currentMusic)?t.src:void 0))return null!=(t=o.getStatus(i))&&t.loaded?(t=null!=(t=e.delay)?t:0,this.standingBy=null,this.fadeOutCurrentMusic(),e.play?this.startNewMusic(i,t):void 0):(o.preloadSound(i),void(this.standingBy=e));e.play?this.restartCurrentMusic():this.fadeOutCurrentMusic()}else this.lastMusicEventIgnoredWhileMuted=e},t.prototype.restartCurrentMusic=function(){if(this.currentMusic)return this.currentMusic.play({interrupt:"none",delay:0,offset:0,loop:-1,volume:.3}),this.updateMusicVolume()},t.prototype.fadeOutCurrentMusic=function(){var e;if(this.currentMusic)return i.Tween.removeTweens(this.currentMusic),e=function(){return this.stop()},i.Tween.get(this.currentMusic).to({volume:0},1500).call(e)},t.prototype.startNewMusic=function(e,t){if(e&&(this.currentMusic=i.Sound.play(e,{interrupt:"none",delay:0,offset:0,loop:-1,volume:.3})),this.currentMusic)return this.currentMusic.volume=0,s.get("music",!0)?i.Tween.get(this.currentMusic).wait(t).to({volume:.6},1500):void 0},t.prototype.onMusicSettingChanged=function(){return this.updateMusicVolume()},t.prototype.updateMusicVolume=function(){if(this.currentMusic)return i.Tween.removeTweens(this.currentMusic),this.currentMusic.volume=s.get("music",!0)?.6:0},t.prototype.onRealTimePlaybackStarted=function(e){var t;return this.previousMusic=this.currentMusic,t=_.random(0,2),Backbone.Mediator.publish("music-player:play-music",{file:"/music/music_real_time_"+t,play:!0})},t.prototype.onRealTimePlaybackEnded=function(e){if(this.fadeOutCurrentMusic(),this.previousMusic&&(this.currentMusic=this.previousMusic,this.restartCurrentMusic(),this.currentMusic.volume))return i.Tween.get(this.currentMusic).wait(5e3).to({volume:.6},1500)},t.prototype.onEnterMenu=function(e){if(!this.inMenu)return this.inMenu=!0,this.previousMusic=this.currentMusic,Backbone.Mediator.publish("music-player:play-music",{file:"/music/music-menu",play:!0,delay:1e3})},t.prototype.onExitMenu=function(e){if(this.inMenu)return this.inMenu=!1,this.fadeOutCurrentMusic(),this.previousMusic?(this.currentMusic=this.previousMusic,this.restartCurrentMusic()):void 0},t.prototype.onSetVolume=function(e){if(e.volume&&this.lastMusicEventIgnoredWhileMuted)return this.onPlayMusic(this.lastMusicEventIgnoredWhileMuted),this.lastMusicEventIgnoredWhileMuted=null},t.prototype.destroy=function(){return s.off("change:music",this.onMusicSettingChanged,this),this.fadeOutCurrentMusic(),t.__super__.destroy.call(this)},t)}.call(this,l(17))},1480:function(c,e,h){!function(n){var e,t,o,s,r,i,a={}.hasOwnProperty;function l(){return l.__super__.constructor.apply(this,arguments)}e=h(80),i=h(1518),t=h(622),s=h(27),r=h(627).sendContactMessage,o={additionalProperties:!1,required:["email","message"],properties:{email:{type:"string",maxLength:100,minLength:1,format:"email"},message:{type:"string",minLength:1}}},c.exports=(function(e,t){for(var i in t)a.call(t,i)&&(e[i]=t[i]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(l,e),l.prototype.id="contact-modal",l.prototype.template=i,l.prototype.closeButton=!0,l.prototype.events={"click #contact-submit-button":"contact",'click [data-toggle="coco-modal"][data-target="core/SubscribeModal"]':"openSubscribeModal"},l.prototype.openSubscribeModal=function(e){return e.stopPropagation(),this.openModalView(new t)},l.prototype.contact=function(){var e,t,i;return this.playSound("menu-button-click"),s.clearFormAlerts(this.$el),e=s.formToObject(this.$el),(i=tv4.validateMultiple(e,o)).valid?(this.populateBrowserData(e),(e=_.merge(e,this.options)).country=me.get("country"),null!=(t=window.tracker)&&t.trackEvent("Sent Feedback",{message:e}),r(e,this.$el),n.post("/db/user/"+me.id+"/track/contact_codecombat")):s.applyErrorsToForm(this.$el,i.errors)},l.prototype.populateBrowserData=function(e){var t;return n.browser&&(e.browser=n.browser.platform+" "+n.browser.name+" "+n.browser.versionNumber),e.screenSize=(null!=(t="undefined"!=typeof screen&&null!==screen?screen.width:void 0)?t:n(window).width())+" x "+(null!=(t="undefined"!=typeof screen&&null!==screen?screen.height:void 0)?t:n(window).height()),e.screenshotURL=this.screenshotURL},l.prototype.updateScreenshot=function(){var e;if(this.screenshotURL)return(e=this.$el.find("#contact-screenshot").removeClass("secret")).find("a").prop("href",this.screenshotURL.replace("http://codecombat.com/","/")),e.find("img").prop("src",this.screenshotURL.replace("http://codecombat.com/","/"))},l)}.call(this,h(3))},1481:function(e,t,i){var o,n,s,r,a,l=function(e,t){return function(){return e.apply(t,arguments)}},c={}.hasOwnProperty,h=[].slice;function u(e){var t,i,n;for(this.onDebugWorkerMessage=l(this.onDebugWorkerMessage,this),this.retrieveValueFromFrame=l(this.retrieveValueFromFrame,this),null==e&&(e={}),this.retrieveValueFromFrame=_.throttle(this.retrieveValueFromFrame,1e3),null==this.gameUIState&&(this.gameUIState=e.gameUIState||new s),this.indefiniteLength=e.indefiniteLength||!1,u.__super__.constructor.call(this),this.angelsShare={workerCode:e.workerCode||"/javascripts/workers/worker_world.js",headless:e.headless,spectate:e.spectate,god:this,godNick:this.nick,gameUIState:this.gameUIState,workQueue:[],firstWorld:!0,world:void 0,goalManager:void 0,worldClassMap:void 0,angels:[],busyAngels:[]},t=i=0,n=null!=e.maxAngels?e.maxAngels:a.application.isIPadApp||this.indefiniteLength?1:2;0<=n?i<n:n<i;t=0<=n?++i:--i)_.delay(function(e){return function(){if(!e.destroyed)return new o(e.angelsShare)}}(this),250*t)}i(81).now,i(271),n=i(45),o=i(1520),s=i(1381),r=i(58),a=i(53),e.exports=(function(e,t){for(var i in t)c.call(t,i)&&(e[i]=t[i]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(u,n),u.nicks=["Athena","Baldr","Crom","Dagr","Eris","Freyja","Great Gish","Hades","Ishtar","Janus","Khronos","Loki","Marduk","Negafook","Odin","Poseidon","Quetzalcoatl","Ra","Shiva","Thor","Umvelinqangi","Tr","Vishnu","Wepwawet","Xipe Totec","Yahweh","Zeus","","Tiamat","","Phoebe","Artemis","Osiris","","Anhur","Teshub","Enlil","Perkele","Chaos","Hera","Iris","Theia","Uranus","Stribog","Sabazios","Izanagi","Ao","Twhirimtea","Tengri","Inmar","Torngarsuk","Centzonhuitznahua","Hunab Ku","Apollo","Helios","Thoth","Hyperion","Alectrona","Eos","Mitra","Saranyu","Freyr","Koyash","Atropos","Clotho","Lachesis","Tyche","Skuld","Urr","Verandi","Camaxtli","Huhetotl","Set","Anu","Allah","Anshar","Hermes","Lugh","Brigit","Manannan Mac Lir","Persephone","Mercury","Venus","Mars","Azrael","He-Man","Anansi","Issek","Mog","Kos","Amaterasu Omikami","Raijin","Susanowo","Blind Io","The Lady","Offler","Ptah","Anubis","Ereshkigal","Nergal","Thanatos","Macaria","Angelos","Erebus","Hecate","Hel","Orcus","Ishtar-Deela Nakh","Prometheus","Hephaestos","Sekhmet","Ares","Enyo","Otrera","Pele","Hadr","Hachiman","Dayisun Tngri","Ullr","Lua","Minerva"],u.prototype.subscriptions={"tome:cast-spells":"onTomeCast","tome:spell-debug-value-request":"retrieveValueFromFrame","god:new-world-created":"onNewWorldCreated"},u.prototype.destroy=function(){for(var e,t=this.angelsShare.angels.slice(),i=0,n=t.length;i<n;i++)t[i].destroy();return null!=(e=this.angelsShare.goalManager)&&e.destroy(),null!=(e=this.debugWorker)&&e.terminate(),null!=(e=this.debugWorker)&&e.removeEventListener("message",this.onDebugWorkerMessage),u.__super__.destroy.call(this)},u.prototype.setLevel=function(e){this.level=e},u.prototype.setLevelSessionIDs=function(e){this.levelSessionIDs=e},u.prototype.setGoalManager=function(e){var t;return this.angelsShare.goalManager!==e&&null!=(t=this.angelsShare.goalManager)&&t.destroy(),this.angelsShare.goalManager=e},u.prototype.setWorldClassMap=function(e){return this.angelsShare.worldClassMap=e},u.prototype.onTomeCast=function(o){var s;if(o.god===this)return this.lastSubmissionCount=o.submissionCount,this.lastFixedSeed=o.fixedSeed,this.lastFlagHistory=function(){for(var e=o.flagHistory,t=[],i=0,n=e.length;i<n;i++)"code"!==(s=e[i]).source&&t.push(s);return t}(),this.lastDifficulty=o.difficulty,this.createWorld(o)},u.prototype.createWorld=function(e){var t,i,n,o,s,r,a,l,c,h,u=e.spells,p=e.preload,d=e.realTime,m=e.justBegin,f=e.keyValueDb,e=e.synchronous;for(console.log(this.nick+": Let there be light upon "+this.level.name+"! (preload: "+p+")"),h=this.getUserCodeMap(u),i=!1,o=0,r=(l=this.angelsShare.busyAngels.slice()).length;o<r;o++)if(n=(t=l[o]).running&&t.work.preload&&_.isEqual(t.work.userCodeMap,h,function(e,t){if(null!=(null!=e?e.raw:void 0)&&null!=(null!=t?t.raw:void 0))return e.raw===t.raw}),i||!n||d){if(p&&t.running&&!t.work.preload)return;t.abort()}else t.finalizePreload(),i=!0;if(!i){for(this.angelsShare.workQueue=[],f={userCodeMap:h,level:this.level,levelSessionIDs:this.levelSessionIDs,submissionCount:this.lastSubmissionCount,fixedSeed:this.lastFixedSeed,flagHistory:this.lastFlagHistory,difficulty:this.lastDifficulty,goals:null!=(u=this.angelsShare.goalManager)?u.getGoals():void 0,headless:this.angelsShare.headless,preload:p,synchronous:null!=e?e:"undefined"==typeof Worker||null===Worker,realTime:d,justBegin:m,indefiniteLength:this.indefiniteLength&&d,keyValueDb:f,language:me.get("preferredLanguage",!0)},this.angelsShare.workQueue.push(f),s=0,a=(c=this.angelsShare.angels).length;s<a;s++)(t=c[s]).workIfIdle();return f}},u.prototype.getUserCodeMap=function(e){var t,i,n,o={};for(n in e)(null!=o[t=(i=e[n]).thang.thang.id]?o[t]:o[t]={})[i.name]=i.thang.aether.serialize();return o},u.prototype.retrieveValueFromFrame=function(e){var t;if(!this.destroyed&&e.thangID&&e.spellID&&e.variableChain)return this.currentUserCodeMap?(null==this.debugWorker&&(this.debugWorker=this.createDebugWorker()),null==e.frame&&(e.frame=this.angelsShare.world.age/this.angelsShare.world.dt),this.debugWorker.postMessage({func:"retrieveValueFromFrame",args:{userCodeMap:this.currentUserCodeMap,level:this.level,levelSessionIDs:this.levelSessionIDs,submissionCount:this.lastSubmissionCount,fixedSeed:this.fixedSeed,flagHistory:this.lastFlagHistory,difficulty:this.lastDifficulty,goals:null!=(t=this.goalManager)?t.getGoals():void 0,frame:e.frame,currentThangID:e.thangID,currentSpellID:e.spellID,variableChain:e.variableChain}})):console.error("Tried to retrieve debug value with no currentUserCodeMap")},u.prototype.createDebugWorker=function(){var e=new Worker("/javascripts/workers/worker_world.js");return e.addEventListener("message",this.onDebugWorkerMessage),e.addEventListener("error",r.onWorkerError),e},u.prototype.onDebugWorkerMessage=function(e){switch(e.data.type){case"console-log":return console.log.apply(console,["|"+this.nick+"'s debugger|"].concat(h.call(e.data.args)));case"debug-value-return":return Backbone.Mediator.publish("god:debug-value-return",e.data.serialized,{god:this});case"debug-world-load-progress-changed":return Backbone.Mediator.publish("god:debug-world-load-progress-changed",{progress:e.data.progress,god:this})}},u.prototype.onNewWorldCreated=function(e){return this.currentUserCodeMap=this.filterUserCodeMapWhenFromWorld(e.world.userCodeMap)},u.prototype.filterUserCodeMapWhenFromWorld=function(e){var t,i,n,o,s={};for(o in e)for(i in n=e[o],s[o]={},n)t=n[i],t=_.pick(t,["raw","pure","originalOptions"]),s[o][i]=_.cloneDeep(t),s[o][i]=_.defaults(s[o][i],{flow:{},metrics:{},problems:{errors:[],infos:[],warnings:[]},style:{}});return s},u)},1482:function(e,t,i){"use strict";i.r(t);var n,o=i(1544),s=i(1432);for(n in s)["default"].indexOf(n)<0&&function(e){i.d(t,e,function(){return s[e]})}(n);i(1522);var r=i(19),o=Object(r.a)(s.default,o.a,o.b,!1,null,"69bcb9ed",null);t.default=o.exports},1485:function(e,t,i){!function(o,w){!function n(o,s,r){function a(i,e){if(!s[i]){if(!o[i]){if(0,l)return l(i,!0);var t=new Error("Cannot find module '"+i+"'");throw t.code="MODULE_NOT_FOUND",t}t=s[i]={exports:{}};o[i][0].call(t.exports,function(e){var t=o[i][1][e];return a(t||e)},t,t.exports,n,o,s,r)}return s[i].exports}for(var l=!1,e=0;e<r.length;e++)a(r[e]);return a}({1:[function(e,t,i){"use strict";i.byteLength=function(e){return 3*e.length/4-u(e)},i.toByteArray=function(e){var t,i,n,o,s,r=e.length;o=u(e),s=new h(3*r/4-o),i=0<o?r-4:r;var a=0;for(t=0;t<i;t+=4,0)n=c[e.charCodeAt(t)]<<18|c[e.charCodeAt(t+1)]<<12|c[e.charCodeAt(t+2)]<<6|c[e.charCodeAt(t+3)],s[a++]=n>>16&255,s[a++]=n>>8&255,s[a++]=255&n;2===o?(n=c[e.charCodeAt(t)]<<2|c[e.charCodeAt(t+1)]>>4,s[a++]=255&n):1===o&&(n=c[e.charCodeAt(t)]<<10|c[e.charCodeAt(t+1)]<<4|c[e.charCodeAt(t+2)]>>2,s[a++]=n>>8&255,s[a++]=255&n);return s},i.fromByteArray=function(e){for(var t,i=e.length,n=i%3,o="",s=[],r=0,a=i-n;r<a;r+=16383)s.push(function(e,t,i){for(var n,o=[],s=t;s<i;s+=3)n=(e[s]<<16)+(e[s+1]<<8)+e[s+2],o.push(function(e){return l[e>>18&63]+l[e>>12&63]+l[e>>6&63]+l[63&e]}(n));return o.join("")}(e,r,a<r+16383?a:r+16383));1==n?(t=e[i-1],o+=l[t>>2],o+=l[t<<4&63],o+="=="):2==n&&(t=(e[i-2]<<8)+e[i-1],o+=l[t>>10],o+=l[t>>4&63],o+=l[t<<2&63],o+="=");return s.push(o),s.join("")};for(var l=[],c=[],h="undefined"!=typeof Uint8Array?Uint8Array:Array,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=0,s=n.length;o<s;++o)l[o]=n[o],c[n.charCodeAt(o)]=o;function u(e){var t=e.length;if(0<t%4)throw new Error("Invalid string. Length must be a multiple of 4");return"="===e[t-2]?2:"="===e[t-1]?1:0}c["-".charCodeAt(0)]=62,c["_".charCodeAt(0)]=63},{}],2:[function(e,t,i){},{}],3:[function(i,e,n){!function(o){"use strict";var e=i("buffer"),a=e.Buffer,t=e.SlowBuffer,l=e.kMaxLength||2147483647;n.alloc=function(e,t,i){if("function"==typeof a.alloc)return a.alloc(e,t,i);if("number"==typeof i)throw new TypeError("encoding must not be number");if("number"!=typeof e)throw new TypeError("size must be a number");if(l<e)throw new RangeError("size is too large");void 0===t&&(i=void 0,t=0);var n=new a(e);if("string"==typeof t)for(var o=new a(t,i),s=o.length,r=-1;++r<e;)n[r]=o[r%s];else n.fill(t);return n},n.allocUnsafe=function(e){if("function"==typeof a.allocUnsafe)return a.allocUnsafe(e);if("number"!=typeof e)throw new TypeError("size must be a number");if(l<e)throw new RangeError("size is too large");return new a(e)},n.from=function(e,t,i){if("function"==typeof a.from&&(!o.Uint8Array||Uint8Array.from!==a.from))return a.from(e,t,i);if("number"==typeof e)throw new TypeError('"value" argument must not be a number');if("string"==typeof e)return new a(e,t);if("undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer){t=t;if(1===arguments.length)return new a(e);void 0===t&&(t=0);var n=i;if(void 0===n&&(n=e.byteLength-t),t>=e.byteLength)throw new RangeError("'offset' is out of bounds");if(n>e.byteLength-t)throw new RangeError("'length' is out of bounds");return new a(e.slice(t,t+n))}if(a.isBuffer(e)){n=new a(e.length);return e.copy(n,0,0,e.length),n}if(e){if(Array.isArray(e)||"undefined"!=typeof ArrayBuffer&&e.buffer instanceof ArrayBuffer||"length"in e)return new a(e);if("Buffer"===e.type&&Array.isArray(e.data))return new a(e.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")},n.allocUnsafeSlow=function(e){if("function"==typeof a.allocUnsafeSlow)return a.allocUnsafeSlow(e);if("number"!=typeof e)throw new TypeError("size must be a number");if(l<=e)throw new RangeError("size is too large");return new t(e)}}.call(this,void 0!==o?o:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{buffer:4}],4:[function(R,e,P){!function(e){
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
 * @license  MIT
 */
"use strict";var a=R("base64-js"),s=R("ieee754"),r=R("isarray");function i(){return u.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function o(e,t){if(i()<t)throw new RangeError("Invalid typed array length");return u.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=u.prototype:(e=null===e?new u(t):e).length=t,e}function u(e,t,i){if(!(u.TYPED_ARRAY_SUPPORT||this instanceof u))return new u(e,t,i);if("number"!=typeof e)return n(this,e,t,i);if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return c(this,e)}function n(e,t,i,n){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,i,n){if(t.byteLength,i<0||t.byteLength<i)throw new RangeError("'offset' is out of bounds");if(t.byteLength<i+(n||0))throw new RangeError("'length' is out of bounds");t=void 0===i&&void 0===n?new Uint8Array(t):void 0===n?new Uint8Array(t,i):new Uint8Array(t,i,n);u.TYPED_ARRAY_SUPPORT?(e=t).__proto__=u.prototype:e=h(e,t);return e}(e,t,i,n):"string"==typeof t?function(e,t,i){"string"==typeof i&&""!==i||(i="utf8");if(!u.isEncoding(i))throw new TypeError('"encoding" must be a valid string encoding');var n=0|d(t,i),i=(e=o(e,n)).write(t,i);i!==n&&(e=e.slice(0,i));return e}(e,t,i):function(e,t){if(u.isBuffer(t)){var i=0|p(t.length);return 0===(e=o(e,i)).length?e:(t.copy(e,0,0,i),e)}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||function(e){return e!=e}(t.length)?o(e,0):h(e,t);if("Buffer"===t.type&&r(t.data))return h(e,t.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function l(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function c(e,t){if(l(t),e=o(e,t<0?0:0|p(t)),!u.TYPED_ARRAY_SUPPORT)for(var i=0;i<t;++i)e[i]=0;return e}function h(e,t){var i=t.length<0?0:0|p(t.length);e=o(e,i);for(var n=0;n<i;n+=1)e[n]=255&t[n];return e}function p(e){if(e>=i())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+i().toString(16)+" bytes");return 0|e}function d(e,t){if(u.isBuffer(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;var i=(e="string"!=typeof e?""+e:e).length;if(0===i)return 0;for(var n=!1;;)switch(t){case"ascii":case"latin1":case"binary":return i;case"utf8":case"utf-8":case void 0:return D(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*i;case"hex":return i>>>1;case"base64":return I(e).length;default:if(n)return D(e).length;t=(""+t).toLowerCase(),n=!0}}function t(e,t,i){var n,o,s,r=!1;if((t=void 0===t||t<0?0:t)>this.length)return"";if((i=void 0===i||i>this.length?this.length:i)<=0)return"";if((i>>>=0)<=(t>>>=0))return"";for(e=e||"utf8";;)switch(e){case"hex":return function(e,t,i){var n=e.length;(!t||t<0)&&(t=0);(!i||i<0||n<i)&&(i=n);for(var o="",s=t;s<i;++s)o+=function(e){return e<16?"0"+e.toString(16):e.toString(16)}(e[s]);return o}(this,t,i);case"utf8":case"utf-8":return b(this,t,i);case"ascii":return function(e,t,i){var n="";i=Math.min(e.length,i);for(var o=t;o<i;++o)n+=String.fromCharCode(127&e[o]);return n}(this,t,i);case"latin1":case"binary":return function(e,t,i){var n="";i=Math.min(e.length,i);for(var o=t;o<i;++o)n+=String.fromCharCode(e[o]);return n}(this,t,i);case"base64":return n=this,s=i,0===(o=t)&&s===n.length?a.fromByteArray(n):a.fromByteArray(n.slice(o,s));case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return function(e,t,i){for(var n=e.slice(t,i),o="",s=0;s<n.length;s+=2)o+=String.fromCharCode(n[s]+256*n[s+1]);return o}(this,t,i);default:if(r)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),r=!0}}function m(e,t,i){var n=e[t];e[t]=e[i],e[i]=n}function f(e,t,i,n,o){if(0===e.length)return-1;if("string"==typeof i?(n=i,i=0):2147483647<i?i=2147483647:i<-2147483648&&(i=-2147483648),i=+i,(i=(i=isNaN(i)?o?0:e.length-1:i)<0?e.length+i:i)>=e.length){if(o)return-1;i=e.length-1}else if(i<0){if(!o)return-1;i=0}if("string"==typeof t&&(t=u.from(t,n)),u.isBuffer(t))return 0===t.length?-1:g(e,t,i,n,o);if("number"==typeof t)return t&=255,u.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?(o?Uint8Array.prototype.indexOf:Uint8Array.prototype.lastIndexOf).call(e,t,i):g(e,[t],i,n,o);throw new TypeError("val must be string, number or Buffer")}function g(e,t,i,n,o){var s=1,r=e.length,a=t.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return-1;r/=s=2,a/=2,i/=2}function l(e,t){return 1===s?e[t]:e.readUInt16BE(t*s)}if(o)for(var c=-1,h=i;h<r;h++)if(l(e,h)===l(t,-1===c?0:h-c)){if(h-(c=-1===c?h:c)+1===a)return c*s}else-1!==c&&(h-=h-c),c=-1;else for(h=i=r<i+a?r-a:i;0<=h;h--){for(var u=!0,p=0;p<a;p++)if(l(e,h+p)!==l(t,p)){u=!1;break}if(u)return h}return-1}function y(e,t,i,n){return A(function(e){for(var t=[],i=0;i<e.length;++i)t.push(255&e.charCodeAt(i));return t}(t),e,i,n)}function v(e,t,i,n){return A(function(e,t){for(var i,n,o=[],s=0;s<e.length&&!((t-=2)<0);++s)n=e.charCodeAt(s),i=n>>8,n=n%256,o.push(n),o.push(i);return o}(t,e.length-i),e,i,n)}function b(e,t,i){i=Math.min(e.length,i);for(var n=[],o=t;o<i;){var s,r,a,l,c=e[o],h=null,u=239<c?4:223<c?3:191<c?2:1;if(o+u<=i)switch(u){case 1:c<128&&(h=c);break;case 2:128==(192&(s=e[o+1]))&&127<(l=(31&c)<<6|63&s)&&(h=l);break;case 3:s=e[o+1],r=e[o+2],128==(192&s)&&128==(192&r)&&2047<(l=(15&c)<<12|(63&s)<<6|63&r)&&(l<55296||57343<l)&&(h=l);break;case 4:s=e[o+1],r=e[o+2],a=e[o+3],128==(192&s)&&128==(192&r)&&128==(192&a)&&65535<(l=(15&c)<<18|(63&s)<<12|(63&r)<<6|63&a)&&l<1114112&&(h=l)}null===h?(h=65533,u=1):65535<h&&(h-=65536,n.push(h>>>10&1023|55296),h=56320|1023&h),n.push(h),o+=u}return function(e){var t=e.length;if(t<=_)return String.fromCharCode.apply(String,e);var i="",n=0;for(;n<t;)i+=String.fromCharCode.apply(String,e.slice(n,n+=_));return i}(n)}P.Buffer=u,P.SlowBuffer=function(e){+e!=e&&(e=0);return u.alloc(+e)},P.INSPECT_MAX_BYTES=50,u.TYPED_ARRAY_SUPPORT=void 0!==e.TYPED_ARRAY_SUPPORT?e.TYPED_ARRAY_SUPPORT:function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"==typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(e){return!1}}(),P.kMaxLength=i(),u.poolSize=8192,u._augment=function(e){return e.__proto__=u.prototype,e},u.from=function(e,t,i){return n(null,e,t,i)},u.TYPED_ARRAY_SUPPORT&&(u.prototype.__proto__=Uint8Array.prototype,u.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&u[Symbol.species]===u&&Object.defineProperty(u,Symbol.species,{value:null,configurable:!0})),u.alloc=function(e,t,i){return n=null,t=t,i=i,l(e=e),!(e<=0)&&void 0!==t?"string"==typeof i?o(n,e).fill(t,i):o(n,e).fill(t):o(n,e);var n},u.allocUnsafe=function(e){return c(null,e)},u.allocUnsafeSlow=function(e){return c(null,e)},u.isBuffer=function(e){return!(null==e||!e._isBuffer)},u.compare=function(e,t){if(!u.isBuffer(e)||!u.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var i=e.length,n=t.length,o=0,s=Math.min(i,n);o<s;++o)if(e[o]!==t[o]){i=e[o],n=t[o];break}return i<n?-1:n<i?1:0},u.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},u.concat=function(e,t){if(!r(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return u.alloc(0);if(void 0===t)for(o=t=0;o<e.length;++o)t+=e[o].length;for(var i=u.allocUnsafe(t),n=0,o=0;o<e.length;++o){var s=e[o];if(!u.isBuffer(s))throw new TypeError('"list" argument must be an Array of Buffers');s.copy(i,n),n+=s.length}return i},u.byteLength=d,u.prototype._isBuffer=!0,u.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)m(this,t,t+1);return this},u.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)m(this,t,t+3),m(this,t+1,t+2);return this},u.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)m(this,t,t+7),m(this,t+1,t+6),m(this,t+2,t+5),m(this,t+3,t+4);return this},u.prototype.toString=function(){var e=0|this.length;return 0==e?"":0===arguments.length?b(this,0,e):t.apply(this,arguments)},u.prototype.equals=function(e){if(!u.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===u.compare(this,e)},u.prototype.inspect=function(){var e="",t=P.INSPECT_MAX_BYTES;return 0<this.length&&(e=this.toString("hex",0,t).match(/.{2}/g).join(" "),this.length>t&&(e+=" ... ")),"<Buffer "+e+">"},u.prototype.compare=function(e,t,i,n,o){if(!u.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===i&&(i=e?e.length:0),void 0===n&&(n=0),void 0===o&&(o=this.length),(t=void 0===t?0:t)<0||i>e.length||n<0||o>this.length)throw new RangeError("out of range index");if(o<=n&&i<=t)return 0;if(o<=n)return-1;if(i<=t)return 1;if(this===e)return 0;for(var s=(o>>>=0)-(n>>>=0),r=(i>>>=0)-(t>>>=0),a=Math.min(s,r),l=this.slice(n,o),c=e.slice(t,i),h=0;h<a;++h)if(l[h]!==c[h]){s=l[h],r=c[h];break}return s<r?-1:r<s?1:0},u.prototype.includes=function(e,t,i){return-1!==this.indexOf(e,t,i)},u.prototype.indexOf=function(e,t,i){return f(this,e,t,i,!0)},u.prototype.lastIndexOf=function(e,t,i){return f(this,e,t,i,!1)},u.prototype.write=function(e,t,i,n){if(void 0===t)n="utf8",i=this.length,t=0;else if(void 0===i&&"string"==typeof t)n=t,i=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(i)?(i|=0,void 0===n&&(n="utf8")):(n=i,i=void 0)}var o=this.length-t;if((void 0===i||o<i)&&(i=o),0<e.length&&(i<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");n=n||"utf8";for(var s,r,a,l=!1;;)switch(n){case"hex":return function(e,t,i,n){i=Number(i)||0;var o=e.length-i;if((!n||o<(n=Number(n)))&&(n=o),(o=t.length)%2!=0)throw new TypeError("Invalid hex string");o/2<n&&(n=o/2);for(var s=0;s<n;++s){var r=parseInt(t.substr(2*s,2),16);if(isNaN(r))return s;e[i+s]=r}return s}(this,e,t,i);case"utf8":case"utf-8":return r=t,a=i,A(D(e,(s=this).length-r),s,r,a);case"ascii":return y(this,e,t,i);case"latin1":case"binary":return y(this,e,t,i);case"base64":return s=this,r=t,a=i,A(I(e),s,r,a);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return v(this,e,t,i);default:if(l)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),l=!0}},u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var _=4096;function w(e,t,i){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(i<e+t)throw new RangeError("Trying to access beyond buffer length")}function k(e,t,i,n,o,s){if(!u.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(o<t||t<s)throw new RangeError('"value" argument is out of bounds');if(i+n>e.length)throw new RangeError("Index out of range")}function x(e,t,i,n){t<0&&(t=65535+t+1);for(var o=0,s=Math.min(e.length-i,2);o<s;++o)e[i+o]=(t&255<<8*(n?o:1-o))>>>8*(n?o:1-o)}function S(e,t,i,n){t<0&&(t=4294967295+t+1);for(var o=0,s=Math.min(e.length-i,4);o<s;++o)e[i+o]=t>>>8*(n?o:3-o)&255}function C(e,t,i,n){if(i+n>e.length)throw new RangeError("Index out of range");if(i<0)throw new RangeError("Index out of range")}function T(e,t,i,n,o){return o||C(e,0,i,4),s.write(e,t,i,n,23,4),i+4}function L(e,t,i,n,o){return o||C(e,0,i,8),s.write(e,t,i,n,52,8),i+8}u.prototype.slice=function(e,t){var i=this.length;if((e=~~e)<0?(e+=i)<0&&(e=0):i<e&&(e=i),(t=void 0===t?i:~~t)<0?(t+=i)<0&&(t=0):i<t&&(t=i),t<e&&(t=e),u.TYPED_ARRAY_SUPPORT)(o=this.subarray(e,t)).__proto__=u.prototype;else for(var n=t-e,o=new u(n,void 0),s=0;s<n;++s)o[s]=this[s+e];return o},u.prototype.readUIntLE=function(e,t,i){e|=0,t|=0,i||w(e,t,this.length);for(var n=this[e],o=1,s=0;++s<t&&(o*=256);)n+=this[e+s]*o;return n},u.prototype.readUIntBE=function(e,t,i){e|=0,t|=0,i||w(e,t,this.length);for(var n=this[e+--t],o=1;0<t&&(o*=256);)n+=this[e+--t]*o;return n},u.prototype.readUInt8=function(e,t){return t||w(e,1,this.length),this[e]},u.prototype.readUInt16LE=function(e,t){return t||w(e,2,this.length),this[e]|this[e+1]<<8},u.prototype.readUInt16BE=function(e,t){return t||w(e,2,this.length),this[e]<<8|this[e+1]},u.prototype.readUInt32LE=function(e,t){return t||w(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},u.prototype.readUInt32BE=function(e,t){return t||w(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},u.prototype.readIntLE=function(e,t,i){e|=0,t|=0,i||w(e,t,this.length);for(var n=this[e],o=1,s=0;++s<t&&(o*=256);)n+=this[e+s]*o;return(o*=128)<=n&&(n-=Math.pow(2,8*t)),n},u.prototype.readIntBE=function(e,t,i){e|=0,t|=0,i||w(e,t,this.length);for(var n=t,o=1,s=this[e+--n];0<n&&(o*=256);)s+=this[e+--n]*o;return(o*=128)<=s&&(s-=Math.pow(2,8*t)),s},u.prototype.readInt8=function(e,t){return t||w(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},u.prototype.readInt16LE=function(e,t){t||w(e,2,this.length);e=this[e]|this[e+1]<<8;return 32768&e?4294901760|e:e},u.prototype.readInt16BE=function(e,t){t||w(e,2,this.length);e=this[e+1]|this[e]<<8;return 32768&e?4294901760|e:e},u.prototype.readInt32LE=function(e,t){return t||w(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},u.prototype.readInt32BE=function(e,t){return t||w(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},u.prototype.readFloatLE=function(e,t){return t||w(e,4,this.length),s.read(this,e,!0,23,4)},u.prototype.readFloatBE=function(e,t){return t||w(e,4,this.length),s.read(this,e,!1,23,4)},u.prototype.readDoubleLE=function(e,t){return t||w(e,8,this.length),s.read(this,e,!0,52,8)},u.prototype.readDoubleBE=function(e,t){return t||w(e,8,this.length),s.read(this,e,!1,52,8)},u.prototype.writeUIntLE=function(e,t,i,n){e=+e,t|=0,i|=0,n||k(this,e,t,i,Math.pow(2,8*i)-1,0);var o=1,s=0;for(this[t]=255&e;++s<i&&(o*=256);)this[t+s]=e/o&255;return t+i},u.prototype.writeUIntBE=function(e,t,i,n){e=+e,t|=0,i|=0,n||k(this,e,t,i,Math.pow(2,8*i)-1,0);var o=i-1,s=1;for(this[t+o]=255&e;0<=--o&&(s*=256);)this[t+o]=e/s&255;return t+i},u.prototype.writeUInt8=function(e,t,i){return e=+e,t|=0,i||k(this,e,t,1,255,0),u.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},u.prototype.writeUInt16LE=function(e,t,i){return e=+e,t|=0,i||k(this,e,t,2,65535,0),u.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):x(this,e,t,!0),t+2},u.prototype.writeUInt16BE=function(e,t,i){return e=+e,t|=0,i||k(this,e,t,2,65535,0),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):x(this,e,t,!1),t+2},u.prototype.writeUInt32LE=function(e,t,i){return e=+e,t|=0,i||k(this,e,t,4,4294967295,0),u.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):S(this,e,t,!0),t+4},u.prototype.writeUInt32BE=function(e,t,i){return e=+e,t|=0,i||k(this,e,t,4,4294967295,0),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):S(this,e,t,!1),t+4},u.prototype.writeIntLE=function(e,t,i,n){e=+e,t|=0,n||k(this,e,t,i,(n=Math.pow(2,8*i-1))-1,-n);var o=0,s=1,r=0;for(this[t]=255&e;++o<i&&(s*=256);)e<0&&0===r&&0!==this[t+o-1]&&(r=1),this[t+o]=(e/s>>0)-r&255;return t+i},u.prototype.writeIntBE=function(e,t,i,n){e=+e,t|=0,n||k(this,e,t,i,(n=Math.pow(2,8*i-1))-1,-n);var o=i-1,s=1,r=0;for(this[t+o]=255&e;0<=--o&&(s*=256);)e<0&&0===r&&0!==this[t+o+1]&&(r=1),this[t+o]=(e/s>>0)-r&255;return t+i},u.prototype.writeInt8=function(e,t,i){return e=+e,t|=0,i||k(this,e,t,1,127,-128),u.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&(e=e<0?255+e+1:e),t+1},u.prototype.writeInt16LE=function(e,t,i){return e=+e,t|=0,i||k(this,e,t,2,32767,-32768),u.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):x(this,e,t,!0),t+2},u.prototype.writeInt16BE=function(e,t,i){return e=+e,t|=0,i||k(this,e,t,2,32767,-32768),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):x(this,e,t,!1),t+2},u.prototype.writeInt32LE=function(e,t,i){return e=+e,t|=0,i||k(this,e,t,4,2147483647,-2147483648),u.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):S(this,e,t,!0),t+4},u.prototype.writeInt32BE=function(e,t,i){return e=+e,t|=0,i||k(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):S(this,e,t,!1),t+4},u.prototype.writeFloatLE=function(e,t,i){return T(this,e,t,!0,i)},u.prototype.writeFloatBE=function(e,t,i){return T(this,e,t,!1,i)},u.prototype.writeDoubleLE=function(e,t,i){return L(this,e,t,!0,i)},u.prototype.writeDoubleBE=function(e,t,i){return L(this,e,t,!1,i)},u.prototype.copy=function(e,t,i,n){if(i=i||0,n||0===n||(n=this.length),t>=e.length&&(t=e.length),(n=0<n&&n<i?i:n)===i)return 0;if(0===e.length||0===this.length)return 0;if((t=t||0)<0)throw new RangeError("targetStart out of bounds");if(i<0||i>=this.length)throw new RangeError("sourceStart out of bounds");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length);var o,s=(n=e.length-t<n-i?e.length-t+i:n)-i;if(this===e&&i<t&&t<n)for(o=s-1;0<=o;--o)e[o+t]=this[o+i];else if(s<1e3||!u.TYPED_ARRAY_SUPPORT)for(o=0;o<s;++o)e[o+t]=this[o+i];else Uint8Array.prototype.set.call(e,this.subarray(i,i+s),t);return s},u.prototype.fill=function(e,t,i,n){if("string"==typeof e){var o;if("string"==typeof t?(n=t,t=0,i=this.length):"string"==typeof i&&(n=i,i=this.length),1!==e.length||(o=e.charCodeAt(0))<256&&(e=o),void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!u.isEncoding(n))throw new TypeError("Unknown encoding: "+n)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<i)throw new RangeError("Out of range index");if(i<=t)return this;if(t>>>=0,i=void 0===i?this.length:i>>>0,"number"==typeof(e=e||0))for(a=t;a<i;++a)this[a]=e;else for(var s=u.isBuffer(e)?e:D(new u(e,n).toString()),r=s.length,a=0;a<i-t;++a)this[a+t]=s[a%r];return this};var M=/[^+\/0-9A-Za-z-_]/g;function D(e,t){var i;t=t||1/0;for(var n=e.length,o=null,s=[],r=0;r<n;++r){if(55295<(i=e.charCodeAt(r))&&i<57344){if(!o){if(56319<i){-1<(t-=3)&&s.push(239,191,189);continue}if(r+1===n){-1<(t-=3)&&s.push(239,191,189);continue}o=i;continue}if(i<56320){-1<(t-=3)&&s.push(239,191,189),o=i;continue}i=65536+(o-55296<<10|i-56320)}else o&&-1<(t-=3)&&s.push(239,191,189);if(o=null,i<128){if(--t<0)break;s.push(i)}else if(i<2048){if((t-=2)<0)break;s.push(i>>6|192,63&i|128)}else if(i<65536){if((t-=3)<0)break;s.push(i>>12|224,i>>6&63|128,63&i|128)}else{if(!(i<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;s.push(i>>18|240,i>>12&63|128,i>>6&63|128,63&i|128)}}return s}function I(e){return a.toByteArray(function(e){var t;if((e=((t=e).trim?t.trim():t.replace(/^\s+|\s+$/g,"")).replace(M,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function A(e,t,i,n){for(var o=0;o<n&&!(o+i>=t.length||o>=e.length);++o)t[o+i]=e[o];return o}}.call(this,void 0!==o?o:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"base64-js":1,ieee754:7,isarray:10}],5:[function(e,t,i){!function(e){function t(e){return Object.prototype.toString.call(e)}i.isArray=function(e){return Array.isArray?Array.isArray(e):"[object Array]"===t(e)},i.isBoolean=function(e){return"boolean"==typeof e},i.isNull=function(e){return null===e},i.isNullOrUndefined=function(e){return null==e},i.isNumber=function(e){return"number"==typeof e},i.isString=function(e){return"string"==typeof e},i.isSymbol=function(e){return"symbol"==typeof e},i.isUndefined=function(e){return void 0===e},i.isRegExp=function(e){return"[object RegExp]"===t(e)},i.isObject=function(e){return"object"==typeof e&&null!==e},i.isDate=function(e){return"[object Date]"===t(e)},i.isError=function(e){return"[object Error]"===t(e)||e instanceof Error},i.isFunction=function(e){return"function"==typeof e},i.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},i.isBuffer=e.isBuffer}.call(this,{isBuffer:e("../../is-buffer/index.js")})},{"../../is-buffer/index.js":9}],6:[function(e,t,i){function n(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function l(e){return"function"==typeof e}function c(e){return"object"==typeof e&&null!==e}function h(e){return void 0===e}((t.exports=n).EventEmitter=n).prototype._events=void 0,n.prototype._maxListeners=void 0,n.defaultMaxListeners=10,n.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},n.prototype.emit=function(e){var t,i,n,o,s,r;if(this._events||(this._events={}),"error"===e&&(!this._events.error||c(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;var a=new Error('Uncaught, unspecified "error" event. ('+t+")");throw a.context=t,a}if(h(i=this._events[e]))return!1;if(l(i))switch(arguments.length){case 1:i.call(this);break;case 2:i.call(this,arguments[1]);break;case 3:i.call(this,arguments[1],arguments[2]);break;default:o=Array.prototype.slice.call(arguments,1),i.apply(this,o)}else if(c(i))for(o=Array.prototype.slice.call(arguments,1),n=(r=i.slice()).length,s=0;s<n;s++)r[s].apply(this,o);return!0},n.prototype.on=n.prototype.addListener=function(e,t){var i;if(!l(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,l(t.listener)?t.listener:t),this._events[e]?c(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,c(this._events[e])&&!this._events[e].warned&&(i=h(this._maxListeners)?n.defaultMaxListeners:this._maxListeners)&&0<i&&this._events[e].length>i&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace()),this},n.prototype.once=function(e,t){if(!l(t))throw TypeError("listener must be a function");var i=!1;function n(){this.removeListener(e,n),i||(i=!0,t.apply(this,arguments))}return n.listener=t,this.on(e,n),this},n.prototype.removeListener=function(e,t){var i,n,o,s;if(!l(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(o=(i=this._events[e]).length,n=-1,i===t||l(i.listener)&&i.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(c(i)){for(s=o;0<s--;)if(i[s]===t||i[s].listener&&i[s].listener===t){n=s;break}if(n<0)return this;1===i.length?(i.length=0,delete this._events[e]):i.splice(n,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},n.prototype.removeAllListeners=function(e){var t,i;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(l(i=this._events[e]))this.removeListener(e,i);else if(i)for(;i.length;)this.removeListener(e,i[i.length-1]);return delete this._events[e],this},n.prototype.listeners=function(e){e=this._events&&this._events[e]?l(this._events[e])?[this._events[e]]:this._events[e].slice():[];return e},n.prototype.listenerCount=function(e){if(this._events){e=this._events[e];if(l(e))return 1;if(e)return e.length}return 0},n.listenerCount=function(e,t){return e.listenerCount(t)}},{}],7:[function(e,t,i){i.read=function(e,t,i,n,o){var s,r,a=8*o-n-1,l=(1<<a)-1,c=l>>1,h=-7,u=i?o-1:0,p=i?-1:1,i=e[t+u];for(u+=p,s=i&(1<<-h)-1,i>>=-h,h+=a;0<h;s=256*s+e[t+u],u+=p,h-=8);for(r=s&(1<<-h)-1,s>>=-h,h+=n;0<h;r=256*r+e[t+u],u+=p,h-=8);if(0===s)s=1-c;else{if(s===l)return r?NaN:1/0*(i?-1:1);r+=Math.pow(2,n),s-=c}return(i?-1:1)*r*Math.pow(2,s-n)},i.write=function(e,t,i,n,o,s){var r,a,l=8*s-o-1,c=(1<<l)-1,h=c>>1,u=23===o?Math.pow(2,-24)-Math.pow(2,-77):0,p=n?0:s-1,d=n?1:-1,s=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,r=c):(r=Math.floor(Math.log(t)/Math.LN2),t*(n=Math.pow(2,-r))<1&&(r--,n*=2),2<=(t+=1<=r+h?u/n:u*Math.pow(2,1-h))*n&&(r++,n/=2),c<=r+h?(a=0,r=c):1<=r+h?(a=(t*n-1)*Math.pow(2,o),r+=h):(a=t*Math.pow(2,h-1)*Math.pow(2,o),r=0));8<=o;e[i+p]=255&a,p+=d,a/=256,o-=8);for(r=r<<o|a,l+=o;0<l;e[i+p]=255&r,p+=d,r/=256,l-=8);e[i+p-d]|=128*s}},{}],8:[function(e,t,i){"function"==typeof Object.create?t.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(e,t){e.super_=t;function i(){}i.prototype=t.prototype,e.prototype=new i,e.prototype.constructor=e}},{}],9:[function(e,t,i){function n(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}
/*!
 * Determine if an object is a Buffer
 *
 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
 * @license  MIT
 */
t.exports=function(e){return null!=e&&(n(e)||"function"==typeof(t=e).readFloatLE&&"function"==typeof t.slice&&n(t.slice(0,0))||!!e._isBuffer);var t}},{}],10:[function(e,t,i){var n={}.toString;t.exports=Array.isArray||function(e){return"[object Array]"==n.call(e)}},{}],11:[function(e,t,i){!function(a){"use strict";!a.version||0===a.version.indexOf("v0.")||0===a.version.indexOf("v1.")&&0!==a.version.indexOf("v1.8.")?t.exports=function(e,t,i,n){if("function"!=typeof e)throw new TypeError('"callback" argument must be a function');var o,s,r=arguments.length;switch(r){case 0:case 1:return a.nextTick(e);case 2:return a.nextTick(function(){e.call(null,t)});case 3:return a.nextTick(function(){e.call(null,t,i)});case 4:return a.nextTick(function(){e.call(null,t,i,n)});default:for(o=new Array(r-1),s=0;s<o.length;)o[s++]=arguments[s];return a.nextTick(function(){e.apply(null,o)})}}:t.exports=a.nextTick}.call(this,e("_process"))},{_process:12}],12:[function(e,t,i){var n,o,t=t.exports={};function s(){throw new Error("setTimeout has not been defined")}function r(){throw new Error("clearTimeout has not been defined")}function a(t){if(n===setTimeout)return setTimeout(t,0);if((n===s||!n)&&setTimeout)return n=setTimeout,setTimeout(t,0);try{return n(t,0)}catch(e){try{return n.call(null,t,0)}catch(e){return n.call(this,t,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:s}catch(e){n=s}try{o="function"==typeof clearTimeout?clearTimeout:r}catch(e){o=r}}();var l,c=[],h=!1,u=-1;function p(){h&&l&&(h=!1,l.length?c=l.concat(c):u=-1,c.length&&d())}function d(){if(!h){var e=a(p);h=!0;for(var t=c.length;t;){for(l=c,c=[];++u<t;)l&&l[u].run();u=-1,t=c.length}l=null,h=!1,function(t){if(o===clearTimeout)return clearTimeout(t);if((o===r||!o)&&clearTimeout)return o=clearTimeout,clearTimeout(t);try{o(t)}catch(e){try{return o.call(null,t)}catch(e){return o.call(this,t)}}}(e)}}function m(e,t){this.fun=e,this.array=t}function f(){}t.nextTick=function(e){var t=new Array(arguments.length-1);if(1<arguments.length)for(var i=1;i<arguments.length;i++)t[i-1]=arguments[i];c.push(new m(e,t)),1!==c.length||h||a(d)},m.prototype.run=function(){this.fun.apply(null,this.array)},t.title="browser",t.browser=!0,t.env={},t.argv=[],t.version="",t.versions={},t.on=f,t.addListener=f,t.once=f,t.off=f,t.removeListener=f,t.removeAllListeners=f,t.emit=f,t.binding=function(e){throw new Error("process.binding is not supported")},t.cwd=function(){return"/"},t.chdir=function(e){throw new Error("process.chdir is not supported")},t.umask=function(){return 0}},{}],13:[function(e,t,i){t.exports=e("./lib/_stream_duplex.js")},{"./lib/_stream_duplex.js":14}],14:[function(e,t,i){"use strict";var n=Object.keys||function(e){var t,i=[];for(t in e)i.push(t);return i};t.exports=h;var o=e("process-nextick-args"),t=e("core-util-is");t.inherits=e("inherits");var s=e("./_stream_readable"),r=e("./_stream_writable");t.inherits(h,s);for(var a=n(r.prototype),l=0;l<a.length;l++){var c=a[l];h.prototype[c]||(h.prototype[c]=r.prototype[c])}function h(e){if(!(this instanceof h))return new h(e);s.call(this,e),r.call(this,e),e&&!1===e.readable&&(this.readable=!1),e&&!1===e.writable&&(this.writable=!1),this.allowHalfOpen=!0,e&&!1===e.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",u)}function u(){this.allowHalfOpen||this._writableState.ended||o(p,this)}function p(e){e.end()}},{"./_stream_readable":16,"./_stream_writable":18,"core-util-is":5,inherits:8,"process-nextick-args":11}],15:[function(e,t,i){"use strict";t.exports=o;var n=e("./_stream_transform"),t=e("core-util-is");function o(e){if(!(this instanceof o))return new o(e);n.call(this,e)}t.inherits=e("inherits"),t.inherits(o,n),o.prototype._transform=function(e,t,i){i(null,e)}},{"./_stream_transform":17,"core-util-is":5,inherits:8}],16:[function(M,D,e){!function(g){"use strict";D.exports=l;var y=M("process-nextick-args"),v=M("isarray");l.ReadableState=r;function b(e,t){return e.listeners(t).length}var i;M("events").EventEmitter;!function(){try{i=M("stream")}catch(e){}finally{i=i||M("events").EventEmitter}}();var h=M("buffer").Buffer,a=M("buffer-shims"),e=M("core-util-is");e.inherits=M("inherits");var n,o,t=M("util"),_=void 0,_=t&&t.debuglog?t.debuglog("stream"):function(){},s=M("./internal/streams/BufferList");function r(e,t){o=o||M("./_stream_duplex"),this.objectMode=!!(e=e||{}).objectMode,t instanceof o&&(this.objectMode=this.objectMode||!!e.readableObjectMode);var i=e.highWaterMark,t=this.objectMode?16:16384;this.highWaterMark=i||0===i?i:t,this.highWaterMark=~~this.highWaterMark,this.buffer=new s,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.defaultEncoding=e.defaultEncoding||"utf8",this.ranOut=!1,this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(n=n||M("string_decoder/").StringDecoder,this.decoder=new n(e.encoding),this.encoding=e.encoding)}function l(e){if(o=o||M("./_stream_duplex"),!(this instanceof l))return new l(e);this._readableState=new r(e,this),this.readable=!0,e&&"function"==typeof e.read&&(this._read=e.read),i.call(this)}function c(e,t,i,n,o){var s,r,a,l,c=function(e,t){var i=null;h.isBuffer(t)||"string"==typeof t||null==t||e.objectMode||(i=new TypeError("Invalid non-string/buffer chunk"));return i}(t,i);return c?e.emit("error",c):null===i?(t.reading=!1,a=e,(l=t).ended||(!l.decoder||(c=l.decoder.end())&&c.length&&(l.buffer.push(c),l.length+=l.objectMode?1:c.length),l.ended=!0,d(a))):t.objectMode||i&&0<i.length?t.ended&&!o?(s=new Error("stream.push() after EOF"),e.emit("error",s)):t.endEmitted&&o?(s=new Error("stream.unshift() after end event"),e.emit("error",s)):(!t.decoder||o||n||(i=t.decoder.write(i),r=!t.objectMode&&0===i.length),o||(t.reading=!1),r||(t.flowing&&0===t.length&&!t.sync?(e.emit("data",i),e.read(0)):(t.length+=t.objectMode?1:i.length,o?t.buffer.unshift(i):t.buffer.push(i),t.needReadable&&d(e))),i=e,(e=t).readingMore||(e.readingMore=!0,y(f,i,e))):o||(t.reading=!1),!(t=t).ended&&(t.needReadable||t.length<t.highWaterMark||0===t.length)}e.inherits(l,i),l.prototype.push=function(e,t){var i=this._readableState;return i.objectMode||"string"!=typeof e||(t=t||i.defaultEncoding)!==i.encoding&&(e=a.from(e,t),t=""),c(this,i,e,t,!1)},l.prototype.unshift=function(e){return c(this,this._readableState,e,"",!0)},l.prototype.isPaused=function(){return!1===this._readableState.flowing},l.prototype.setEncoding=function(e){return n=n||M("string_decoder/").StringDecoder,this._readableState.decoder=new n(e),this._readableState.encoding=e,this};var u=8388608;function p(e,t){return e<=0||0===t.length&&t.ended?0:t.objectMode?1:e!=e?(t.flowing&&t.length?t.buffer.head.data:t).length:(e>t.highWaterMark&&(t.highWaterMark=(u<=(i=e)?i=u:(i--,i|=i>>>1,i|=i>>>2,i|=i>>>4,i|=i>>>8,i|=i>>>16,i++),i)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0));var i}function d(e){var t=e._readableState;t.needReadable=!1,t.emittedReadable||(_("emitReadable",t.flowing),t.emittedReadable=!0,t.sync?y(m,e):m(e))}function m(e){_("emit readable"),e.emit("readable"),x(e)}function f(e,t){for(var i=t.length;!t.reading&&!t.flowing&&!t.ended&&t.length<t.highWaterMark&&(_("maybeReadMore read 0"),e.read(0),i!==t.length);)i=t.length;t.readingMore=!1}function w(e){_("readable nexttick read 0"),e.read(0)}function k(e,t){t.reading||(_("resume read 0"),e.read(0)),t.resumeScheduled=!1,t.awaitDrain=0,e.emit("resume"),x(e),t.flowing&&!t.reading&&e.read(0)}function x(e){var t=e._readableState;for(_("flow",t.flowing);t.flowing&&null!==e.read(););}function S(e,t){return 0===t.length?null:(t.objectMode?i=t.buffer.shift():!e||e>=t.length?(i=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.head.data:t.buffer.concat(t.length),t.buffer.clear()):i=function(e,t,i){var n;e<t.head.data.length?(n=t.head.data.slice(0,e),t.head.data=t.head.data.slice(e)):n=e===t.head.data.length?t.shift():(i?function(e,t){var i=t.head,n=1,o=i.data;e-=o.length;for(;i=i.next;){var s=i.data,r=e>s.length?s.length:e;if(r===s.length?o+=s:o+=s.slice(0,e),0===(e-=r)){r===s.length?(++n,i.next?t.head=i.next:t.head=t.tail=null):(t.head=i).data=s.slice(r);break}++n}return t.length-=n,o}:function(e,t){var i=a.allocUnsafe(e),n=t.head,o=1;n.data.copy(i),e-=n.data.length;for(;n=n.next;){var s=n.data,r=e>s.length?s.length:e;if(s.copy(i,i.length-e,0,r),0===(e-=r)){r===s.length?(++o,n.next?t.head=n.next:t.head=t.tail=null):(t.head=n).data=s.slice(r);break}++o}return t.length-=o,i})(e,t);return n}(e,t.buffer,t.decoder),i);var i}function C(e){var t=e._readableState;if(0<t.length)throw new Error('"endReadable()" called on non-empty stream');t.endEmitted||(t.ended=!0,y(T,t,e))}function T(e,t){e.endEmitted||0!==e.length||(e.endEmitted=!0,t.readable=!1,t.emit("end"))}function L(e,t){for(var i=0,n=e.length;i<n;i++)if(e[i]===t)return i;return-1}l.prototype.read=function(e){_("read",e),e=parseInt(e,10);var t=this._readableState,i=e;if(0!==e&&(t.emittedReadable=!1),0===e&&t.needReadable&&(t.length>=t.highWaterMark||t.ended))return _("read: emitReadable",t.length,t.ended),(0===t.length&&t.ended?C:d)(this),null;if(0===(e=p(e,t))&&t.ended)return 0===t.length&&C(this),null;var n=t.needReadable;return _("need readable",n),(0===t.length||t.length-e<t.highWaterMark)&&_("length less than watermark",n=!0),t.ended||t.reading?_("reading or ended",n=!1):n&&(_("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=p(i,t))),null===(n=0<e?S(e,t):null)?(t.needReadable=!0,e=0):t.length-=e,0===t.length&&(t.ended||(t.needReadable=!0),i!==e&&t.ended&&C(this)),null!==n&&this.emit("data",n),n},l.prototype._read=function(e){this.emit("error",new Error("not implemented"))},l.prototype.pipe=function(t,e){var i=this,n=this._readableState;switch(n.pipesCount){case 0:n.pipes=t;break;case 1:n.pipes=[n.pipes,t];break;default:n.pipes.push(t)}n.pipesCount+=1,_("pipe count=%d opts=%j",n.pipesCount,e);e=(!e||!1!==e.end)&&t!==g.stdout&&t!==g.stderr?s:c;function o(e){_("onunpipe"),e===i&&c()}function s(){_("onend"),t.end()}n.endEmitted?y(e):i.once("end",e),t.on("unpipe",o);var r,a=(r=i,function(){var e=r._readableState;_("pipeOnDrain",e.awaitDrain),e.awaitDrain&&e.awaitDrain--,0===e.awaitDrain&&b(r,"data")&&(e.flowing=!0,x(r))});t.on("drain",a);var l=!1;function c(){_("cleanup"),t.removeListener("close",d),t.removeListener("finish",m),t.removeListener("drain",a),t.removeListener("error",p),t.removeListener("unpipe",o),i.removeListener("end",s),i.removeListener("end",c),i.removeListener("data",u),l=!0,!n.awaitDrain||t._writableState&&!t._writableState.needDrain||a()}var h=!1;function u(e){_("ondata"),(h=!1)!==t.write(e)||h||((1===n.pipesCount&&n.pipes===t||1<n.pipesCount&&-1!==L(n.pipes,t))&&!l&&(_("false write response, pause",i._readableState.awaitDrain),i._readableState.awaitDrain++,h=!0),i.pause())}function p(e){_("onerror",e),f(),t.removeListener("error",p),0===b(t,"error")&&t.emit("error",e)}function d(){t.removeListener("finish",m),f()}function m(){_("onfinish"),t.removeListener("close",d),f()}function f(){_("unpipe"),i.unpipe(t)}return i.on("data",u),function(e,t,i){if("function"==typeof e.prependListener)return e.prependListener(t,i);e._events&&e._events[t]?v(e._events[t])?e._events[t].unshift(i):e._events[t]=[i,e._events[t]]:e.on(t,i)}(t,"error",p),t.once("close",d),t.once("finish",m),t.emit("pipe",i),n.flowing||(_("pipe resume"),i.resume()),t},l.prototype.unpipe=function(e){var t=this._readableState;if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes||(e=e||t.pipes,t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this)),this;if(!e){var i=t.pipes,n=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var o=0;o<n;o++)i[o].emit("unpipe",this);return this}var s=L(t.pipes,e);return-1===s||(t.pipes.splice(s,1),--t.pipesCount,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this)),this},l.prototype.on=function(e,t){t=i.prototype.on.call(this,e,t);return"data"===e?!1!==this._readableState.flowing&&this.resume():"readable"===e&&((e=this._readableState).endEmitted||e.readableListening||(e.readableListening=e.needReadable=!0,e.emittedReadable=!1,e.reading?e.length&&d(this):y(w,this))),t},l.prototype.addListener=l.prototype.on,l.prototype.resume=function(){var e,t=this._readableState;return t.flowing||(_("resume"),t.flowing=!0,e=this,(t=t).resumeScheduled||(t.resumeScheduled=!0,y(k,e,t))),this},l.prototype.pause=function(){return _("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(_("pause"),this._readableState.flowing=!1,this.emit("pause")),this},l.prototype.wrap=function(t){var e,i=this._readableState,n=!1,o=this;for(e in t.on("end",function(){var e;_("wrapped end"),!i.decoder||i.ended||(e=i.decoder.end())&&e.length&&o.push(e),o.push(null)}),t.on("data",function(e){_("wrapped data"),i.decoder&&(e=i.decoder.write(e)),i.objectMode&&null==e||(i.objectMode||e&&e.length)&&(o.push(e)||(n=!0,t.pause()))}),t)void 0===this[e]&&"function"==typeof t[e]&&(this[e]=function(e){return function(){return t[e].apply(t,arguments)}}(e));return function(e,t){for(var i=0,n=e.length;i<n;i++)t(e[i],i)}(["error","close","destroy","pause","resume"],function(e){t.on(e,o.emit.bind(o,e))}),o._read=function(e){_("wrapped _read",e),n&&(n=!1,t.resume())},o},l._fromList=S}.call(this,M("_process"))},{"./_stream_duplex":14,"./internal/streams/BufferList":19,_process:12,buffer:4,"buffer-shims":3,"core-util-is":5,events:6,inherits:8,isarray:10,"process-nextick-args":11,"string_decoder/":25,util:2}],17:[function(e,t,i){"use strict";t.exports=s;var n=e("./_stream_duplex"),t=e("core-util-is");function o(i){this.afterTransform=function(e,t){return function(e,t,i){var n=e._transformState;n.transforming=!1;var o=n.writecb;if(!o)return e.emit("error",new Error("no writecb in Transform class"));n.writechunk=null,(n.writecb=null)!=i&&e.push(i);o(t);t=e._readableState;t.reading=!1,(t.needReadable||t.length<t.highWaterMark)&&e._read(t.highWaterMark)}(i,e,t)},this.needTransform=!1,this.transforming=!1,this.writecb=null,this.writechunk=null,this.writeencoding=null}function s(e){if(!(this instanceof s))return new s(e);n.call(this,e),this._transformState=new o(this);var t=this;this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush&&(this._flush=e.flush)),this.once("prefinish",function(){"function"==typeof this._flush?this._flush(function(e){r(t,e)}):r(t)})}function r(e,t){if(t)return e.emit("error",t);var i=e._writableState,t=e._transformState;if(i.length)throw new Error("Calling transform done when ws.length != 0");if(t.transforming)throw new Error("Calling transform done when still transforming");return e.push(null)}t.inherits=e("inherits"),t.inherits(s,n),s.prototype.push=function(e,t){return this._transformState.needTransform=!1,n.prototype.push.call(this,e,t)},s.prototype._transform=function(e,t,i){throw new Error("Not implemented")},s.prototype._write=function(e,t,i){var n=this._transformState;n.writecb=i,n.writechunk=e,n.writeencoding=t,n.transforming||(t=this._readableState,(n.needTransform||t.needReadable||t.length<t.highWaterMark)&&this._read(t.highWaterMark))},s.prototype._read=function(e){var t=this._transformState;null!==t.writechunk&&t.writecb&&!t.transforming?(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform)):t.needTransform=!0}},{"./_stream_duplex":14,"core-util-is":5,inherits:8}],18:[function(b,_,e){!function(e){"use strict";_.exports=s;var u=b("process-nextick-args"),r=!e.browser&&-1<["v0.10","v0.9."].indexOf(e.version.slice(0,5))?w:u;s.WritableState=o;e=b("core-util-is");e.inherits=b("inherits");var t,i={deprecate:b("util-deprecate")};!function(){try{t=b("stream")}catch(e){}finally{t=t||b("events").EventEmitter}}();var n,p=b("buffer").Buffer,d=b("buffer-shims");function m(){}function f(e,t,i){this.chunk=e,this.encoding=t,this.callback=i,this.next=null}function o(e,s){n=n||b("./_stream_duplex"),this.objectMode=!!(e=e||{}).objectMode,s instanceof n&&(this.objectMode=this.objectMode||!!e.writableObjectMode);var t=e.highWaterMark,i=this.objectMode?16:16384;this.highWaterMark=t||0===t?t:i,this.highWaterMark=~~this.highWaterMark,this.needDrain=!1,this.ending=!1,this.ended=!1;i=(this.finished=!1)===e.decodeStrings;this.decodeStrings=!i,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){var t,i,n,o;i=e,n=(t=s)._writableState,o=n.sync,e=n.writecb,function(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}(n),i?function(e,t,i,n,o){--t.pendingcb,i?u(o,n):o(n);e._writableState.errorEmitted=!0,e.emit("error",n)}(t,n,o,i,e):((i=c(n))||n.corked||n.bufferProcessing||!n.bufferedRequest||l(t,n),o?r(a,t,n,i,e):a(t,n,i,e))},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new v(this)}function s(e){if(n=n||b("./_stream_duplex"),!(this instanceof s||this instanceof n))return new s(e);this._writableState=new o(e,this),this.writable=!0,e&&("function"==typeof e.write&&(this._write=e.write),"function"==typeof e.writev&&(this._writev=e.writev)),t.call(this)}function g(e,t,i,n,o,s,r){t.writelen=n,t.writecb=r,t.writing=!0,t.sync=!0,i?e._writev(o,t.onwrite):e._write(o,s,t.onwrite),t.sync=!1}function a(e,t,i,n){var o;i||(o=e,0===(i=t).length&&i.needDrain&&(i.needDrain=!1,o.emit("drain"))),t.pendingcb--,n(),y(e,t)}function l(e,t){t.bufferProcessing=!0;var i=t.bufferedRequest;if(e._writev&&i&&i.next){var n=t.bufferedRequestCount,o=new Array(n),n=t.corkedRequestsFree;n.entry=i;for(var s=0;i;)i=(o[s]=i).next,s+=1;g(e,t,!0,t.length,o,"",n.finish),t.pendingcb++,t.lastBufferedRequest=null,n.next?(t.corkedRequestsFree=n.next,n.next=null):t.corkedRequestsFree=new v(t)}else{for(;i;){var r=i.chunk,a=i.encoding,l=i.callback;if(g(e,t,!1,t.objectMode?1:r.length,r,a,l),i=i.next,t.writing)break}null===i&&(t.lastBufferedRequest=null)}t.bufferedRequestCount=0,t.bufferedRequest=i,t.bufferProcessing=!1}function c(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function h(e,t){t.prefinished||(t.prefinished=!0,e.emit("prefinish"))}function y(e,t){var i=c(t);return i&&(0===t.pendingcb?(h(e,t),t.finished=!0,e.emit("finish")):h(e,t)),i}function v(n){var o=this;this.next=null,this.entry=null,this.finish=function(e){var t=o.entry;for(o.entry=null;t;){var i=t.callback;n.pendingcb--,i(e),t=t.next}n.corkedRequestsFree?n.corkedRequestsFree.next=o:n.corkedRequestsFree=o}}e.inherits(s,t),o.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},function(){try{Object.defineProperty(o.prototype,"buffer",{get:i.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.")})}catch(e){}}(),s.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))},s.prototype.write=function(e,t,i){var n,o,s,r,a,l,c=this._writableState,h=!1;return"function"==typeof t&&(i=t,t=null),t=p.isBuffer(e)?"buffer":t||c.defaultEncoding,"function"!=typeof i&&(i=m),c.ended?(r=this,a=i,l=new Error("write after end"),r.emit("error",l),u(a,l)):(n=this,o=c,s=i,a=!(r=!0),null===(l=e)?a=new TypeError("May not write null values to stream"):p.isBuffer(l)||"string"==typeof l||void 0===l||o.objectMode||(a=new TypeError("Invalid non-string/buffer chunk")),a&&(n.emit("error",a),u(s,a),r=!1),r&&(c.pendingcb++,h=function(e,t,i,n,o){i=function(e,t,i){e.objectMode||!1===e.decodeStrings||"string"!=typeof t||(t=d.from(t,i));return t}(t,i,n),p.isBuffer(i)&&(n="buffer");var s=t.objectMode?1:i.length;t.length+=s;var r=t.length<t.highWaterMark;r||(t.needDrain=!0);{var a;t.writing||t.corked?(a=t.lastBufferedRequest,t.lastBufferedRequest=new f(i,n,o),a?a.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1):g(e,t,!1,s,i,n,o)}return r}(this,c,e,t,i))),h},s.prototype.cork=function(){this._writableState.corked++},s.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.finished||e.bufferProcessing||!e.bufferedRequest||l(this,e))},s.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(-1<["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())))throw new TypeError("Unknown encoding: "+e);return this._writableState.defaultEncoding=e,this},s.prototype._write=function(e,t,i){i(new Error("not implemented"))},s.prototype._writev=null,s.prototype.end=function(e,t,i){var n=this._writableState;"function"==typeof e?(i=e,t=e=null):"function"==typeof t&&(i=t,t=null),null!=e&&this.write(e,t),n.corked&&(n.corked=1,this.uncork()),n.ending||n.finished||function(e,t,i){t.ending=!0,y(e,t),i&&(t.finished?u(i):e.once("finish",i));t.ended=!0,e.writable=!1}(this,n,i)}}.call(this,b("_process"))},{"./_stream_duplex":14,_process:12,buffer:4,"buffer-shims":3,"core-util-is":5,events:6,inherits:8,"process-nextick-args":11,"util-deprecate":26}],19:[function(e,t,i){"use strict";e("buffer").Buffer;var o=e("buffer-shims");function n(){this.head=null,this.tail=null,this.length=0}(t.exports=n).prototype.push=function(e){e={data:e,next:null};0<this.length?this.tail.next=e:this.head=e,this.tail=e,++this.length},n.prototype.unshift=function(e){e={data:e,next:this.head};0===this.length&&(this.tail=e),this.head=e,++this.length},n.prototype.shift=function(){if(0!==this.length){var e=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,e}},n.prototype.clear=function(){this.head=this.tail=null,this.length=0},n.prototype.join=function(e){if(0===this.length)return"";for(var t=this.head,i=""+t.data;t=t.next;)i+=e+t.data;return i},n.prototype.concat=function(e){if(0===this.length)return o.alloc(0);if(1===this.length)return this.head.data;for(var t=o.allocUnsafe(e>>>0),i=this.head,n=0;i;)i.data.copy(t,n),n+=i.data.length,i=i.next;return t}},{buffer:4,"buffer-shims":3}],20:[function(e,t,i){t.exports=e("./lib/_stream_passthrough.js")},{"./lib/_stream_passthrough.js":15}],21:[function(i,n,o){!function(e){var t=function(){try{return i("stream")}catch(e){}}();(o=n.exports=i("./lib/_stream_readable.js")).Stream=t||o,(o.Readable=o).Writable=i("./lib/_stream_writable.js"),o.Duplex=i("./lib/_stream_duplex.js"),o.Transform=i("./lib/_stream_transform.js"),o.PassThrough=i("./lib/_stream_passthrough.js"),!e.browser&&"disable"===e.env.READABLE_STREAM&&t&&(n.exports=t)}.call(this,i("_process"))},{"./lib/_stream_duplex.js":14,"./lib/_stream_passthrough.js":15,"./lib/_stream_readable.js":16,"./lib/_stream_transform.js":17,"./lib/_stream_writable.js":18,_process:12}],22:[function(e,t,i){t.exports=e("./lib/_stream_transform.js")},{"./lib/_stream_transform.js":17}],23:[function(e,t,i){t.exports=e("./lib/_stream_writable.js")},{"./lib/_stream_writable.js":18}],24:[function(e,t,i){t.exports=n;var h=e("events").EventEmitter;function n(){h.call(this)}e("inherits")(n,h),n.Readable=e("readable-stream/readable.js"),n.Writable=e("readable-stream/writable.js"),n.Duplex=e("readable-stream/duplex.js"),n.Transform=e("readable-stream/transform.js"),n.PassThrough=e("readable-stream/passthrough.js"),(n.Stream=n).prototype.pipe=function(t,e){var i=this;function n(e){t.writable&&!1===t.write(e)&&i.pause&&i.pause()}function o(){i.readable&&i.resume&&i.resume()}i.on("data",n),t.on("drain",o),t._isStdio||e&&!1===e.end||(i.on("end",r),i.on("close",a));var s=!1;function r(){s||(s=!0,t.end())}function a(){s||(s=!0,"function"==typeof t.destroy&&t.destroy())}function l(e){if(c(),0===h.listenerCount(this,"error"))throw e}function c(){i.removeListener("data",n),t.removeListener("drain",o),i.removeListener("end",r),i.removeListener("close",a),i.removeListener("error",l),t.removeListener("error",l),i.removeListener("end",c),i.removeListener("close",c),t.removeListener("close",c)}return i.on("error",l),t.on("error",l),i.on("end",c),i.on("close",c),t.on("close",c),t.emit("pipe",i),t}},{events:6,inherits:8,"readable-stream/duplex.js":13,"readable-stream/passthrough.js":20,"readable-stream/readable.js":21,"readable-stream/transform.js":22,"readable-stream/writable.js":23}],25:[function(e,t,i){var n=e("buffer").Buffer,o=n.isEncoding||function(e){switch(e&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};i=i.StringDecoder=function(e){switch(this.encoding=(e||"utf8").toLowerCase().replace(/[-_]/,""),function(e){if(e&&!o(e))throw new Error("Unknown encoding: "+e)}(e),this.encoding){case"utf8":this.surrogateSize=3;break;case"ucs2":case"utf16le":this.surrogateSize=2,this.detectIncompleteChar=r;break;case"base64":this.surrogateSize=3,this.detectIncompleteChar=a;break;default:return void(this.write=s)}this.charBuffer=new n(6),this.charReceived=0,this.charLength=0};function s(e){return e.toString(this.encoding)}function r(e){this.charReceived=e.length%2,this.charLength=this.charReceived?2:0}function a(e){this.charReceived=e.length%3,this.charLength=this.charReceived?3:0}i.prototype.write=function(e){for(var t="";this.charLength;){var i=e.length>=this.charLength-this.charReceived?this.charLength-this.charReceived:e.length;if(e.copy(this.charBuffer,this.charReceived,0,i),this.charReceived+=i,this.charReceived<this.charLength)return"";if(e=e.slice(i,e.length),!(55296<=(o=(t=this.charBuffer.slice(0,this.charLength).toString(this.encoding)).charCodeAt(t.length-1))&&o<=56319)){if((this.charReceived=this.charLength=0)===e.length)return t;break}this.charLength+=this.surrogateSize,t=""}this.detectIncompleteChar(e);var n=e.length;this.charLength&&(e.copy(this.charBuffer,0,e.length-this.charReceived,n),n-=this.charReceived);var o,n=(t+=e.toString(this.encoding,0,n)).length-1;if(55296<=(o=t.charCodeAt(n))&&o<=56319){var s=this.surrogateSize;return this.charLength+=s,this.charReceived+=s,this.charBuffer.copy(this.charBuffer,s,0,s),e.copy(this.charBuffer,0,0,s),t.substring(0,n)}return t},i.prototype.detectIncompleteChar=function(e){for(var t=3<=e.length?3:e.length;0<t;t--){var i=e[e.length-t];if(1==t&&i>>5==6){this.charLength=2;break}if(t<=2&&i>>4==14){this.charLength=3;break}if(t<=3&&i>>3==30){this.charLength=4;break}}this.charReceived=t},i.prototype.end=function(e){var t,i,n="";return e&&e.length&&(n=this.write(e)),this.charReceived&&(t=this.charReceived,i=this.charBuffer,e=this.encoding,n+=i.slice(0,t).toString(e)),n}},{buffer:4}],26:[function(e,i,t){!function(t){function n(e){try{if(!t.localStorage)return}catch(e){return}e=t.localStorage[e];return null!=e&&"true"===String(e).toLowerCase()}i.exports=function(e,t){if(n("noDeprecation"))return e;var i=!1;return function(){if(!i){if(n("throwDeprecation"))throw new Error(t);n("traceDeprecation")?console.trace(t):console.warn(t),i=!0}return e.apply(this,arguments)}}}.call(this,void 0!==o?o:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],27:[function(e,t,i){window.htmlparser2=e("htmlparser2")},{htmlparser2:56}],28:[function(e,t,i){var s=e("domelementtype"),r=e("entities"),a={__proto__:null,allowfullscreen:!0,async:!0,autofocus:!0,autoplay:!0,checked:!0,controls:!0,default:!0,defer:!0,disabled:!0,hidden:!0,ismap:!0,loop:!0,multiple:!0,muted:!0,open:!0,readonly:!0,required:!0,reversed:!0,scoped:!0,seamless:!0,selected:!0,typemustmatch:!0},l={__proto__:null,style:!0,script:!0,xmp:!0,iframe:!0,noembed:!0,noframes:!0,plaintext:!0,noscript:!0};var c={__proto__:null,area:!0,base:!0,basefont:!0,br:!0,col:!0,command:!0,embed:!0,frame:!0,hr:!0,img:!0,input:!0,isindex:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0},h=t.exports=function(e,t){Array.isArray(e)||e.cheerio||(e=[e]),t=t||{};for(var i="",n=0;n<e.length;n++){var o=e[n];"root"===o.type?i+=h(o.children,t):s.isTag(o)?i+=function(e,t){"svg"===e.name&&(t={decodeEntities:t.decodeEntities,xmlMode:!0});var i="<"+e.name,n=function(e,t){if(e){var i,n,o="";for(n in e)o&&(o+=" "),!(i=e[n])&&a[n]?o+=n:o+=n+'="'+(t.decodeEntities?r.encodeXML(i):i)+'"';return o}}(e.attribs,t);n&&(i+=" "+n);!t.xmlMode||e.children&&0!==e.children.length?(i+=">",e.children&&(i+=h(e.children,t)),c[e.name]&&!t.xmlMode||(i+="</"+e.name+">")):i+="/>";return i}(o,t):o.type===s.Directive?i+="<"+o.data+">":o.type===s.Comment?i+="\x3c!--"+o.data+"--\x3e":o.type===s.CDATA?i+="<![CDATA["+o.children[0].data+"]]>":i+=function(e,t){var i=e.data||"";!t.decodeEntities||e.parent&&e.parent.name in l||(i=r.encodeXML(i));return i}(o,t)}return i}},{domelementtype:29,entities:41}],29:[function(e,t,i){t.exports={Text:"text",Directive:"directive",Comment:"comment",Script:"script",Style:"style",Tag:"tag",CDATA:"cdata",isTag:function(e){return"tag"===e.type||"script"===e.type||"style"===e.type}}},{}],30:[function(e,t,i){t.exports={Text:"text",Directive:"directive",Comment:"comment",Script:"script",Style:"style",Tag:"tag",CDATA:"cdata",Doctype:"doctype",isTag:function(e){return"tag"===e.type||"script"===e.type||"style"===e.type}}},{}],31:[function(e,t,i){var n=e("domelementtype"),o=/\s+/g,s=e("./lib/node"),r=e("./lib/element");function a(e,t,i){"object"==typeof e?(i=t,t=e,e=null):"function"==typeof t&&(i=t,t=l),this._callback=e,this._options=t||l,this._elementCB=i,this.dom=[],this._done=!1,this._tagStack=[],this._parser=this._parser||null}var l={normalizeWhitespace:!1,withStartIndices:!1};a.prototype.onparserinit=function(e){this._parser=e},a.prototype.onreset=function(){a.call(this,this._callback,this._options,this._elementCB)},a.prototype.onend=function(){this._done||(this._done=!0,this._parser=null,this._handleCallback(null))},a.prototype._handleCallback=a.prototype.onerror=function(e){if("function"==typeof this._callback)this._callback(e,this.dom);else if(e)throw e},a.prototype.onclosetag=function(){var e=this._tagStack.pop();this._elementCB&&this._elementCB(e)},a.prototype._addDomElement=function(e){var t=this._tagStack[this._tagStack.length-1],i=t?t.children:this.dom,n=i[i.length-1];e.next=null,this._options.withStartIndices&&(e.startIndex=this._parser.startIndex),this._options.withDomLvl1&&(e.__proto__="tag"===e.type?r:s),n?(e.prev=n).next=e:e.prev=null,i.push(e),e.parent=t||null},a.prototype.onopentag=function(e,t){t={type:"script"===e?n.Script:"style"===e?n.Style:n.Tag,name:e,attribs:t,children:[]};this._addDomElement(t),this._tagStack.push(t)},a.prototype.ontext=function(e){var t,i=this._options.normalizeWhitespace||this._options.ignoreWhitespace;!this._tagStack.length&&this.dom.length&&(t=this.dom[this.dom.length-1]).type===n.Text||this._tagStack.length&&(t=this._tagStack[this._tagStack.length-1])&&(t=t.children[t.children.length-1])&&t.type===n.Text?i?t.data=(t.data+e).replace(o," "):t.data+=e:(i&&(e=e.replace(o," ")),this._addDomElement({data:e,type:n.Text}))},a.prototype.oncomment=function(e){var t=this._tagStack[this._tagStack.length-1];t&&t.type===n.Comment?t.data+=e:(e={data:e,type:n.Comment},this._addDomElement(e),this._tagStack.push(e))},a.prototype.oncdatastart=function(){var e={children:[{data:"",type:n.Text}],type:n.CDATA};this._addDomElement(e),this._tagStack.push(e)},a.prototype.oncommentend=a.prototype.oncdataend=function(){this._tagStack.pop()},a.prototype.onprocessinginstruction=function(e,t){this._addDomElement({name:e,data:t,type:n.Directive})},t.exports=a},{"./lib/element":32,"./lib/node":33,domelementtype:30}],32:[function(e,t,i){var e=e("./node"),n=t.exports=Object.create(e),o={tagName:"name"};Object.keys(o).forEach(function(e){var t=o[e];Object.defineProperty(n,e,{get:function(){return this[t]||null},set:function(e){return this[t]=e}})})},{"./node":33}],33:[function(e,t,i){var n=t.exports={get firstChild(){var e=this.children;return e&&e[0]||null},get lastChild(){var e=this.children;return e&&e[e.length-1]||null},get nodeType(){return s[this.type]||s.element}},o={tagName:"name",childNodes:"children",parentNode:"parent",previousSibling:"prev",nextSibling:"next",nodeValue:"data"},s={element:1,text:3,cdata:4,comment:8};Object.keys(o).forEach(function(e){var t=o[e];Object.defineProperty(n,e,{get:function(){return this[t]||null},set:function(e){return this[t]=e}})})},{}],34:[function(e,t,i){var n=t.exports;[e("./lib/stringify"),e("./lib/traversal"),e("./lib/manipulation"),e("./lib/querying"),e("./lib/legacy"),e("./lib/helpers")].forEach(function(t){Object.keys(t).forEach(function(e){n[e]=t[e].bind(n)})})},{"./lib/helpers":35,"./lib/legacy":36,"./lib/manipulation":37,"./lib/querying":38,"./lib/stringify":39,"./lib/traversal":40}],35:[function(e,t,i){i.removeSubsets=function(e){for(var t,i,n,o=e.length;-1<--o;){for(t=i=e[o],n=!(e[o]=null);i;){if(-1<e.indexOf(i)){n=!1,e.splice(o,1);break}i=i.parent}n&&(e[o]=t)}return e};var h=1,u=2,p=4,d=8,m=16,n=i.compareDocumentPosition=function(e,t){var i,n,o,s,r,a,l=[],c=[];if(e===t)return 0;for(i=e;i;)l.unshift(i),i=i.parent;for(i=t;i;)c.unshift(i),i=i.parent;for(a=0;l[a]===c[a];)a++;return 0===a?h:(o=(n=l[a-1]).children,s=l[a],r=c[a],o.indexOf(s)>o.indexOf(r)?n===t?p|m:p:n===e?u|d:u)};i.uniqueSort=function(e){var t,i=e.length;for(e=e.slice();-1<--i;)t=e[i],-1<(t=e.indexOf(t))&&t<i&&e.splice(i,1);return e.sort(function(e,t){t=n(e,t);return t&u?-1:t&p?1:0}),e}},{}],36:[function(e,t,i){var e=e("domelementtype"),n=i.isTag=e.isTag;i.testElement=function(e,t){for(var i in e)if(e.hasOwnProperty(i)){if("tag_name"===i){if(!n(t)||!e.tag_name(t.name))return!1}else if("tag_type"===i){if(!e.tag_type(t.type))return!1}else if("tag_contains"===i){if(n(t)||!e.tag_contains(t.data))return!1}else if(!t.attribs||!e[i](t.attribs[i]))return!1}else;return!0};var s={tag_name:function(t){return"function"==typeof t?function(e){return n(e)&&t(e.name)}:"*"===t?n:function(e){return n(e)&&e.name===t}},tag_type:function(t){return"function"==typeof t?function(e){return t(e.type)}:function(e){return e.type===t}},tag_contains:function(t){return"function"==typeof t?function(e){return!n(e)&&t(e.data)}:function(e){return!n(e)&&e.data===t}}};function r(t,i){return"function"==typeof i?function(e){return e.attribs&&i(e.attribs[t])}:function(e){return e.attribs&&e.attribs[t]===i}}function a(t,i){return function(e){return t(e)||i(e)}}i.getElements=function(i,e,t,n){var o=Object.keys(i).map(function(e){var t=i[e];return e in s?s[e](t):r(e,t)});return 0===o.length?[]:this.filter(o.reduce(a),e,t,n)},i.getElementById=function(e,t,i){return Array.isArray(t)||(t=[t]),this.findOne(r("id",e),t,!1!==i)},i.getElementsByTagName=function(e,t,i,n){return this.filter(s.tag_name(e),t,i,n)},i.getElementsByTagType=function(e,t,i,n){return this.filter(s.tag_type(e),t,i,n)}},{domelementtype:30}],37:[function(e,t,i){i.removeElement=function(e){var t;e.prev&&(e.prev.next=e.next),e.next&&(e.next.prev=e.prev),e.parent&&(t=e.parent.children).splice(t.lastIndexOf(e),1)},i.replaceElement=function(e,t){var i=t.prev=e.prev;i&&(i.next=t);i=t.next=e.next;i&&(i.prev=t);i=t.parent=e.parent;i&&((i=i.children)[i.lastIndexOf(e)]=t)},i.appendChild=function(e,t){1!==(t.parent=e).children.push(t)&&(((e=e.children[e.children.length-2]).next=t).prev=e,t.next=null)},i.append=function(e,t){var i=e.parent,n=e.next;t.next=n,((t.prev=e).next=t).parent=i,n?(n.prev=t,i&&(e=i.children).splice(e.lastIndexOf(n),0,t)):i&&i.children.push(t)},i.prepend=function(e,t){var i,n=e.parent;n&&(i=n.children).splice(i.lastIndexOf(e),0,t),e.prev&&(e.prev.next=t),t.parent=n,t.prev=e.prev,(t.next=e).prev=t}},{}],38:[function(e,t,i){var r=e("domelementtype").isTag;function l(e,t,i,n){for(var o,s=[],r=0,a=t.length;r<a&&!(e(t[r])&&(s.push(t[r]),--n<=0))&&(o=t[r].children,!(i&&o&&0<o.length&&(o=l(e,o,i,n),s=s.concat(o),(n-=o.length)<=0)));r++);return s}t.exports={filter:function(e,t,i,n){Array.isArray(t)||(t=[t]);"number"==typeof n&&isFinite(n)||(n=1/0);return l(e,t,!1!==i,n)},find:l,findOneChild:function(e,t){for(var i=0,n=t.length;i<n;i++)if(e(t[i]))return t[i];return null},findOne:function e(t,i){var n=null;for(var o=0,s=i.length;o<s&&!n;o++)r(i[o])&&(t(i[o])?n=i[o]:0<i[o].children.length&&(n=e(t,i[o].children)));return n},existsOne:function e(t,i){for(var n=0,o=i.length;n<o;n++)if(r(i[n])&&(t(i[n])||0<i[n].children.length&&e(t,i[n].children)))return!0;return!1},findAll:function e(t,i){var n=[];for(var o=0,s=i.length;o<s;o++)r(i[o])&&(t(i[o])&&n.push(i[o]),0<i[o].children.length&&(n=n.concat(e(t,i[o].children))));return n}}},{domelementtype:30}],39:[function(e,t,i){var n=e("domelementtype"),o=e("dom-serializer"),s=n.isTag;t.exports={getInnerHTML:function(e,t){return e.children?e.children.map(function(e){return o(e,t)}).join(""):""},getOuterHTML:o,getText:function e(t){if(Array.isArray(t))return t.map(e).join("");if(s(t)||t.type===n.CDATA)return e(t.children);if(t.type===n.Text)return t.data;return""}}},{"dom-serializer":28,domelementtype:30}],40:[function(e,t,i){var n=i.getChildren=function(e){return e.children},o=i.getParent=function(e){return e.parent};i.getSiblings=function(e){var t=o(e);return t?n(t):[e]},i.getAttributeValue=function(e,t){return e.attribs&&e.attribs[t]},i.hasAttrib=function(e,t){return!!e.attribs&&hasOwnProperty.call(e.attribs,t)},i.getName=function(e){return e.name}},{}],41:[function(e,t,i){var n=e("./lib/encode.js"),o=e("./lib/decode.js");i.decode=function(e,t){return(!t||t<=0?o.XML:o.HTML)(e)},i.decodeStrict=function(e,t){return(!t||t<=0?o.XML:o.HTMLStrict)(e)},i.encode=function(e,t){return(!t||t<=0?n.XML:n.HTML)(e)},i.encodeXML=n.XML,i.encodeHTML4=i.encodeHTML5=i.encodeHTML=n.HTML,i.decodeXML=i.decodeXMLStrict=o.XML,i.decodeHTML4=i.decodeHTML5=i.decodeHTML=o.HTML,i.decodeHTML4Strict=i.decodeHTML5Strict=i.decodeHTMLStrict=o.HTMLStrict,i.escape=n.escape},{"./lib/decode.js":42,"./lib/encode.js":44}],42:[function(e,t,i){var a=e("../maps/entities.json"),l=e("../maps/legacy.json"),n=e("../maps/xml.json"),o=e("./decode_codepoint.js"),s=r(n),e=r(a);function r(e){var t=Object.keys(e).join("|"),i=h(e);t+="|#[xX][\\da-fA-F]+|#\\d+";var n=new RegExp("&(?:"+t+");","g");return function(e){return String(e).replace(n,i)}}n=function(){for(var e=Object.keys(l).sort(c),t=Object.keys(a).sort(c),i=0,n=0;i<t.length;i++)e[n]===t[i]?(t[i]+=";?",n++):t[i]+=";";var o=new RegExp("&(?:"+t.join("|")+"|#[xX][\\da-fA-F]+;?|#\\d+;?)","g"),s=h(a);function r(e){return";"!==e.substr(-1)&&(e+=";"),s(e)}return function(e){return String(e).replace(o,r)}}();function c(e,t){return e<t?1:-1}function h(t){return function(e){return"#"===e.charAt(1)?"X"===e.charAt(2)||"x"===e.charAt(2)?o(parseInt(e.substr(3),16)):o(parseInt(e.substr(2),10)):t[e.slice(1,-1)]}}t.exports={XML:s,HTML:n,HTMLStrict:e}},{"../maps/entities.json":46,"../maps/legacy.json":47,"../maps/xml.json":48,"./decode_codepoint.js":43}],43:[function(e,t,i){var n=e("../maps/decode.json");t.exports=function(e){if(55296<=e&&e<=57343||1114111<e)return"";e in n&&(e=n[e]);var t="";65535<e&&(e-=65536,t+=String.fromCharCode(e>>>10&1023|55296),e=56320|1023&e);return t+=String.fromCharCode(e)}},{"../maps/decode.json":45}],44:[function(e,t,i){var n=s(e("../maps/xml.json")),o=r(n);i.XML=u(n,o);o=s(e("../maps/entities.json")),e=r(o);function s(i){return Object.keys(i).sort().reduce(function(e,t){return e[i[t]]="&"+t+";",e},{})}function r(e){var t=[],i=[];return Object.keys(e).forEach(function(e){1===e.length?t.push("\\"+e):i.push(e)}),i.unshift("["+t.join("")+"]"),new RegExp(i.join("|"),"g")}i.HTML=u(o,e);var a=/[^\0-\x7F]/g,l=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g;function c(e){return"&#x"+e.charCodeAt(0).toString(16).toUpperCase()+";"}function h(e){return"&#x"+(1024*(e.charCodeAt(0)-55296)+e.charCodeAt(1)-56320+65536).toString(16).toUpperCase()+";"}function u(t,i){function n(e){return t[e]}return function(e){return e.replace(i,n).replace(l,h).replace(a,c)}}var p=r(n);i.escape=function(e){return e.replace(p,c).replace(l,h).replace(a,c)}},{"../maps/entities.json":46,"../maps/xml.json":48}],45:[function(e,t,i){t.exports={0:65533,128:8364,130:8218,131:402,132:8222,133:8230,134:8224,135:8225,136:710,137:8240,138:352,139:8249,140:338,142:381,145:8216,146:8217,147:8220,148:8221,149:8226,150:8211,151:8212,152:732,153:8482,154:353,155:8250,156:339,158:382,159:376}},{}],46:[function(e,t,i){t.exports={Aacute:"",aacute:"",Abreve:"",abreve:"",ac:"",acd:"",acE:"",Acirc:"",acirc:"",acute:"",Acy:"",acy:"",AElig:"",aelig:"",af:"",Afr:"",afr:"",Agrave:"",agrave:"",alefsym:"",aleph:"",Alpha:"",alpha:"",Amacr:"",amacr:"",amalg:"",amp:"&",AMP:"&",andand:"",And:"",and:"",andd:"",andslope:"",andv:"",ang:"",ange:"",angle:"",angmsdaa:"",angmsdab:"",angmsdac:"",angmsdad:"",angmsdae:"",angmsdaf:"",angmsdag:"",angmsdah:"",angmsd:"",angrt:"",angrtvb:"",angrtvbd:"",angsph:"",angst:"",angzarr:"",Aogon:"",aogon:"",Aopf:"",aopf:"",apacir:"",ap:"",apE:"",ape:"",apid:"",apos:"'",ApplyFunction:"",approx:"",approxeq:"",Aring:"",aring:"",Ascr:"",ascr:"",Assign:"",ast:"*",asymp:"",asympeq:"",Atilde:"",atilde:"",Auml:"",auml:"",awconint:"",awint:"",backcong:"",backepsilon:"",backprime:"",backsim:"",backsimeq:"",Backslash:"",Barv:"",barvee:"",barwed:"",Barwed:"",barwedge:"",bbrk:"",bbrktbrk:"",bcong:"",Bcy:"",bcy:"",bdquo:"",becaus:"",because:"",Because:"",bemptyv:"",bepsi:"",bernou:"",Bernoullis:"",Beta:"",beta:"",beth:"",between:"",Bfr:"",bfr:"",bigcap:"",bigcirc:"",bigcup:"",bigodot:"",bigoplus:"",bigotimes:"",bigsqcup:"",bigstar:"",bigtriangledown:"",bigtriangleup:"",biguplus:"",bigvee:"",bigwedge:"",bkarow:"",blacklozenge:"",blacksquare:"",blacktriangle:"",blacktriangledown:"",blacktriangleleft:"",blacktriangleright:"",blank:"",blk12:"",blk14:"",blk34:"",block:"",bne:"=",bnequiv:"",bNot:"",bnot:"",Bopf:"",bopf:"",bot:"",bottom:"",bowtie:"",boxbox:"",boxdl:"",boxdL:"",boxDl:"",boxDL:"",boxdr:"",boxdR:"",boxDr:"",boxDR:"",boxh:"",boxH:"",boxhd:"",boxHd:"",boxhD:"",boxHD:"",boxhu:"",boxHu:"",boxhU:"",boxHU:"",boxminus:"",boxplus:"",boxtimes:"",boxul:"",boxuL:"",boxUl:"",boxUL:"",boxur:"",boxuR:"",boxUr:"",boxUR:"",boxv:"",boxV:"",boxvh:"",boxvH:"",boxVh:"",boxVH:"",boxvl:"",boxvL:"",boxVl:"",boxVL:"",boxvr:"",boxvR:"",boxVr:"",boxVR:"",bprime:"",breve:"",Breve:"",brvbar:"",bscr:"",Bscr:"",bsemi:"",bsim:"",bsime:"",bsolb:"",bsol:"\\",bsolhsub:"",bull:"",bullet:"",bump:"",bumpE:"",bumpe:"",Bumpeq:"",bumpeq:"",Cacute:"",cacute:"",capand:"",capbrcup:"",capcap:"",cap:"",Cap:"",capcup:"",capdot:"",CapitalDifferentialD:"",caps:"",caret:"",caron:"",Cayleys:"",ccaps:"",Ccaron:"",ccaron:"",Ccedil:"",ccedil:"",Ccirc:"",ccirc:"",Cconint:"",ccups:"",ccupssm:"",Cdot:"",cdot:"",cedil:"",Cedilla:"",cemptyv:"",cent:"",centerdot:"",CenterDot:"",cfr:"",Cfr:"",CHcy:"",chcy:"",check:"",checkmark:"",Chi:"",chi:"",circ:"",circeq:"",circlearrowleft:"",circlearrowright:"",circledast:"",circledcirc:"",circleddash:"",CircleDot:"",circledR:"",circledS:"",CircleMinus:"",CirclePlus:"",CircleTimes:"",cir:"",cirE:"",cire:"",cirfnint:"",cirmid:"",cirscir:"",ClockwiseContourIntegral:"",CloseCurlyDoubleQuote:"",CloseCurlyQuote:"",clubs:"",clubsuit:"",colon:":",Colon:"",Colone:"",colone:"",coloneq:"",comma:",",commat:"@",comp:"",compfn:"",complement:"",complexes:"",cong:"",congdot:"",Congruent:"",conint:"",Conint:"",ContourIntegral:"",copf:"",Copf:"",coprod:"",Coproduct:"",copy:"",COPY:"",copysr:"",CounterClockwiseContourIntegral:"",crarr:"",cross:"",Cross:"",Cscr:"",cscr:"",csub:"",csube:"",csup:"",csupe:"",ctdot:"",cudarrl:"",cudarrr:"",cuepr:"",cuesc:"",cularr:"",cularrp:"",cupbrcap:"",cupcap:"",CupCap:"",cup:"",Cup:"",cupcup:"",cupdot:"",cupor:"",cups:"",curarr:"",curarrm:"",curlyeqprec:"",curlyeqsucc:"",curlyvee:"",curlywedge:"",curren:"",curvearrowleft:"",curvearrowright:"",cuvee:"",cuwed:"",cwconint:"",cwint:"",cylcty:"",dagger:"",Dagger:"",daleth:"",darr:"",Darr:"",dArr:"",dash:"",Dashv:"",dashv:"",dbkarow:"",dblac:"",Dcaron:"",dcaron:"",Dcy:"",dcy:"",ddagger:"",ddarr:"",DD:"",dd:"",DDotrahd:"",ddotseq:"",deg:"",Del:"",Delta:"",delta:"",demptyv:"",dfisht:"",Dfr:"",dfr:"",dHar:"",dharl:"",dharr:"",DiacriticalAcute:"",DiacriticalDot:"",DiacriticalDoubleAcute:"",DiacriticalGrave:"`",DiacriticalTilde:"",diam:"",diamond:"",Diamond:"",diamondsuit:"",diams:"",die:"",DifferentialD:"",digamma:"",disin:"",div:"",divide:"",divideontimes:"",divonx:"",DJcy:"",djcy:"",dlcorn:"",dlcrop:"",dollar:"$",Dopf:"",dopf:"",Dot:"",dot:"",DotDot:"",doteq:"",doteqdot:"",DotEqual:"",dotminus:"",dotplus:"",dotsquare:"",doublebarwedge:"",DoubleContourIntegral:"",DoubleDot:"",DoubleDownArrow:"",DoubleLeftArrow:"",DoubleLeftRightArrow:"",DoubleLeftTee:"",DoubleLongLeftArrow:"",DoubleLongLeftRightArrow:"",DoubleLongRightArrow:"",DoubleRightArrow:"",DoubleRightTee:"",DoubleUpArrow:"",DoubleUpDownArrow:"",DoubleVerticalBar:"",DownArrowBar:"",downarrow:"",DownArrow:"",Downarrow:"",DownArrowUpArrow:"",DownBreve:"",downdownarrows:"",downharpoonleft:"",downharpoonright:"",DownLeftRightVector:"",DownLeftTeeVector:"",DownLeftVectorBar:"",DownLeftVector:"",DownRightTeeVector:"",DownRightVectorBar:"",DownRightVector:"",DownTeeArrow:"",DownTee:"",drbkarow:"",drcorn:"",drcrop:"",Dscr:"",dscr:"",DScy:"",dscy:"",dsol:"",Dstrok:"",dstrok:"",dtdot:"",dtri:"",dtrif:"",duarr:"",duhar:"",dwangle:"",DZcy:"",dzcy:"",dzigrarr:"",Eacute:"",eacute:"",easter:"",Ecaron:"",ecaron:"",Ecirc:"",ecirc:"",ecir:"",ecolon:"",Ecy:"",ecy:"",eDDot:"",Edot:"",edot:"",eDot:"",ee:"",efDot:"",Efr:"",efr:"",eg:"",Egrave:"",egrave:"",egs:"",egsdot:"",el:"",Element:"",elinters:"",ell:"",els:"",elsdot:"",Emacr:"",emacr:"",empty:"",emptyset:"",EmptySmallSquare:"",emptyv:"",EmptyVerySmallSquare:"",emsp13:"",emsp14:"",emsp:"",ENG:"",eng:"",ensp:"",Eogon:"",eogon:"",Eopf:"",eopf:"",epar:"",eparsl:"",eplus:"",epsi:"",Epsilon:"",epsilon:"",epsiv:"",eqcirc:"",eqcolon:"",eqsim:"",eqslantgtr:"",eqslantless:"",Equal:"",equals:"=",EqualTilde:"",equest:"",Equilibrium:"",equiv:"",equivDD:"",eqvparsl:"",erarr:"",erDot:"",escr:"",Escr:"",esdot:"",Esim:"",esim:"",Eta:"",eta:"",ETH:"",eth:"",Euml:"",euml:"",euro:"",excl:"!",exist:"",Exists:"",expectation:"",exponentiale:"",ExponentialE:"",fallingdotseq:"",Fcy:"",fcy:"",female:"",ffilig:"",fflig:"",ffllig:"",Ffr:"",ffr:"",filig:"",FilledSmallSquare:"",FilledVerySmallSquare:"",fjlig:"fj",flat:"",fllig:"",fltns:"",fnof:"",Fopf:"",fopf:"",forall:"",ForAll:"",fork:"",forkv:"",Fouriertrf:"",fpartint:"",frac12:"",frac13:"",frac14:"",frac15:"",frac16:"",frac18:"",frac23:"",frac25:"",frac34:"",frac35:"",frac38:"",frac45:"",frac56:"",frac58:"",frac78:"",frasl:"",frown:"",fscr:"",Fscr:"",gacute:"",Gamma:"",gamma:"",Gammad:"",gammad:"",gap:"",Gbreve:"",gbreve:"",Gcedil:"",Gcirc:"",gcirc:"",Gcy:"",gcy:"",Gdot:"",gdot:"",ge:"",gE:"",gEl:"",gel:"",geq:"",geqq:"",geqslant:"",gescc:"",ges:"",gesdot:"",gesdoto:"",gesdotol:"",gesl:"",gesles:"",Gfr:"",gfr:"",gg:"",Gg:"",ggg:"",gimel:"",GJcy:"",gjcy:"",gla:"",gl:"",glE:"",glj:"",gnap:"",gnapprox:"",gne:"",gnE:"",gneq:"",gneqq:"",gnsim:"",Gopf:"",gopf:"",grave:"`",GreaterEqual:"",GreaterEqualLess:"",GreaterFullEqual:"",GreaterGreater:"",GreaterLess:"",GreaterSlantEqual:"",GreaterTilde:"",Gscr:"",gscr:"",gsim:"",gsime:"",gsiml:"",gtcc:"",gtcir:"",gt:">",GT:">",Gt:"",gtdot:"",gtlPar:"",gtquest:"",gtrapprox:"",gtrarr:"",gtrdot:"",gtreqless:"",gtreqqless:"",gtrless:"",gtrsim:"",gvertneqq:"",gvnE:"",Hacek:"",hairsp:"",half:"",hamilt:"",HARDcy:"",hardcy:"",harrcir:"",harr:"",hArr:"",harrw:"",Hat:"^",hbar:"",Hcirc:"",hcirc:"",hearts:"",heartsuit:"",hellip:"",hercon:"",hfr:"",Hfr:"",HilbertSpace:"",hksearow:"",hkswarow:"",hoarr:"",homtht:"",hookleftarrow:"",hookrightarrow:"",hopf:"",Hopf:"",horbar:"",HorizontalLine:"",hscr:"",Hscr:"",hslash:"",Hstrok:"",hstrok:"",HumpDownHump:"",HumpEqual:"",hybull:"",hyphen:"",Iacute:"",iacute:"",ic:"",Icirc:"",icirc:"",Icy:"",icy:"",Idot:"",IEcy:"",iecy:"",iexcl:"",iff:"",ifr:"",Ifr:"",Igrave:"",igrave:"",ii:"",iiiint:"",iiint:"",iinfin:"",iiota:"",IJlig:"",ijlig:"",Imacr:"",imacr:"",image:"",ImaginaryI:"",imagline:"",imagpart:"",imath:"",Im:"",imof:"",imped:"",Implies:"",incare:"",in:"",infin:"",infintie:"",inodot:"",intcal:"",int:"",Int:"",integers:"",Integral:"",intercal:"",Intersection:"",intlarhk:"",intprod:"",InvisibleComma:"",InvisibleTimes:"",IOcy:"",iocy:"",Iogon:"",iogon:"",Iopf:"",iopf:"",Iota:"",iota:"",iprod:"",iquest:"",iscr:"",Iscr:"",isin:"",isindot:"",isinE:"",isins:"",isinsv:"",isinv:"",it:"",Itilde:"",itilde:"",Iukcy:"",iukcy:"",Iuml:"",iuml:"",Jcirc:"",jcirc:"",Jcy:"",jcy:"",Jfr:"",jfr:"",jmath:"",Jopf:"",jopf:"",Jscr:"",jscr:"",Jsercy:"",jsercy:"",Jukcy:"",jukcy:"",Kappa:"",kappa:"",kappav:"",Kcedil:"",kcedil:"",Kcy:"",kcy:"",Kfr:"",kfr:"",kgreen:"",KHcy:"",khcy:"",KJcy:"",kjcy:"",Kopf:"",kopf:"",Kscr:"",kscr:"",lAarr:"",Lacute:"",lacute:"",laemptyv:"",lagran:"",Lambda:"",lambda:"",lang:"",Lang:"",langd:"",langle:"",lap:"",Laplacetrf:"",laquo:"",larrb:"",larrbfs:"",larr:"",Larr:"",lArr:"",larrfs:"",larrhk:"",larrlp:"",larrpl:"",larrsim:"",larrtl:"",latail:"",lAtail:"",lat:"",late:"",lates:"",lbarr:"",lBarr:"",lbbrk:"",lbrace:"{",lbrack:"[",lbrke:"",lbrksld:"",lbrkslu:"",Lcaron:"",lcaron:"",Lcedil:"",lcedil:"",lceil:"",lcub:"{",Lcy:"",lcy:"",ldca:"",ldquo:"",ldquor:"",ldrdhar:"",ldrushar:"",ldsh:"",le:"",lE:"",LeftAngleBracket:"",LeftArrowBar:"",leftarrow:"",LeftArrow:"",Leftarrow:"",LeftArrowRightArrow:"",leftarrowtail:"",LeftCeiling:"",LeftDoubleBracket:"",LeftDownTeeVector:"",LeftDownVectorBar:"",LeftDownVector:"",LeftFloor:"",leftharpoondown:"",leftharpoonup:"",leftleftarrows:"",leftrightarrow:"",LeftRightArrow:"",Leftrightarrow:"",leftrightarrows:"",leftrightharpoons:"",leftrightsquigarrow:"",LeftRightVector:"",LeftTeeArrow:"",LeftTee:"",LeftTeeVector:"",leftthreetimes:"",LeftTriangleBar:"",LeftTriangle:"",LeftTriangleEqual:"",LeftUpDownVector:"",LeftUpTeeVector:"",LeftUpVectorBar:"",LeftUpVector:"",LeftVectorBar:"",LeftVector:"",lEg:"",leg:"",leq:"",leqq:"",leqslant:"",lescc:"",les:"",lesdot:"",lesdoto:"",lesdotor:"",lesg:"",lesges:"",lessapprox:"",lessdot:"",lesseqgtr:"",lesseqqgtr:"",LessEqualGreater:"",LessFullEqual:"",LessGreater:"",lessgtr:"",LessLess:"",lesssim:"",LessSlantEqual:"",LessTilde:"",lfisht:"",lfloor:"",Lfr:"",lfr:"",lg:"",lgE:"",lHar:"",lhard:"",lharu:"",lharul:"",lhblk:"",LJcy:"",ljcy:"",llarr:"",ll:"",Ll:"",llcorner:"",Lleftarrow:"",llhard:"",lltri:"",Lmidot:"",lmidot:"",lmoustache:"",lmoust:"",lnap:"",lnapprox:"",lne:"",lnE:"",lneq:"",lneqq:"",lnsim:"",loang:"",loarr:"",lobrk:"",longleftarrow:"",LongLeftArrow:"",Longleftarrow:"",longleftrightarrow:"",LongLeftRightArrow:"",Longleftrightarrow:"",longmapsto:"",longrightarrow:"",LongRightArrow:"",Longrightarrow:"",looparrowleft:"",looparrowright:"",lopar:"",Lopf:"",lopf:"",loplus:"",lotimes:"",lowast:"",lowbar:"_",LowerLeftArrow:"",LowerRightArrow:"",loz:"",lozenge:"",lozf:"",lpar:"(",lparlt:"",lrarr:"",lrcorner:"",lrhar:"",lrhard:"",lrm:"",lrtri:"",lsaquo:"",lscr:"",Lscr:"",lsh:"",Lsh:"",lsim:"",lsime:"",lsimg:"",lsqb:"[",lsquo:"",lsquor:"",Lstrok:"",lstrok:"",ltcc:"",ltcir:"",lt:"<",LT:"<",Lt:"",ltdot:"",lthree:"",ltimes:"",ltlarr:"",ltquest:"",ltri:"",ltrie:"",ltrif:"",ltrPar:"",lurdshar:"",luruhar:"",lvertneqq:"",lvnE:"",macr:"",male:"",malt:"",maltese:"",Map:"",map:"",mapsto:"",mapstodown:"",mapstoleft:"",mapstoup:"",marker:"",mcomma:"",Mcy:"",mcy:"",mdash:"",mDDot:"",measuredangle:"",MediumSpace:"",Mellintrf:"",Mfr:"",mfr:"",mho:"",micro:"",midast:"*",midcir:"",mid:"",middot:"",minusb:"",minus:"",minusd:"",minusdu:"",MinusPlus:"",mlcp:"",mldr:"",mnplus:"",models:"",Mopf:"",mopf:"",mp:"",mscr:"",Mscr:"",mstpos:"",Mu:"",mu:"",multimap:"",mumap:"",nabla:"",Nacute:"",nacute:"",nang:"",nap:"",napE:"",napid:"",napos:"",napprox:"",natural:"",naturals:"",natur:"",nbsp:"",nbump:"",nbumpe:"",ncap:"",Ncaron:"",ncaron:"",Ncedil:"",ncedil:"",ncong:"",ncongdot:"",ncup:"",Ncy:"",ncy:"",ndash:"",nearhk:"",nearr:"",neArr:"",nearrow:"",ne:"",nedot:"",NegativeMediumSpace:"",NegativeThickSpace:"",NegativeThinSpace:"",NegativeVeryThinSpace:"",nequiv:"",nesear:"",nesim:"",NestedGreaterGreater:"",NestedLessLess:"",NewLine:"\n",nexist:"",nexists:"",Nfr:"",nfr:"",ngE:"",nge:"",ngeq:"",ngeqq:"",ngeqslant:"",nges:"",nGg:"",ngsim:"",nGt:"",ngt:"",ngtr:"",nGtv:"",nharr:"",nhArr:"",nhpar:"",ni:"",nis:"",nisd:"",niv:"",NJcy:"",njcy:"",nlarr:"",nlArr:"",nldr:"",nlE:"",nle:"",nleftarrow:"",nLeftarrow:"",nleftrightarrow:"",nLeftrightarrow:"",nleq:"",nleqq:"",nleqslant:"",nles:"",nless:"",nLl:"",nlsim:"",nLt:"",nlt:"",nltri:"",nltrie:"",nLtv:"",nmid:"",NoBreak:"",NonBreakingSpace:"",nopf:"",Nopf:"",Not:"",not:"",NotCongruent:"",NotCupCap:"",NotDoubleVerticalBar:"",NotElement:"",NotEqual:"",NotEqualTilde:"",NotExists:"",NotGreater:"",NotGreaterEqual:"",NotGreaterFullEqual:"",NotGreaterGreater:"",NotGreaterLess:"",NotGreaterSlantEqual:"",NotGreaterTilde:"",NotHumpDownHump:"",NotHumpEqual:"",notin:"",notindot:"",notinE:"",notinva:"",notinvb:"",notinvc:"",NotLeftTriangleBar:"",NotLeftTriangle:"",NotLeftTriangleEqual:"",NotLess:"",NotLessEqual:"",NotLessGreater:"",NotLessLess:"",NotLessSlantEqual:"",NotLessTilde:"",NotNestedGreaterGreater:"",NotNestedLessLess:"",notni:"",notniva:"",notnivb:"",notnivc:"",NotPrecedes:"",NotPrecedesEqual:"",NotPrecedesSlantEqual:"",NotReverseElement:"",NotRightTriangleBar:"",NotRightTriangle:"",NotRightTriangleEqual:"",NotSquareSubset:"",NotSquareSubsetEqual:"",NotSquareSuperset:"",NotSquareSupersetEqual:"",NotSubset:"",NotSubsetEqual:"",NotSucceeds:"",NotSucceedsEqual:"",NotSucceedsSlantEqual:"",NotSucceedsTilde:"",NotSuperset:"",NotSupersetEqual:"",NotTilde:"",NotTildeEqual:"",NotTildeFullEqual:"",NotTildeTilde:"",NotVerticalBar:"",nparallel:"",npar:"",nparsl:"",npart:"",npolint:"",npr:"",nprcue:"",nprec:"",npreceq:"",npre:"",nrarrc:"",nrarr:"",nrArr:"",nrarrw:"",nrightarrow:"",nRightarrow:"",nrtri:"",nrtrie:"",nsc:"",nsccue:"",nsce:"",Nscr:"",nscr:"",nshortmid:"",nshortparallel:"",nsim:"",nsime:"",nsimeq:"",nsmid:"",nspar:"",nsqsube:"",nsqsupe:"",nsub:"",nsubE:"",nsube:"",nsubset:"",nsubseteq:"",nsubseteqq:"",nsucc:"",nsucceq:"",nsup:"",nsupE:"",nsupe:"",nsupset:"",nsupseteq:"",nsupseteqq:"",ntgl:"",Ntilde:"",ntilde:"",ntlg:"",ntriangleleft:"",ntrianglelefteq:"",ntriangleright:"",ntrianglerighteq:"",Nu:"",nu:"",num:"#",numero:"",numsp:"",nvap:"",nvdash:"",nvDash:"",nVdash:"",nVDash:"",nvge:"",nvgt:">",nvHarr:"",nvinfin:"",nvlArr:"",nvle:"",nvlt:"<",nvltrie:"",nvrArr:"",nvrtrie:"",nvsim:"",nwarhk:"",nwarr:"",nwArr:"",nwarrow:"",nwnear:"",Oacute:"",oacute:"",oast:"",Ocirc:"",ocirc:"",ocir:"",Ocy:"",ocy:"",odash:"",Odblac:"",odblac:"",odiv:"",odot:"",odsold:"",OElig:"",oelig:"",ofcir:"",Ofr:"",ofr:"",ogon:"",Ograve:"",ograve:"",ogt:"",ohbar:"",ohm:"",oint:"",olarr:"",olcir:"",olcross:"",oline:"",olt:"",Omacr:"",omacr:"",Omega:"",omega:"",Omicron:"",omicron:"",omid:"",ominus:"",Oopf:"",oopf:"",opar:"",OpenCurlyDoubleQuote:"",OpenCurlyQuote:"",operp:"",oplus:"",orarr:"",Or:"",or:"",ord:"",order:"",orderof:"",ordf:"",ordm:"",origof:"",oror:"",orslope:"",orv:"",oS:"",Oscr:"",oscr:"",Oslash:"",oslash:"",osol:"",Otilde:"",otilde:"",otimesas:"",Otimes:"",otimes:"",Ouml:"",ouml:"",ovbar:"",OverBar:"",OverBrace:"",OverBracket:"",OverParenthesis:"",para:"",parallel:"",par:"",parsim:"",parsl:"",part:"",PartialD:"",Pcy:"",pcy:"",percnt:"%",period:".",permil:"",perp:"",pertenk:"",Pfr:"",pfr:"",Phi:"",phi:"",phiv:"",phmmat:"",phone:"",Pi:"",pi:"",pitchfork:"",piv:"",planck:"",planckh:"",plankv:"",plusacir:"",plusb:"",pluscir:"",plus:"+",plusdo:"",plusdu:"",pluse:"",PlusMinus:"",plusmn:"",plussim:"",plustwo:"",pm:"",Poincareplane:"",pointint:"",popf:"",Popf:"",pound:"",prap:"",Pr:"",pr:"",prcue:"",precapprox:"",prec:"",preccurlyeq:"",Precedes:"",PrecedesEqual:"",PrecedesSlantEqual:"",PrecedesTilde:"",preceq:"",precnapprox:"",precneqq:"",precnsim:"",pre:"",prE:"",precsim:"",prime:"",Prime:"",primes:"",prnap:"",prnE:"",prnsim:"",prod:"",Product:"",profalar:"",profline:"",profsurf:"",prop:"",Proportional:"",Proportion:"",propto:"",prsim:"",prurel:"",Pscr:"",pscr:"",Psi:"",psi:"",puncsp:"",Qfr:"",qfr:"",qint:"",qopf:"",Qopf:"",qprime:"",Qscr:"",qscr:"",quaternions:"",quatint:"",quest:"?",questeq:"",quot:'"',QUOT:'"',rAarr:"",race:"",Racute:"",racute:"",radic:"",raemptyv:"",rang:"",Rang:"",rangd:"",range:"",rangle:"",raquo:"",rarrap:"",rarrb:"",rarrbfs:"",rarrc:"",rarr:"",Rarr:"",rArr:"",rarrfs:"",rarrhk:"",rarrlp:"",rarrpl:"",rarrsim:"",Rarrtl:"",rarrtl:"",rarrw:"",ratail:"",rAtail:"",ratio:"",rationals:"",rbarr:"",rBarr:"",RBarr:"",rbbrk:"",rbrace:"}",rbrack:"]",rbrke:"",rbrksld:"",rbrkslu:"",Rcaron:"",rcaron:"",Rcedil:"",rcedil:"",rceil:"",rcub:"}",Rcy:"",rcy:"",rdca:"",rdldhar:"",rdquo:"",rdquor:"",rdsh:"",real:"",realine:"",realpart:"",reals:"",Re:"",rect:"",reg:"",REG:"",ReverseElement:"",ReverseEquilibrium:"",ReverseUpEquilibrium:"",rfisht:"",rfloor:"",rfr:"",Rfr:"",rHar:"",rhard:"",rharu:"",rharul:"",Rho:"",rho:"",rhov:"",RightAngleBracket:"",RightArrowBar:"",rightarrow:"",RightArrow:"",Rightarrow:"",RightArrowLeftArrow:"",rightarrowtail:"",RightCeiling:"",RightDoubleBracket:"",RightDownTeeVector:"",RightDownVectorBar:"",RightDownVector:"",RightFloor:"",rightharpoondown:"",rightharpoonup:"",rightleftarrows:"",rightleftharpoons:"",rightrightarrows:"",rightsquigarrow:"",RightTeeArrow:"",RightTee:"",RightTeeVector:"",rightthreetimes:"",RightTriangleBar:"",RightTriangle:"",RightTriangleEqual:"",RightUpDownVector:"",RightUpTeeVector:"",RightUpVectorBar:"",RightUpVector:"",RightVectorBar:"",RightVector:"",ring:"",risingdotseq:"",rlarr:"",rlhar:"",rlm:"",rmoustache:"",rmoust:"",rnmid:"",roang:"",roarr:"",robrk:"",ropar:"",ropf:"",Ropf:"",roplus:"",rotimes:"",RoundImplies:"",rpar:")",rpargt:"",rppolint:"",rrarr:"",Rrightarrow:"",rsaquo:"",rscr:"",Rscr:"",rsh:"",Rsh:"",rsqb:"]",rsquo:"",rsquor:"",rthree:"",rtimes:"",rtri:"",rtrie:"",rtrif:"",rtriltri:"",RuleDelayed:"",ruluhar:"",rx:"",Sacute:"",sacute:"",sbquo:"",scap:"",Scaron:"",scaron:"",Sc:"",sc:"",sccue:"",sce:"",scE:"",Scedil:"",scedil:"",Scirc:"",scirc:"",scnap:"",scnE:"",scnsim:"",scpolint:"",scsim:"",Scy:"",scy:"",sdotb:"",sdot:"",sdote:"",searhk:"",searr:"",seArr:"",searrow:"",sect:"",semi:";",seswar:"",setminus:"",setmn:"",sext:"",Sfr:"",sfr:"",sfrown:"",sharp:"",SHCHcy:"",shchcy:"",SHcy:"",shcy:"",ShortDownArrow:"",ShortLeftArrow:"",shortmid:"",shortparallel:"",ShortRightArrow:"",ShortUpArrow:"",shy:"",Sigma:"",sigma:"",sigmaf:"",sigmav:"",sim:"",simdot:"",sime:"",simeq:"",simg:"",simgE:"",siml:"",simlE:"",simne:"",simplus:"",simrarr:"",slarr:"",SmallCircle:"",smallsetminus:"",smashp:"",smeparsl:"",smid:"",smile:"",smt:"",smte:"",smtes:"",SOFTcy:"",softcy:"",solbar:"",solb:"",sol:"/",Sopf:"",sopf:"",spades:"",spadesuit:"",spar:"",sqcap:"",sqcaps:"",sqcup:"",sqcups:"",Sqrt:"",sqsub:"",sqsube:"",sqsubset:"",sqsubseteq:"",sqsup:"",sqsupe:"",sqsupset:"",sqsupseteq:"",square:"",Square:"",SquareIntersection:"",SquareSubset:"",SquareSubsetEqual:"",SquareSuperset:"",SquareSupersetEqual:"",SquareUnion:"",squarf:"",squ:"",squf:"",srarr:"",Sscr:"",sscr:"",ssetmn:"",ssmile:"",sstarf:"",Star:"",star:"",starf:"",straightepsilon:"",straightphi:"",strns:"",sub:"",Sub:"",subdot:"",subE:"",sube:"",subedot:"",submult:"",subnE:"",subne:"",subplus:"",subrarr:"",subset:"",Subset:"",subseteq:"",subseteqq:"",SubsetEqual:"",subsetneq:"",subsetneqq:"",subsim:"",subsub:"",subsup:"",succapprox:"",succ:"",succcurlyeq:"",Succeeds:"",SucceedsEqual:"",SucceedsSlantEqual:"",SucceedsTilde:"",succeq:"",succnapprox:"",succneqq:"",succnsim:"",succsim:"",SuchThat:"",sum:"",Sum:"",sung:"",sup1:"",sup2:"",sup3:"",sup:"",Sup:"",supdot:"",supdsub:"",supE:"",supe:"",supedot:"",Superset:"",SupersetEqual:"",suphsol:"",suphsub:"",suplarr:"",supmult:"",supnE:"",supne:"",supplus:"",supset:"",Supset:"",supseteq:"",supseteqq:"",supsetneq:"",supsetneqq:"",supsim:"",supsub:"",supsup:"",swarhk:"",swarr:"",swArr:"",swarrow:"",swnwar:"",szlig:"",Tab:"\t",target:"",Tau:"",tau:"",tbrk:"",Tcaron:"",tcaron:"",Tcedil:"",tcedil:"",Tcy:"",tcy:"",tdot:"",telrec:"",Tfr:"",tfr:"",there4:"",therefore:"",Therefore:"",Theta:"",theta:"",thetasym:"",thetav:"",thickapprox:"",thicksim:"",ThickSpace:"",ThinSpace:"",thinsp:"",thkap:"",thksim:"",THORN:"",thorn:"",tilde:"",Tilde:"",TildeEqual:"",TildeFullEqual:"",TildeTilde:"",timesbar:"",timesb:"",times:"",timesd:"",tint:"",toea:"",topbot:"",topcir:"",top:"",Topf:"",topf:"",topfork:"",tosa:"",tprime:"",trade:"",TRADE:"",triangle:"",triangledown:"",triangleleft:"",trianglelefteq:"",triangleq:"",triangleright:"",trianglerighteq:"",tridot:"",trie:"",triminus:"",TripleDot:"",triplus:"",trisb:"",tritime:"",trpezium:"",Tscr:"",tscr:"",TScy:"",tscy:"",TSHcy:"",tshcy:"",Tstrok:"",tstrok:"",twixt:"",twoheadleftarrow:"",twoheadrightarrow:"",Uacute:"",uacute:"",uarr:"",Uarr:"",uArr:"",Uarrocir:"",Ubrcy:"",ubrcy:"",Ubreve:"",ubreve:"",Ucirc:"",ucirc:"",Ucy:"",ucy:"",udarr:"",Udblac:"",udblac:"",udhar:"",ufisht:"",Ufr:"",ufr:"",Ugrave:"",ugrave:"",uHar:"",uharl:"",uharr:"",uhblk:"",ulcorn:"",ulcorner:"",ulcrop:"",ultri:"",Umacr:"",umacr:"",uml:"",UnderBar:"_",UnderBrace:"",UnderBracket:"",UnderParenthesis:"",Union:"",UnionPlus:"",Uogon:"",uogon:"",Uopf:"",uopf:"",UpArrowBar:"",uparrow:"",UpArrow:"",Uparrow:"",UpArrowDownArrow:"",updownarrow:"",UpDownArrow:"",Updownarrow:"",UpEquilibrium:"",upharpoonleft:"",upharpoonright:"",uplus:"",UpperLeftArrow:"",UpperRightArrow:"",upsi:"",Upsi:"",upsih:"",Upsilon:"",upsilon:"",UpTeeArrow:"",UpTee:"",upuparrows:"",urcorn:"",urcorner:"",urcrop:"",Uring:"",uring:"",urtri:"",Uscr:"",uscr:"",utdot:"",Utilde:"",utilde:"",utri:"",utrif:"",uuarr:"",Uuml:"",uuml:"",uwangle:"",vangrt:"",varepsilon:"",varkappa:"",varnothing:"",varphi:"",varpi:"",varpropto:"",varr:"",vArr:"",varrho:"",varsigma:"",varsubsetneq:"",varsubsetneqq:"",varsupsetneq:"",varsupsetneqq:"",vartheta:"",vartriangleleft:"",vartriangleright:"",vBar:"",Vbar:"",vBarv:"",Vcy:"",vcy:"",vdash:"",vDash:"",Vdash:"",VDash:"",Vdashl:"",veebar:"",vee:"",Vee:"",veeeq:"",vellip:"",verbar:"|",Verbar:"",vert:"|",Vert:"",VerticalBar:"",VerticalLine:"|",VerticalSeparator:"",VerticalTilde:"",VeryThinSpace:"",Vfr:"",vfr:"",vltri:"",vnsub:"",vnsup:"",Vopf:"",vopf:"",vprop:"",vrtri:"",Vscr:"",vscr:"",vsubnE:"",vsubne:"",vsupnE:"",vsupne:"",Vvdash:"",vzigzag:"",Wcirc:"",wcirc:"",wedbar:"",wedge:"",Wedge:"",wedgeq:"",weierp:"",Wfr:"",wfr:"",Wopf:"",wopf:"",wp:"",wr:"",wreath:"",Wscr:"",wscr:"",xcap:"",xcirc:"",xcup:"",xdtri:"",Xfr:"",xfr:"",xharr:"",xhArr:"",Xi:"",xi:"",xlarr:"",xlArr:"",xmap:"",xnis:"",xodot:"",Xopf:"",xopf:"",xoplus:"",xotime:"",xrarr:"",xrArr:"",Xscr:"",xscr:"",xsqcup:"",xuplus:"",xutri:"",xvee:"",xwedge:"",Yacute:"",yacute:"",YAcy:"",yacy:"",Ycirc:"",ycirc:"",Ycy:"",ycy:"",yen:"",Yfr:"",yfr:"",YIcy:"",yicy:"",Yopf:"",yopf:"",Yscr:"",yscr:"",YUcy:"",yucy:"",yuml:"",Yuml:"",Zacute:"",zacute:"",Zcaron:"",zcaron:"",Zcy:"",zcy:"",Zdot:"",zdot:"",zeetrf:"",ZeroWidthSpace:"",Zeta:"",zeta:"",zfr:"",Zfr:"",ZHcy:"",zhcy:"",zigrarr:"",zopf:"",Zopf:"",Zscr:"",zscr:"",zwj:"",zwnj:""}},{}],47:[function(e,t,i){t.exports={Aacute:"",aacute:"",Acirc:"",acirc:"",acute:"",AElig:"",aelig:"",Agrave:"",agrave:"",amp:"&",AMP:"&",Aring:"",aring:"",Atilde:"",atilde:"",Auml:"",auml:"",brvbar:"",Ccedil:"",ccedil:"",cedil:"",cent:"",copy:"",COPY:"",curren:"",deg:"",divide:"",Eacute:"",eacute:"",Ecirc:"",ecirc:"",Egrave:"",egrave:"",ETH:"",eth:"",Euml:"",euml:"",frac12:"",frac14:"",frac34:"",gt:">",GT:">",Iacute:"",iacute:"",Icirc:"",icirc:"",iexcl:"",Igrave:"",igrave:"",iquest:"",Iuml:"",iuml:"",laquo:"",lt:"<",LT:"<",macr:"",micro:"",middot:"",nbsp:"",not:"",Ntilde:"",ntilde:"",Oacute:"",oacute:"",Ocirc:"",ocirc:"",Ograve:"",ograve:"",ordf:"",ordm:"",Oslash:"",oslash:"",Otilde:"",otilde:"",Ouml:"",ouml:"",para:"",plusmn:"",pound:"",quot:'"',QUOT:'"',raquo:"",reg:"",REG:"",sect:"",shy:"",sup1:"",sup2:"",sup3:"",szlig:"",THORN:"",thorn:"",times:"",Uacute:"",uacute:"",Ucirc:"",ucirc:"",Ugrave:"",ugrave:"",uml:"",Uuml:"",uuml:"",Yacute:"",yacute:"",yen:"",yuml:""}},{}],48:[function(e,t,i){t.exports={amp:"&",apos:"'",gt:">",lt:"<",quot:'"'}},{}],49:[function(e,t,i){function n(e){this._cbs=e||{},this.events=[]}t.exports=n;var o=e("./").EVENTS;Object.keys(o).forEach(function(i){if(0===o[i])i="on"+i,n.prototype[i]=function(){this.events.push([i]),this._cbs[i]&&this._cbs[i]()};else if(1===o[i])i="on"+i,n.prototype[i]=function(e){this.events.push([i,e]),this._cbs[i]&&this._cbs[i](e)};else{if(2!==o[i])throw Error("wrong number of arguments");i="on"+i,n.prototype[i]=function(e,t){this.events.push([i,e,t]),this._cbs[i]&&this._cbs[i](e,t)}}}),n.prototype.onreset=function(){this.events=[],this._cbs.onreset&&this._cbs.onreset()},n.prototype.restart=function(){this._cbs.onreset&&this._cbs.onreset();for(var e,t=0,i=this.events.length;t<i;t++)this._cbs[this.events[t][0]]&&(1===(e=this.events[t].length)?this._cbs[this.events[t][0]]():2===e?this._cbs[this.events[t][0]](this.events[t][1]):this._cbs[this.events[t][0]](this.events[t][1],this.events[t][2]))}},{"./":56}],50:[function(e,t,i){var n=e("./index.js"),o=n.DomHandler,s=n.DomUtils;function r(e,t){this.init(e,t)}function a(e,t){return s.getElementsByTagName(e,t,!0)}function l(e,t){return s.getElementsByTagName(e,t,!0,1)[0]}function c(e,t,i){return s.getText(s.getElementsByTagName(e,t,i,1)).trim()}function h(e,t,i,n,o){o=c(i,n,o);o&&(e[t]=o)}e("inherits")(r,o),r.prototype.init=o;function u(e){return"rss"===e||"feed"===e||"rdf:RDF"===e}r.prototype.onend=function(){var e,t,i={},n=l(u,this.dom);n&&("feed"===n.name?(t=n.children,i.type="atom",h(i,"id","id",t),h(i,"title","title",t),(e=l("link",t))&&(e=e.attribs)&&(e=e.href)&&(i.link=e),h(i,"description","subtitle",t),(e=c("updated",t))&&(i.updated=new Date(e)),h(i,"author","email",t,!0),i.items=a("entry",t).map(function(e){var t,i={};return h(i,"id","id",e=e.children),h(i,"title","title",e),(t=l("link",e))&&(t=t.attribs)&&(t=t.href)&&(i.link=t),(t=c("summary",e)||c("content",e))&&(i.description=t),(t=c("updated",e))&&(i.pubDate=new Date(t)),i})):(t=l("channel",n.children).children,i.type=n.name.substr(0,3),i.id="",h(i,"title","title",t),h(i,"link","link",t),h(i,"description","description",t),(e=c("lastBuildDate",t))&&(i.updated=new Date(e)),h(i,"author","managingEditor",t,!0),i.items=a("item",n.children).map(function(e){var t={};return h(t,"id","guid",e=e.children),h(t,"title","title",e),h(t,"link","link",e),h(t,"description","description",e),(e=c("pubDate",e))&&(t.pubDate=new Date(e)),t}))),this.dom=i,o.prototype._handleCallback.call(this,n?null:Error("couldn't find root of feed"))},t.exports=r},{"./index.js":56,inherits:57}],51:[function(e,t,i){var n=e("./Tokenizer.js"),o={input:!0,option:!0,optgroup:!0,select:!0,button:!0,datalist:!0,textarea:!0},s={tr:{tr:!0,th:!0,td:!0},th:{th:!0},td:{thead:!0,th:!0,td:!0},body:{head:!0,link:!0,script:!0},li:{li:!0},p:{p:!0},h1:{p:!0},h2:{p:!0},h3:{p:!0},h4:{p:!0},h5:{p:!0},h6:{p:!0},select:o,input:o,output:o,button:o,datalist:o,textarea:o,option:{option:!0},optgroup:{optgroup:!0}},r={__proto__:null,area:!0,base:!0,basefont:!0,br:!0,col:!0,command:!0,embed:!0,frame:!0,hr:!0,img:!0,input:!0,isindex:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0,path:!0,circle:!0,ellipse:!0,line:!0,rect:!0,use:!0,stop:!0,polyline:!0,polygon:!0},a=/\s|\//;function l(e,t){this._options=t||{},this._cbs=e||{},this._tagname="",this._attribname="",this._attribvalue="",this._attribs=null,this._stack=[],this.startIndex=0,this.endIndex=null,this._lowerCaseTagNames="lowerCaseTags"in this._options?!!this._options.lowerCaseTags:!this._options.xmlMode,this._lowerCaseAttributeNames="lowerCaseAttributeNames"in this._options?!!this._options.lowerCaseAttributeNames:!this._options.xmlMode,this._options.Tokenizer&&(n=this._options.Tokenizer),this._tokenizer=new n(this._options,this),this._cbs.onparserinit&&this._cbs.onparserinit(this)}e("inherits")(l,e("events").EventEmitter),l.prototype._updatePosition=function(e){null===this.endIndex?this._tokenizer._sectionStart<=e?this.startIndex=0:this.startIndex=this._tokenizer._sectionStart-e:this.startIndex=this.endIndex+1,this.endIndex=this._tokenizer.getAbsoluteIndex()},l.prototype.ontext=function(e){this._updatePosition(1),this.endIndex--,this._cbs.ontext&&this._cbs.ontext(e)},l.prototype.onopentagname=function(e){if(this._lowerCaseTagNames&&(e=e.toLowerCase()),this._tagname=e,!this._options.xmlMode&&e in s)for(var t;(t=this._stack[this._stack.length-1])in s[e];this.onclosetag(t));!this._options.xmlMode&&e in r||this._stack.push(e),this._cbs.onopentagname&&this._cbs.onopentagname(e),this._cbs.onopentag&&(this._attribs={})},l.prototype.onopentagend=function(){this._updatePosition(1),this._attribs&&(this._cbs.onopentag&&this._cbs.onopentag(this._tagname,this._attribs),this._attribs=null),!this._options.xmlMode&&this._cbs.onclosetag&&this._tagname in r&&this._cbs.onclosetag(this._tagname),this._tagname=""},l.prototype.onclosetag=function(e){if(this._updatePosition(1),this._lowerCaseTagNames&&(e=e.toLowerCase()),!this._stack.length||e in r&&!this._options.xmlMode)this._options.xmlMode||"br"!==e&&"p"!==e||(this.onopentagname(e),this._closeCurrentTag());else{var t=this._stack.lastIndexOf(e);if(-1!==t)if(this._cbs.onclosetag)for(t=this._stack.length-t;t--;)this._cbs.onclosetag(this._stack.pop());else this._stack.length=t;else"p"!==e||this._options.xmlMode||(this.onopentagname(e),this._closeCurrentTag())}},l.prototype.onselfclosingtag=function(){this._options.xmlMode||this._options.recognizeSelfClosing?this._closeCurrentTag():this.onopentagend()},l.prototype._closeCurrentTag=function(){var e=this._tagname;this.onopentagend(),this._stack[this._stack.length-1]===e&&(this._cbs.onclosetag&&this._cbs.onclosetag(e),this._stack.pop())},l.prototype.onattribname=function(e){this._lowerCaseAttributeNames&&(e=e.toLowerCase()),this._attribname=e},l.prototype.onattribdata=function(e){this._attribvalue+=e},l.prototype.onattribend=function(){this._cbs.onattribute&&this._cbs.onattribute(this._attribname,this._attribvalue),this._attribs&&!Object.prototype.hasOwnProperty.call(this._attribs,this._attribname)&&(this._attribs[this._attribname]=this._attribvalue),this._attribname="",this._attribvalue=""},l.prototype._getInstructionName=function(e){var t=e.search(a),t=t<0?e:e.substr(0,t);return t=this._lowerCaseTagNames?t.toLowerCase():t},l.prototype.ondeclaration=function(e){var t;this._cbs.onprocessinginstruction&&(t=this._getInstructionName(e),this._cbs.onprocessinginstruction("!"+t,"!"+e))},l.prototype.onprocessinginstruction=function(e){var t;this._cbs.onprocessinginstruction&&(t=this._getInstructionName(e),this._cbs.onprocessinginstruction("?"+t,"?"+e))},l.prototype.oncomment=function(e){this._updatePosition(4),this._cbs.oncomment&&this._cbs.oncomment(e),this._cbs.oncommentend&&this._cbs.oncommentend()},l.prototype.oncdata=function(e){this._updatePosition(1),this._options.xmlMode||this._options.recognizeCDATA?(this._cbs.oncdatastart&&this._cbs.oncdatastart(),this._cbs.ontext&&this._cbs.ontext(e),this._cbs.oncdataend&&this._cbs.oncdataend()):this.oncomment("[CDATA["+e+"]]")},l.prototype.onerror=function(e){this._cbs.onerror&&this._cbs.onerror(e)},l.prototype.onend=function(){if(this._cbs.onclosetag)for(var e=this._stack.length;0<e;this._cbs.onclosetag(this._stack[--e]));this._cbs.onend&&this._cbs.onend()},l.prototype.reset=function(){this._cbs.onreset&&this._cbs.onreset(),this._tokenizer.reset(),this._tagname="",this._attribname="",this._attribs=null,this._stack=[],this._cbs.onparserinit&&this._cbs.onparserinit(this)},l.prototype.parseComplete=function(e){this.reset(),this.end(e)},l.prototype.write=function(e){this._tokenizer.write(e)},l.prototype.end=function(e){this._tokenizer.end(e)},l.prototype.pause=function(){this._tokenizer.pause()},l.prototype.resume=function(){this._tokenizer.resume()},l.prototype.parseChunk=l.prototype.write,l.prototype.done=l.prototype.end,t.exports=l},{"./Tokenizer.js":54,events:6,inherits:57}],52:[function(e,t,i){function n(e){this._cbs=e||{}}t.exports=n;var o=e("./").EVENTS;Object.keys(o).forEach(function(i){if(0===o[i])i="on"+i,n.prototype[i]=function(){this._cbs[i]&&this._cbs[i]()};else if(1===o[i])i="on"+i,n.prototype[i]=function(e){this._cbs[i]&&this._cbs[i](e)};else{if(2!==o[i])throw Error("wrong number of arguments");i="on"+i,n.prototype[i]=function(e,t){this._cbs[i]&&this._cbs[i](e,t)}}})},{"./":56}],53:[function(e,t,i){t.exports=o;var n=e("./WritableStream.js");function o(e){n.call(this,new s(this),e)}function s(e){this.scope=e}e("inherits")(o,n),o.prototype.readable=!0;var r=e("../").EVENTS;Object.keys(r).forEach(function(i){if(0===r[i])s.prototype["on"+i]=function(){this.scope.emit(i)};else if(1===r[i])s.prototype["on"+i]=function(e){this.scope.emit(i,e)};else{if(2!==r[i])throw Error("wrong number of arguments!");s.prototype["on"+i]=function(e,t){this.scope.emit(i,e,t)}}})},{"../":56,"./WritableStream.js":55,inherits:57}],54:[function(e,t,i){t.exports=m;var n,o,s=e("entities/lib/decode_codepoint.js"),r=e("entities/maps/entities.json"),a=e("entities/maps/legacy.json"),l=e("entities/maps/xml.json"),e=0,c=e++,e=(e++,e++,e++,e++,e++,e++,e++,e++,e++,e++,e++,e++,e++,e++,e++,e++,e++,e++,e++,e++,e++,e++,e++,e++,e++,e++,e++,e++,e++,e++,e++,e++,e++,e++,e++,e++,e++,e++,e++,e++,e++,e++,e++,e++,e++,e++,e++,e++,e++,e++,e++,e++,e++,0),h=e++;e++;function u(e){return" "===e||"\n"===e||"\t"===e||"\f"===e||"\r"===e}function p(t,i,n){var o=t.toLowerCase();return t===o?function(e){e===o?this._state=i:(this._state=n,this._index--)}:function(e){e===o||e===t?this._state=i:(this._state=n,this._index--)}}function d(t,i){var n=t.toLowerCase();return function(e){e===n||e===t?this._state=i:(this._state=2,this._index--)}}function m(e,t){this._state=c,this._buffer="",this._sectionStart=0,this._index=0,this._bufferOffset=0,this._baseState=c,this._special=h,this._cbs=t,this._running=!0,this._ended=!1,this._xmlMode=!(!e||!e.xmlMode),this._decodeEntities=!(!e||!e.decodeEntities)}m.prototype._stateText=function(e){"<"===e?(this._index>this._sectionStart&&this._cbs.ontext(this._getSection()),this._state=1,this._sectionStart=this._index):this._decodeEntities&&this._special===h&&"&"===e&&(this._index>this._sectionStart&&this._cbs.ontext(this._getSection()),this._baseState=c,this._state=50,this._sectionStart=this._index)},m.prototype._stateBeforeTagName=function(e){"/"===e?this._state=4:"<"===e?(this._cbs.ontext(this._getSection()),this._sectionStart=this._index):">"===e||this._special!==h||u(e)?this._state=c:"!"===e?(this._state=14,this._sectionStart=this._index+1):"?"===e?(this._state=16,this._sectionStart=this._index+1):(this._state=this._xmlMode||"s"!==e&&"S"!==e?2:30,this._sectionStart=this._index)},m.prototype._stateInTagName=function(e){"/"!==e&&">"!==e&&!u(e)||(this._emitToken("onopentagname"),this._state=7,this._index--)},m.prototype._stateBeforeCloseingTagName=function(e){u(e)||(">"===e?this._state=c:this._special!==h?"s"===e||"S"===e?this._state=31:(this._state=c,this._index--):(this._state=5,this._sectionStart=this._index))},m.prototype._stateInCloseingTagName=function(e){">"!==e&&!u(e)||(this._emitToken("onclosetag"),this._state=6,this._index--)},m.prototype._stateAfterCloseingTagName=function(e){">"===e&&(this._state=c,this._sectionStart=this._index+1)},m.prototype._stateBeforeAttributeName=function(e){">"===e?(this._cbs.onopentagend(),this._state=c,this._sectionStart=this._index+1):"/"===e?this._state=3:u(e)||(this._state=8,this._sectionStart=this._index)},m.prototype._stateInSelfClosingTag=function(e){">"===e?(this._cbs.onselfclosingtag(),this._state=c,this._sectionStart=this._index+1):u(e)||(this._state=7,this._index--)},m.prototype._stateInAttributeName=function(e){"="!==e&&"/"!==e&&">"!==e&&!u(e)||(this._cbs.onattribname(this._getSection()),this._sectionStart=-1,this._state=9,this._index--)},m.prototype._stateAfterAttributeName=function(e){"="===e?this._state=10:"/"===e||">"===e?(this._cbs.onattribend(),this._state=7,this._index--):u(e)||(this._cbs.onattribend(),this._state=8,this._sectionStart=this._index)},m.prototype._stateBeforeAttributeValue=function(e){'"'===e?(this._state=11,this._sectionStart=this._index+1):"'"===e?(this._state=12,this._sectionStart=this._index+1):u(e)||(this._state=13,this._sectionStart=this._index,this._index--)},m.prototype._stateInAttributeValueDoubleQuotes=function(e){'"'===e?(this._emitToken("onattribdata"),this._cbs.onattribend(),this._state=7):this._decodeEntities&&"&"===e&&(this._emitToken("onattribdata"),this._baseState=this._state,this._state=50,this._sectionStart=this._index)},m.prototype._stateInAttributeValueSingleQuotes=function(e){"'"===e?(this._emitToken("onattribdata"),this._cbs.onattribend(),this._state=7):this._decodeEntities&&"&"===e&&(this._emitToken("onattribdata"),this._baseState=this._state,this._state=50,this._sectionStart=this._index)},m.prototype._stateInAttributeValueNoQuotes=function(e){u(e)||">"===e?(this._emitToken("onattribdata"),this._cbs.onattribend(),this._state=7,this._index--):this._decodeEntities&&"&"===e&&(this._emitToken("onattribdata"),this._baseState=this._state,this._state=50,this._sectionStart=this._index)},m.prototype._stateBeforeDeclaration=function(e){this._state="["===e?21:"-"===e?17:15},m.prototype._stateInDeclaration=function(e){">"===e&&(this._cbs.ondeclaration(this._getSection()),this._state=c,this._sectionStart=this._index+1)},m.prototype._stateInProcessingInstruction=function(e){">"===e&&(this._cbs.onprocessinginstruction(this._getSection()),this._state=c,this._sectionStart=this._index+1)},m.prototype._stateBeforeComment=function(e){"-"===e?(this._state=18,this._sectionStart=this._index+1):this._state=15},m.prototype._stateInComment=function(e){"-"===e&&(this._state=19)},m.prototype._stateAfterComment1=function(e){this._state="-"===e?20:18},m.prototype._stateAfterComment2=function(e){">"===e?(this._cbs.oncomment(this._buffer.substring(this._sectionStart,this._index-2)),this._state=c,this._sectionStart=this._index+1):"-"!==e&&(this._state=18)},m.prototype._stateBeforeCdata1=p("C",22,15),m.prototype._stateBeforeCdata2=p("D",23,15),m.prototype._stateBeforeCdata3=p("A",24,15),m.prototype._stateBeforeCdata4=p("T",25,15),m.prototype._stateBeforeCdata5=p("A",26,15),m.prototype._stateBeforeCdata6=function(e){"["===e?(this._state=27,this._sectionStart=this._index+1):(this._state=15,this._index--)},m.prototype._stateInCdata=function(e){"]"===e&&(this._state=28)},m.prototype._stateAfterCdata1=(n="]",o=29,function(e){e===n&&(this._state=o)}),m.prototype._stateAfterCdata2=function(e){">"===e?(this._cbs.oncdata(this._buffer.substring(this._sectionStart,this._index-2)),this._state=c,this._sectionStart=this._index+1):"]"!==e&&(this._state=27)},m.prototype._stateBeforeSpecial=function(e){"c"===e||"C"===e?this._state=32:"t"===e||"T"===e?this._state=42:(this._state=2,this._index--)},m.prototype._stateBeforeSpecialEnd=function(e){1!==this._special||"c"!==e&&"C"!==e?2!==this._special||"t"!==e&&"T"!==e?this._state=c:this._state=46:this._state=37},m.prototype._stateBeforeScript1=d("R",33),m.prototype._stateBeforeScript2=d("I",34),m.prototype._stateBeforeScript3=d("P",35),m.prototype._stateBeforeScript4=d("T",36),m.prototype._stateBeforeScript5=function(e){"/"!==e&&">"!==e&&!u(e)||(this._special=1),this._state=2,this._index--},m.prototype._stateAfterScript1=p("R",38,c),m.prototype._stateAfterScript2=p("I",39,c),m.prototype._stateAfterScript3=p("P",40,c),m.prototype._stateAfterScript4=p("T",41,c),m.prototype._stateAfterScript5=function(e){">"===e||u(e)?(this._special=h,this._state=5,this._sectionStart=this._index-6,this._index--):this._state=c},m.prototype._stateBeforeStyle1=d("Y",43),m.prototype._stateBeforeStyle2=d("L",44),m.prototype._stateBeforeStyle3=d("E",45),m.prototype._stateBeforeStyle4=function(e){"/"!==e&&">"!==e&&!u(e)||(this._special=2),this._state=2,this._index--},m.prototype._stateAfterStyle1=p("Y",47,c),m.prototype._stateAfterStyle2=p("L",48,c),m.prototype._stateAfterStyle3=p("E",49,c),m.prototype._stateAfterStyle4=function(e){">"===e||u(e)?(this._special=h,this._state=5,this._sectionStart=this._index-5,this._index--):this._state=c},m.prototype._stateBeforeEntity=p("#",51,52),m.prototype._stateBeforeNumericEntity=p("X",54,53),m.prototype._parseNamedEntityStrict=function(){var e,t;this._sectionStart+1<this._index&&(e=this._buffer.substring(this._sectionStart+1,this._index),(t=this._xmlMode?l:r).hasOwnProperty(e)&&(this._emitPartial(t[e]),this._sectionStart=this._index+1))},m.prototype._parseLegacyEntity=function(){var e=this._sectionStart+1,t=this._index-e;for(6<t&&(t=6);2<=t;){var i=this._buffer.substr(e,t);if(a.hasOwnProperty(i))return this._emitPartial(a[i]),void(this._sectionStart+=t+1);t--}},m.prototype._stateInNamedEntity=function(e){";"===e?(this._parseNamedEntityStrict(),this._sectionStart+1<this._index&&!this._xmlMode&&this._parseLegacyEntity(),this._state=this._baseState):(e<"a"||"z"<e)&&(e<"A"||"Z"<e)&&(e<"0"||"9"<e)&&(this._xmlMode||this._sectionStart+1===this._index||(this._baseState!==c?"="!==e&&this._parseNamedEntityStrict():this._parseLegacyEntity()),this._state=this._baseState,this._index--)},m.prototype._decodeNumericEntity=function(e,t){e=this._sectionStart+e;e!==this._index?(e=this._buffer.substring(e,this._index),t=parseInt(e,t),this._emitPartial(s(t)),this._sectionStart=this._index):this._sectionStart--,this._state=this._baseState},m.prototype._stateInNumericEntity=function(e){";"===e?(this._decodeNumericEntity(2,10),this._sectionStart++):(e<"0"||"9"<e)&&(this._xmlMode?this._state=this._baseState:this._decodeNumericEntity(2,10),this._index--)},m.prototype._stateInHexEntity=function(e){";"===e?(this._decodeNumericEntity(3,16),this._sectionStart++):(e<"a"||"f"<e)&&(e<"A"||"F"<e)&&(e<"0"||"9"<e)&&(this._xmlMode?this._state=this._baseState:this._decodeNumericEntity(3,16),this._index--)},m.prototype._cleanup=function(){this._sectionStart<0?(this._buffer="",this._index=0,this._bufferOffset+=this._index):this._running&&(this._state===c?(this._sectionStart!==this._index&&this._cbs.ontext(this._buffer.substr(this._sectionStart)),this._buffer="",this._bufferOffset+=this._index,this._index=0):this._sectionStart===this._index?(this._buffer="",this._bufferOffset+=this._index,this._index=0):(this._buffer=this._buffer.substr(this._sectionStart),this._index-=this._sectionStart,this._bufferOffset+=this._sectionStart),this._sectionStart=0)},m.prototype.write=function(e){this._ended&&this._cbs.onerror(Error(".write() after done!")),this._buffer+=e,this._parse()},m.prototype._parse=function(){for(;this._index<this._buffer.length&&this._running;){var e=this._buffer.charAt(this._index);this._state===c?this._stateText(e):1===this._state?this._stateBeforeTagName(e):2===this._state?this._stateInTagName(e):4===this._state?this._stateBeforeCloseingTagName(e):5===this._state?this._stateInCloseingTagName(e):6===this._state?this._stateAfterCloseingTagName(e):3===this._state?this._stateInSelfClosingTag(e):7===this._state?this._stateBeforeAttributeName(e):8===this._state?this._stateInAttributeName(e):9===this._state?this._stateAfterAttributeName(e):10===this._state?this._stateBeforeAttributeValue(e):11===this._state?this._stateInAttributeValueDoubleQuotes(e):12===this._state?this._stateInAttributeValueSingleQuotes(e):13===this._state?this._stateInAttributeValueNoQuotes(e):14===this._state?this._stateBeforeDeclaration(e):15===this._state?this._stateInDeclaration(e):16===this._state?this._stateInProcessingInstruction(e):17===this._state?this._stateBeforeComment(e):18===this._state?this._stateInComment(e):19===this._state?this._stateAfterComment1(e):20===this._state?this._stateAfterComment2(e):21===this._state?this._stateBeforeCdata1(e):22===this._state?this._stateBeforeCdata2(e):23===this._state?this._stateBeforeCdata3(e):24===this._state?this._stateBeforeCdata4(e):25===this._state?this._stateBeforeCdata5(e):26===this._state?this._stateBeforeCdata6(e):27===this._state?this._stateInCdata(e):28===this._state?this._stateAfterCdata1(e):29===this._state?this._stateAfterCdata2(e):30===this._state?this._stateBeforeSpecial(e):31===this._state?this._stateBeforeSpecialEnd(e):32===this._state?this._stateBeforeScript1(e):33===this._state?this._stateBeforeScript2(e):34===this._state?this._stateBeforeScript3(e):35===this._state?this._stateBeforeScript4(e):36===this._state?this._stateBeforeScript5(e):37===this._state?this._stateAfterScript1(e):38===this._state?this._stateAfterScript2(e):39===this._state?this._stateAfterScript3(e):40===this._state?this._stateAfterScript4(e):41===this._state?this._stateAfterScript5(e):42===this._state?this._stateBeforeStyle1(e):43===this._state?this._stateBeforeStyle2(e):44===this._state?this._stateBeforeStyle3(e):45===this._state?this._stateBeforeStyle4(e):46===this._state?this._stateAfterStyle1(e):47===this._state?this._stateAfterStyle2(e):48===this._state?this._stateAfterStyle3(e):49===this._state?this._stateAfterStyle4(e):50===this._state?this._stateBeforeEntity(e):51===this._state?this._stateBeforeNumericEntity(e):52===this._state?this._stateInNamedEntity(e):53===this._state?this._stateInNumericEntity(e):54===this._state?this._stateInHexEntity(e):this._cbs.onerror(Error("unknown _state"),this._state),this._index++}this._cleanup()},m.prototype.pause=function(){this._running=!1},m.prototype.resume=function(){this._running=!0,this._index<this._buffer.length&&this._parse(),this._ended&&this._finish()},m.prototype.end=function(e){this._ended&&this._cbs.onerror(Error(".end() after done!")),e&&this.write(e),this._ended=!0,this._running&&this._finish()},m.prototype._finish=function(){this._sectionStart<this._index&&this._handleTrailingData(),this._cbs.onend()},m.prototype._handleTrailingData=function(){var e=this._buffer.substr(this._sectionStart);27===this._state||28===this._state||29===this._state?this._cbs.oncdata(e):18===this._state||19===this._state||20===this._state?this._cbs.oncomment(e):52!==this._state||this._xmlMode?53!==this._state||this._xmlMode?54!==this._state||this._xmlMode?2!==this._state&&7!==this._state&&10!==this._state&&9!==this._state&&8!==this._state&&12!==this._state&&11!==this._state&&13!==this._state&&5!==this._state&&this._cbs.ontext(e):(this._decodeNumericEntity(3,16),this._sectionStart<this._index&&(this._state=this._baseState,this._handleTrailingData())):(this._decodeNumericEntity(2,10),this._sectionStart<this._index&&(this._state=this._baseState,this._handleTrailingData())):(this._parseLegacyEntity(),this._sectionStart<this._index&&(this._state=this._baseState,this._handleTrailingData()))},m.prototype.reset=function(){m.call(this,{xmlMode:this._xmlMode,decodeEntities:this._decodeEntities},this._cbs)},m.prototype.getAbsoluteIndex=function(){return this._bufferOffset+this._index},m.prototype._getSection=function(){return this._buffer.substring(this._sectionStart,this._index)},m.prototype._emitToken=function(e){this._cbs[e](this._getSection()),this._sectionStart=-1},m.prototype._emitPartial=function(e){this._baseState!==c?this._cbs.onattribdata(e):this._cbs.ontext(e)}},{"entities/lib/decode_codepoint.js":43,"entities/maps/entities.json":46,"entities/maps/legacy.json":47,"entities/maps/xml.json":48}],55:[function(e,t,i){t.exports=a;var o=e("./Parser.js"),s=e("stream").Writable||e("readable-stream").Writable,r=e("string_decoder").StringDecoder,n=e("buffer").Buffer;function a(e,t){var i=this._parser=new o(e,t),n=this._decoder=new r;s.call(this,{decodeStrings:!1}),this.once("finish",function(){i.end(n.end())})}e("inherits")(a,s),s.prototype._write=function(e,t,i){e instanceof n&&(e=this._decoder.write(e)),this._parser.write(e),i()}},{"./Parser.js":51,buffer:4,inherits:57,"readable-stream":2,stream:24,string_decoder:25}],56:[function(e,n,t){var o=e("./Parser.js"),s=e("domhandler");function i(e,t){return delete n.exports[e],n.exports[e]=t}n.exports={Parser:o,Tokenizer:e("./Tokenizer.js"),ElementType:e("domelementtype"),DomHandler:s,get FeedHandler(){return i("FeedHandler",e("./FeedHandler.js"))},get Stream(){return i("Stream",e("./Stream.js"))},get WritableStream(){return i("WritableStream",e("./WritableStream.js"))},get ProxyHandler(){return i("ProxyHandler",e("./ProxyHandler.js"))},get DomUtils(){return i("DomUtils",e("domutils"))},get CollectingHandler(){return i("CollectingHandler",e("./CollectingHandler.js"))},DefaultHandler:s,get RssHandler(){return i("RssHandler",this.FeedHandler)},parseDOM:function(e,t){var i=new s(t);return new o(i,t).end(e),i.dom},parseFeed:function(e,t){var i=new n.exports.FeedHandler(t);return new o(i,t).end(e),i.dom},createDomStream:function(e,t,i){i=new s(e,t,i);return new o(i,t)},EVENTS:{attribute:2,cdatastart:0,cdataend:0,text:1,processinginstruction:2,comment:1,commentend:0,closetag:1,opentag:2,opentagname:1,error:1,end:0}}},{"./CollectingHandler.js":49,"./FeedHandler.js":50,"./Parser.js":51,"./ProxyHandler.js":52,"./Stream.js":53,"./Tokenizer.js":54,"./WritableStream.js":55,domelementtype:30,domhandler:31,domutils:34}],57:[function(e,t,i){arguments[4][8][0].apply(i,arguments)},{dup:8}]},{},[27])}.call(this,i(4),i(276).setImmediate)},1488:function(e,t,i){var n,o,s,r,a,l,c,h,u={}.hasOwnProperty;function p(e){this.options=e,p.__super__.constructor.call(this),this.supermodel=null!=(e=this.options.supermodel)?e:new l,this.session=this.options.session,(this.level=this.options.level)||this.loadLevel(),this.session?(console.log("LevelSetupManager given preloaded session:",this.session.cid),this.fillSessionWithDefaults()):(console.log("LevelSetupManager given no preloaded session."),this.loadSession())}n=i(45),a=i(1497),o=i(1617),s=i(267),r=i(1375),l=i(270),i(1374),c=null!=(i=null!=(i=me.get("earned"))?i.heroes:void 0)?i:[],h=null!=(i=null!=(i=me.get("purchased"))?i.heroes:void 0)?i:[],e.exports=(function(e,t){for(var i in t)u.call(t,i)&&(e[i]=t[i]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(p,n),p.prototype.loadLevel=function(){var e="/db/level/"+this.options.levelID;return this.level=(new s).setURL(e),this.level=this.supermodel.loadModel(this.level).model,this.level.loaded?this.onLevelSync():this.listenToOnce(this.level,"sync",this.onLevelSync)},p.prototype.loadSession=function(){var e="/db/level/"+this.options.levelID+"/session";return this.options.courseID&&(e+="?course="+this.options.courseID,this.options.courseInstanceID&&(e+="&courseInstance="+this.options.courseInstanceID)),this.session=(new r).setURL(e),e=this.session.cid,this.session=this.supermodel.loadModel(this.session).model,e===this.session.cid?console.log("LevelSetupManager made a new Level Session",this.session):console.log("LevelSetupManager used a Level Session from the SuperModel",this.session),this.session.loaded?this.onSessionSync():this.listenToOnce(this.session,"sync",this.onSessionSync)},p.prototype.onLevelSync=function(){if(!this.destroyed)return this.waitingToLoadModals?(this.waitingToLoadModals=!1,this.loadModals()):void 0},p.prototype.onSessionSync=function(){if(!this.destroyed)return this.session.url=function(){return"/db/level.session/"+this.id},this.fillSessionWithDefaults()},p.prototype.fillSessionWithDefaults=function(){var e;return this.options.codeLanguage&&this.session.set("codeLanguage",this.options.codeLanguage),e=_.merge({},me.get("heroConfig"),this.session.get("heroConfig")),this.session.set("heroConfig",e),this.level.loaded?this.loadModals():this.waitingToLoadModals=!0},p.prototype.loadModals=function(){if(this.level.usesConfiguredMultiplayerHero())this.onInventoryModalPlayClicked();else if(this.level.isType("course-ladder","ladder","game-dev","web-dev")||this.level.isType("course")&&(!me.showHeroAndInventoryModalsToStudents()||this.level.isAssessment())||window.serverConfig.picoCTF)this.onInventoryModalPlayClicked();else{if(!this.level.isSummative())return this.heroesModal=new a({supermodel:this.supermodel,session:this.session,confirmButtonI18N:"play.next",level:this.level,hadEverChosenHero:this.options.hadEverChosenHero}),this.inventoryModal=new o({supermodel:this.supermodel,session:this.session,level:this.level}),this.heroesModalDestroy=this.heroesModal.destroy,this.inventoryModalDestroy=this.inventoryModal.destroy,this.heroesModal.destroy=this.inventoryModal.destroy=_.noop,this.listenTo(this.heroesModal,"confirm-click",this.onHeroesModalConfirmClicked),this.listenToOnce(this.heroesModal,"hero-loaded",this.onceHeroLoaded),this.listenTo(this.inventoryModal,"choose-hero-click",this.onChooseHeroClicked),this.listenTo(this.inventoryModal,"play-click",this.onInventoryModalPlayClicked),this.modalsLoaded=!0,this.waitingToOpen?(this.waitingToOpen=!1,this.open()):void 0;this.onInventoryModalPlayClicked()}},p.prototype.open=function(){var e,t,i,n;return this.modalsLoaded?(e=this.options.hadEverChosenHero?this.inventoryModal:this.heroesModal,_.isEqual(c,null!=(t=null!=(t=me.get("earned"))?t.heroes:void 0)?t:[])&&_.isEqual(h,null!=(i=null!=(i=me.get("purchased"))?i.heroes:void 0)?i:[])||me.isAnonymous()&&me.isInHourOfCode()?(i=this.level.get("allowedHeroes"))&&(_.contains(i,null!=(n=me.get("heroConfig"))?n.thangType:void 0)||(e=this.heroesModal)):(console.log("Showing hero picker because heroes earned/purchased has changed."),e=this.heroesModal),c=null!=(n=null!=(n=me.get("earned"))?n.heroes:void 0)?n:[],h=null!=(n=null!=(n=me.get("purchased"))?n.heroes:void 0)?n:[],this.options.parent.openModalView(e),this.trigger("open")):this.waitingToOpen=!0},p.prototype.onceHeroLoaded=function(e){if(window.currentModal===this.inventoryModal)return this.inventoryModal.setHero(e.hero)},p.prototype.onHeroesModalConfirmClicked=function(e){return this.options.parent.openModalView(this.inventoryModal),this.inventoryModal.render(),this.inventoryModal.didReappear(),this.inventoryModal.onShown(),e.hero&&this.inventoryModal.setHero(e.hero),null!=(e=window.tracker)?e.trackEvent("Choose Inventory",{category:"Play Level"}):void 0},p.prototype.onChooseHeroClicked=function(){var e;return this.options.parent.openModalView(this.heroesModal),this.heroesModal.render(),this.heroesModal.didReappear(),this.inventoryModal.endHighlight(),null!=(e=window.tracker)?e.trackEvent("Change Hero",{category:"Play Level"}):void 0},p.prototype.onInventoryModalPlayClicked=function(){var e,t;return this.navigatingToPlay=!0,t="ladder"===this.options.levelPath?"views/ladder/LadderView":"views/play/level/PlayLevelView",e="/play/"+(this.options.levelPath||"level")+"/"+this.options.levelID+"?",this.level.get("primerLanguage")&&(e+="&codeLanguage="+this.level.get("primerLanguage")),null!=this.options.courseID&&null!=this.options.courseInstanceID&&(e+="&course="+this.options.courseID+"&course-instance="+this.options.courseInstanceID),this.supermodel.registerModel(this.session),Backbone.Mediator.publish("router:navigate",{route:e,viewClass:t,viewArgs:[{supermodel:this.supermodel,sessionID:this.session.id},this.options.levelID]})},p.prototype.destroy=function(){var e,t;return null!=(e=this.heroesModal)&&e.destroyed||null!=(t=this.heroesModalDestroy)&&t.call(this.heroesModal),null!=(t=this.inventoryModal)&&t.destroyed||null!=(t=this.inventoryModalDestroy)&&t.call(this.inventoryModal),p.__super__.destroy.call(this)},p)},1494:function(e,t,i){var n=i(1513);e.exports={name:"flat-layout",template:i(1515)(),components:{"page-errors":n},computed:Vuex.mapState({errors:function(e){return e.pageErrors}})}},1495:function(e,t,i){var l,n,o,c,s,r={}.hasOwnProperty,a=[].indexOf||function(e){for(var t=0,i=this.length;t<i;t++)if(t in this&&this[t]===e)return t;return-1};function h(e){h.__super__.constructor.call(this),this.name=(e=null==e?{}:e).name,this.lank=e.lank,this.camera=e.camera,this.layer=e.layer,this.thangType=e.thangType,this.listenTo(this.layer,"new-spritesheet",this.onLayerMadeSpriteSheet),this.name||console.error(this.toString(),"needs a name."),this.camera||console.error(this.toString(),"needs a camera."),this.layer||console.error(this.toString(),"needs a layer."),this.build()}n=i(45),l=i(1407),o=i(1374),s={},c=i(1373),e.exports=(function(e,t){for(var i in t)r.call(t,i)&&(e[i]=t[i]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(h,n),h.prototype.subscriptions={},h.prototype.alpha=1,h.prototype.destroy=function(){var e,t;return this.sprite&&c.Tween.removeTweens(this.sprite),null!=(e=this.sprite)&&null!=(t=e.parent)&&t.removeChild(this.sprite),this.markLank&&(this.layer.removeLank(this.markLank),this.markLank.destroy()),this.lank=null,h.__super__.destroy.call(this)},h.prototype.toString=function(){var e,t;return"<Mark "+this.name+": Sprite "+(null!=(t=null!=(e=this.lank)&&null!=(t=e.thang)?t.id:void 0)?t:"None")+">"},h.prototype.onLayerMadeSpriteSheet=function(){if(this.sprite)return this.markLank||(this.layer.removeChild(this.sprite),this.sprite=null,this.build(),this.layer.addChild(this.sprite),this.layer.updateLayerOrder()),this.update()},h.prototype.toggle=function(e){return(e=!!e)===this.on?this:this.sprite?(this.on=e,delete this.toggleTo,this.on?this.markLank?this.layer.addLank(this.markLank):(this.layer.addChild(this.sprite),this.layer.updateLayerOrder()):(this.markLank?this.layer.removeLank(this.markLank):this.layer.removeChild(this.sprite),this.highlightTween&&(this.highlightDelay=this.highlightTween=null,c.Tween.removeTweens(this.sprite),this.sprite.visible=!0)),this):this.toggleTo=e},h.prototype.setLayer=function(e){var t;if(e!==this.layer)return t=this.on,this.toggle(!1),this.layer=e,t?this.toggle(!0):void 0},h.prototype.setLank=function(e){if(e!==this.lank)return this.lank=e,this.build(),this},h.prototype.build=function(){var e;return this.sprite||("bounds"===this.name?this.buildBounds():"shadow"===this.name?this.buildShadow():"debug"===this.name?this.buildDebug():this.name.match(/.+(Range|Distance|Radius)$/)?this.buildRadius(this.name):this.thangType?this.buildSprite():console.error("Don't know how to build mark for",this.name),null!=(e=this.sprite)&&(e.mouseEnabled=!1)),this},h.prototype.buildBounds=function(){var e,i,t,n,o,s,r,a;if(this.sprite=new c.Container,this.sprite.mouseChildren=!1,s=this.lank.thang.drawsBoundsStyle,this.drawsBoundsIndex=this.lank.thang.drawsBoundsIndex,"corner-text"!==s||0!==this.lank.thang.world.age){if(t="rgba("+(o=function(){var e,t=[];for(i=e=1;e<4;i=++e)t.push(128+Math.floor(128*("0."+Math.sin(3*this.drawsBoundsIndex+i).toString().substr(6))));return t}.call(this))[0]+", "+o[1]+", "+o[2]+", 0.5)",a=(n=[this.lank.thang.width*l.PPM,this.lank.thang.height*l.PPM*this.camera.y2x])[0],e=n[1],"border-text"!==s&&"corner-text"!==s||(this.drawsBoundsBorderShape=o=new c.Shape,o.graphics.setStrokeStyle(5),o.graphics.beginStroke(t),"border-text"===s?o.graphics.beginFill(t.replace("0.5","0.25")):o.graphics.beginFill(t),"ellipsoid"===(n=this.lank.thang.shape)||"disc"===n?o.drawEllipse(0,0,a,e):o.graphics.drawRect(-a/2,-e/2,a,e),o.graphics.endStroke(),o.graphics.endFill(),this.sprite.addChild(o)),"border-text"===s)(r=new c.Text(""+this.drawsBoundsIndex,"20px Arial",t.replace("0.5","1"))).regX=r.getMeasuredWidth()/2,r.regY=r.getMeasuredHeight()/2,r.shadow=new c.Shadow("#000000",1,1,0),this.sprite.addChild(r);else if("corner-text"===s){if(0===this.lank.thang.world.age)return;t="ABCDEFGHIJKLMNOPQRSTUVWXYZ"[this.drawsBoundsIndex%26],(r=new c.Text(t,"14px Arial","#333333")).x=-a/2+2,r.y=-e/2+2,this.sprite.addChild(r)}else console.warn(this.lank.thang.id,"didn't know how to draw bounds style:",s);return 0<a&&0<e&&"border-text"===s&&this.sprite.cache(-a/2,-e/2,a,e,2),this.lastWidth=this.lank.thang.width,this.lastHeight=this.lank.thang.height}},h.prototype.buildShadow=function(){var e,t,i,n,o="ellipsoid"===(s=this.lank.thang.shape)||"disc"===s?"ellipse":"rect",s=o+"-shadow";return a.call(this.layer.spriteSheet.animations,s)<0&&((n=new c.Shape).graphics.beginFill("rgba(0,0,0)"),t=[-5,-5,10,10],"ellipse"==o?(i=n.graphics).drawEllipse.apply(i,t):(e=n.graphics).drawRect.apply(e,t),n.graphics.endFill(),this.layer.addCustomGraphic(s,n,t)),e=null!=(i=null!=(o=this.lank.thang)?o.alpha:void 0)?i:1,o=(null!=(t=null!=(n=this.lank.thang)?n.width:void 0)?t:0)+.5,t=(null!=(n=null!=(i=this.lank.thang)?i.height:void 0)?n:0)+.5,i=Math.max(o,t),o=o*(n=null!=(n=this.lank.thangType.get("shadow"))?n:i)/i,t=t*n/i,o*=l.PPM,t*=l.PPM*this.camera.y2x,this.sprite=new c.Sprite(this.layer.spriteSheet),this.sprite.gotoAndStop(s),this.sprite.mouseEnabled=!1,this.sprite.alpha=e,this.baseScaleX=this.sprite.scaleX=o/(10*this.layer.resolutionFactor),this.baseScaleY=this.sprite.scaleY=t/(10*this.layer.resolutionFactor)},h.prototype.buildRadius=function(e){var t={voiceRange:"rgba(0,145,0,0.15)",visualRange:"rgba(0,0,145,0.15)",attackRange:"rgba(145,0,0,0.15)"},i=["rgba(145,0,145,0.15)","rgba(0,145,145,0.15)","rgba(145,105,0,0.15)","rgba(225,125,0,0.15)"],n=this.lank.ranges.map(function(e,t){return e.name}).indexOf(e);return this.sprite=new c.Shape,i=null!=(t=t[e])?t:i[n],this.sprite.graphics.beginFill(i),this.sprite.graphics.drawCircle(0,0,this.lank.thang[e]*l.PPM),n+1<this.lank.ranges.length&&this.sprite.graphics.arc(0,0,this.lank.ranges[n+1].radius,2*Math.PI,0,!0),this.sprite.graphics.endFill(),i=i.replace("0.15","0.75"),this.sprite.graphics.setStrokeStyle(2),this.sprite.graphics.beginStroke(i),this.sprite.graphics.arc(0,0,this.lank.thang[e]*l.PPM,2*Math.PI,0,!0),this.sprite.graphics.endStroke(),this.sprite.scaleY*=this.camera.y2x},h.prototype.buildDebug=function(){var e,t,i,n="ellipsoid"===(t=this.lank.thang.shape)||"disc"===t?"ellipse":"rect",o=n+"-debug-"+this.lank.thang.collisionCategory;return a.call(this.layer.spriteSheet.animations,o)<0&&(t=new c.Shape,i={none:"rgba(224,255,239,0.25)",ground:"rgba(239,171,205,0.5)",air:"rgba(131,205,255,0.5)",ground_and_air:"rgba(2391,140,239,0.5)",obstacles:"rgba(88,88,88,0.5)",dead:"rgba(89,171,100,0.25)"}[this.lank.thang.collisionCategory]||"rgba(171,205,239,0.5)",t.graphics.beginFill(i),i=[-5,-5,10,10],"ellipse"==n?(e=t.graphics).drawEllipse.apply(e,i):(e=t.graphics).drawRect.apply(e,i),t.graphics.endFill(),this.layer.addCustomGraphic(o,t,i)),this.sprite=new c.Sprite(this.layer.spriteSheet),this.sprite.gotoAndStop(o),i=Math.max(3,this.lank.thang.width*l.PPM)*(this.camera.y2x+(1-this.camera.y2x)*Math.abs(Math.cos(this.lank.thang.rotation))),o=Math.max(3,this.lank.thang.height*l.PPM)*(this.camera.y2x+(1-this.camera.y2x)*Math.abs(Math.sin(this.lank.thang.rotation))),this.sprite.scaleX=i/(10*this.layer.resolutionFactor),this.sprite.scaleY=o/(10*this.layer.resolutionFactor),this.sprite.rotation=180*-this.lank.thang.rotation/Math.PI},h.prototype.buildSprite=function(){var e;if(_.isString(this.thangType)){if(!(e=s[this.thangType]))return this.loadThangType();this.thangType=e}return this.thangType.loaded?((e=new(i(1420))(this.thangType)).queueAction("idle"),this.sprite=e.sprite,this.markLank=e,this.listenTo(this.markLank,"new-sprite",function(e){this.sprite=e})):this.listenToOnce(this.thangType,"sync",this.onLoadedThangType)},h.prototype.loadThangType=function(){var e=this.thangType;return this.thangType=new o,this.thangType.url=function(){return"/db/thang.type/"+e},this.listenToOnce(this.thangType,"sync",this.onLoadedThangType),this.thangType.fetch(),s[e]=this.thangType},h.prototype.onLoadedThangType=function(){return this.build(),this.markLank&&this.update(),null!=this.toggleTo&&this.toggle(this.toggleTo),Backbone.Mediator.publish("sprite:loaded",{sprite:this})},h.prototype.update=function(e){var t;return null==e&&(e=null),!(!this.on||!this.sprite)&&(!(null!=this.lank&&!this.lank.thangType.isFullyLoaded())&&(this.sprite.visible=!this.hidden,this.updatePosition(e),this.updateRotation(),this.updateScale(),"highlight"===this.name&&this.highlightDelay&&!this.highlightTween&&(this.sprite.visible=!1,this.highlightTween=c.Tween.get(this.sprite).to({},this.highlightDelay).call((t=this,function(){if(!t.destroyed)return t.sprite.visible=!0,t.highlightDelay=t.highlightTween=null}))),"shadow"!==(e=this.name)&&"bounds"!==e||this.updateAlpha(this.alpha),!0))},h.prototype.updatePosition=function(e){var t,i;if(null==(t=this.lank)||!t.thang||"shadow"!==(i=this.name)&&"debug"!==i&&"target"!==i&&"selection"!==i&&"repair"!==i?null==e&&(e=null!=(i=this.lank)?i.sprite:void 0):e=this.camera.worldToSurface({x:this.lank.thang.pos.x,y:this.lank.thang.pos.y}),e)return this.sprite.x=e.x,this.sprite.y=e.y,(this.statusEffect||"highlight"===this.name)&&(e=this.lank.getOffset("aboveHead"),this.sprite.x+=e.x,this.sprite.y+=e.y,this.statusEffect)?this.sprite.y-=3:void 0},h.prototype.updateAlpha=function(e){var t;if(this.alpha=e,this.sprite&&"debug"!==this.name)return"shadow"===this.name?(t=this.lank.thang.pos.z-this.lank.thang.depth/2+this.lank.getBobOffset(),this.sprite.alpha=.451*this.alpha/Math.sqrt(t/2+1)):"bounds"===this.name?null!=(t=this.drawsBoundsBorderShape)?t.alpha=Math.floor(this.lank.thang.alpha):void 0:this.sprite.alpha=this.alpha},h.prototype.updateRotation=function(){var e;if("debug"===this.name||"shadow"===this.name&&("rectangle"===(e=null!=(e=this.lank.thang)?e.shape:void 0)||"box"===e))return this.sprite.rotation=180*-this.lank.thang.rotation/Math.PI},h.prototype.updateScale=function(){var e,t,i;if("bounds"!==this.name||this.lank.thang.width===this.lastWidth&&this.lank.thang.height===this.lastHeight&&this.lank.thang.drawsBoundsIndex===this.drawsBoundsIndex||(e=this.sprite,this.buildBounds(),e.parent.addChild(this.sprite),e.parent.swapChildren(e,this.sprite),e.parent.removeChild(e)),null!=this.markLank&&(this.markLank.scaleFactor=1.2,this.markLank.updateScale()),"shadow"===this.name&&(i=this.lank.thang)&&(this.sprite.scaleX=this.baseScaleX*(null!=(t=null!=(t=i.scaleFactor)?t:i.scaleFactorX)?t:1),this.sprite.scaleY=this.baseScaleY*(null!=(t=null!=(t=i.scaleFactor)?t:i.scaleFactorY)?t:1)),"selection"===(i=this.name)||"target"===i||"repair"===i||"highlight"===i)return t=.3,null!=(i=this.lank)&&i.sprite&&(i=(null!=(i=this.lank.sprite.getBounds())?i.width:void 0)||0,t=(i/=this.lank.options.resolutionFactor)/100,t*=1.1,t=Math.max(t,.3)),this.sprite.scaleX*=t,this.sprite.scaleY*=t,"selection"===(t=this.name)||"target"===t||"repair"===t?this.sprite.scaleY*=this.camera.y2x:void 0},h.prototype.stop=function(){var e;return null!=(e=this.markLank)?e.stop():void 0},h.prototype.play=function(){var e;return null!=(e=this.markLank)?e.play():void 0},h.prototype.hide=function(){return this.hidden=!0},h.prototype.show=function(){return this.hidden=!1},h)},1497:function(x,e,S){!function(o,s){var r,t,i,n,e,a,l,c,h,u,p,d,m,f,g,y=function(e,t){return function(){return e.apply(t,arguments)}},v={}.hasOwnProperty,b=[].indexOf||function(e){for(var t=0,i=this.length;t<i;t++)if(t in this&&this[t]===e)return t;return-1},w=[].slice;function k(e){var t;this.animateHeroes=y(this.animateHeroes,this),k.__super__.constructor.call(this,e),this.confirmButtonI18N=null!=(t=(e=null==e?{}:e).confirmButtonI18N)?t:"common.save",this.heroes=new i([],{model:c}),this.heroes.url="/db/thang.type?view=heroes",this.heroes.setProjection(["original","name","slug","soundTriggers","featureImages","gems","heroClass","description","components","extendedName","shortName","unlockLevelName","i18n","poseImage","tier","releasePhase","ozaria"]),this.heroes.comparator="gems",this.listenToOnce(this.heroes,"sync",this.onHeroesLoaded),this.supermodel.loadCollection(this.heroes,"heroes"),this.stages={},this.layers=[],this.session=e.session,this.initCodeLanguageList(e.hadEverChosenHero),this.heroAnimationInterval=setInterval(this.animateHeroes,1e3),this.trackTimeVisible()}S(1609),e=S(80),f=S(1611),u=S(1461),d=S(1462),m=S(1463),i=S(115),c=S(1374),S(1393),r=S(1390),g=S(6),t=S(1437),n=S(118),l=S(622),a=S(1388),S(1431),S(1420),S(52),p=S(1373),h=S(177),x.exports=(function(e,t){for(var i in t)v.call(t,i)&&(e[i]=t[i]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(k,e),k.prototype.className="modal fade play-modal",k.prototype.template=f,k.prototype.id="play-heroes-modal",k.prototype.events={"slide.bs.carousel #hero-carousel":"onHeroChanged","change #option-code-language":"onCodeLanguageChanged","click #close-modal":"hide","click #confirm-button":"saveAndHide","click .unlock-button":"onUnlockButtonClicked","click .subscribe-button":"onSubscribeButtonClicked","click .buy-gems-prompt-button":"onBuyGemsPromptButtonClicked","click .start-subscription-button":"onSubscribeButtonClicked",click:"onClickedSomewhere"},k.prototype.shortcuts={left:function(){if(this.heroes.models.length&&!this.$el.hasClass("secret"))return this.$el.find("#hero-carousel").carousel("prev")},right:function(){if(this.heroes.models.length&&!this.$el.hasClass("secret"))return this.$el.find("#hero-carousel").carousel("next")},enter:function(){if(this.visibleHero&&!this.visibleHero.locked)return this.saveAndHide()}},k.prototype.onHeroesLoaded=function(){var e,t,i,n;for(this.heroes.reset(this.heroes.filter(function(e){return!e.get("ozaria")})),t=0,i=(n=this.heroes.models).length;t<i;t++)e=n[t],this.formatHero(e);if(this.heroes.reset(this.heroes.filter(function(e){return!e.hidden})),(me.freeOnly()||o.getHocCampaign())&&this.heroes.reset(this.heroes.filter(function(e){return!e.locked})),!me.isAdmin())return this.heroes.reset(this.heroes.filter(function(e){return"beta"!==e.get("releasePhase")}))},k.prototype.formatHero=function(e){var t,i,n,o;if(e.name=g.i18n(e.attributes,"extendedName"),null==e.name&&(e.name=g.i18n(e.attributes,"shortName")),null==e.name&&(e.name=g.i18n(e.attributes,"name")),e.description=g.i18n(e.attributes,"description"),e.unlockLevelName=g.i18n(e.attributes,"unlockLevelName"),t=e.get("original"),e.free="captain"===(i=e.attributes.slug)||"knight"===i||"champion"===i||"duelist"===i,e.unlockBySubscribing="samurai"===(i=e.attributes.slug)||"ninja"===i||"librarian"===i,e.premium=!e.free&&!e.unlockBySubscribing,e.locked=!(me.ownsHero(t)||e.unlockBySubscribing&&me.isPremium()),e.purchasable=e.locked&&(me.isPremium()||me.allowStudentHeroPurchase()),this.options.level&&(o=this.options.level.get("allowedHeroes"))&&(e.restricted=(n=e.get("original"),!(0<=b.call(o,n)))),e.class=(e.get("heroClass")||"warrior").toLowerCase(),e.stats=e.getHeroStats(),(o=_.find(g.clanHeroes,{thangTypeOriginal:e.get("original")}))&&(n=o.clanId,b.call(null!=(o=me.get("clans"))?o:[],n)<0&&(e.hidden=!0)),e.get("original")===h.heroes["code-ninja"])return e.hidden="coco.code.ninja"!==window.location.host},k.prototype.currentVisiblePremiumFeature=function(){return this.visibleHero&&!("warrior"===this.visibleHero.class&&0===this.visibleHero.get("tier"))?{viewName:this.id,featureName:"view-hero",premiumThang:{_id:this.visibleHero.id,slug:this.visibleHero.get("slug")}}:null},k.prototype.getRenderData=function(e){var t,i,n;return(e=k.__super__.getRenderData.call(this,e=null==e?{}:e)).heroes=this.heroes.models,e.level=this.options.level,e.codeLanguages=this.codeLanguageList,e.codeLanguage=this.codeLanguage=null!=(n=null!=(i=null!=(t=this.options)&&null!=(i=t.session)?i.get("codeLanguage"):void 0)?i:null!=(n=me.get("aceConfig"))?n.language:void 0)?n:"python",e.confirmButtonI18N=this.confirmButtonI18N,e.visibleHero=this.visibleHero,e.gems=me.gems(),e.isIE=this.isIE(),e},k.prototype.afterInsert=function(){return this.updateViewVisibleTimer(),k.__super__.afterInsert.call(this)},k.prototype.afterRender=function(){var t,i,e,n;if(k.__super__.afterRender.call(this),this.supermodel.finished())return this.playSound("game-menu-open"),this.isIE()&&this.$el.find(".hero-avatar").addClass("ie"),i=this.heroes.models,this.$el.find(".hero-indicator").each(function(){var t=s(this).data("hero-id"),e=_.find(i,function(e){return e.get("original")===t});return s(this).find(".hero-avatar").css("background-image","url("+e.getPortraitURL()+")").addClass("has-tooltip").tooltip()}),this.canvasWidth=313,this.canvasHeight=this.$el.find("canvas").height(),t=null!=(n=null!=(n=null!=(e=this.options)&&null!=(n=e.session)?n.get("heroConfig"):void 0)?n:me.get("heroConfig"))?n:{},n=Math.max(0,_.findIndex(i,function(e){return e.get("original")===t.thangType})),this.$el.find(".hero-item:nth-child("+(n+1)+"), .hero-indicator:nth-child("+(n+1)+")").addClass("active"),this.onHeroChanged({direction:null,relatedTarget:this.$el.find(".hero-item")[n]}),this.$el.find(".hero-stat").addClass("has-tooltip").tooltip(),this.buildCodeLanguages()},k.prototype.rerenderFooter=function(){return this.formatHero(this.visibleHero),this.renderSelectors("#hero-footer"),this.buildCodeLanguages(),this.$el.find("#gems-count-container").toggle(Boolean(this.visibleHero.purchasable))},k.prototype.initCodeLanguageList=function(e){return o.isIPadApp?this.codeLanguageList=[{id:"python",name:"Python ("+s.i18n.t("choose_hero.default")+")"},{id:"javascript",name:"JavaScript"}]:(this.subscriberCodeLanguageList=[{id:"cpp",name:"C++"},{id:"java",name:"Java ("+s.i18n.t("choose_hero.experimental")+")"}],this.codeLanguageList=[{id:"python",name:"Python ("+s.i18n.t("choose_hero.default")+")"},{id:"javascript",name:"JavaScript"},{id:"coffeescript",name:"CoffeeScript ("+s.i18n.t("choose_hero.experimental")+")"},{id:"lua",name:"Lua ("+s.i18n.t("choose_hero.experimental")+")"}].concat(w.call(this.subscriberCodeLanguageList)))},k.prototype.onHeroChanged=function(e){e.direction;var t=s(e.relatedTarget),i=_.find(this.heroes.models,function(e){return e.get("original")===t.data("hero-id")});return i?(e=t.index(),i=this.loadHero(i),this.preloadHero(e+1),this.preloadHero(e-1),i.locked||(this.selectedHero=i),this.visibleHero=i,this.rerenderFooter(),this.trigger("hero-loaded",{hero:i}),this.updateViewVisibleTimer()):console.error("Couldn't find hero from heroItem:",t)},k.prototype.getFullHero=function(e){var t="/db/thang.type/"+e+"/version";return(e=this.supermodel.getModel(t))?e:((e=new c).setURL(t),e=this.supermodel.loadModel(e).model)},k.prototype.preloadHero=function(e){if(e=this.heroes.models[e])return this.loadHero(e,!0)},k.prototype.loadHero=function(e,t){var i;if(null==t&&(t=!1),i=e.get("poseImage"))return s(".hero-item[data-hero-id='"+e.get("original")+"'] canvas").hide(),s(".hero-item[data-hero-id='"+e.get("original")+"'] .hero-pose-image").show().find("img").prop("src","/file/"+i),t||this.playSelectionSound(e),e;throw new Error("Don't have poseImage for "+e.get("original"))},k.prototype.animateHeroes=function(){var e,t,i,n;if(this.visibleHero){var o,s=Math.max(0,_.findIndex(this.heroes.models,(o=this,function(e){return e.get("original")===o.visibleHero.get("original")}))),r=_.sample(["attack","move_side","move_fore"]);return null!=(s=this.stages[s])&&null!=(e=s.children)&&null!=(t=e[0])&&null!=(i=t.children)&&null!=(n=i[0])&&"function"==typeof n.gotoAndPlay?n.gotoAndPlay(r):void 0}},k.prototype.playSelectionSound=function(e){var t,i,n;if(!this.$el.hasClass("secret")&&(null!=(t=this.currentSoundInstance)&&t.stop(),(e=g.i18n(e.attributes,"soundTriggers"))&&(n=e.selected)&&(i=n[Math.floor(Math.random()*n.length)])))return n=r.nameForSoundReference(i),r.preloadSoundReference(i),this.currentSoundInstance=r.playSound(n,1),this.currentSoundInstance},k.prototype.buildCodeLanguages=function(){return this.$el.find("#option-code-language").fancySelect().parent().find(".options li").each(function(){var e=s(this).text(),t=s(this).data("value"),t=s.i18n.t("choose_hero."+t+"_blurb");if(-1===e.indexOf(t))return s(this).text(e+" - "+t)})},k.prototype.onCodeLanguageChanged=function(e){var t;return this.codeLanguage=this.$el.find("#option-code-language").val(),this.codeLanguageChanged=!0,null!=(t=window.tracker)?t.trackEvent("Campaign changed code language",{category:"Campaign Hero Select",codeLanguage:this.codeLanguage,levelSlug:null!=(t=this.options.level)?t.get("slug"):void 0}):void 0},k.prototype.onUnlockButtonClicked=function(e){var t;return e.stopPropagation(),t=s(e.target).closest("button"),this.visibleHero.get("gems")<=me.gems()?t.hasClass("confirm")?(this.playSound("menu-button-unlock-end"),a.makeFor(this.visibleHero).save(),null==(e=null!=(e=me.get("purchased"))?e:{}).heroes&&(e.heroes=[]),e.heroes.push(this.visibleHero.get("original")),me.set("purchased",e),me.set("spent",(null!=(e=me.get("spent"))?e:0)+this.visibleHero.get("gems")),(e=this.$el.find(".hero-item[data-hero-id='"+this.visibleHero.get("original")+"']")).find(".hero-status-value").attr("data-i18n","play.available").i18n(),this.applyRTLIfNeeded(),e.removeClass("locked purchasable"),this.selectedHero=this.visibleHero,this.rerenderFooter(),Backbone.Mediator.publish("store:hero-purchased",{hero:this.visibleHero,heroSlug:this.visibleHero.get("slug")})):(this.playSound("menu-button-unlock-start"),t.addClass("confirm").text(s.i18n.t("play.confirm")),this.$el.one("click",function(e){if(e.target!==t[0])return t.removeClass("confirm").text(s.i18n.t("play.unlock"))})):(this.playSound("menu-button-click"),me.freeOnly()?void 0:this.askToBuyGemsOrSubscribe(t))},k.prototype.askToSignUp=function(){var e=new n({supermodel:this.supermodel});return this.openModalView(e)},k.prototype.askToBuyGemsOrSubscribe=function(e){var t,i;return this.$el.find(".unlock-button").popover("destroy"),t=(me.isStudent()?d:me.canBuyGems()?u:me.hasSubscription()?d:m)({}),e.popover({animation:!0,trigger:"manual",placement:"left",content:" ",container:this.$el,template:t}).popover("show"),null!=(e=e.data("bs.popover"))&&null!=(i=e.$tip)&&i.i18n(),this.applyRTLIfNeeded()},k.prototype.onBuyGemsPromptButtonClicked=function(e){return me.get("anonymous")?this.askToSignUp():this.openModalView(new t)},k.prototype.onClickedSomewhere=function(e){if(!this.destroyed)return this.$el.find(".unlock-button").popover("destroy")},k.prototype.onSubscribeButtonClicked=function(e){var t;return this.openModalView(new l),null!=(t=window.tracker)?t.trackEvent("Show subscription modal",{category:"Subscription",label:"hero subscribe modal: "+(s(e.target).data("heroSlug")||"unknown")}):void 0},k.prototype.saveAndHide=function(){var e,t,i,n;return!me.hasSubscription()&&this.subscriberCodeLanguageList.find((n=this,function(e){return e.id===n.codeLanguage}))?(this.openModalView(new l),void(null!=(t=window.tracker)&&t.trackEvent("Show subscription modal",{category:"Subscription",label:"hero subscribe modal: experimental language"}))):(t=null!=(i=this.selectedHero)?i.get("original"):void 0,(t=null!=(i=this.visibleHero)&&i.loaded&&!this.visibleHero.locked&&null==t?null!=(i=this.visibleHero)?i.get("original"):void 0:t)?(this.session&&(e=this.updateHeroConfig(this.session,t),this.session.get("codeLanguage")!==this.codeLanguage&&(this.session.set("codeLanguage",this.codeLanguage),e=!0),e&&this.session.patch()),e=this.updateHeroConfig(me,t),t=_.clone(me.get("aceConfig"))||{},this.codeLanguage!==t.language&&(t.language=this.codeLanguage,me.set("aceConfig",t),e=!0),e&&me.patch(),this.hide(),"function"==typeof this.trigger?this.trigger("confirm-click",{hero:this.selectedHero}):void 0):(console.error("Somehow we tried to hide without having a hero selected yet..."),void noty({text:"Error: hero not loaded. If this keeps happening, please report the bug.",layout:"topCenter",timeout:1e4,type:"error"})))},k.prototype.updateHeroConfig=function(e,t){var i;return!!t&&((i=_.clone(e.get("heroConfig"))||{}).thangType!==t?(i.thangType=t,e.set("heroConfig",i),!0):void 0)},k.prototype.onHidden=function(){return k.__super__.onHidden.call(this),this.playSound("game-menu-close")},k.prototype.destroy=function(){var e,t,i,n,o,s;for(e in clearInterval(this.heroAnimationInterval),n=this.stages)s=n[e],p.Ticker.removeEventListener("tick",s),s.removeAllChildren();for(t=0,i=(o=this.layers).length;t<i;t++)o[t].destroy();return k.__super__.destroy.call(this)},k)}.call(this,S(17),S(3))},1498:function(e,t,i){var n=i(1620);(n="string"==typeof n?[[e.i,n,""]]:n).locals&&(e.exports=n.locals);(0,i(21).default)("33051e80",n,!0,{})},1499:function(s,e,r){!function(p){var i,e,n,d,t,m,o={}.hasOwnProperty,a=[].indexOf||function(e){for(var t=0,i=this.length;t<i;t++)if(t in this&&this[t]===e)return t;return-1};function f(){f.__super__.constructor.apply(this,arguments),this.propDocs={},this.spellDocs={}}r(1624),e=r(26),t=r(1626),i=r(115),n=r(619),d=r(81).downTheChain,m=r(6),s.exports=(function(e,t){for(var i in t)o.call(t,i)&&(e[i]=t[i]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(f,e),f.prototype.id="item-details-view",f.prototype.template=t,f.prototype.setItem=function(e){var o,s,t,r;return this.item=e,this.item&&(this.spellDocs={},this.item.name=m.i18n(this.item.attributes,"name"),this.item.description=m.i18n(this.item.attributes,"description"),this.item.affordable=me.gems()>=this.item.get("gems"),this.item.owned=me.ownsItem(this.item.get("original")),this.item.comingSoon=!this.item.getFrontFacingStats().props.length&&!_.size(this.item.getFrontFacingStats().stats),this.componentConfigs=function(){for(var e=this.item.get("components"),t=[],i=0,n=e.length;i<n;i++)(o=e[i]).config&&t.push(o.config);return t}.call(this),r=this.item.getFrontFacingStats(),(0<(t=function(){for(var e=r.props,t=[],i=0,n=e.length;i<n;i++)s=e[i],this.propDocs[s]||t.push(s);return t}.call(this)).length||0<=a.call(r.props,"cast"))&&((e=new i([],{url:"/db/level.component?view=prop-doc-lookup",model:n,project:["name","propertyDocumentation.name","propertyDocumentation.description","propertyDocumentation.i18n"]})).fetch({data:{componentOriginals:[function(){for(var e=this.item.get("components"),t=[],i=0,n=e.length;i<n;i++)o=e[i],t.push(o.original);return t}.call(this)].join(","),propertyNames:t.join(",")}}),this.listenToOnce(e,"sync",this.onDocsLoaded))),this.render()},f.prototype.onDocsLoaded=function(e){for(var t,i,n,o,s=e.models,r=0,a=s.length;r<a;r++)for(t=0,i=(o=s[r].get("propertyDocumentation")).length;t<i;t++)n=o[t],/^cast.+/.test(n.name)?this.spellDocs[n.name]=n:this.propDocs[n.name]=n;return this.render()},f.prototype.afterRender=function(){return f.__super__.afterRender.call(this),this.$el.find(".nano:visible").nanoScroller({alwaysVisible:!0})},f.prototype.getRenderData=function(){var e,s,t,i,n,o,r,a,l,c,h,u=f.__super__.getRenderData.call(this);if(u.item=this.item,this.item)for(h=this.item.getFrontFacingStats(),u.stats=_.values(h.stats),u.stats.length&&(_.last(u.stats).isLast=!0),u.props=[],h.props=_.union(h.props,_.keys(this.spellDocs)),e=(null!=(o=me.get("aceConfig"))?o:{}).language||"python",t=0,i=(r=h.props).length;t<i;t++)n=r[t],l=null!=(a=null!=(l=this.propDocs[n])?l:this.spellDocs[n])?a:{},a=m.i18n(l,"description"),_.isObject(a)&&(a=a[e]||_.values(a)[0]),_.isString(a)&&(a=a.replace(/#{spriteName}/g,"hero"),(l=h.stats.shieldDefenseFactor)&&(a=a.replace(/#{shieldDefensePercent}%/g,l.display)),"buildTypes"===n&&(c=_.find(this.componentConfigs,"buildables"),a=a.replace("#{buildTypes}",'`["'+_.keys(c.buildables).join('", "')+'"]`')),s=null!=(c=this.componentConfigs)?c:[],a=(a=a.replace(/#{([^.]+?)}/g,function(e,t){for(var i,n=0,o=s.length;n<o;n++)if(i=s[n],i=d(i,t))return i;return e})).replace(/#{(.+?)}/g,"`$1`"),a=p(marked(a)).html()),u.props.push({name:n,description:a||"..."});return u},f)}.call(this,r(3))},1500:function(e,t,i){i(11);e.exports=function(e){var o,s=[],e=e||{};return function(e,t,i,n){s.push('<div class="modal-dialog"><div class="modal-content">'),s.push('<img id="subscribe-background" src="/images/pages/play/modal/announcement_modal_bg.png"><h1 style="font-size: 2em; top:-10px" data-i18n="announcement.now_available"></h1><h1 data-i18n="announcement.cuddly_companions"></h1><div id="close-modal"><span class="glyphicon glyphicon-remove"></span></div><div id="modal-2222"><svg id="svg1" style="position:absolute;"><defs><clipPath id="clipper"><polygon points="1.7,6 31.7,6 31.7,9.7 67.3,9.7 67.3,6 101,6 105,9.7 108.7,4.3 155.3,4.3 161.3,7 163.7,2.3 288.7,2.3 292.7,9.7 296,2.3 365.3,0 368.7,4.8 371.3,0 465.7,1.7 471,4.8 473,0 536,2 540.7,5 543.3,3 548.7,5.7 551.7,1.3 555.3,1.3 557.7,7.3 563.7,2.3 616,1.7 616.7,6 650.7,6 651.3,0.3 691,2.7 692,400 543.3,400.3 539.7,395.3 537.3,399.3 531.3,398 529,401 526.3,398 478,403.7 468.7,397.7 458.7,403 456.3,400 447.3,404 329,405 329.3,397.7 322,403.7 237.7,402.3 234.3,395.7 230.3,402.3 190,405.3 185.7,400 183.7,404.3 177.7,402 174.7,404.7 67.3,403.7 61.3,398.3 59.3,403.7 54.3,403.3 53.3,406.3 49,401.3 45.7,404.3 0,403.7"></polygon></clipPath></defs></svg><div style="position: relative;" class="paper-area"><div class="img"><img src="/images/pages/play/modal/announcement/pets/bg_baked_shadows.png" class="full-width-image"><img src="/images/pages/play/modal/announcement/pets/fire_elem.png" style="top: 50%; left:45%" data-name="announcement.kindling_name" data-coming-soon="true" data-description="announcement.kindling_description" class="pet-image has-tooltip no-show-pet excitable-hidden"><img src="/images/pages/play/modal/announcement/pets/heroes_and_fire.png" style="top:2%" class="full-width-image"><img src="/images/pages/play/modal/announcement/pets/griffin.png" style="top: 15%; left:5%" data-name="announcement.griffin_name" data-coming-soon="true" data-description="announcement.griffin_description" class="pet-image has-tooltip no-show-pet excitable-hidden"><img src="/images/pages/play/modal/announcement/pets/raven.png" style="top: 10%; left:25%" data-name="announcement.raven_name" data-coming-soon="true" data-description="announcement.raven_description" class="pet-image has-tooltip no-show-pet excitable-hidden"><img src="/images/pages/play/modal/announcement/pets/mimic_no_shadow.png" style="top: 55%; left:2%" data-name="announcement.mimic_name" data-coming-soon="true" data-description="announcement.mimic_description" class="pet-image has-tooltip no-show-pet excitable-hidden"><img src="/images/pages/play/modal/announcement/pets/cougar_no_shadow.png" style="top: 58%; left:7%;clip-path: polygon(45% 0, 100% 0, 100% 100%, 0 100%, 0 43%);" data-name="announcement.cougar_name" data-description="announcement.cougar_description" class="pet-image has-tooltip excitable"><img src="/images/pages/play/modal/announcement/pets/fox_no_shadow.png" style="top: 35%; left:77.5%" data-name="announcement.fox_name" data-coming-soon="true" data-description="announcement.fox_description" class="pet-image has-tooltip no-show-pet excitable-hidden"><img src="/images/pages/play/modal/announcement/pets/pug_no_shadow.png" style="top: 59%; left:69%" data-name="announcement.pugicorn_name" data-coming-soon="true" data-description="announcement.pugicorn_description" class="pet-image has-tooltip no-show-pet excitable-hidden"><img src="/images/pages/play/modal/announcement/pets/wolf_pup_no_shadow_only_wolf.png" style="top: 62%; left:79%" data-name="announcement.wolf_name" data-description="announcement.wolf_description" class="pet-image has-tooltip excitable"><img src="/images/pages/play/modal/announcement/pets/ball_no_shadow_only_ball.png" style="top: 90%; left:75.75%" data-name="announcement.ball_name" data-description="announcement.ball_description" class="pet-image has-tooltip excitable"><img src="/images/pages/play/modal/announcement/pets/grass.png" style="position:absolute;top: 0%; left:0%" class="full-width-image"></div>'),s.push('<div class="nfo"><div><ul style="margin: 2px; padding: 2px; padding-left: 18px"><li data-i18n="announcement.collect_pets"></li><li data-i18n="announcement.each_pet"></li>'),e.isPremium()?e.get("stats")&&7<=e.get("stats").gamesCompleted?s.push("<li>"+(null==(o=n("announcement.play_second_kithmaze").replace("{{the_second_kithmaze}}",'<a href="/play/level/the-second-kithmaze">'+n("announcement.the_second_kithmaze")+"</a>"))?"":o)+"</li>"):s.push('<li data-i18n="announcement.keep_playing"></li>'):s.push("<li>"+(null==(o=n("announcement.upgrade_to_premium").replace("{{subscriber}}",'<a href="/premium">'+n("announcement.subscriber")+"</a>"))?"":o)+"</li>"),s.push("</ul></div></div>"),s.push('</div><div id="item-tooltip" style="position: absolute;display: none;width: 256px;"><div id="pet-name" style="font-size: large; text-align: center">hello world</div><br><div id="coming-soon" style="font-style: italic;text-align:center" data-i18n="announcement.coming_soon"> </div><div id="pet-description" style="text-align: center">description</div></div><div class="sub">'),e.isPremium()?s.push('<button data-i18n="modal.close" class="specific-modal-button btn btn-lg btn-illustrated close-button"></button>'):s.push('<button data-i18n="premium_features.subscribe_now" class="specific-modal-button btn btn-lg btn-illustrated purchase-button"></button>'),s.push("</div></div></div></div>")}.call(this,"me"in e?e.me:"undefined"!=typeof me?me:void 0,"showNfo"in e?e.showNfo:"undefined"!=typeof showNfo?showNfo:void 0,"showSubscribe"in e?e.showSubscribe:"undefined"!=typeof showSubscribe?showSubscribe:void 0,"translate"in e?e.translate:"undefined"!=typeof translate?translate:void 0),s.join("")}},1501:function(e,t,i){i(11);e.exports=function(e){var n=[],e=e||{};return function(e,t,i){n.push('<div class="modal-dialog"><div class="modal-content">'),n.push('<img id="subscribe-background" src="/images/pages/play/modal/announcement_modal_bg.png"><h1 style="font-size: 2em; top:-10px" data-i18n="announcement.now_available"></h1><h1 data-i18n="announcement.ritic"></h1><div id="close-modal"><span class="glyphicon glyphicon-remove"></span></div><div id="modal-2222"><svg id="svg1" style="position:absolute;"><defs><clipPath id="clipper"><polygon points="1.7,6 31.7,6 31.7,9.7 67.3,9.7 67.3,6 101,6 105,9.7 108.7,4.3 155.3,4.3 161.3,7 163.7,2.3 288.7,2.3 292.7,9.7 296,2.3 365.3,0 368.7,4.8 371.3,0 465.7,1.7 471,4.8 473,0 536,2 540.7,5 543.3,3 548.7,5.7 551.7,1.3 555.3,1.3 557.7,7.3 563.7,2.3 616,1.7 616.7,6 650.7,6 651.3,0.3 691,2.7 692,400 543.3,400.3 539.7,395.3 537.3,399.3 531.3,398 529,401 526.3,398 478,403.7 468.7,397.7 458.7,403 456.3,400 447.3,404 329,405 329.3,397.7 322,403.7 237.7,402.3 234.3,395.7 230.3,402.3 190,405.3 185.7,400 183.7,404.3 177.7,402 174.7,404.7 67.3,403.7 61.3,398.3 59.3,403.7 54.3,403.3 53.3,406.3 49,401.3 45.7,404.3 0,403.7"></polygon></clipPath></defs></svg><div style="position: relative;" class="paper-area"><div class="img"><div id="ice-chamber" style="border-radius: 8px; border:1px solid black;box-sizing:border-box; box-shadow: inset 0 0 32px #000000; overflow:hidden; background-position: 50%; background-size:cover;background-image:url(\'/images/pages/play/modal/announcement/ritic/ice-background.jpg\');height:94%;width:307px;position:absolute;left:1.2%;top:3%"><div id="shattered-block" style="width: 307px;height:307px;position:absolute;bottom:0;left:0" class="ice-block has-tooltip"><img style="width: 100%;height:100%;" src="/images/pages/play/modal/announcement/ritic/cracked_block.png" class="twitching"></div><div id="chipped-block" style="width: 307px;height:307px;position:absolute;bottom:0;left:0" class="ice-block has-tooltip"><img style="width: 100%;height:100%;" src="/images/pages/play/modal/announcement/ritic/undercracked_block.png" class="twitching"></div><div id="clear-block" style="width: 307px;height:307px;position:absolute;bottom:0;left:0" class="ice-block has-tooltip"><img style="width: 100%; height:100%;" src="/images/pages/play/modal/announcement/ritic/clear_block.png" class="twitching"></div><div style="position: absolute; top: 50%; left: 0; width: 100%; height: 12.5%; background-size: 100%;background-image:url(\'/images/pages/play/modal/announcement/ritic/ray.png\')" class="highlight"></div><div style="position: absolute; top: 50%; left: 0; width: 100%; height: 12.5%; background-size: 100%;background-image:url(\'/images/pages/play/modal/announcement/ritic/ray.png\')" class="highlight"></div><div style="position: absolute; top: 50%; left: 0; width: 100%; height: 12.5%; background-size: 100%;background-image:url(\'/images/pages/play/modal/announcement/ritic/ray.png\')" class="highlight"></div><div style="position: absolute; top: 50%; left: 0; width: 100%; height: 12.5%; background-size: 100%;background-image:url(\'/images/pages/play/modal/announcement/ritic/ray.png\')" class="highlight"></div><div style="position: absolute; top: 50%; left: 0; width: 100%; height: 12.5%; background-size: 100%;background-image:url(\'/images/pages/play/modal/announcement/ritic/ray.png\')" class="highlight"></div><div id="ritic-image" style="bottom: 10%; left: 25%; width: 153px;height:calc(153px * 1.45);position:absolute;" data-name="announcement.ice_block" data-description="announcement.ice_description" class="ritic-block ritic-block-1 has-tooltip"><img style="width: 100%; height:100%;" src="/images/pages/play/modal/announcement/ritic/assassin-pose.png"></div></div><div id="info-container" style="height:100%;width:calc(100% - 307px);position:absolute;right:0;top:0; "><div id="ability-bar" style="z-index: 1; filter:drop-shadow(4px 4px 4px rgba(0, 0, 0, 0.75)); margin:8px; background-repeat: no-repeat; background-position: 50%; width: calc(100% - 16px); height: 125px; background-size: contain; background-image:url(\'/images/pages/play/modal/announcement/ritic/ability_bar.png\'); position:absolute; top: 0%; left:0%"><div id="blink-icon" data-gif="blink" data-name="announcement.blink_name" data-description="announcement.blink_description" class="ability-icon has-tooltip"><img style="width: 62px; left: 9.75%; top:21.75%;" src="/images/pages/play/modal/announcement/ritic/blink.png"></div><div id="darkness-icon" data-gif="darkness" data-name="announcement.wallOfDarkness_name" data-description="announcement.wallOfDarkness_description" class="ability-icon has-tooltip"><img style="width: 62px; left: 30%; top:21.75%" src="/images/pages/play/modal/announcement/ritic/darkness.png"></div><div id="tornado-icon" data-gif="tornado" data-name="announcement.tornado_name" data-description="announcement.tornado_description" class="ability-icon has-tooltip"><img style="width: 62px; left: 51.75%; top:21.75%" src="/images/pages/play/modal/announcement/ritic/tornado.png"></div><div id="shadowwalk-icon" data-gif="shadowwalk" data-name="announcement.shadowStep_name" data-description="announcement.shadowStep_description" class="ability-icon has-tooltip"><img style="width: 62px; left: 74%; top:21.75%" src="/images/pages/play/modal/announcement/ritic/shadowwalk.png"></div></div><div id="video-bar" style="overflow: hidden; border-radius: 8px; border:1px solid black;box-sizing:border-box; box-shadow: inset 0 0 32px #000000; margin-top:-20px; position:absolute; top: 125px; left:calc(50% - (293px / 2)); width: 293px;height: 293px;"><img id="tornado-gif" style="z-index: -1; width: 100%;" src="/images/pages/play/modal/announcement/ritic/tornado.gif" class="gif-video"><img id="shadowwalk-gif" style="display: none; z-index: -1; width: 100%;" src="/images/pages/play/modal/announcement/ritic/shadowwalk.gif" class="gif-video"><img id="blink-gif" style="display: none; z-index: -1; width: 100%;" src="/images/pages/play/modal/announcement/ritic/blink.gif" class="gif-video"><img id="darkness-gif" style="display: none; z-index: -1; width: 100%;" src="/images/pages/play/modal/announcement/ritic/darkness.gif" class="gif-video"></div></div></div>'),n.push('</div><div id="item-tooltip" style="position: absolute;display: none;width: 256px;"><div id="pet-name" style="font-size: large; text-align: center">hello world</div><br><div id="coming-soon" style="font-style: italic;text-align:center" data-i18n="announcement.coming_soon"> </div><div id="pet-description" style="text-align: center">description</div></div><div class="sub">'),e.isPremium()?n.push('<button data-i18n="modal.close" class="specific-modal-button btn btn-lg btn-illustrated close-button"></button>'):n.push('<button data-i18n="premium_features.subscribe_now" class="specific-modal-button btn btn-lg btn-illustrated purchase-button"></button>'),n.push("</div></div></div></div>")}.call(this,"me"in e?e.me:"undefined"!=typeof me?me:void 0,"showNfo"in e?e.showNfo:"undefined"!=typeof showNfo?showNfo:void 0,"showSubscribe"in e?e.showSubscribe:"undefined"!=typeof showSubscribe?showSubscribe:void 0),n.join("")}},1502:function(e,t,i){i(11);e.exports=function(e){var t,i=[],e=e||{};return function(e){i.push('<div class="modal-dialog"><div id="modal-base-flat" class="modal-content style-flat"><div class="modal-header">'),e.closeButton&&i.push('<div type="button" data-dismiss="modal" aria-hidden="true" class="button close">&times;</div>'),e.options.headerContent?i.push("<h3>"+(null==(t=e.options.headerContent)?"":t)+"</h3>"):i.push("<h3>man bites God</h3>"),i.push('</div><div class="modal-body">'),e.options.bodyContent?i.push("<div>"+(null==(t=e.options.bodyContent)?"":t)+"</div>"):i.push("<p>Man Bites God are the bad boys of the Melbourne live music and comedy scene. It is like being drowned in a bathtub of harmony.</p>"),i.push('</div><div class="modal-body wait secret"><h3>Reticulating Splines...</h3><div class="progress progress-striped active"><div class="progress-bar"></div></div></div><div class="modal-footer"><button type="button" data-dismiss="modal" aria-hidden="true" data-i18n="modal.okay" class="btn btn-primary">Okay</button></div></div></div>')}.call(this,"view"in e?e.view:"undefined"!=typeof view?view:void 0),i.join("")}},1513:function(e,t,i){e.exports={name:"page-errors",template:i(1514)(),computed:_.assign(Vuex.mapState({error:function(e){return _.first(e.pageErrors)}}),Vuex.mapGetters("me",["isAnonymous","forumLink"]))}},1514:function(e,t,i){var n=i(11);e.exports=function(e){var t=[],e=e||{};return function(e){t.push('<div id="loading-error" class="text-center"><div v-if="error.stack"><h1>{{ $t("loading_error.unknown") }}</h1></div><div v-else-if="error.code === 401"><h1><span class="spr">401:</span><span>{{ $t("loading_error.login_required") }}</span></h1><p>{{ $t("loading_error.login_required_desc") }}</p><button class="login-btn btn btn-primary">{{ $t("login.log_in") }}</button><button id="create-account-btn" class="btn btn-primary">{{ $t("login.sign_up") }}</button></div>\x3c!-- 402 currently not in use. TODO: Set it up--\x3e<div v-else-if="error.code === 402"><h2>402: Payment Required</h2></div><div v-else-if="error.code === 403"><h1><span class="spr">403:</span><span>{{ $t("loading_error.forbidden") }}</span></h1><p>{{ $t("loading_error.forbidden_desc") }}</p>\x3c!-- this should make no diff... but sometimes the server returns 403 when it should return 401--\x3e<button id="logout-btn" v-if="isAnonymous" class="btn btn-primary">{{ $t("login.log_out") }}</button></div><div v-else-if="error.code === 404"><h1><span class="spr">404:</span><span>{{ $t(\'loading_error.not_found\') }}</span></h1>');e=e.floor(3*e.random())+1;t.push('<img id="not-found-img"'+n.attr("src","/images/pages/not_found/404_"+e+".png",!0,!0)+'><p>{{ $t("loading_error.not_found_desc") }}</p></div><div v-else-if="!error.code"><h1>{{ $t("loading_error.connection_failure") }}</h1><p>{{ $t("loading_error.connection_failure_desc") }}</p></div><div v-else-if="error.code === 408"><h1><span class="spr">408:</span><span>{{ $t("loading_error.timeout") }}</span></h1></div><div v-else-if="error.code &gt;= 500 &amp;&amp; error.code &lt;= 599"><h1><span class="spr">{{error.code}}</span><span>{{ $t("loading_error.server_error") }}</span></h1></div><div v-else><h1>{{ $t("loading_error.unknown") }}</h1><p>{{ $t("loading_error.general_desc") }}</p></div><div id="links-row" class="row"><div class="col-sm-3"><ul class="list-unstyled"><li><strong>{{ $t("common.help") }}</strong></li><li><a href="/">{{ $t("nav.home") }}</a></li><li><a v-bind:href="forumLink">{{ $t("nav.forum") }}</a></li><li><a href="/community">{{ $t("nav.community") }}</a></li></ul></div><div class="col-sm-3"><ul class="list-unstyled"><li><strong>{{ $t("courses.students") }}</strong></li><li><a href="/students">{{ $t("nav.learn_to_code") }}</a></li><li v-if="isAnonymous"><a class="login-btn">{{ $t("login.log_in") }}</a></li><li><a href="/students">{{ $t("courses.join_class") }}</a></li></ul></div><div class="col-sm-3"><ul class="list-unstyled"><li v-if="isAnonymous"><a class="login-btn">{{ $t("login.log_in") }}</a></li><li><a href="/teachers/classes">{{ $t("nav.create_a_class") }}</a></li></ul></div><div class="col-sm-3"><ul class="list-unstyled"><li><strong>{{ $t("nav.other") }}</strong></li><li><a href="http://blog.codecombat.com/">{{ $t("nav.blog") }}</a></li><li><a href="https://www.facebook.com/codecombat">{{ $t("nav.facebook") }}</a></li><li><a href="https://twitter.com/codecombat">{{ $t("nav.twitter") }}</a></li></ul></div></div></div>')}.call(this,"Math"in e?e.Math:"undefined"!=typeof Math?Math:void 0),t.join("")}},1515:function(e,t,i){i(11);e.exports=function(e){var t=[];return t.push('<div><page-errors v-if="errors.length"></page-errors><slot v-else></slot></div>'),t.join("")}},1516:function(e,t,i){!function n(o,s,r){function a(i,e){if(!s[i]){if(!o[i]){if(0,l)return l(i,!0);var t=new Error("Cannot find module '"+i+"'");throw t.code="MODULE_NOT_FOUND",t}t=s[i]={exports:{}};o[i][0].call(t.exports,function(e){var t=o[i][1][e];return a(t||e)},t,t.exports,n,o,s,r)}return s[i].exports}for(var l=!1,e=0;e<r.length;e++)a(r[e]);return a}({1:[function(e,t,i){window.deku=e("deku")},{deku:12}],2:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n="undefined"==typeof Uint32Array?Array:Uint32Array;i.createBv=function(e){return new n(Math.ceil(e/32))},i.setBit=function(e,t){var i=t%32;e[(t-i)/32]|=1<<i},i.clearBit=function(e,t){var i=t%32;e[(t-i)/32]&=~(1<<i)},i.getBit=function(e,t){var i=t%32;return!!(e[(t-i)/32]&1<<i)}},{}],3:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.create=function(s,r){var e=arguments.length<=2||void 0===arguments[2]?{}:arguments[2],a=null,l=null,c=e.id||"0";s&&0<s.childNodes.length&&(s.innerHTML="");return function(e){var t,i,n,o=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];return a=null!==l?(t=e,i=o,n=(0,u.diffNode)(a,t,c),l=n.reduce(h.update(r,i),l),t):(e=e,o=o,l=h.create(e,c,r,o),s&&s.appendChild(l),e),l}};var h=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}}(e("../dom")),u=e("../diff")},{"../diff":4,"../dom":7}],4:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.Actions=void 0,i.diffAttributes=c,i.diffChildren=h,i.diffNode=v;var n,g=e("../element"),o=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}}(e("dift")),s=e("union-type"),r=(n=s)&&n.__esModule?n:{default:n};function a(){return!0}var e=function(){return String},y=i.Actions=(0,r.default)({setAttribute:[String,a,a],removeAttribute:[String,a],insertChild:[a,Number,e],removeChild:[Number],updateChild:[Number,Array],updateChildren:[Array],insertBefore:[Number],replaceNode:[a,a,e],removeNode:[a],sameNode:[],updateThunk:[a,a,e]});function c(e,t){var i,n=y.setAttribute,o=y.removeAttribute,s=[],r=e.attributes,a=t.attributes;for(i in a)a[i]!==r[i]&&s.push(n(i,a[i],r[i]));for(i in r)i in a||s.push(o(i,r[i]));return s}function h(e,t,r){var a=y.insertChild,l=y.updateChild,c=y.removeChild,h=y.insertBefore,i=y.updateChildren,u=o.CREATE,p=o.UPDATE,d=o.MOVE,m=o.REMOVE,e=(0,g.groupByKey)(e.children),t=(0,g.groupByKey)(t.children),f=[];return(0,o.default)(e,t,function(e,t,i,n){var o,s=i?(0,g.createPath)(r,null==i.key?i.index:i.key):null;switch(e){case u:f.push(a(i.item,n,s));break;case p:0<(o=v(t.item,i.item,s)).length&&f.push(l(t.index,o));break;case d:(o=v(t.item,i.item,s)).push(h(n)),f.push(l(t.index,o));break;case m:f.push(c(t.index))}},function(e){return e.key}),i(f)}function v(e,t,i){var n=[],o=y.replaceNode,s=y.setAttribute,r=y.sameNode,a=y.removeNode,l=y.updateThunk;if(null==e)throw new Error("Left node must not be null or undefined");return e===t?n.push(r()):null!=e&&null==t?n.push(a(e)):e.type!==t.type?n.push(o(e,t,i)):(0,g.isText)(t)?e.nodeValue!==t.nodeValue&&n.push(s("nodeValue",t.nodeValue,e.nodeValue)):(0,g.isThunk)(t)?(0,g.isSameThunk)(e,t)?n.push(l(e,t,i)):n.push(o(e,t,i)):(0,g.isEmpty)(t)||(n=c(e,t)).push(h(e,t,i)),n}},{"../element":11,dift:15,"union-type":26}],5:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.default=function i(e,n,o,s){if((0,u.isText)(e)){var t="string"==typeof e.nodeValue||"number"==typeof e.nodeValue?e.nodeValue:"";return document.createTextNode(t)}if((0,u.isEmpty)(e))return document.createElement("noscript");if((0,u.isThunk)(e)){var r=e.props,a=e.component,l=e.children,t=a.onCreate,a="function"==typeof a?a:a.render,l={children:l,props:r,path:n,dispatch:o,context:s},r=a(l),a=i(r,(0,u.createPath)(n,r.key||"0"),o,s);return t&&t(l),e.state={vnode:r,model:l},a}a=m[e.type];void 0===a&&(a=m[e.type]=d.default.isElement(e.type)?document.createElementNS(d.default.namespace,e.type):document.createElement(e.type));var c=a.cloneNode(!1);for(var h in e.attributes)(0,p.setAttribute)(c,h,e.attributes[h]);e.children.forEach(function(e,t){null!=e&&(t=i(e,(0,u.createPath)(n,e.key||t),o,s),c.appendChild(t))});return c};var n,u=e("../element"),p=e("./setAttribute"),o=e("./svg"),d=(n=o)&&n.__esModule?n:{default:n};var m={}},{"../element":11,"./setAttribute":8,"./svg":9}],6:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.default={onAbort:"abort",onAnimationStart:"animationstart",onAnimationIteration:"animationiteration",onAnimationEnd:"animationend",onBlur:"blur",onCanPlay:"canplay",onCanPlayThrough:"canplaythrough",onChange:"change",onClick:"click",onContextMenu:"contextmenu",onCopy:"copy",onCut:"cut",onDoubleClick:"dblclick",onDrag:"drag",onDragEnd:"dragend",onDragEnter:"dragenter",onDragExit:"dragexit",onDragLeave:"dragleave",onDragOver:"dragover",onDragStart:"dragstart",onDrop:"drop",onDurationChange:"durationchange",onEmptied:"emptied",onEncrypted:"encrypted",onEnded:"ended",onError:"error",onFocus:"focus",onInput:"input",onInvalid:"invalid",onKeyDown:"keydown",onKeyPress:"keypress",onKeyUp:"keyup",onLoad:"load",onLoadedData:"loadeddata",onLoadedMetadata:"loadedmetadata",onLoadStart:"loadstart",onPause:"pause",onPlay:"play",onPlaying:"playing",onProgress:"progress",onMouseDown:"mousedown",onMouseEnter:"mouseenter",onMouseLeave:"mouseleave",onMouseMove:"mousemove",onMouseOut:"mouseout",onMouseOver:"mouseover",onMouseUp:"mouseup",onPaste:"paste",onRateChange:"ratechange",onReset:"reset",onScroll:"scroll",onSeeked:"seeked",onSeeking:"seeking",onSubmit:"submit",onStalled:"stalled",onSuspend:"suspend",onTimeUpdate:"timeupdate",onTransitionEnd:"transitionend",onTouchCancel:"touchcancel",onTouchEnd:"touchend",onTouchMove:"touchmove",onTouchStart:"touchstart",onVolumeChange:"volumechange",onWaiting:"waiting",onWheel:"wheel"}},{}],7:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.update=i.create=void 0;var n=o(e("./create")),e=o(e("./update"));function o(e){return e&&e.__esModule?e:{default:e}}i.create=n.default,i.update=e.default},{"./create":5,"./update":10}],8:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.removeAttribute=u,i.setAttribute=function(e,t,i,n){var o,s=h.default[t];if(i!==n)if(s)"function"==typeof n&&e.removeEventListener(s,n),e.addEventListener(s,i);else if((0,a.isValidAttribute)(i))switch(t){case"checked":case"disabled":case"innerHTML":case"nodeValue":e[t]=i;break;case"selected":e.selected=i,"OPTION"===e.tagName&&e.parentNode&&((o=e.parentNode).selectedIndex=(0,l.default)(o.options,e));break;case"value":(0,c.default)(e,i);break;default:e.setAttributeNS((0,r.default)(t),t,i)}else u(e,t,n)};var r=n(e("svg-attribute-namespace")),a=e("../element"),l=n(e("index-of")),c=n(e("setify")),h=n(e("./events"));function n(e){return e&&e.__esModule?e:{default:e}}function u(e,t,i){var n=h.default[t];if(n)"function"==typeof i&&e.removeEventListener(n,i);else switch(t){case"checked":case"disabled":case"selected":e[t]=!1;break;case"innerHTML":case"nodeValue":e.innerHTML="";break;case"value":e.value="";break;default:e.removeAttribute(t)}}},{"../element":11,"./events":6,"index-of":16,setify:24,"svg-attribute-namespace":25}],9:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});e=e("is-svg-element");i.default={isElement:e.isElement,namespace:"http://www.w3.org/2000/svg"}},{"is-svg-element":17}],10:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.insertAtIndex=void 0,i.default=function l(c,h){return function(a,e){return p.Actions.case({setAttribute:function(e,t,i){(0,o.setAttribute)(a,e,t,i)},removeAttribute:function(e,t){(0,o.removeAttribute)(a,e,t)},insertBefore:function(e){m(a.parentNode,e,a)},sameNode:function(){},updateChildren:function(e){var n=Array.prototype.slice.apply(a.childNodes);e.forEach(function(e){p.Actions.case({insertChild:function(e,t,i){m(a,t,(0,r.default)(e,i,c,h))},removeChild:function(e){a.removeChild(n[e])},updateChild:function(t,e){var i=l(c,h);e.forEach(function(e){return i(n[t],e)})}},e)})},updateThunk:function(e,t,i){var n=t.props,o=t.children,s=t.component,r=s.onUpdate,s="function"==typeof s?s:s.render,e=e.state.vnode,n={children:o,props:n,path:i,dispatch:c,context:h},s=s(n),i=(0,p.diffNode)(e,s,(0,u.createPath)(i,"0"));a=i.reduce(l(c,h),a),r&&r(n),t.state={vnode:s,model:n}},replaceNode:function(e,t,i){t=(0,r.default)(t,i,c,h),i=a.parentNode;i&&i.replaceChild(t,a),a=t,d(e)},removeNode:function(e){d(e),a.parentNode.removeChild(a),a=null}},e),a}};var n,o=e("./setAttribute"),u=e("../element"),s=e("./create"),r=(n=s)&&n.__esModule?n:{default:n},p=e("../diff");function d(e){for(;(0,u.isThunk)(e);){var t=e,i=t.component,n=t.state,t=i.onRemove,i=n.model;t&&t(i),e=n.vnode}if(e.children)for(var o=0;o<e.children.length;o++)d(e.children[o])}var m=i.insertAtIndex=function(e,t,i){t=e.childNodes[t];t?e.insertBefore(i,t):e.appendChild(i)}},{"../diff":4,"../element":11,"./create":5,"./setAttribute":8}],11:[function(e,t,i){"use strict";function n(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return Array.from(e)}function r(e,t){if("string"==typeof t||"number"==typeof t)e.push(o(t));else if(null===t)e.push(s());else if(Array.isArray(t))e=[].concat(n(e),n(t.reduce(r,[])));else{if(void 0===t)throw new Error("vnode can't be undefined. Did you mean to use null?");e.push(t)}return e}function o(e){return{type:"#text",nodeValue:e}}function s(){return{type:"#empty"}}function a(e,t,i,n){return{type:"#thunk",children:n,props:i,component:e,key:t}}Object.defineProperty(i,"__esModule",{value:!0}),i.create=function(e,t){for(var i=arguments.length,n=Array(2<i?i-2:0),o=2;o<i;o++)n[o-2]=arguments[o];if(!e)throw new TypeError("element() needs a type.");t=t||{},n=(n||[]).reduce(r,[]);var s="string"==typeof t.key||"number"==typeof t.key?t.key:void 0;return delete t.key,"object"!==(void 0===e?"undefined":function(e){return e&&"undefined"!=typeof Symbol&&e.constructor===Symbol?"symbol":typeof e}(e))&&"function"!=typeof e?{attributes:t,children:n,type:e,key:s}:a(e,s,t,n)},i.createTextElement=o,i.createEmptyElement=s,i.createThunkElement=a,i.isValidAttribute=function(e){return"boolean"==typeof e?e:"function"!=typeof e&&(""===e||void 0!==e&&null!==e)};var l=i.isThunk=function(e){return"#thunk"===e.type};i.isText=function(e){return"#text"===e.type},i.isEmpty=function(e){return"#empty"===e.type},i.isSameThunk=function(e,t){return l(e)&&l(t)&&e.component===t.component},i.groupByKey=function(e){return e.reduce(function(e,t,i){return null!=t&&!1!==t&&e.push({key:String(t.key||i),item:t,index:i}),e},[])};i.createPath=function(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];return t.join(".")}},{}],12:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.h=i.dom=i.diff=i.vnode=i.string=i.element=i.createApp=void 0;var n=l(e("./diff")),o=l(e("./element")),s=l(e("./string")),r=l(e("./dom")),a=l(e("./app"));function l(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}var c=o.create,e=o.create,a=a.create;i.createApp=a,i.element=c,i.string=s,i.vnode=o,i.diff=n,i.dom=r,i.h=e},{"./app":3,"./diff":4,"./dom":7,"./element":11,"./string":13}],13:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.render=void 0;e=e("./renderString").renderString;i.render=e},{"./renderString":14}],14:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.renderString=function i(e,n){var o=arguments.length<=2||void 0===arguments[2]?"0":arguments[2];if((0,a.isText)(e))return e.nodeValue;if((0,a.isEmpty)(e))return"<noscript></noscript>";if((0,a.isThunk)(e)){var t=e.props,s=e.component,r=e.children,s=(0,s.render)({children:r,props:t,path:o,context:n});return i(s,n,o)}var r=e.attributes;t=e.type;s=e.children;e=r.innerHTML;r="<"+t+l(r)+">";r+=e||s.map(function(e,t){return i(e,n,o+"."+(null==e.key?t:e.key))}).join("");r+="</"+t+">";return r};var a=e("../element");function l(e){var t,i="";for(t in e){var n=e[t];"innerHTML"!==t&&(0,a.isValidAttribute)(n)&&(i+=" "+t+'="'+e[t]+'"')}return i}},{"../element":11}],15:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.REMOVE=i.MOVE=i.UPDATE=i.CREATE=void 0;var x=e("bit-vector");i.default=function(e,t,i,n){for(var o=0,s=0,r=e.length-1,a=t.length-1,l=e[o],c=t[s];o<=r&&s<=a&&k(l,c);)i(1,l,c,s),l=e[++o],c=t[++s];if(!(a<s&&r<o)){for(var h=e[r],u=t[a],p=0;o<=r&&s<=a&&k(l,u);)i(2,l,u,r-p+1),l=e[++o],u=t[--a],++p;for(;o<=r&&s<=a&&k(c,h);)i(2,h,c,s),h=e[--r],c=t[++s],--p;for(;o<=r&&s<=a&&k(h,u);)i(1,h,u,a),h=e[--r],u=t[--a];if(r<o)for(;s<=a;)i(0,null,c,s),c=t[++s];else if(a<s)for(;o<=r;)i(3,l),l=e[++o];else{for(var d=0,m=null,f=o-p,g=o,y=(0,x.createBv)(r-o),v=function(e,t,i,n){for(var o={},s=t;s<i;++s)o[n(e[s])]=s;return o}(e,o,r+1,n);s<=a;c=t[++s]){var b=v[n(c)];void 0===b?(i(0,null,c,f++),++d):o!==b?((0,x.setBit)(y,b-g),i(2,e[b],c,f++)):m=s}null!==m&&((0,x.setBit)(y,0),i(2,e[o],t[m],m));for(var _=e.length-t.length+d,w=0;w<_;l=e[++o])(0,x.getBit)(y,o-g)||(i(3,l),++w)}}function k(e,t){return n(e)===n(t)}},i.CREATE=0,i.UPDATE=1,i.MOVE=2,i.REMOVE=3},{"bit-vector":2}],16:[function(e,t,i){
/*!
 * index-of <https://github.com/jonschlinkert/index-of>
 *
 * Copyright (c) 2014-2015 Jon Schlinkert.
 * Licensed under the MIT license.
 */
"use strict";t.exports=function(e,t,i){if(null==e)return-1;var n=e.length,o=(i=i||0)<0?n+i:i;if(o>=e.length)return-1;for(;o<n;){if(e[o]===t)return o;o++}return-1}},{}],17:[function(e,t,i){i.elements={animate:!0,circle:!0,defs:!0,ellipse:!0,g:!0,line:!0,linearGradient:!0,mask:!0,path:!0,pattern:!0,polygon:!0,polyline:!0,radialGradient:!0,rect:!0,stop:!0,svg:!0,text:!0,tspan:!0},i.isElement=function(e){return e in i.elements}},{}],18:[function(e,t,i){var n=["text","search","tel","url","password"];t.exports=function(e){return!(!e.setSelectionRange||!~n.indexOf(e.type))}},{}],19:[function(e,t,i){e=e("./internal/_curry2");t.exports=e(function(e,h){switch(e){case 0:return function(){return h.apply(this,arguments)};case 1:return function(e){return h.apply(this,arguments)};case 2:return function(e,t){return h.apply(this,arguments)};case 3:return function(e,t,i){return h.apply(this,arguments)};case 4:return function(e,t,i,n){return h.apply(this,arguments)};case 5:return function(e,t,i,n,o){return h.apply(this,arguments)};case 6:return function(e,t,i,n,o,s){return h.apply(this,arguments)};case 7:return function(e,t,i,n,o,s,r){return h.apply(this,arguments)};case 8:return function(e,t,i,n,o,s,r,a){return h.apply(this,arguments)};case 9:return function(e,t,i,n,o,s,r,a,l){return h.apply(this,arguments)};case 10:return function(e,t,i,n,o,s,r,a,l,c){return h.apply(this,arguments)};default:throw new Error("First argument to arity must be a non-negative integer no greater than ten")}})},{"./internal/_curry2":22}],20:[function(e,t,i){var n=e("./internal/_curry2"),o=e("./internal/_curryN"),s=e("./arity");t.exports=n(function(e,t){return s(e,o(e,[],t))})},{"./arity":19,"./internal/_curry2":22,"./internal/_curryN":23}],21:[function(e,t,i){t.exports=function(i){return function e(t){return 0===arguments.length||null!=t&&!0===t["@@functional/placeholder"]?e:i(t)}}},{}],22:[function(e,t,i){var s=e("./_curry1");t.exports=function(o){return function e(t,i){var n=arguments.length;return 0===n||1===n&&null!=t&&!0===t["@@functional/placeholder"]?e:1===n?s(function(e){return o(t,e)}):2===n&&null!=t&&!0===t["@@functional/placeholder"]&&null!=i&&!0===i["@@functional/placeholder"]?e:2===n&&null!=t&&!0===t["@@functional/placeholder"]?s(function(e){return o(e,i)}):2===n&&null!=i&&!0===i["@@functional/placeholder"]?s(function(e){return o(t,e)}):o(t,i)}}},{"./_curry1":21}],23:[function(e,t,i){var c=e("../arity");t.exports=function s(r,a,l){return function(){for(var e,t=[],i=0,n=r,o=0;o<a.length||i<arguments.length;)o<a.length&&(null==a[o]||!0!==a[o]["@@functional/placeholder"]||arguments.length<=i)?e=a[o]:(e=arguments[i],i+=1),null!=(t[o]=e)&&!0===e["@@functional/placeholder"]||--n,o+=1;return n<=0?l.apply(this,t):c(n,s(r,t,l))}}},{"../arity":19}],24:[function(e,t,i){var o=e("natural-selection");t.exports=function(e,t){var i,n;o(e)&&e===document.activeElement?(i=e.selectionStart,n=e.selectionEnd,e.value=t,e.setSelectionRange(i,n)):e.value=t}},{"natural-selection":18}],25:[function(e,t,i){"use strict";t.exports=t.exports.default=function(e){if(-1===e.indexOf(":"))return null;e=e.split(":",1)[0];{if(n.hasOwnProperty(e))return n[e];throw new Error('svg-attribute-namespace: prefix "'+e+'" is not supported by SVG.')}};var n=t.exports.namespaces={ev:"http://www.w3.org/2001/xml-events",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"}},{}],26:[function(e,t,i){var n=e("ramda/src/curryN");function o(e){return"string"==typeof e}function s(e){return"number"==typeof e}function r(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function a(e){return"function"==typeof e}var l=Array.isArray||function(e){return"length"in e},c=n(2,function(e,t){return t===String?o:t===Number?s:t===Object?r:t===Array?l:t===Function?a:void 0===t?e:t});function h(e,t,i,n){if(e!==i.of)throw new TypeError("wrong type passed to case");e=i.name in t?i.name:"_"in t?"_":void 0;if(void 0===e)throw new Error("unhandled value passed to case");return t[e].apply(void 0,void 0!==n?i.concat([n]):i)}var u=n(3,h),p=n(4,h);t.exports=function(e){var t,i={};for(t in e)i[t]=function(o,s,r){return r=r.map(c(o)),n(r.length,function(){for(var e,t,i=[],n=0;n<arguments.length;++n){if(e=arguments[n],!("function"==typeof(t=r[n])&&t(e)||null!=e&&e.of===t))throw new TypeError("wrong value "+e+" passed to location "+n+" in "+s);i[n]=arguments[n]}return i.of=o,i.name=s,i})}(i,t,e[t]);return i.case=u(i),i.caseOn=p(i),i}},{"ramda/src/curryN":20}]},{},[1])},1518:function(e,t,i){var n=i(11);e.exports=function(e){var i=[],e=e||{};return function(e,t){i.push('<div class="modal-dialog game"><div class="background-wrapper"><div class="modal-content"><div class="modal-header">'),t.closeButton&&i.push('<div type="button" data-dismiss="modal" aria-hidden="true" class="button close">&times;</div>'),i.push('<h3 data-i18n="contact.contact_us">Contact CodeCombat...</h3></div><div class="modal-body"><p><span data-i18n="contact.welcome">Good to hear from you! Use this form to send us email.</span><span data-i18n="contact.forum_prefix" class="spl">For anything public, please try</span><a href="http://discourse.codecombat.com/" data-i18n="contact.forum_page">our forum</a><span data-i18n="contact.forum_suffix"> instead.</span><span data-i18n="contact.faq_prefix" class="spl spr">There\'s also a</span><a data-i18n="contact.faq" href="https://discourse.codecombat.com/t/18174">FAQ</a>.</p>'),e.isPremium()?i.push('<p data-i18n="contact.subscriber_support">Since you\'re a CodeCombat subscriber, your email will get our priority support.</p>'):i.push('<p><span data-i18n="contact.subscribe_prefix" class="spr">If you need help figuring out a level, please</span><a data-toggle="coco-modal" data-target="core/SubscribeModal" data-i18n="contact.subscribe">buy a CodeCombat subscription</a><span data-i18n="contact.subscribe_suffix" class="spl">and we\'ll be happy to help you with your code.</span></p>'),i.push('<div class="form"><div class="form-group"><label for="contact-email" data-i18n="general.email" class="control-label">Email</label><input id="contact-email" name="email" type="email"'+n.attr("value",""+(e.get("anonymous")?"":e.get("email")),!0,!0)+' data-i18n="[placeholder]contact.where_reply" placeholder="Where should we reply?" class="form-control"></div><div class="form-group"><label for="contact-message" data-i18n="general.message" class="control-label">Message</label><textarea id="contact-message" name="message" rows="8" class="form-control"></textarea></div></div><div id="contact-screenshot" class="secret"><a target="_blank" data-i18n="contact.screenshot_included">Screenshot included.</a><br><img width="100" class="pull-left"></div></div><div class="modal-body wait secret"><h3>Reticulating Splines...</h3><div class="progress progress-striped active"><div class="progress-bar"></div></div></div><div class="modal-footer"><span data-i18n="common.sending" class="sending-indicator pull-left secret">Sending...</span><a href="#" data-dismiss="modal" aria-hidden="true" data-i18n="common.cancel" class="btn">Cancel</a><button id="contact-submit-button" data-i18n="contact.send" class="btn btn-primary">Send Feedback</button></div></div></div></div>')}.call(this,"me"in e?e.me:"undefined"!=typeof me?me:void 0,"view"in e?e.view:"undefined"!=typeof view?view:void 0),i.join("")}},1519:function(e,t,i){var n,o={}.hasOwnProperty;function s(e){this.ids=e,s.__super__.constructor.call(this),this.ids.sort(),55<this.ids.length&&console.error("Too many ids, we'll likely go over the GET url kind-of-limit of 2000 characters.")}n=i(1374),i=i(115),e.exports=(function(e,t){for(var i in t)o.call(t,i)&&(e[i]=t[i]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(s,i),s.prototype.url="/db/thang.type/names",s.prototype.model=n,s.prototype.isCachable=!1,s.prototype.fetch=function(e){return null==e&&(e={}),_.extend(e,{data:{ids:this.ids}}),s.__super__.fetch.call(this,e)},s)},1520:function(d,e,m){!function(o){var e,i,s,t,r,a,l,n,c=function(e,t){return function(){return e.apply(t,arguments)}},h={}.hasOwnProperty,u=[].slice;function p(e){this.shared=e,this.simulateSync=c(this.simulateSync,this),this.fireWorker=c(this.fireWorker,this),this.infinitelyLooped=c(this.infinitelyLooped,this),this.onWorkerMessage=c(this.onWorkerMessage,this),this.testWorker=c(this.testWorker,this),p.__super__.constructor.call(this),this.say("Got my wings."),!window.navigator||-1===window.navigator.userAgent.search("MSIE")&&"Microsoft Internet Explorer"!==window.navigator.appName||(this.infiniteLoopIntervalDuration*=10,this.infiniteLoopTimeoutDuration*=10,this.abortTimeoutDuration*=10),n.getQueryVariable("dev")&&(this.infiniteLoopIntervalDuration*=1e5,this.infiniteLoopTimeoutDuration*=1e5,this.abortTimeoutDuration*=1e5),this.initialized=!1,this.running=!1,this.allLogs=[],this.hireWorker(),this.shared.angels.push(this),this.listenTo(this.shared.gameUIState.get("realTimeInputEvents"),"add",this.onAddRealTimeInputEvent)}r=m(81).now,s=m(271),e=m(45),i=m(272),l=m(627).sendContactMessage,t=m(58),n=m(6),a=!1,d.exports=(function(e,t){for(var i in t)h.call(t,i)&&(e[i]=t[i]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(p,e),p.nicks=["Archer","Lana","Cyril","Pam","Cheryl","Woodhouse","Ray","Krieger"],p.prototype.infiniteLoopIntervalDuration=1e4,p.prototype.infiniteLoopTimeoutDuration=7500,p.prototype.abortTimeoutDuration=500,p.prototype.subscriptions={"level:flag-updated":"onFlagEvent","playback:stop-real-time-playback":"onStopRealTimePlayback","level:escape-pressed":"onEscapePressed"},p.prototype.destroy=function(){return this.fireWorker(!1),_.remove(this.shared.angels,this),p.__super__.destroy.call(this)},p.prototype.workIfIdle=function(){if(!this.running)return this.doWork()},p.prototype.say=function(){1<=arguments.length&&u.call(arguments,0)},p.prototype.log=function(){for(var e="|"+this.shared.godNick+"'s "+this.nick+"|",t=0,i=arguments.length;t<i;t++)e+=" "+arguments[t];return console.info(e),this.allLogs.push(e)},p.prototype.testWorker=function(){if(!this.destroyed)return clearTimeout(this.condemnTimeout),this.condemnTimeout=_.delay(this.infinitelyLooped,this.infiniteLoopTimeoutDuration),this.say("Let's give it",this.infiniteLoopTimeoutDuration,"to not loop."),this.worker.postMessage({func:"reportIn"})},p.prototype.onWorkerMessage=function(e){var t;if(this.aborting&&"abort"!==e.data.type)return this.say("Currently aborting old work.");switch(e.data.type){case"worker-initialized":if(!this.initialized)return this.log("Worker initialized after "+(new Date-this.worker.creationTime)+"ms"),this.initialized=!0,this.doWork();break;case"start-load-frames":return clearTimeout(this.condemnTimeout);case"report-in":return this.say("Worker reported in."),clearTimeout(this.condemnTimeout);case"end-load-frames":return clearTimeout(this.condemnTimeout),this.beholdGoalStates({goalStates:e.data.goalStates,overallStatus:e.data.overallStatus,preload:!1,totalFrames:e.data.totalFrames,lastFrameHash:e.data.lastFrameHash,simulationFrameRate:e.data.simulationFrameRate});case"end-preload-frames":return clearTimeout(this.condemnTimeout),this.beholdGoalStates({goalStates:e.data.goalStates,overallStatus:e.data.overallStatus,preload:!0,simulationFrameRate:e.data.simulationFrameRate});case"non-user-code-problem":return this.publishGodEvent("non-user-code-problem",{problem:e.data.problem}),this.shared.firstWorld?this.infinitelyLooped(!1,!0):this.fireWorker();case"abort":return this.say("Aborted.",e.data),clearTimeout(this.abortTimeout),this.aborting=!1,this.running=!1,_.remove(this.shared.busyAngels,this),this.doWork();case"console-log":return this.log.apply(this,e.data.args);case"user-code-problem":return this.publishGodEvent("user-code-problem",{problem:e.data.problem});case"world-load-progress-changed":if(t=e.data.progress,this.work.indefiniteLength&&(t=Math.min(t,.9)),this.publishGodEvent("world-load-progress-changed",{progress:t}),!(1===e.data.progress||this.work.preload||this.work.headless||this.work.synchronous||this.deserializationQueue.length||this.shared.firstWorld&&!this.shared.spectate))return this.worker.postMessage({func:"serializeFramesSoFar"});break;case"some-frames-serialized":case"new-world":if(t=[e.data.serialized,e.data.goalStates,e.data.startFrame,e.data.endFrame,this.streamingWorld],this.deserializationQueue.push(t),1===this.deserializationQueue.length)return this.beholdWorld.apply(this,t);break;default:return this.log("Received unsupported message:",e.data)}},p.prototype.beholdGoalStates=function(e){var t=e.goalStates,i=e.overallStatus,n=e.preload,o=e.totalFrames,s=e.lastFrameHash,e=e.simulationFrameRate;if(!this.aborting)return i={goalStates:t,preload:null!=n&&n,overallStatus:i},null!=o&&(i.totalFrames=o),null!=s&&(i.lastFrameHash=s),null!=e&&(i.simulationFrameRate=e),this.publishGodEvent("goals-calculated",i),this.shared.headless?this.finishWork():void 0},p.prototype.beholdWorld=function(e,t,i,n,o){if(!this.aborting)return window.BOX2D_ENABLED=!1,null!=o&&(o.indefiniteLength=this.work.indefiniteLength),this.streamingWorld=s.deserialize(e,this.shared.worldClassMap,this.shared.lastSerializedWorldFrames,this.finishBeholdingWorld(t),i,n,this.work.level,o),window.BOX2D_ENABLED=!0,this.shared.lastSerializedWorldFrames=e.frames},p.prototype.finishBeholdingWorld=function(l){return c=this,function(e){var t,i,n,o,s,r,a;if(!c.aborting&&!c.destroyed){if(r=e.frames.length===e.totalFrames,e.indefiniteLength&&null!=e.victory&&(r=!0,e.totalFrames=e.frames.length),o=null!=(n=c.work)&&n.indefiniteLength?0:e.findFirstChangedFrame(c.shared.world),n=r?"new-world-created":"streaming-world-updated",r&&(c.shared.world=e),c.publishGodEvent(n,{world:e,firstWorld:c.shared.firstWorld,goalStates:l,team:me.team,firstChangedFrame:o,finished:r,keyValueDb:null!=(o=e.keyValueDb)?o:{}}),r){for(t=0,i=(s=c.shared.world.scriptNotes).length;t<i;t++)a=s[t],Backbone.Mediator.publish(a.channel,a.event);return null!=(r=c.shared.goalManager)&&(r.world=e),c.finishWork()}return null!=(e=c.deserializationQueue)&&e.shift(),(e=null!=(e=c.deserializationQueue)?e[0]:void 0)?c.beholdWorld.apply(c,e):void 0}};var c},p.prototype.finishWork=function(){return this.streamingWorld=null,this.shared.firstWorld=!1,this.deserializationQueue=[],this.running=!1,_.remove(this.shared.busyAngels,this),clearTimeout(this.condemnTimeout),clearInterval(this.purgatoryTimer),this.condemnTimeout=this.purgatoryTimer=null,this.doWork()},p.prototype.finalizePreload=function(){return this.say("Finalize preload."),this.worker.postMessage({func:"finalizePreload"}),this.work.preload=!1},p.prototype.infinitelyLooped=function(e,t){var i;if(null==e&&(e=!1),null==t&&(t=!1),this.say("On infinitely looped! Aborting?",this.aborting),!this.aborting)return i={type:"runtime",level:"error",id:"runtime_InfiniteLoop",message:"Code never finished. It's either really slow or has an infinite loop."},e&&(i.message="Escape pressed; code aborted."),this.publishGodEvent("user-code-problem",{problem:i}),this.publishGodEvent("infinite-loop",{firstWorld:this.shared.firstWorld,nonUserCodeProblem:t}),t&&this.reportLoadError(),this.fireWorker()},p.prototype.publishGodEvent=function(e,t){return this.shared.god.trigger(e,t),t.god=this.shared.god,Backbone.Mediator.publish("god:"+e,t)},p.prototype.reportLoadError=function(){var e,t,i,n;if(!(me.isAdmin()||/dev=true/.test(null!=(t=null!=(t=window.location)?t.href:void 0)?t:"")||a||(a=!0,(e={email:me.get("email")}).message="Automatic Report - Unable to Load Level\nLogs:\n"+this.allLogs.join("\n"),/Error: Out of memory/.test(e.message)&&/Legacy javascript detected/.test(e.message))))return o.browser&&(e.browser=o.browser.platform+" "+o.browser.name+" "+o.browser.versionNumber),e.screenSize=(null!=(t="undefined"!=typeof screen&&null!==screen?screen.width:void 0)?t:o(window).width())+" x "+(null!=(t="undefined"!=typeof screen&&null!==screen?screen.height:void 0)?t:o(window).height()),e.subject="Level Load Error: "+((null!=(t=this.work)&&null!=(i=t.level)?i.name:void 0)||"Unknown Level"),e.levelSlug=null!=(i=this.work)&&null!=(n=i.level)?n.slug:void 0,l(e)},p.prototype.doWork=function(){if(!this.aborting)return this.initialized?this.shared.workQueue.length?(this.work=this.shared.workQueue.shift(),this.say("Running world..."),this.running=!0,this.shared.busyAngels.push(this),this.deserializationQueue=[],this.work.synchronous?_.defer(this.simulateSync,this.work):(this.worker.postMessage({func:"runWorld",args:this.work}),clearTimeout(this.purgatoryTimer),this.say("Infinite loop timer started at interval of",this.infiniteLoopIntervalDuration),this.purgatoryTimer=setInterval(this.testWorker,this.infiniteLoopIntervalDuration))):(this.say("No work to do."),this.hireWorker()):this.say("Not initialized for work yet.")},p.prototype.abort=function(){var e,t,i;if(this.running)return this.say("Aborting..."),this.running=!1,null!=(e=this.work)&&null!=(t=e.world)&&null!=(i=t.goalManager)&&i.destroy(),null!=(i=this.work)&&(i.aborted=!0),this.work=null,this.streamingWorld=null,this.deserializationQueue=[],_.remove(this.shared.busyAngels,this),this.worker?(this.abortTimeout=_.delay(this.fireWorker,this.abortTimeoutDuration),this.aborting=!0,this.worker.postMessage({func:"abort"})):void 0},p.prototype.fireWorker=function(e){var t,i;if(null==e&&(e=!0),!this.destroyed)return this.aborting=!1,this.running=!1,_.remove(this.shared.busyAngels,this),null!=(t=this.worker)&&t.removeEventListener("message",this.onWorkerMessage),null!=(t=this.worker)&&t.terminate(),this.worker=null,clearTimeout(this.condemnTimeout),clearInterval(this.purgatoryTimer),this.say("Fired worker."),this.initialized=!1,null!=(t=this.work)&&null!=(i=t.world)&&"function"==typeof i.destroy&&i.destroy(),this.work=null,this.streamingWorld=null,this.deserializationQueue=[],e?this.hireWorker():void 0},p.prototype.hireWorker=function(){return"undefined"==typeof Worker||null===Worker?(this.initialized||(this.initialized=!0,this.doWork()),null):this.worker?void 0:(this.say("Hiring worker."),this.worker=new Worker(this.shared.workerCode),this.worker.addEventListener("error",t.onWorkerError),this.worker.addEventListener("message",this.onWorkerMessage),this.worker.creationTime=new Date)},p.prototype.onFlagEvent=function(e){if(this.running&&this.work.realTime)return this.work.synchronous?this.work.world.addFlagEvent(e):this.worker.postMessage({func:"addFlagEvent",args:e})},p.prototype.onAddRealTimeInputEvent=function(e){if(this.running&&this.work.realTime)return this.work.synchronous?this.work.world.addRealTimeInputEvent(e.toJSON()):this.worker.postMessage({func:"addRealTimeInputEvent",args:e.toJSON()})},p.prototype.onStopRealTimePlayback=function(e){if(this.running&&this.work.realTime)return this.work.synchronous?this.abort():(this.work.realTime=!1,this.lastRealTimeWork=new Date,this.worker.postMessage({func:"stopRealTimePlayback"}))},p.prototype.onEscapePressed=function(e){if(this.running&&!this.work.realTime&&!(new Date-this.lastRealTimeWork<1e3))return this.infinitelyLooped(!0)},p.prototype.simulateSync=function(e){var t;return"undefined"!=typeof imitateIE9&&null!==imitateIE9&&"undefined"!=typeof console&&null!==console&&"function"==typeof console.profile&&console.profile("World Generation "+(1e3*Math.random()).toFixed(0)),e.t0=r(),e.world=new s(e.userCodeMap),e.world.synchronous=!0,e.world.levelSessionIDs=e.levelSessionIDs,e.world.submissionCount=e.submissionCount,e.world.fixedSeed=e.fixedSeed,e.world.flagHistory=null!=(t=e.flagHistory)?t:[],e.world.realTimeInputEvents=null!=(t=e.realTimeInputEvents)?t:[],e.world.difficulty=null!=(t=e.difficulty)?t:0,e.world.language=me.get("preferredLanguage",!0),e.world.loadFromLevel(e.level,!0),e.world.preloading=e.preload,e.world.headless=e.headless,e.world.realTime=e.realTime,e.world.indefiniteLength=e.indefiniteLength,e.world.justBegin=e.justBegin,e.world.keyValueDb=e.keyValueDb,this.shared.goalManager&&((t=new i(e.world)).setGoals(e.goals),t.setCode(e.userCodeMap),t.worldGenerationWillBegin(),e.world.setGoalManager(t)),this.beginSimulationSync(e)},p.prototype.beginSimulationSync=function(e){return e.t1=r(),e.world.worldLoadStartTime=e.t1,e.world.lastRealTimeUpdate=0,e.world.realTimeSpeedFactor=1,this.simulateFramesSync(e,0)},p.prototype.simulateFramesSync=function(t,e){var i,n,o,s;if(!this.destroyed&&!t.aborted){for(s=t.world,null==e&&(e=s.frames.length),o=r();e<s.totalFrames;){if(t.realTime&&(this.streamFrameSync(t),s.indefiniteLength&&null!=s.victory&&(s.indefiniteLength=!1),!s.shouldContinueLoading(o,function(){},!1,function(e){return function(){if(!e.destroyed)return e.simulateFramesSync(t)}}(this))))return;s.indefiniteLength&&e===s.totalFrames-1&&++s.totalFrames;try{s.getFrame(e++)}catch(e){this.handleWorldError(s,i=e),this.reportLoadError();break}if(i=(null!=(n=s.unhandledRuntimeErrors)?n:[])[0]){this.handleWorldError(s,i);break}}return this.finishSimulationSync(t)}},p.prototype.handleWorldError=function(e,t){return t.isUserCodeProblem?this.publishGodEvent("user-code-problem",{problem:t}):(console.error("Non-UserCodeError:",t.toString()+"\n"+t.stack||t.stackTrace),t={type:"runtime",level:"error",message:t.toString()},this.publishGodEvent("non-user-code-problem",{problem:t})),e.indefiniteLength=!1,e.totalFrames=e.frames.length},p.prototype.streamFrameSync=function(e){var t=e.world.goalManager.getGoalStates();return this.finishBeholdingWorld(t)(e.world)},p.prototype.finishSimulationSync=function(e){var t,i,n,o,s;for(this.publishGodEvent("world-load-progress-changed",{progress:1}),e.world.ended=!0,t=0,i=(n=e.world.systems).length;t<i;t++)n[t].finish(e.world.thangs);return e.t2=r(),"undefined"!=typeof imitateIE9&&null!==imitateIE9&&"undefined"!=typeof console&&null!==console&&"function"==typeof console.profileEnd&&console.profileEnd(),console.log("Construction:",(e.t1-e.t0).toFixed(0),"ms. Simulation:",(e.t2-e.t1).toFixed(0),"ms --",((e.t2-e.t1)/e.world.frames.length).toFixed(3),"ms per frame, profiled."),e.world.ended&&(e.world.goalManager.worldGenerationEnded(),e.world.goalManager.notifyGoalChanges()),o=e.world.goalManager.getGoalStates(),this.running=!1,e.headless?(s=e.world.frames.length/(e.t2-e.t1)*1e3*30/e.world.frameRate,void this.beholdGoalStates({goalStates:o,overallStatus:e.world.goalManager.checkOverallStatus(),preload:!1,totalFrames:e.world.totalFrames,lastFrameHash:null!=(o=e.world.frames[e.world.totalFrames-2])?o.hash:void 0,simulationFrameRate:s})):this.shared.lastSerializedWorldFrames=e.world.frames},p)}.call(this,m(3))},1521:function(e,t,i){var n,o={}.hasOwnProperty;function s(){return s.__super__.constructor.apply(this,arguments)}n=i(115),i=i(269),e.exports=(function(e,t){for(var i in t)o.call(t,i)&&(e[i]=t[i]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(s,n),s.prototype.url="/db/achievement",s.prototype.model=i,s.prototype.fetchRelatedToLevel=function(e,t){return(t=_.extend({data:{}},t)).data.related=e,this.fetch(t)},s.prototype.fetchForCampaign=function(e,t){return(t=_.extend({data:{}},t)).url="/db/campaign/"+e+"/achievements",this.fetch(t)},s)},1522:function(e,t,i){"use strict";var n=i(1434);i.n(n).a},1523:function(e,t,i){(e.exports=i(92)()).push([e.i,"\nsvg path[data-v-69bcb9ed], svg circle[data-v-69bcb9ed] {\n  fill: transparent;\n}\n",""])},1524:function(e,t,i){"use strict";i.r(t);var n,o=i(1525),s=i.n(o);for(n in o)["default"].indexOf(n)<0&&function(e){i.d(t,e,function(){return o[e]})}(n);t.default=s.a},1525:function(e,s,r){"use strict";!function(e){Object.defineProperty(s,"__esModule",{value:!0}),s.default=void 0;var t=o(r(6)),i=o(r(1494)),n=o(r(1489));function o(e){return e&&e.__esModule?e:{default:e}}i=Vue.extend({props:{levelSlug:{type:String,required:!0},courseInstanceID:{type:String,required:!0},courseID:{type:String,required:!0},codeLanguage:{type:String},levelOriginalID:{type:String,required:!0}},metaInfo:function(){return{title:this.$t("play.video_title",{video:this.videoData.title}),link:[{vmid:"rel-canonical",rel:"canonical",content:"/play"}]}},data:function(){return{originalDisplaySettings:{}}},components:{"flat-layout":i.default},mounted:function(){this.$nextTick(function(){me.showChinaVideo()||new n.default(e(".video")[0]).on("ended",function(){e("#next-level-btn")[0].style.display="block"}),this.originalDisplaySettings={"main-nav":e("#main-nav")[0]?e("#main-nav")[0].style.display:"",footer:e("#footer")[0]?e("#footer")[0].style.display:"","final-footer":e("#final-footer")[0]?e("#final-footer")[0].style.display:""},e("#main-nav")[0]&&(e("#main-nav")[0].style.display="none"),e("#footer")[0]&&(e("#footer")[0].style.display="none"),e("#final-footer")[0]&&(e("#final-footer")[0].style.display="none")})},beforeDestroy:function(){e("#main-nav")[0]&&(e("#main-nav")[0].style.display=this.originalDisplaySettings["main-nav"]),e("#footer")[0]&&(e("#footer")[0].style.display=this.originalDisplaySettings.footer),e("#final-footer")[0]&&(e("#final-footer")[0].style.display=this.originalDisplaySettings["final-footer"])},computed:{videoData:function(){return t.default.videoLevels[this.levelOriginalID]||{}},videoUrl:function(){return me.showChinaVideo()?this.videoData.cn_url:this.videoData.url},nextLevelLink:function(){var e="";return me.isSessionless()?(e="/play/level/"+this.levelSlug+"?course="+this.courseID+"&codeLanguage=",e+=this.codeLanguage||"python"):(e="/play/level/"+this.levelSlug+"?course="+this.courseID+"&course-instance="+this.courseInstanceID,this.codeLanguage&&(e+="&codeLanguage="+this.codeLanguage)),e}},methods:{onNextLevel:function(){window.tracker&&window.tracker.trackEvent("Play Video Next Level",{category:"Students",videoTitle:this.videoData.title,nextLevelSlug:this.levelSlug},[])},onSkip:function(){window.tracker&&window.tracker.trackEvent("Play Video Skip",{category:"Students",videoTitle:this.videoData.title,nextLevelSlug:this.levelSlug},[])}}});s.default=i}.call(this,r(3))},1526:function(e,t,i){var n=i(1949);(n="string"==typeof n?[[e.i,n,""]]:n).locals&&(e.exports=n.locals);(0,i(21).default)("20d93db0",n,!0,{})},1544:function(e,t,i){"use strict";i.d(t,"a",function(){return n}),i.d(t,"b",function(){return o});var n=function(){var e=this,t=e.$createElement,t=e._self._c||t;return t("svg",{attrs:{viewBox:e.viewBox}},[t("circle",{attrs:{cx:"0",cy:"0",r:"1",stroke:"transparent","stroke-width":e.strokeWidth/5}}),e._v(" "),e.circle?e._e():t("path",{attrs:{d:e.path,stroke:e.color,"stroke-width":e.strokeWidth/5,opacity:e.opacity}}),e._v(" "),e.circle?t("circle",{attrs:{cx:"0",cy:"0",r:"1",stroke:e.color,"stroke-width":e.strokeWidth/5,opacity:e.opacity}}):e._e(),e._v(" "),e.circle?e._e():t("circle",{attrs:{cx:"0",cy:"0",r:e.width/2-.1,stroke:e.color,"stroke-width":e.borderStrokeWidth,opacity:e.opacity}})])},o=[]},1549:function(module,exports,__webpack_require__){!function($){var SegmentedSprite,SpriteBuilder,createjs,specialGoToAndStop,bind=function(e,t){return function(){return e.apply(t,arguments)}},extend=function(e,t){for(var i in t)hasProp.call(t,i)&&(e[i]=t[i]);function n(){this.constructor=e}return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e},hasProp={}.hasOwnProperty,slice=[].slice,SpriteBuilder=__webpack_require__(1393),createjs=__webpack_require__(1373),specialGoToAndStop=function(e){return e===this.currentFrame&&this.childrenCopy?this.addChild.apply(this,this.childrenCopy):(this.gotoAndStop(e),this.childrenCopy=this.children.slice(0))};module.exports=SegmentedSprite=function(superClass){function SegmentedSprite(e,t,i,n){this.spriteSheet=e,this.thangType=t,this.spriteSheetPrefix=i,this.resolutionFactor=null!=n?n:SPRITE_RESOLUTION_FACTOR,this.handleTick=bind(this.handleTick,this),null==(n=this.spriteSheet).mcPool&&(n.mcPool={}),SegmentedSprite.__super__.constructor.call(this,this.spriteSheet),this.addEventListener("tick",this.handleTick)}return extend(SegmentedSprite,superClass),SegmentedSprite.prototype.childMovieClips=null,SegmentedSprite.prototype.destroy=function(){return this.handleTick=void 0,this.baseMovieClip&&(this.baseMovieClip.inUse=!1),this.removeAllEventListeners()},SegmentedSprite.prototype.play=function(){if(!(this.baseMovieClip&&1<this.animLength))return this.paused=!1},SegmentedSprite.prototype.stop=function(){return this.paused=!0},SegmentedSprite.prototype.gotoAndPlay=function(e){return this.goto(e,!1)},SegmentedSprite.prototype.gotoAndStop=function(e){return this.goto(e,!0)},SegmentedSprite.prototype.goto=function(e,t){var i,o,n,s,r,a,l,c,h,u,p,d,m;if(this.paused=null==t||t,this.removeAllChildren(),this.currentAnimation=e,this.baseMovieClip&&(this.baseMovieClip.inUse=!1),this.childMovieClips)for(n=0,r=(c=this.childMovieClips).length;n<r;n++)c[n].inUse=!1;if(this.childMovieClips=this.baseMovieClip=this.framerate=this.animLength=null,this.actionNotSupported=!1,i=this.thangType.getActions()[e],t=_.string.startsWith(e,"move"),p=(null!=(e=i.positions)?e.registration:void 0)||(null!=(p=this.thangType.get("positions"))?p.registration:void 0)||{x:0,y:0},i.animation){for(this.regX=-p.x,this.regY=-p.y,this.framerate=(null!=(u=i.framerate)?u:20)*(null!=(m=i.speed)?m:1),this.childMovieClips=[],this.baseMovieClip=this.buildMovieClip(i.animation),this.baseMovieClip.inUse=!0,this.frames=i.frames,this.frames&&(this.frames=function(){for(var e=this.frames.split(","),t=[],i=0,n=e.length;i<n;i++)o=e[i],t.push(parseInt(o));return t}.call(this)),this.animLength=this.frames?this.frames.length:this.baseMovieClip.timeline.duration,1===this.animLength&&(this.paused=!0),this.frames?this.currentFrame=t?this.frames[_.random(this.frames.length-1)]:this.frames[0]:this.currentFrame=t?Math.floor(Math.random()*this.animLength):0,this.baseMovieClip.specialGoToAndStop(this.currentFrame),s=0,a=(h=this.childMovieClips).length;s<a;s++)"single"===(l=h[s]).mode?l.specialGoToAndStop(l.startPosition):l.specialGoToAndStop(this.currentFrame);this.takeChildrenFromMovieClip(this.baseMovieClip,this),this.loop=!1!==i.loops,this.goesTo=i.goesTo,this.actionNotSupported&&this.notifyActionNeedsRender(i),this.scaleX=this.scaleY=null!=(m=null!=(u=i.scale)?u:this.thangType.get("scale"))?m:1}else if(i.container)this.regX=this.regY=0,this.scaleX=this.scaleY=1,this.childMovieClips=[],u=this.spriteSheetPrefix+i.container,(m=new createjs.Sprite(this.spriteSheet)).gotoAndStop(u),0===m.currentFrame||this.usePlaceholders?(m.gotoAndStop(0),this.notifyActionNeedsRender(i),d=this.thangType.get("raw").containers[i.container].b,u=null!=(u=null!=(u=i.scale)?u:this.thangType.get("scale"))?u:1,m.scaleX=u*d[2]/(SPRITE_PLACEHOLDER_WIDTH*this.resolutionFactor),m.scaleY=u*d[3]/(SPRITE_PLACEHOLDER_WIDTH*this.resolutionFactor),m.regX=SPRITE_PLACEHOLDER_WIDTH*this.resolutionFactor*((-p.x-d[0])/d[2]),m.regY=SPRITE_PLACEHOLDER_WIDTH*this.resolutionFactor*((-p.y-d[1])/d[3])):(d=this.resolutionFactor*(null!=(d=null!=(d=i.scale)?d:this.thangType.get("scale"))?d:1),m.regX=-p.x*d,m.regY=-p.y*d,m.scaleX=m.scaleY=1/this.resolutionFactor),this.children=[],this.addChild(m);else if(i.goesTo)return void this.goto(i.goesTo,this.paused);i.flipX&&(this.scaleX*=-1),i.flipY&&(this.scaleY*=-1),this.baseScaleX=this.scaleX,this.baseScaleY=this.scaleY},SegmentedSprite.prototype.notifyActionNeedsRender=function(e){var t;return null!=(t=this.lank)?t.trigger("action-needs-render",this.lank,e):void 0},SegmentedSprite.prototype.buildMovieClip=function(e,t,i,n){var o,s,r,a,l,c,h,u,p,d,m,f,g,y,v,b,w,k,x,S,C,T,L,M,D,I,A,R=JSON.stringify([this.spriteSheetPrefix].concat(arguments));for(null==(x=this.spriteSheet).mcPool&&(x.mcPool={}),null==(x=this.spriteSheet.mcPool)[R]&&(x[R]=[]),h=0,d=(S=this.spriteSheet.mcPool[R]).length;h<d;h++)if(!(w=S[h]).inUse)return w.gotoAndStop(w.currentFrame+.01),this.childMovieClips=w.childMovieClips,w;for(x=this.thangType.get("raw"),s=x.animations[e],this.lastAnimData=s,v={},_.extend(v,this.buildMovieClipContainers(s.containers)),_.extend(v,this.buildMovieClipAnimations(s.animations)),D={},u=0,m=(C=s.shapes).length;u<m;u++)D[C[u].bn]=!0;for(p=0,f=(T=s.graphics).length;p<f;p++)D[T[p].bn]=!0;for((o=new createjs.MovieClip).initialize(null!=t?t:createjs.MovieClip.INDEPENDENT,null!=i?i:0,null==n||n),o.specialGoToAndStop=specialGoToAndStop,c=b=0,g=(L=s.tweens).length;b<g;c=++b){for(A=L[c],M=!1,I=createjs.Tween,k=0,y=A.length;k<y;k++){if(l=A[k],r=$.extend(!0,[],l.a),!1===this.dereferenceArgs(r,v,D)){M=!0;break}if(!I[l.n]){M=!0;break}I=I[l.n].apply(I,r)}M||o.timeline.addTween(I)}return o.nominalBounds=function(e,t,i){i.prototype=e.prototype;i=new i,t=e.apply(i,t);return Object(t)===t?t:i}(createjs.Rectangle,s.bounds,function(){}),s.frameBounds&&(o.frameBounds=function(){for(var e=s.frameBounds,t=[],i=0,n=e.length;i<n;i++)a=e[i],t.push(function(e,t,i){i.prototype=e.prototype;i=new i,t=e.apply(i,t);return Object(t)===t?t:i}(createjs.Rectangle,a,function(){}));return t}()),o.childMovieClips=this.childMovieClips,this.spriteSheet.mcPool[R].push(o),o},SegmentedSprite.prototype.buildMovieClipShapes=function(e){for(var t,i,n={},o=0,s=e.length;o<s;o++)(t=e[o]).im?(i=new createjs.Shape(this.spriteSheet))._off=!0:(i=this.buildShapeFromStore(t.gn),t.m&&(i.mask=n[t.m])),n[t.bn]=i;return n},SegmentedSprite.prototype.buildShapeFromStore=function(e,t){var i,n,o;return null==t&&(t=!1),o=this.thangType.get("raw").shapes[e],t=new createjs.Shape,null!=o.lf?(e=t.graphics).lf.apply(e,o.lf):null!=o.fc?t.graphics.f(o.fc):null!=o.rf&&(i=t.graphics).rf.apply(i,o.rf),null!=o.ls?(i=t.graphics).ls.apply(i,o.ls):null!=o.sc&&t.graphics.s(o.sc),null!=o.ss&&(n=t.graphics).ss.apply(n,o.ss),null!=o.de&&(n=t.graphics).de.apply(n,o.de),null!=o.p&&t.graphics.p(o.p),t.setTransform.apply(t,o.t),o.bounds&&(t.nominalBounds=function(e,t,i){i.prototype=e.prototype;i=new i,t=e.apply(i,t);return Object(t)===t?t:i}(createjs.Rectangle,o.bounds,function(){})),t},SegmentedSprite.prototype.buildMovieClipContainers=function(e){for(var t,i,n,o,s={},r=0,a=e.length;r<a;r++)n=e[r],o=new createjs.Container(this.spriteSheet),(i=new createjs.Sprite(this.spriteSheet)).gotoAndStop(this.spriteSheetPrefix+n.gn),0===i.currentFrame||this.usePlaceholders?(i.gotoAndStop(0),this.actionNotSupported=!0,t=this.thangType.get("raw").containers[n.gn].b,i.x=t[0],i.y=t[1],i.scaleX=t[2]/(SPRITE_PLACEHOLDER_WIDTH*this.resolutionFactor),i.scaleY=t[3]/(SPRITE_PLACEHOLDER_WIDTH*this.resolutionFactor)):i.scaleX=i.scaleY=1/(this.resolutionFactor*(this.thangType.get("scale")||1)),o.addChild(i),o.setTransform.apply(o,n.t),null!=n.o&&(o._off=n.o),null!=n.al&&(o.alpha=n.al),s[n.bn]=o;return s},SegmentedSprite.prototype.buildMovieClipAnimations=function(e){for(var t,i,n={},o=0,s=e.length;o<s;o++)i=e[o],(t=this.buildMovieClip.apply(this,[i.gn].concat(slice.call(i.a)))).inUse=!0,t.setTransform.apply(t,i.t),n[i.bn]=t,this.childMovieClips.push(t);return n},SegmentedSprite.prototype.dereferenceArgs=function(args,locals,toSkip){var key,res,val;for(key in args)if(val=args[key],locals[val])args[key]=locals[val];else if(null===val)args[key]={};else if(_.isString(val)&&0===val.indexOf("createjs."))args[key]=eval(val);else if(_.isObject(val)||_.isArray(val)){if(res=this.dereferenceArgs(val,locals,toSkip),!1===res)return res}else if(_.isString(val)&&toSkip[val])return!1;return args},SegmentedSprite.prototype.handleTick=function(e){return this.lastTimeStamp&&this.tick(e.timeStamp-this.lastTimeStamp),this.lastTimeStamp=e.timeStamp},SegmentedSprite.prototype.tick=function(e){var t,i,n,o,s,r;if(!this.paused&&this.baseMovieClip){if(1===this.animLength)return this.paused=!0;if((o=this.currentFrame+this.framerate*e/1e3)>this.animLength){if(this.goesTo)return void this.gotoAndPlay(this.goesTo);this.loop?o%=this.animLength:(this.paused=!0,o=this.animLength-1,_.defer((a=this,function(){return a.dispatchEvent("animationend")})))}var a,l=o;if(this.frames&&(l=(s=Math.floor(o))===(e=Math.ceil(o))?this.frames[o]:e===this.frames.length?this.frames[s]:this.frames[s]+o%1*(this.frames[e]-this.frames[s])),this.currentFrame=o,l!==this.baseMovieClip.currentFrame){for(this.baseMovieClip.specialGoToAndStop(l),t=0,i=(r=this.childMovieClips).length;t<i;t++)(n=r[t]).specialGoToAndStop("single"===n.mode?n.startPosition:o);return this.children=[],this.takeChildrenFromMovieClip(this.baseMovieClip,this)}}},SegmentedSprite.prototype.takeChildrenFromMovieClip=function(e,t){for(var i,n,o,s,r,a,l=e.childrenCopy,c=[],h=0,u=l.length;h<u;h++)if((i=l[h])instanceof createjs.MovieClip){for(n=new createjs.Container(this.spriteSheet),this.takeChildrenFromMovieClip(i,n),o=0,s=(a=["regX","regY","rotation","scaleX","scaleY","skewX","skewY","x","y"]).length;o<s;o++)n[r=a[o]]=i[r];c.push(t.addChild(n))}else c.push(t.addChild(i));return c},SegmentedSprite}(createjs.Container)}.call(this,__webpack_require__(3))},1550:function(e,t,i){var u,p,o={}.hasOwnProperty,d=[].indexOf||function(e){for(var t=0,i=this.length;t<i;t++)if(t in this&&this[t]===e)return t;return-1};function s(e,t,i,n){this.spriteSheet=e,this.thangType=t,this.spriteSheetPrefix=i,this.resolutionFactor=null!=n?n:SPRITE_RESOLUTION_FACTOR,s.__super__.constructor.call(this,this.spriteSheet)}i(1393),i=i(1373),p=["Dungeon Floor","Indoor Floor","Grass","Grass01","Grass02","Grass03","Grass04","Grass05","Goal Trigger","Obstacle","Sand 01","Sand 02","Sand 03","Sand 04","Sand 05","Sand 06","Talus 1","Talus 2","Talus 3","Talus 4","Talus 5","Talus 6","Firn 1","Firn 2","Firn 3","Firn 4","Firn 5","Firn 6","Ice Rink 1","Ice Rink 2","Ice Rink 3","Firn Cliff","VR Floor","Classroom Floor"],u=["Dungeon Pit","Grass Cliffs"],e.exports=(function(e,t){for(var i in t)o.call(t,i)&&(e[i]=t[i]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(s,i.Sprite),s.prototype.childMovieClips=null,s.prototype.destroy=function(){return this.removeAllEventListeners()},s.prototype.gotoAndPlay=function(e){return this.goto(e,!1)},s.prototype.gotoAndStop=function(e){return this.goto(e,!0)},s.prototype._gotoAndPlay=i.Sprite.prototype.gotoAndPlay,s.prototype._gotoAndStop=i.Sprite.prototype.gotoAndStop,s.prototype.goto=function(e,t){var i,n,o,s,r,a,l,c,h;this.paused=null==t||t,this.actionNotSupported=!1,i=this.thangType.getActions()[e],n=_.string.startsWith(e,"move"),t=(null!=(t=i.positions)?t.registration:void 0)||(null!=(a=this.thangType.get("positions"))?a.registration:void 0)||{x:0,y:0},i.animation&&(this.framerate=(null!=(a=i.framerate)?a:20)*(null!=(r=i.speed)?r:1),a=this.paused?"_gotoAndStop":"_gotoAndPlay",r=this.spriteSheetPrefix+e,this[a](r),0===this.currentFrame||this.usePlaceholders?(this._gotoAndStop(0),this.notifyActionNeedsRender(i),null==(l=null!=(a=this.thangType.get("raw"))&&null!=(l=a.animations)&&null!=(c=l[i.animation])?c.bounds:void 0)&&(l=[0,0,1,1]),c=null!=(c=null!=(c=i.scale)?c:this.thangType.get("scale"))?c:1,this.scaleX=c*l[2]/(SPRITE_PLACEHOLDER_WIDTH*this.resolutionFactor),this.scaleY=c*l[3]/(SPRITE_PLACEHOLDER_WIDTH*this.resolutionFactor),this.regX=SPRITE_PLACEHOLDER_WIDTH*this.resolutionFactor*((-t.x-l[0])/l[2]),this.regY=SPRITE_PLACEHOLDER_WIDTH*this.resolutionFactor*((-t.y-l[1])/l[3])):(h=this.resolutionFactor*(null!=(h=null!=(h=i.scale)?h:this.thangType.get("scale"))?h:1),this.regX=-t.x*h,this.regY=-t.y*h,this.scaleX=this.scaleY=1/this.resolutionFactor,this.framerate=i.framerate||20,n&&(o=null!=(o=this.spriteSheet.getAnimation(r))?o.frames:void 0)&&(this.currentAnimationFrame=Math.floor(Math.random()*o.length)))),i.container&&(r=this.spriteSheetPrefix+e,this._gotoAndStop(r),0===this.currentFrame||this.usePlaceholders?(this._gotoAndStop(0),this.notifyActionNeedsRender(i),l=this.thangType.get("raw").containers[i.container].b,c=null!=(r=null!=(r=i.scale)?r:this.thangType.get("scale"))?r:1,this.scaleX=c*l[2]/(SPRITE_PLACEHOLDER_WIDTH*this.resolutionFactor),this.scaleY=c*l[3]/(SPRITE_PLACEHOLDER_WIDTH*this.resolutionFactor),this.regX=SPRITE_PLACEHOLDER_WIDTH*this.resolutionFactor*((-t.x-l[0])/l[2]),this.regY=SPRITE_PLACEHOLDER_WIDTH*this.resolutionFactor*((-t.y-l[1])/l[3])):(h=this.resolutionFactor*(null!=(l=null!=(l=i.scale)?l:this.thangType.get("scale"))?l:1),this.regX=-t.x*h,this.regY=-t.y*h,this.scaleX=this.scaleY=1/this.resolutionFactor)),i.flipX&&(this.scaleX*=-1),i.flipY&&(this.scaleY*=-1),this.baseScaleX=this.scaleX,this.baseScaleY=this.scaleY,this.camera&&(s=this.thangType.get("name"),0<=d.call(p,s))?this.baseScaleY*=this.camera.y2x:this.camera&&(s=this.thangType.get("name"),0<=d.call(u,s))&&("idle_side"===e?(this.baseScaleX*=this.camera.x2y,this.baseScaleY*=.85*this.camera.y2x):this.baseScaleY*=this.camera.y2x/.85),this.currentAnimation=e},s.prototype.notifyActionNeedsRender=function(e){var t;return null!=(t=this.lank)?t.trigger("action-needs-render",this.lank,e):void 0},s)},1551:function(t,e,i){!function(r){var e,s,u,o,a,m,l,c,h={}.hasOwnProperty,p=[].indexOf||function(e){for(var t=0,i=this.length;t<i;t++)if(t in this&&this[t]===e)return t;return-1};function d(e){this.options=null!=e?e:{},d.__super__.constructor.call(this),this.handleEvents=this.options.handleEvents,this.gameUIState=this.options.gameUIState,this.dragged=0,this.camera=this.options.camera,this.webGLStage=this.options.webGLStage,this.surfaceTextLayer=this.options.surfaceTextLayer,this.world=this.options.world,null==(e=this.options).thangTypes&&(e.thangTypes=[]),this.lanks={},this.lankArray=[],this.createLayers(),this.pendingFlags=[],this.handleEvents||this.listenTo(this.gameUIState,"change:selected",this.onChangeSelected)}e=i(45),l=i(44).me,a=i(1431),s=i(1596),o=i(1420),m=i(1495),u=i(169),c=i(6),t.exports=(function(e,t){for(var i in t)h.call(t,i)&&(e[i]=t[i]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(d,e),d.prototype.subscriptions={"level:set-debug":"onSetDebug","sprite:highlight-sprites":"onHighlightSprites","level:select-sprite":"onSelectSprite","level:suppress-selection-sounds":"onSuppressSelectionSounds","level:lock-select":"onSetLockSelect","level:restarted":"onLevelRestarted","god:new-world-created":"onNewWorld","god:streaming-world-updated":"onNewWorld","camera:dragged":"onCameraDragged","sprite:loaded":function(){return this.update(!0)},"level:flag-color-selected":"onFlagColorSelected","level:flag-updated":"onFlagUpdated","surface:flag-appeared":"onFlagAppeared","surface:remove-selected-flag":"onRemoveSelectedFlag"},d.prototype.destroy=function(){var e,t,i,n,o,s,r=this.lanks;for(s in r)t=r[s],this.removeLank(t);for(null!=(n=this.targetMark)&&n.destroy(),null!=(n=this.selectionMark)&&n.destroy(),e=0,i=(o=_.values(this.layerAdapters)).length;e<i;e++)o[e].destroy();return d.__super__.destroy.call(this)},d.prototype.toString=function(){return"<LankBoss: "+this.lankArray.length+" lanks>"},d.prototype.thangTypeFor=function(t){return _.find(this.options.thangTypes,function(e){return e.get("original")===t||e.get("name")===t})},d.prototype.createLayers=function(){var e,o,t,i,n,s,r;for(this.layerAdapters={},t=(n=[["Land",-40],["Ground",-30],["Obstacle",-20],["Path",-10],["Default",e=0],["Floating",10]]).length;e<t;e++)i=(s=n[e])[0],s=s[1],this.layerAdapters[i]=new a({name:i,webGL:!0,layerPriority:s,transform:a.TRANSFORM_SURFACE,camera:this.camera});return(r=this.webGLStage).addChild.apply(r,function(){for(var e=_.values(this.layerAdapters),t=[],i=0,n=e.length;i<n;i++)o=e[i],t.push(o.container);return t}.call(this))},d.prototype.layerForChild=function(i,e){var t;return null==i.layerPriority&&(t=null!=e?e.thang:void 0)&&(i.layerPriority=t.layerPriority,t.isSelectable&&null==i.layerPriority&&(i.layerPriority=0),t.isLand&&null==i.layerPriority&&(i.layerPriority=-40)),null==i.layerPriority&&(i.layerPriority=0),i.layerPriority?(t=_.findLast(this.layerAdapters,function(e,t){return e.layerPriority<=i.layerPriority}),null!=(t=i.layerPriority<-40&&null==t?this.layerAdapters.Land:t)?t:this.layerAdapters.Default):this.layerAdapters.Default},d.prototype.addLank=function(e,t,i){return null==i&&(i=null),null==(t=null==t?null:t)&&(t=e.thang.id),this.lanks[t]&&console.error("Lank collision! Already have:",t),this.lanks[t]=e,this.lankArray.push(e),(i=null==(i=-1!==(null!=(t=e.thang)?t.spriteName.search(/(dungeon|indoor|ice|classroom|vr).wall/i):void 0)&&null==i?this.layerAdapters.Obstacle:i)?this.layerForChild(e.sprite,e):i).addLank(e),i.updateLayerOrder(),e},d.prototype.createMarks=function(){return this.targetMark=new m({name:"target",camera:this.camera,layer:this.layerAdapters.Ground,thangType:"target"}),this.selectionMark=new m({name:"selection",camera:this.camera,layer:this.layerAdapters.Ground,thangType:"selection"})},d.prototype.createLankOptions=function(e){return _.extend(e,{camera:this.camera,resolutionFactor:SPRITE_RESOLUTION_FACTOR,groundLayer:this.layerAdapters.Ground,textLayer:this.surfaceTextLayer,floatingLayer:this.layerAdapters.Floating,showInvisible:this.options.showInvisible,gameUIState:this.gameUIState,handleEvents:this.handleEvents})},d.prototype.onSetDebug=function(e){var t,i,n,o,s;if(e.debug!==this.debug){for(this.debug=e.debug,s=[],t=0,n=(o=this.lankArray).length;t<n;t++)i=o[t],s.push(i.setDebug(this.debug));return s}},d.prototype.onHighlightSprites=function(e){var t,i,n=e.thangIDs||[],o=this.lanks,s=[];for(i in o)t=o[i],s.push("function"==typeof t.setHighlight?t.setHighlight(0<=p.call(n,i),e.delay):void 0);return s},d.prototype.addThangToLanks=function(t,e){var i,n;return null==e&&(e=null),this.lanks[t.id]?console.warn("Tried to add Thang to the surface it already has:",t.id):(n=null==(n=_.find(this.options.thangTypes,function(e){return!(!e.get("actions")&&!e.get("raster"))&&e.get("name")===t.spriteName}))?_.find(this.options.thangTypes,function(e){return e.get("name")===t.spriteName}):n)?((i=this.createLankOptions({thang:t})).resolutionFactor="Floor"===n.get("kind")?2:SPRITE_RESOLUTION_FACTOR,this.options.playerNames&&/Hero Placeholder/.test(t.id)&&(i.playerName=this.options.playerNames[t.team]),i=new o(n,i),this.listenTo(i,"sprite:mouse-up",this.onLankMouseUp),this.addLank(i,null,e),i.setDebug(this.debug),i):console.error("Couldn't find ThangType for",t)},d.prototype.removeLank=function(e){return e.layer.removeLank(e),e.thang,delete this.lanks[e.thang.id],this.lankArray.splice(this.lankArray.indexOf(e),1),this.stopListening(e),e.destroy()},d.prototype.updateSounds=function(){for(var e,t=this.lankArray,i=[],n=0,o=t.length;n<o;n++)e=t[n],i.push(e.playSounds());return i},d.prototype.update=function(e){var t,i,n;for(e&&this.adjustLankExistence(),t=0,i=(n=this.lankArray).length;t<i;t++)n[t].update(e);return this.updateSelection(),this.layerAdapters.Default.updateLayerOrder(),this.cacheObstacles()},d.prototype.adjustLankExistence=function(){for(var e,t,i,n,o,s,r,a=[],l=[],c=this.world.thangs,h=0,u=c.length;h<u;h++)(s=c[h]).exists&&s.pos&&(s.equip&&(l=l.concat(this.equipNewItems(s))),(t=this.lanks[s.id])?(t.setThang(s),this.world.synchronous&&!s.stateless&&(s.stateChanged=!0)):(t=this.addThangToLanks(s),this.world.synchronous&&!s.stateless&&(s.stateChanged=!0),Backbone.Mediator.publish("surface:new-thang-added",{thang:s,sprite:t}),t.sprite.parent===this.layerAdapters.Obstacle&&a.push(t),t.playSounds()));for(e=0,i=l.length;e<i;e++)l[e].modifyStats();for(r in n=this.lanks)o=!((t=n[r]).notOfThisWorld||null!=(o=this.world.thangMap[r])&&o.exists),t.sprite.parent===this.layerAdapters.Obstacle&&(o||t.hasMoved)&&a.push(t),t.hasMoved=!1,o&&this.removeLank(t);return a.length&&this.cachedObstacles&&this.cacheObstacles(a),this.willSelectThang&&this.lanks[this.willSelectThang[0]]&&this.selectThang.apply(this,this.willSelectThang),this.updateScreenReader()},d.prototype.updateScreenReader=function(){var e,t,i,o,n,s;if("zersiax"===l.get("name"))return e=r("#ascii-surface"),s=function(){for(var e=this.lankArray,t=[],i=0,n=e.length;i<n;i++)o=e[i],t.push(o.thang);return t}.call(this),i=new u(s,this.world.width,this.world.height,0,0,0,!0),c.replaceText(e,i.toString(!0)),e.css("transform","initial"),n=e.innerWidth(),t=e.innerHeight(),s=e.parent().innerWidth(),i=e.parent().innerHeight(),n=s/n,n=Math.min(n,i/t),e.css("transform","scale("+n+")")},d.prototype.equipNewItems=function(e){var t,i,n,o=[];if(e.equip&&!e.equipped&&(e.equip(),o.push(e)),e.inventoryIDs)for(n in i=e.inventoryIDs)t=i[n],(t=this.world.getThangByID(t)).equipped||(t.equip||console.log(e.id,"equipping",t,"in",e.slot,"Surface-side, but it cannot equip?"),"function"==typeof t.equip&&t.equip(),t.equip&&o.push(t));return o},d.prototype.cacheObstacles=function(n){var e,o,s,t,i,r,a,l,c,h;if(null==n&&(n=null),(!this.cachedObstacles||n)&&(s=this.lankArray,c=function(){for(var e,t=[],i=0,n=s.length;i<n;i++)-1!==(null!=(e=(o=s[i]).thangType)?e.get("name").search(/(dungeon|indoor|ice|classroom|vr).wall/i):void 0)&&t.push(o);return t}(),!_.any(function(){for(var e=[],t=0,i=c.length;t<i;t++)r=c[t],e.push(r.stillLoading);return e}()))){for(h=function(){for(var e=[],t=0,i=c.length;t<i;t++)o=c[t],e.push(o.thang);return e}(),this.world.calculateBounds(),a=new u(h,this.world.width,this.world.height),e=0,t=(i=n?function(){for(var e=[],t=0,i=c.length;t<i;t++)o=c[t],_.find(n,function(e){return o===e||Math.abs(o.thang.pos.x-e.thang.pos.x)+Math.abs(o.thang.pos.y-e.thang.pos.y)<=16})&&e.push(o);return e}():c).length;e<t;e++)(l=i[e]).currentRootAction||l.queueAction("idle"),l.lockAction(!1),l.updateActionDirection(a),l.lockAction(!0),l.updateScale(),l.updatePosition();return this.cachedObstacles=!0}},d.prototype.lankFor=function(e){return this.lanks[e]},d.prototype.onNewWorld=function(e){if(this.world=this.options.world=e.world,e.finished&&/(kithgard-mastery|dungeon-raider)/.test(window.location.href))return this.cachedObstacles=!1},d.prototype.play=function(){for(var e,t=this.lankArray,i=0,n=t.length;i<n;i++)t[i].play();return null!=(e=this.selectionMark)&&e.play(),null!=(e=this.targetMark)?e.play():void 0},d.prototype.stop=function(){for(var e,t=this.lankArray,i=0,n=t.length;i<n;i++)t[i].stop();return null!=(e=this.selectionMark)&&e.stop(),null!=(e=this.targetMark)?e.stop():void 0},d.prototype.onSuppressSelectionSounds=function(e){return this.suppressSelectionSounds=e.suppress},d.prototype.onSetLockSelect=function(e){return this.selectLocked=e.lock},d.prototype.onLevelRestarted=function(e){return this.selectLocked=!1,this.selectLank(e,null)},d.prototype.onSelectSprite=function(e){return this.selectThang(e.thangID,e.spellName)},d.prototype.onCameraDragged=function(){return this.dragged+=1},d.prototype.onLankMouseUp=function(e){var t,i;if(this.handleEvents&&!key.shift)return 3<this.dragged?this.dragged=0:(this.dragged=0,i=null!=(t=e.sprite)&&(null!=(i=t.thang)&&i.isSelectable)?e.sprite:null,this.flagCursorLank&&"Flag"===(null!=i?i.thangType.get("name"):void 0)?void 0:this.selectLank(e,i))},d.prototype.onChangeSelected=function(o,s){for(var e,t,i,n,r,a,l=function(){for(var e=o.previousAttributes().selected||[],t=[],i=0,n=e.length;i<n;i++)a=e[i],t.push(a.sprite);return t}(),c=function(){for(var e=s||[],t=[],i=0,n=e.length;i<n;i++)a=e[i],t.push(a.sprite);return t}(),h=_.difference(c,l),u=_.difference(l,c),p=0,d=h.length;p<d;p++)n=(t=h[p]).sprite.parent!==this.layerAdapters.Default.container?this.layerAdapters.Default:this.layerAdapters.Ground,(n=new m({name:"selection",camera:this.camera,layer:n,thangType:"selection"})).toggle(!0),n.setLank(t),n.update(),t.marks.selection=n;for(r=[],e=0,i=u.length;e<i;e++)t=u[e],r.push("function"==typeof t.removeMark?t.removeMark("selection"):void 0);return r},d.prototype.selectThang=function(e,t,i){return null==t&&(t=null),null==i&&(i=null),this.lanks[e]?this.selectLank(null,this.lanks[e],t,i):this.willSelectThang=[e,t]},d.prototype.selectLank=function(e,t,i,n){var o,s,r,a,l;if(null==t&&(t=null),null==i&&(i=null),null==n&&(n=null),!e||!this.disabled&&!this.selectLocked)return l=null!=t&&null!=(l=t.thang)?l.pos:void 0,null!=e&&e.originalEvent&&null==l&&(l=this.camera.screenToWorld({x:e.originalEvent.rawX,y:e.originalEvent.rawY})),this.handleEvents&&(this.reallyStopMoving||!l||!this.options.navigateToSelection&&t&&!n||3===(null!=e&&null!=(s=e.originalEvent)&&null!=(r=s.nativeEvent)?r.which:void 0)||this.camera.zoomTo((null!=t?t.sprite:void 0)||this.camera.worldToSurface(l),this.camera.zoom,1e3,!0)),(t=this.options.choosing?null:t)!==this.selectedLank&&(null!=(a=this.selectedLank)&&(a.selected=!1),null!=t&&(t.selected=!0),this.selectedLank=t),a=t&&!(t.thang.health<0),Backbone.Mediator.publish("surface:sprite-selected",{thang:t?t.thang:null,sprite:t,spellName:null!=i?i:null!=e?e.spellName:void 0,originalEvent:e,worldPos:l}),t&&(this.willSelectThang=null),a&&!this.suppressSelectionSounds&&"playSucceeded"===(null!=(o=t.playSound("selected"))?o.playState:void 0)?(Backbone.Mediator.publish("sprite:thang-began-talking",{thang:null!=t?t.thang:void 0}),o.addEventListener("complete",function(){return Backbone.Mediator.publish("sprite:thang-finished-talking",{thang:null!=t?t.thang:void 0})})):void 0},d.prototype.onFlagColorSelected=function(e){var t,i,n,o;for(this.flagCursorLank&&this.removeLank(this.flagCursorLank),this.flagCursorLank=null,i=0,n=(o=this.lankArray).length;i<n;i++)"Flag"===(t=o[i]).thangType.get("name")&&(t.sprite.cursor=e.color?"crosshair":"pointer");if(e.color)return this.flagCursorLank=new s(this.thangTypeFor("Flag"),this.createLankOptions({thangID:"Flag Cursor",color:e.color,team:l.team,isCursor:!0,pos:e.pos})),this.addLank(this.flagCursorLank,this.flagCursorLank.thang.id,this.layerAdapters.Floating)},d.prototype.onFlagUpdated=function(e){if(e.active)return e=new s(this.thangTypeFor("Flag"),this.createLankOptions({thangID:"Pending Flag "+Math.random(),color:e.color,team:e.team,isCursor:!1,pos:e.pos})),this.addLank(e,e.thang.id,this.layerAdapters.Floating),this.pendingFlags.push(e)},d.prototype.onFlagAppeared=function(e){for(var t,i,n,o,s=e.sprite.thang,r=(null!=(n=this.pendingFlags)?n:[]).slice(),a=!1,l=t=r.length-1;0<=t;l=t+=-1)o=(i=r[l]).thang,s.color===o.color&&s.team===o.team&&(a||Math.abs(s.pos.x-o.pos.x)<1e-5&&Math.abs(s.pos.y-o.pos.y)<1e-5)&&(a=!0,this.pendingFlags.splice(l,1),this.removeLank(i));return null!=(e=e.sprite.sprite)&&(e.cursor=this.flagCursorLank?"crosshair":"pointer"),null},d.prototype.onRemoveSelectedFlag=function(t){var e=_.find([this.selectedLank].concat(this.lankArray),function(e){return e&&"Flag"===e.thangType.get("name")&&e.thang.team===l.team&&(e.thang.color===t.color||!t.color)&&!e.notOfThisWorld});if(e)return Backbone.Mediator.publish("surface:remove-flag",{color:e.thang.color})},d.prototype.updateSelection=function(){var e,t;if(null==(e=this.selectedLank)||!e.thang||this.selectedLank.thang.exists&&this.world.getThangByID(this.selectedLank.thang.id)||(t=this.selectedLank.thang.id,(this.selectedLank=null)!=(e=this.selectionMark)&&e.toggle(!1),this.willSelectThang=[t,null]),this.updateTarget(),this.selectionMark)return!this.selectedLank||!this.selectedLank.destroyed&&this.selectedLank.thang||(this.selectedLank=null),this.selectedLank&&this.selectedLank.sprite.parent!==this.layerAdapters.Default.container?this.selectionMark.setLayer(this.layerAdapters.Default):this.selectedLank&&this.selectionMark.setLayer(this.layerAdapters.Ground),this.selectionMark.toggle(null!=this.selectedLank),this.selectionMark.setLank(this.selectedLank),this.selectionMark.update()},d.prototype.updateTarget=function(){var e,t;if(this.targetMark)return e=null!=(t=null!=(e=this.selectedLank)?e.thang:void 0)?t.target:void 0,null!=(t=null!=t?t.targetPos:void 0)&&("function"==typeof t.isZero&&t.isZero())&&(t=null),this.targetMark.setLank(e?this.lanks[e.id]:null),this.targetMark.toggle(this.targetMark.lank||t),this.targetMark.update(t?this.camera.worldToSurface(t):null)},d)}.call(this,i(3))},1552:function(r,e,a){!function(i){var e,n,t,o={}.hasOwnProperty;function s(){return s.__super__.constructor.apply(this,arguments)}a(1633),e=a(80),t=a(1635),n=a(32),r.exports=(function(e,t){for(var i in t)o.call(t,i)&&(e[i]=t[i]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(s,e),s.prototype.id="share-progress-modal",s.prototype.template=t,s.prototype.plain=!0,s.prototype.closesOnClickOutside=!1,s.prototype.events={"click .close-btn":"hide","click .continue-link":"hide","click .send-btn":"onClickSend"},s.prototype.onClickSend=function(e){var t=i(".email-input").val();return/[\w\.]+@\w+\.\w+/.test(t)?(this.supermodel.addRequestResource("send_one_time_email",{url:"/db/user/-/send_one_time_email",data:{email:t,type:"share progress modal parent"},method:"POST"},0).load(),n.save("sent-parent-email",!0),this.hide()):(i(".email-input").parent().addClass("has-error"),i(".email-invalid").show(),!1)},s)}.call(this,a(3))},1553:function(n,e,s){!function(d){var e,m,t,f,o={}.hasOwnProperty;function i(e){i.__super__.constructor.call(this,e),this.poll=e.poll,this.userPollsRecord=e.userPollsRecord,this.previousAnswer=(null!=(e=this.userPollsRecord.get("polls"))?e:{})[this.poll.id],this.previousReward=(null!=(e=this.userPollsRecord.get("rewards"))?e:{})[this.poll.id]}s(1636),e=s(80),t=s(1638),f=s(6),s(1395),n.exports=(function(e,t){for(var i in t)o.call(t,i)&&(e[i]=t[i]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(i,e),i.prototype.id="poll-modal",i.prototype.template=t,i.prototype.subscriptions={},i.prototype.events={"click #close-modal":"hide","click .answer:not(.selected)":"onClickAnswer"},i.prototype.getRenderData=function(e){return(e=i.__super__.getRenderData.call(this,e)).poll=this.poll,e.i18n=f.i18n,e.marked=marked,e},i.prototype.afterRender=function(){return i.__super__.afterRender.call(this),this.playSound("game-menu-open"),this.updateAnswers()},i.prototype.onHidden=function(){return i.__super__.onHidden.call(this),this.playSound("game-menu-close")},i.prototype.updateAnswers=function(e){var t,i,n,o,s,r,a,l,c,h,u,p,d,m,f=(null!=(l=this.userPollsRecord.get("polls"))?l:{})[this.poll.id];if(e=null!=f,this.$el.find("table, .random-gems-container-wrapper").toggleClass("answered",e),e){for(this.awardRandomGems(),a=(e=[0,0])[0],u=e[1],n=0,s=(c=this.poll.get("answers")||[]).length;n<s;n++)d=(i=c[n]).votes||0,i.key===this.previousAnswer&&--d,i.key===f&&++d,u+=i.votes=d,a=Math.max(a,d||0);for(this.previousAnswer=f,this.poll.set("answers",this.poll.get("answers")),o=0,r=(h=this.poll.get("answers")).length;o<r;o++)i=h[o],(t=this.$el.find(".answer[data-answer='"+i.key+"']")).toggleClass("selected",i.key===f),d=i.votes||0,m=100*(d=!u?a=u=1:d)/a+"%",p=Math.round(100*d/u)+"%",t.find(".progress-bar").css("width","0%").animate({width:m},"slow"),t.find(".vote-percentage").text(p),me.isAdmin()&&t.find(".vote-count").text(d);return this.trigger("vote-updated")}},i.prototype.onClickAnswer=function(e){var o,t=d(e.target).closest(".answer"),e=null!=(e=this.userPollsRecord.get("polls"))?e:{};return e[this.poll.id]=t.data("answer").toString(),this.userPollsRecord.set("polls",e),this.updateAnswers(!0),this.userPollsRecord.save({polls:e},{success:(o=this,function(){var e,t,i,n;return"function"==typeof o.awardRandomGems&&o.awardRandomGems(),t=(null!=(n=o.userPollsRecord.get("polls"))?n:{})[o.poll.id],n=_.find(o.poll.get("answers"),function(e){return e.key===t})||{},i=n.nextPoll,(e=o.$el.find(".btn.btn-illustrated.btn-lg.done-button")).off("click"),i?(e.text(i18n.t("common.next")),e.one("click",function(){return e.prop("disabled",!0),"5e84c7a519cb270028516687"===o.poll.id?o.trigger("trigger-show-live-classes"):o.trigger("trigger-next-poll",i)})):(e.text(i18n.t("play_level.done")),e.one("click",function(){if("5f21e48ec22bdf002922cd8c"===o.poll.id)return e.prop("disabled",!0),o.trigger("trigger-codequest-modal")}))})})},i.prototype.awardRandomGems=function(){var i,e,n,t,o,s,r,a,l,c,h,u,p;if(c=(null!=(l=this.userPollsRecord.get("rewards"))?l:{})[this.poll.id]){if(this.$randomNumber=this.$el.find("#random-number-comment").empty(),this.$randomGems=this.$el.find("#random-gems-comment").hide(),this.$totalGems=this.$el.find("#total-gems-comment").hide(),i=m[null!=(l=null!=(l=me.get("aceConfig"))?l.language:void 0)?l:"python"],a=c.random,r=Math.ceil(2*a*c.level),h=this.previousReward?me.gems():Math.round(me.gems()+r),s=this.playSound,this.previousReward)return f.replaceText(this.$randomNumber.show(),i+a.toFixed(7)),f.replaceText(this.$randomGems.show(),i+r),f.replaceText(this.$totalGems.show(),i+h);for(p=this,e=function(t){return p.$randomNumber.queue(function(){var e=1e3===t?a:Math.random();if(f.replaceText(d(this),i+e.toFixed(7)),d(this).dequeue(),Math.random()<r/40)return e="gem-"+n%4,++n,s(e,.475+t/2e3)}),p.$randomNumber.delay(25)},t=o=n=0;o<=1e3;t=o+=25)e(t);return this.$randomGems.delay(1100).queue(function(){return f.replaceText(d(this),i+r),d(this).show(),d(this).dequeue()}),this.$totalGems.delay(1200).queue(function(){return f.replaceText(d(this),i+h),d(this).show(),d(this).dequeue()}),this.previousReward=c,_.delay((u=this,function(){var e;if(!u.destroyed)return null==(e=null!=(e=me.get("earned"))?e:{}).gems&&(e.gems=0),e.gems+=r,me.set("earned",e),me.trigger("change:earned",me,e)}),1200)}},i),m={javascript:"// ",python:"# ",coffeescript:"# ",lua:"-- ",java:"// ",cpp:"// "}}.call(this,s(3))},1554:function(k,e,x){!function(a,o){var t,i,n,s,r,e,h,l,c,u,p,d,m,f,g,y,v={}.hasOwnProperty,b=[].indexOf||function(e){for(var t=0,i=this.length;t<i;t++)if(t in this&&this[t]===e)return t;return-1};function w(e){this.showVisibleItemImages=_.throttle(_.bind(this.showVisibleItemImages,this),200),w.__super__.constructor.call(this,e),this.items=new Backbone.Collection,this.itemCategoryCollections={},(e=new i([],{url:"/db/thang.type?view=items",project:["name","components.config","components.original","slug","original","rasterIcon","gems","tier","description","i18n","heroClass","subscriber"],model:u})).skip=0,e.fetch({data:{skip:0,limit:h}}),this.listenTo(e,"sync",this.onItemsFetched),this.stopListening(this.supermodel,"loaded-all"),this.supermodel.loadCollection(e,"items"),this.idToItem={},this.trackTimeVisible()}x(1498),e=x(80),g=x(1655),p=x(1461),d=x(1462),f=x(1463),s=x(1499),t=x(1437),n=x(118),c=x(622),i=x(115),u=x(1374),x(619),r=x(267),l=x(1388),y=x(6),h=200,m={"right-hand":"primary","left-hand":"secondary",head:"armor",torso:"armor",gloves:"armor",feet:"armor",eyes:"accessories",neck:"accessories",wrists:"accessories","left-ring":"accessories","right-ring":"accessories",waist:"accessories",pet:"misc",minion:"misc",flag:"misc","misc-0":"misc","misc-1":"misc","programming-book":"books"},k.exports=(function(e,t){for(var i in t)v.call(t,i)&&(e[i]=t[i]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(w,e),w.prototype.className="modal fade play-modal",w.prototype.template=g,w.prototype.id="play-items-modal",w.prototype.events={"click .item":"onItemClicked","shown.bs.tab":"onTabClicked","click .unlock-button":"onUnlockButtonClicked","click .subscribe-button":"onSubscribeButtonClicked","click .start-subscription-button":"onSubscribeButtonClicked","click .buy-gems-prompt-button":"onBuyGemsPromptButtonClicked","click #close-modal":"hide",click:"onClickedSomewhere","update .tab-pane .nano":"showVisibleItemImages","click #hero-type-select label":"onClickHeroTypeSelect"},w.prototype.onItemsFetched=function(e){for(var t,i,n,o,s=me.gems(),r=e.models.length===h,a=e.models,l=0,c=a.length;l<c;l++)(o=a[l]).owned=me.ownsItem(o.get("original")),((n=o.get("gems"))||o.owned)&&(i=m[o.getAllowedSlots()[0]]||"misc",null==(t=this.itemCategoryCollections)[i]&&(t[i]=new Backbone.Collection),(i=this.itemCategoryCollections[i]).comparator=function(e){var t;return null!=(t=e.get("tier"))?t:e.get("gems")},i.add(o),o.name=y.i18n(o.attributes,"name"),o.affordable=n<=s,o.silhouetted=!o.owned&&o.isSilhouettedItem(),null!=o.get("tier")&&(o.level=o.levelRequiredForItem()),o.unequippable=!_.intersection(me.getHeroClasses(),o.getAllowedHeroClasses()).length,o.comingSoon=!o.getFrontFacingStats().props.length&&!_.size(o.getFrontFacingStats().stats)&&!o.owned,this.idToItem[o.id]=o);if(0!==e.skip&&this.render(),r)return e.skip+=h,e.fetch({data:{skip:e.skip,limit:h}})},w.prototype.getRenderData=function(o){var s;return null==o&&(o={}),(o=w.__super__.getRenderData.call(this,o)).itemCategoryCollections=this.itemCategoryCollections,o.itemCategories=_.keys(this.itemCategoryCollections),o.itemCategoryNames=function(){for(var e=o.itemCategories,t=[],i=0,n=e.length;i<n;i++)s=e[i],t.push(a.i18n.t("items."+s));return t}(),o.gems=me.gems(),o},w.prototype.afterRender=function(){var e,t;if(w.__super__.afterRender.call(this),this.supermodel.finished())return this.playSound("game-menu-open"),this.$el.find(".nano:visible").nanoScroller({alwaysVisible:!0}),this.itemDetailsView=new s,this.insertSubView(this.itemDetailsView),this.$el.find("a[href='#item-category-armor']").click(),e=(null!=(t=me.get("earned"))?t.levels:void 0)||[],t=r.levels["defense-of-plainswood"],b.call(e,t)<0&&(this.$el.find("#misc-tab").hide(),this.$el.find("#hero-type-select #warrior").click()),this.showVisibleItemImages()},w.prototype.onHidden=function(){return w.__super__.onHidden.call(this),this.playSound("game-menu-close")},w.prototype.onItemClicked=function(e){var t,i;if(!a(e.target).closest(".unlock-button").length&&!this.destroyed)return this.playSound("menu-button-click"),e=(i=a(e.target).closest(".item")).hasClass("selected"),this.$el.find(".item.selected").removeClass("selected"),e||(t=this.idToItem[i.data("item-id")]).silhouetted&&!t.owned?t=null:e||i.addClass("selected"),this.itemDetailsView.setItem(t),this.updateViewVisibleTimer()},w.prototype.currentVisiblePremiumFeature=function(){var e,t=null!=(t=this.itemDetailsView)?t.item:void 0;return 0<=b.call((null!=t?t.getAllowedSlots():void 0)||[],"pet")||"Ranger"===(e=null!=t?t.get("heroClass"):void 0)||"Wizard"===e?{viewName:this.id,featureName:"view-item",premiumThang:{_id:t.id,slug:t.get("slug"),heroClass:t.get("heroClass"),slots:t.getAllowedSlots()}}:this.$el.find(".tab-content").hasClass("filter-wizard")?{viewName:this.id,featureName:"filter-wizard"}:this.$el.find(".tab-content").hasClass("filter-ranger")?{viewName:this.id,featureName:"filter-ranger"}:null},w.prototype.onTabClicked=function(e){return this.playSound("game-menu-tab-switch"),(e=a(a(e.target).attr("href")).find(".nano")).nanoScroller({alwaysVisible:!0}),this.paneNanoContent=e.find(".nano-content"),this.showVisibleItemImages()},w.prototype.showVisibleItemImages=function(){var e,t,i,n,o,s,r;if(!this.paneNanoContent)return console.error("Couldn't update scroll, since paneNanoContent wasn't initialized.");for(n=this.paneNanoContent.find(".item:not(.loaded)"),r=this.paneNanoContent.height()+100,s=[],e=0,o=n.length;e<o;e++)i=n[e],(i=a(i)).position().top<r?(a(i).addClass("loaded"),t=this.idToItem[i.data("item-id")],s.push(i.find(".item-silhouette, .item-img").attr("src",t.getPortraitURL()))):s.push(void 0);return s},w.prototype.onClickHeroTypeSelect=function(e){var t=a(e.target).closest("label").attr("id"),e=this.$el.find(".tab-content");return e.removeClass("filter-wizard filter-ranger filter-warrior"),"all"!==t&&e.addClass("filter-"+t),this.updateViewVisibleTimer()},w.prototype.onUnlockButtonClicked=function(e){var t,i,n;return e.stopPropagation(),t=a(e.target).closest("button"),i=this.idToItem[t.data("item-id")],n=me.gems(),(null!=(e=i.get("gems"))?e:0)<=n?t.hasClass("confirm")?(this.playSound("menu-button-unlock-end"),l.makeFor(i).save(),null==(n=null!=(n=me.get("purchased"))?n:{}).items&&(n.items=[]),n.items.push(i.get("original")),i.owned=!0,me.set("purchased",n),me.set("spent",(null!=(n=me.get("spent"))?n:0)+i.get("gems")),this.renderSelectors(".item[data-item-id='"+i.id+"']","#gems-count"),console.log("render selectors",".item[data-item-id='"+i.id+"']","#gems-count"),this.itemDetailsView.render(),this.showVisibleItemImages(),Backbone.Mediator.publish("store:item-purchased",{item:i,itemSlug:i.get("slug")})):(this.playSound("menu-button-unlock-start"),t.addClass("confirm").text(a.i18n.t("play.confirm")),this.$el.one("click",function(e){if(e.target!==t[0])return t.removeClass("confirm").text(a.i18n.t("play.unlock"))})):(this.playSound("menu-button-click"),me.freeOnly()||o.getHocCampaign()?void 0:this.askToBuyGemsOrSubscribe(t))},w.prototype.onSubscribeButtonClicked=function(e){return this.openModalView(new c)},w.prototype.askToSignUp=function(){var e=new n({supermodel:this.supermodel});return this.openModalView(e)},w.prototype.askToBuyGemsOrSubscribe=function(e){var t,i;return this.$el.find(".unlock-button").popover("destroy"),t=(me.canBuyGems()?p:me.hasSubscription()?d:f)({}),e.popover({animation:!0,trigger:"manual",placement:"top",content:" ",container:this.$el,template:t}).popover("show"),null!=(e=e.data("bs.popover"))&&null!=(i=e.$tip)&&i.i18n(),this.applyRTLIfNeeded()},w.prototype.onBuyGemsPromptButtonClicked=function(e){return this.playSound("menu-button-click"),me.get("anonymous")?this.askToSignUp():this.openModalView(new t)},w.prototype.onClickedSomewhere=function(e){if(!this.destroyed)return this.$el.find(".unlock-button").popover("destroy")},w.prototype.destroy=function(){return this.$el.find(".unlock-button").popover("destroy"),w.__super__.destroy.call(this)},w)}.call(this,x(3),x(17))},1555:function(e,t,i){var n,o={}.hasOwnProperty;function s(){return s.__super__.constructor.apply(this,arguments)}i(1664),n=i(80),i=i(1666),e.exports=(function(e,t){for(var i in t)o.call(t,i)&&(e[i]=t[i]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(s,n),s.prototype.template=i,s.prototype.id="amazon-hoc-modal",s.prototype.events={"click #close-modal":"hide","mouseup #aws-educate-link":"onClickAwsEducateLink","mouseup #aws-alexa-link":"onClickAwsAlexaLink","mouseup #aws-future-eng-link":"onClickAwsFutureEngLink"},s.prototype.onClickAwsEducateLink=function(){var e;return null!=(e=window.tracker)?e.trackEvent("Click Amazon link",{label:"aws-educate-link"}):void 0},s.prototype.onClickAwsAlexaLink=function(){var e;return null!=(e=window.tracker)?e.trackEvent("Click Amazon link",{label:"aws-alexa-link"}):void 0},s.prototype.onClickAwsFutureEngLink=function(){var e;return null!=(e=window.tracker)?e.trackEvent("Click Amazon link",{label:"aws-future-eng-link"}):void 0},s)},1556:function(e,t,i){var n,o,s={}.hasOwnProperty;function r(e){r.__super__.constructor.call(this,e),this.propsData.courseInstanceID=(null!=e?e.courseInstanceID:void 0)||null,this.propsData.courseID=(null!=e?e.courseID:void 0)||null}o=i(636),n=i(1557).default,e.exports=(function(e,t){for(var i in t)s.call(t,i)&&(e[i]=t[i]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(r,o),r.prototype.id="course-videos-modal",r.prototype.template=i(1502),r.prototype.VueComponent=n,r.prototype.propsData=null,r.prototype.initialize=function(){return this.propsData={courseInstanceID:null,courseID:null}},r.prototype.destroy=function(){return"function"==typeof this.onDestroy&&this.onDestroy(),r.__super__.destroy.call(this)},r)},1557:function(e,t,i){"use strict";i.r(t);var n,o=i(1727),s=i(1467);for(n in s)["default"].indexOf(n)<0&&function(e){i.d(t,e,function(){return s[e]})}(n);i(1675);var r=i(19),o=Object(r.a)(s.default,o.a,o.b,!1,null,"8fdaa622",null);t.default=o.exports},1586:function(e,t,i){var n,d,o={}.hasOwnProperty,r=[].indexOf||function(e){for(var t=0,i=this.length;t<i;t++)if(t in this&&this[t]===e)return t;return-1};function s(e,t){this.camera=e,this.layerAdapter=t,s.__super__.constructor.call(this),this.tweenedSprites=[],this.tweens=[],this.listenTo(this.layerAdapter,"new-spritesheet",function(){return this.generatePaths(this.world,this.thang)})}i(1407),n=i(45),d=i(1373),e.exports=(function(e,t){for(var i in t)o.call(t,i)&&(e[i]=t[i]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(s,n),s.prototype.world=null,s.prototype.generatePaths=function(e,t){if(this.world=e,this.thang=t,!this.generatingPaths)return this.generatingPaths=!0,this.cleanUp(),this.createGraphics(),(t=new d.Container(this.layerAdapter.spriteSheet)).mouseEnabled=t.mouseChildren=!1,t.addChild(this.createFuturePath()),t.addChild(this.createTargets()),this.generatingPaths=!1,t},s.prototype.cleanUp=function(){for(var e,t=this.tweenedSprites,i=0,n=t.length;i<n;i++)e=t[i],d.Tween.removeTweens(e);return this.tweenedSprites=[],this.tweens=[]},s.prototype.createGraphics=function(){return this.targetDotKey=this.cachePathDot(10,this.colorForThang(this.thang.team,1),[0,0,0,1]),this.pastDotKey=this.cachePathDot(5,this.colorForThang(this.thang.team,.75),[0,0,0,1]),this.futureDotKey=this.cachePathDot(4,[255,255,255,.75],this.colorForThang(this.thang.team,1))},s.prototype.cachePathDot=function(e,t,i){var n,o,s="path-dot-"+e+"-"+t+"-"+i;return t=(n=d.Graphics).getRGB.apply(n,t),i=(o=d.Graphics).getRGB.apply(o,i),r.call(this.layerAdapter.spriteSheet.animations,s)<0&&(n=e/2,(o=new d.Shape).graphics.setStrokeStyle(e/5).beginFill(t).beginStroke(i).drawCircle(0,0,n),this.layerAdapter.addCustomGraphic(s,o,[1.5*-n,1.5*-n,3*n,3*n])),s},s.prototype.colorForThang=function(e,t){var i="humans"===e?[255,0,0]:[0,255,0];return(i="ogres"===e?[0,0,255]:i).push(t=null==t?1:t),i},s.prototype.createPastPath=function(){var e,t;if(t=this.world.pointsForThang(this.thang.id,this.camera))return e={interval:Math.max(1,parseInt(this.world.frameRate/2)),frameKey:this.pastDotKey},this.createPath(t,e)},s.prototype.createFuturePath=function(){var e,t;if(t=this.world.pointsForThang(this.thang.id,this.camera))return e={interval:Math.max(1,parseInt(this.world.frameRate/4)),animate:!0,frameKey:this.futureDotKey},this.createPath(t,e)},s.prototype.createTargets=function(){var e,t,i,n,o,s,r;if(this.thang.allTargets){for(e=new d.Container(this.layerAdapter.spriteSheet),t=i=0,n=(o=this.thang.allTargets).length;i<n;t=i+=2)s=o[t],r=this.thang.allTargets[t+1],s=this.camera.worldToSurface({x:s,y:r}),(r=new d.Sprite(this.layerAdapter.spriteSheet)).scaleX=r.scaleY=1/this.layerAdapter.resolutionFactor,r.scaleY*=this.camera.y2x,r.gotoAndStop(this.targetDotKey),r.x=s.x,r.y=s.y,e.addChild(r);return e}},s.prototype.createPath=function(e,t){var i,n,o,s,r,a,l,c,h=(t=(t=null==t?{}:t)||{}).interval||8,u=t.frameKey||this.pastDotKey,p=new d.Container(this.layerAdapter.spriteSheet);for(0<(r=2*h)?(i=n=0,s=e.length):i=n=e.length-1;0<r?n<s:0<=n;i=n+=r)l=e[i],c=e[i+1],(a=new d.Sprite(this.layerAdapter.spriteSheet)).scaleX=a.scaleY=1/this.layerAdapter.resolutionFactor,a.scaleY*=this.camera.y2x,a.gotoAndStop(u),a.x=l,a.y=c,p.addChild(a),o&&t.animate&&(c=d.Tween.get(o,{loop:!0}).to({x:l,y:c},1e3),this.tweenedSprites.push(o),this.tweens.push(c)),o=a;return this.logged=!0,p},s.prototype.play=function(){for(var e,t=this.tweens,i=[],n=0,o=t.length;n<o;n++)e=t[n],i.push(e.paused=!1);return i},s.prototype.stop=function(){for(var e,t=this.tweens,i=[],n=0,o=t.length;n<o;n++)e=t[n],i.push(e.paused=!0);return i},s.prototype.destroy=function(){return this.cleanUp(),s.__super__.destroy.call(this)},s)},1587:function(e,t,i){var n;function o(){var t;this.listener=(t=this,function(e){return t.tick(e)})}n=i(1373),o.prototype.lostFrames=0,o.prototype.dropCounter=0,o.prototype.tick=function(){var e,t;if(this.tickedOnce)return 0<this.dropCounter&&--this.dropCounter,t=n.Ticker.framerate,e=n.Ticker.getMeasuredFPS(1),this.lostFrames+=(t-e)/t,this.dropCounter+=parseInt(this.lostFrames),this.lostFrames=this.lostFrames%1;this.tickedOnce=!0},o.prototype.drop=function(){return 0<this.dropCounter},e.exports=new o},1588:function(e,t,i){var n,o={}.hasOwnProperty;function s(e){var t,i,n;for(t in s.__super__.constructor.call(this),this.initialize(),this.mouseEnabled=this.mouseChildren=!1,this.updateBounds(e.bounds),n=this.subscriptions)i=n[t],Backbone.Mediator.subscribe(t,this[i],this)}n=i(1373),e.exports=(function(e,t){for(var i in t)o.call(t,i)&&(e[i]=t[i]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(s,n.Container),s.prototype.layerPriority=100,s.prototype.subscriptions={},s.prototype.destroy=function(){var e,t,i=this.subscriptions,n=[];for(e in i)t=i[e],n.push(Backbone.Mediator.unsubscribe(e,this[t],this));return n},s.prototype.updateBounds=function(e){var t,i;if(!_.isEqual(e,this.bounds)&&(this.bounds=e,this.border&&(this.removeChild(this.border),this.border=null),this.bounds)){for(this.addChild(this.border=new n.Shape),t=20;t;)i=3*(1-t/20)/20,this.border.graphics.setStrokeStyle(t,"round").beginStroke("rgba(0,0,0,"+i+")").drawRect(e.x,e.y,e.width,e.height),--t;return this.border.cache(e.x,e.y,e.width,e.height)}},s)},1589:function(e,t,i){var o,s={}.hasOwnProperty;function r(e){var t,i,n;for(t in r.__super__.constructor.call(this),this.initialize(),this.canvasWidth=e.canvasWidth,this.canvasHeight=e.canvasHeight,this.canvasWidth&&this.canvasHeight||console.error("Letterbox needs canvasWidth/Height."),this.build(),n=this.subscriptions)i=n[t],Backbone.Mediator.subscribe(t,this[i],this)}o=i(1373),e.exports=(function(e,t){for(var i in t)s.call(t,i)&&(e[i]=t[i]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(r,o.Container),r.prototype.subscriptions={"level:set-letterbox":"onSetLetterbox"},r.prototype.build=function(){return this.mouseEnabled=this.mouseChildren=!1,this.matteHeight=.1*this.canvasHeight,this.upperMatte=new o.Shape,this.upperMatte.graphics.beginFill("black").rect(0,0,this.canvasWidth,this.matteHeight),this.lowerMatte=this.upperMatte.clone(),this.upperMatte.x=this.lowerMatte.x=0,this.upperMatte.y=-this.matteHeight,this.lowerMatte.y=this.canvasHeight,this.addChild(this.upperMatte,this.lowerMatte)},r.prototype.onSetLetterbox=function(e){var t,i,n=o.Tween;return n.removeTweens(this.upperMatte),n.removeTweens(this.lowerMatte),i=e.on?0:-this.matteHeight,t=e.on?this.canvasHeight-this.matteHeight:this.canvasHeight,e=o.Ease.cubicOut,n.get(this.upperMatte).to({y:i},700,e),n.get(this.lowerMatte).to({y:t},700,e)},r.prototype.destroy=function(){var e,t,i=this.subscriptions,n=[];for(e in i)t=i[e],n.push(Backbone.Mediator.unsubscribe(e,this[t],this));return n},r)},1590:function(e,t,i){var n,o,s=function(e,t){return function(){return e.apply(t,arguments)}},r={}.hasOwnProperty,a=[].indexOf||function(e){for(var t=0,i=this.length;t<i;t++)if(t in this&&this[t]===e)return t;return-1};function l(e){this.updateDimMask=s(this.updateDimMask,this),l.__super__.constructor.call(this),this.camera=(e=null==e?{}:e).camera,this.layer=e.layer,this.camera||console.error(this.toString(),"needs a camera."),this.layer||console.error(this.toString(),"needs a layer."),this.build(),this.updateDimMask=_.throttle(this.updateDimMask,10),this.highlightedThangIDs=[],this.sprites={}}n=i(45),o=i(1373),e.exports=(function(e,t){for(var i in t)r.call(t,i)&&(e[i]=t[i]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(l,n),l.prototype.subscriptions={"level:disable-controls":"onDisableControls","level:enable-controls":"onEnableControls","sprite:highlight-sprites":"onHighlightSprites","sprite:speech-updated":"onSpriteSpeechUpdated","surface:frame-changed":"onFrameChanged","camera:zoom-updated":"onZoomUpdated"},l.prototype.toString=function(){return"<Dimmer>"},l.prototype.build=function(){return this.dimLayer=new o.Container,this.dimLayer.mouseEnabled=this.dimLayer.mouseChildren=!1,this.dimLayer.addChild(this.dimScreen=new o.Shape),this.dimLayer.addChild(this.dimMask=new o.Shape),this.dimScreen.graphics.beginFill("rgba(0,0,0,0.5)").rect(0,0,this.camera.canvasWidth,this.camera.canvasHeight),this.dimMask.compositeOperation="destination-out",this.dimLayer.cache(0,0,this.camera.canvasWidth,this.camera.canvasHeight)},l.prototype.onDisableControls=function(e){if(!this.on&&(!e.controls||0<=a.call(e.controls,"surface")))return this.dim()},l.prototype.onEnableControls=function(e){if(this.on&&(!e.controls||0<=a.call(e.controls,"surface")))return this.undim()},l.prototype.onSpriteSpeechUpdated=function(e){if(this.on)return this.updateDimMask()},l.prototype.onFrameChanged=function(e){if(this.on)return this.updateDimMask()},l.prototype.onZoomUpdated=function(e){if(this.on)return this.updateDimMask()},l.prototype.onHighlightSprites=function(e){if(this.highlightedThangIDs=null!=(e=e.thangIDs)?e:[],this.on)return this.updateDimMask()},l.prototype.setSprites=function(e){this.sprites=e},l.prototype.dim=function(){var e,t;for(t in this.on=!0,this.layer.addChild(this.dimLayer),this.layer.updateLayerOrder(),e=this.sprites)e[t].setDimmed(!0);return this.updateDimMask()},l.prototype.undim=function(){var e,t,i,n;for(n in this.on=!1,this.layer.removeChild(this.dimLayer),t=[],e=this.sprites)i=e[n],t.push(i.setDimmed(!1));return t},l.prototype.updateDimMask=function(){var e,t,i,n;for(n in this.dimMask.graphics.clear(),e=this.sprites)t=e[n],(0<=a.call(this.highlightedThangIDs,n)||"function"==typeof t.isTalking&&t.isTalking())&&(i={x:t.sprite.x,y:t.sprite.y},t=this.camera.surfaceToCanvas(i),i=50*this.camera.zoom,this.dimMask.graphics.beginRadialGradientFill(["rgba(0,0,0,1)","rgba(0,0,0,0)"],[.5,1],t.x,t.y,0,t.x,t.y,i).drawCircle(t.x,t.y,i));return this.dimLayer.updateCache(0,0,this.camera.canvasWidth,this.camera.canvasHeight)},l)},1591:function(e,t,i){var n,o,s=function(e,t){return function(){return e.apply(t,arguments)}},r={}.hasOwnProperty;function a(e){this.decrementCountdown=s(this.decrementCountdown,this),a.__super__.constructor.call(this),this.camera=(e=null==e?{}:e).camera,this.layer=e.layer,this.showsCountdown=e.showsCountdown,this.camera||console.error(this.toString(),"needs a camera."),this.layer||console.error(this.toString(),"needs a layer."),this.build()}n=i(45),o=i(1373),e.exports=(function(e,t){for(var i in t)r.call(t,i)&&(e[i]=t[i]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(a,n),a.prototype.subscriptions={"playback:real-time-playback-started":"onRealTimePlaybackStarted","playback:real-time-playback-ended":"onRealTimePlaybackEnded"},a.prototype.destroy=function(){return this.countdownInterval&&clearInterval(this.countdownInterval),a.__super__.destroy.call(this)},a.prototype.onCastingBegins=function(e){if(!e.preload)return this.show()},a.prototype.onCastingEnds=function(e){return this.hide()},a.prototype.toString=function(){return"<CountdownScreen>"},a.prototype.build=function(){return this.dimLayer=new o.Container,this.dimLayer.mouseEnabled=this.dimLayer.mouseChildren=!1,this.dimLayer.addChild(this.dimScreen=new o.Shape),this.dimScreen.graphics.beginFill("rgba(0,0,0,0.5)").rect(0,0,this.camera.canvasWidth,this.camera.canvasHeight),this.dimLayer.alpha=0,this.dimLayer.addChild(this.makeCountdownText())},a.prototype.makeCountdownText=function(){var e=Math.ceil(this.camera.canvasHeight/2),e=new o.Text("3...",e+"px Open Sans Condensed","#F7B42C");return e.shadow=new o.Shadow("#000",Math.ceil(this.camera.canvasHeight/300),Math.ceil(this.camera.canvasHeight/300),Math.ceil(this.camera.canvasHeight/120)),e.textAlign="center",e.textBaseline="middle",e.x=this.camera.canvasWidth/2,e.y=this.camera.canvasHeight/2,this.text=e},a.prototype.show=function(){if(!this.showing)return o.Tween.removeTweens(this.dimLayer),this.showsCountdown?(this.dimLayer.alpha=0,this.showing=!0,o.Tween.get(this.dimLayer).to({alpha:1},500),this.secondsRemaining=3,this.countdownInterval=setInterval(this.decrementCountdown,1e3),this.updateText(),this.layer.addChild(this.dimLayer)):this.endCountdown()},a.prototype.hide=function(e){var t;if(null==e&&(e=500),this.showing)return this.showing=!1,o.Tween.removeTweens(this.dimLayer),o.Tween.get(this.dimLayer).to({alpha:0},e).call((t=this,function(){if(!t.destroyed)return t.layer.removeChild(t.dimLayer)}))},a.prototype.decrementCountdown=function(){if(!this.destroyed)return--this.secondsRemaining,this.updateText(),this.secondsRemaining?void 0:this.endCountdown()},a.prototype.updateText=function(){return this.text.text=this.secondsRemaining?this.secondsRemaining+"...":"0!"},a.prototype.endCountdown=function(){return console.log("should actually start in 1s"),this.countdownInterval&&clearInterval(this.countdownInterval),this.countdownInterval=null,this.hide()},a.prototype.onRealTimePlaybackStarted=function(e){return this.show()},a.prototype.onRealTimePlaybackEnded=function(e){return this.countdownInterval&&clearInterval(this.countdownInterval),this.countdownInterval=null,this.hide(Math.max(500,1e3*(this.secondsRemaining||0)))},a)},1592:function(n,e,s){!function(d){var e,t,o={}.hasOwnProperty,m=[].indexOf||function(e){for(var t=0,i=this.length;t<i;t++)if(t in this&&this[t]===e)return t;return-1};function i(e){i.__super__.constructor.call(this),this.camera=(e=null==e?{}:e).camera,this.layer=e.layer,this.playerNames=e.playerNames,this.camera||console.error(this.toString(),"needs a camera."),this.layer||console.error(this.toString(),"needs a layer."),this.build()}e=s(45),t=s(1373),n.exports=(function(e,t){for(var i in t)o.call(t,i)&&(e[i]=t[i]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(i,e),i.prototype.subscriptions={"goal-manager:new-goal-states":"onNewGoalStates"},i.prototype.toString=function(){return"<PlaybackOverScreen>"},i.prototype.build=function(){return this.dimLayer=new t.Container,this.dimLayer.mouseEnabled=this.dimLayer.mouseChildren=!1,this.dimLayer.addChild(this.dimScreen=new t.Shape),this.dimLayer.alpha=0,this.layer.addChild(this.dimLayer)},i.prototype.makeVictoryText=function(){var e=Math.ceil(this.camera.canvasHeight/6),e=new t.Text("",e+"px Open Sans Condensed","#F7B42C");return e.shadow=new t.Shadow("#000",Math.ceil(this.camera.canvasHeight/300),Math.ceil(this.camera.canvasHeight/300),Math.ceil(this.camera.canvasHeight/120)),e.textAlign="center",e.textBaseline="middle",e.x=.5*this.camera.canvasWidth,e.y=.75*this.camera.canvasHeight,this.dimLayer.addChild(e),this.text=e},i.prototype.show=function(){if(!this.showing)return this.showing=!0,this.color||this.updateColor("rgba(212, 212, 212, 0.4)"),this.dimLayer.alpha=0,t.Tween.removeTweens(this.dimLayer),t.Tween.get(this.dimLayer).to({alpha:1},500)},i.prototype.hide=function(){if(this.showing)return this.showing=!1,t.Tween.removeTweens(this.dimLayer),t.Tween.get(this.dimLayer).to({alpha:0},500)},i.prototype.onNewGoalStates=function(e){e.overallStatus;var t="failure"===e.overallStatus;e.timedOut;return this.updateColor(t?"rgba(255, 128, 128, 0.4)":"rgba(255, 255, 255, 0.4)"),this.updateText(e)},i.prototype.updateColor=function(e){if(e!==this.color)return this.dimScreen.graphics.clear().beginFill(e).rect(0,0,this.camera.canvasWidth,this.camera.canvasHeight),this.color?this.dimLayer.updateCache():this.dimLayer.cache(0,0,this.camera.canvasWidth,this.camera.canvasHeight),this.color=e},i.prototype.updateText=function(e){var o,n,s,t,i,r,a,l,c,h,u,p;if(_.size(this.playerNames)){for(p={},s=e.goalStates?_.values(e.goalStates):[],s=function(){for(var e=[],t=0,i=s.length;t<i;t++)(o=s[t]).optional||e.push(o);return e}(),t=0,i=(a=["humans","ogres"]).length;t<i;t++)h=a[t],u=function(){for(var e,t=[],i=0,n=s.length;i<n;i++)void 0!==(e=(o=s[i]).team)&&e!==h||t.push(o);return t}(),0<(c=function(){for(var e=[],t=0,i=u.length;t<i;t++)n=u[t],e.push(n.status);return e}()).length&&_.every(c,function(e){return"success"===e})&&(r="success"),0<c.length&&0<=m.call(c,"failure")&&(r="failure"),p[h]=r;return this.text||this.makeVictoryText(),"success"===p.humans?(this.text.color="#E62B1E",this.text.text=((null!=(l=this.playerNames.humans)?l:d.i18n.t("ladder.red_ai"))+" "+d.i18n.t("ladder.wins")).toLocaleUpperCase()):"success"===p.ogres?(this.text.color="#0597FF",this.text.text=((null!=(l=this.playerNames.ogres)?l:d.i18n.t("ladder.blue_ai"))+" "+d.i18n.t("ladder.wins")).toLocaleUpperCase()):(this.text.color="#F7B42C",e.timedOut?this.text.text="TIMED OUT":this.text.text="INCOMPLETE"),Math.ceil(this.camera.canvasHeight/6),e=Math.min(1,Math.max(.5,"PLAYERNAME WINS".length/this.text.text.length)),this.text.scaleX=this.text.scaleY=e,this.dimLayer.updateCache()}},i)}.call(this,s(3))},1593:function(e,t,i){var n,o={}.hasOwnProperty;function s(e){var t,i,n;for(t in s.__super__.constructor.call(this),this.initialize(),this.canvasWidth=e.canvasWidth,this.canvasHeight=e.canvasHeight,this.canvasWidth&&this.canvasHeight||console.error("DebugDisplay needs canvasWidth/Height."),this.build(),this.onSetDebug({debug:!0}),n=this.subscriptions)i=n[t],Backbone.Mediator.subscribe(t,this[i],this)}n=i(1373),e.exports=(function(e,t){for(var i in t)o.call(t,i)&&(e[i]=t[i]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(s,n.Container),s.prototype.layerPriority=20,s.prototype.subscriptions={"level:set-debug":"onSetDebug"},s.prototype.destroy=function(){var e,t,i=this.subscriptions,n=[];for(e in i)t=i[e],n.push(Backbone.Mediator.unsubscribe(e,this[t],this));return n},s.prototype.onSetDebug=function(e){if(e.debug!==this.on)return this.visible=this.on=e.debug,this.fps=null,this.framesRenderedThisSecond=0,this.lastFrameSecondStart=Date.now()},s.prototype.build=function(){return this.mouseEnabled=this.mouseChildren=!1,this.addChild(this.frameText=new n.Text("...","20px Arial","#FFF")),this.frameText.name="frame text",this.frameText.x=this.canvasWidth-50,this.frameText.y=this.canvasHeight-25,this.frameText.alpha=.5},s.prototype.updateFrame=function(e){var t,i;if(this.on)return++this.framesRenderedThisSecond,1<(t=((i=Date.now())-this.lastFrameSecondStart)/1e3)&&(this.fps=Math.round(this.framesRenderedThisSecond/t),this.lastFrameSecondStart=i,this.framesRenderedThisSecond=0),this.frameText.text=Math.round(e)+(null!=this.fps?" - "+this.fps+" fps":""),this.frameText.x=this.canvasWidth-this.frameText.getMeasuredWidth()-10},s)},1594:function(e,t,i){var n,o=function(e,t){return function(){return e.apply(t,arguments)}},s={}.hasOwnProperty;function r(e){var t,i,n;for(t in this.show=o(this.show,this),r.__super__.constructor.call(this),this.initialize(),this.camera=e.camera,this.layer=e.layer,this.camera||console.error(this.toString(),"needs a camera."),this.layer||console.error(this.toString(),"needs a layer."),this.build(),this.performShow=this.show,this.show=_.debounce(this.show,125),n=this.subscriptions)i=n[t],Backbone.Mediator.subscribe(t,this[i],this)}n=i(1373),e.exports=(function(e,t){for(var i in t)s.call(t,i)&&(e[i]=t[i]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(r,n.Container),r.prototype.layerPriority=-10,r.prototype.subscriptions={"surface:mouse-moved":"onMouseMove","surface:mouse-out":"onMouseOut","surface:mouse-over":"onMouseOver","surface:stage-mouse-down":"onMouseDown","camera:zoom-updated":"onZoomUpdated","level:flag-color-selected":"onFlagColorSelected"},r.prototype.destroy=function(){var e,t,i=this.subscriptions;for(e in i)t=i[e],Backbone.Mediator.unsubscribe(e,this[t],this);return this.show=null,this.destroyed=!0},r.prototype.toString=function(){return"<CoordinateDisplay>"},r.prototype.build=function(){return this.mouseEnabled=this.mouseChildren=!1,this.addChild(this.background=new n.Shape),this.addChild(this.label=new n.Text("","bold 16px Arial","#FFFFFF")),this.addChild(this.pointMarker=new n.Shape),this.label.name="Coordinate Display Text",this.label.shadow=new n.Shadow("#000000",1,1,0),this.background.name="Coordinate Display Background",this.pointMarker.name="Point Marker",this.layer.addChild(this)},r.prototype.onMouseOver=function(e){return this.mouseInBounds=!0},r.prototype.onMouseOut=function(e){return this.mouseInBounds=!1},r.prototype.onMouseMove=function(e){var t,i=this.camera.screenToWorld({x:e.x,y:e.y});if(key.alt?(i.x=Math.round(1e3*i.x)/1e3,i.y=Math.round(1e3*i.y)/1e3):(i.x=Math.round(i.x),i.y=Math.round(i.y)),i.x!==(null!=(t=this.lastPos)?t.x:void 0)||i.y!==(null!=(t=this.lastPos)?t.y:void 0))return this.lastPos=i,this.lastScreenPos={x:e.x,y:e.y},key.alt?this.performShow():(this.hide(),this.show())},r.prototype.onMouseDown=function(e){if(key.shift)return(e=this.camera.screenToWorld({x:e.x,y:e.y})).x=Math.round(e.x),e.y=Math.round(e.y),Backbone.Mediator.publish("tome:focus-editor",{}),Backbone.Mediator.publish("surface:coordinate-selected",e)},r.prototype.onZoomUpdated=function(e){var t;if(this.lastPos)return t=this.camera.screenToWorld(this.lastScreenPos),this.lastPos.x=Math.round(t.x),this.lastPos.y=Math.round(t.y),this.label.parent?this.performShow():void 0},r.prototype.onFlagColorSelected=function(e){return this.placingFlag=Boolean(e.color)},r.prototype.hide=function(){if(this.label.parent)return this.removeChild(this.label),this.removeChild(this.background),this.removeChild(this.pointMarker),this.uncache()},r.prototype.updateSize=function(){var e,t,i=this.label.getMeasuredWidth()+6,n=this.label.getMeasuredHeight()+6;return this.pointMarker.regY=n,e=i+(t=(t=(t=[]).concat(this.updateCoordinates(i,n,9))).concat(this.updatePointMarker(0,n,8,2))).reduce(function(e,t){return e+t}),i=n+t.reduce(function(e,t){return e+t}),t=this.isNearTopEdge()?{startPos:-9,posShift:4-n}:{startPos:9-i,posShift:n},n=this.isNearRightEdge()?{startPos:9-e,posShift:e}:{startPos:-9,posShift:0},this.orient(t,n,i,e)},r.prototype.isNearTopEdge=function(){return.9<1-(this.camera.worldViewport.y-this.lastPos.y)/this.camera.worldViewport.height},r.prototype.isNearRightEdge=function(){return.85<(this.lastPos.x-this.camera.worldViewport.x)/this.camera.worldViewport.width},r.prototype.orient=function(e,t,i,n){return this.label.regY=this.background.regY=e.posShift,this.label.regX=this.background.regX=t.posShift,this.cache(t.startPos,e.startPos,n,i)},r.prototype.updateCoordinates=function(e,t,i){return this.label.x=e/2-this.label.getMeasuredWidth()/2+i,this.label.y=t/2-this.label.getMeasuredHeight()/2-i,this.background.graphics.clear().beginFill("rgba(0,0,0,0.4)").beginStroke("rgba(0,0,0,0.6)").setStrokeStyle(1).drawRoundRect(i,-i,e,t,2.5).endFill().endStroke(),[i,1]},r.prototype.updatePointMarker=function(e,t,i,n){return this.pointMarker.graphics.beginStroke("rgb(255, 255, 255)").setStrokeStyle(n,"square").moveTo(e,t-i).lineTo(e,t+i).moveTo(e-i,t).lineTo(e+i,t).endStroke(),[n,i]},r.prototype.show=function(){var e;if(this.mouseInBounds&&this.lastPos&&!this.destroyed)return this.label.text="{x: "+this.lastPos.x+", y: "+this.lastPos.y+"}",this.updateSize(),e=this.camera.worldToSurface(this.lastPos),this.x=e.x,this.y=e.y,this.addChild(this.background),this.addChild(this.label),this.placingFlag||this.addChild(this.pointMarker),this.updateCache(),Backbone.Mediator.publish("surface:coordinates-shown",{})},r)},1595:function(e,t,i){var n,p,o={}.hasOwnProperty;function s(e,t){s.__super__.constructor.call(this),this.camera=(e=null==e?{}:e).camera,this.layer=e.layer,this.textLayer=e.textLayer,this.camera||console.error(this.toString(),"needs a camera."),this.layer||console.error(this.toString(),"needs a layer."),this.textLayer||console.error(this.toString(),"needs a textLayer."),this.build(t)}n=i(45),p=i(1373),e.exports=(function(e,t){for(var i in t)o.call(t,i)&&(e[i]=t[i]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(s,n),s.prototype.subscriptions={"level:toggle-grid":"onToggleGrid"},s.prototype.shortcuts={"ctrl+g, +g":"onToggleGrid"},s.prototype.destroy=function(){return s.__super__.destroy.call(this)},s.prototype.toString=function(){return"<CoordinateGrid>"},s.prototype.build=function(e){var t,i,n,o,s,r,a,l,c,h,u=e[0]||80,e=e[1]||68;for(this.gridContainer=new p.Container,this.gridShape=new p.Shape,this.gridContainer.addChild(this.gridShape),this.gridContainer.mouseEnabled=!1,this.gridShape.alpha=.125,this.gridShape.graphics.setStrokeStyle(1),this.gridShape.graphics.beginStroke("blue"),t=Math.round(u/20),h={x:u,y:e},a=this.camera.worldToSurface(e={x:0,y:0}),r=this.camera.worldToSurface(h),c={x:e.x,y:e.y},this.labels=[],i=0;c.x<=h.x;)s=this.camera.worldToSurface(c),this.gridShape.graphics.mt(s.x,a.y).lt(s.x,r.y),++i%2&&((l=new p.Text(c.x.toFixed(0),"16px Arial","blue")).textAlign="center",l.textBaseline="bottom",l.x=s.x,l.y=a.y,l.alpha=.75,this.labels.push(l)),c.x+=t,h.x<(n=c.x)&&n<=h.x-t/2&&(c.x=h.x);for(i=0;c.y<=h.y;)s=this.camera.worldToSurface(c),this.gridShape.graphics.mt(a.x,s.y).lt(r.x,s.y),++i%2&&((l=new p.Text(c.y.toFixed(0),"16px Arial","blue")).textAlign="left",l.textBaseline="middle",l.x=0,l.y=s.y,l.alpha=.75,this.labels.push(l)),c.y+=t,h.y<(o=c.y)&&o<=h.y-t/2&&(c.y=h.y);if(this.gridShape.graphics.endStroke(),null!=(e={x:a.x,y:r.y,width:r.x-a.x,height:a.y-r.y})&&e.width&&e.height)return this.gridContainer.cache(e.x,e.y,e.width,e.height)},s.prototype.showGrid=function(){var e,t,i,n,o;if(!this.gridShowing()){for(this.layer.addChild(this.gridContainer),o=[],e=0,i=(n=this.labels).length;e<i;e++)t=n[e],o.push(this.textLayer.addChild(t));return o}},s.prototype.hideGrid=function(){var e,t,i,n,o;if(this.gridShowing()){for(this.layer.removeChild(this.gridContainer),o=[],e=0,i=(n=this.labels).length;e<i;e++)t=n[e],o.push(this.textLayer.removeChild(t));return o}},s.prototype.gridShowing=function(){var e;return null!=(null!=(e=this.gridContainer)?e.parent:void 0)},s.prototype.onToggleGrid=function(e){return null!=e&&"function"==typeof e.preventDefault&&e.preventDefault(),this.gridShowing()?this.hideGrid():this.showGrid()},s)},1596:function(e,t,i){var n,o={}.hasOwnProperty;function s(e,t){s.__super__.constructor.call(this,e,t),this.toggleCursor(t.isCursor)}n=i(1597),i(44).me,e.exports=(function(e,t){for(var i in t)o.call(t,i)&&(e[i]=t[i]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(s,n),s.prototype.subscriptions={"surface:mouse-moved":"onMouseMoved"},s.prototype.defaultPos=function(){return{x:20,y:20,z:1}},s.prototype.makeIndieThang=function(e,t){e=s.__super__.makeIndieThang.call(this,e,t);return e.width=e.height=e.depth=2,e.pos.z=1,e.isSelectable=!1,e.color=t.color,e.team=t.team,e},s.prototype.onMouseMoved=function(e){if(this.options.isCursor)return e=this.options.camera.screenToWorld({x:e.x,y:e.y}),this.thang.pos.x=e.x,this.thang.pos.y=e.y},s.prototype.toggleCursor=function(e){return this.options.isCursor=e,this.thang.alpha=e?.33:.67,this.thang.action="appear",this.updateAlpha()},s)},1597:function(e,t,i){var n,o=function(e,t){return function(){return e.apply(t,arguments)}},s={}.hasOwnProperty;function r(e,t){this.onNoteGroupEnded=o(this.onNoteGroupEnded,this),this.onNoteGroupStarted=o(this.onNoteGroupStarted,this),t.thang=this.makeIndieThang(e,t),r.__super__.constructor.call(this,e,t),this.shadow=this.thang}n=i(168),i=i(1420),e.exports=(function(e,t){for(var i in t)s.call(t,i)&&(e[i]=t[i]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(r,i),r.prototype.notOfThisWorld=!0,r.prototype.subscriptions={"script:note-group-started":"onNoteGroupStarted","script:note-group-ended":"onNoteGroupEnded"},r.prototype.makeIndieThang=function(e,t){var i;return this.thang=i=new n(null,e.get("name"),t.thangID),i.exists=!0,i.width=i.height=i.depth=4,i.pos=null!=(e=t.pos)?e:this.defaultPos(),i.pos.z=i.depth/2,i.shape="ellipsoid",i.rotation=0,i.action="idle",i.setAction=function(e){return i.action=e},i.getActionName=function(){return i.action},i.acts=!0,i.isSelectable=!0,i.team=t.team,i.teamColors=t.teamColors,i},r.prototype.onNoteGroupStarted=function(){return this.scriptRunning=!0},r.prototype.onNoteGroupEnded=function(){return this.scriptRunning=!1},r.prototype.onMouseEvent=function(e,t){if(!this.scriptRunning)return r.__super__.onMouseEvent.call(this,e,t)},r.prototype.defaultPos=function(){return{x:-20,y:20,z:this.thang.depth/2}},r)},1598:function(e,t,i){var n=i(1373);e.exports.createProgressBar=function(e){var t,i=new n.Graphics;return i.setStrokeStyle(1),i.beginFill(n.Graphics.getRGB(0,0,0)),i.drawRect(0,-1,20,2,2),i.beginFill((t=n.Graphics).getRGB.apply(t,e)),i.drawRoundRect(.3,-.7,19.4,1.4,1.4),(i=new n.Shape(i)).z=100,i.bounds=[0,-1,20,2],i}},1599:function(e,t,i){var n,g,o={}.hasOwnProperty,y=[].slice;function c(e){var t,i;c.__super__.constructor.call(this),this.sprite=(e=null==e?{}:e).sprite,this.camera=e.camera,this.layer=e.layer,this.style=null!=(t=e.style)?t:(null!=(t=this.sprite)&&null!=(i=t.thang)?i.labelStyle:void 0)||c.STYLE_SAY,this.labelOptions=null!=(i=e.labelOptions)?i:{},this.returnBounds=this.labelOptions.returnBounds,this.sprite||console.error(this.toString(),"needs a sprite."),this.camera||console.error(this.toString(),"needs a camera."),this.layer||console.error(this.toString(),"needs a layer."),e.text&&this.setText(e.text)}n=i(45),g=i(1373),e.exports=(function(e,t){for(var i in t)o.call(t,i)&&(e[i]=t[i]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(c,n),c.STYLE_DIALOGUE="dialogue",c.STYLE_SAY="say",c.STYLE_NAME="name",c.STYLE_VAR="variable",c.BITMAP_SPACE=20,c.prototype.subscriptions={},c.prototype.destroy=function(){return this.setText(null),c.__super__.destroy.call(this)},c.prototype.toString=function(){var e,t;return"<Label for "+(null!=(t=null!=(e=this.sprite)&&null!=(t=e.thang)?t.id:void 0)?t:"None")+": "+(null!=(t=null!=(t=this.text)?t.substring(0,10):void 0)?t:"")+">"},c.prototype.setText=function(e){return e!==this.text&&(this.text=e,this.build(),!0)},c.prototype.build=function(){var e;if(this.layer&&!this.layer.destroyed&&(this.background&&this.layer.removeChild(this.background),this.label&&this.layer.removeChild(this.label)),this.label=null,this.background=null,this.text)return e=this.buildLabelOptions(),this.layer.addChild(this.label=this.buildLabel(e)),this.layer.addChild(this.background=this.buildBackground(e)),this.layer.updateLayerOrder()},c.prototype.update=function(){var e,t,i,n,o;if(this.text&&this.sprite.sprite)return null==(e="function"==typeof(i=this.sprite).getOffset?i.getOffset("dialogue"===(t=this.style)||"say"===t?"mouth":"aboveHead"):void 0)&&(e={x:0,y:0}),"variable"===this.style&&(e.y+=10),(135<=(i=this.sprite.getRotation())||i<=-135)&&(e.x*=-1),this.label.x=this.background.x=this.sprite.sprite.x+e.x,this.label.y=this.background.y=this.sprite.sprite.y+e.y,this.returnBounds&&this.background.bitmapCache&&null!=(n=this.sprite)&&(null!=(o=n.options)&&o.camera)&&(this.background.bitmapCache,t=this.sprite.options.camera,i=(this.background.bitmapCache.width-c.BITMAP_SPACE)*this.background.scaleX,e=(this.background.bitmapCache.height-c.BITMAP_SPACE)*this.background.scaleY,n=this.background.x-this.background.regX*this.background.scaleX,o=this.background.y-this.background.regY*this.background.scaleY,e=t.surfaceToWorld({x:n,y:o+e}),i=t.surfaceToWorld({x:n+i,y:o}),null!=(o=this.sprite.thang)&&(o.labelBounds={x1:e.x,x2:i.x,y1:e.y,y2:i.y})),null},c.prototype.show=function(){if(this.label)return this.layer.addChild(this.label),this.layer.addChild(this.background),this.layer.updateLayerOrder()},c.prototype.hide=function(){if(this.label)return this.layer.removeChild(this.background),this.layer.removeChild(this.label)},c.prototype.buildLabelOptions=function(){var e,t,i,n={},o={dialogue:"D",say:"S",name:"N",variable:"V"}[this.style];return n.marginX={D:5,S:6,N:3,V:0}[o],n.marginY={D:6,S:4,N:3,V:0}[o],n.fontWeight={D:"bold",S:"bold",N:"bold",V:"bold"}[o],n.shadow={D:!1,S:!0,N:!0,V:!0}[o],n.shadowColor={D:"#FFF",S:"#000",N:"#000",V:"#000"}[o],n.fontSize={D:25,S:12,N:24,V:18}[o],n.lineSpacing=2,n.fontFamily={D:"Arial",S:"Arial",N:"Arial",B:"Arial",V:"Arial"}[o],n.textAlign="left",n.fontColor={D:"#000",S:"#FFF",N:"#6c6",V:"#6c6"}[o],"name"===this.style&&"humans"===(null!=(e=this.sprite)&&null!=(t=e.thang)?t.team:void 0)?n.fontColor="#c66":"name"===this.style&&"ogres"===(null!=(t=this.sprite)&&null!=(i=t.thang)?i.team:void 0)?n.fontColor="#66c":"variable"===this.style&&(n.fontColor="#fff"),n.backgroundFillColor={D:"white",S:"rgba(0,0,0,0.4)",N:"rgba(0,0,0,0.7)",V:"rgba(0,0,0,0.7)"}[o],n.backgroundStrokeColor={D:"black",S:"rgba(0,0,0,0.6)",N:"rgba(0,0,0,0)",V:"rgba(0,0,0,0)"}[o],n.backgroundStrokeStyle={D:2,S:1,N:1,V:1}[o],n.backgroundBorderRadius={D:10,S:3,N:3,V:3}[o],n.layerPriority={D:10,S:5,N:5,V:5}[o],n.maxWidth={D:300,S:300,N:180,V:100}[o],n.maxWidth=Math.max(this.camera.canvasWidth/2-100,n.maxWidth),n.maxLength={D:100,S:100,N:30,V:30}[o],(n=_.merge(n,this.labelOptions)).fontDescriptor=n.fontWeight+" "+n.fontSize+"px "+n.fontFamily,o=this.addNewLinesToText(_.string.prune(this.text,n.maxLength),n.fontDescriptor,n.maxWidth),n.text=o.text,n.textWidth=o.textWidth,n},c.prototype.buildLabel=function(e){var t,i=new g.Text(e.text,e.fontDescriptor,e.fontColor);return i.lineHeight=e.fontSize+e.lineSpacing,i.x=e.marginX,i.y=e.marginY,i.textAlign=e.textAlign,e.shadow&&(i.shadow=new g.Shadow(e.shadowColor,1,1,0)),i.layerPriority=e.layerPriority,i.name="Sprite Label - "+this.style,t=i.getBounds(),i.cache(t.x,t.y,t.width,t.height),e.textHeight=i.getMeasuredHeight(),e.label=i},c.prototype.buildBackground=function(e){var t,i,n,o,s,r=e.textWidth+2*e.marginX,a=e.textHeight+2*e.marginY+1,l=new g.Shape;return l.name="Sprite Label Background - "+this.style,(t=l.graphics).beginFill(e.backgroundFillColor),t.beginStroke(e.backgroundStrokeColor),t.setStrokeStyle(e.backgroundStrokeStyle),i=10,n=8,n+=o=e.backgroundBorderRadius,"dialogue"!==this.style||e.withoutPointer?(null==e.hpos&&(e.hpos="middle"),null==e.vPos&&(e.vPos="middle"),i=0,t.drawRoundRect(e.label.x-e.marginX,e.label.y-e.marginY,r,a,e.backgroundBorderRadius)):(s={x:this.sprite.sprite.x,y:this.sprite.sprite.y},s=this.camera.surfaceToCanvas(s),e.hPos=.53<s.x/this.camera.canvasWidth?"right":"left",e.vPos=.53<s.y/this.camera.canvasHeight?"bottom":"top",s=e.vPos+"-"+e.hPos,t.moveTo(o,0),"top-left"==s?(t.lineTo(o/2,-i),t.lineTo(n,0)):"top-right"==s&&(t.lineTo(r-n,0),t.lineTo(r-o/2,-i)),t.lineTo(r-o,0),t.quadraticCurveTo(r,0,r,o),t.lineTo(r,a-o),t.quadraticCurveTo(r,a,r-o,a),"bottom-right"==s?(t.lineTo(r-o/2,a+i),t.lineTo(r-n,a)):"bottom-left"==s&&(t.lineTo(n,a),t.lineTo(o/2,a+i)),t.lineTo(o,a),t.quadraticCurveTo(0,a,0,a-o),t.lineTo(0,o),t.quadraticCurveTo(0,0,o,0)),l.regX=r/2,l.regY=a+2,"left"===e.hPos?l.regX=3:"right"===e.hPos&&(l.regX=e.textWidth+3),"bottom"===e.vPos?l.regY=a+i:"top"===e.vPos&&(l.regY=-i),e.label.regX=l.regX-e.marginX,e.label.regY=l.regY-e.marginY,o=c.BITMAP_SPACE,l.cache(i=-1*o/2,i,r+o,a+o),t.endStroke(),t.endFill(),l.layerPriority=e.layerPriority-1,l},c.prototype.addNewLinesToText=function(e,t,i){var n,o,s,r,a,l,c,h,u,p,d,m,f;for(null==i&&(i=400),h=[],c=[],o=p=0,r=(f=_.string.words(e)).length;o<r;o++)m=f[o],c.push(m),i<(d=(u=new g.Text((d=_.string).join.apply(d,[" "].concat(y.call(c))),t,"#000")).getMeasuredWidth())?c=1===c.length?(c[0]=_.string.truncate(c[0],40),u.text=c[0],p=Math.max(u.getMeasuredWidth(),p),h.push(c),[]):(c.pop(),h.push(c),[m]):p=Math.max(p,d);for(c.length&&h.push(c),n=s=0,a=h.length;s<a;n=++s)c=h[n],h[n]=(l=_.string).join.apply(l,[" "].concat(y.call(c)));return{text:(e=_.string).join.apply(e,["\n"].concat(y.call(h))),textWidth:p}},c)},1600:function(e,t,i){var n,o,s=function(e,t){return function(){return e.apply(t,arguments)}},r={}.hasOwnProperty;function a(e){this.options=e,this.onMouseDown=s(this.onMouseDown,this),a.__super__.constructor.call(this),this.buildShape(),this.options.stage.addEventListener("stagemousedown",this.onMouseDown),this.options.camera.dragDisabled=!0}n=i(45),o=i(1373),e.exports=(function(e,t){for(var i in t)r.call(t,i)&&(e[i]=t[i]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(a,n),a.prototype.destroy=function(){return this.options.stage.removeEventListener("stagemousedown",this.onMouseDown),a.__super__.destroy.call(this)},a.prototype.setPoint=function(e){return this.point=e,this.updateShape()},a.prototype.buildShape=function(){return this.shape=new o.Shape,this.shape.alpha=.9,this.shape.mouseEnabled=!1,this.shape.graphics.setStrokeStyle(1,"round").beginStroke("#000000").beginFill("#fedcba"),this.shape.graphics.drawCircle(0,0,4).endFill()},a.prototype.onMouseDown=function(e){if(key.shift)return this.setPoint(this.options.camera.screenToWorld({x:e.stageX,y:e.stageY})),Backbone.Mediator.publish("surface:choose-point",{point:this.point})},a.prototype.updateShape=function(){var e=this.options.camera.worldToSurface(this.point);return this.shape.parent||this.options.surfaceLayer.addChild(this.shape),this.shape.x=e.x,this.shape.y=e.y},a)},1601:function(e,t,i){var n,o,s,r=function(e,t){return function(){return e.apply(t,arguments)}},a={}.hasOwnProperty;function l(e){this.options=e,this.onMouseUp=r(this.onMouseUp,this),this.onMouseMove=r(this.onMouseMove,this),this.onMouseDown=r(this.onMouseDown,this),l.__super__.constructor.call(this),this.options.stage.addEventListener("stagemousedown",this.onMouseDown),this.options.stage.addEventListener("stagemousemove",this.onMouseMove),this.options.stage.addEventListener("stagemouseup",this.onMouseUp)}o=i(45),n=i(1407),s=i(1373),e.exports=(function(e,t){for(var i in t)a.call(t,i)&&(e[i]=t[i]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(l,o),l.prototype.destroy=function(){return this.options.stage.removeEventListener("stagemousedown",this.onMouseDown),this.options.stage.removeEventListener("stagemousemove",this.onMouseMove),this.options.stage.removeEventListener("stagemouseup",this.onMouseUp),l.__super__.destroy.call(this)},l.prototype.onMouseDown=function(e){if(key.shift)return this.firstPoint=this.options.camera.screenToWorld({x:e.stageX,y:e.stageY}),this.options.camera.dragDisabled=!0},l.prototype.onMouseMove=function(e){if(this.firstPoint)return this.secondPoint=this.options.camera.screenToWorld({x:e.stageX,y:e.stageY}),(this.options.restrictRatio||key.alt)&&this.restrictRegion(),this.updateShape()},l.prototype.onMouseUp=function(e){if(this.firstPoint)return Backbone.Mediator.publish("surface:choose-region",{points:[this.firstPoint,this.secondPoint]}),this.firstPoint=null,this.secondPoint=null,this.options.camera.dragDisabled=!1},l.prototype.restrictRegion=function(){var e,t=this.options.camera.normalizeBounds([this.firstPoint,this.secondPoint]);return 1.56876<t.width/t.height?(e=t.width/1.56876*n.MPP*this.options.camera.x2y,this.secondPoint.y<this.firstPoint.y&&(e*=-1),this.secondPoint.y=this.firstPoint.y+e):(t=1.56876*t.height*n.MPP,this.secondPoint.x<this.firstPoint.x&&(t*=-1),this.secondPoint.x=this.firstPoint.x+t)},l.prototype.setRegion=function(e){return this.firstPoint=e[0],this.secondPoint=e[1],this.updateShape(),this.firstPoint=null,this.secondPoint=null},l.prototype.updateShape=function(){var e=this.options.camera.normalizeBounds([this.firstPoint,this.secondPoint]);return this.shape&&this.options.surfaceLayer.removeChild(this.shape),this.shape=new s.Shape,this.shape.alpha=.5,this.shape.mouseEnabled=!1,this.shape.graphics.beginFill("#fedcba").drawRect(e.x,e.y,e.width,e.height),this.shape.graphics.endFill(),this.shape.skipScaling=!0,this.options.surfaceLayer.addChild(this.shape)},l)},1602:function(e,t,i){var n;n=[i(3)],void 0===(i="function"==typeof(i=function(p){var e=["wheel","mousewheel","DOMMouseScroll","MozMousePixelScroll"],t="onwheel"in document||document.documentMode>=9?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"],d=Array.prototype.slice,m,f;if(p.event.fixHooks)for(var i=e.length;i;)p.event.fixHooks[e[--i]]=p.event.mouseHooks;var g=p.event.special.mousewheel={version:"3.1.12",setup:function(){if(this.addEventListener)for(var e=t.length;e;)this.addEventListener(t[--e],n,false);else this.onmousewheel=n;p.data(this,"mousewheel-line-height",g.getLineHeight(this));p.data(this,"mousewheel-page-height",g.getPageHeight(this))},teardown:function(){if(this.removeEventListener)for(var e=t.length;e;)this.removeEventListener(t[--e],n,false);else this.onmousewheel=null;p.removeData(this,"mousewheel-line-height");p.removeData(this,"mousewheel-page-height")},getLineHeight:function(e){var t=p(e),i=t["offsetParent"in p.fn?"offsetParent":"parent"]();if(!i.length)i=p("body");return parseInt(i.css("fontSize"),10)||parseInt(t.css("fontSize"),10)||16},getPageHeight:function(e){return p(e).height()},settings:{adjustOldDeltas:true,normalizeOffset:true}};function n(e){var t=e||window.event,i=d.call(arguments,1),n=0,o=0,s=0,r=0,a=0,l=0;e=p.event.fix(t);e.type="mousewheel";if("detail"in t)s=t.detail*-1;if("wheelDelta"in t)s=t.wheelDelta;if("wheelDeltaY"in t)s=t.wheelDeltaY;if("wheelDeltaX"in t)o=t.wheelDeltaX*-1;if("axis"in t&&t.axis===t.HORIZONTAL_AXIS){o=s*-1;s=0}n=s===0?o:s;if("deltaY"in t){s=t.deltaY*-1;n=s}if("deltaX"in t){o=t.deltaX;if(s===0)n=o*-1}if(s===0&&o===0)return;if(t.deltaMode===1){var c=p.data(this,"mousewheel-line-height");n*=c;s*=c;o*=c}else if(t.deltaMode===2){var h=p.data(this,"mousewheel-page-height");n*=h;s*=h;o*=h}r=Math.max(Math.abs(s),Math.abs(o));if(!f||r<f){f=r;if(v(t,r))f/=40}if(v(t,r)){n/=40;o/=40;s/=40}n=Math[n>=1?"floor":"ceil"](n/f);o=Math[o>=1?"floor":"ceil"](o/f);s=Math[s>=1?"floor":"ceil"](s/f);if(g.settings.normalizeOffset&&this.getBoundingClientRect){var u=this.getBoundingClientRect();a=e.clientX-u.left;l=e.clientY-u.top}e.deltaX=o;e.deltaY=s;e.deltaFactor=f;e.offsetX=a;e.offsetY=l;e.deltaMode=0;i.unshift(e,n,o,s);if(m)clearTimeout(m);m=setTimeout(y,200);return(p.event.dispatch||p.event.handle).apply(this,i)}function y(){f=null}function v(e,t){return g.settings.adjustOldDeltas&&e.type==="mousewheel"&&t%120===0}p.fn.extend({mousewheel:function(e){return e?this.bind("mousewheel",e):this.trigger("mousewheel")},unmousewheel:function(e){return this.unbind("mousewheel",e)}})})?i.apply(t,n):i)||(e.exports=i)},1606:function(e,t,i){var n=i(1607);(n="string"==typeof n?[[e.i,n,""]]:n).locals&&(e.exports=n.locals);(0,i(21).default)("5cd97d9a",n,!0,{})},1607:function(e,t,i){},1608:function(e,t,i){!function(t){var M=i(626);e.exports=function(e){var T,L="",e=e||{};return function(u,p,r,o,d,a,m,l,f,g,y,v,b,e,t,_,c,w,h,i,k,x,S){var C;i&&(L=L+'<div class="alert alert-success" id="game-dev-hoc-license-alert"><span data-i18n="play.get_course_for_class"></span>'+M.escape(T=" ")+'<a href="/teachers/licenses" data-i18n="play.request_licenses"></a></div>'),L+='\x3c!-- TODO: .gameplay-container causes world map buttons to briefly appear in top left of screen--\x3e<div class="gameplay-container"><a class="picoctf-hide" href="/"><img class="small-nav-logo" src="/images/pages/base/logo.png" title="CodeCombat - Learn how to code by playing a game" alt="CodeCombat"></a><div class="picoctf-show"><a class="picoctf-logo" href="http://staging.picoctf.com"><img class="small-nav-logo" src="/images/pages/play/picoctf-logo-white.png" title="picoCTF home" alt="picoCTF home"></a><a class="picoctf-powered-by" href="http://codecombat.com"><em class="spr">powered by</em><img src="/images/pages/base/logo.png" title="Powered by CodeCombat - Learn how to code by playing a game " alt="Powered by CodeCombat"></a></div><div class="under-logo button-container">',S.shouldShow("back-to-classroom")&&(L+='<a class="btn btn-illustrated btn-success btn-block btn-lg text-uppercase" href="/play" data-i18n="play.back_to_classroom"></a>'),S.shouldShow("videos")&&(L+='<a class="btn btn-illustrated btn-block btn-lg text-uppercase" id="videos-button" data-i18n="play_level.videos"></a>'),S.shouldShow("league-arena")&&function(){var e=S.activeArenas();if("number"==typeof e.length)for(var t=0,i=e.length;t<i;t++){var n=e[t];(c.get("stats")||{}).codePoints;L+="\x3c!-- TODO: change from play to view standings if new Date() > arena.end--\x3e";var o=u.t("league.play_arena_short",{arenaName:u.t("league."+n.slug.replace(/-/g,"_")),interpolation:{escapeValue:!1}}),s=12<=c.level()?"btn-primary":6<=c.level()?"btn-danger":"";L=L+"<a"+M.attr("class",M.classes(["btn","btn-illustrated","btn-block","btn-lg","text-uppercase",s],[!1,!1,!1,!1,!1,!0]),!1,!0)+' id="esports-arena"'+M.attr("data-arena",n.slug,!0,!0)+">"+M.escape(null==(T=o)?"":T)+"</a>"}else{i=0;for(t in e){i++;n=e[t],(c.get("stats")||{}).codePoints;L+="\x3c!-- TODO: change from play to view standings if new Date() > arena.end--\x3e";o=u.t("league.play_arena_short",{arenaName:u.t("league."+n.slug.replace(/-/g,"_")),interpolation:{escapeValue:!1}}),s=12<=c.level()?"btn-primary":6<=c.level()?"btn-danger":"";L=L+"<a"+M.attr("class",M.classes(["btn","btn-illustrated","btn-block","btn-lg","text-uppercase",s],[!1,!1,!1,!1,!1,!0]),!1,!0)+' id="esports-arena"'+M.attr("data-arena",n.slug,!0,!0)+">"+M.escape(null==(T=o)?"":T)+"</a>"}}}.call(this),S.shouldShow("amazon-campaign")&&(L+='<div id="amazon-campaign-container"><img id="amazon-campaign-logo" src="/images/pages/play/amazon_vert_lockup.png"></div>'),L+="</div>",h.codeNinjas&&(L+='<a href="https://code.ninja"><img class="small-nav-logo code-ninjas-logo" src="/images/pages/base/code-ninjas-logo-right.png" title="Code Ninjas home" alt="Code Ninjas home"></a>'),S.shouldShow("anonymous-classroom-signup")&&(L+='<div class="modal-content style-flat" id="anonymous-classroom-signup-dialog"><div class="modal-header"><span class="glyphicon glyphicon-remove button close" id="anon-classroom-signup-close"></span><h4><div data-i18n="play.anon_signup_title_1"></div><div data-i18n="play.anon_signup_title_2"></div></h4></div><div class="modal-body"><div class="strong" data-i18n="play.anon_signup_enter_code"></div><div data-i18n="play.anon_signup_ask_teacher"></div><div><span><input id="anon-classroom-signup-code" type="text"></span><span><button class="btn btn-sm btn-navy" id="anon-classroom-join-btn" data-i18n="courses.join"></button></span></div><div class="strong" data-i18n="play.anon_signup_create_class"></div><div data-i18n="play.anon_signup_setup_class"></div><button class="btn btn-sm btn-navy" id="anon-classroom-signup-btn" data-i18n="play.anon_signup_create_teacher"></button></div></div>'),d?(L+='<div class="map">',l.brainPop&&e&&e===t&&(L+='<div id="brain-pop-done-banner-wrapper"><div id="brain-pop-done-banner"><img src="/images/pages/play/Victory_Pose.png"><p><strong data-i18n="play.brain_pop_done"></strong></p><p><span data-i18n="play.brain_pop_challenge"></span></p><p><button class="btn btn-success btn-illustrated btn-lg" id="brain-pop-replay-btn" data-i18n="play.replay"></button></p></div></div>'),L+='<div class="gradient horizontal-gradient top-gradient"></div><div class="gradient vertical-gradient right-gradient"></div><div class="gradient horizontal-gradient bottom-gradient"></div><div class="gradient vertical-gradient left-gradient"></div><div class="map-background" alt="" draggable="false"></div>',function(){var e=b;if("number"==typeof e.length)for(var t=0,i=e.length;t<i;t++){var o=e[t];(d.levelIsPractice(o)||!o.unlockedInSameCampaign)&&o.hidden||(n="",S.shouldShow("back-to-classroom")&&S.classroom&&("cumulative"===o.assessment?n=u.t("play_level.combo_challenge")+": ":o.assessment?n=u.t("play_level.concept_challenge")+": ":(n=S.classroom.getLevelNumber(o.original,""))&&(n+=". ")),L=L+"<div"+(M.attr("class",M.classes(["level"+(o.next?" next":"")+(o.disabled?" disabled":"")+(o.locked?" locked":"")+" "+(v[o.slug]||"")],[!0]),!1,!0)+M.attr("style",M.style("left: "+o.position.x+"%; bottom: "+o.position.y+"%; background-color: "+o.color),!0,!0)+M.attr("data-level-slug",o.slug,!0,!0)+M.attr("data-level-original",o.original,!0,!0)+M.attr("title",n+f(o,"name")+(o.disabled?" ("+x("common.coming_soon")+")":o.practice?" ("+x("courses.practice")+")":""),!0,!0))+">",L=(L=o.unlocksHero&&(!o.purchasedHero||m)&&(o.hidden||"complete"===v[o.slug])?L+'<img class="hero-portrait"'+M.attr("src","/file/db/thang.type/"+o.unlocksHero+"/portrait.png",!0,!0)+">":L)+"<a"+(M.attr("href","hero"==o.type?"#":o.disabled?"/play":"/play/"+(o.levelPath||"level")+"/"+o.slug,!0,!0)+M.attr("disabled",o.disabled,!0,!0)+M.attr("data-level-slug",o.slug,!0,!0)+M.attr("data-level-path",o.levelPath||"level",!0,!0)+M.attr("data-level-name",o.name,!0,!0))+"></a>","complete"===v[o.slug]&&(L+='<img class="star" src="/images/pages/play/star.png">'),m&&(s=(o.kind&&o.kind[0]||"").toUpperCase(),L=L+"\x3c!--if kindKey--\x3e<div"+M.attr("class",M.classes(["level-kind "+o.kind],[!0]),!1,!0)+">"+M.escape(null==(T=s)?"":T)+"</div>",r=o.name.replace(/(A |The )/g,"").replace(/[^A-Z]/g,""),L=L+'<div class="level-acronym">'+M.escape(null==(T=r)?"":T)+"</div>"),o.hidden||o.noFlag||(o.replayable?L+='<img class="banner" src="/images/pages/play/level-banner-replayable.png">':"hero-ladder"===o.type||"course-ladder"===o.type||"ladder"===o.type?L+='<img class="banner" src="/images/pages/play/level-banner-multiplayer.png">':-1!==["kithgard-gates","siege-of-stonehold","clash-of-clones","summits-gate","kithgard-mastery"].indexOf(o.slug)&&"complete"!==v[o.slug]?L+='<img class="banner" src="/images/pages/play/level-banner-special.png">':o.unlocksHero&&"complete"!==v[o.slug]?L=L+'<img class="banner"'+M.attr("src","/images/pages/play/level-banner-unlock"+(o.requiresSubscription?"-subscriber":"")+".png",!0,!0)+'><img class="premium-hero-banner"'+M.attr("src","/db/thang.type/"+o.unlocksHero+"/toFile/poseImage",!0,!0)+'><img class="treasure-chest" src="/images/pages/play/gold-chest.png">':o.unlocksItem&&"complete"!==v[o.slug]?(L=L+'<img class="banner"'+M.attr("src","/images/pages/play/level-banner-unlock"+(o.requiresSubscription?"-subscriber":"")+".png",!0,!0)+">",L=(L=o.unlocksPet?L+'<img class="pet-banner"'+M.attr("src","/db/thang.type/"+o.unlocksItem+"/toFile/dollImages.pet",!0,!0)+">":L+'<img class="item-portrait item-portrait-on-banner"'+M.attr("src","/file/db/thang.type/"+o.unlocksItem+"/portrait.png",!0,!0)+">")+'<img class="treasure-chest"'+M.attr("src","/images/pages/play/"+(o.requiresSubscription?"silver":"bronze")+"-chest.png",!0,!0)+">"):"complete"!==v[o.slug]&&o.assessment?L+='<img class="banner" src="/images/pages/play/level-banner-unstarted-subscriber.png">':"started"===v[o.slug]?L+='<img class="banner" src="/images/pages/play/level-banner-started.png">':"complete"!==v[o.slug]&&(L=L+'<img class="banner"'+M.attr("src","/images/pages/play/level-banner-unstarted"+(o.requiresSubscription?"-subscriber":"")+".png",!0,!0)+">"),g[o.slug]&&(L=L+'<div class="level-difficulty-banner-text">'+M.escape(null==(T=g[o.slug])?"":T)+"</div>")),o.locked&&(o.unlocksItem&&!o.unlocksHero?L=L+'<img class="treasure-chest"'+M.attr("src","/images/pages/play/"+(o.requiresSubscription?"silver":"bronze")+"-chest.png",!0,!0)+">":o.unlocksHero&&(L+='<img class="treasure-chest" src="/images/pages/play/gold-chest.png">')),L=L+"</div><div"+(M.attr("class",M.classes(["level-shadow"+(o.next?" next":"")+(o.locked?" locked":"")+" "+(v[o.slug]||"")],[!0]),!1,!0)+M.attr("style",M.style("left: "+o.position.x+"%; bottom: "+o.position.y+"%"),!0,!0))+'></div><div class="level-info-container rtl-allowed"'+M.attr("data-level-slug",o.slug,!0,!0)+M.attr("data-level-path",o.levelPath||"level",!0,!0)+M.attr("data-level-name",o.name,!0,!0)+M.attr("data-level-original",o.original,!0,!0)+">",a=y[o.slug],L+='<div class="progress progress-striped active hide"><div class="progress-bar" style="width: 100%"></div></div>',l=S.shouldShow("leaderboard")&&"complete"===v[o.slug]&&(o.scoreTypes&&o.scoreTypes.length||-1!==["hero-ladder","course-ladder","ladder"].indexOf(o.type)),L=L+"<div"+M.attr("class",M.classes(["level-info rtl-allowed "+(v[o.slug]||"")+(o.requiresSubscription?" premium":"")+(l?" shows-leaderboard":"")],[!0]),!1,!0)+'><div class="level-status rtl-allowed" dir="auto"></div>',c=n+f(o,"name")+(o.disabled?" ("+x("common.coming_soon")+")":o.locked?" ("+x("play.locked")+")":o.practice?" ("+x("courses.practice")+")":""),L=L+"<h3"+M.attr("dir",S.isRTL(c)?"rtl":"ltr",!0,!0)+">"+M.escape(null==(T=c)?"":T)+"</h3>","open-ended"===o.assessment&&S.levelScoreMap[o.original]&&"complete"===v[o.slug]&&(k=S.levelScoreMap[o.original]).thresholdAchieved&&(L=L+'<img class="threshold-icon"'+M.attr("src","/images/pages/courses/star-"+k.thresholdAchieved+".png",!0,!0)+">"),h=f(o,"description")||o.description||"",L=L+'<div class="level-description rtl-allowed" dir="auto">'+(null==(T=_(h,{sanitize:!w}))?"":T)+"</div>",o.disabled&&(L+='<p><span class="spr" data-i18n="play.awaiting_levels_adventurer_prefix">We release five levels per week.</span><a class="spr" href="/contribute/adventurer"><strong data-i18n="play.awaiting_levels_adventurer">Sign up as an Adventurer</strong></a><span class="spl" data-i18n="play.awaiting_levels_adventurer_suffix">to be the first to play new levels.</span></p>'),o.displayConcepts&&o.displayConcepts.length&&(L+="<p>",function(){var e=o.displayConcepts;if("number"==typeof e.length)for(var t=0,i=e.length;t<i;t++){var n=e[t];L=L+"<kbd"+M.attr("data-i18n","concepts."+n,!0,!0)+"></kbd>"}else{i=0;for(t in e){i++;n=e[t];L=L+"<kbd"+M.attr("data-i18n","concepts."+n,!0,!0)+"></kbd>"}}}.call(this),L+="</p>"),o.disabled||o.locked||(a&&a.sessions&&(L=L+'<div class="play-counts hidden"><span class="spl spr">'+M.escape(null==(T=a.sessions)?"":T)+'</span><span data-i18n="play.players">players</span><span class="spr">, '+M.escape(null==(T=p.round(a.playtime/3600))?"":T)+'</span><span data-i18n="play.hours_played">hours played</span></div>'),l&&(L=L+'<button class="btn btn-warning btn btn-lg btn-illustrated view-solutions"'+M.attr("data-level-slug",o.slug,!0,!0)+'><span data-i18n="leaderboard.scores"></span></button>'),S.shouldShow("classroom-level-play-button")?L=L+'<div class="course-version hidden"'+M.attr("data-level-original",o.original,!0,!0)+'><button class="btn btn-primary btn btn-lg btn-block btn-illustrated"><span data-i18n="common.play">Play</span></button></div>':L+='<button class="btn btn-success btn btn-lg btn-illustrated start-level" data-i18n="common.play">Play</button>'),L+="</div></div>")}else{i=0;for(t in e){i++;var n,s,r,a,l,c,h,o=e[t];(d.levelIsPractice(o)||!o.unlockedInSameCampaign)&&o.hidden||(n="",S.shouldShow("back-to-classroom")&&S.classroom&&("cumulative"===o.assessment?n=u.t("play_level.combo_challenge")+": ":o.assessment?n=u.t("play_level.concept_challenge")+": ":(n=S.classroom.getLevelNumber(o.original,""))&&(n+=". ")),L=L+"<div"+(M.attr("class",M.classes(["level"+(o.next?" next":"")+(o.disabled?" disabled":"")+(o.locked?" locked":"")+" "+(v[o.slug]||"")],[!0]),!1,!0)+M.attr("style",M.style("left: "+o.position.x+"%; bottom: "+o.position.y+"%; background-color: "+o.color),!0,!0)+M.attr("data-level-slug",o.slug,!0,!0)+M.attr("data-level-original",o.original,!0,!0)+M.attr("title",n+f(o,"name")+(o.disabled?" ("+x("common.coming_soon")+")":o.practice?" ("+x("courses.practice")+")":""),!0,!0))+">",L=(L=o.unlocksHero&&(!o.purchasedHero||m)&&(o.hidden||"complete"===v[o.slug])?L+'<img class="hero-portrait"'+M.attr("src","/file/db/thang.type/"+o.unlocksHero+"/portrait.png",!0,!0)+">":L)+"<a"+(M.attr("href","hero"==o.type?"#":o.disabled?"/play":"/play/"+(o.levelPath||"level")+"/"+o.slug,!0,!0)+M.attr("disabled",o.disabled,!0,!0)+M.attr("data-level-slug",o.slug,!0,!0)+M.attr("data-level-path",o.levelPath||"level",!0,!0)+M.attr("data-level-name",o.name,!0,!0))+"></a>","complete"===v[o.slug]&&(L+='<img class="star" src="/images/pages/play/star.png">'),m&&(s=(o.kind&&o.kind[0]||"").toUpperCase(),L=L+"\x3c!--if kindKey--\x3e<div"+M.attr("class",M.classes(["level-kind "+o.kind],[!0]),!1,!0)+">"+M.escape(null==(T=s)?"":T)+"</div>",r=o.name.replace(/(A |The )/g,"").replace(/[^A-Z]/g,""),L=L+'<div class="level-acronym">'+M.escape(null==(T=r)?"":T)+"</div>"),o.hidden||o.noFlag||(o.replayable?L+='<img class="banner" src="/images/pages/play/level-banner-replayable.png">':"hero-ladder"===o.type||"course-ladder"===o.type||"ladder"===o.type?L+='<img class="banner" src="/images/pages/play/level-banner-multiplayer.png">':-1!==["kithgard-gates","siege-of-stonehold","clash-of-clones","summits-gate","kithgard-mastery"].indexOf(o.slug)&&"complete"!==v[o.slug]?L+='<img class="banner" src="/images/pages/play/level-banner-special.png">':o.unlocksHero&&"complete"!==v[o.slug]?L=L+'<img class="banner"'+M.attr("src","/images/pages/play/level-banner-unlock"+(o.requiresSubscription?"-subscriber":"")+".png",!0,!0)+'><img class="premium-hero-banner"'+M.attr("src","/db/thang.type/"+o.unlocksHero+"/toFile/poseImage",!0,!0)+'><img class="treasure-chest" src="/images/pages/play/gold-chest.png">':o.unlocksItem&&"complete"!==v[o.slug]?(L=L+'<img class="banner"'+M.attr("src","/images/pages/play/level-banner-unlock"+(o.requiresSubscription?"-subscriber":"")+".png",!0,!0)+">",L=(L=o.unlocksPet?L+'<img class="pet-banner"'+M.attr("src","/db/thang.type/"+o.unlocksItem+"/toFile/dollImages.pet",!0,!0)+">":L+'<img class="item-portrait item-portrait-on-banner"'+M.attr("src","/file/db/thang.type/"+o.unlocksItem+"/portrait.png",!0,!0)+">")+'<img class="treasure-chest"'+M.attr("src","/images/pages/play/"+(o.requiresSubscription?"silver":"bronze")+"-chest.png",!0,!0)+">"):"complete"!==v[o.slug]&&o.assessment?L+='<img class="banner" src="/images/pages/play/level-banner-unstarted-subscriber.png">':"started"===v[o.slug]?L+='<img class="banner" src="/images/pages/play/level-banner-started.png">':"complete"!==v[o.slug]&&(L=L+'<img class="banner"'+M.attr("src","/images/pages/play/level-banner-unstarted"+(o.requiresSubscription?"-subscriber":"")+".png",!0,!0)+">"),g[o.slug]&&(L=L+'<div class="level-difficulty-banner-text">'+M.escape(null==(T=g[o.slug])?"":T)+"</div>")),o.locked&&(o.unlocksItem&&!o.unlocksHero?L=L+'<img class="treasure-chest"'+M.attr("src","/images/pages/play/"+(o.requiresSubscription?"silver":"bronze")+"-chest.png",!0,!0)+">":o.unlocksHero&&(L+='<img class="treasure-chest" src="/images/pages/play/gold-chest.png">')),L=L+"</div><div"+(M.attr("class",M.classes(["level-shadow"+(o.next?" next":"")+(o.locked?" locked":"")+" "+(v[o.slug]||"")],[!0]),!1,!0)+M.attr("style",M.style("left: "+o.position.x+"%; bottom: "+o.position.y+"%"),!0,!0))+'></div><div class="level-info-container rtl-allowed"'+M.attr("data-level-slug",o.slug,!0,!0)+M.attr("data-level-path",o.levelPath||"level",!0,!0)+M.attr("data-level-name",o.name,!0,!0)+M.attr("data-level-original",o.original,!0,!0)+">",a=y[o.slug],L+='<div class="progress progress-striped active hide"><div class="progress-bar" style="width: 100%"></div></div>',l=S.shouldShow("leaderboard")&&"complete"===v[o.slug]&&(o.scoreTypes&&o.scoreTypes.length||-1!==["hero-ladder","course-ladder","ladder"].indexOf(o.type)),L=L+"<div"+M.attr("class",M.classes(["level-info rtl-allowed "+(v[o.slug]||"")+(o.requiresSubscription?" premium":"")+(l?" shows-leaderboard":"")],[!0]),!1,!0)+'><div class="level-status rtl-allowed" dir="auto"></div>',c=n+f(o,"name")+(o.disabled?" ("+x("common.coming_soon")+")":o.locked?" ("+x("play.locked")+")":o.practice?" ("+x("courses.practice")+")":""),L=L+"<h3"+M.attr("dir",S.isRTL(c)?"rtl":"ltr",!0,!0)+">"+M.escape(null==(T=c)?"":T)+"</h3>","open-ended"===o.assessment&&S.levelScoreMap[o.original]&&"complete"===v[o.slug]&&(k=S.levelScoreMap[o.original]).thresholdAchieved&&(L=L+'<img class="threshold-icon"'+M.attr("src","/images/pages/courses/star-"+k.thresholdAchieved+".png",!0,!0)+">"),h=f(o,"description")||o.description||"",L=L+'<div class="level-description rtl-allowed" dir="auto">'+(null==(T=_(h,{sanitize:!w}))?"":T)+"</div>",o.disabled&&(L+='<p><span class="spr" data-i18n="play.awaiting_levels_adventurer_prefix">We release five levels per week.</span><a class="spr" href="/contribute/adventurer"><strong data-i18n="play.awaiting_levels_adventurer">Sign up as an Adventurer</strong></a><span class="spl" data-i18n="play.awaiting_levels_adventurer_suffix">to be the first to play new levels.</span></p>'),o.displayConcepts&&o.displayConcepts.length&&(L+="<p>",function(){var e=o.displayConcepts;if("number"==typeof e.length)for(var t=0,i=e.length;t<i;t++){var n=e[t];L=L+"<kbd"+M.attr("data-i18n","concepts."+n,!0,!0)+"></kbd>"}else{i=0;for(t in e){i++;n=e[t];L=L+"<kbd"+M.attr("data-i18n","concepts."+n,!0,!0)+"></kbd>"}}}.call(this),L+="</p>"),o.disabled||o.locked||(a&&a.sessions&&(L=L+'<div class="play-counts hidden"><span class="spl spr">'+M.escape(null==(T=a.sessions)?"":T)+'</span><span data-i18n="play.players">players</span><span class="spr">, '+M.escape(null==(T=p.round(a.playtime/3600))?"":T)+'</span><span data-i18n="play.hours_played">hours played</span></div>'),l&&(L=L+'<button class="btn btn-warning btn btn-lg btn-illustrated view-solutions"'+M.attr("data-level-slug",o.slug,!0,!0)+'><span data-i18n="leaderboard.scores"></span></button>'),S.shouldShow("classroom-level-play-button")?L=L+'<div class="course-version hidden"'+M.attr("data-level-original",o.original,!0,!0)+'><button class="btn btn-primary btn btn-lg btn-block btn-illustrated"><span data-i18n="common.play">Play</span></button></div>':L+='<button class="btn btn-success btn btn-lg btn-illustrated start-level" data-i18n="common.play">Play</button>'),L+="</div></div>")}}}.call(this),S.shouldShow("league-arena")&&function(){var e=S.activeArenas();if("number"==typeof e.length)for(var t=0,i=e.length;t<i;t++){var n=e[t];L=L+'<div class="level-info-container rtl-allowed league-arena-tooltip"'+M.attr("data-arena",n.slug,!0,!0)+'><div class="level-info rtl-allowed complete"><div class="level-status rtl-allowed" dir="auto"></div><h3 dir="ltr"'+M.attr("data-i18n","league."+n.slug.replace(/-/g,"_"),!0,!0)+'></h3><div class="level-description rtl-allowed" dir="auto"><p data-i18n="league.seasonal_arena_tooltip"></p></div><a class="btn btn-success btn btn-lg btn-illustrated start-esports" data-i18n="common.play"'+M.attr("href","/play/ladder/"+n.slug,!0,!0)+M.attr("data-arena",n.slug,!0,!0)+"></a></div></div>"}else{i=0;for(t in e){i++;n=e[t];L=L+'<div class="level-info-container rtl-allowed league-arena-tooltip"'+M.attr("data-arena",n.slug,!0,!0)+'><div class="level-info rtl-allowed complete"><div class="level-status rtl-allowed" dir="auto"></div><h3 dir="ltr"'+M.attr("data-i18n","league."+n.slug.replace(/-/g,"_"),!0,!0)+'></h3><div class="level-description rtl-allowed" dir="auto"><p data-i18n="league.seasonal_arena_tooltip"></p></div><a class="btn btn-success btn btn-lg btn-illustrated start-esports" data-i18n="common.play"'+M.attr("href","/play/ladder/"+n.slug,!0,!0)+M.attr("data-arena",n.slug,!0,!0)+"></a></div></div>"}}}.call(this),function(){var e=o;if("number"==typeof e.length)for(var t=0,i=e.length;t<i;t++){var n=e[t];L=L+"<a"+M.attr("href",(m?"/editor/campaign/":"/play/")+n.slug,!0,!0)+'><span class="glyphicon glyphicon-share-alt campaign-switch"'+M.attr("style",M.style(n.style),!0,!0)+M.attr("title",n.name,!0,!0)+M.attr("data-campaign-id",n.id,!0,!0)+M.attr("data-campaign-slug",n.slug,!0,!0)+"></span></a>"}else{i=0;for(t in e){i++;n=e[t];L=L+"<a"+M.attr("href",(m?"/editor/campaign/":"/play/")+n.slug,!0,!0)+'><span class="glyphicon glyphicon-share-alt campaign-switch"'+M.attr("style",M.style(n.style),!0,!0)+M.attr("title",n.name,!0,!0)+M.attr("data-campaign-id",n.id,!0,!0)+M.attr("data-campaign-slug",n.slug,!0,!0)+"></span></a>"}}}.call(this),L+='\x3c!-- Minecraft Modal--\x3e<div class="level cube-level" id="cube-level-container" style="display: none;"><div id="spinning-cube"><div class="cube"><div class="front"></div><div class="back"></div><div class="top"></div><div class="bottom"></div><div class="left"></div><div class="right"></div></div></div></div>\x3c!-- Minecraft Modal--\x3e<div class="cube-level level-shadow" id="cube-level-shadow" style="left: 30%; top: 16.5%;display: none"></div></div>'):(L+='<div class="portal"><div class="portals">',C=c.isInGodMode(),function(){var e=l.campaignSlugs||["dungeon","beta-campaigns-1","forest","beta-campaigns-2","desert","beta-campaigns-3","mountain","glacier","volcano"];if("number"==typeof e.length)for(var t=0,i=e.length;t<i;t++){var n=e[t];/beta-campaigns/.test(n)?c.freeOnly()||(s="beta-campaigns-1"===n?r.shuffle(["campaign-game-dev-1","campaign-web-dev-1"]):"beta-campaigns-2"===n?r.shuffle(["campaign-game-dev-2","campaign-web-dev-2"]):["campaign-game-dev-3"],L+='<div class="beta-container">',function(){var e=s;if("number"==typeof e.length)for(var t=0,i=e.length;t<i;t++){var n=e[t];(o=a[n])&&(L=L+"<div"+(M.attr("class",M.classes(["beta-campaign"+(o?"":" silhouette")+(o&&o.locked&&!C?" locked":"")],[!0]),!1,!0)+M.attr("data-campaign-slug",n,!0,!0))+"><div"+M.attr("class",M.classes(["background-container",n],[!1,!0]),!1,!0)+'></div><div class="campaign-label"><h3 class="campaign-name">',o?(L=L+"<span>"+M.escape(null==(T=f(o.attributes,"fullName"))?"":T)+"</span>",o.levelsTotal&&(L=L+'<span class="spl">'+M.escape(null==(T=o.levelsCompleted)?"":T)+"</span>/<span>"+M.escape(null==(T=o.levelsTotal)?"":T)+"</span>")):L+="<span>???</span>",L+="</h3>",o&&o.locked&&!C?L+='<h4 class="campaign-locked" data-i18n="play.locked">Locked</h4>':o&&(h.static?L=L+'<a class="btn btn-illustrated btn-lg btn-primary play-button" data-i18n="common.play"'+M.attr("href","/play/"+n,!0,!0)+"></a>":L+='<btn class="btn btn-illustrated btn-lg btn-primary play-button" data-i18n="common.play"></btn>'),o&&o.get("description")&&(L=L+'<p class="campaign-description" dir="auto"><span>'+M.escape(null==(T=f(o.attributes,"description"))?"":T)+"</span></p>"),L+="</div></div>")}else{i=0;for(t in e){i++;var o,n=e[t];(o=a[n])&&(L=L+"<div"+(M.attr("class",M.classes(["beta-campaign"+(o?"":" silhouette")+(o&&o.locked&&!C?" locked":"")],[!0]),!1,!0)+M.attr("data-campaign-slug",n,!0,!0))+"><div"+M.attr("class",M.classes(["background-container",n],[!1,!0]),!1,!0)+'></div><div class="campaign-label"><h3 class="campaign-name">',o?(L=L+"<span>"+M.escape(null==(T=f(o.attributes,"fullName"))?"":T)+"</span>",o.levelsTotal&&(L=L+'<span class="spl">'+M.escape(null==(T=o.levelsCompleted)?"":T)+"</span>/<span>"+M.escape(null==(T=o.levelsTotal)?"":T)+"</span>")):L+="<span>???</span>",L+="</h3>",o&&o.locked&&!C?L+='<h4 class="campaign-locked" data-i18n="play.locked">Locked</h4>':o&&(h.static?L=L+'<a class="btn btn-illustrated btn-lg btn-primary play-button" data-i18n="common.play"'+M.attr("href","/play/"+n,!0,!0)+"></a>":L+='<btn class="btn btn-illustrated btn-lg btn-primary play-button" data-i18n="common.play"></btn>'),o&&o.get("description")&&(L=L+'<p class="campaign-description" dir="auto"><span>'+M.escape(null==(T=f(o.attributes,"description"))?"":T)+"</span></p>"),L+="</div></div>")}}}.call(this),L+="</div>"):(o=a[n],L=L+"<div"+(M.attr("class",M.classes(["campaign "+n+(o?"":" silhouette")+(o&&o.locked&&!C?" locked":"")],[!0]),!1,!0)+M.attr("data-campaign-slug",n,!0,!0))+'><div class="campaign-label"><h2 class="campaign-name">',o?L=L+"<span>"+M.escape(null==(T=f(o.attributes,"fullName"))?"":T)+"</span>":L+="<span>???</span>",L+="</h2>",o&&o.levelsTotal&&!l.brainPop&&(L=L+'<h3 class="levels-completed"><span>'+M.escape(null==(T=o.levelsCompleted)?"":T)+"</span>/<span>"+M.escape(null==(T=o.levelsTotal)?"":T)+"</span></h3>"),o&&o.locked&&!C?L+='<h3 class="campaign-locked" data-i18n="play.locked">Locked</h3>':o&&(h.static?L=L+'<a class="btn btn-illustrated btn-lg btn-success play-button" data-i18n="common.play"'+M.attr("href","/play/"+n,!0,!0)+"></a>":L+='<btn class="btn btn-illustrated btn-lg btn-success play-button" data-i18n="common.play"></btn>'),o&&o.get("description")&&(L=L+'<p class="campaign-description" dir="auto"><span>'+M.escape(null==(T=f(o.attributes,"description"))?"":T)+"</span></p>"),L+="</div></div>")}else{i=0;for(t in e){i++;var s,o,n=e[t];/beta-campaigns/.test(n)?c.freeOnly()||(s="beta-campaigns-1"===n?r.shuffle(["campaign-game-dev-1","campaign-web-dev-1"]):"beta-campaigns-2"===n?r.shuffle(["campaign-game-dev-2","campaign-web-dev-2"]):["campaign-game-dev-3"],L+='<div class="beta-container">',function(){var e=s;if("number"==typeof e.length)for(var t=0,i=e.length;t<i;t++){var n=e[t];(o=a[n])&&(L=L+"<div"+(M.attr("class",M.classes(["beta-campaign"+(o?"":" silhouette")+(o&&o.locked&&!C?" locked":"")],[!0]),!1,!0)+M.attr("data-campaign-slug",n,!0,!0))+"><div"+M.attr("class",M.classes(["background-container",n],[!1,!0]),!1,!0)+'></div><div class="campaign-label"><h3 class="campaign-name">',o?(L=L+"<span>"+M.escape(null==(T=f(o.attributes,"fullName"))?"":T)+"</span>",o.levelsTotal&&(L=L+'<span class="spl">'+M.escape(null==(T=o.levelsCompleted)?"":T)+"</span>/<span>"+M.escape(null==(T=o.levelsTotal)?"":T)+"</span>")):L+="<span>???</span>",L+="</h3>",o&&o.locked&&!C?L+='<h4 class="campaign-locked" data-i18n="play.locked">Locked</h4>':o&&(h.static?L=L+'<a class="btn btn-illustrated btn-lg btn-primary play-button" data-i18n="common.play"'+M.attr("href","/play/"+n,!0,!0)+"></a>":L+='<btn class="btn btn-illustrated btn-lg btn-primary play-button" data-i18n="common.play"></btn>'),o&&o.get("description")&&(L=L+'<p class="campaign-description" dir="auto"><span>'+M.escape(null==(T=f(o.attributes,"description"))?"":T)+"</span></p>"),L+="</div></div>")}else{i=0;for(t in e){i++;var o,n=e[t];(o=a[n])&&(L=L+"<div"+(M.attr("class",M.classes(["beta-campaign"+(o?"":" silhouette")+(o&&o.locked&&!C?" locked":"")],[!0]),!1,!0)+M.attr("data-campaign-slug",n,!0,!0))+"><div"+M.attr("class",M.classes(["background-container",n],[!1,!0]),!1,!0)+'></div><div class="campaign-label"><h3 class="campaign-name">',o?(L=L+"<span>"+M.escape(null==(T=f(o.attributes,"fullName"))?"":T)+"</span>",o.levelsTotal&&(L=L+'<span class="spl">'+M.escape(null==(T=o.levelsCompleted)?"":T)+"</span>/<span>"+M.escape(null==(T=o.levelsTotal)?"":T)+"</span>")):L+="<span>???</span>",L+="</h3>",o&&o.locked&&!C?L+='<h4 class="campaign-locked" data-i18n="play.locked">Locked</h4>':o&&(h.static?L=L+'<a class="btn btn-illustrated btn-lg btn-primary play-button" data-i18n="common.play"'+M.attr("href","/play/"+n,!0,!0)+"></a>":L+='<btn class="btn btn-illustrated btn-lg btn-primary play-button" data-i18n="common.play"></btn>'),o&&o.get("description")&&(L=L+'<p class="campaign-description" dir="auto"><span>'+M.escape(null==(T=f(o.attributes,"description"))?"":T)+"</span></p>"),L+="</div></div>")}}}.call(this),L+="</div>"):(o=a[n],L=L+"<div"+(M.attr("class",M.classes(["campaign "+n+(o?"":" silhouette")+(o&&o.locked&&!C?" locked":"")],[!0]),!1,!0)+M.attr("data-campaign-slug",n,!0,!0))+'><div class="campaign-label"><h2 class="campaign-name">',o?L=L+"<span>"+M.escape(null==(T=f(o.attributes,"fullName"))?"":T)+"</span>":L+="<span>???</span>",L+="</h2>",o&&o.levelsTotal&&!l.brainPop&&(L=L+'<h3 class="levels-completed"><span>'+M.escape(null==(T=o.levelsCompleted)?"":T)+"</span>/<span>"+M.escape(null==(T=o.levelsTotal)?"":T)+"</span></h3>"),o&&o.locked&&!C?L+='<h3 class="campaign-locked" data-i18n="play.locked">Locked</h3>':o&&(h.static?L=L+'<a class="btn btn-illustrated btn-lg btn-success play-button" data-i18n="common.play"'+M.attr("href","/play/"+n,!0,!0)+"></a>":L+='<btn class="btn btn-illustrated btn-lg btn-success play-button" data-i18n="common.play"></btn>'),o&&o.get("description")&&(L=L+'<p class="campaign-description" dir="auto"><span>'+M.escape(null==(T=f(o.attributes,"description"))?"":T)+"</span></p>"),L+="</div></div>")}}}.call(this),L+="</div></div>"),L+='<div class="game-controls header-font picoctf-hide">',l.picoCtf||l.brainPop||(S.shouldShow("promotion")&&(L+='<button class="btn promotion-menu-icon" data-toggle="coco-modal" data-target="play/modal/PromotionModal" title="New: Code in Beijing!"></button>'),S.shouldShow("premium")&&(L+='<button class="btn premium-menu-icon" data-i18n="[title]subscribe.subscribe_modal_title"></button>'),S.shouldShow("poll")&&(L+='<button class="btn poll hidden" data-i18n="[title]play.poll"></button>'),S.shouldShow("clans")&&(L+='<a class="btn clans" href="/clans" data-i18n="[title]clans.clans"></a>'),S.shouldShow("items")&&(L+='<button class="btn items" data-toggle="coco-modal" data-target="play/modal/PlayItemsModal" data-i18n="[title]play.items"></button>'),S.shouldShow("heros")&&(L+='<button class="btn heroes" data-toggle="coco-modal" data-target="play/modal/PlayHeroesModal" data-i18n="[title]play.heroes"></button>'),S.shouldShow("achievements")&&(L+='<button class="btn achievements" data-toggle="coco-modal" data-target="play/modal/PlayAchievementsModal" data-i18n="[title]play.achievements"></button>'),S.shouldShow("buy-gems")&&(L+='<button class="btn gems" data-toggle="coco-modal" data-target="play/modal/BuyGemsModal" data-i18n="[title]play.buy_gems"></button>'),!c.get("anonymous",!0)&&S.shouldShow("settings")&&(L+='<a class="btn account" href="/account/settings" data-i18n="[title]play.settings"></a>')),L+='</div><div class="user-status header-font picoctf-hide"><div class="user-status-line">',S.shouldShow("status-line")&&(S.shouldShow("gems")&&(L=L+'<span class="gem gem-30"></span><span class="spr" id="gems-count">'+M.escape(null==(T=c.gems())?"":T)+"</span>"),S.shouldShow("level")&&(L=L+'<div class="rtl-allowed"><span class="level-indicator" data-i18n="general.player_level"></span><span class="player-level spr">'+M.escape(null==(T=c.level())?"":T)+"</span></div>"),L+='<span class="player-hero-icon"></span>',c.get("anonymous")?L+='<span class="player-name" data-i18n="play.anonymous">Anonymous Player</span><button class="btn btn-illustrated login-button btn-warning" data-i18n="login.log_in"></button><button class="btn btn-illustrated signup-button btn-danger" data-i18n="signup.sign_up"></button>':(L=c.isStudent()?L+'<a class="player-name spr" href="/play">'+M.escape(null==(T=c.get("name"))?"":T)+"</a>":L+'<a class="player-name spr" href="/account">'+M.escape(null==(T=c.get("name"))?"":T)+"</a>",c.isStudent()||(L+='<button class="btn btn-illustrated btn-warning" id="logout-button" data-i18n="login.log_out">Log Out</button>')),L+='<select class="language-dropdown btn btn-illustrated btn-primary"></select>'),L+='</div></div><button class="btn btn-lg btn-inverse campaign-control-button picoctf-hide" id="volume-button" data-i18n="[title]play.adjust_volume" title="Adjust volume"><div class="glyphicon glyphicon-volume-off"></div><div class="glyphicon glyphicon-volume-down"></div><div class="glyphicon glyphicon-volume-up"></div></button>',d&&"hoc"!==d.get("type")&&!m&&S.shouldShow("back-to-campaigns")&&(L+='<button class="btn btn-lg btn-inverse campaign-control-button picoctf-hide" id="back-button" data-i18n="[title]resources.campaigns" title="Campaigns"><div class="glyphicon glyphicon-globe"></div></button>'),m&&(L+='<button class="btn btn-lg btn-inverse campaign-control-button" id="clear-storage-button" data-i18n="[title]editor.clear_storage" title="Clear your local changes"><div class="glyphicon glyphicon-refresh"></div></button>'),d&&d.loaded&&(L=L+'<h1 class="picoctf-hide" id="campaign-status"><div class="campaign-status-background rtl-allowed"><div class="campaign-name rtl-allowed"><span>'+M.escape(null==(T=f(d.attributes,"fullName"))?"":T)+'</span></div><div class="levels-completed rtl-allowed"><span>'+M.escape(null==(T=e)?"":T)+"</span>/<span>"+M.escape(null==(T=t)?"":T)+"</span></div></div></h1>"),L+="</div>"}.call(this,"$"in e?e.$:void 0!==t?t:void 0,"Math"in e?e.Math:"undefined"!=typeof Math?Math:void 0,"_"in e?e._:"undefined"!=typeof _?_:void 0,"adjacentCampaigns"in e?e.adjacentCampaigns:"undefined"!=typeof adjacentCampaigns?adjacentCampaigns:void 0,"campaign"in e?e.campaign:"undefined"!=typeof campaign?campaign:void 0,"campaigns"in e?e.campaigns:"undefined"!=typeof campaigns?campaigns:void 0,"editorMode"in e?e.editorMode:"undefined"!=typeof editorMode?editorMode:void 0,"features"in e?e.features:"undefined"!=typeof features?features:void 0,"i18n"in e?e.i18n:"undefined"!=typeof i18n?i18n:void 0,"levelDifficultyMap"in e?e.levelDifficultyMap:"undefined"!=typeof levelDifficultyMap?levelDifficultyMap:void 0,"levelPlayCountMap"in e?e.levelPlayCountMap:"undefined"!=typeof levelPlayCountMap?levelPlayCountMap:void 0,"levelStatusMap"in e?e.levelStatusMap:"undefined"!=typeof levelStatusMap?levelStatusMap:void 0,"levels"in e?e.levels:"undefined"!=typeof levels?levels:void 0,"levelsCompleted"in e?e.levelsCompleted:"undefined"!=typeof levelsCompleted?levelsCompleted:void 0,"levelsTotal"in e?e.levelsTotal:"undefined"!=typeof levelsTotal?levelsTotal:void 0,"marked"in e?e.marked:"undefined"!=typeof marked?marked:void 0,"me"in e?e.me:"undefined"!=typeof me?me:void 0,"picoCTF"in e?e.picoCTF:"undefined"!=typeof picoCTF?picoCTF:void 0,"serverConfig"in e?e.serverConfig:"undefined"!=typeof serverConfig?serverConfig:void 0,"showGameDevAlert"in e?e.showGameDevAlert:"undefined"!=typeof showGameDevAlert?showGameDevAlert:void 0,"topScore"in e?e.topScore:"undefined"!=typeof topScore?topScore:void 0,"translate"in e?e.translate:"undefined"!=typeof translate?translate:void 0,"view"in e?e.view:"undefined"!=typeof view?view:void 0),L}}.call(this,i(3))},1609:function(e,t,i){var n=i(1610);(n="string"==typeof n?[[e.i,n,""]]:n).locals&&(e.exports=n.locals);(0,i(21).default)("49c539b6",n,!0,{})},1610:function(e,t,i){},1611:function(e,t,i){var p=i(11);e.exports=function(e){var h,u=[],e=e||{};return function(o,s,e,t,i,r,n,a,l,c){u.push('<div class="modal-dialog"><div class="modal-content"><img src="/images/pages/play/modal/choosehero-background.png" draggable="false" id="play-heroes-background"><h1 data-i18n="choose_hero.choose_hero"></h1><div id="gems-count-container"><span id="gems-count"><div class="gem gem-20"></div><span class="spl">'+p.escape(null==(h=i)?"":h)+'</span></span></div><div id="close-modal"><span class="glyphicon glyphicon-remove"></span></div><div id="hero-carousel" data-interval=\'0\' class="carousel slide"><div class="carousel-indicator-container"><ol class="carousel-indicators">'),function(){var e=r;if("number"==typeof e.length)for(var t=0,i=e.length;t<i;t++){var n=e[t];u.push("<li"+p.attr("data-hero-id",n.get("original"),!0,!0)+p.attr("title",n.name,!0,!0)+p.attr("data-slide-to",t,!0,!0)+' data-target="#hero-carousel"'+p.cls(["hero-indicator hero-index-"+t+(n.locked?" locked":"")+(n.purchasable?" purchasable":"")+(n.restricted?" restricted":"")+(n.unlockBySubscribing?" subscribe-unlock ":"")+(n.premium?" premium ":"")],[!0])+'><div class="hero-avatar"></div></li>')}else{i=0;for(t in e){i++;n=e[t];u.push("<li"+p.attr("data-hero-id",n.get("original"),!0,!0)+p.attr("title",n.name,!0,!0)+p.attr("data-slide-to",t,!0,!0)+' data-target="#hero-carousel"'+p.cls(["hero-indicator hero-index-"+t+(n.locked?" locked":"")+(n.purchasable?" purchasable":"")+(n.restricted?" restricted":"")+(n.unlockBySubscribing?" subscribe-unlock ":"")+(n.premium?" premium ":"")],[!0])+'><div class="hero-avatar"></div></li>')}}}.call(this),u.push('</ol></div><div class="carousel-inner">'),function(){var e=r;if("number"==typeof e.length)for(var t=0,i=e.length;t<i;t++){var o=e[t];u.push("<div"+p.attr("data-hero-id",o.get("original"),!0,!0)+p.cls(["item hero-item"+(o.locked?" locked":"")+(o.purchasable?" purchasable":"")+(o.restricted?" restricted":"")],[!0])+'><canvas class="hero-canvas"></canvas><div class="hero-pose-image"><img draggable="false"></div><div dir="auto" class="hero-stats rtl-allowed"><h2>'+p.escape(null==(h=o.name)?"":h)+'</h2><div class="hero-description">'+p.escape(null==(h=o.description)?"":h)+'</div><div class="hero-stat-row"><div data-i18n="leaderboard.difficulty" class="stat-label"></div><div'+p.attr("data-i18n","ranger"==o.class?"general.medium":"wizard"==o.class?"general.hard":"general.easy",!0,!0)+' class="stat-value hero-status-value"></div></div><div class="hero-stat-row"><div data-i18n="editor.level_components_type" class="stat-label"></div><div'+p.attr("data-i18n","general."+o.class,!0,!0)+' class="stat-value"></div></div><div class="hero-stat-row"><div data-i18n="choose_hero.weapons" class="stat-label"></div><div'+p.attr("data-i18n","choose_hero.weapons_"+o.class,!0,!0)+' class="stat-value"></div></div>'),o.stats&&(o.stats.skills.length&&u.push('<div class="hero-stat-row"><div data-i18n="choose_hero.skills" class="stat-label"></div><div class="stat-value">'+p.escape(null==(h=o.stats.skills.join(", "))?"":h)+"</div></div>"),function(){var e=["attack","health","speed"];if("number"==typeof e.length)for(var t=0,i=e.length;t<i;t++){var n=e[t];u.push("<div"+p.attr("title",o.stats[n].description,!0,!0)+p.cls(["hero-stat-row",n],[null,!0])+"><div"+p.attr("data-i18n","choose_hero."+n,!0,!0)+' class="stat-label"></div><div class="stat-value"><div class="stat-progress"><div'+p.attr("style","width: "+a(100*o.stats[n].relative)+"%",!0,!0)+' class="stat-progress-bar"></div></div></div></div>')}else{i=0;for(t in e){i++;n=e[t];u.push("<div"+p.attr("title",o.stats[n].description,!0,!0)+p.cls(["hero-stat-row",n],[null,!0])+"><div"+p.attr("data-i18n","choose_hero."+n,!0,!0)+' class="stat-label"></div><div class="stat-value"><div class="stat-progress"><div'+p.attr("style","width: "+a(100*o.stats[n].relative)+"%",!0,!0)+' class="stat-progress-bar"></div></div></div></div>')}}}.call(this)),u.push("</div></div>")}else{i=0;for(t in e){i++;o=e[t];u.push("<div"+p.attr("data-hero-id",o.get("original"),!0,!0)+p.cls(["item hero-item"+(o.locked?" locked":"")+(o.purchasable?" purchasable":"")+(o.restricted?" restricted":"")],[!0])+'><canvas class="hero-canvas"></canvas><div class="hero-pose-image"><img draggable="false"></div><div dir="auto" class="hero-stats rtl-allowed"><h2>'+p.escape(null==(h=o.name)?"":h)+'</h2><div class="hero-description">'+p.escape(null==(h=o.description)?"":h)+'</div><div class="hero-stat-row"><div data-i18n="leaderboard.difficulty" class="stat-label"></div><div'+p.attr("data-i18n","ranger"==o.class?"general.medium":"wizard"==o.class?"general.hard":"general.easy",!0,!0)+' class="stat-value hero-status-value"></div></div><div class="hero-stat-row"><div data-i18n="editor.level_components_type" class="stat-label"></div><div'+p.attr("data-i18n","general."+o.class,!0,!0)+' class="stat-value"></div></div><div class="hero-stat-row"><div data-i18n="choose_hero.weapons" class="stat-label"></div><div'+p.attr("data-i18n","choose_hero.weapons_"+o.class,!0,!0)+' class="stat-value"></div></div>'),o.stats&&(o.stats.skills.length&&u.push('<div class="hero-stat-row"><div data-i18n="choose_hero.skills" class="stat-label"></div><div class="stat-value">'+p.escape(null==(h=o.stats.skills.join(", "))?"":h)+"</div></div>"),function(){var e=["attack","health","speed"];if("number"==typeof e.length)for(var t=0,i=e.length;t<i;t++){var n=e[t];u.push("<div"+p.attr("title",o.stats[n].description,!0,!0)+p.cls(["hero-stat-row",n],[null,!0])+"><div"+p.attr("data-i18n","choose_hero."+n,!0,!0)+' class="stat-label"></div><div class="stat-value"><div class="stat-progress"><div'+p.attr("style","width: "+a(100*o.stats[n].relative)+"%",!0,!0)+' class="stat-progress-bar"></div></div></div></div>')}else{i=0;for(t in e){i++;n=e[t];u.push("<div"+p.attr("title",o.stats[n].description,!0,!0)+p.cls(["hero-stat-row",n],[null,!0])+"><div"+p.attr("data-i18n","choose_hero."+n,!0,!0)+' class="stat-label"></div><div class="stat-value"><div class="stat-progress"><div'+p.attr("style","width: "+a(100*o.stats[n].relative)+"%",!0,!0)+' class="stat-progress-bar"></div></div></div></div>')}}}.call(this)),u.push("</div></div>")}}}.call(this),u.push('</div><a role="button" data-slide="prev" href="#hero-carousel" class="left"><span class="glyphicon glyphicon-play"></span></a><a role="button" data-slide="next" href="#hero-carousel" class="right"><span class="glyphicon glyphicon-play"></span></a></div><div id="hero-footer">'),c&&(c.get("original")?c.restricted?u.push('<div id="hero-footer-text-background"><div class="image-block"><img src="/images/pages/play/modal/language-selector-background.png"></div></div><div id="restricted-hero-explanation"><h2><span>'+p.escape(null==(h=c.name)?"":h)+'</span><span data-i18n="inventory.restricted_title" class="spl">Restricted</span></h2><span data-i18n="choose_hero.restricted_to_certain_heroes" class="spr">Only certain heroes can play this level.</span></div><button id="restricted-hero-button" data-i18n="inventory.restricted_title" class="btn disabled btn-illustrated">Restricted</button>'):c.purchasable?(u.push('<div id="hero-footer-text-background"><div class="image-block"><img src="/images/pages/play/modal/language-selector-background.png"></div></div><div id="purchasable-hero-explanation"><h2 data-i18n="choose_hero.available_for_purchase">Available for Purchase</h2></div><button id="purchase-hero-button" class="btn unlock-button"><span data-i18n="play.unlock" class="spr">Unlock</span>'),c.get("gems")||(t.error("Huh, we loaded the hero with no gem cost."),c.set("gems",{ninja:400,librarian:630,samurai:1e3,trapper:1400,"potion-master":1800,"forest-archer":2500,sorcerer:3400,raiser:4600,necromancer:6300,pixie:8500,goliath:12e3,guardian:16e3,"master-wizard":21e3,assassin:29e3}[c.get("slug")]||99999)),u.push("<span>"+p.escape(null==(h=c.get("gems"))?"":h)+'</span><span class="gem gem-20"></span></button>')):c.locked?u.push('<div id="hero-footer-text-background"><div class="image-block"><img src="/images/pages/play/modal/language-selector-background.png"></div></div><div id="locked-hero-explanation"><h2'+p.attr("data-i18n",c.unlockBySubscribing?"play.subscribe_unlock":"play.subscribers_only",!0,!0)+"></h2><span"+p.attr("data-i18n",c.unlockBySubscribing?"play.subscriber_heroes":"play.subscriber_gems",!0,!0)+' class="spr subscribers"></span></div><button id="subscribe-hero-button"'+p.attr("data-hero-slug",c.get("slug"),!0,!0)+' class="btn subscribe-button"><span data-i18n="subscribe.subscribe_title" class="spr">Subscribe</span></button>'):c.loaded&&(n.isStudent()||(u.push('<div id="hero-footer-text-background"><div class="image-block"><img src="/images/pages/play/modal/language-selector-background.png"></div></div><div class="form"><div class="form-group select-group"><span data-i18n="choose_hero.programming_language_description" class="help-block">Which programming language do you want to use?</span><select id="option-code-language" name="code-language">'),function(){var e=s;if("number"==typeof e.length)for(var t=0,i=e.length;t<i;t++){var n=e[t];u.push("<option"+p.attr("value",n.id,!0,!0)+p.attr("selected",o===n.id,!0,!0)+">"+p.escape(null==(h=n.name)?"":h)+"</option>")}else{i=0;for(t in e){i++;n=e[t];u.push("<option"+p.attr("value",n.id,!0,!0)+p.attr("selected",o===n.id,!0,!0)+">"+p.escape(null==(h=n.name)?"":h)+"</option>")}}}.call(this),u.push("</select></div></div>")),u.push('<a id="confirm-button"'+p.attr("data-i18n",e,!0,!0)+"></a>")):u.push('<div id="loading-hero-explanation"><h2 data-i18n="common.loading">Loading...</h2></div>')),u.push("</div></div></div>")}.call(this,"codeLanguage"in e?e.codeLanguage:"undefined"!=typeof codeLanguage?codeLanguage:void 0,"codeLanguages"in e?e.codeLanguages:"undefined"!=typeof codeLanguages?codeLanguages:void 0,"confirmButtonI18N"in e?e.confirmButtonI18N:"undefined"!=typeof confirmButtonI18N?confirmButtonI18N:void 0,"console"in e?e.console:"undefined"!=typeof console?console:void 0,"gems"in e?e.gems:"undefined"!=typeof gems?gems:void 0,"heroes"in e?e.heroes:"undefined"!=typeof heroes?heroes:void 0,"me"in e?e.me:"undefined"!=typeof me?me:void 0,"parseInt"in e?e.parseInt:"undefined"!=typeof parseInt?parseInt:void 0,"undefined"in e?e.undefined:void 0,"visibleHero"in e?e.visibleHero:"undefined"!=typeof visibleHero?visibleHero:void 0),u.join("")}},1612:function(e,t,i){var n=i(1613);(n="string"==typeof n?[[e.i,n,""]]:n).locals&&(e.exports=n.locals);(0,i(21).default)("ddbcac90",n,!0,{})},1613:function(e,t,i){},1614:function(e,t,i){var n=i(1615);(n="string"==typeof n?[[e.i,n,""]]:n).locals&&(e.exports=n.locals);(0,i(21).default)("7d5ab28e",n,!0,{})},1615:function(e,t,i){},1616:function(e,t,i){var a=i(11);e.exports=function(e){var s,r=[],e=e||{};return function(e,t,o){r.push('<div class="modal-dialog"><div class="modal-content"> '),"purchasing"===o.state?r.push('<div data-i18n="buy_gems.purchasing" class="alert alert-info"></div>'):"retrying"===o.state?r.push('<div id="retrying-alert" data-i18n="buy_gems.retrying" class="alert alert-danger"></div>'):("nl"==(e.get("preferredLanguage",!0)||"en-US").split("-")[0]?r.push('<img src="/images/pages/play/modal/lang-nl/buy-gems-background-NL.png" id="buy-gems-background">'):r.push('<img src="/images/pages/play/modal/buy-gems-background.png" id="buy-gems-background">'),r.push('<h1 data-i18n="play.buy_gems"> </h1><div id="products">'),o.supermodel.finished()&&(function(){var e=o.products.models;if("number"==typeof e.length)for(var t=0,i=e.length;t<i;t++){var n=e[t];r.push('<div class="product"><h4>x'+a.escape(null==(s=n.get("gems"))?"":s)+"</h4><h3"+a.attr("data-i18n",o.getProductDescription(n.get("name")),!0,!0)+"></h3><button"+a.attr("value",n.get("name"),!0,!0)+' class="btn btn-illustrated btn-lg"><span>'+a.escape(null==(s=n.get("priceString"))?"":s)+"</span></button></div>")}else{i=0;for(t in e){i++;n=e[t];r.push('<div class="product"><h4>x'+a.escape(null==(s=n.get("gems"))?"":s)+"</h4><h3"+a.attr("data-i18n",o.getProductDescription(n.get("name")),!0,!0)+"></h3><button"+a.attr("value",n.get("name"),!0,!0)+' class="btn btn-illustrated btn-lg"><span>'+a.escape(null==(s=n.get("priceString"))?"":s)+"</span></button></div>")}}}.call(this),"nl"==(e.get("preferredLanguage",!0)||"en-US").split("-")[0]&&r.push('<div class="product"><h4 class="subscription-gem-amount">x{{gems}} / mo</h4><h3> \n1, 3, 6 OF 12 <br>MAANDEN</h3><a href="http://www.codecombat.nl/kopen" target="_blank"><button class="btn btn-ideal btn-illustrated btn-lg btn-succes">PREPAID CODES</button></a></div>'),o.basicProduct?(r.push('<div class="product"><h3 data-i18n="account.subscribe_for_gems" class="subscribe-text"></h3>'),e.hasSubscription()?r.push('<button class="disabled start-subscription-button btn btn-lg btn-illustrated btn-success"> <span data-i18n="account.subscribed"></span></button>'):r.push('<button data-i18n="subscribe.subscribe_title" class="start-subscription-button btn btn-lg btn-illustrated btn-success"></button>'),r.push("</div>")):o.lifetimeProduct&&(r.push('<div class="product"><h4 class="subscription-gem-amount">x'+a.escape(null==(s=o.lifetimeProduct.get("gems"))?"":s)+'</h4><h3 data-i18n="buy_gems.buy_premium"></h3>'),e.isForeverPremium()?r.push('<button class="disabled start-subscription-button btn btn-lg btn-illustrated btn-success"> <span data-i18n="buy_gems.purchased"></span></button>'):r.push('<button data-i18n="buy_gems.purchase" class="start-subscription-button btn btn-lg btn-illustrated btn-success"></button>'),r.push("</div>"))),r.push("</div>"),"declined"===o.state&&r.push('<div id="declined-alert" class="alert alert-danger alert-dismissible"><span data-i18n="buy_gems.declined"></span><button type="button" data-dismiss="alert" class="close"><span aria-hidden="true">&times;      </span></button></div>'),"unknown_error"===o.state&&r.push('<div id="error-alert" class="alert alert-danger alert-dismissible"><button type="button" data-dismiss="alert" class="close"><span aria-hidden="true">&times;</span></button><p data-i18n="loading_error.unknown"></p><p>'+a.escape(null==(s=o.stateMessage)?"":s)+"</p></div>"),"recovered_charge"===o.state&&r.push('<div id="recovered-alert" class="alert alert-danger alert-dismissible"><span data-i18n="buy_gems.recovered"></span><button type="button" data-dismiss="alert" class="close"><span aria-hidden="true">&times;</span></button></div>'),r.push('<div id="close-modal"><span class="glyphicon glyphicon-remove"></span></div>')),r.push("</div></div>")}.call(this,"me"in e?e.me:"undefined"!=typeof me?me:void 0,"undefined"in e?e.undefined:void 0,"view"in e?e.view:"undefined"!=typeof view?view:void 0),r.join("")}},1617:function(y,e,S){!function(b,v){var t,s,i,e,n,l,o,r,d,a,c,w,h,k,u,p,m={}.hasOwnProperty,x=[].indexOf||function(e){for(var t=0,i=this.length;t<i;t++)if(t in this&&this[t]===e)return t;return-1},f=[].slice;function g(){return g.__super__.constructor.apply(this,arguments)}S(1618),S(1498),n=S(80),p=S(1621),a=S(1461),c=S(1462),u=S(1463),k=S(44).me,r=S(1374),d=S(639),s=S(115),S(1622),S(1393),e=S(1499),l=S(1388),t=S(1437),i=S(118),o=S(622),S(1391),S(1392),h=!1,y.exports=(function(e,t){for(var i in t)m.call(t,i)&&(e[i]=t[i]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(g,n),g.prototype.id="inventory-modal",g.prototype.className="modal fade play-modal",g.prototype.template=p,g.prototype.slots=["head","eyes","neck","torso","wrists","gloves","left-ring","right-ring","right-hand","left-hand","waist","feet","programming-book","pet","minion","flag"],g.prototype.ringSlots=["left-ring","right-ring"],g.prototype.closesOnClickOutside=!1,g.prototype.events={"click .item-slot":"onItemSlotClick","click #unequipped .item":"onUnequippedItemClick","doubletap #unequipped .item":"onUnequippedItemDoubleClick","doubletap .item-slot .item":"onEquippedItemDoubleClick","click button.equip-item":"onClickEquipItemButton","shown.bs.modal":"onShown","click #choose-hero-button":"onClickChooseHero","click #play-level-button":"onClickPlayLevel","click .unlock-button":"onUnlockButtonClicked","click #equip-item-viewed":"onClickEquipItemViewed","click #unequip-item-viewed":"onClickUnequipItemViewed","click #subscriber-item-viewed":"onClickSubscribeItemViewed","click #close-modal":"hide","click .buy-gems-prompt-button":"onBuyGemsPromptButtonClicked","click .start-subscription-button":"onSubscribeButtonClicked",click:"onClickedSomewhere","update #unequipped .nano":"onScrollUnequipped"},g.prototype.shortcuts={esc:"clearSelection",enter:"onClickPlayLevel"},g.prototype.initialize=function(e){var t,i,n,o;if("game-dev-hoc-2"===b.getHocCampaign())for(k.get("earned")||k.set("earned",{}),k.get("earned").items||(k.attributes.earned.items=[]),i=0,o=(t=["53e2384453457600003e3f07","53e218d853457600003e3ebe","53e22aa153457600003e3ef5","5744e3683af6bf590cd27371"]).length;i<o;i++)n=t[i],x.call(k.get("earned").items,n)<0&&k.get("earned").items.push(n);return this.onScrollUnequipped=_.throttle(_.bind(this.onScrollUnequipped,this),200),g.__super__.initialize.apply(this,arguments),this.items=new s([],{model:r}),this.items.url="/db/thang.type?view=items",this.items.setProjection(["name","slug","components","original","rasterIcon","dollImages","gems","tier","description","heroClass","i18n","subscriber"]),this.supermodel.loadCollection(this.items,"items"),this.equipment={}},g.prototype.onItemsLoaded=function(){var e,t,i,n,o,s,r,a,l,c,h,u,p,d,m;for(console.log("Inside onItemsLoaded"),t=0,s=(l=this.items.models).length;t<s;t++)(i=l[t]).notInLevel=!0,c=null!=(c=_.find(i.get("components"),function(e){return null!=(e=e.config)?e.programmableProperties:void 0}))?c.config:void 0,i.programmableProperties=((null!=c?c.programmableProperties:void 0)||[]).concat((null!=c?c.moreProgrammableProperties:void 0)||[]);for(this.itemsProgrammablePropertiesConfigured=!0,k.isStudent()&&!b.getHocCampaign()?this.equipment=(null!=(h=k.get("heroConfig"))?h.inventory:void 0)||{}:this.equipment=this.options.equipment||(null!=(h=this.options.session)&&null!=(u=h.get("heroConfig"))?u.inventory:void 0)||(null!=(u=k.get("heroConfig"))?u.inventory:void 0)||{},this.equipment=v.extend(!0,{},this.equipment),console.log("requireLevelEquipment called from onItemsLoaded"),this.requireLevelEquipment(),this.itemGroups={},this.itemGroups.requiredPurchaseItems=new Backbone.Collection,this.itemGroups.availableItems=new Backbone.Collection,this.itemGroups.restrictedItems=new Backbone.Collection,this.itemGroups.lockedItems=new Backbone.Collection,this.itemGroups.subscriberItems=new Backbone.Collection,n=0,r=(p=_.values(this.itemGroups)).length;n<r;n++)p[n].comparator=function(e){var t;return null!=(t=e.get("tier"))?t:e.get("gems")};for(e=_.values(this.equipment),m=[],o=0,a=(d=this.items.models).length;o<a;o++)i=d[o],m.push(this.sortItem(i,e));return m},g.prototype.sortItem=function(e,t){var i,n,o,s,r,a,l,c,h,u,p,d,m,f,g,y;for(console.log("Inside sortItem"),null==t&&(t=_.values(this.equipment)),e.classes=_.clone(e.getAllowedSlots()),o=0,r=(c=e.getAllowedHeroClasses()).length;o<r;o++)n=c[o],e.classes.push(n);if(p=e.get("original"),0<=x.call(t,p)&&e.classes.push("equipped"),l=!k.ownsItem(e.get("original")),y=!k.isStudent()&&!k.isPremium()&&e.get("subscriber"),t=this.calculateRestrictedGearPerSlot(),i=_.flatten(_.values(t)),p=e.get("original"),t=0<=x.call(i,p),f=!1,p=v("#campaign-view").length,"tarnished-bronze-breastplate"!==w[e.get("original")]||!p||"the-raised-sword"!==this.options.level.get("slug"))for(d=this.calculateRequiredGearPerSlot(),s=0,a=(h=e.getAllowedSlots()).length;s<a;s++)if((m=d[g=h[s]])&&!(this.equipment[g]&&(u=this.equipment[g],x.call(i,u)<0)&&x.call(this.ringSlots,g)<0||e.get("original")!==m[0]||_.find(m,function(e){return k.ownsItem(e)}))){f=!0;break}if(f&&l&&!e.get("gems")&&(null!=(p=b.tracker)&&p.trackEvent("Required Item Locked",{level:this.options.level.get("slug"),label:this.options.level.get("slug"),item:e.get("name"),playerLevel:k.level(),levelUnlocked:k.ownsLevel(this.options.level.get("original"))}),l=!1),!e.getFrontFacingStats().props.length&&!_.size(e.getFrontFacingStats().stats)&&l||(l&&f?(e.classes.push("locked"),this.itemGroups.requiredPurchaseItems.add(e)):l?(e.classes.push("locked"),e.isSilhouettedItem()||!e.get("gems")||this.itemGroups.lockedItems.add(e)):t?(this.itemGroups.restrictedItems.add(e),e.classes.push("restricted")):y&&!b.getHocCampaign()?(this.itemGroups.subscriberItems.add(e),e.classes.push("subscriber")):this.itemGroups.availableItems.add(e)),null!=e.get("tier"))return e.level=e.levelRequiredForItem()},g.prototype.onLoaded=function(){return console.log("Inside onLoaded"),this.onItemsLoaded(),g.__super__.onLoaded.call(this)},g.prototype.getRenderData=function(e){var t,i,n,o;for(o in null==e&&(e={}),console.log("Inside getRenderData"),(e=g.__super__.getRenderData.call(this,e)).equipped=_.values(this.equipment),e.items=this.items.models,e.itemGroups=this.itemGroups,e.slots=this.slots,e.selectedHero=this.selectedHero,e.selectedHeroClass=null!=(i=this.selectedHero)?i.get("heroClass"):void 0,e.equipment=_.clone(this.equipment),n=e.equipment)t=n[o],e.equipment[o]=this.items.findWhere({original:t});return e.gems=k.gems(),e},g.prototype.afterRender=function(){if(console.log("Inside afterRender"),g.__super__.afterRender.call(this),this.$el.find("#play-level-button").css("visibility","hidden"),this.supermodel.finished())return this.$el.find("#play-level-button").css("visibility","visible"),this.setUpDraggableEventsForAvailableEquipment(),this.setUpDraggableEventsForEquippedArea(),this.delegateEvents(),this.itemDetailsView=new e,this.insertSubView(this.itemDetailsView),console.log("requireLevelEquipment called from afterRender"),this.requireLevelEquipment(),this.$el.find(".nano").nanoScroller({alwaysVisible:!0}),this.onSelectionChanged(),this.onEquipmentChanged()},g.prototype.afterInsert=function(){return console.log("Inside afterInsert"),g.__super__.afterInsert.call(this),this.canvasWidth=this.$el.find("canvas").innerWidth(),this.canvasHeight=this.$el.find("canvas").innerHeight(),this.inserted=!0,console.log("requireLevelEquipment called from afterInsert"),this.requireLevelEquipment()},g.prototype.setUpDraggableEventsForAvailableEquipment=function(){var e,t,i,n,o,s;for(console.log("Inside setUpDraggableEventForAvailableEquipment"),s=[],i=0,n=(o=this.$el.find("#unequipped .item")).length;i<n;i++)e=o[i],(e=v(e)).hasClass("locked")||e.hasClass("restricted")||(t=e.clone().addClass("draggable-item"),s.push(function(i){return function(e,t){return t.draggable({revert:"invalid",appendTo:i.$el,cursorAt:{left:35.5,top:35.5},helper:function(){return e},revertDuration:200,distance:10,scroll:!1,zIndex:1100}),t.on("dragstart",function(){return i.selectUnequippedItem(t)})}}(this)(t,e)));return s},g.prototype.setUpDraggableEventsForEquippedArea=function(){var e,t,i,n,o,s,r;for(console.log("Inside setUpDraggableEventsForEquippedArea"),o=this.$el.find(".item-slot"),s=this,e=function(t,e){return v(e).droppable({drop:function(e,t){return s.equipSelectedItem()},accept:function(e){return v(e).parent().hasClass(t)},activeClass:"droppable",hoverClass:"droppable-hover",tolerance:"touch"}),s.makeEquippedSlotDraggable(v(e))},t=0,n=o.length;t<n;t++)i=o[t],e(v(i).data("slot"),i);return this.$el.find("#equipped").droppable({drop:(r=this,function(e,t){return r.equipSelectedItem()}),accept:function(e){return!0},activeClass:"droppable",hoverClass:"droppable-hover",tolerance:"pointer"})},g.prototype.makeEquippedSlotDraggable=function(t){var e,i,n,o;return console.log("Inside makeEquippedSlotDraggable"),n=this,i=function(){var e=n.unequipItemFromSlot(t).data("item-id"),e=n.items.get(e);return n.requireLevelEquipment(),n.showItemDetails(e,"equip"),n.onSelectionChanged(),n.onEquipmentChanged()},e=function(e){var t=v(this).position(),t=Math.abs(t.left)<v(this).outerWidth()&&Math.abs(t.top)<v(this).outerHeight();return t||i(),t},v(t).find("img").draggable({revert:e,appendTo:this.$el,cursorAt:{left:35.5,top:35.5},revertDuration:200,distance:10,scroll:!1,zIndex:100}),t.on("dragstart",(o=this,function(){return o.selectItemSlot(t)}))},g.prototype.onItemSlotClick=function(e){var t;if(this.closePopover(),null==(t=this.remainingRequiredEquipment)||!t.length)return this.selectItemSlot(v(e.target).closest(".item-slot"))},g.prototype.onUnequippedItemClick=function(e){if(this.closePopover(),!this.justDoubleClicked&&!this.justClickedEquipItemButton)return e=v(e.target).closest(".item"),this.selectUnequippedItem(e)},g.prototype.onUnequippedItemDoubleClick=function(e){var t,e=v(e.target).closest(".item");if(!(e.hasClass("locked")||e.hasClass("restricted")||e.hasClass("subscriber")))return this.equipSelectedItem(),this.justDoubleClicked=!0,_.defer((t=this,function(){return t.justDoubleClicked=!1}))},g.prototype.onEquippedItemDoubleClick=function(){return this.unequipSelectedItem()},g.prototype.onClickEquipItemViewed=function(){return this.equipSelectedItem()},g.prototype.onClickUnequipItemViewed=function(){return this.unequipSelectedItem()},g.prototype.onClickEquipItemButton=function(e){var t;return this.playSound("menu-button-click"),e=v(e.target).closest(".item"),this.selectUnequippedItem(e),this.equipSelectedItem(),this.justClickedEquipItemButton=!0,_.defer((t=this,function(){return t.justClickedEquipItemButton=!1}))},g.prototype.onClickSubscribeItemViewed=function(e){var t,i;return this.openModalView(new o),i=this.$el.find(".item.active"),t=this.items.get(null!=i?i.data("item-id"):void 0),null!=(i=window.tracker)?i.trackEvent("Show subscription modal",{category:"Subscription",label:"inventory modal: "+((null!=t?t.get("slug"):void 0)||"unknown")}):void 0},g.prototype.selectItemSlot=function(e){return this.clearSelection(),e.addClass("selected"),e=e.find(".item").data("item-id"),(e=this.items.get(e))&&this.showItemDetails(e,"unequip"),this.onSelectionChanged()},g.prototype.selectUnequippedItem=function(e){var t;return this.clearSelection(),e.addClass("active"),t=e.hasClass("restricted")?"restricted":e.hasClass("subscriber")?"subscriber":e.hasClass("locked")?"":"equip",this.showItemDetails(this.items.get(e.data("item-id")),t),this.onSelectionChanged()},g.prototype.equipSelectedItem=function(){var e,t,i,n,o,s,r,a=this.getSelectedUnequippedItem(),l=this.items.get(a.data("item-id"));if(l){for(i=r=null,n=0,o=(t=l.getAllowedSlots()).length;n<o;n++)e=t[n],s=this.$el.find(".item-slot[data-slot='"+e+"']"),null==i&&(i=s),s.find("img").length||null==r&&(r=s);return a.effect("transfer",{to:s=null!=r?r:i,duration:500,easing:"easeOutCubic"}),this.unequipItemFromSlot(s),a.addClass("equipped"),s.append(a.find("img").clone().addClass("item").data("item-id",l.id)),this.clearSelection(),this.showItemDetails(l,"unequip"),s.addClass("selected"),l.classes.push("equipped"),this.makeEquippedSlotDraggable(s),this.requireLevelEquipment(),this.onSelectionChanged(),this.onEquipmentChanged()}},g.prototype.unequipSelectedItem=function(){var e,t=this.getSelectedSlot();if(this.clearSelection(),null!=(e=this.unequipItemFromSlot(t))&&e.length)return e.addClass("active"),t.effect("transfer",{to:e,duration:500,easing:"easeOutCubic"}),e=e.data("item-id"),(e=this.items.get(e)).classes=_.without(e.classes,"equipped"),this.showItemDetails(e,"equip"),this.requireLevelEquipment(),this.onSelectionChanged(),this.onEquipmentChanged()},g.prototype.clearSelection=function(){return this.deselectAllSlots(),this.deselectAllUnequippedItems(),this.hideItemDetails()},g.prototype.unequipItemFromSlot=function(e){var t=e.find(".item"),e=t.data("item-id");if(e)return t.remove(),(t=this.items.get(e)).classes=_.without(t.classes,"equipped"),this.$el.find("#unequipped .item[data-item-id="+e+"]").removeClass("equipped")},g.prototype.deselectAllSlots=function(){return this.$el.find("#equipped .item-slot.selected").removeClass("selected")},g.prototype.deselectAllUnequippedItems=function(){return this.$el.find("#unequipped .item").removeClass("active")},g.prototype.getSlot=function(e){return this.$el.find(".item-slot[data-slot="+e+"]")},g.prototype.getSelectedSlot=function(){return this.$el.find("#equipped .item-slot.selected")},g.prototype.getSelectedUnequippedItem=function(){return this.$el.find("#unequipped .item.active")},g.prototype.onSelectionChanged=function(){var e=null!=(t=this.selectedHero)?t.get("heroClass"):void 0,t=this.$el.find("#unequipped .item.available:not(.equipped)").filter("."+e).length,e=this.$el.find("#double-click-hint, #available-description");return t?e.removeClass("secret"):e.addClass("secret"),this.delegateEvents()},g.prototype.showItemDetails=function(e,t){return this.itemDetailsView.setItem(e),this.$el.find("#item-details-extra > *").addClass("secret"),this.$el.find("#"+t+"-item-viewed").removeClass("secret")},g.prototype.hideItemDetails=function(){var e;return null!=(e=this.itemDetailsView)&&e.setItem(null),this.$el.find("#item-details-extra > *").addClass("secret")},g.prototype.getCurrentEquipmentConfig=function(){for(var e,t,i={},n=this.$el.find(".item-slot"),o=0,s=n.length;o<s;o++)e=n[o],t=v(e).data("slot"),(e=v(e).find(".item").data("item-id"))&&(e=_.find(this.items.models,{id:e}),i[t]=e.get("original"));return i},g.prototype.requireLevelEquipment=function(){var e,t;if(console.log("Inside requireLevelEquipment"),console.log(this.items),this.inserted&&this.itemsProgrammablePropertiesConfigured)return e=this.supermodel.finished()?this.getCurrentEquipmentConfig():this.equipment,t=null!=(t=this.remainingRequiredEquipment)?t.length:void 0,this.remainingRequiredEquipment=[],this.$el.find(".should-equip").removeClass("should-equip"),this.unequipClassRestrictedItems(e),this.unequipLevelRestrictedItems(e),this.updateLevelRequiredItems(e),console.log("@remainingRequiredEquipment.length: "+this.remainingRequiredEquipment.length),t&&!this.remainingRequiredEquipment.length&&(this.endHighlight(),this.highlightElement("#play-level-button",{duration:5e3})),v("#play-level-button").prop("disabled",0<this.remainingRequiredEquipment.length)},g.prototype.unequipClassRestrictedItems=function(e){var t,i,n,o,s,r;if(console.log("Inside unequipClassRestrictedItems"),this.supermodel.finished()&&(t=null!=(n=this.selectedHero)?n.get("heroClass"):void 0)){for(r in s=[],o=_.clone(e))i=o[r],(i=this.items.findWhere({original:i}))&&0<=x.call(i.classes,t)?s.push(void 0):(console.log("Unequipping",i.get("heroClass"),"item",i.get("name"),"from slot due to class restrictions."),this.unequipItemFromSlot(this.$el.find(".item-slot[data-slot='"+r+"']")),s.push(delete e[r]));return s}},g.prototype.calculateRequiredGearPerSlot=function(){var e,t,i,n,o,s,r,a,l,c,h,u,p,d,m,f,g,y,v;if(k.isStudent()&&!b.getHocCampaign()&&!k.showGearRestrictionsInClassroom())return{};if(this.requiredGearPerSlot)return this.requiredGearPerSlot;for(p=null!=(l=_.clone(this.options.level.get("requiredGear")))?l:{},d=null!=(l=this.options.level.get("requiredProperties"))?l:[],g=null!=(l=this.options.level.get("restrictedProperties"))?l:[],f={},e=0,o=(c=this.items.models).length;e<o;e++)if(t=c[e],m=_.intersection(t.programmableProperties,d),y=_.intersection(t.programmableProperties,g),m.length&&!y.length)for(i=0,s=(h=t.getAllowedSlots()).length;i<s;i++)if("right-hand"===(v=h[i])||!_.isEqual(m,["buildXY"]))for(null==p[v]&&(p[v]=[]),u=t.get("original"),x.call(p[v],u)<0&&p[v].push(t.get("original")),null==f[v]&&(f[v]=[]),n=0,r=m.length;n<r;n++)a=m[n],x.call(f[v],a)<0&&f[v].push(a);return this.requiredPropertiesPerSlot=f,this.requiredGearPerSlot=p,this.requiredGearPerSlot},g.prototype.calculateRestrictedGearPerSlot=function(){var e,t,i,n,o,s,r,a,l,c,h,u,p;if(k.isStudent()&&!b.getHocCampaign()&&!k.showGearRestrictionsInClassroom())return{};if(this.restrictedGearPerSlot)return this.restrictedGearPerSlot;for(this.requiredGearPerSlot||this.calculateRequiredGearPerSlot(),c=null!=(s=_.clone(this.options.level.get("restrictedGear")))?s:{},h=null!=(s=this.options.level.get("restrictedProperties"))?s:[],e=0,n=(r=this.items.models).length;e<n;e++)for(t=r[e],u=_.intersection(t.programmableProperties,h),i=0,o=(a=t.getAllowedSlots()).length;i<o;i++)p=a[i],l=_.without.apply(_,[this.requiredPropertiesPerSlot[p]].concat(f.call(t.programmableProperties))),0<=x.call(l,"cleave")&&x.call(t.getAllowedHeroClasses(),"Warrior")<0&&!u.length||(u.length||l.length)&&(null==c[p]&&(c[p]=[]),l=t.get("original"),x.call(c[p],l)<0&&c[p].push(t.get("original")));return this.restrictedGearPerSlot=c,this.restrictedGearPerSlot},g.prototype.unequipLevelRestrictedItems=function(e){var t,i,n,o,s,r,a;for(a in console.log("Inside unequipLevelRestrictedItems"),r=this.calculateRestrictedGearPerSlot())for(i=0,s=(o=r[a]).length;i<s;i++)n=o[i],(t=e[a])&&t===n&&(console.log("Unequipping restricted item",t,"for",a,"before level",this.options.level.get("slug")),this.unequipItemFromSlot(this.$el.find(".item-slot[data-slot='"+a+"']")),delete e[a]);return null},g.prototype.updateLevelRequiredItems=function(t){var e,o,s,i,n,r,a,l,c,h;if(console.log("inside updateLevelRequiredItems"),o=null!=(a=this.selectedHero)?a.get("heroClass"):void 0){for(c in l=this.calculateRequiredGearPerSlot(),console.log("inside executtion of updateLevelRequiredItems"),l)(r=l[c]).length&&((0<=x.call(this.ringSlots,c)?this.ringSlots:[c]).some(function(e){e=t[e];return 0<=x.call(r,e)})||t[c]&&x.call(this.ringSlots,c)<0||(r=function(){for(var e,t=[],i=0,n=r.length;i<n;i++)s=r[i],0<=x.call(null!=(e=null!=(e=this.items.findWhere({original:s}))?e.classes:void 0)?e:[],o)&&t.push(s);return t}.call(this)).length&&(r=_.sortBy(r,function(t){return function(e){return null!=(e=t.items.findWhere({original:e}).get("tier"))?e:9001}}(this)),e=_.findLast(r,function(e){return k.ownsItem(e)}),s=null!=e?e:r[0],h=w[s],n=v("#campaign-view").length,"tarnished-bronze-breastplate"===h&&n&&"the-raised-sword"===this.options.level.get("slug")||(i="#unequipped .item[data-item-id='"+this.items.findWhere({original:s}).id+"']",this.highlightElement(i,{delay:500,sides:["right"],rotation:Math.PI/2}),e=this.$el.find(i).addClass("should-equip"),this.$el.find("#equipped div[data-slot='"+c+"']").addClass("should-equip"),(n=null!=(h=e[0])?h.offsetTop:void 0)&&(i=n+e.outerHeight(!0),h=e.parent().height(),i>e.parent().scrollTop()+h?e.parent().scrollTop(i-h):n<e.parent().scrollTop()&&e.parent().scrollTop(n)),this.remainingRequiredEquipment.push({slot:c,item:s}))));return null}},g.prototype.setHero=function(e){var t;if(this.selectedHero=e,!this.selectedHero.loading)return this.$el.removeClass("Warrior Ranger Wizard").addClass(this.selectedHero.get("heroClass")),this.requireLevelEquipment(),this.render(),this.onEquipmentChanged();this.listenToOnce(this.selectedHero,"sync",(t=this,function(){return"function"==typeof t.setHero?t.setHero(t.selectedHero):void 0}))},g.prototype.onShown=function(){return this.requireLevelEquipment()},g.prototype.onHidden=function(){return this.endHighlight(),g.__super__.onHidden.call(this),this.playSound("game-menu-close")},g.prototype.onClickChooseHero=function(){return this.playSound("menu-button-click"),this.hide(),this.trigger("choose-hero-click")},g.prototype.onClickPlayLevel=function(e){var t;if(!this.$el.find("#play-level-button").prop("disabled")){var i,n=this.options.level.get("slug");return this.playSound("menu-button-click"),this.showLoading(),t=navigator.userAgent.toLowerCase(),t=/safari/.test(t)&&!/chrome/.test(t),!(v(window).height()<658)||k.isAdmin()||h||t||(this.toggleFullscreen(),h=!0),this.updateConfig((i=this,function(){return"function"==typeof i.trigger?i.trigger("play-click"):void 0})),null!=(t=window.tracker)?t.trackEvent("Inventory Play",{category:"Play Level",level:n}):void 0}},g.prototype.updateConfig=function(e,t){var i,n,o,s,r,a;return console.log("Inside updateConfig"),a=null!=(s=this.options.session.get("heroConfig"))?s:{},n=null!=(r=k.get("heroConfig"))?r:{},i=this.getCurrentEquipmentConfig(),s=(s=o=!1)||!_.isEqual(i,a.inventory),a.inventory=i,(r=null!=(r=this.selectedHero)?r.get("original"):void 0)&&(s=s||!_.isEqual(r,a.thangType),a.thangType=r),o=o||!_.isEqual(i,n.inventory),n.inventory=i,o&&(console.log("Inventory Modal: setting me.heroConfig to",JSON.stringify(n)),k.set("heroConfig",n),k.patch()),s?(console.log("Inventory Modal: setting session.heroConfig to",JSON.stringify(a)),this.options.session.set("heroConfig",a),t?void 0:this.options.session.patch({success:e})):"function"==typeof e?e():void 0},g.prototype.onUnlockButtonClicked=function(e){var t,i,n,o,s,r,a;if(e.stopPropagation(),t=v(e.target).closest("button"),(o=this.items.get(t.data("item-id"))).affordable){if(!t.hasClass("confirm"))return this.playSound("menu-button-unlock-start"),t.addClass("confirm").text(v.i18n.t("play.confirm")),this.$el.one("click",function(e){if(e.target!==t[0])return t.removeClass("confirm").text(v.i18n.t("play.unlock"))});for(this.playSound("menu-button-unlock-end"),l.makeFor(o).save(),null==(e=null!=(e=k.get("purchased"))?e:{}).items&&(e.items=[]),e.items.push(o.get("original")),k.set("purchased",e),k.set("spent",(null!=(e=k.get("spent"))?e:0)+o.get("gems")),this.itemGroups.lockedItems.remove(o),this.itemGroups.requiredPurchaseItems.remove(o),i=_.values(this.getCurrentEquipmentConfig()),n=0,s=(a=this.items.models).length;n<s;n++)r=a[n],this.sortItem(r,i);return this.renderSelectors("#unequipped","#gems-count"),this.requireLevelEquipment(),this.delegateEvents(),this.setUpDraggableEventsForAvailableEquipment(),this.itemDetailsView.setItem(o),this.onScrollUnequipped(!0),k.isStudent()?void 0:Backbone.Mediator.publish("store:item-purchased",{item:o,itemSlug:o.get("slug")})}if(this.playSound("menu-button-click"),!k.freeOnly()&&!b.getHocCampaign())return this.askToBuyGemsOrSubscribe(t)},g.prototype.askToSignUp=function(){var e=new i({supermodel:this.supermodel});return this.openModalView(e)},g.prototype.askToBuyGemsOrSubscribe=function(e){var t,i;return this.$el.find(".unlock-button").popover("destroy"),t=(k.isStudent()?c:k.canBuyGems()?a:k.hasSubscription()?c:u)({}),e.popover({animation:!0,trigger:"manual",placement:"top",content:" ",container:this.$el,template:t}).popover("show"),null!=(e=e.data("bs.popover"))&&null!=(i=e.$tip)&&i.i18n(),this.applyRTLIfNeeded()},g.prototype.onBuyGemsPromptButtonClicked=function(e){return this.playSound("menu-button-click"),k.get("anonymous")?this.askToSignUp():this.openModalView(new t)},g.prototype.onSubscribeButtonClicked=function(e){var t;return this.openModalView(new o),null!=(t=window.tracker)?t.trackEvent("Show subscription modal",{category:"Subscription",label:"hero subscribe modal: "+(v(e.target).data("heroSlug")||"unknown")}):void 0},g.prototype.onClickedSomewhere=function(e){return this.closePopover()},g.prototype.closePopover=function(){if(!this.destroyed)return this.$el.find(".unlock-button").popover("destroy")},g.prototype.onScrollUnequipped=function(e){var t,i,n,o,s,r,a,l;if(null==e&&(e=!1),!this.destroyed){for(o=(r=this.$el.find("#unequipped .nano-content")).find(".item:visible:not(.loaded)"),l=r.height()+100,a=[],t=0,s=o.length;t<s;t++)n=o[t],(n=v(n)).position().top<l||e?(n.addClass("loaded"),i=this.items.get(n.data("item-id")),a.push(n.find("img").attr("src",i.getPortraitURL()))):a.push(void 0);return a}},g.prototype.onEquipmentChanged=function(){var e,t,i,n,o,s,r=null!=(a=null!=(a=this.selectedHero)?a.get("heroClass"):void 0)?a:"Warrior",a=null!=(a=null!=(a=this.selectedHero)?a.get("slug"):void 0)?a:"",l=d.getGender(this.selectedHero);if(this.$el.find("#hero-image, #hero-image-hair, #hero-image-head, #hero-image-thumb").removeClass().addClass(l+" "+r+" "+a),t=this.getCurrentEquipmentConfig(),this.onScrollUnequipped(),_.size(t)&&this.supermodel.finished()){for(o in this.removeDollImages(),s=[],t)n=t[o],(e=null!=(i=_.find(this.items.models,function(e){return e.get("original")===n}))?i.get("dollImages"):void 0)&&(e=this.addDollImage(o,e,r,l,i),"54ea39342b7506e891ca70f2"!==i.get("original")&&e&&s.push(o));return this.$el.find("#hero-image-hair").toggle(!(0<=x.call(s,"head"))),this.$el.find("#hero-image-thumb").toggle(!(0<=x.call(s,"gloves"))),this.equipment=this.options.equipment=t,k.isStudent()&&!b.getHocCampaign()?this.updateConfig(function(){},!0):void 0}},g.prototype.removeDollImages=function(){return this.$el.find(".doll-image").remove()},g.prototype.addDollImage=function(e,t,i,n,o){var s,r,a,l,c,h,u,p;for(i=null!=(p=null!=(p=this.selectedHero)?p.get("heroClass"):void 0)?p:"Warrior",r=null!=(p=null!=(p=this.selectedHero)?p.get("slug"):void 0)?p:"",n=d.getGender(this.selectedHero),s=!1,a=0,u=(c="pet"===e?["pet"]:"gloves"===e?"Ranger"===i?[""+n+i,""+n+i+"Thumb"]:[""+n,n+"Thumb"]:"Wizard"===i&&"torso"===e?[n,n+"Back"]:"Ranger"!==i||"head"!==e||"5441c2be4e9aeb727cc97105"!==(o=o.get("original"))&&"5441c3144e9aeb727cc97111"!==o?[n]:[n+"Ranger"]).length;a<u;a++)(h=t[l=c[a]])?(h=v("<img>").attr("src","/file/"+h).addClass("doll-image "+e+" "+i+" "+r+" "+n+" "+_.string.underscored(l).replace(/_/g,"-")).attr("draggable",!1),this.$el.find("#equipped").append(h),s=!0):console.log("Hmm, should have "+e+" "+l+" paper doll image, but don't have it.");return s},g.prototype.destroy=function(){var e;return this.$el.find(".unlock-button").popover("destroy"),this.$el.find(".ui-droppable").droppable("destroy"),this.$el.find(".ui-draggable").draggable("destroy").off("dragstart"),this.$el.find(".item-slot").off("dragstart"),null!=(e=this.stage)&&e.removeAllChildren(),g.__super__.destroy.call(this)},g),w=_.invert({"simple-boots":"53e237bf53457600003e3f05","simple-sword":"53e218d853457600003e3ebe","tarnished-bronze-breastplate":"53e22eac53457600003e3efc","leather-boots":"53e2384453457600003e3f07","leather-belt":"5437002a7beba4a82024a97d","programmaticon-i":"53e4108204c00d4607a89f78","programmaticon-ii":"546e25d99df4a17d0d449be1","crude-glasses":"53e238df53457600003e3f0b","crude-builders-hammer":"53f4e6e3d822c23505b74f42","long-sword":"544d7d1f8494308424f564a3","sundial-wristwatch":"53e2396a53457600003e3f0f","bronze-shield":"544c310ae0017993fce214bf","wooden-glasses":"53e2167653457600003e3eb3","basic-flags":"545bacb41e649a4495f887da",roughedge:"544d7d918494308424f564a7","sharpened-sword":"544d7deb8494308424f564ab","crude-crossbow":"544d7ffd8494308424f564c3","crude-dagger":"544d952b8494308424f56517","weak-charge":"544d957d8494308424f5651f","enchanted-stick":"544d87188494308424f564f1","unholy-tome-i":"546374bc3839c6e02811d308","book-of-life-i":"546375653839c6e02811d30b","rough-sense-stone":"54693140a2b1f53ce79443bc","polished-sense-stone":"53e215a253457600003e3eaf","quartz-sense-stone":"54693240a2b1f53ce79443c5","wooden-builders-hammer":"54694ba3a2b1f53ce794444d","simple-wristwatch":"54693797a2b1f53ce79443e9"})}.call(this,S(17),S(3))},1618:function(e,t,i){var n=i(1619);(n="string"==typeof n?[[e.i,n,""]]:n).locals&&(e.exports=n.locals);(0,i(21).default)("0c473108",n,!0,{})},1619:function(e,t,i){},1620:function(e,t,i){},1621:function(e,t,i){var c=i(11);e.exports=function(e){var a,l=[],e=e||{};return function(o,e,s,t,i,r,n){l.push('<div class="modal-dialog"><div class="modal-content"><img src="/images/pages/play/modal/inventory-background.png" draggable="false" id="play-items-modal-narrow-bg"><h1 data-i18n="game_menu.inventory_tab"></h1><div id="gems-count-container"><span id="gems-count" class="big-font">'+c.escape(null==(a=e)?"":a)+'</span></div><div id="close-modal"><span class="glyphicon glyphicon-remove"></span></div><div id="equipped">'),i&&i.get("featureImages")&&(i=i.get("featureImages"),l.push("<img"+c.attr("src","/file/"+i.body,!0,!0)+' draggable="false" id="hero-image"><img'+c.attr("src","/file/"+i.head,!0,!0)+' draggable="false" id="hero-image-head"><img'+c.attr("src","/file/"+i.hair,!0,!0)+' draggable="false" id="hero-image-hair"><img'+c.attr("src","/file/"+i.thumb,!0,!0)+' draggable="false" id="hero-image-thumb">')),function(){var e=["head","eyes","neck","torso","gloves","wrists","left-hand","right-hand","waist","feet","left-ring","right-ring","minion","flag","pet","programming-book","misc-0","misc-1"];if("number"==typeof e.length)for(var t=0,i=e.length;t<i;t++){var n=e[t];l.push("<div"+c.attr("data-slot",n,!0,!0)+' class="item-slot"><div class="placeholder"></div>'),o[n]&&l.push("<img"+c.attr("src",o[n].getPortraitURL(),!0,!0)+c.attr("data-item-id",o[n].id,!0,!0)+' class="item">'),l.push("</div>")}else{i=0;for(t in e){i++;n=e[t];l.push("<div"+c.attr("data-slot",n,!0,!0)+' class="item-slot"><div class="placeholder"></div>'),o[n]&&l.push("<img"+c.attr("src",o[n].getPortraitURL(),!0,!0)+c.attr("data-item-id",o[n].id,!0,!0)+' class="item">'),l.push("</div>")}}}.call(this),l.push('</div><div id="unequipped"><div class="nano"><div class="nano-content">'),s&&(s.requiredPurchaseItems.models.length&&(l.push('<h4 id="required-purchase-description" data-i18n="inventory.required_purchase_title"></h4>'),function(){var e=s.requiredPurchaseItems.models;if("number"==typeof e.length)for(var t=0,i=e.length;t<i;t++){var n=e[t];r&&-1<n.classes.indexOf(r)&&l.push("<div"+c.attr("data-item-id",n.id,!0,!0)+c.cls(["item",n.classes],[null,!0])+'><img draggable="false"></div>')}else{i=0;for(t in e){i++;n=e[t];r&&-1<n.classes.indexOf(r)&&l.push("<div"+c.attr("data-item-id",n.id,!0,!0)+c.cls(["item",n.classes],[null,!0])+'><img draggable="false"></div>')}}}.call(this),l.push('<div class="clearfix"></div>')),s.availableItems.models.length&&(l.push('<h4 id="available-description" data-i18n="inventory.available_item"></h4>'),function(){var e=s.availableItems.models;if("number"==typeof e.length)for(var t=0,i=e.length;t<i;t++){var n=e[t];r&&-1<n.classes.indexOf(r)&&l.push("<div"+c.attr("data-item-id",n.id,!0,!0)+c.cls(["item","available",n.classes],[null,null,!0])+'><img><button data-i18n="inventory.equip" class="btn equip-item"></button></div>')}else{i=0;for(t in e){i++;n=e[t];r&&-1<n.classes.indexOf(r)&&l.push("<div"+c.attr("data-item-id",n.id,!0,!0)+c.cls(["item","available",n.classes],[null,null,!0])+'><img><button data-i18n="inventory.equip" class="btn equip-item"></button></div>')}}}.call(this),l.push('<div class="clearfix"></div>')),l.push('<div id="double-click-hint" class="alert alert-info"><span class="glyphicon glyphicon-info-sign spr"></span><span data-i18n="inventory.should_equip"></span></div>'),!s.subscriberItems.models.length||t.freeOnly()||t.isInHourOfCode()||(l.push('<h4 id="restricted-description">Subscriber Only</h4>'),function(){var e=s.subscriberItems.models;if("number"==typeof e.length)for(var t=0,i=e.length;t<i;t++){var n=e[t];r&&-1<n.classes.indexOf(r)&&l.push("<div"+c.attr("data-item-id",n.id,!0,!0)+c.cls(["item",n.classes],[null,!0])+'><img draggable="false"></div>')}else{i=0;for(t in e){i++;n=e[t];r&&-1<n.classes.indexOf(r)&&l.push("<div"+c.attr("data-item-id",n.id,!0,!0)+c.cls(["item",n.classes],[null,!0])+'><img draggable="false"></div>')}}}.call(this),l.push('<div class="clearfix"></div>')),s.restrictedItems.models.length&&(l.push('<h4 id="restricted-description" data-i18n="inventory.restricted_title"></h4>'),function(){var e=s.restrictedItems.models;if("number"==typeof e.length)for(var t=0,i=e.length;t<i;t++){var n=e[t];r&&-1<n.classes.indexOf(r)&&l.push("<div"+c.attr("data-item-id",n.id,!0,!0)+c.cls(["item",n.classes],[null,!0])+'><img draggable="false"></div>')}else{i=0;for(t in e){i++;n=e[t];r&&-1<n.classes.indexOf(r)&&l.push("<div"+c.attr("data-item-id",n.id,!0,!0)+c.cls(["item",n.classes],[null,!0])+'><img draggable="false"></div>')}}}.call(this),l.push('<div class="clearfix"></div>')),s.lockedItems.models.length&&(l.push('<h4 id="locked-description" data-i18n="play.locked"></h4>'),function(){var e=s.lockedItems.models;if("number"==typeof e.length)for(var t=0,i=e.length;t<i;t++){var n=e[t];r&&-1<n.classes.indexOf(r)&&l.push("<div"+c.attr("data-item-id",n.id,!0,!0)+c.cls(["item",n.classes],[null,!0])+'><img draggable="false"></div>')}else{i=0;for(t in e){i++;n=e[t];r&&-1<n.classes.indexOf(r)&&l.push("<div"+c.attr("data-item-id",n.id,!0,!0)+c.cls(["item",n.classes],[null,!0])+'><img draggable="false"></div>')}}}.call(this),l.push('<div class="clearfix"></div>'))),l.push('</div></div></div><div id="item-details-view"></div><div id="item-details-extra"><button id="equip-item-viewed" data-i18n="inventory.equip" class="btn secret"></button><button id="unequip-item-viewed" data-i18n="inventory.unequip" class="btn secret"></button><button id="subscriber-item-viewed" data-i18n="play.subscribe_unlock" class="btn big-font secret"></button><div id="restricted-item-viewed" data-i18n="inventory.restricted" class="alert alert-danger secret"></div></div>'),t.isStudent()?t.showHeroAndInventoryModalsToStudents()&&l.push('<button id="choose-hero-button" data-i18n="play.change_hero" class="btn btn-lg btn-primary choose-inventory-active"></button>'):l.push('<button id="choose-hero-button" data-i18n="play.change_hero_or_language" class="btn btn-lg btn-primary choose-inventory-active"></button>'),l.push('<button id="play-level-button" data-i18n="common.play" class="btn btn-lg btn-success choose-inventory-active"></button></div></div>')}.call(this,"equipment"in e?e.equipment:"undefined"!=typeof equipment?equipment:void 0,"gems"in e?e.gems:"undefined"!=typeof gems?gems:void 0,"itemGroups"in e?e.itemGroups:"undefined"!=typeof itemGroups?itemGroups:void 0,"me"in e?e.me:"undefined"!=typeof me?me:void 0,"selectedHero"in e?e.selectedHero:"undefined"!=typeof selectedHero?selectedHero:void 0,"selectedHeroClass"in e?e.selectedHeroClass:"undefined"!=typeof selectedHeroClass?selectedHeroClass:void 0,"undefined"in e?e.undefined:void 0),l.join("")}},1622:function(e,t,i){var n,o={}.hasOwnProperty;function s(){return s.__super__.constructor.apply(this,arguments)}n=i(26),i=i(1623),e.exports=(function(e,t){for(var i in t)o.call(t,i)&&(e[i]=t[i]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(s,n),s.prototype.className="item-view",s.prototype.template=i,s.prototype.initialize=function(e){return s.__super__.initialize.apply(this,arguments),this.item=e.item,this.includes=e.includes||{}},s.prototype.getRenderData=function(){var e,t,i=s.__super__.getRenderData.call(this);return i.item=this.item,i.includes=this.includes,(this.includes.props||this.includes.stats)&&(e=(t=this.item.getFrontFacingStats()).props,t=t.stats,i.props=e,i.stats=t),i},s.prototype.afterRender=function(){return this.$el.data("item-id",this.item.id)},s)},1623:function(e,t,i){var l=i(11);e.exports=function(e){var r,a=[],e=e||{};return function(e,t,o,s,i){a.push("<img"+l.attr("src",t.getPortraitURL(),!0,!0)+'><div class="item-info">'),e.name&&a.push("<h4>"+l.escape(null==(r=t.get("name"))?"":r)+"</h4>"),(e.stats||e.props&&o.length)&&(a.push('<ul class="list-unstyled">'),e.stats&&function(){var e=s;if("number"==typeof e.length)for(var t=0,i=e.length;t<i;t++)"true"==(n=e[t]).display?a.push("<li>"+l.escape(null==(r=n.name)?"":r)+"</li>"):a.push("<li>"+l.escape(null==(r=n.name)?"":r)+": "+l.escape(null==(r=n.display)?"":r)+"</li>");else{var n,i=0;for(t in e)i++,"true"==(n=e[t]).display?a.push("<li>"+l.escape(null==(r=n.name)?"":r)+"</li>"):a.push("<li>"+l.escape(null==(r=n.name)?"":r)+": "+l.escape(null==(r=n.display)?"":r)+"</li>")}}.call(this),e.props&&o.length&&(a.push("<li>Grants:"),function(){var e=o;if("number"==typeof e.length)for(var t=0,i=e.length;t<i;t++){var n=e[t];a.push(" <code>"+l.escape(null==(r=n)?"":r)+"</code>")}else{i=0;for(t in e){i++;n=e[t];a.push(" <code>"+l.escape(null==(r=n)?"":r)+"</code>")}}}.call(this),a.push("</li>")),a.push("</ul>")),a.push('<span class="status-message"><span data-i18n="inventory.should_equip" class="spl should-equip-message"></span><span data-i18n="inventory.equipped" class="spl equipped-message"></span><span data-i18n="inventory.locked" class="spl locked-message"></span><span data-i18n="inventory.restricted" class="spl restricted-message"></span></span></div><div class="clearfix"></div>')}.call(this,"includes"in e?e.includes:"undefined"!=typeof includes?includes:void 0,"item"in e?e.item:"undefined"!=typeof item?item:void 0,"props"in e?e.props:"undefined"!=typeof props?props:void 0,"stats"in e?e.stats:"undefined"!=typeof stats?stats:void 0,"undefined"in e?e.undefined:void 0),a.join("")}},1624:function(e,t,i){var n=i(1625);(n="string"==typeof n?[[e.i,n,""]]:n).locals&&(e.exports=n.locals);(0,i(21).default)("66b38856",n,!0,{})},1625:function(e,t,i){},1626:function(e,t,i){var c=i(11);e.exports=function(e){var a,l=[],e=e||{};return function(e,o,s,r,t){var i;l.push('<div id="item-title"><h2 dir="auto" class="one-line big-font">'+c.escape(null==(a=e?e.name:"")?"":a)+'</h2></div><div id="item-details-body">'),e&&(l.push('<div class="nano"><div class="nano-content"><div id="item-container"><img'+c.attr("src",e.getPortraitURL(),!0,!0)+' draggable="false" class="item-img"><img'+c.attr("src",e.getPortraitURL(),!0,!0)+' draggable="false" class="item-shadow"></div><img src="/images/pages/play/modal/hr.png" draggable="false" class="hr">'),function(){var e=r;if("number"==typeof e.length)for(var t=0,i=e.length;t<i;t++){var n=e[t];l.push("<div"+c.cls(["stat-row big-font"+(/^en/.test(o.get("preferredLanguage"))&&n.matchedShortName?" short-name":"")],[!0])+'><div class="stat-label">'+c.escape(null==(a=n.name)?"":a)+'</div><div class="stat">'+c.escape(null==(a=n.display)?"":a)+'</div></div><img src="/images/pages/play/modal/hr.png" draggable="false"'+c.cls(["hr",n.isLast?"":"faded"],[null,!0])+">")}else{i=0;for(t in e){i++;n=e[t];l.push("<div"+c.cls(["stat-row big-font"+(/^en/.test(o.get("preferredLanguage"))&&n.matchedShortName?" short-name":"")],[!0])+'><div class="stat-label">'+c.escape(null==(a=n.name)?"":a)+'</div><div class="stat">'+c.escape(null==(a=n.display)?"":a)+'</div></div><img src="/images/pages/play/modal/hr.png" draggable="false"'+c.cls(["hr",n.isLast?"":"faded"],[null,!0])+">")}}}.call(this),e.description&&l.push('<div dir="auto" class="item-description">'+c.escape(null==(a=e.description)?"":a)+"</div>"),s.length&&(l.push('<div id="skills"><h3 data-i18n="play.skills_granted" class="big-font"></h3>'),function(){var e=s;if("number"==typeof e.length)for(var t=0,i=e.length;t<i;t++){var n=e[t];l.push("<p><strong>"+c.escape(null==(a=n.name)?"":a)+'</strong><span class="spr">:</span><span>'+(null==(a=n.description)?"":a)+"</span></p>")}else{i=0;for(t in e){i++;n=e[t];l.push("<p><strong>"+c.escape(null==(a=n.name)?"":a)+'</strong><span class="spr">:</span><span>'+(null==(a=n.description)?"":a)+"</span></p>")}}}.call(this),l.push("</div>")),e.comingSoon&&l.push('<div class="text-center"><h3>This item has no stats.</h3><p>Only admins will see it for now.</p></div>'),l.push("</div></div>")),l.push("</div>"),e&&!e.owned&&(e.unequippable?l.push("<button"+c.attr("data-i18n","inventory."+e.get("heroClass").toLowerCase()+"_only",!0,!0)+' class="btn big-font disabled unequippable"></button>'):(i=e.get("subscriber")&&!o.isPremium()&&!o.isStudent(),l.push('<button id="selected-item-unlock-button"'+c.attr("data-item-id",e.id,!0,!0)+c.cls(["btn","big-font",i?"subscribe-button":"unlock-button"],[null,null,!0])+">"),i?l.push('<span data-i18n="subscribe.subscribe_title"></span>'):l.push('<span data-i18n="play.unlock"></span><span class="spl">'+c.escape(null==(a="("+e.get("gems"))?"":a)+'</span><img src="/images/common/gem.png" draggable="false"><span>)</span>'),l.push("</button>")))}.call(this,"item"in e?e.item:"undefined"!=typeof item?item:void 0,"me"in e?e.me:"undefined"!=typeof me?me:void 0,"props"in e?e.props:"undefined"!=typeof props?props:void 0,"stats"in e?e.stats:"undefined"!=typeof stats?stats:void 0,"undefined"in e?e.undefined:void 0),l.join("")}},1627:function(e,t,i){var p,n,o,s,h,r={}.hasOwnProperty;function d(e){d.__super__.constructor.call(this,e),this.levelSlug=this.options.levelSlug,(e=new n({_id:this.levelSlug})).project=["name","i18n","scoreType","original"],this.level=this.supermodel.loadModel(e).model}i(1628),o=i(80),s=i(1630),p=i(1631),n=i(267),h=i(6),e.exports=(function(e,t){for(var i in t)r.call(t,i)&&(e[i]=t[i]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(d,o),d.prototype.id="leaderboard-modal",d.prototype.template=s,d.prototype.instant=!0,d.prototype.timespans=["latest","all"],d.prototype.subscriptions={},d.prototype.events={"shown.bs.tab #leaderboard-nav a":"onTabShown","click #close-modal":"hide"},d.prototype.getRenderData=function(e){var t,i,n,o,s,r,a,l,c;for((e=d.__super__.getRenderData.call(this,e)).submenus=[],t=0,n=(r=null!=(s=this.level.get("scoreTypes"))?s:[]).length;t<n;t++)for((l=r[t]).type&&(l=l.type),i=0,o=(a=this.timespans).length;i<o;i++)c=a[i],e.submenus.push({scoreType:l,timespan:c});return e.levelName=h.i18n(this.level.attributes,"name"),e},d.prototype.afterRender=function(){var e,t,i,n,o,s,r,a,l,c,h,u;if(d.__super__.afterRender.call(this),this.supermodel.finished()){for(l=e=0,i=(s=null!=(o=this.level.get("scoreTypes"))?o:[]).length;e<i;l=++e)for((a=s[l]).type&&(a=a.type),u=t=0,n=(r=this.timespans).length;t<n;u=++t)h=r[u],c=new p({scoreType:a,timespan:h,level:this.level}),this.insertSubView(c,this.$el.find("#"+a+"-"+h+"-view .leaderboard-tab-view")),l+u===0&&(c.$el.parent().addClass("active"),"function"==typeof c.onShown&&c.onShown());return this.playSound("game-menu-open"),this.$el.find(".nano:visible").nanoScroller()}},d.prototype.onTabShown=function(e){var t,i,n,o,s,r;for(s in this.playSound("game-menu-tab-switch"),e=(r=e.target.hash.substring(1).split("-")).slice(0,r.length-2).join("-"),r=r[r.length-2],"function"==typeof(o=_.find(this.subviews,{scoreType:e,timespan:r})).onShown&&o.onShown(),n=[],i=this.subviews)(t=i[s])!==o&&n.push("function"==typeof t.onHidden?t.onHidden():void 0);return n},d.prototype.onHidden=function(){var e,t,i;for(i in d.__super__.onHidden.call(this),e=this.subviews)"function"==typeof(t=e[i]).onHidden&&t.onHidden();return this.playSound("game-menu-close")},d)},1628:function(e,t,i){var n=i(1629);(n="string"==typeof n?[[e.i,n,""]]:n).locals&&(e.exports=n.locals);(0,i(21).default)("5ea11736",n,!0,{})},1629:function(e,t,i){},1630:function(e,t,i){var l=i(11);e.exports=function(e){var r,a=[],e=e||{};return function(e,o,t){a.push('<div class="modal-dialog"><div class="modal-content"><img src="/images/pages/play/modal/leaderboard-background.png" draggable="false" id="leaderboard-background"><h1 class="level-title">'+l.escape(null==(r=e)?"":r)+'</h1><div id="close-modal"><span class="glyphicon glyphicon-remove"></span></div><ul id="leaderboard-nav" class="nav nav-pills nav-stacked">');var s=null;!function(){var e=o;if("number"==typeof e.length)for(var t=0,i=e.length;t<i;t++){var n=e[t];s&&n.scoreType!=s&&a.push("<br>"),a.push("<li"+l.cls([t?"":"active"],[!0])+"><a"+l.attr("href","#"+n.scoreType+"-"+n.timespan+"-view",!0,!0)+' data-toggle="tab">'),n.scoreType!=s?a.push("<div"+l.attr("data-i18n","leaderboard."+n.scoreType.replace("-","_"),!0,!0)+' class="scoreType">'+l.escape(null==(r=n.scoreType)?"":r)+"</div>"):a.push('<div class="scoreType">&nbsp;</div>'),a.push("<div"+l.attr("data-i18n","leaderboard."+n.timespan,!0,!0)+' class="timespan"></div>'),s=n.scoreType,a.push("</a></li>")}else{i=0;for(t in e){i++;n=e[t];s&&n.scoreType!=s&&a.push("<br>"),a.push("<li"+l.cls([t?"":"active"],[!0])+"><a"+l.attr("href","#"+n.scoreType+"-"+n.timespan+"-view",!0,!0)+' data-toggle="tab">'),n.scoreType!=s?a.push("<div"+l.attr("data-i18n","leaderboard."+n.scoreType.replace("-","_"),!0,!0)+' class="scoreType">'+l.escape(null==(r=n.scoreType)?"":r)+"</div>"):a.push('<div class="scoreType">&nbsp;</div>'),a.push("<div"+l.attr("data-i18n","leaderboard."+n.timespan,!0,!0)+' class="timespan"></div>'),s=n.scoreType,a.push("</a></li>")}}}.call(this),a.push('</ul><div class="tab-content leaderboard-tab-content">'),function(){var e=o;if("number"==typeof e.length)for(var t=0,i=e.length;t<i;t++){var n=e[t];a.push("<div"+l.attr("id",n.scoreType+"-"+n.timespan+"-view",!0,!0)+' class="tab-pane"><div class="leaderboard-tab-view"></div></div>')}else{i=0;for(t in e){i++;n=e[t];a.push("<div"+l.attr("id",n.scoreType+"-"+n.timespan+"-view",!0,!0)+' class="tab-pane"><div class="leaderboard-tab-view"></div></div>')}}}.call(this),a.push("</div></div></div>")}.call(this,"levelName"in e?e.levelName:"undefined"!=typeof levelName?levelName:void 0,"submenus"in e?e.submenus:"undefined"!=typeof submenus?submenus:void 0,"undefined"in e?e.undefined:void 0),a.join("")}},1631:function(u,e,p){!function(n){function e(e,t){for(var i in t)l.call(t,i)&&(e[i]=t[i]);function n(){this.constructor=e}return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e}var t,i,o,s,r,a,l={}.hasOwnProperty;function c(e,t,i){this.level=e,this.scoreType=t,this.timespan=i,c.__super__.constructor.call(this),this.url="/db/level/"+this.level.get("original")+"/top_scores/"+this.scoreType+"/"+this.timespan}function h(e){h.__super__.constructor.call(this,e),this.level=this.options.level,this.scoreType=null!=(e=this.options.scoreType)?e:"time",this.timespan=this.options.timespan}i=p(26),a=p(1632),t=p(115),o=p(1375),r=p(13),e(c,t),c.prototype.url="",c.prototype.model=o,s=c,u.exports=(e(h,i),h.prototype.template=a,h.prototype.className="leaderboard-tab-view",h.prototype.events={"click tbody tr.viewable":"onClickRow","click tbody tr.viewable .nuke-button":"onClickNukeButton"},h.prototype.destroy=function(){return h.__super__.destroy.call(this)},h.prototype.getRenderData=function(){var e=h.__super__.getRenderData.call(this);return e.scoreType=this.scoreType,e.timespan=this.timespan,e.topScores=this.formatTopScores(),e.loading=!this.sessions||this.sessions.loading,e._=_,e},h.prototype.afterRender=function(){return h.__super__.afterRender.call(this),this.$('[data-toggle="tooltip"]').tooltip({placement:"bottom",html:!0,animation:!1,container:".modal-content"})},h.prototype.formatTopScores=function(){var e,t,i,n,o,s,r,a,l,c;if(null==(i=this.sessions)||!i.models)return[];for(r=[],e=0,t=(n=this.sessions.models).length;e<t;e++)a=n[e],s={},l=_.find(a.get("state").topScores,{type:this.scoreType}),(c=new Date(l.date))-1>new Date-1&&!me.isAdmin()&&(c=new Date(new Date-432e5)),s.ago=moment(c).fromNow(),s.score=this.formatScore(l),s.creatorName=a.get("creatorName"),s.creator=a.get("creator"),s.session=a.id,s.codeLanguage=a.get("codeLanguage"),s.hero=null!=(l=a.get("heroConfig"))?l.thangType:void 0,s.inventory=null!=(l=a.get("heroConfig"))?l.inventory:void 0,s.code=null!=(a=a.get("code"))&&null!=(o=a["hero-placeholder"])?o.plan:void 0,r.push(s);return r},h.prototype.formatScore=function(e){switch(e.type){case"time":return-e.score.toFixed(2)+"s";case"damage-taken":return-Math.round(e.score);case"damage-dealt":case"gold-collected":case"difficulty":return Math.round(e.score);default:return e.score}},h.prototype.onShown=function(){var e;if(!this.hasShown)return this.hasShown=!0,e=new s(this.level,this.scoreType,this.timespan),this.sessions=this.supermodel.loadCollection(e,"sessions",{cache:!1},0).model},h.prototype.onClickRow=function(e){var e=n(e.target).closest("tr").data("session-id"),e="/play/level/"+this.level.get("slug")+"?session="+e+"&observing=true";return window.open(e,"_blank")},h.prototype.onClickNukeButton=function(e){var t,i;return e.stopImmediatePropagation(),t=n(e.target).closest("tr").data("session-id"),this.playSound("menu-button-click"),r("/db/level.session/unset-scores",{method:"POST",json:{session:t}}).then((i=this,function(e){return i.$("tr[data-session-id="+t+"]").tooltip("destroy").remove()}))},h)}.call(this,p(3))},1632:function(e,t,i){var d=i(11);e.exports=function(e){var u,p=[],e=e||{};return function(l,e,c,t,i,h,n){p.push('<h1><span data-i18n="leaderboard.top_players" class="spr">Top Players by</span><span'+d.attr("data-i18n","leaderboard."+t.replace("-","_"),!0,!0)+'></span><span class="spr">,</span><span'+d.attr("data-i18n","leaderboard."+i,!0,!0)+"></span></h1>"),h?(p.push('<table class="table table-bordered table-condensed table-hover"><thead><tr><th colspan="4" data-i18n="general.player"></th><th data-i18n="general.score"></th><th data-i18n="general.when"></th><th></th></tr></thead><tbody>'),function(){var e=h;if("number"==typeof e.length)for(var t=0,i=e.length;t<i;t++){var n=(a=e[t]).creator==c.id,o=5<=t||c.isAdmin(),s=c.isAdmin()?"<pre>"+a.code+"</pre>":o?"View solution":"Can't view top 5 solutions",r=c.isAdmin()?"tooltip":"";p.push("<tr"+d.attr("data-player-id",a.creator,!0,!0)+d.attr("data-session-id",a.session,!0,!0)+d.attr("title",s,!0,!0)+d.attr("data-toggle",r,!0,!0)+d.cls([n?"success":o?" viewable":""],[!0])+'><td class="rank-cell">'+d.escape(null==(u=t+1)?"":u)+"</td><td"+d.attr("style","background-image: url(/images/common/code_languages/"+a.codeLanguage+"_small.png)",!0,!0)+d.attr("title",l.string.capitalize(a.codeLanguage),!0,!0)+' class="code-language-cell"></td><td'+d.attr("style","background-image: url(/file/db/thang.type/"+a.hero+"/portrait.png)",!0,!0)+' class="hero-portrait-cell"></td><td class="name-col-cell">'+d.escape(null==(u=a.creatorName||"Anonymous")?"":u)+'</td><td class="score-cell">'+d.escape(null==(u=a.score)?"":u)+'</td><td class="ago-cell">'+d.escape(null==(u=a.ago)?"":u)+'</td><td class="viewable-cell">'),o?"en"!=(c.get("preferredLanguage",!0)||"en-US").substr(0,2)||c.isAdmin()?p.push('<div class="glyphicon glyphicon-eye-open"></div>'):p.push('<div class="btn btn-xs btn-info">Watch</div>'):p.push('<div class="glyphicon glyphicon-eye-close"></div>'),c.isAdmin()&&p.push('<div class="nuke-button glyphicon glyphicon-remove"></div>'),p.push("</td></tr>")}else{i=0;for(t in e){i++;var a,n=(a=e[t]).creator==c.id,o=5<=t||c.isAdmin(),s=c.isAdmin()?"<pre>"+a.code+"</pre>":o?"View solution":"Can't view top 5 solutions",r=c.isAdmin()?"tooltip":"";p.push("<tr"+d.attr("data-player-id",a.creator,!0,!0)+d.attr("data-session-id",a.session,!0,!0)+d.attr("title",s,!0,!0)+d.attr("data-toggle",r,!0,!0)+d.cls([n?"success":o?" viewable":""],[!0])+'><td class="rank-cell">'+d.escape(null==(u=t+1)?"":u)+"</td><td"+d.attr("style","background-image: url(/images/common/code_languages/"+a.codeLanguage+"_small.png)",!0,!0)+d.attr("title",l.string.capitalize(a.codeLanguage),!0,!0)+' class="code-language-cell"></td><td'+d.attr("style","background-image: url(/file/db/thang.type/"+a.hero+"/portrait.png)",!0,!0)+' class="hero-portrait-cell"></td><td class="name-col-cell">'+d.escape(null==(u=a.creatorName||"Anonymous")?"":u)+'</td><td class="score-cell">'+d.escape(null==(u=a.score)?"":u)+'</td><td class="ago-cell">'+d.escape(null==(u=a.ago)?"":u)+'</td><td class="viewable-cell">'),o?"en"!=(c.get("preferredLanguage",!0)||"en-US").substr(0,2)||c.isAdmin()?p.push('<div class="glyphicon glyphicon-eye-open"></div>'):p.push('<div class="btn btn-xs btn-info">Watch</div>'):p.push('<div class="glyphicon glyphicon-eye-close"></div>'),c.isAdmin()&&p.push('<div class="nuke-button glyphicon glyphicon-remove"></div>'),p.push("</td></tr>")}}}.call(this),p.push("</tbody></table>")):e?p.push('<h3 data-i18n="common.loading"></h3>'):p.push("<h3>No scores yet.</h3>")}.call(this,"_"in e?e._:"undefined"!=typeof _?_:void 0,"loading"in e?e.loading:"undefined"!=typeof loading?loading:void 0,"me"in e?e.me:"undefined"!=typeof me?me:void 0,"scoreType"in e?e.scoreType:"undefined"!=typeof scoreType?scoreType:void 0,"timespan"in e?e.timespan:"undefined"!=typeof timespan?timespan:void 0,"topScores"in e?e.topScores:"undefined"!=typeof topScores?topScores:void 0,"undefined"in e?e.undefined:void 0),p.join("")}},1633:function(e,t,i){var n=i(1634);(n="string"==typeof n?[[e.i,n,""]]:n).locals&&(e.exports=n.locals);(0,i(21).default)("636799d0",n,!0,{})},1634:function(e,t,i){},1635:function(e,t,i){i(11);e.exports=function(e){var t=[];return t.push('<div class="modal-dialog"><div class="modal-content"><img src="/images/pages/play/modal/parental_prompt_modal_background.png" class="background-img"><img src="/images/pages/play/modal/parental_nudge_wizard.png" class="wizard-img"><div class="blurb-container"> <h1 data-i18n="share_progress_modal.title"></h1><p data-i18n="share_progress_modal.blurb"></p><div class="container-fluid send-container"><div class="row"><div class="col-xs-12 email-form"><p data-i18n="share_progress_modal.form_blurb"></p><div><label data-i18n="share_progress_modal.form_label"></label><input type="email" data-i18n="[placeholder]share_progress_modal.placeholder" class="form-control email-input"></div></div></div><div class="row"><div class="col-xs-8"><div data-i18n="share_progress_modal.email_invalid" class="email-invalid"></div></div><div class="col-xs-4 text-right"><button data-i18n="common.send" class="btn btn-illustrated send-btn"></button></div></div><div class="row continue-container"><div class="col-xs-12 text-left"><a data-i18n="common.continue" class="continue-link"></a></div></div></div></div></div></div>'),t.join("")}},1636:function(e,t,i){var n=i(1637);(n="string"==typeof n?[[e.i,n,""]]:n).locals&&(e.exports=n.locals);(0,i(21).default)("786a0ce0",n,!0,{})},1637:function(e,t,i){},1638:function(e,t,i){var h=i(11);e.exports=function(e){var l,c=[],e=e||{};return function(o,s,r,a,e,t){c.push('<div class="modal-dialog game"><div class="background-wrapper"><div class="modal-content"><div class="modal-header">'),t.closeButton&&c.push('<div type="button" data-dismiss="modal" aria-hidden="true" class="button close">&times;</div>'),c.push('<h1 dir="auto"><span>'+h.escape(null==(l=o(a.attributes,"name"))?"":l)+'</span></h1></div><div class="modal-body"><div class="description rtl-allowed">'),a.get("description")?c.push('<div dir="auto">'+(null==(l=s(o(a.attributes,"description")))?"":l)+"</div>"):c.push("<div>&nbsp;</div>"),c.push('</div><div class="answers-container-wrapper"><div class="answers-container"><table dir="auto" class="table table-hover rtl-allowed">'),function(){var e=a.get("answers")||[];if("number"==typeof e.length)for(var t=0,i=e.length;t<i;t++){var n=e[t];c.push("<tr"+h.attr("data-answer",n.key,!0,!0)+' class="answer"><td>'+(null==(l=s(o(n,"text")))?"":l)+'</td><td class="graph-cell"><div class="progress"><div class="progress-bar"></div></div></td><td class="votes-cell"><span class="badge vote-percentage"></span></td>'),r.isAdmin()&&c.push('<td class="votes-cell"><span class="badge vote-count"></span></td>'),c.push("</tr>")}else{i=0;for(t in e){i++;n=e[t];c.push("<tr"+h.attr("data-answer",n.key,!0,!0)+' class="answer"><td>'+(null==(l=s(o(n,"text")))?"":l)+'</td><td class="graph-cell"><div class="progress"><div class="progress-bar"></div></div></td><td class="votes-cell"><span class="badge vote-percentage"></span></td>'),r.isAdmin()&&c.push('<td class="votes-cell"><span class="badge vote-count"></span></td>'),c.push("</tr>")}}}.call(this),c.push('</table></div></div><div class="random-gems-container-wrapper"><div class="random-gems-container"><code class="random-gems-code"><span>randomNumber = Math.random()                   </span><span id="random-number-comment" class="comment"></span></code><code class="random-gems-code"><span>gems = Math.ceil(2 * randomNumber * me.level)  </span><span id="random-gems-comment" class="comment"></span></code><code class="random-gems-code"><span>me.gems += gems                                </span><span id="total-gems-comment" class="comment"></span></code></div></div></div><div class="modal-body wait secret"><h3>Reticulating Splines...</h3><div class="progress progress-striped active"><div class="progress-bar"></div></div></div><div class="modal-footer"><button data-dismiss="modal" aria-hidden="true" data-i18n="play_level.done" class="btn btn-illustrated btn-lg done-button">Done</button></div></div></div></div>')}.call(this,"i18n"in e?e.i18n:"undefined"!=typeof i18n?i18n:void 0,"marked"in e?e.marked:"undefined"!=typeof marked?marked:void 0,"me"in e?e.me:"undefined"!=typeof me?me:void 0,"poll"in e?e.poll:"undefined"!=typeof poll?poll:void 0,"undefined"in e?e.undefined:void 0,"view"in e?e.view:"undefined"!=typeof view?view:void 0),c.join("")}},1639:function(r,e,a){!function(l){var e,i,n,t=function(e,t){return function(){return e.apply(t,arguments)}},o={}.hasOwnProperty;function s(e){null==e&&(e={}),this.onClickPurchaseButton=t(this.onClickPurchaseButton,this),null==e.announcementId&&(e.announcementId=1),n=e.announcementId,this.template=a(1642)("./"+e.announcementId),s.__super__.constructor.call(this,e),this.trackTimeVisible({trackViewLifecycle:!0})}a(1640),e=a(80),a(6),a(118),i=a(622),a(274),r.exports=(function(e,t){for(var i in t)o.call(t,i)&&(e[i]=t[i]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(s,e),s.prototype.id="announcement-modal",s.prototype.plain=!0,s.prototype.closesOnClickOutside=!0,s.prototype.modalPath="views/play/modal/AnnouncementModal",n=null,s.prototype.events={"click #close-modal":"hide","click .purchase-button":"onClickPurchaseButton","click .close-button":"hide","mouseover .has-tooltip":"displayTooltip","mousemove .has-tooltip":"displayTooltip","mouseout .has-tooltip":"hideTooltip","click .ability-icon":"onClickAbilityIcon","click .ritic-block":"onClickRiticBlock"},s.prototype.afterRender=function(){return s.__super__.afterRender.call(this),this.playSound("game-menu-open")},s.prototype.afterInsert=function(){return s.__super__.afterInsert.call(this),this.timerIntervalID=setInterval((n=this,function(){var e,t,i;if(!n.isHover)return e=l(".pet-image").toArray(),i=Math.floor(Math.random()*e.length),(t=e[i])?(l(t).addClass("wiggle"),setTimeout(function(){return l(t).removeClass("wiggle")},1e3)):void 0}),1e3);var n},s.prototype.onClickAbilityIcon=function(e){return l(".gif-video").hide(),l("#"+l(e.currentTarget).data("gif")+"-gif").show()},s.prototype.onClickRiticBlock=function(e){var t=l(e.currentTarget),e=function(e){for(var t,i,n,o,s,r=[],a=(i=0,e);0<=a?i<a:a<i;0<=a?++i:--i)t=l("<img>").attr("src","/images/pages/play/modal/announcement/ritic/shard"+Math.floor(1+6*Math.random())+".png").addClass("shard"),n=Math.floor(25+50*Math.random()),s=Math.floor(75-30*Math.random()),t.css({left:n+"%",top:s+"%"}),t.css("transform","rotate(0deg)"),l("#ice-chamber").append(t),o=Math.random()*Math.PI*2,t.animate({opacity:0,left:n+100*Math.cos(o)+"%",top:s+100*Math.sin(o)+"%"},740+2e3*Math.random(),function(){return l(this).remove()}),r.push(t.css("transform","rotate("+(-360+Math.floor(360*Math.random()*2))+"deg)"));return r};return t.hasClass("ritic-block-1")?(t.removeClass("ritic-block-1"),t.addClass("ritic-block-2"),l("#clear-block").hide(),l("#chipped-block").show(),e(2)):t.hasClass("ritic-block-2")?(t.removeClass("ritic-block-2"),l("#chipped-block").hide(),l("#shattered-block").show(),l("#shattered-block").css("opacity",1),t.addClass("ritic-block-3"),e(10)):t.hasClass("ritic-block-3")?(t.removeClass("ritic-block-3"),l("#shattered-block").css("opacity",0),l("#ritic-image").addClass("breathing"),l("#ritic-image").css("cursor","default"),l("#ritic-image").data("name","announcement.ritic"),l("#ritic-image").data("description","announcement.ritic_description"),this.hideTooltip(),l(".highlight").each(function(e,t){return l(this).show(),l(this).css("animation","highlight"+(e%2?"-reverse":"")+"-anim "+(5+e)+"s linear infinite")}),e(25)):void 0},s.prototype.displayTooltip=function(e){var t;if(null!=l(e.currentTarget).data("name"))return t=l(".paper-area").offset(),l(".paper-area").position(),l("#item-tooltip").show().css("left",e.clientX-t.left+96+"px"),l("#item-tooltip").show().css("top",e.clientY-t.top+"px"),null!=l(e.currentTarget).data("coming-soon")?l("#item-tooltip #coming-soon").show():l("#item-tooltip #coming-soon").hide(),l("#item-tooltip #pet-name").text(l.i18n.t(l(e.currentTarget).data("name"))),l("#item-tooltip #pet-description").text(l.i18n.t(l(e.currentTarget).data("description"))),this.isHover=!0},s.prototype.hideTooltip=function(){return l("#item-tooltip").hide(),this.isHover=!1},s.prototype.onClickPurchaseButton=function(e){var t;return this.playSound("menu-button-click"),this.openModalView(new i),null!=(t=window.tracker)?t.trackEvent("Show subscription modal",{category:"Subscription",label:"announcement modal id: "+n}):void 0},s.prototype.onHidden=function(){return s.__super__.onHidden.call(this),this.playSound("game-menu-close")},s.prototype.destroy=function(){return clearInterval(this.timerIntervalID),s.__super__.destroy.call(this)},s)}.call(this,a(3))},1640:function(e,t,i){var n=i(1641);(n="string"==typeof n?[[e.i,n,""]]:n).locals&&(e.exports=n.locals);(0,i(21).default)("3e86bf80",n,!0,{})},1641:function(e,t,i){},1642:function(e,t,i){var n={"./1":1500,"./1.jade":1500,"./2":1501,"./2.jade":1501};function o(e){e=s(e);return i(e)}function s(e){if(i.o(n,e))return n[e];e=new Error("Cannot find module '"+e+"'");throw e.code="MODULE_NOT_FOUND",e}o.keys=function(){return Object.keys(n)},o.resolve=s,(e.exports=o).id=1642},1643:function(e,t,i){var n,o={}.hasOwnProperty;function s(){return s.__super__.constructor.apply(this,arguments)}i(1644),n=i(80),i=i(1646),e.exports=(function(e,t){for(var i in t)o.call(t,i)&&(e[i]=t[i]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(s,n),s.prototype.template=i,s.prototype.id="live-classroom-modal",s.prototype.events={"click #close-modal":"hide","mouseup #live-codecombat-link":"onClickLiveClassesLink"},s.prototype.onClickLiveClassesLink=function(){var e;return null!=(e=window.tracker)?e.trackEvent("Click Live Classes link",{label:"live-classes-link"}):void 0},s)},1644:function(e,t,i){var n=i(1645);(n="string"==typeof n?[[e.i,n,""]]:n).locals&&(e.exports=n.locals);(0,i(21).default)("e9bf562c",n,!0,{})},1645:function(e,t,i){},1646:function(e,t,i){i(11);e.exports=function(e){var t=[];return t.push('<div class="modal-dialog"><div class="modal-content"><img id="live-classroom-background" src="/images/pages/play/modal/subscribe-background-blank.png"><h1 data-i18n="live_class.title"></h1><div id="close-modal"><span class="glyphicon glyphicon-remove"></span></div><div class="paper-area text-center"><h3><span data-i18n="live_class.content"></span></h3><a id="live-codecombat-link" href="/live-classes" data-i18n="live_class.link" target="_blank" rel="noopener" class="btn btn-primary"></a></div></div></div>'),t.join("")}},1647:function(e,t,i){var n,o={}.hasOwnProperty;function s(){return s.__super__.constructor.apply(this,arguments)}i(1648),n=i(80),i=i(1650),e.exports=(function(e,t){for(var i in t)o.call(t,i)&&(e[i]=t[i]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(s,n),s.prototype.template=i,s.prototype.id="codequest-2020-modal",s.prototype.events={"click #close-modal":"hide"},s)},1648:function(e,t,i){var n=i(1649);(n="string"==typeof n?[[e.i,n,""]]:n).locals&&(e.exports=n.locals);(0,i(21).default)("78f70834",n,!0,{})},1649:function(e,t,i){},1650:function(e,t,i){i(11);e.exports=function(e){var t=[];return t.push('<div class="modal-dialog"><div class="modal-content"><img id="codequest-background" src="/images/pages/play/modal/subscribe-background-blank.png"><h1 data-i18n="code_quest.great"></h1><div id="close-modal"><span class="glyphicon glyphicon-remove"></span></div><div class="paper-area text-center"><h3><span data-i18n="code_quest.join_paragraph"></span></h3><a id="live-codecombat-link" href="https://codequest.codecombat.com/" data-i18n="code_quest.link" target="_blank" rel="noopener" class="btn btn-primary"></a></div></div></div>'),t.join("")}},1651:function(a,e,l){!function(i){var e,t,n,o=function(e,t){return function(){return e.apply(t,arguments)}},s={}.hasOwnProperty;function r(e){null==e&&(e={}),this.onBuyNowButtonClick=o(this.onBuyNowButtonClick,this),r.__super__.constructor.call(this,e),this.products=new t,this.supermodel.loadCollection(this.products,"products")}l(1652),e=l(80),n=l(1654),t=l(274),a.exports=(function(e,t){for(var i in t)s.call(t,i)&&(e[i]=t[i]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(r,e),r.prototype.id="mine-modal",r.prototype.template=n,r.prototype.hasAnimated=!1,r.prototype.events={"click #close-modal":"hide","click #buy-now-button":"onBuyNowButtonClick","click #submit-button":"onSubmitButtonClick"},r.prototype.onLoaded=function(){return this.basicProduct=this.products.getBasicSubscriptionForUser(me),this.basicProduct&&(this.price=(this.basicProduct.get("amount")/100).toFixed(2)),r.__super__.onLoaded.call(this)},r.prototype.onBuyNowButtonClick=function(e){var t;return null!=(t=window.tracker)&&t.trackEvent("Mine Explored",{engageAction:"buy_button_click"}),i("#buy-now-button").hide(),i("#submit-button").show(),i("#details-header").text("Thanks for your interest"),i("#info-text").hide(),i("#capacity-text").show()},r.prototype.onSubmitButtonClick=function(e){var t;return 0<i("#notify-me-check:checked").length&&null!=(t=window.tracker)&&t.trackEvent("Mine Explored",{engageAction:"notify_check_box_click"}),null!=(t=window.tracker)&&t.trackEvent("Mine Explored",{engageAction:"submit_button_click"}),this.hide()},r.prototype.destroy=function(){return i("#modal-wrapper").off("mousemove"),r.__super__.destroy.call(this)},r)}.call(this,l(3))},1652:function(e,t,i){var n=i(1653);(n="string"==typeof n?[[e.i,n,""]]:n).locals&&(e.exports=n.locals);(0,i(21).default)("006320a5",n,!0,{})},1653:function(e,t,i){},1654:function(e,t,i){var n=i(11);e.exports=function(e){var t,i=[],e=e||{};return function(e){i.push('<div class="modal-dialog"><div class="modal-content"><img id="modal-background" src="/images/pages/play/modal/announcement_modal_bg.png"><h1>Do you like Minecraft?</h1><div id="close-modal"><span class="glyphicon glyphicon-remove"></span></div><div id="mine-content"><div id="image-content"><img id="pickaxe" src="/images/minecraft/icon_stone_pick.png"><img id="hands" src="/images/minecraft/hans4.png"></div><div id="text-content"><div id="details-header">Play CodeCombat in Minecraft!</div><br><div id="info-text"><ul><li>Access a private Minecraft server where you can script the world</li><li>Write code to change the world around you</li><li>Control units to mine, build, and fight for your avatar</li></ul></div><div id="capacity-text"><div>We are not currently accepting additional beta users for CodeCombat Minecraft, but hope to make more available in the future.</div><form id="notify-me-form"><div class="checkbox"><label>\x3c!-- NOTE: This needs to be written as HTML or it won\'t pick up contained text--\x3e<input id="notify-me-check" type="checkbox"> Yes, please notify me about the CodeCombat Minecraft beta</label></div></form></div><div id="button-container"><button id="buy-now-button" class="btn btn-lg btn-illustrated purchase-button"><span>'+n.escape(null==(t="Buy Now $"+(e.price||"...")+"/")?"":t)+'</span><span class="no-text-transform">mo</span></button><button id="submit-button" class="btn btn-lg btn-illustrated sale-button">Submit</button></div></div></div></div></div>')}.call(this,"view"in e?e.view:"undefined"!=typeof view?view:void 0),i.join("")}},1655:function(e,t,i){var h=i(11);e.exports=function(e){var l,c=[],e=e||{};return function(e,o,r,s,a,t){c.push('<div class="modal-dialog"><div class="modal-content"><img src="/images/pages/play/modal/items-background.png" draggable="false" id="play-items-modal-bg"><img src="/images/pages/play/modal/items-background-narrow.png" draggable="false" id="play-items-modal-narrow-bg"><h1 data-i18n="play.items" class="big-font"></h1><div id="gems-count-container"><span id="gems-count" class="big-font">'+h.escape(null==(l=e)?"":l)+'</span></div><div id="close-modal"><span class="glyphicon glyphicon-remove"></span></div><ul class="nav nav-pills nav-stacked">'),function(){var e=o;if("number"==typeof e.length)for(var t=0,i=e.length;t<i;t++){var n=e[t];c.push("<li"+h.attr("id",n+"-tab",!0,!0)+h.cls([t?"":"active"],[!0])+"><a"+h.attr("href","#item-category-"+n,!0,!0)+' data-toggle="tab" class="one-line"><img'+h.attr("src","/images/pages/play/modal/item-icon-"+n+".png",!0,!0)+' draggable="false" class="tab-icon"><span class="big-font">'+h.escape(null==(l=s[t])?"":l)+"</span></a></li>")}else{i=0;for(t in e){i++;n=e[t];c.push("<li"+h.attr("id",n+"-tab",!0,!0)+h.cls([t?"":"active"],[!0])+"><a"+h.attr("href","#item-category-"+n,!0,!0)+' data-toggle="tab" class="one-line"><img'+h.attr("src","/images/pages/play/modal/item-icon-"+n+".png",!0,!0)+' draggable="false" class="tab-icon"><span class="big-font">'+h.escape(null==(l=s[t])?"":l)+"</span></a></li>")}}}.call(this),c.push('</ul><div id="hero-type-select" data-toggle="buttons" class="btn-group"><label id="all" class="btn active"><input type="radio" name="hero-class-select" autocomplete="off"><span data-i18n="editor.level_tab_thangs_all"></span></label><label id="warrior" class="btn"><input type="radio" name="hero-class-select" autocomplete="off"><span data-i18n="general.warrior"></span></label><label id="ranger" class="btn"><input type="radio" name="hero-class-select" autocomplete="off"><span data-i18n="general.ranger"></span></label><label id="wizard" class="btn"><input type="radio" name="hero-class-select" autocomplete="off"><span data-i18n="general.wizard"></span></label></div><div class="tab-content">'),function(){var e=o;if("number"==typeof e.length)for(var t=0,i=e.length;t<i;t++){var s=e[t];c.push("<div"+h.attr("id","item-category-"+s,!0,!0)+h.cls(["tab-pane",t?"":"active"],[null,!0])+'><div class="nano"><div class="nano-content">'),function(){var e=r[s].models;if("number"==typeof e.length)for(var t=0,i=e.length;t<i;t++)o=(o=(n=e[t]).comingSoon&&!a.isAdmin())||!n.get("gems")&&!n.owned,c.push("<div"+h.attr("data-item-id",n.id,!0,!0)+h.cls(["item "+n.get("heroClass")+(o?" hide":"")+(n.silhouetted&&!n.owned?" silhouetted":"")],[!0])+">"),n.silhouetted&&!n.owned?(c.push('<span class="glyphicon glyphicon-lock bolder"></span><span class="glyphicon glyphicon-lock"></span><img draggable="false" class="item-silhouette">'),n.level&&c.push('<div class="required-level"><div data-i18n="general.player_level"></div><div>'+h.escape(null==(l=n.level)?"":l)+"</div></div>")):c.push('<strong class="big-font">'+h.escape(null==(l=n.name)?"":l)+'</strong><img draggable="false" class="item-img">'),n.owned?c.push('<span data-i18n="play.owned" class="big-font owned"></span>'):n.silhouetted?c.push('<span data-i18n="play.locked" class="big-font locked"></span>'):(c.push('<span class="cost"><img src="/images/common/gem.png" draggable="false"><span class="big-font">'+h.escape(null==(l=n.get("gems"))?"":l)+"</span></span>"),n.get("subscriber")&&!a.isPremium()?c.push('<span data-i18n="subscribe.subscribe_title" class="btn subscribe-button big-font"></span>'):n.unequippable?c.push("<span"+h.attr("data-i18n","general."+n.get("heroClass").toLowerCase(),!0,!0)+' class="big-font unequippable"></span>'):c.push('<button data-i18n="play.unlock"'+h.attr("data-item-id",n.id,!0,!0)+' class="btn unlock-button big-font"></button>')),c.push("</div>");else{var n,o,i=0;for(t in e)i++,o=(o=(n=e[t]).comingSoon&&!a.isAdmin())||!n.get("gems")&&!n.owned,c.push("<div"+h.attr("data-item-id",n.id,!0,!0)+h.cls(["item "+n.get("heroClass")+(o?" hide":"")+(n.silhouetted&&!n.owned?" silhouetted":"")],[!0])+">"),n.silhouetted&&!n.owned?(c.push('<span class="glyphicon glyphicon-lock bolder"></span><span class="glyphicon glyphicon-lock"></span><img draggable="false" class="item-silhouette">'),n.level&&c.push('<div class="required-level"><div data-i18n="general.player_level"></div><div>'+h.escape(null==(l=n.level)?"":l)+"</div></div>")):c.push('<strong class="big-font">'+h.escape(null==(l=n.name)?"":l)+'</strong><img draggable="false" class="item-img">'),n.owned?c.push('<span data-i18n="play.owned" class="big-font owned"></span>'):n.silhouetted?c.push('<span data-i18n="play.locked" class="big-font locked"></span>'):(c.push('<span class="cost"><img src="/images/common/gem.png" draggable="false"><span class="big-font">'+h.escape(null==(l=n.get("gems"))?"":l)+"</span></span>"),n.get("subscriber")&&!a.isPremium()?c.push('<span data-i18n="subscribe.subscribe_title" class="btn subscribe-button big-font"></span>'):n.unequippable?c.push("<span"+h.attr("data-i18n","general."+n.get("heroClass").toLowerCase(),!0,!0)+' class="big-font unequippable"></span>'):c.push('<button data-i18n="play.unlock"'+h.attr("data-item-id",n.id,!0,!0)+' class="btn unlock-button big-font"></button>')),c.push("</div>")}}.call(this),c.push('<div class="clearfix"></div></div></div></div>')}else{i=0;for(t in e){i++;s=e[t];c.push("<div"+h.attr("id","item-category-"+s,!0,!0)+h.cls(["tab-pane",t?"":"active"],[null,!0])+'><div class="nano"><div class="nano-content">'),function(){var e=r[s].models;if("number"==typeof e.length)for(var t=0,i=e.length;t<i;t++)o=(o=(n=e[t]).comingSoon&&!a.isAdmin())||!n.get("gems")&&!n.owned,c.push("<div"+h.attr("data-item-id",n.id,!0,!0)+h.cls(["item "+n.get("heroClass")+(o?" hide":"")+(n.silhouetted&&!n.owned?" silhouetted":"")],[!0])+">"),n.silhouetted&&!n.owned?(c.push('<span class="glyphicon glyphicon-lock bolder"></span><span class="glyphicon glyphicon-lock"></span><img draggable="false" class="item-silhouette">'),n.level&&c.push('<div class="required-level"><div data-i18n="general.player_level"></div><div>'+h.escape(null==(l=n.level)?"":l)+"</div></div>")):c.push('<strong class="big-font">'+h.escape(null==(l=n.name)?"":l)+'</strong><img draggable="false" class="item-img">'),n.owned?c.push('<span data-i18n="play.owned" class="big-font owned"></span>'):n.silhouetted?c.push('<span data-i18n="play.locked" class="big-font locked"></span>'):(c.push('<span class="cost"><img src="/images/common/gem.png" draggable="false"><span class="big-font">'+h.escape(null==(l=n.get("gems"))?"":l)+"</span></span>"),n.get("subscriber")&&!a.isPremium()?c.push('<span data-i18n="subscribe.subscribe_title" class="btn subscribe-button big-font"></span>'):n.unequippable?c.push("<span"+h.attr("data-i18n","general."+n.get("heroClass").toLowerCase(),!0,!0)+' class="big-font unequippable"></span>'):c.push('<button data-i18n="play.unlock"'+h.attr("data-item-id",n.id,!0,!0)+' class="btn unlock-button big-font"></button>')),c.push("</div>");else{var n,o,i=0;for(t in e)i++,o=(o=(n=e[t]).comingSoon&&!a.isAdmin())||!n.get("gems")&&!n.owned,c.push("<div"+h.attr("data-item-id",n.id,!0,!0)+h.cls(["item "+n.get("heroClass")+(o?" hide":"")+(n.silhouetted&&!n.owned?" silhouetted":"")],[!0])+">"),n.silhouetted&&!n.owned?(c.push('<span class="glyphicon glyphicon-lock bolder"></span><span class="glyphicon glyphicon-lock"></span><img draggable="false" class="item-silhouette">'),n.level&&c.push('<div class="required-level"><div data-i18n="general.player_level"></div><div>'+h.escape(null==(l=n.level)?"":l)+"</div></div>")):c.push('<strong class="big-font">'+h.escape(null==(l=n.name)?"":l)+'</strong><img draggable="false" class="item-img">'),n.owned?c.push('<span data-i18n="play.owned" class="big-font owned"></span>'):n.silhouetted?c.push('<span data-i18n="play.locked" class="big-font locked"></span>'):(c.push('<span class="cost"><img src="/images/common/gem.png" draggable="false"><span class="big-font">'+h.escape(null==(l=n.get("gems"))?"":l)+"</span></span>"),n.get("subscriber")&&!a.isPremium()?c.push('<span data-i18n="subscribe.subscribe_title" class="btn subscribe-button big-font"></span>'):n.unequippable?c.push("<span"+h.attr("data-i18n","general."+n.get("heroClass").toLowerCase(),!0,!0)+' class="big-font unequippable"></span>'):c.push('<button data-i18n="play.unlock"'+h.attr("data-item-id",n.id,!0,!0)+' class="btn unlock-button big-font"></button>')),c.push("</div>")}}.call(this),c.push('<div class="clearfix"></div></div></div></div>')}}}.call(this),c.push('</div><div id="item-details-view"></div></div></div>')}.call(this,"gems"in e?e.gems:"undefined"!=typeof gems?gems:void 0,"itemCategories"in e?e.itemCategories:"undefined"!=typeof itemCategories?itemCategories:void 0,"itemCategoryCollections"in e?e.itemCategoryCollections:"undefined"!=typeof itemCategoryCollections?itemCategoryCollections:void 0,"itemCategoryNames"in e?e.itemCategoryNames:"undefined"!=typeof itemCategoryNames?itemCategoryNames:void 0,"me"in e?e.me:"undefined"!=typeof me?me:void 0,"undefined"in e?e.undefined:void 0),c.join("")}},1656:function(e,t,i){var n,o,s,r,a,l,v,c=function(e,t){return function(){return e.apply(t,arguments)}},h={}.hasOwnProperty;function u(e){var t;this.onEverythingLoaded=c(this.onEverythingLoaded,this),u.__super__.constructor.call(this,e),this.achievements=new Backbone.Collection,(t=new o([],{url:"/db/achievement",model:n})).setProjection(["name","description","icon","worth","i18n","rewards","collection","function","query"]),(e=new o([],{url:"/db/earned_achievement",model:s})).setProjection(["achievement","achievedAmount"]),t.skip=0,t.fetch({cache:!1,data:{skip:0,limit:a}}),e.skip=0,e.fetch({cache:!1,data:{skip:0,limit:a}}),this.listenTo(t,"sync",this.onAchievementsLoaded),this.listenTo(e,"sync",this.onEarnedAchievementsLoaded),this.stopListening(this.supermodel,"loaded-all"),this.supermodel.loadCollection(t,"achievement"),this.supermodel.loadCollection(e,"achievement"),this.onEverythingLoaded=_.after(2,this.onEverythingLoaded)}i(1657),r=i(80),l=i(1659),o=i(115),n=i(269),s=i(624),v=i(6),a=200,e.exports=(function(e,t){for(var i in t)h.call(t,i)&&(e[i]=t[i]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(u,r),u.prototype.className="modal fade play-modal",u.prototype.template=l,u.prototype.id="play-achievements-modal",u.prototype.plain=!0,u.prototype.earnedMap={},u.prototype.onAchievementsLoaded=function(e){var t=e.models.length===a;return this.achievements.add(e.models),t?(e.skip+=a,e.fetch({cache:!1,data:{skip:e.skip,limit:a}})):(this.stopListening(e),this.onEverythingLoaded())},u.prototype.onEarnedAchievementsLoaded=function(e){for(var t,i=e.models.length===a,n=e.models,o=0,s=n.length;o<s;o++)t=n[o],this.earnedMap[t.get("achievement")]=t;return i?(e.skip+=a,e.fetch({cache:!1,data:{skip:e.skip,limit:a}})):(this.stopListening(e),this.onEverythingLoaded())},u.prototype.onEverythingLoaded=function(){var e,t,i,n,o,s,r,a,l,c,h,u,p,d,m,f,g,y;for(this.achievements.set(this.achievements.filter(function(e){return"level.sessions"!==e.get("collection")||(null!=(e=e.get("query"))?e.team:void 0)})),t={earned:{},unearned:{}},s=0,l=(p=this.achievements.models).length;s<l;s++)e=p[s],(i=this.earnedMap[e.id])&&(e.earned=i,e.earnedDate=i.getCreationDate(),n=e.getExpFunction(),e.earnedGems=Math.round(((null!=(d=e.get("rewards"))?d.gems:void 0)||0)*n(i.get("achievedAmount"))),e.earnedPoints=Math.round((e.get("worth",!0)||0)*n(i.get("achievedAmount")))),null==e.earnedDate&&(e.earnedDate="");for(r=0,c=(m=this.achievements.models).length;r<c;r++)u=(o=(e=m[r]).earned?t.earned:t.unearned)[e.get("description")],f=(g=[e.get("worth",!0),null!=(f=null!=u?u.get("worth",!0):void 0)?f:0])[0],g=g[1],(e.earned?!u||g<f:!u||f<g)&&(o[e.get("description")]=e);for(this.achievements.set(_.values(t.earned).concat(_.values(t.unearned))),this.achievements.comparator=function(e){return e.earnedDate},this.achievements.sort(),this.achievements.set(this.achievements.models.reverse()),a=0,h=(y=this.achievements.models).length;a<h;a++)(e=y[a]).name=v.i18n(e.attributes,"name"),e.description=v.i18n(e.attributes,"description");return this.render()},u.prototype.afterRender=function(){if(u.__super__.afterRender.call(this),this.supermodel.finished())return this.playSound("game-menu-open")},u.prototype.onHidden=function(){return u.__super__.onHidden.call(this),this.playSound("game-menu-close")},u)},1657:function(e,t,i){var n=i(1658);(n="string"==typeof n?[[e.i,n,""]]:n).locals&&(e.exports=n.locals);(0,i(21).default)("0ea90576",n,!0,{})},1658:function(e,t,i){},1659:function(e,t,i){var h=i(11);e.exports=function(e){var l,c=[],e=e||{};return function(o,s,e,r,a){c.push('<div class="modal-dialog game"><div class="background-wrapper"><div class="modal-content"><div class="modal-header">'),r.closeButton&&c.push('<div type="button" data-dismiss="modal" aria-hidden="true" class="button close">&times;</div>'),c.push('<h3 data-i18n="play.achievements">Achievements</h3></div><div class="modal-body">'),function(){var e=r.achievements.models;if("number"==typeof e.length)for(var t=0,i=e.length;t<i;t++){var n=e[t];c.push("<div"+h.cls(["panel",n.earned?"earned":""],[null,!0])+'><div class="panel-body"><img'+h.attr("src",n.getImageURL(),!0,!0)+' draggable="false" class="icon"><h3>'+h.escape(null==(l=n.name+(n.earned&&n.earned.get("achievedAmount")?" - "+n.earned.get("achievedAmount")+"x":""))?"":l)+"</h3><p>"+h.escape(null==(l=n.description)?"":l)+"</p></div>"),n.earnedDate?c.push('<div class="created">'+h.escape(null==(l=o(n.earnedDate).fromNow())?"":l)+"</div>"):c.push('<div data-i18n="user.status_unfinished" class="created"></div>'),c.push('<div class="rewards">'),(s=n.get("rewards"))&&s.gems&&c.push('<span class="gems label label-default"><span>'+h.escape(null==(l=n.earnedGems||s.gems)?"":l)+'</span><img src="/images/common/gem.png" draggable="false" class="gem"></span>'),(a=n.get("worth"))&&c.push('<span class="worth label label-default"><span>'+h.escape(null==(l=n.earnedPoints||a)?"":l)+"xp</span></span>"),c.push("\x3c!-- maybe add more icons/numbers for items, heroes, levels, xp?--\x3e</div></div>")}else{i=0;for(t in e){i++;n=e[t];c.push("<div"+h.cls(["panel",n.earned?"earned":""],[null,!0])+'><div class="panel-body"><img'+h.attr("src",n.getImageURL(),!0,!0)+' draggable="false" class="icon"><h3>'+h.escape(null==(l=n.name+(n.earned&&n.earned.get("achievedAmount")?" - "+n.earned.get("achievedAmount")+"x":""))?"":l)+"</h3><p>"+h.escape(null==(l=n.description)?"":l)+"</p></div>"),n.earnedDate?c.push('<div class="created">'+h.escape(null==(l=o(n.earnedDate).fromNow())?"":l)+"</div>"):c.push('<div data-i18n="user.status_unfinished" class="created"></div>'),c.push('<div class="rewards">'),(s=n.get("rewards"))&&s.gems&&c.push('<span class="gems label label-default"><span>'+h.escape(null==(l=n.earnedGems||s.gems)?"":l)+'</span><img src="/images/common/gem.png" draggable="false" class="gem"></span>'),(a=n.get("worth"))&&c.push('<span class="worth label label-default"><span>'+h.escape(null==(l=n.earnedPoints||a)?"":l)+"xp</span></span>"),c.push("\x3c!-- maybe add more icons/numbers for items, heroes, levels, xp?--\x3e</div></div>")}}}.call(this),c.push('</div><div class="modal-body wait secret"><h3>Reticulating Splines...</h3><div class="progress progress-striped active"><div class="progress-bar"></div></div></div></div></div></div>')}.call(this,"moment"in e?e.moment:"undefined"!=typeof moment?moment:void 0,"rewards"in e?e.rewards:"undefined"!=typeof rewards?rewards:void 0,"undefined"in e?e.undefined:void 0,"view"in e?e.view:"undefined"!=typeof view?view:void 0,"worth"in e?e.worth:"undefined"!=typeof worth?worth:void 0),c.join("")}},1660:function(e,t,i){var n,o,s,r,a,l,c,h={}.hasOwnProperty;function u(){return u.__super__.constructor.apply(this,arguments)}o=i(80),c=i(1661),i(1662),n=i(632),a=i(27),i(58),s=i(57),r=i(627),l=i(32),e.exports=(function(e,t){for(var i in t)h.call(t,i)&&(e[i]=t[i]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(u,o),u.prototype.id="anonymous-teacher-modal",u.prototype.template=c,u.prototype.closeButton=!0,u.prototype.events={"click #anonymous-teacher-signup-button":"onClickAnonymousTeacherSignupButton","change #anonymous-teacher-email-input":"onChangeAnonymousTeacherEmailInput","input #anonymous-teacher-email-input":"onChangeAnonymousTeacherEmailInput","change #anonymous-teacher-student-name-input":"onChangeAnonymousStudentNameInput","input #anonymous-teacher-student-name-input":"onChangeAnonymousStudentNameInput","click #anonymous-teacher-email-send-button":"onClickAnonymousTeacherEmailSendButton"},u.prototype.initialize=function(){var e;return this.state=new s({checkEmailState:"none",checkNameState:"none",sendEmailState:"none"}),l.load("teacher signup email sent")&&this.state.set("sendEmailState","sent"),this.listenTo(this.state,"change:checkEmailState",function(){return this.renderSelectors(".email-check","#anonymous-teacher-email-send-button")}),this.listenTo(this.state,"change:checkNameState",function(){return this.renderSelectors(".name-check","#anonymous-teacher-email-send-button")}),this.listenTo(this.state,"change:sendEmailState",function(){return this.renderSelectors("#anonymous-teacher-email-send-button","#anonymous-teacher-email-error")}),null!=(e=window.tracker)?e.trackEvent("Anonymous teacher signup modal opened",{category:"World Map",sendEmailState:this.state.get("sendEmailState")}):void 0},u.prototype.onClickAnonymousTeacherSignupButton=function(e){var t;return this.openModalView(new n({startOnPath:"teacher"})),null!=(t=window.tracker)?t.trackEvent("Anonymous teacher signup modal teacher signup",{category:"World Map"}):void 0},u.prototype.getEmail=function(){return _.string.trim(this.$("#anonymous-teacher-email-input").val())},u.prototype.getStudentName=function(){return _.string.trim(this.$("#anonymous-teacher-student-name-input").val())},u.prototype.onChangeAnonymousTeacherEmailInput=function(e){var t=this.getEmail(),i=a.validateEmail(t)&&!/codecombat/i.test(t);return t?i?this.state.set("checkEmailState","valid"):this.state.set("checkEmailState","invalid"):this.state.set("checkEmailState","none")},u.prototype.onChangeAnonymousStudentNameInput=function(e){var t=this.getStudentName();return t?_.isEmpty(t)?this.state.set("checkNameState","invalid"):this.state.set("checkNameState","valid"):this.state.set("checkNameState","none")},u.prototype.onClickAnonymousTeacherEmailSendButton=function(e){var t,i;if(!this.state.get(!1))return this.state.set("sendEmailState","sending"),r.sendTeacherSignupInstructions(this.getEmail(),this.getStudentName()).then((i=this,function(){var e;return i.state.set("sendEmailState","sent"),l.save("teacher signup email sent",!0),null!=(e=window.tracker)&&e.trackEvent("Anonymous teacher signup modal sent",{category:"World Map",email:i.getEmail(),name:i.getStudentName()}),i.hide()})).catch((t=this,function(){return t.state.set("sendEmailState","error")}))},u)},1661:function(e,t,i){i(11);e.exports=function(e){var t=[],e=e||{};return function(e){t.push('<div class="modal-dialog"><div id="modal-base-flat" class="modal-content style-flat"><div class="modal-header">'),e.closeButton&&t.push('<div type="button" data-dismiss="modal" aria-hidden="true" class="button close">&times;</div>'),t.push('<h3 data-i18n="new_home.want_coco" class="center"></h3></div><div class="modal-body"><div class="row"><div class="col-xs-12"><p class="center"><strong data-i18n="anonymous_teacher.teachers_section"></strong></p><p><button id="anonymous-teacher-signup-button" data-i18n="anonymous_teacher.create_teacher_account" class="btn btn-primary btn-lg btn-block"></button></p><p data-i18n="new_home.get_started_subtitle"></p></div>\x3c!--.col-xs-1.separator-column--\x3e\x3c!--.col-xs-1--\x3e\x3c!--.col-xs-5--\x3e\x3c!--  p.center--\x3e\x3c!--    strong(data-i18n="anonymous_teacher.students_section")--\x3e\x3c!--  if view.state.get(\'sendEmailState\') === \'sent\'--\x3e\x3c!--    p.center(data-i18n="anonymous_teacher.teacher_notified")--\x3e\x3c!--  else--\x3e\x3c!--    p--\x3e\x3c!--      .input-group--\x3e\x3c!--        p--\x3e\x3c!--          span(data-i18n="anonymous_teacher.enter_student_name")--\x3e\x3c!--          input.form-control.input-lg#anonymous-teacher-student-name-input(data-i18n="[placeholder]anonymous_teacher.student_name_placeholder")--\x3e\x3c!--          .name-check--\x3e\x3c!--            - var checkNameState = view.state.get(\'checkNameState\');--\x3e\x3c!--            if checkNameState === \'invalid\'--\x3e\x3c!--              small.small--\x3e\x3c!--                span.text-burgundy.glyphicon.glyphicon-remove-circle--\x3e\x3c!--            if checkNameState === \'valid\'--\x3e\x3c!--              small.small--\x3e\x3c!--                span.text-forest.glyphicon.glyphicon-ok-circle--\x3e\x3c!--        p--\x3e\x3c!--          span(data-i18n="anonymous_teacher.enter_teacher_email")--\x3e\x3c!--          input.form-control.input-lg#anonymous-teacher-email-input(data-i18n="[placeholder]anonymous_teacher.teacher_email_placeholder")--\x3e\x3c!--          .email-check--\x3e\x3c!--            - var checkEmailState = view.state.get(\'checkEmailState\');--\x3e\x3c!--            if checkEmailState === \'invalid\'--\x3e\x3c!--              small.small--\x3e\x3c!--                span.text-burgundy.glyphicon.glyphicon-remove-circle--\x3e\x3c!--            if checkEmailState === \'valid\'--\x3e\x3c!--              small.small--\x3e\x3c!--                span.text-forest.glyphicon.glyphicon-ok-circle--\x3e\x3c!--      br--\x3e\x3c!--      p--\x3e\x3c!--        button.btn.btn-primary.btn-lg.pull-right#anonymous-teacher-email-send-button(data-i18n="anonymous_teacher.notify_teacher", disabled=view.state.get(\'checkEmailState\') != \'valid\' || view.state.get(\'checkNameState\') != \'valid\')--\x3e\x3c!--      small.small#anonymous-teacher-email-error--\x3e\x3c!--        if view.state.get(\'sendEmailState\') == \'error\'--\x3e\x3c!--          span(data-i18n="signup.parent_email_error")--\x3e</div></div><div class="modal-body wait secret"><h3>Reticulating Splines...</h3><div class="progress progress-striped active"><div class="progress-bar"></div></div></div><div class="modal-footer"><button type="button" data-dismiss="modal" aria-hidden="true" data-i18n="modal.okay" class="btn btn-primary">Okay</button></div></div></div>')}.call(this,"view"in e?e.view:"undefined"!=typeof view?view:void 0),t.join("")}},1662:function(e,t,i){var n=i(1663);(n="string"==typeof n?[[e.i,n,""]]:n).locals&&(e.exports=n.locals);(0,i(21).default)("70738f17",n,!0,{})},1663:function(e,t,i){},1664:function(e,t,i){var n=i(1665);(n="string"==typeof n?[[e.i,n,""]]:n).locals&&(e.exports=n.locals);(0,i(21).default)("4060e068",n,!0,{})},1665:function(e,t,i){},1666:function(e,t,i){var n=i(11);e.exports=function(e){var t=[],e=e||{};return function(e){t.push('<div class="modal-dialog"><div class="modal-content"><img id="amazon-hoc-background" src="/images/pages/play/modal/subscribe-background-blank.png"><h1 data-i18n="amazon_hoc.title"></h1><div id="close-modal"><span class="glyphicon glyphicon-remove"></span></div><div class="paper-area text-center">'),e.options.hideCongratulation||t.push('<h3 data-i18n="amazon_hoc.congrats"></h3>'),t.push('<img src="/images/pages/play/aws-educate-logo.png"><p><span data-i18n="amazon_hoc.educate_1"> </span>'+n.escape(" ")+'<a id="aws-educate-link" href="https://aws.amazon.com/education/awseducate/14-and-older/" data-i18n="amazon_hoc.educate_2" target="_blank"></a><span>.</span></p><img src="/images/pages/play/future-engineer-logo.png"><p><span data-i18n="amazon_hoc.future_eng_1"></span>'+n.escape(" ")+'<a id="aws-alexa-link" href="https://learn.amazonfutureengineer.com/alexa/fact-skill/#/" data-i18n="amazon_hoc.future_eng_2" target="_blank"></a>'+n.escape(" ")+'<span data-i18n="amazon_hoc.future_eng_3"></span>'+n.escape(" ")+'<a id="aws-future-eng-link" href="http://amazonfutureengineer.com/" data-i18n="amazon_hoc.future_eng_4" target="_blank"></a>'+n.escape(" ")+'<span data-i18n="amazon_hoc.future_eng_5"></span></p></div></div></div>')}.call(this,"view"in e?e.view:"undefined"!=typeof view?view:void 0),t.join("")}},1667:function(e,t,i){var n,o={}.hasOwnProperty;function s(){return s.__super__.constructor.apply(this,arguments)}i(1668),n=i(80),i=i(1670),e.exports=(function(e,t){for(var i in t)o.call(t,i)&&(e[i]=t[i]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(s,n),s.prototype.template=i,s.prototype.id="promotion-modal",s.prototype.events={"click #close-modal":"hide","mouseup .promotion-link":"onClickPromotionLink"},s.prototype.onClickPromotionLink=function(e){var t;return null!=(t=window.tracker)?t.trackEvent("Click Promotion link",{label:"tarena-winter-tour-link"}):void 0},s)},1668:function(e,t,i){var n=i(1669);(n="string"==typeof n?[[e.i,n,""]]:n).locals&&(e.exports=n.locals);(0,i(21).default)("78591494",n,!0,{})},1669:function(e,t,i){},1670:function(e,t,i){i(11);e.exports=function(e){var t=[];return t.push('<div class="modal-dialog"><div class="modal-content"><img id="promotion-background" src="/images/pages/play/modal/subscribe-background-blank.png"><h1>Coding in Beijing Dec 27 - Jan 4</h1><div id="close-modal"><span class="glyphicon glyphicon-remove"></span></div><div class="paper-area text-center"><a href="http://us.it61.cn/" target="_blank" class="promotion-link"><img src="/images/pages/play/tarena-winter-tour-1200.jpg"></a><p><strong>Are you 13-18 years old? Do you want to visit China this winter?</strong></p><p><span>Immerse yourself in all things China, AI, and coding with a limited offer from our coding partner, Tongcheng Tongmei.</span></p><p><a href="http://us.it61.cn/" target="_blank" class="btn btn-lg btn-primary btn-illustrated promotion-link">Learn More</a></p></div></div></div>'),t.join("")}},1671:function(s,e,r){!function(i){var e,t,o={}.hasOwnProperty;function n(e){n.__super__.constructor.call(this,e),this.propsData.showVideo=(null!=e?e.showVideo:void 0)||!1,this.onDestroy=null!=e?e.onDestroy:void 0}t=r(636),e=r(1672).default,s.exports=(function(e,t){for(var i in t)o.call(t,i)&&(e[i]=t[i]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(n,t),n.prototype.id="hoc-interstitial-modal",n.prototype.template=r(1502),n.prototype.closeButton=!0,n.prototype.VueComponent=e,n.prototype.initialize=function(){return this.propsData={clickStudent:function(){return t.hide()},clickTeacher:(e=t=this,function(){return i.router.navigate("/teachers/hour-of-code?activity="+(e.options.activity||"ai-league"),{trigger:!0})}),showVideo:!1};var e,t},n.prototype.destroy=function(){return"function"==typeof this.onDestroy&&this.onDestroy(),n.__super__.destroy.call(this)},n)}.call(this,r(17))},1672:function(e,t,i){"use strict";i.r(t);var n,o=i(1726),s=i(1464);for(n in s)["default"].indexOf(n)<0&&function(e){i.d(t,e,function(){return s[e]})}(n);i(1673);var r=i(19),o=Object(r.a)(s.default,o.a,o.b,!1,null,null,null);t.default=o.exports},1673:function(e,t,i){"use strict";var n=i(1466);i.n(n).a},1674:function(e,t,i){},1675:function(e,t,i){"use strict";var n=i(1469);i.n(n).a},1676:function(e,t,i){},1677:function(e,t,i){var n,o,s,r={}.hasOwnProperty;function a(){return a.__super__.constructor.apply(this,arguments)}i(1678),n=i(80),s=i(1680),i(27),o=i(32),e.exports=(function(e,t){for(var i in t)r.call(t,i)&&(e[i]=t[i]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(a,n),a.prototype.id="browser-recommendation-modal",a.prototype.closesOnClickOutside=!1,a.prototype.template=s,a.prototype.events={"click #downlaod-button":"downloadChrome","click #cancel-button":"onClickClose"},a.prototype.downloadChrome=function(){return window.open("https://www.google.cn/intl/zh-CN/chrome/",{target:"_blank"})},a.prototype.onClickClose=function(){return o.save("hideBrowserRecommendation",!0)},a)},1678:function(e,t,i){var n=i(1679);(n="string"==typeof n?[[e.i,n,""]]:n).locals&&(e.exports=n.locals);(0,i(21).default)("565fc7e5",n,!0,{})},1679:function(e,t,i){},168:function(e,t,i){var a,l,c=[].slice,h=[].indexOf||function(e){for(var t=0,i=this.length;t<i;t++)if(t in this&&this[t]===e)return t;return-1};function f(e,t,i){this.world=e,this.spriteName=t,this.id=i,null==this.spriteName&&(this.spriteName=this.constructor.className),null==this.id&&(this.id=this.constructor.nextID(this.spriteName,this.world)),this.addTrackedProperties(["exists","boolean"])}a=i(95),l=i(173).thangNames,i(172).ArgumentError,i(120),e.exports=(f.className="Thang",f.remainingThangNames={},f.nextID=function(e,t){for(var i,n=l[e]||[e],o=f.remainingThangNames[e],s=(o=null==o||!o.length?f.remainingThangNames[e]=n.slice():o).splice(t.rand.rand(o.length),1)[0],r=0;t.thangMap[i=r?s+" "+r:s];)r++;return i},f.resetThangIDs=function(){return f.remainingThangNames={}},f.prototype.isThang=!0,f.prototype.apiProperties=["id","spriteName","health","pos","team"],f.prototype.destroy=function(){for(var e in this)this[e]=void 0;return this.destroyed=!0,this.destroy=function(){}},f.prototype.updateRegistration=function(){for(var e,t=this.world.systems,i=[],n=0,o=t.length;n<o;n++)e=t[n],i.push(e.register(this));return i},f.prototype.publishNote=function(e,t){return(t.thang=this).world.publishNote(e,t)},f.prototype.getGoalState=function(e){return this.world.getGoalState(e)},f.prototype.setGoalState=function(e,t){return this.world.setGoalState(e,t)},f.prototype.getThangByID=function(e){return this.world.getThangByID(e)},f.prototype.addComponents=function(){var e,t,i,n,o,s,r,a,l=1<=arguments.length?c.call(arguments,0):[];for(null==this.components&&(this.components=[]),a=[],n=0,o=l.length;n<o;n++)t=(r=l[n])[0],i=r[1],this.components.push([t,i]),_.isString(t)?t=this.world.classMap[t]:null!=(r=this.world)&&null==(e=r.classMap)[s=t.className]&&(e[s]=t),(i=new t(null!=i?i:{})).world=this.world,a.push(i.attach(this));return a},f.prototype.addTrackedProperties=function(){var e,t,i,n,o,s,r=1<=arguments.length?c.call(arguments,0):[];for(null==this.trackedPropertiesKeys&&(this.trackedPropertiesKeys=[]),null==this.trackedPropertiesTypes&&(this.trackedPropertiesTypes=[]),null==this.trackedPropertiesUsed&&(this.trackedPropertiesUsed=[]),o=[],e=0,t=r.length;e<t;e++){if(i=(n=r[e])[0],s=n[1],h.call(a.trackedPropertyTypes,s)<0)throw new Error("Type "+s+" for property "+i+" is not a trackable property type: "+a.trackedPropertyTypes);if(-1===(n=this.trackedPropertiesKeys.indexOf(i)))this.trackedPropertiesKeys.push(i),this.trackedPropertiesTypes.push(s),o.push(this.trackedPropertiesUsed.push(!1));else{if(s!==(n=this.trackedPropertiesTypes[n]))throw new Error("Two types were specified for trackable property "+i+": "+n+" and "+s+".");o.push(void 0)}}return o},f.prototype.keepTrackedProperty=function(e){e=this.trackedPropertiesKeys.indexOf(e);if(-1!==e)return this.trackedPropertiesUsed[e]=!0},f.prototype.addTrackedFinalProperties=function(){var n,o=1<=arguments.length?c.call(arguments,0):[];return null==this.trackedFinalProperties&&(this.trackedFinalProperties=[]),this.trackedFinalProperties=this.trackedFinalProperties.concat(function(){for(var e=[],t=0,i=o.length;t<i;t++)n=o[t],0<=h.call(this.trackedFinalProperties,n)||e.push(n);return e}.call(this))},f.prototype.getState=function(){return this._state=new a(this)},f.prototype.setState=function(e){return this._state=e.restore()},f.prototype.toString=function(){return this.id},f.prototype.createMethodChain=function(e){var t;return null==this.methodChains&&(this.methodChains={}),(t=this.methodChains[e])||(t=this.methodChains[e]={original:this[e],user:null,components:[]},this[e]=_.partial(this.callChainedMethod,e)),t},f.prototype.appendMethod=function(e,t){return this.createMethodChain(e).components.push(t)},f.prototype.callChainedMethod=function(){for(var e,t=arguments[0],i=2<=arguments.length?c.call(arguments,1):[],n=this.methodChains[t],t=n.user||n.original,o=null!=t?t.apply(this,i):void 0,s=n.components,r=0,a=s.length;r<a;r++)o=null!=(e=s[r].apply(this,i))?e:o;return o},f.prototype.getMethodSource=function(e){var t,i={};return null!=this.methodChains&&e in this.methodChains?(t=this.methodChains[e],i.original=t.original.toString(),i.user=null!=(t=t.user)?t.toString():void 0):i.original=null!=(e=null!=(e=this[e])?e.toString():void 0)?e:"",i.original=Aether.getFunctionBody(i.original),i},f.prototype.serialize=function(){for(var e,t,i,n,o,s,r,a,l,c,h,u,p={spriteName:this.spriteName,id:this.id,components:[],finalState:{}},d=null!=(c=this.components)?c:[],m=o=0,f=d.length;o<f;m=++o)t=(l=d[m])[0],n=l[1],_.isString(t)?i=t:(i=t.className,null==(e=this.world.classMap)[l=t.className]&&(e[l]=t)),p.components.push([i,n]);for(s=0,r=(h=null!=(c=this.trackedFinalProperties)?c:[]).length;s<r;s++)u=h[s],p.finalState[u]=this[u];return p.unusedTrackedPropertyKeys=function(){var e,t,i=this.trackedPropertiesUsed,n=[];for(a=t=0,e=i.length;t<e;a=++t)i[a]||n.push(this.trackedPropertiesKeys[a]);return n}.call(this),p},f.deserialize=function(o,e,t,i){for(var n,s,r,a,l,c,h,u=new f(e,o.spriteName,o.id),p=o.components,d=0,m=p.length;d<m;d++)s=(l=p[d])[0],r=l[1],(n=t[s])||(console.debug("Compiling new Component while deserializing:",s),l=_.find(i,{name:s}),n=e.loadClassFromCode(l.js,s,"component"),e.classMap[s]=n),u.addComponents([n,r]);for(a in u.unusedTrackedPropertyKeys=o.unusedTrackedPropertyKeys,u.unusedTrackedPropertyValues=function(){for(var e=o.unusedTrackedPropertyKeys,t=[],i=0,n=e.length;i<n;i++)a=e[i],t.push(u[a]);return t}(),c=o.finalState)h=c[a],u[a]=h;return u},f.prototype.serializeForAether=function(){return{CN:this.constructor.className,id:this.id}},f.prototype.getLankOptions=function(){var e,t,i,n,o,s=this.teamColors||(null!=(s=this.world)?s.getTeamColors():void 0)||{},r={colorConfig:{}};if("Hero Placeholder"===this.id&&!this.world.getThangByID("Hero Placeholder 1"))return r;if(this.team&&(o=s[this.team])&&(r.colorConfig.team=o),this.color&&(e=this.grabColorConfig(this.color))&&(r.colorConfig.color=e),this.colors)for(t in n=this.colors)i=n[t],r.colorConfig[t]=i;return r},f.prototype.grabColorConfig=function(e){return{green:{hue:.33,saturation:.5,lightness:.5},black:{hue:0,saturation:0,lightness:.25},violet:{hue:.83,saturation:.5,lightness:.5}}[e]},f)},1680:function(e,t,i){i(626);e.exports=function(e){return'<div class="modal-recommendation"><div class="modal-body"><p data-i18n="browser_recommendation.pitch_body"> </p></div><div class="modal-button"><button class="btn btn-primary btn-large" id="downlaod-button" data-i18n="browser_recommendation.download"></button><button class="btn btn-default btn-large" id="cancel-button" data-dismiss="modal" aria-hidden="true" data-i18n="browser_recommendation.ignore"></button></div></div>'}},1681:function(i,e,f){!function(o,m){var s,e;function t(e){var t,i,n;this.aether=e.aether,this.aetherProblem=e.aetherProblem,this.ace=e.ace,i=e.isCast,this.levelID=e.levelID,t=e.error,e=e.userCodeHasChangedSinceLastCast,null==i&&(i=!1),this.aetherProblem?(this.annotation=this.buildAnnotationFromAetherProblem(this.aetherProblem),i&&(n=this.buildMarkerRangesFromAetherProblem(this.aetherProblem),this.lineMarkerRange=n.lineMarkerRange,this.textMarkerRange=n.textMarkerRange),n=this.aetherProblem,this.level=n.level,this.range=n.range,this.message=n.message,this.hint=n.hint,this.userInfo=n.userInfo,n=(null!=(n=this.aetherProblem.range)?n[0]:void 0)||{},this.row=n.row,n[this],this.createdBy="aether"):(e||(this.annotation=this.buildAnnotationFromWebDevError(t),n=this.buildMarkerRangesFromWebDevError(t),this.lineMarkerRange=n.lineMarkerRange,this.textMarkerRange=n.textMarkerRange),this.level="error",this.row=t.line,this.column=t.column,this.message=t.message||"Unknown Error",t.line&&!e&&(this.message="Line "+(t.line+1)+": "+this.message),this.hint=e?"This error was generated by old code Try running your new code first.":void 0,this.userInfo=void 0,this.createdBy="web-dev-iframe"),this.message=this.translate(this.message),this.hint=this.translate(this.hint),o.isIPadApp&&Backbone.Mediator.publish("problem:problem-created",{line:this.annotation.row,text:this.annotation.text})}e=f(1383),s=e.require("ace/range").Range,i.exports=(t.prototype.annotation=null,t.prototype.markerRange=null,t.prototype.isEqual=function(t){return _.all(["row","column","level","column","message","hint"],(i=this,function(e){return i[e]===t[e]}));var i},t.prototype.destroy=function(){if(this.removeMarkerRanges(),this.userCodeProblem)return this.userCodeProblem.off()},t.prototype.buildAnnotationFromWebDevError=function(e){var t=this.translate(e.message);return{row:e.line,column:e.column,raw:t,text:t,type:"error",createdBy:"web-dev-iframe"}},t.prototype.buildAnnotationFromAetherProblem=function(e){var t;if(e.range)return t=this.translate(e.message.replace(/^Line \d+: /,"")),{row:(e=e.range[0]).row,column:e.col,raw:t,text:t,type:null!=(t=this.aetherProblem.level)?t:"error",createdBy:"aether"}},t.prototype.buildMarkerRangesFromWebDevError=function(e){e=new s(e.line,0,e.line,1);return e.start=this.ace.getSession().getDocument().createAnchor(e.start),e.end=this.ace.getSession().getDocument().createAnchor(e.end),e.id=this.ace.getSession().addMarker(e,"problem-line","fullLine"),{lineMarkerRange:e,textMarkerRange:void 0}},t.prototype.buildMarkerRangesFromAetherProblem=function(e){var t,i,n;return e.range?(i=(n=e.range)[0],t=n[1],n="problem-marker-"+e.level,(e=new s(i.row,i.col,t.row,t.col)).start=this.ace.getSession().getDocument().createAnchor(e.start),e.end=this.ace.getSession().getDocument().createAnchor(e.end),e.id=this.ace.getSession().addMarker(e,n,"text"),(t=new s(i.row,i.col,t.row,t.col)).start=this.ace.getSession().getDocument().createAnchor(t.start),t.end=this.ace.getSession().getDocument().createAnchor(t.end),t.id=this.ace.getSession().addMarker(t,"problem-line","fullLine"),{lineMarkerRange:t,textMarkerRange:e}):{}},t.prototype.removeMarkerRanges=function(){if(this.textMarkerRange&&(this.ace.getSession().removeMarker(this.textMarkerRange.id),this.textMarkerRange.start.detach(),this.textMarkerRange.end.detach()),this.lineMarkerRange)return this.ace.getSession().removeMarker(this.lineMarkerRange.id),this.lineMarkerRange.start.detach(),this.lineMarkerRange.end.detach()},t.prototype.makeTranslationRegex=function(e){return new RegExp(function(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}(e).replace(/\\\$\d/g,"(.+)").replace(/ +/g," +"))},t.prototype.translate=function(e){var t,i,n,o,s,r,a,l,c,h,u,p,d;if(!e)return e;if(/\n/.test(e))return e.split("\n").map((d=this,function(e){return d.translate(e)})).join("\n");if(e=e.replace(/([A-Za-z]+Error:) \1/,"$1"),"en"===(h=m.i18n.language)||"en-US"===h)return e;for(i=f(122).translation,t=function(e,t,i){var n="esper."+i,i=m.i18n.t(n);if(i!==n)return(i=e.replace(t,i))!==e?[i.replace(/``/g,"`"),!0]:[e,!1]},o=0,a=(u=[c=["line_no","uncaught","reference_error","argument_error","type_error","syntax_error","error"],Object.keys(_.omit(i.esper),c)]).length;o<a;o++)for(s=0,l=(r=u[o]).length;s<l&&(p=r[s],n=i.esper[p],e=(p=t(e,this.makeTranslationRegex(n),p))[0],!p[1]||r===c);s++);return e},t)}.call(this,f(17),f(3))},1683:function(n,e,s){!function(c){var e,h,t,o={}.hasOwnProperty;function i(e){i.__super__.constructor.call(this,e),this.session=e.session,this.mirrorSession=e.mirrorSession,this.level=e.level}e=s(26),t=s(1913),s(167).createAetherOptions,h=s(1375),n.exports=(function(e,t){for(var i in t)o.call(t,i)&&(e[i]=t[i]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(i,e),i.prototype.className="ladder-submission-view",i.prototype.template=t,i.prototype.events={"click .rank-button":"rankSession","click .help-simulate":"onHelpSimulate"},i.prototype.getRenderData=function(){var e,t=i.__super__.getRenderData.call(this);return t.readyToRank=null!=(e=this.session)?e.readyToRank():void 0,t.isRanking=null!=(e=this.session)?e.get("isRanking"):void 0,t.simulateURL="/play/ladder/"+this.level.get("slug")+"#simulate",(e=null!=(e=this.session)?e.get("submitDate"):void 0)&&(t.lastSubmitted=moment(e).fromNow()),t},i.prototype.afterRender=function(){if(i.__super__.afterRender.call(this),this.supermodel.finished())return this.rankButton=this.$el.find(".rank-button"),this.updateButton()},i.prototype.updateButton=function(){var e,t="unavailable";return null!=(e=this.session)&&e.readyToRank()?t="rank":null!=(e=this.session)&&e.get("isRanking")&&(t="ranking"),this.setRankingButtonText(t)},i.prototype.setRankingButtonText=function(e){var t;return this.rankButton.find("span").hide(),this.rankButton.find("."+e).show(),this.rankButton.toggleClass("disabled","rank"!==e),t="submitted"===e||"ranking"===e,this.$el.find(".help-simulate").toggle(t,"slow"),e=!("submitting"===e),this.$el.find(".last-submitted").toggle(e)},i.prototype.showApologeticSignupModal=function(){var e;return window.nextURL="/play/ladder/"+this.level.get("slug")+"?submit=true",e=s(118),this.openModalView(new e({accountRequiredMessage:c.i18n.t("signup.create_account_to_submit_multiplayer")}))},i.prototype.rankSession=function(e){var s,t,r,a,i,n,l;if(this.session.readyToRank())return me.get("anonymous")?this.showApologeticSignupModal():(this.playSound("menu-button-click"),this.setRankingButtonText("submitting"),(t=me.age())&&this.session.set("creatorAge",t),r=function(){if(i.destroyed||i.setRankingButtonText("submitted"),Backbone.Mediator.publish("ladder:game-submitted",{session:i.session,level:i.level}),i.submittingInProgress=!1,i.destroyed)return i.session=i.level=i.mirrorSession=i.submittingInProgress=void 0},s=function(e,t,i){if(console.log(e.responseText),n.destroyed||n.setRankingButtonText("failed"),n.submittingInProgress=!1,n.destroyed)return n.session=n.level=n.mirrorSession=n.submittingInProgress=void 0},(n=i=this).submittingInProgress=!0,a=this.session.clone(),this.level.isType("ladder")&&"ogres"===a.get("team")&&(t=null!=(t=a.get("code"))?t:{"hero-placeholder":{plan:""},"hero-placeholder-1":{plan:""}},a.set("team","humans"),t["hero-placeholder"]=t["hero-placeholder-1"],a.set("code",t)),a.save(null,{success:(l=this,function(){var e,t,i,n={session:l.session.id,levelID:l.level.id,originalLevelID:l.level.get("original"),levelMajorVersion:l.level.get("version").major},o={type:"POST",data:n,success:r,error:s};return l.mirrorSession&&((e=_.clone(n)).session=l.mirrorSession.id,i=null!=(n=l.mirrorSession.get("code"))?n:{},"humans"===a.get("team")?i["hero-placeholder-1"]=a.get("code")["hero-placeholder"]:i["hero-placeholder"]=a.get("code")["hero-placeholder-1"],(t=_.clone(o)).data=e,o.success=function(){var e={code:i,codeLanguage:a.get("codeLanguage")};return new h({_id:l.mirrorSession.id}).save(e,{patch:!0,type:"PUT",success:function(){return c.ajax("/queue/scoring",t)}})}),c.ajax("/queue/scoring",o)})}))},i.prototype.onHelpSimulate=function(){return this.playSound("menu-button-click"),c('a[href="#simulate"]').tab("show")},i.prototype.destroy=function(){var e,t;if(this.submittingInProgress&&(t=this.session,e=this.level,this.mirrorSession),i.__super__.destroy.call(this),t)return this.session=t,this.level=e,this.mirrorSession=this.mirrorSession,this.submittingInProgress=!0},i)}.call(this,s(3))},1684:function(a,e,l){!function(t,e){var i,c,u,n,o=function(e,t){return function(){return e.apply(t,arguments)}},s={}.hasOwnProperty,p=[].indexOf||function(e){for(var t=0,i=this.length;t<i;t++)if(t in this&&this[t]===e)return t;return-1};function r(e){this.tick=o(this.tick,this),r.__super__.constructor.call(this,e),this.originalScripts=this.filterScripts(e.scripts),this.session=e.session,this.levelID=e.levelID,this.debugScripts=t.isIPadApp||n.getQueryVariable("dev"),this.initProperties(),this.addScriptSubscriptions(),this.beginTicking()}i=l(45),l(26),u=l(170).scriptMatchesEventPrereqs,n=l(6),(c=[]).push(l(1919)),c.push(l(1920)),c.push(l(1921)),c.push(l(1922)),c.push(l(1923)),a.exports=(function(e,t){for(var i in t)s.call(t,i)&&(e[i]=t[i]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(r,i),r.prototype.scriptInProgress=!1,r.prototype.currentNoteGroup=null,r.prototype.currentTimeouts=[],r.prototype.worldLoading=!0,r.prototype.ignoreEvents=!1,r.prototype.quiet=!1,r.prototype.triggered=[],r.prototype.ended=[],r.prototype.noteGroupQueue=[],r.prototype.originalScripts=[],r.prototype.subscriptions={"script:end-current-script":"onEndNoteGroup","level:loading-view-unveiling":function(){return this.setWorldLoading(!1)},"level:restarted":"onLevelRestarted","level:shift-space-pressed":"onEndNoteGroup","level:escape-pressed":"onEndAll"},r.prototype.shortcuts={"+space, space, enter":function(){return Backbone.Mediator.publish("level:shift-space-pressed",{})},escape:function(){return Backbone.Mediator.publish("level:escape-pressed",{})}},r.prototype.setScripts=function(e){return this.originalScripts=this.filterScripts(e),this.quiet=!0,this.initProperties(),this.loadFromSession(),this.quiet=!1,this.addScriptSubscriptions(),this.run()},r.prototype.filterScripts=function(e){return _.filter(e,function(e){return!!me.isAdmin()||("Intro Dialogue"!==(e=e.id)&&"Failure Dialogue"!==e&&"Success Dialogue"!==e||null!=serverConfig.enableNarrative&&!(me.get("testGroupNumber")%8<4))})},r.prototype.initProperties=function(){return this.scriptInProgress&&this.endAll({force:!0}),this.triggered=[],this.ended=[],this.noteGroupQueue=[],this.scripts=e.extend(!0,[],this.originalScripts)},r.prototype.addScriptSubscriptions=function(){for(var e,t,i,n,o=0,s=function(t){return function(e){return n.onNote(t,e)}},r=[],a=0,l=(t=(n=this).scripts).length;a<l;a++)(i=t[a]).id||(i.id=(o++).toString()),e=s(i.channel),r.push(this.addNewSubscription(i.channel,e));return r},r.prototype.beginTicking=function(){return this.tickInterval=setInterval(this.tick,5e3)},r.prototype.tick=function(){for(var e,t,i={},n=new Date,o=this.scripts,s=0,r=o.length;s<r;s++)i[(e=o[s]).id]={timeSinceLastEnded:(e.lastEnded?n-e.lastEnded:0)/1e3,timeSinceLastTriggered:(e.lastTriggered?n-e.lastTriggered:0)/1e3};return t={scriptRunning:(null!=(t=this.currentNoteGroup)?t.scriptID:void 0)||"",noteGroupRunning:(null!=(t=this.currentNoteGroup)?t.name:void 0)||"",scriptStates:i,timeSinceLastScriptEnded:(this.lastScriptEnded?n-this.lastScriptEnded:0)/1e3},Backbone.Mediator.publish("script:tick",t)},r.prototype.loadFromSession=function(){var e,t,i,n,o;for(this.addEndedScriptsFromSession(),this.addPartiallyEndedScriptFromSession(),o=[],e=0,t=(n=this.noteGroupQueue).length;e<t;e++)i=n[e],o.push(this.processNoteGroup(i));return o},r.prototype.addPartiallyEndedScriptFromSession=function(){var e,t,i,n,o,s=this.session.get("state").scripts;if(null!=s&&s.currentScript&&(o=_.find(this.scripts,{id:s.currentScript}))&&(this.triggered.push(o.id),i=this.processScript(o))){if(s.currentScriptOffset)for(t=(n=i.slice(e=0,+(s.currentScriptOffset-1)+1||9e9)).length;e<t;e++)n[e].skipMe=!0;return this.addNoteChain(i,!1)}},r.prototype.addEndedScriptsFromSession=function(){var e,t,i,n,o,s,r,a,l,c,h=this.session.get("state").scripts;if(h)for(h=h.ended||{},c=_.sortBy(_.pairs(h),function(e){return e[1]}),e=0,i=(l=function(){for(var e=[],t=0,i=c.length;t<i;t++)s=c[t],e.push(s[0]);return e}()).length;e<i;e++)if(a=l[e],r=_.find(this.scripts,{id:a})){if(!r.repeats){if(this.triggered.push(a),this.ended.push(a),!(o=this.processScript(r)))return;for(t=0,n=o.length;t<n;t++)o[t].skipMe=!0;this.addNoteChain(o,!1)}}else console.warn("Couldn't find script for",a,"from scripts",this.scripts,"when restoring session scripts.")},r.prototype.setWorldLoading=function(e){if(this.worldLoading=e,!this.worldLoading)return this.run()},r.prototype.initializeCamera=function(){for(var e,t,i,n,o,s,r=this.scripts,a=0,l=r.length;a<l;a++)for(e=0,t=(n=r[a].noteChain||[]).length;e<t;e++)if(null!=(null!=(o=(i=n[e]).surface)?o.focus:void 0)&&(s=_.find(i.modules||[],function(e){return e.surfaceCameraNote})))return i=s.surfaceCameraNote(!0),void this.publishNote(i)},r.prototype.destroy=function(){return this.onEndAll(),clearInterval(this.tickInterval),r.__super__.destroy.call(this)},r.prototype.onNote=function(e,t){var i,n,o,s,r,a,l,c,h;if(!this.ignoreEvents)for(i=0,o=(r=this.scripts).length;i<o;i++)if(a=(c=r[i]).id,a=0<=p.call(this.triggered,a),c.channel===e&&(!a||c.repeats)&&(null==c.lastTriggered||"session"!==c.repeats)&&!(null!=c.lastTriggered&&(new Date).getTime()-c.lastTriggered<1||c.neverRun)){if(c.notAfter){for(n=0,s=(l=c.notAfter).length;n<s;n++)if(h=l[n],0<=p.call(this.triggered,h)){c.neverRun=!0;break}if(c.neverRun)continue}if(this.scriptPrereqsSatisfied(c)&&u(c,t)){if(this.debugScripts&&console.debug("SCRIPT: Running script '"+c.id+"'"),c.lastTriggered=(new Date).getTime(),a||this.triggered.push(c.id),!(a=this.processScript(c)))return this.trackScriptCompletions(c.id);this.addNoteChain(a),this.run()}}},r.prototype.scriptPrereqsSatisfied=function(e){return _.every(e.scriptPrereqs||[],(t=this,function(e){return 0<=p.call(t.triggered,e)}));var t},r.prototype.processScript=function(e){var t,i,n=e.noteChain;if(null==n||!n.length)return null;for(t=0,i=n.length;t<i;t++)n[t].scriptID=e.id;return n[n.length-1].isLast=!0,n},r.prototype.addNoteChain=function(e,t){var i,n,o,s,r,a,l,c,h,u,p;for(null==t&&(t=!0),n=0,r=e.length;n<r;n++)u=e[n],this.processNoteGroup(u);for(i=o=0,a=e.length;o<a;i=++o)(u=e[i]).index=i;if(t)for(s=0,l=(p=this.noteGroupQueue).length;s<l;s++)(u=p[s]).script.yields&&(u.skipMe=!0);for(h=0,c=e.length;h<c;h++)u=e[h],this.noteGroupQueue.push(u);return this.endYieldingNote()},r.prototype.processNoteGroup=function(n){var o,e,t,i,s,r,a,l;if(null==n.modules){for(null!=(null!=(r=n.playback)?r.scrub:void 0)&&null==(t=n.playback.scrub).duration&&(t.duration=1e3),null==n.sprites&&(n.sprites=[]),i=0,s=(a=n.sprites).length;i<s;i++)null!=(l=a[i]).move&&null==(e=l.move).duration&&(e.duration=500),null==l.id&&(l.id="Hero Placeholder");return null==n.script&&(n.script={}),null==(t=n.script).yields&&(t.yields=!0),null==(t=n.script).skippable&&(t.skippable=!0),n.modules=function(){for(var e=[],t=0,i=c.length;t<i;t++)(o=c[t]).neededFor(n)&&e.push(new o(n));return e}()}},r.prototype.endYieldingNote=function(){var e;if(this.scriptInProgress&&null!=(e=this.currentNoteGroup)&&e.script.yields)return this.endNoteGroup(),!0},r.prototype.run=function(){var e,t,i,n,o,s,r,a,l,c;if(!this.scriptInProgress&&(this.skipAhead(),this.noteGroupQueue.length&&(o=this.noteGroupQueue[0],(!this.worldLoading||!o.skipMe)&&(!this.worldLoading||null!=(r=o.script)&&r.beforeLoad)))){for(this.noteGroupQueue=this.noteGroupQueue.slice(1),this.currentNoteGroup=o,this.notifyScriptStateChanged(),this.scriptInProgress=!0,this.currentTimeouts=[],o.scriptID,o.name,this.debugScripts&&console.debug("SCRIPT: Starting note group '"+o.name+"'"),e=0,i=(a=o.modules).length;e<i;e++)for(t=0,n=(l=a[e].startNotes()).length;t<n;t++)s=l[t],this.processNote(s,o);return o.script.duration&&(c=this,setTimeout(function(){return"function"==typeof c.onNoteGroupTimeout?c.onNoteGroupTimeout(o):void 0},o.script.duration)),Backbone.Mediator.publish("script:note-group-started",{})}},r.prototype.skipAhead=function(){var e,t,i,n,o,s,r,a,l,c,h,u,p;if(!this.worldLoading&&null!=(h=this.noteGroupQueue[0])&&h.skipMe){for(this.ignoreEvents=!0,e=t=0,o=(u=this.noteGroupQueue).length;t<o&&(l=u[e]).skipMe;e=++t){for(this.debugScripts&&console.debug("SCRIPT: Skipping note group '"+l.name+"'"),this.processNoteGroup(l),i=0,s=(p=l.modules).length;i<s;i++)for(n=0,r=(c=p[i].skipNotes()).length;n<r;n++)a=c[n],this.processNote(a,l);this.trackScriptCompletionsFromNoteGroup(l)}return this.noteGroupQueue=this.noteGroupQueue.slice(e),this.ignoreEvents=!1}},r.prototype.processNote=function(e,t){var i;return null==e.event&&(e.event={}),e.delay?(i=this).currentTimeouts.push(setTimeout(function(){return i.sendDelayedNote(t,e)},e.delay)):this.publishNote(e)},r.prototype.sendDelayedNote=function(e,t){if(e===this.currentNoteGroup)return this.publishNote(t)},r.prototype.publishNote=function(e){return Backbone.Mediator.publish(e.channel,null!=(e=e.event)?e:{})},r.prototype.onLevelRestarted=function(){return this.quiet=!0,this.endAll({force:!0}),this.initProperties(),this.resetThings(),Backbone.Mediator.publish("script:reset",{}),this.quiet=!1,this.run()},r.prototype.onEndNoteGroup=function(e){var t;if(null!=(t=this.currentNoteGroup)&&t.script.skippable)return this.endNoteGroup(),this.run()},r.prototype.endNoteGroup=function(){var e,t,i,n,o,s,r,a,l,c,h;if(!this.ending&&(this.ending=!0,null!=this.currentNoteGroup)){for(this.currentNoteGroup.scriptID,this.currentNoteGroup.name,this.debugScripts&&console.debug("SCRIPT: Ending note group '"+this.currentNoteGroup.name+"'"),e=0,n=(a=this.currentTimeouts).length;e<n;e++)h=a[e],clearTimeout(h);for(t=0,o=(l=this.currentNoteGroup.modules).length;t<o;t++)for(i=0,s=(c=l[t].endNotes()).length;i<s;i++)r=c[i],this.processNote(r,this.currentNoteGroup);return this.quiet||Backbone.Mediator.publish("script:note-group-ended",{}),this.scriptInProgress=!1,this.trackScriptCompletionsFromNoteGroup(this.currentNoteGroup),this.currentNoteGroup=null,this.noteGroupQueue.length||(this.notifyScriptStateChanged(),this.resetThings()),this.ending=!1}},r.prototype.onEndAll=function(e){return this.endAll()},r.prototype.endAll=function(e){var t,i,n,o,s,r,a,l,c,h,u,p,d;if(null==e&&(e={}),this.scriptInProgress){if(!this.currentNoteGroup.script.skippable&&!e.force)return;this.endNoteGroup()}for(t=i=0,s=(u=this.noteGroupQueue).length;i<s;t=++i){if(!1===(null!=(p=(c=u[t]).script)?p.skippable:void 0)&&!e.force)return this.noteGroupQueue=this.noteGroupQueue.slice(t),this.run(),void this.notifyScriptStateChanged();for(this.processNoteGroup(c),n=0,r=(d=c.modules).length;n<r;n++)if(h=d[n].skipNotes(),!this.quiet)for(o=0,a=h.length;o<a;o++)l=h[o],this.processNote(l,c);this.quiet||this.trackScriptCompletionsFromNoteGroup(c)}return this.noteGroupQueue=[],this.resetThings(),this.notifyScriptStateChanged()},r.prototype.onNoteGroupTimeout=function(e){if(e===this.currentNoteGroup)return this.endNoteGroup(),this.run()},r.prototype.resetThings=function(){return Backbone.Mediator.publish("level:enable-controls",{}),Backbone.Mediator.publish("level:set-letterbox",{on:!1})},r.prototype.trackScriptCompletionsFromNoteGroup=function(e){if(e.isLast)return this.trackScriptCompletions(e.scriptID)},r.prototype.trackScriptCompletions=function(e){var t,i,n,o;if(!this.quiet){for(p.call(this.ended,e)<0&&this.ended.push(e),t=0,i=(n=this.scripts).length;t<i;t++)(o=n[t]).id===e&&(o.lastEnded=new Date);return this.lastScriptEnded=new Date,Backbone.Mediator.publish("script:ended",{scriptID:e})}},r.prototype.notifyScriptStateChanged=function(){var e;if(!this.quiet)return e={currentScript:(null!=(e=this.currentNoteGroup)?e.scriptID:void 0)||null,currentScriptOffset:(null!=(e=this.currentNoteGroup)?e.index:void 0)||0},Backbone.Mediator.publish("script:state-changed",e)},r)}.call(this,l(17),l(3))},169:function(e,t){var y=[].indexOf||function(e){for(var t=0,i=this.length;t<i;t++)if(t in this&&this[t]===e)return t;return-1};function i(e,t,i,n,o,s,r){this.width=t,this.height=i,this.padding=null!=n?n:0,this.left=null!=o?o:0,this.bottom=null!=s?s:0,this.rogue=null!=r&&r,this.width=Math.ceil(this.width),this.height=Math.ceil(this.height),this.left=Math.floor(this.left),this.bottom=Math.floor(this.bottom),this.update(e)}e.exports=(i.prototype.update=function(n){var e,t,i,o,s,r,a,l,c,h,u,p,d,m,f,g,y,v,b,_,w;for(this.grid=[],w=e=0,p=this.height;0<=p?e<=p:p<=e;w=0<=p?++e:--e)for(this.grid.push([]),_=t=0,d=this.width;0<=d?t<=d:d<=t;_=0<=d?++t:--t)this.grid[w].push([]);for(g=[],i=0,s=(n=(this.rogue?function(){for(var e=[],t=0,i=n.length;t<i;t++)((y=n[t]).collides||"Gem"===y.spriteName&&!y.dead)&&e.push(y);return e}:function(){for(var e=[],t=0,i=n.length;t<i;t++)(y=n[t]).collides&&e.push(y);return e})()).length;i<s;i++){for(u=(v=n[i]).rectangle(),c=(m=[9001,-9001,9001,-9001])[0],a=m[1],h=m[2],l=m[3],o=0,r=(f=u.vertices()).length;o<r;o++)b=f[o],c=Math.min(c,b.x-this.padding),h=Math.min(h,b.y-this.padding),a=Math.max(a,b.x+this.padding),l=Math.max(l,b.y+this.padding);g.push(function(){for(var e=this.columns(h,l),t=[],i=0,n=e.length;i<n;i++)w=e[i],t.push(function(){for(var e=this.rows(c,a),t=[],i=0,n=e.length;i<n;i++)_=e[i],t.push(this.grid[w][_].push(v));return t}.call(this));return t}.call(this))}return g},i.prototype.contents=function(e,t,i,n){var o,s,r,a,l,c,h,u,p,d,m,f,g;for(null==i&&(i=1),m=[],o=0,a=(h=this.columns(t-(n=null==n?1:n)/2,t+n/2)).length;o<a;o++)for(g=h[o],s=0,l=(u=this.rows(e-i/2,e+i/2)).length;s<l;s++)for(f=u[s],r=0,c=(p=this.grid[g][f]).length;r<c;r++)!(d=p[r]).collides||0<=y.call(m,d)||"Add Thang Phantom"===d.id||m.push(d);return m},i.prototype.clampColumn=function(e){return e=Math.max(0,Math.floor(e)-this.bottom),Math.min(this.grid.length,Math.ceil(e)-this.bottom)},i.prototype.clampRow=function(e){var t;return e=Math.max(0,Math.floor(e)-this.left),Math.min((null!=(t=this.grid[0])?t.length:void 0)||0,Math.ceil(e)-this.left)},i.prototype.columns=function(i,n){var o,s;return function(){s=[];for(var e=o=this.clampColumn(i),t=this.clampColumn(n);o<=t?e<t:t<e;o<=t?e++:e--)s.push(e);return s}.apply(this)},i.prototype.rows=function(i,n){var o,s;return function(){s=[];for(var e=o=this.clampRow(i),t=this.clampRow(n);o<=t?e<t:t<e;o<=t?e++:e--)s.push(e);return s}.apply(this)},i.prototype.toString=function(n){var o,s,r;return null==n&&(n=!1),(r=_.clone(this.grid)).reverse(),function(){for(var e=[],t=0,i=r.length;t<i;t++)o=r[t],e.push(function(){for(var e=[],t=0,i=o.length;t<i;t++)s=o[t],e.push(this.charForThangs(s,n));return e}.call(this).join(" "));return e}.call(this).join("\n")},i.prototype.charForThangs=function(e,t){return t?e.length?_.find(e,function(e){return/Hero Placeholder/.test(e.id)})?"@":_.find(e,{spriteName:"Spike Walls"})?">":_.find(e,{spriteName:"Fence Wall"})?"F":_.find(e,{spriteName:"Fire Trap"})?"T":_.find(e,{spriteName:"Dungeon Wall"})?" ":_.find(e,{spriteName:"Gem"})?"G":_.find(e,{spriteName:"Treasure Chest"})?"C":_.find(e,{spriteName:"Spear"})?"*":_.find(e,{type:"munchkin"})?"o":_.find(e,function(e){return"ogres"===e.team})?"O":_.find(e,function(e){return"humans"===e.team})?"H":_.find(e,function(e){return"neutral"===e.team})?"N":"?":".":e.length||" "},i)},170:function(e,t,i){var a=i(81).downTheChain;e.exports.scriptMatchesEventPrereqs=function(e,t){var i,n,o,s,r;if(!e.eventPrereqs)return!0;for(n=0,o=(s=e.eventPrereqs).length;n<o;n++){if(i=s[n],r=a(t,i.eventProps),null!=i.equalTo&&r!==i.equalTo)return!1;if(null!=i.notEqualTo&&r===i.notEqualTo)return!1;if(null!=i.greaterThan&&!(r>i.greaterThan))return!1;if(null!=i.greaterThanOrEqualTo&&!(r>=i.greaterThanOrEqualTo))return!1;if(null!=i.lessThan&&!(r<i.lessThan))return!1;if(null!=i.lessThanOrEqualTo&&!(r<=i.lessThanOrEqualTo))return!1;if(null!=i.containingString&&(!r||-1===r.search(i.containingString)))return!1;if(null!=i.notContainingString&&-1!==(null!=r?r.search(i.notContainingString):void 0))return!1;if(null!=i.containingRegexp&&(!r||-1===r.search(new RegExp(i.containingRegexp))))return!1;if(null!=i.notContainingRegexp&&-1!==(null!=r?r.search(new RegExp(i.notContainingRegexp)):void 0))return!1}return!0}},171:function(e,t,i){var l,o,c=[].indexOf||function(e){for(var t=0,i=this.length;t<i;t++)if(t in this&&this[t]===e)return t;return-1};function n(e){var t,i;for(t in e)i=e[t],this[t]=i}o=i(6),l=["attach","constructor","validateArguments","toString","isComponent"],e.exports=(n.className="Component",n.prototype.isComponent=!0,n.prototype.attach=function(e){for(var t,i,n,o=(Object.getOwnPropertyNames(this.__proto__)||[]).concat(Object.getOwnPropertyNames(this)),s=[],r=0,a=o.length;r<a;r++)t=o[r],c.call(l,t)<0&&"_"!==t[0]&&(i=e[t],n=this[t],"function"==typeof i?s.push(e.appendMethod(t,n)):s.push(e[t]=n));return s},n.prototype.validateArguments={additionalProperties:!1},n.prototype.getCodeContext=function(e){var t,i,n;if(null==e&&(e=this.constructor.className),null!=(i=this.world)&&null!=(n=i.levelComponents)&&n.length&&(t=_.find(this.world.levelComponents,{name:e})))return n=(null!=t?t.context:void 0)||{},e=this.world.language||"en-US",n=(e=o.i18n(t,"context",e))?_.merge(n,e):n},n.prototype.toString=function(){return"<Component: "+this.constructor.className},n)},172:function(e,t,i){var n,o={}.hasOwnProperty;function a(e,t,i,n,o,s,r){this.message=e,this.functionName=t,this.argumentName=i,this.intendedType=n,this.actualValue=o,this.numArguments=s,this.hint=r,a.__super__.constructor.call(this,this.message),this.name="ArgumentError",null!=Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}n=i(47),e.exports.ArgumentError=(function(e,t){for(var i in t)o.call(t,i)&&(e[i]=t[i]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(a,Error),a.className="ArgumentError",a.prototype.toString=function(){var e,t,i="`"+this.functionName+"`";return"return"===this.argumentName?i+="'s return value":"_excess"===this.argumentName?i+=" takes only "+this.numArguments+" argument"+(1<this.numArguments?"s":"")+".":this.argumentName?i+="'s argument `"+this.argumentName+"`":i+=" takes no arguments.",e=typeof this.actualValue,null==this.actualValue?e="null":_.isArray(this.actualValue)&&(e="array"),this.intendedType&&!this.intendedType.match(e)?(t="","string"===e?t='"'+this.actualValue+'"':"number"===e?Math.round(this.actualValue)===this.actualValue?this.actualValue:this.actualValue.toFixed(2):"boolean"===e?t=""+this.actualValue:(null!=this.actualValue&&this.actualValue.id&&this.actualValue.trackedPropertiesKeys||this.actualValue instanceof n)&&(t=this.actualValue.toString()),this.actualValue,i+=" should have type `"+this.intendedType+"`, but got `"+e+"`"+(t?": `"+t+"`":"")+"."):this.argumentName&&"_excess"!==this.argumentName&&(i+=" has a problem."),this.message&&(i+="\n"+this.message),i},a)},1726:function(e,t,i){"use strict";i.d(t,"a",function(){return n}),i.d(t,"b",function(){return o});var n=function(){var e=this.$createElement,e=this._self._c||e;return e("div",{attrs:{id:"modal-base-flat"}},[e("div",{staticClass:"modal-content style-flat",attrs:{id:"hoc-interstitial-modal"}},[this._m(0),e("div",{staticClass:"modal-body"},[this.showVideo?e("div",{staticClass:"row"},[this._m(1)]):this._e(),e("div",{staticClass:"row buttons"},[e("div",{staticClass:"col-xs-6"},[e("button",{staticClass:"btn btn-lg btn-navy",attrs:{"data-i18n":"hoc_2018_interstitial.educator"},on:{click:this.clickTeacher}}),e("p",{attrs:{"data-i18n":"hoc_2018_interstitial.show_resources"}})]),e("div",{staticClass:"col-xs-6"},[e("button",{staticClass:"btn btn-lg btn-navy",attrs:{"data-i18n":"hoc_2018_interstitial.student"},on:{click:this.clickStudent}}),e("p",{attrs:{"data-i18n":"hoc_2018_interstitial.ready_to_code"}})])])])])])},o=[function(){var e=this.$createElement,e=this._self._c||e;return e("div",{staticClass:"modal-header"},[e("span",{staticClass:"glyphicon glyphicon-remove button close",attrs:{"data-dismiss":"modal","aria-hidden":"true"}}),e("h4",{attrs:{"data-i18n":"hoc_2018_interstitial.welcome"}})])},function(){var e=this.$createElement,e=this._self._c||e;return e("div",{staticClass:"hoc-video"},[e("iframe",{attrs:{width:"560",height:"315",src:"https://www.youtube.com/embed/k965LUC7oww",frameborder:"0",allow:"accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture",allowfullscreen:""}})])}]},1727:function(e,t,i){"use strict";i.d(t,"a",function(){return n}),i.d(t,"b",function(){return o});var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{attrs:{id:"modal-base-flat"}},[i("iframe",{staticClass:"video-frame",attrs:{frameborder:"0",webkitallowfullscreen:"",mozallowfullscreen:"",allowfullscreen:""}}),t._m(0),i("div",{attrs:{id:"course-videos-modal"}},[i("div",{staticClass:"modal-content style-flat",attrs:{id:"videos-content"}},[i("div",{staticClass:"modal-header"},[t._m(1),i("h3",{staticClass:"text-center"},[t._v(t._s(t.$t("courses.concept_videos")))])]),i("div",{staticClass:"modal-body container"},[0<t.videoLevels.length?i("div",{staticClass:"row videos-row"},t._l(t.videoLevels,function(e){return i("div",{staticClass:"col-sm-4 course-video m-l-3"},["locked"===e.videoStatus?i("div",{staticClass:"locked"},[i("div",{staticClass:"video-link"},[i("img",{staticClass:"video-image",attrs:{src:e.thumbnail_locked}}),t._m(2,!0)]),i("div",{staticClass:"video-text m-t-2"},[i("span",{staticClass:"rtl-allowed video-title gray-text"},[t._v(t._s(t.$t("courses."+e.i18name)))]),i("p",{staticClass:"video-desc gray-text"},[t._v(t._s(t.$t("courses.locked_videos_desc",{concept_name:t.$t("courses."+e.i18name)})))])])]):"unlocked"===e.videoStatus?i("div",{staticClass:"unlocked"},[i("div",{staticClass:"video-link"},[i("img",{staticClass:"video-image",attrs:{src:e.thumbnail_unlocked},on:{click:t.onImageClick}}),t._m(3,!0)]),i("div",{staticClass:"video-text m-t-2"},[i("span",{staticClass:"rtl-allowed video-title"},[t._v(t._s(t.$t("courses."+e.i18name)))]),i("p",{staticClass:"video-desc"},[t._v(t._s(t.$t("courses.unlocked_videos_desc",{concept_name:t.$t("courses."+e.i18name)})))])])]):t._e()])}),0):t._e()])])])])},o=[function(){var e=this.$createElement,e=this._self._c||e;return e("div",{staticClass:"btn well well-sm well-parchment close-btn",attrs:{id:"video-close-btn","data-dismiss":"modal"}},[e("span",{staticClass:"glyphicon glyphicon-remove"})])},function(){var e=this.$createElement,e=this._self._c||e;return e("div",{staticClass:"btn well well-sm well-parchment close-btn",attrs:{id:"modal-close-btn","data-dismiss":"modal"}},[e("span",{staticClass:"glyphicon glyphicon-remove"})])},function(){var e=this.$createElement,e=this._self._c||e;return e("div",{staticClass:"video-status"},[e("img",{staticClass:"img-locked",attrs:{src:"/images/pages/play/modal/locked_banner.png"}})])},function(){var e=this.$createElement,e=this._self._c||e;return e("div",{staticClass:"video-status"},[e("img",{staticClass:"img-unlocked",attrs:{src:"/images/pages/play/modal/unlocked_banner.png"}})])}]},173:function(e,t){e.exports.thangNames={"Ogre Munchkin F":["Alali","Anabel","Babaga","Delma","Dosha","Gurzunn","Hoot","Inski","Iyert","Lacos","Merna","Palt","Paulark","Pripp","Shmeal","Upfish","Yugark","Shema"],"Ogre Munchkin M":["Blob","Brack","Cragg","Dobo","Draff","Eugen","Gert","Godel","Goreball","Gordok","Gorylo","Gort","Kog","Kogpole","Kratt","Leerer","Nerph","Oogre","Raack","Ragtime","Raort","Rexxar","Skoggen","Smerk","Snortt","Thabt","Toremon","Treg","Ursa","Vorobun","Weeb","Yart","Zozo","Zock"],"Ogre Thrower":["Beebatha","Dross","Drumbaa","Durnath","Esha","Gragthar","Grel","Hamedi","Jinjin","Kraggan","Kyrgg","Makas","Moza","Pinakin","Rakash","Rasha","Savatha","Vujii","Wuda","Yetu","Zara"],"Griffin Rider":["Aeoldan","Bestarius","Cristofide","Denestorath","Letholdus","Loretha"],Paladin:["Illumina","Celadia","Taric","Vaelia","Antary","Femae"],"Ogre Witch":["Vyrryx","Yzzrith","Xith"],"Ogre Chieftain":["Zagra Ux","Oniko"],"Ogre Warlock":["Gronak","Sorgoth","Vax","Vyrryx","Vyjj"],"Ogre Scout M":["Frandar","Karnaugh","Lanthon","Tarjan","Yorgalfen"],"Ogre Scout F":["Freesa","Ganju","Hopper","Ralthora","Yugorota"],Burl:["Borlit","Burlosh","Dorf","Teemer"],"Sand Yak":["Arngotho","Falthror","Girvan","Langthok","Ofgar","Randall"],"Raven Pet":["Nevermore"],"Cougar Pet":["Kitty"],"Frog Pet":["Hypnotoad"],"Baby Griffin Pet":["Griffin"],"Pugicorn Pet":["Peggy"],"Polar Bear Pet":["Klondike"],"Wolf Pup Pet":["Wolf"],Horse:["Abby","Beauty","Cinnamon","Codasus","Ed","Fleetfire","Hurricane","Lovelace","Miracle","Mirial","Powder","Silver","Wildsilver"],"Ogre M":["Axe Ox","Belch","Booz","Brusentsov","Demonik","Dronck","Gorlog","Grumus","Gug","Gurulax","Krogg","Kulgor","Mak Fod","Mokrul","Muthyala","Oni","Polifemo","Saltporker","Skrungt","Steve","Stinker","Tarlok","Trogdor","Trung","Vargutt","Vyle"],"Ogre F":["Alkaz","Gar'ah","Glonc","Holkam","Kriskull","Mak'rah","Marghurk","Marnag","Martha","Morthrug","Nareng","Maleda"],"Ogre Brawler":["Arelt","Borgag","Boz","Burobb","Dijkstro","Grognar","Grul'thock","Grumoll","Haggar","Heizenburg","Ironjaw","Mokuhr","Muul","Ork'han","Roast Beefy","Toharg","Trod","Tuguro","Turrok","York","Zabarek","Zagurk","Zeredd"],"Ogre Fangrider":["Arizard","Bortrok","Boruvka","Doralt","Dreek","Flarsho","Geggret","Gurzthrot","Mizzy","Morzgret","Murgark","Muttin","Secka"],"Ogre Shaman":["Ahst'durante","Aolian'Tak","Drun","Ghuk","Gogg","Gom","Grek","Gror","Grue","Il'Du'duka","Makas","Mogadishu","Nazgareth","Poult","Sham'uk","Torluk","Turann","Tuzang","Tuzell","Ugoki","Uld'Mak","Varreth","Yamizeb","Yerong","Yugargen","Zo'Goroth","Zulabar"],Skeleton:["Bloody Johnny","Bone Daddy","Bonejangles","Bonesworth","Bonette","Boneus","Doornail","Drybones","Grim","Haskell","Indiana Bones","James Bone","Kate","Palatine","Ribster","Rusty","Sacra","Scraps","Shelly","Shishka-Bob","Shishka-Joe","Shishka-Larry","Skeletor","Skellington","Skulldugger","Skully","Smitty","Sphenoid","Sternum","Talus","Tatava","Ulna","Yorick"],"Ogre Headhunter":["Bob","Deadtooth","Ez the Cruel","Grroq","Mog","Mogvar","Ral'thuk","Soth","Ulxx","Ur","Veznyr","Warlegs","Xul Gor"],Trapper:["Senick","John","Kyle"],"Forest Archer":["Naria","Sylva","Archia"],Raider:["Arryn","Thrat"],Goliath:["Okar","Ivan"],Guardian:["Illia","Gaia"],Pixie:["Zana","Eika"],Assassin:["Blackjack","Kha'Zix","Ritic","Rengar","Shade","Talon","Zed","Sherkey"],Necromancer:["Krekai","Kethum","Morcelu","Nalfar","Drezhul"],"Master Wizard":["Lilith","Kuhafas","Usara","Veigar","Voldemort","Vallyria"],"Archer F":["Agapi","Alden","Alleria","Atalanta","Artemis","Beatrice","Bachi","Beverly","Cairn","Cecily","Clare","Erica","Gemma","Ivy","Jensen","Katniss","Katreena","Keturah","Kim","Korra","Lina","Luna","Mercedes","Mira","Mirana","Natalie","Odette","Omar","Orly","Phoebe","Prim","Rosaline","Rowan","Tansy","Tauriel","Vereesa","Vesper","Yilitha"],"Archer M":["Arty","Brian","Cole","Denin","Dev","Fidsdale","Gimsley","Hunter","Kikariy","Legolas","Loco","Logos","Lycan","Mars","Odysseos","Oliver","Quinn","Robin","Roman","Simon","Slyvos","Vican","Warshall","Yue Fei","Zhou Tong","Archy"],"Peasant M":["Azgot","Brom","Blemmin","Carlton","Charles","Durfkor","Duan","Fendrel","Gawain","Hamming","Hector","Hershell","Hingle","Hodor","Jackson","James","Lyle","Merek","Paps","Piers","Shimron","Thad","Tybalt","Victor","Winkler","Yorik","Yusef","Yoltovic"],"Peasant F":["Alexia","Alianor","Anastas","Bernadette","Brandy","Cristiana","Ellyn","Giselle","Gwendolin","Helena","Hilda","Icey","Katelyn","Mary","Matilda","Mertia","Millicent","Regan","Rose","Ruth","Tabitha","Thea","Lea"],"Soldier M":["Aaron","Adam","Addison","Alan","Albert","Alistair","Andrew","Anthony","Antonio","Arthur","Augustus","Barron","Benjamin","Bill","Billy","Bobby","Bond","Brandon","Brian","Bruce","Carl","Carlos","Cecil","Charles","Chris","Christopher","Cid","Clarence","Craig","Daniel","Darius","David","Dax","Dennis","Donald","Douglas","Duke","Earl","Edward","Edwin","Eric","Ernest","Eugene","Ezra","Felix","Ferb","Frank","Fred","Gary","Gatsby","George","Gerald","Gordon","Gregory","Guan Yu","Halle","Harold","Harry","Henry","Hirium","Howard","Huburt","Hugo","Ieyasu","Jack","Jackson","James","Jason","Jax","Jeffrey","Jeremy","Jerry","Jesse","Jimmy","Joe","John","Johnny","Jonah","Jonathan","Jose","Joseph","Joshua","Juan","Jun Fan","Justin","Keith","Kenneth","Kevin","Kirin","Kumar","Larry","Lawrence","Leopold","Louis","Lucas","Lucian","Malcolm","Marcus","Mark","Martin","Matthew","Max","Maxwell","Michael","Miles","Mischa","Musashi","Nicholas","Nick","Noah","Orion","Parker","Patrick","Paul","Peter","Philip","Philippian","Phillip","Phineas","Pierce","Ralph","Randy","Raymond","Remy","Rex","Ricardo","Richard","Robert","Roderick","Roger","Ronald","Ronan","Roy","Russell","Ryan","Sage","Samson","Samuel","Scott","Sean","Shawn","Silas","Stephen","Sterling","Steve","Steven","Stormy","Tadakatsu","Terry","Thelonious","Theo","Thomas","Timothy","Todd","Tryndamere","Tyrone","Victor","Walter","Wayne","William","Willie","Zachary"],"Soldier F":["Ahri","Alana","Alexandra","Alice","Allankrita","Amanda","Amy","Andrea","Angela","Ann","Anna","Anne","Annie","Ann-Maria","Aphrodite","Ashley","Barbara","Betty","Beverly","Bonnie","Brenda","Buffy","Carol","Carolyn","Catherine","Cheryl","Christina","Christine","Coco","Cynthia","Deborah","Debra","Denise","Diana","Diane","Donna","Doris","Dorothy","Elizabeth","Emma","Emily","Evelyn","Fiora","Frances","Gabrielle","Gloria","Gorgin","Heather","Helen","Helga","Holly","Imani","Irene","Jacqueline","Jane","Janet","Janice","Jean","Jennifer","Jessica","Joan","Jordan","Joyce","Judith","Judy","Julia","Julie","Karen","Katherine","Kathleen","Kathryn","Kathy","Kay","Kelly","Kimberly","Kira","Lana","Laura","Lillian","Linda","Lisa","Lois","Lori","Louise","Lukaz","Margaret","Maria","Mariah","Marie","Marilyn","Martha","Mary","Medusa","Melissa","Michelle","Mildred","Mulan","Nancy","Natasha","Nicole","Nikita","Norma","Pamela","Patricia","Paula","Phyllis","Rachel","Rebecca","Robin","Ronda","Rose","Ruby","Ruth","Sana","Sandra","Sara","Sarah","Scarlett","Shannon","Sharon","Shirley","Stephanie","Susan","Tammy","Teresa","Tess","Theresa","Tina","Trinity","Virginia","Wanda"],"Ogre Peon M":["Ba Bo","Bubbage","Durbo","Jaro","Kurger","Mudwich","Toe Pod","Zugger"],"Ogre Peon F":["Greeke","Iblet","Lorba","Vapa","Yamra","Zzoya"],"Potion Master":["Amaranth","Alchemist","Arora","Artephius","Clause","Curie","Fluvius","Javin","Kanada","Omar","Paracelsus","Snake","Vanders","Warnsdorff","Zander"],Librarian:["Agathe","Agnes","Hushbaum","Mariam","Matilda","Merilda","Nordex","Satish","Vera","Charlotte"],Equestrian:["Neely","Reynaldo","Ryder","Thoron"],Knight:["Almeric","Alphonse","Altair","Arthur","Bertrand","Bronn","Bruce","Drake","Duran","Edward","Galahad","Hank","Hunfray","Jeph","Jorah","Lancelot","Mace","Neville","Shug","Tharin","Vint","Wain"],Captain:["Anya","Brigette","Dimia","Div","Hardcastle","Helena","Isa","Jan","Jane","Jarin","Karp","Katana","Leona","Lia","Lily","Nicks","Philips","Sarre","Sun Tzu"],Ninja:["Akali","Amara","Goemon","Itachi","Kennen","Kosaraju","Madara","Minato","Naruto","Obito","Sakura","Sasuke","Shen","Shigeru","Takashi","Zed"],Sorcerer:["Beazer","Claude","Gandalf","Izzrts","Kleene","Pender","Jezebel"],Samurai:["Hattori","Hirosha","Ieyasu","Izotokogawa","Keitaro","Miyoshi","Nobunaga","Yasuo","Yi"],Champion:["Ida","Jasmine"],Duelist:["Alejandro"],Stalwart:["Gordon"],"Armando Hoyos":["Armando Hoyos"]}},1731:function(e,t,i){var l=i(631);e.exports=function(e){var t,i,n,o,s=e.source,r=e.ast,a=e.language,e=new esper.Engine;for(i in s?e.load(s):r&&e.loadAST(r),t=e.evaluator.ast,"python"===a&&t.body.shift(),n=[],l)(o=l[i].tagger)&&("function"==typeof o?o(t)&&n.push(l[i].concept):0<t.find(o).length&&n.push(l[i].concept));return n}},174:function(e,t){var r=[].indexOf||function(e){for(var t=0,i=this.length;t<i;t++)if(t in this&&this[t]===e)return t;return-1};function i(e,t){var i,n,o;for(i in this.world=e,n=null!=t?t:{})o=n[i],this[i]=o;this.registries=[],this.hashes={}}e.exports=(i.className="System",i.prototype.start=function(e){},i.prototype.update=function(e){return 0},i.prototype.finish=function(e){},i.prototype.addRegistry=function(e){var t=[];return this.registries.push([t,e]),t},i.prototype.register=function(e){for(var t,i,n=this.registries,o=0,s=n.length;o<s;o++)t=(i=n[o])[0],(0,i[1])(e)?r.call(t,e)<0&&t.push(e):-1!==(i=t.indexOf(e))&&t.splice(i,1);return null},i.prototype.checkRegistration=function(e,t){},i.prototype.hashString=function(e){var t,i,n,o;if(e in this.hashes)return this.hashes[e];for(i=n=t=0,o=Math.min(e.length,100);0<=o?n<o:o<n;i=0<=o?++n:--n)t=31*t+e.charCodeAt(i);return t=this.hashes[e]=t%3.141592653589793},i.prototype.toString=function(){return"<System: "+this.constructor.className},i)},1741:function(e,t,i){!function(s){var n=[].slice,r={getPixels:function(e){var t=this.getCanvas(e.naturalWidth,e.naturalHeight),i=t.getContext("2d");return i.drawImage(e,0,0),i.getImageData(0,0,t.width,t.height)},getCanvas:function(e,t){var i=document.createElement("canvas");return i.width=e,i.height=t,i},filterImage:function(){var e=arguments[0],t=arguments[1],i=3<=arguments.length?n.call(arguments,2):[];return i=[this.getPixels(t)].concat(i),e.apply(null,i)},brightness:function(e,t){for(var i=e.data,n=0;n<i.length;)i[n]*=t,i[n+1]*=t,i[n+2]*=t,n+=4;return e}};e.exports.darkenImage=function(e,t,i){var n,o;return null==i&&(i=.5),(n=(o=s(e)).data("darkened"))?(s(t).css("border-image-source","url("+n+")"),e.src=n):(o.data("original")||o.data("original",e.src),0<e.naturalWidth&&0<e.naturalHeight?(n=r.filterImage(r.brightness,e,i),(i=r.getCanvas(e.naturalWidth,e.naturalHeight)).getContext("2d").putImageData(n,0,0),e.src=i.toDataURL(),s(t).css("border-image-source","url("+e.src+")"),o.data("darkened",e.src)):(console.warn("Tried to darken image",e,"but it has natural dimensions",e.naturalWidth,e.naturalHeight),e))},e.exports.revertImage=function(e,t){var i=s(e);if(i.data("original"))return s(t).css("border-image-source","url("+i.data("original")+")"),e.src=i.data("original")}}.call(this,i(3))},1742:function(e,t){var c=[].indexOf||function(e){for(var t=0,i=this.length;t<i;t++)if(t in this&&this[t]===e)return t;return-1},e=e.exports,a=function(e,i,n){return _.reduce(e,function(e,t){return e||_.reduce(_.map(i,function(e){return n(t,e)}),function(e,t){return e||t},!1)},!1)},h=function(e,t){var i,n,o,s,r=_.isArray(e)?e:[e];for(n in t)switch(o=t[n],i=_.isArray(o)?o:[o],n){case"$gt":if(!a(r,i,function(e,t){return t<e}))return!1;break;case"$gte":if(!a(r,i,function(e,t){return t<=e}))return!1;break;case"$lt":if(!a(r,i,function(e,t){return e<t}))return!1;break;case"$lte":if(!a(r,i,function(e,t){return e<=t}))return!1;break;case"$ne":if(a(r,i,function(e,t){return e===t}))return!1;break;case"$in":if(!_.reduce(r,function(e,t){return e||0<=c.call(i,t)},!1))return!1;break;case"$nin":if(_.reduce(r,function(e,t){return e||0<=c.call(i,t)},!1))return!1;break;case"$exists":if(null!=r[0]!==i[0])return!1;break;default:if(s=_.pick(t,n),!_.isObject(e)||!u(e,s))return!1}return!0},u=function(i,e){var t,n,o,s,r,a,l;if(!e)return!0;if(!i)throw new Error("Expected an object to match a query against, instead got null");for(a in e)if(l=e[a],"$"===a[0])switch(a){case"$or":if(!_.reduce(l,function(e,t){return e||u(i,t)},!1))return!1;break;case"$and":if(!_.reduce(l,function(e,t){return e&&u(i,t)},!0))return!1;break;default:return!1}else{for(r=a.split("."),o=i,t=0,n=r.length;t<n;t++){if(!((s=r[t])in o)){o=null;break}o=o[s]}if("object"!=typeof l||_.isArray(l)){if(!(o===l||_.isArray(o)&&0<=c.call(o,l)))return!1}else if(!h(o,l))return!1}return!0};e.matchesQuery=u},1743:function(r,e,l){!function(e){var t,s,i,n=function(e,t){return function(){return e.apply(t,arguments)}},o={}.hasOwnProperty;function a(){return this.onIframeMessage=n(this.onIframeMessage,this),a.__super__.constructor.apply(this,arguments)}l(1944),t=l(26),i=l(1946),s=l(1744),r.exports=(function(e,t){for(var i in t)o.call(t,i)&&(e[i]=t[i]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(a,t),a.prototype.id="web-surface-view",a.prototype.template=i,a.prototype.subscriptions={"tome:html-updated":"onHTMLUpdated","web-dev:hover-line":"onHoverLine","web-dev:stop-hovering-line":"onStopHoveringLine"},a.prototype.initialize=function(s){var r;return this.goals=function(){for(var e,t=null!=(e=null!=(e=s.goalManager)?e.goals:void 0)?e:[],i=[],n=0,o=t.length;n<o;n++)(r=t[n]).html&&i.push(r);return i}(),a.__super__.initialize.call(this,s)},a.prototype.getRenderData=function(){return _.merge(a.__super__.getRenderData.call(this),{fullUnsafeContentHostname:serverConfig.fullUnsafeContentHostname})},a.prototype.afterRender=function(){return a.__super__.afterRender.call(this),this.iframe=this.$("iframe")[0],e(this.iframe).on("load",(t=this,function(e){return window.addEventListener("message",t.onIframeMessage),t.iframeLoaded=!0,"function"==typeof t.onIframeLoaded&&t.onIframeLoaded(),t.onIframeLoaded=null}));var t},a.prototype.onHTMLUpdated=function(e){var t,i,n,o;return this.iframeLoaded?(t=s.extractStylesAndScripts(e.html),this.virtualDom=t.virtualDom,n=t.styles,i=t.scripts,this.cssSelectors=s.extractCssSelectors(n,i),this.rawCssLines=s.extractCssLines(n),this.rawJQueryLines=s.extractJQueryLines(i),t=e.create||!this.virtualDom?"create":"update",this.iframe.contentWindow.postMessage({type:t,dom:this.virtualDom,styles:n,scripts:i,goals:this.goals},"*")):this.onIframeLoaded=(o=this,function(){if(!o.destroyed)return o.onHTMLUpdated(e)})},a.prototype.combineNodes=function(t,e){if(_.any(e,function(e){return e.type!==t}))throw new Error("Can't combine nodes of different types. (Got "+e.map(function(e){return e.type})+")");return e=e.map(function(e){return e.children}).reduce(function(e,t){return e.concat(t)},[]),_.isEmpty(e)?deku.element(t,{}):deku.element(t,{},e)},a.prototype.onStopHoveringLine=function(){return this.iframe.contentWindow.postMessage({type:"highlight-css-selector",selector:""},"*")},a.prototype.onHoverLine=function(e){e.row;var t,i=e.line,n=_.contains(this.rawCssLines,i)?(t=((null!=(e=i.match(/\s(.*)\s*{/))?e[1]:void 0)||i).trim().split(/ +/).join(" "),_.find(this.cssSelectors,function(e){return t===e})):_.contains(this.rawJQueryLines,i)?(t=((null!=(n=i.match(/\$\(\s*['"](.*)['"]\s*\)/))?n[1]:void 0)||"").trim(),_.find(this.cssSelectors,function(e){return t===e})):"";return this.iframe.contentWindow.postMessage({type:"highlight-css-selector",selector:n},"*"),null},a.prototype.onIframeMessage=function(e){var t=e.origin||e.originalEvent.origin;if(!new RegExp("^https?://"+serverConfig.fullUnsafeContentHostname+"$").test(t))return console.log("Ignoring message from bad origin:",t);if(e.source!==this.iframe.contentWindow)return console.log("Ignoring message from somewhere other than our iframe:",e.source);switch(e.data.type){case"goals-updated":return Backbone.Mediator.publish("god:new-html-goal-states",{goalStates:e.data.goalStates,overallStatus:e.data.overallStatus});case"error":return Backbone.Mediator.publish("web-dev:error",_.pick(e.data,["message","line","column","url"]));default:return console.warn("Unknown message type",e.data.type,"for message",e,"from origin",t)}},a.prototype.destroy=function(){return window.removeEventListener("message",this.onIframeMessage),a.__super__.destroy.call(this)},a)}.call(this,l(3))},1744:function(e,t,i){var a,n,o,s,r,l,c;i(1485),a=function(s){var r;return"text"===s.type?s.data:"comment"===s.type?null:(s.attribs=_.omit(s.attribs,function(e,t){return!t.match(/^[^\s"'<>\\\/=]+$/)}),s.name?deku.element(s.name,s.attribs,function(){for(var e,t=null!=(e=s.children)?e:[],i=[],n=0,o=t.length;n<o;n++)r=t[n],i.push(a(r));return i}()):(console.log("Failed to dekuify",s),s.type))},c=function(o){var s;return _.isString(o)?o:_.isArray(o)?_.filter(_.flatten(function(){for(var e=[],t=0,i=o.length;t<i;t++)s=o[t],e.push(c(s));return e}())):_.filter(_.flatten([o.nodeValue,function(){for(var e=o.children||[],t=[],i=0,n=e.length;i<n;i++)s=e[i],t.push(c(s));return t}()]))},l=function(e){var t=htmlparser2.parseDOM(e,{}),e=null!=(e=_.find(t,{name:"body"}))?e:{name:"body",attribs:null,children:t},e=null!=(t=_.find(t,{name:"html"}))?t:{name:"html",attribs:null,children:[e]};return a(e)},r=function(e){var t=l(e),a=function(o){var s,r,e;return"#text"===o.type?{virtualDom:o,styles:[],scripts:[]}:"style"===o.type?{styles:[o],scripts:[]}:"script"===o.type?{styles:[],scripts:[o]}:(r=[],s=[],null!=(e=o.children)&&e.forEach(function(e,t){var i=a(e),n=i.virtualDom,e=i.styles,i=i.scripts;return o.children[t]=n,r=r.concat(e),s=s.concat(i)}),o.children=_.filter(o.children),{virtualDom:o,scripts:s,styles:r})},i=a(t),e=i.virtualDom,t=i.scripts,i=i.styles,i=deku.element("head",{},i);return{virtualDom:e,scripts:deku.element("head",{},t),styles:i}},n=function(e,t){e=o(e),t=s(t);return e.concat(t)},o=function(e){return e=c(e),_.isArray(e)||(e=[e]),_.flatten(e.map(function(e){try{return parseCss(e).stylesheet.rules.map(function(e){return e.selectors.join(", ").trim()})}catch(e){return[]}}))},s=function(e){return e=c(e),_.isArray(e)||(e=[e]),_.flatten(e.map(function(e){return(e.match(/\$\(\s*['"](?!<)(.*?)(?!>)['"]\s*\)/g)||[]).map(function(e){return e.match(/\$\(\s*['"](?!<)(.*?)(?!>)['"]\s*\)/)[1]})}))},i=function(e){var t=[];return e.children.forEach(function(e){e=e.children[0].nodeValue;return t=t.concat(e.split("\n"))}),t},e.exports={dekuify:a,unwrapDekuNodes:c,parseUserHtml:l,extractStylesAndScripts:r,extractCssSelectors:n,extractSelectorsFromCss:o,extractSelectorsFromJS:s,extractCssLines:i,extractJQueryLines:function(e){return _.flatten(e.children.map(function(e){e=e.children[0].nodeValue;return _.filter(e.split("\n").map(function(e){return(e.match(/^.*\$\(\s*['"].*['"]\s*\).*$/g)||[])[0]}))}))}}},175:function(e,t,i){var w;function k(e,t){this.world=e,this.time=null!=t?t:0,this.thangStateMap={},this.world&&(this.scores=_.omit(this.world.getScores(),"code-length"),this.setState())}w=i(95),e.exports=(k.className="WorldFrame",k.prototype.getNextFrame=function(){var e,t,i,n,o=this.time+this.world.dt;if(o>this.world.lifespan&&!this.world.indefiniteLength)return null;for(this.hash=this.world.rand.seed,e=0,t=(i=this.world.systems).length;e<t;e++)n=i[e],this.hash+=n.update();return new k(this.world,o)},k.prototype.setState=function(){var e,t,i,n,o;if(!this.world.synchronous&&!this.world.headless){for(n=[],e=0,t=(i=this.world.thangs).length;e<t;e++)(o=i[e]).stateless||n.push(this.thangStateMap[o.id]=o.getState());return n}},k.prototype.restoreState=function(){var e,t,i,n,o,s,r;if(!this.world.synchronous&&!this.world.headless){for(r in i=this.thangStateMap)i[r].restore();for(o=[],e=0,t=(n=this.world.thangs).length;e<t;e++)s=n[e],this.thangStateMap[s.id]||s.stateless?o.push(void 0):o.push(s.exists=!1);return o}},k.prototype.restorePartialState=function(e){var t,i,n,o;if(!this.world.synchronous&&!this.world.headless){for(n in i=[],t=this.thangStateMap)o=t[n],i.push(o.restorePartial(e));return i}},k.prototype.restoreStateForThang=function(e){var t;if(!this.world.synchronous&&!this.world.headless){if(t=this.thangStateMap[e.id])return t.restore();e.stateless||(e.exists=!1)}},k.prototype.clearEvents=function(){for(var e,t=this.world.thangs,i=[],n=0,o=t.length;n<o;n++)e=t[n],i.push(e.currentEvents=[]);return i},k.prototype.toString=function(){for(var e,t,i,n,o,s,r,a,l,c,h,u,p=function(){var e,t,i=[];for(u=e=0,t=this.world.height;0<=t?e<=t:t<=e;u=0<=t?++e:--e)i.push(function(){var e,t,i=[];for(c=e=0,t=this.world.width;0<=t?e<=t:t<=e;c=0<=t?++e:--e)i.push(" ");return i}.call(this));return i}.call(this),d=".ox@dfga[]/D",m=this.world.thangs,f=e=0,g=m.length;e<g;f=++e)if((l=m[f]).rectangle)for(n=l.rectangle().axisAlignedBoundingBox(),u=t=o=Math.floor(n.y-n.height/2),s=Math.ceil(n.y+n.height/2);o<=s?t<s:s<t;u=o<=s?++t:--t)for(c=i=r=Math.floor(n.x-n.width/2),a=Math.ceil(n.x+n.width/2);r<=a?i<a:a<i;c=r<=a?++i:--i)0<=u&&u<this.world.height&&0<=c&&c<this.world.width&&(p[u][c]=d[f%d.length]);return this.time+"\n"+function(){for(var e=[],t=0,i=p.length;t<i;t++)h=p[t],e.push(h.join(" "));return e}().join("\n")+"\n"},k.prototype.serialize=function(e,t,i,n,o,s,r,a){for(var l,c,h,u,p,d,m,f=l=0,g=t.length;l<g;f=++l)m=t[f],(m=this.thangStateMap[m])&&m.serialize(e,i[f],n[f],o[f],s,r);for(p=c=0,h=(d=_.values(this.scores)).length;c<h;p=++c)u=d[p],a[e*d.length+p]=u||0;return this.hash},k.deserialize=function(e,t,i,n,o,s,r,a,l,c,h){var u,p,d,m,f,g,y,v,b,_=new k(null,h);for(_.world=e,_.hash=c,_.scores={},b=u=0,d=i.length;u<d;b=++u)v=i[b],_.thangStateMap[v]=w.deserialize(e,t,n[b],o[b],s[b],r[b],a);for(g=p=0,m=(f=e.scoreTypes).length;p<m;g=++p)y=f[g],_.scores[y]=l[t*e.scoreTypes.length+g];return _},k)},176:function(e,t,i){var n;function u(e,t,i){this.event=t,null!=e&&(this.invalid=!0,n(e,this.event)&&(this.invalid=!1,this.channel=e.channel,null==this.event&&(this.event={}),e.noteChain&&(this.event.replacedNoteChain=e.noteChain)))}i(81).clone,n=i(170).scriptMatchesEventPrereqs,e.exports=(u.className="WorldScriptNote",u.prototype.serialize=function(){var e,t,i,n,o,s,r={channel:this.channel,event:{}},a=this.event;for(i in a){if(null!=(s=a[i])&&s.isThang)s={isThang:!0,id:s.id};else if(_.isArray(s))for(e=t=0,n=s.length;t<n;e=++t)null!=(o=s[e])&&o.isThang&&(s[e]={isThang:!0,id:o.id});r.event[i]=s}return r},u.deserialize=function(e,t,i){var n,o,s,r,a,l,c,h=new u;for(s in h.channel=e.channel,h.event={},a=e.event){if(null!=(c=a[s])&&"object"==typeof c&&c.isThang)c=t.getThangByID(c.id);else if(_.isArray(c))for(n=o=0,r=c.length;o<r;n=++o)null!=(l=c[n])&&"object"==typeof l&&l.isThang&&(c[n]=t.getThangByID(l.id));else null!=c&&"object"==typeof c&&c.CN&&(c=i[c.CN].deserialize(c,t,i));h.event[s]=c}return h},u)},1908:function(b,_,e){!function(g,y){var v;window;!function(){var i,e,p={};function r(e){var t=!1;return function(){if(t)throw new Error("Callback was already called.");t=!0,e.apply(i,arguments)}}null!=(i=this)&&(e=i.async),p.noConflict=function(){return i.async=e,p};function d(e,t){if(e.forEach)return e.forEach(t);for(var i=0;i<e.length;i+=1)t(e[i],i,e)}function l(e,n){if(e.map)return e.map(n);var o=[];return d(e,function(e,t,i){o.push(n(e,t,i))}),o}function m(e){if(Object.keys)return Object.keys(e);var t,i=[];for(t in e)e.hasOwnProperty(t)&&i.push(t);return i}var t=Object.prototype.toString,f=Array.isArray||function(e){return"[object Array]"===t.call(e)};void 0!==g&&g.nextTick?(p.nextTick=g.nextTick,p.setImmediate=void 0!==y?function(e){y(e)}:p.nextTick):(p.nextTick="function"==typeof y?function(e){y(e)}:function(e){setTimeout(e,0)},p.setImmediate=p.nextTick),p.each=function(t,i,n){if(n=n||function(){},!t.length)return n();var o=0;function s(e){e?(n(e),n=function(){}):(o+=1)>=t.length&&n()}d(t,function(e){i(e,r(s))})},p.forEach=p.each,p.eachSeries=function(t,e,i){if(i=i||function(){},!t.length)return i();var n=0,o=function(){e(t[n],function(e){e?(i(e),i=function(){}):((n+=1)>=t.length?i:o)()})};o()},p.forEachSeries=p.eachSeries,p.eachLimit=function(e,t,i,n){a(t).apply(null,[e,i,n])},p.forEachLimit=p.eachLimit;function n(t){return function(){var e=Array.prototype.slice.call(arguments);return t.apply(null,[p.each].concat(e))}}function o(t){return function(){var e=Array.prototype.slice.call(arguments);return t.apply(null,[p.eachSeries].concat(e))}}function s(e,t,o,i){var s=[];e(t=l(t,function(e,t){return{index:t,value:e}}),function(i,n){o(i.value,function(e,t){s[i.index]=t,n(e)})},function(e){i(e,s)})}var a=function(a){return function(i,e,n){if(n=n||function(){},!i.length||a<=0)return n();var o=0,s=0,r=0;!function t(){if(o>=i.length)return n();for(;r<a&&s<i.length;)r+=1,e(i[(s+=1)-1],function(e){e?(n(e),n=function(){}):(--r,((o+=1)>=i.length?n:t)())})}()}};p.map=n(s),p.mapSeries=o(s),p.mapLimit=function(e,t,i,n){return c(t)(e,i,n)};var c=function(e){return t=e,i=s,function(){var e=Array.prototype.slice.call(arguments);return i.apply(null,[a(t)].concat(e))};var t,i};p.reduce=function(e,n,t,i){p.eachSeries(e,function(e,i){t(n,e,function(e,t){n=t,i(e)})},function(e){i(e,n)})},p.inject=p.reduce,p.foldl=p.reduce,p.reduceRight=function(e,t,i,n){e=l(e,function(e){return e}).reverse();p.reduce(e,t,i,n)},p.foldr=p.reduceRight;var h=function(e,t,n,i){var o=[];e(t=l(t,function(e,t){return{index:t,value:e}}),function(t,i){n(t.value,function(e){e&&o.push(t),i()})},function(e){i(l(o.sort(function(e,t){return e.index-t.index}),function(e){return e.value}))})};p.filter=n(h),p.filterSeries=o(h),p.select=p.filter,p.selectSeries=p.filterSeries;h=function(e,t,n,i){var o=[];e(t=l(t,function(e,t){return{index:t,value:e}}),function(t,i){n(t.value,function(e){e||o.push(t),i()})},function(e){i(l(o.sort(function(e,t){return e.index-t.index}),function(e){return e.value}))})};p.reject=n(h),p.rejectSeries=o(h);h=function(e,t,n,o){e(t,function(t,i){n(t,function(e){e?(o(t),o=function(){}):i()})},function(e){o()})};p.detect=n(h),p.detectSeries=o(h),p.some=function(e,i,n){p.each(e,function(e,t){i(e,function(e){e&&(n(!0),n=function(){}),t()})},function(e){n(!1)})},p.any=p.some,p.every=function(e,i,n){p.each(e,function(e,t){i(e,function(e){e||(n(!1),n=function(){}),t()})},function(e){n(!0)})},p.all=p.every,p.sortBy=function(e,t,i){p.map(e,function(i,n){t(i,function(e,t){e?n(e):n(null,{value:i,criteria:t})})},function(e,t){if(e)return i(e);i(null,l(t.sort(function(e,t){e=e.criteria,t=t.criteria;return e<t?-1:t<e?1:0}),function(e){return e.value}))})},p.auto=function(o,a){a=a||function(){};var e=m(o),t=e.length;if(!t)return a();function l(e){u.unshift(e)}function c(){t--,d(u.slice(0),function(e){e()})}var h={},u=[];l(function(){var e;t||(e=a,a=function(){},e(null,h))}),d(e,function(s){function e(e){var t,i=Array.prototype.slice.call(arguments,1);i.length<=1&&(i=i[0]),e?(t={},d(m(h),function(e){t[e]=h[e]}),t[s]=i,a(e,t),a=function(){}):(h[s]=i,p.setImmediate(c))}function t(){return n=function(e,t){return e&&h.hasOwnProperty(t)},o=!0,((e=r).reduce?e.reduce(n,o):(d(e,function(e,t,i){o=n(o,e,t,i)}),o))&&!h.hasOwnProperty(s);var e,n,o}var i,n=f(o[s])?o[s]:[o[s]],r=n.slice(0,Math.abs(n.length-1))||[];t()?n[n.length-1](e,h):l(i=function(){t()&&(function(e){for(var t=0;t<u.length;t+=1)if(u[t]===e)return u.splice(t,1)}(i),n[n.length-1](e,h))})})},p.retry=function(e,n,o){var s=[];"function"==typeof e&&(o=n,n=e,e=5),e=parseInt(e,10)||5;function t(i,t){for(;e;)s.push(function(e,n){return function(i){e(function(e,t){i(!e||n,{err:e,result:t})},t)}}(n,!--e));p.series(s,function(e,t){t=t[t.length-1],(i||o)(t.err,t.result)})}return o?t():t},p.waterfall=function(e,o){if(o=o||function(){},!f(e)){var t=new Error("First argument to waterfall must be an array of functions");return o(t)}if(!e.length)return o();var s=function(n){return function(e){var t,i;e?(o.apply(null,arguments),o=function(){}):(t=Array.prototype.slice.call(arguments,1),(i=n.next())?t.push(s(i)):t.push(o),p.setImmediate(function(){n.apply(null,t)}))}};s(p.iterator(e))()};function u(e,t,i){var o;i=i||function(){},f(t)?e.map(t,function(e,i){e&&e(function(e){var t=Array.prototype.slice.call(arguments,1);t.length<=1&&(t=t[0]),i.call(null,e,t)})},i):(o={},e.each(m(t),function(i,n){t[i](function(e){var t=Array.prototype.slice.call(arguments,1);t.length<=1&&(t=t[0]),o[i]=t,n(e)})},function(e){i(e,o)}))}p.parallel=function(e,t){u({map:p.map,each:p.each},e,t)},p.parallelLimit=function(e,t,i){u({map:c(t),each:a(t)},e,i)},p.series=function(e,t){var o;t=t||function(){},f(e)?p.mapSeries(e,function(e,i){e&&e(function(e){var t=Array.prototype.slice.call(arguments,1);t.length<=1&&(t=t[0]),i.call(null,e,t)})},t):(o={},p.eachSeries(m(e),function(i,n){e[i](function(e){var t=Array.prototype.slice.call(arguments,1);t.length<=1&&(t=t[0]),o[i]=t,n(e)})},function(e){t(e,o)}))},p.iterator=function(i){var n=function(e){var t=function(){return i.length&&i[e].apply(null,arguments),t.next()};return t.next=function(){return e<i.length-1?n(e+1):null},t};return n(0)},p.apply=function(e){var t=Array.prototype.slice.call(arguments,1);return function(){return e.apply(null,t.concat(Array.prototype.slice.call(arguments)))}};h=function(e,t,n,i){var o=[];e(t,function(e,i){n(e,function(e,t){o=o.concat(t||[]),i(e)})},function(e){i(e,o)})};p.concat=n(h),p.concatSeries=o(h),p.whilst=function(t,i,n){t()?i(function(e){return e?n(e):void p.whilst(t,i,n)}):n()},p.doWhilst=function(i,n,o){i(function(e){if(e)return o(e);var t=Array.prototype.slice.call(arguments,1);n.apply(null,t)?p.doWhilst(i,n,o):o()})},p.until=function(t,i,n){t()?n():i(function(e){return e?n(e):void p.until(t,i,n)})},p.doUntil=function(i,n,o){i(function(e){if(e)return o(e);var t=Array.prototype.slice.call(arguments,1);n.apply(null,t)?o():p.doUntil(i,n,o)})},p.queue=function(i,e){function n(t,e,i,n){if(t.started||(t.started=!0),0==(e=!f(e)?[e]:e).length)return p.setImmediate(function(){t.drain&&t.drain()});d(e,function(e){e={data:e,callback:"function"==typeof n?n:null};i?t.tasks.unshift(e):t.tasks.push(e),t.saturated&&t.tasks.length===t.concurrency&&t.saturated(),p.setImmediate(t.process)})}var o=0,s={tasks:[],concurrency:e=void 0===e?1:e,saturated:null,empty:null,drain:null,started:!1,paused:!1,push:function(e,t){n(s,e,!1,t)},kill:function(){s.drain=null,s.tasks=[]},unshift:function(e,t){n(s,e,!0,t)},process:function(){var e,t;!s.paused&&o<s.concurrency&&s.tasks.length&&(e=s.tasks.shift(),s.empty&&0===s.tasks.length&&s.empty(),o+=1,t=r(function(){--o,e.callback&&e.callback.apply(e,arguments),s.drain&&s.tasks.length+o===0&&s.drain(),s.process()}),i(e.data,t))},length:function(){return s.tasks.length},running:function(){return o},idle:function(){return s.tasks.length+o===0},pause:function(){!0!==s.paused&&(s.paused=!0,s.process())},resume:function(){!1!==s.paused&&(s.paused=!1,s.process())}};return s},p.cargo=function(n,o){var s=!1,r=[],a={tasks:r,payload:o,saturated:null,empty:null,drain:null,drained:!0,push:function(e,t){f(e)||(e=[e]),d(e,function(e){r.push({data:e,callback:"function"==typeof t?t:null}),a.drained=!1,a.saturated&&r.length===o&&a.saturated()}),p.setImmediate(a.process)},process:function e(){if(!s){if(0===r.length)return a.drain&&!a.drained&&a.drain(),void(a.drained=!0);var i="number"==typeof o?r.splice(0,o):r.splice(0,r.length),t=l(i,function(e){return e.data});a.empty&&a.empty(),s=!0,n(t,function(){s=!1;var t=arguments;d(i,function(e){e.callback&&e.callback.apply(null,t)}),e()})}},length:function(){return r.length},running:function(){return s}};return a};h=function(i){return function(e){var t=Array.prototype.slice.call(arguments,1);e.apply(null,t.concat([function(e){var t=Array.prototype.slice.call(arguments,1);"undefined"!=typeof console&&(e?console.error&&console.error(e):console[i]&&d(t,function(e){console[i](e)}))}]))}};p.log=h("log"),p.dir=h("dir"),p.memoize=function(i,o){var s={},r={};o=o||function(e){return e};function e(){var e=Array.prototype.slice.call(arguments),t=e.pop(),n=o.apply(null,e);n in s?p.nextTick(function(){t.apply(null,s[n])}):n in r?r[n].push(t):(r[n]=[t],i.apply(null,e.concat([function(){s[n]=arguments;var e=r[n];delete r[n];for(var t=0,i=e.length;t<i;t++)e[t].apply(null,arguments)}])))}return e.memo=s,e.unmemoized=i,e},p.unmemoize=function(e){return function(){return(e.unmemoized||e).apply(null,arguments)}},p.times=function(e,t,i){for(var n=[],o=0;o<e;o++)n.push(o);return p.map(n,t,i)},p.timesSeries=function(e,t,i){for(var n=[],o=0;o<e;o++)n.push(o);return p.mapSeries(n,t,i)},p.seq=function(){var t=arguments;return function(){var n=this,e=Array.prototype.slice.call(arguments),i=e.pop();p.reduce(t,e,function(e,t,i){t.apply(n,e.concat([function(){var e=arguments[0],t=Array.prototype.slice.call(arguments,1);i(e,t)}]))},function(e,t){i.apply(n,[e].concat(t))})}},p.compose=function(){return p.seq.apply(null,Array.prototype.reverse.call(arguments))};h=function(t,o){function e(){var i=this,n=Array.prototype.slice.call(arguments),e=n.pop();return t(o,function(e,t){e.apply(i,n.concat([t]))},e)}if(2<arguments.length){var i=Array.prototype.slice.call(arguments,2);return e.apply(this,i)}return e};p.applyEach=n(h),p.applyEachSeries=o(h),p.forever=function(i,n){!function e(t){if(t){if(n)return n(t);throw t}i(e)}()},b.exports?b.exports=p:void 0===(v=function(){return p}.apply(_,[]))||(b.exports=v)}()}.call(this,e(66),e(276).setImmediate)},1913:function(e,t,i){var s=i(11);e.exports=function(e){var n,o=[],e=e||{};return function(e,t,i){o.push('<button class="btn btn-lg btn-block btn-success rank-button btn-illustrated"><span data-i18n="ladder.rank_no_code" class="unavailable secret">No New Code to Rank</span><span data-i18n="ladder.rank_my_game" class="rank secret">Rank My Game!</span><span data-i18n="ladder.rank_submitting" class="submitting secret">Submitting...</span><span data-i18n="ladder.rank_submitted" class="submitted secret">Submitted for Ranking</span><span data-i18n="ladder.rank_failed" class="failed secret">Failed to Rank</span><span data-i18n="ladder.rank_being_ranked" class="ranking secret">Game Being Ranked</span></button>'),e&&o.push('<div class="last-submitted secret"><span data-i18n="ladder.rank_last_submitted">submitted </span>'+s.escape(null==(n=e)?"":n)+"</div>"),i.level&&i.level.isType("hero-ladder")&&o.push("<a"+s.attr("href",t,!0,!0)+' data-i18n="ladder.help_simulate" class="help-simulate secret">Help simulate games?</a>'),o.push('<div class="clearfix"></div>')}.call(this,"lastSubmitted"in e?e.lastSubmitted:"undefined"!=typeof lastSubmitted?lastSubmitted:void 0,"simulateURL"in e?e.simulateURL:"undefined"!=typeof simulateURL?simulateURL:void 0,"view"in e?e.view:"undefined"!=typeof view?view:void 0),o.join("")}},1914:function(h,e,u){!function(p,o){function t(e,t){return function(){return e.apply(t,arguments)}}var e,s,i,m,d,f,g,y,n,v,r,a={}.hasOwnProperty;function l(e){this.options=e,this.fetchToken=t(this.fetchToken,this),this.cleanupAndSimulateAnotherTask=t(this.cleanupAndSimulateAnotherTask,this),this.handleTaskResultsTransferError=t(this.handleTaskResultsTransferError,this),this.handleTaskResultsTransferSuccess=t(this.handleTaskResultsTransferSuccess,this),this.setupSimulationAndLoadLevel=t(this.setupSimulationAndLoadLevel,this),this.simulateAnotherTaskAfterDelay=t(this.simulateAnotherTaskAfterDelay,this),this.handleFetchTaskError=t(this.handleFetchTaskError,this),this.fetchAndSimulateTask=t(this.fetchAndSimulateTask,this),this.fetchAndSimulateOneGame=t(this.fetchAndSimulateOneGame,this),null==this.options&&(this.options={}),e=this.options.headlessClient?"headless":"browser",this.simulateTournamentRatio=.5,this.simulator={type:e,version:4,info:r},_.extend(this,Backbone.Events),this.trigger("statusUpdate","Starting simulation!"),this.retryDelayInSeconds=2,this.taskURL="/queue/scoring",this.simulatedByYou=0,this.god=new i({maxAngels:1,workerCode:this.options.workerCode,headless:!0})}function c(e){this.rawData=e}g=u(270),e=u(45),d=u(1451),s=u(272),i=u(1481),n=u(167),y=n.createAetherOptions,v=n.replaceSimpleLoops,m=u(1448),r={},p.browser&&(p.browser.desktop&&(r.desktop=p.browser.desktop),p.browser.name&&(r.name=p.browser.name),p.browser.platform&&(r.platform=p.browser.platform),p.browser.versionNumber&&(r.version=p.browser.versionNumber)),h.exports=(function(e,t){for(var i in t)a.call(t,i)&&(e[i]=t[i]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(l,e),l.prototype.destroy=function(){var e;return this.off(),this.cleanupSimulation(),null!=(e=this.god)&&e.destroy(),l.__super__.destroy.call(this)},l.prototype.fetchAndSimulateOneGame=function(e,t){var i,u,n;if(!this.destroyed)return i="/queue/scoring/getTwoGames",this.options.singleLadder&&(i="/db/level/"+this.options.levelOriginal+"/next-ladder-match"),Math.random()<this.simulateTournamentRatio&&(i="/db/tournament/-/next-match"),p.ajax({url:i,type:"POST",parse:!0,data:{humansGameID:e,ogresGameID:t,simulator:this.simulator,background:Boolean(this.options.background),levelID:this.options.levelID,leagueID:this.options.leagueID},error:function(e){var t;if(!n.destroyed)return console.warn("There was an error fetching two games! "+JSON.stringify(e)),-1!==(null!=e&&null!=(t=e.responseText)?t.indexOf("Old simulator"):void 0)?(noty({text:e.responseText||"Error fetching games to simulate",layout:"center",type:"error",timeout:5e3}),n.simulateAnotherTaskAfterDelay()):void 0},success:(u=n=this,function(e,t,i){var n,o,s,r,a,l,c,h;if(!u.destroyed){if(!e)return 205===i.status?(u.retryDelayInSeconds=5,u.simulateTournamentRatio=.1):u.retryDelayInSeconds=10,u.trigger("statusUpdate","Waiting "+u.retryDelayInSeconds+" seconds before next game."),void u.simulateAnotherTaskAfterDelay();for(e.tournamentId&&(u.simulateTournamentRatio=.9),u.simulatingPlayerStrings={},e.sessions[0].realTeam===e.sessions[1].realTeam&&(r=_.shuffle(["humans","ogres"]),e.sessions[0].team=r[0],e.sessions[1].team=r[1]),n=0,o=(a=["humans","ogres"]).length;n<o;n++){if(c=a[n],l=_.find(e.sessions,{team:c}),h=p.i18n.t("ladder."+c),!l)return u.trigger("statusUpdate","Error simulating game: didn't find both teams' sessions. Trying another game in "+u.retryDelayInSeconds+" seconds."),void u.simulateAnotherTaskAfterDelay();u.simulatingPlayerStrings[c]=(l.creatorName||l.creator)+" "+h}u.trigger("statusUpdate","Setting up "+e.sessions[0].levelID+" simulation between "+u.simulatingPlayerStrings.humans+" and "+u.simulatingPlayerStrings.ogres),u.task=new f(e);try{s=u.task.getLevelName()}catch(e){return r=e,console.error(r),u.trigger("statusUpdate","Error simulating game: "+r+". Trying another game in "+u.retryDelayInSeconds+" seconds."),void u.simulateAnotherTaskAfterDelay()}return null==u.supermodel&&(u.supermodel=new g),u.supermodel.resetProgress(),u.stopListening(u.supermodel,"loaded-all"),u.levelLoader=new d({supermodel:u.supermodel,levelID:s,sessionID:u.task.getHumanSessionID(),opponentSessionID:u.task.getOgresSessionID(),headless:!0}),u.supermodel.finished()?u.simulateSingleGame():u.listenToOnce(u.supermodel,"loaded-all",u.simulateSingleGame)}})})},l.prototype.simulateSingleGame=function(){if(!this.destroyed){this.assignWorldAndLevelFromLevelLoaderAndDestroyIt(),this.trigger("statusUpdate","Simulating match between "+this.simulatingPlayerStrings.humans+" and "+this.simulatingPlayerStrings.ogres),this.setupGod();try{return this.commenceSingleSimulation()}catch(e){return this.handleSingleSimulationError(e)}}},l.prototype.commenceSingleSimulation=function(){return this.listenToOnce(this.god,"infinite-loop",this.handleSingleSimulationInfiniteLoop),this.listenToOnce(this.god,"goals-calculated",this.processSingleGameResults),this.generateSpellsObject().then((t=this,function(e){return t.god.createWorld({spells:e})}));var t},l.prototype.handleSingleSimulationError=function(e){if(console.error("There was an error simulating a single game!",e),!this.destroyed)return this.options.headlessClient&&this.options.simulateOnlyOneGame&&(console.log("GAMERESULT:tie"),o.exit(0)),this.cleanupAndSimulateAnotherTask()},l.prototype.handleSingleSimulationInfiniteLoop=function(e){if(console.log("There was an infinite loop in the single game!"),!this.destroyed)return this.options.headlessClient&&this.options.simulateOnlyOneGame&&(console.log("GAMERESULT:tie"),o.exit(0)),this.cleanupAndSimulateAnotherTask()},l.prototype.processSingleGameResults=function(e){var t,i;try{i=this.formTaskResultsObject(e)}catch(e){return console.log("Failed to form task results:",e),this.cleanupAndSimulateAnotherTask()}return t=i.sessions[0].metrics.rank,e=i.sessions[1].metrics.rank,this.options.headlessClient&&this.options.simulateOnlyOneGame?(t===e?console.log("GAMERESULT:tie"):t<e?console.log("GAMERESULT:humans"):e<t&&console.log("GAMERESULT:ogres"),o.exit(0)):this.sendSingleGameBackToServer(i)},l.prototype.sendSingleGameBackToServer=function(e){for(var t,i,n,o="Recording:",s=e.sessions,r=0,a=s.length;r<a;r++)t=s[r],i=["wins",_.find(e.sessions,function(e){return 0===e.metrics.rank})?"loses":"draws"],o+=" "+t.name+" "+i[t.metrics.rank];return console.log(o),this.trigger("statusUpdate",o),null!=e.tournament?(n="/db/tournament.match/record",e.matchType=e.tournamentType):n="/queue/scoring/recordTwoGames",p.ajax({url:n,data:e,type:"PUT",parse:!0,success:this.handleTaskResultsTransferSuccess,error:this.handleTaskResultsTransferError,complete:this.cleanupAndSimulateAnotherTask})},l.prototype.fetchAndSimulateTask=function(){if(!this.destroyed)return this.fetchAndSimulateOneGame()},l.prototype.handleFetchTaskError=function(e){return console.error("There was a horrible Error: "+JSON.stringify(e)),this.trigger("statusUpdate","There was an error fetching games to simulate. Retrying in 10 seconds."),this.simulateAnotherTaskAfterDelay()},l.prototype.handleNoGamesResponse=function(){var e;return this.noTasks=!0,e="Finding game to simulate...",console.log(e),this.trigger("statusUpdate",e),this.fetchAndSimulateOneGame()},l.prototype.simulateAnotherTaskAfterDelay=function(){var e;return console.log("Retrying in "+this.retryDelayInSeconds),e=1e3*this.retryDelayInSeconds,_.delay(this.fetchAndSimulateTask,e)},l.prototype.setupSimulationAndLoadLevel=function(t,e,i){var n;if(204===i.status)return this.handleNoGamesResponse();this.trigger("statusUpdate","Setting up simulation!"),this.task=new f(t);try{n=this.task.getLevelName()}catch(e){return t=e,console.error(t),this.trigger("statusUpdate","Error simulating game: "+t+". Trying another game in "+this.retryDelayInSeconds+" seconds."),void this.simulateAnotherTaskAfterDelay()}return null==this.supermodel&&(this.supermodel=new g),this.supermodel.resetProgress(),this.stopListening(this.supermodel,"loaded-all"),this.levelLoader=new d({supermodel:this.supermodel,levelID:n,sessionID:this.task.getHumanSessionID(),opponentSessionID:this.task.getOgresSessionID(),headless:!0}),this.supermodel.finished()?this.simulateGame():this.listenToOnce(this.supermodel,"loaded-all",this.simulateGame)},l.prototype.simulateGame=function(){var e;if(!this.destroyed){e="All resources loaded, simulating!",console.log(e),this.assignWorldAndLevelFromLevelLoaderAndDestroyIt(),this.trigger("statusUpdate",e,this.task.getSessions()),this.setupGod();try{return this.commenceSimulationAndSetupCallback()}catch(e){return console.error("There was an error in simulation:",e,e.stack,"-- trying again in "+this.retryDelayInSeconds+" seconds"),this.simulateAnotherTaskAfterDelay()}}},l.prototype.assignWorldAndLevelFromLevelLoaderAndDestroyIt=function(){return this.world=this.levelLoader.world,this.task.setWorld(this.world),this.level=this.levelLoader.level,this.session=this.levelLoader.session,this.otherSession=this.levelLoader.opponentSession,this.levelLoader.destroy(),this.levelLoader=null},l.prototype.setupGod=function(){var e,t,o,i,n;return this.god.setLevel(this.level.serialize({supermodel:this.supermodel,session:this.session,otherSession:this.otherSession,headless:!0,sessionless:!1})),this.god.setLevelSessionIDs(function(){for(var e=this.task.getSessions(),t=[],i=0,n=e.length;i<n;i++)o=e[i],t.push(o.sessionID);return t}.call(this)),this.god.setWorldClassMap(this.world.classMap),this.god.setGoalManager(new s(this.world,this.level.get("goals"),null,{headless:!0})),e=_.filter(null!=(t=null!=(e=this.session.get("state"))?e.flagHistory:void 0)?t:[],(i=this,function(e){return"code"!==e.source&&e.team===(null!=(e=i.session.get("team"))?e:"humans")})),t=_.filter(null!=(t=null!=(t=this.otherSession.get("state"))?t.flagHistory:void 0)?t:[],(n=this,function(e){return"code"!==e.source&&e.team===(null!=(e=n.otherSession.get("team"))?e:"ogres")})),this.god.lastFlagHistory=e.concat(t),this.god.lastSubmissionCount=0,this.god.lastDifficulty=0},l.prototype.commenceSimulationAndSetupCallback=function(){var t,i,n;if(this.listenToOnce(this.god,"infinite-loop",this.onInfiniteLoop),this.listenToOnce(this.god,"goals-calculated",this.processResults),this.generateSpellsObject().then((i=this,function(e){return i.god.createWorld({spells:e})})),this.options.headlessClient&&this.options.leakTest&&null==this.memwatch)return t=0,console.log("Setting leak callbacks."),this.memwatch=u(!function(){var e=new Error("Cannot find module 'memwatch'");throw e.code="MODULE_NOT_FOUND",e}()),this.memwatch.on("leak",(n=this,function(e){if(console.warn("LEAK!!\n"+JSON.stringify(e)),null==n.hd&&0==t++)return n.hd=new n.memwatch.HeapDiff,n.memwatch.on("stats",function(e){return console.warn("stats callback: "+e),e=n.hd.end(),console.warn("HeapDiff:\n"+JSON.stringify(e)),n.options.exitOnLeak&&(console.warn("Exiting because of Leak."),o.exit()),n.hd=new n.memwatch.HeapDiff})}))},l.prototype.onInfiniteLoop=function(e){if(!this.destroyed)return console.warn("Skipping infinitely looping game."),this.trigger("statusUpdate","Infinite loop detected; grabbing a new game in "+this.retryDelayInSeconds+" seconds."),_.delay(this.cleanupAndSimulateAnotherTask,1e3*this.retryDelayInSeconds)},l.prototype.processResults=function(e){var t;try{t=this.formTaskResultsObject(e)}catch(e){return console.log("Failed to form task results:",e),this.cleanupAndSimulateAnotherTask()}return t.taskID?this.sendResultsBackToServer(t):(console.error("*** Error: taskResults has no taskID ***\ntaskResults:",t),this.cleanupAndSimulateAnotherTask())},l.prototype.sendResultsBackToServer=function(e){for(var t,i,n="Recording:",o=e.sessions,s=0,r=o.length;s<r;s++)t=o[s],i=["wins",_.find(e.sessions,function(e){return 0===e.metrics.rank})?"loses":"draws"],n+=" "+t.name+" "+i[t.metrics.rank];return this.trigger("statusUpdate",n),console.log("Sending result back to server:"),console.log(JSON.stringify(e)),this.options.headlessClient&&this.options.testing?this.fetchAndSimulateTask():p.ajax({url:"/queue/scoring",data:e,type:"PUT",parse:!0,success:this.handleTaskResultsTransferSuccess,error:this.handleTaskResultsTransferError,complete:this.cleanupAndSimulateAnotherTask})},l.prototype.handleTaskResultsTransferSuccess=function(e){if(!this.destroyed)return this.trigger("statusUpdate","Results were successfully sent back to server!"),this.simulatedByYou++},l.prototype.handleTaskResultsTransferError=function(e){if(!this.destroyed)return this.trigger("statusUpdate","There was an error sending the results back to the server."),console.log("Task registration error: "+JSON.stringify(e))},l.prototype.cleanupAndSimulateAnotherTask=function(){if(!this.destroyed)return this.cleanupSimulation(),this.options.background||this.noTasks?this.fetchAndSimulateOneGame():this.fetchAndSimulateTask()},l.prototype.cleanupSimulation=function(){return this.stopListening(this.god),this.world=null,this.level=null},l.prototype.formTaskResultsObject=function(e){for(var t,i,n={taskID:this.task.getTaskID(),tournament:this.task.getTournamentId(),tournamentType:this.task.getTournamentType(),receiptHandle:this.task.getReceiptHandle(),originalSessionID:this.task.getFirstSessionID(),originalSessionRank:-1,sessions:[],simulator:this.simulator,randomSeed:this.task.world.randomSeed},o=this.task.getSessions(),s=0,r=o.length;s<r;s++)i={sessionID:(t=o[s]).sessionID,submitDate:t.submitDate,creator:t.creator,name:t.creatorName,totalScore:t.totalScore,metrics:{rank:this.calculateSessionRank(t.sessionID,e.goalStates,this.task.generateTeamToSessionMap())},shouldUpdateLastOpponentSubmitDateForLeague:t.shouldUpdateLastOpponentSubmitDateForLeague},null!=this.task.getTournamentId()&&(i.submissionId=t.submissionID),t.sessionID===n.originalSessionID&&(n.originalSessionRank=i.metrics.rank,n.originalSessionTeam=t.team),n.sessions.push(i);return n},l.prototype.calculateSessionRank=function(e,t,i){var n,o,s=function(){var e=[];for(o in t)"ogres"===(n=t[o]).team&&e.push(n);return e}(),r=function(){var e=[];for(o in t)"humans"===(n=t[o]).team&&e.push(n);return e}(),s=_.all(s,{status:"success"}),r=_.all(r,{status:"success"});return s===r||s&&i.ogres===e||(!s||i.ogres===e)&&r&&i.humans===e?0:1},l.prototype.generateSpellsObject=function(){for(var s,e,t,i,n,r,o,a,l,c={},h=[],u=[{hero:"Hero Placeholder",team:"humans"},{hero:"Hero Placeholder 1",team:"ogres"}],p=0,d=u.length;p<d;p++)e=(a=u[p]).hero,l=a.team,o=_.filter(this.task.getSessions(),{team:l})[0],s=_.string.slugify(e)+"/plan","clojure"!==(a=null!=(t=null!=o?o.submittedCodeLanguage:void 0)?t:"javascript")&&"io"!==a||(a="javascript"),o=m.decompressFromUTF16(null!=(t=null!=o&&null!=(i=o.submittedCode)&&null!=(n=i[_.string.slugify(e)])?n.plan:void 0)?t:""),o=v(o,a),t=new Aether(y({functionName:"plan",codeLanguage:a,skipProtectAPI:!1})),r={name:"plan",team:l,thang:{thang:{id:e},aether:t},fullSpellName:s},h.push(this.fetchToken(o,a,r));return Promise.all(h).then(function(e){for(var t,i=[],n=0,o=e.length;n<o;n++){t=e[n],r=t.spell,t=t.source,s=r.fullSpellName;try{r.thang.aether.transpile(t)}catch(e){console.log("Couldn't transpile "+s+":\n"+t+"\n",e)}delete r.fullSpellName,i.push(c[s]=r)}return i}).then(function(){return c})},l.prototype.fetchToken=function(e,t,i){var n,o;return"java"!==t&&"cpp"!==t||/^\u56E7[a-zA-Z0-9+\/=]+\f$/.test(e)?Promise.resolve({source:e,spell:i}):(n={Accept:"application/json","Content-Type":"application/json"},document.cookie.match(/JWT=([a-zA-Z0-9.]+)/),o=("undefined"!=typeof window&&null!==window&&null!=(o=window.localStorage)?o.kodeKeeperService:void 0)||"https://asm14w94nk.execute-api.us-east-1.amazonaws.com/service/parse-code-kodekeeper",fetch(o,{method:"POST",mode:"cors",headers:n,body:JSON.stringify({code:e,language:t})}).then(function(e){return e.json()}).then(function(e){return{source:e.token,spell:i}}))},l),c.prototype.getLevelName=function(){var e,t,i=(null!=(e=this.rawData.sessions)&&null!=(t=e[0])?t.levelID:void 0)||(null!=(t=this.rawData.sessions)&&null!=(i=t[1])?i.levelID:void 0);return null!=i?i:this.throwMalformedTaskError("The level name couldn't be deduced from the task.")},c.prototype.generateTeamToSessionMap=function(){for(var e,t={},i=this.rawData.sessions,n=0,o=i.length;n<o;n++)null!=t[(e=i[n]).team]&&this.throwMalformedTaskError("Two players share the same team"),t[e.team]=e.sessionID;return t},c.prototype.throwMalformedTaskError=function(e){throw new Error("The task was malformed, reason: "+e)},c.prototype.getFirstSessionID=function(){return this.rawData.sessions[0].sessionID},c.prototype.getSecondSessionID=function(){return this.rawData.sessions[1].sessionID},c.prototype.getHumanSessionID=function(){return _.find(this.rawData.sessions,{team:"humans"}).sessionID},c.prototype.getOgresSessionID=function(){return _.find(this.rawData.sessions,{team:"ogres"}).sessionID},c.prototype.getTaskID=function(){return this.rawData.taskID},c.prototype.getTournamentId=function(){return this.rawData.tournamentId},c.prototype.getTournamentType=function(){return this.rawData.tournamentType},c.prototype.getReceiptHandle=function(){return this.rawData.receiptHandle},c.prototype.getSessions=function(){return this.rawData.sessions},c.prototype.setWorld=function(e){this.world=e},f=c}.call(this,u(3),u(66))},1919:function(e,t,i){var n,c,o={}.hasOwnProperty;function s(){return s.__super__.constructor.apply(this,arguments)}n=i(1470),i(44).me,c=i(6),e.exports=(function(e,t){for(var i in t)o.call(t,i)&&(e[i]=t[i]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(s,n),s.neededFor=function(e){return null!=(e=e.sprites)?e.length:void 0},s.prototype.startNotes=function(){var e,t,i,n,o,s,r,a,l=[];for(this.moveSums={},this.speakingSprites={},e=0,i=(s=this.noteGroup.sprites||[]).length;e<i;e++)null!=(a=s[e]).move&&l.push(this.spriteMoveNote(a));for(t=0,n=(r=this.noteGroup.sprites||[]).length;t<n;t++)null!=(a=r[t]).say&&l.push(this.spriteSayNote(a,this.noteGroup.script)),null!=a.select&&l.push(this.spriteSelectNote(a));return function(){for(var e=[],t=0,i=l.length;t<i;t++)(o=l[t])&&e.push(o);return e}()},s.prototype.spriteMoveNote=function(e,t){var i=(t=null==t?!1:t)?0:e.move.duration,n={channel:"sprite:move",event:{pos:e.move.target,duration:i,spriteID:e.id}};return i&&(null==(t=this.moveSums)[i=e.id]&&(t[i]=0),n.delay=this.scrubbingTime+this.moveSums[e.id],this.moveSums[e.id]+=e.move.duration),n},s.prototype.spriteSayNote=function(e,t){var i,n,o,s,r,a,l;if(!this.speakingSprites[e.id]){for(a=e.say.responses,n=0,o=(s=null!=(a=!t.skippable&&!a?[]:a)?a:[]).length;n<o;n++)(r=s[n]).text=c.i18n(r,"text");return l=c.i18n(e.say,"text"),i=c.i18n(e.say,"blurb"),t=c.i18n(e.say,"sound"),t={channel:"level:sprite-dialogue",event:{message:l,blurb:i,mood:e.say.mood||"explain",responses:a,spriteID:e.id,sound:t}},this.maybeApplyDelayToNote(t),t}},s.prototype.spriteSelectNote=function(e){return{channel:"level:select-sprite",event:{thangID:e.select?e.id:null}}},s.prototype.endNotes=function(){for(var e,t,i,n,o,s={},r=this.noteGroup.sprites||[],a=0,l=r.length;a<l;a++)null==s[e=(i=r[a]).id]&&(s[e]={}),null!=i.move&&(s[i.id].move=this.spriteMoveNote(i,!0)),null!=i.say&&(s[i.id].say={channel:"level:sprite-clear-dialogue"});for(n in t=[],s)for(o in s[n])t.push(s[n][o]);return t},s)},1920:function(e,t,i){var o={}.hasOwnProperty;function n(){return n.__super__.constructor.apply(this,arguments)}i=i(1470),e.exports=(function(e,t){for(var i in t)o.call(t,i)&&(e[i]=t[i]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(n,i),n.neededFor=function(e){return null!=e.dom},n.prototype.startNotes=function(){var e=[];return null!=this.noteGroup.dom.highlight&&e.push(this.highlightNote()),null!=this.noteGroup.dom.lock&&e.push(this.lockNote()),null!=this.noteGroup.dom.focus&&e.push(this.focusNote()),this.noteGroup.dom.showVictory&&e.push(this.showVictoryNote()),null!=this.noteGroup.dom.letterbox&&e.push(this.letterboxNote()),e},n.prototype.endNotes=function(){var e=[];return null!=this.noteGroup.dom.highlight&&e.push({channel:"level:end-highlight-dom"}),null!=this.noteGroup.dom.lock&&e.push({channel:"level:enable-controls"}),e},n.prototype.skipNotes=function(){var e=[];return null!=this.noteGroup.dom.showVictory&&e.push(this.showVictoryNote(!1)),null!=this.noteGroup.dom.letterbox&&e.push(this.letterboxNote()),e},n.prototype.highlightNote=function(){var e=this.noteGroup.dom,e={channel:"level:highlight-dom",event:{selector:e.highlight.target,delay:e.highlight.delay,sides:e.highlight.sides,offset:e.highlight.offset,rotation:e.highlight.rotation}};return e.event=_.pick(e.event,function(e){return!_.isUndefined(e)}),this.maybeApplyDelayToNote(e),e},n.prototype.focusNote=function(){return{channel:"level:focus-dom",event:{selector:this.noteGroup.dom.focus}}},n.prototype.showVictoryNote=function(e){var t,i={};return i.showModal=!0===(t=this.noteGroup.dom.showVictory)||"Done Button And Modal"===t,null!=e&&(i.showModal=e),{channel:"level:show-victory",event:i}},n.prototype.lockNote=function(){var e={},t=this.noteGroup.dom.lock;return _.isArray(t)&&(e.controls=t),{channel:t?"level:disable-controls":"level:enable-controls",event:e}},n.prototype.letterboxNote=function(){return{channel:"level:set-letterbox",event:{on:this.noteGroup.dom.letterbox}}},n)},1921:function(e,t,i){var o={}.hasOwnProperty;function n(){return n.__super__.constructor.apply(this,arguments)}i=i(1470),e.exports=(function(e,t){for(var i in t)o.call(t,i)&&(e[i]=t[i]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(n,i),n.neededFor=function(e){return null!=e.surface},n.prototype.startNotes=function(){var e=[];return null!=this.noteGroup.surface.focus&&e.push(this.surfaceCameraNote()),null!=this.noteGroup.surface.highlight&&e.push(this.surfaceHighlightNote()),null!=this.noteGroup.surface.lockSelect&&e.push(this.surfaceLockSelectNote()),e},n.prototype.endNotes=function(){var e=[];return null!=this.noteGroup.surface.highlight&&e.push({channel:"sprite:highlight-sprites",event:{thangIDs:[]}}),null!=this.noteGroup.surface.focus&&e.push(this.surfaceCameraNote(!0)),null!=this.noteGroup.surface.lockSelect&&e.push(this.surfaceLockSelectNote()),e},n.prototype.skipNotes=function(){var e=[];return null!=this.noteGroup.surface.focus&&e.push(this.surfaceCameraNote(!0)),null!=this.noteGroup.surface.lockSelect&&e.push(this.surfaceLockSelectNote()),e},n.prototype.surfaceCameraNote=function(e){var t,i;return null==e&&(e=!1),i=this.noteGroup.surface.focus,t={},_.isPlainObject(i.target)&&(t.pos=i.target),_.isString(i.target)&&(t.thangID=i.target),t.zoom=i.zoom||2,t.duration=null!=i.duration?i.duration:1500,e&&(t.duration=0),null!=i.bounds&&(t.bounds=i.bounds),{channel:"camera:set-camera",event:t}},n.prototype.surfaceHighlightNote=function(){var e=this.noteGroup.surface.highlight,e={channel:"sprite:highlight-sprites",event:{thangIDs:e.targets,delay:e.delay}};return this.maybeApplyDelayToNote(e,this.noteGroup),e},n.prototype.surfaceLockSelectNote=function(){return{channel:"level:lock-select",event:{lock:this.noteGroup.surface.lockSelect}}},n)},1922:function(e,t,i){var o={}.hasOwnProperty;function n(){return n.__super__.constructor.apply(this,arguments)}i=i(1470),e.exports=(function(e,t){for(var i in t)o.call(t,i)&&(e[i]=t[i]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(n,i),n.neededFor=function(e){return null!=e.playback},n.prototype.startNotes=function(){var e=[];return null!=this.noteGroup.playback.playing&&e.push(this.playingNote()),null!=this.noteGroup.playback.scrub&&e.push(this.scrubNote()),e},n.prototype.endNotes=function(){return[]},n.prototype.skipNotes=function(){var e=[];return null!=this.noteGroup.playback.playing&&e.push(this.playingNote()),null!=this.noteGroup.playback.scrub&&e.push(this.scrubNote(!0)),e},n.prototype.playingNote=function(){return{channel:"level:set-playing",event:{playing:this.noteGroup.playback.playing}}},n.prototype.scrubNote=function(e){var t,e={channel:"level:set-time",event:{frameOffset:(t=this.noteGroup.playback.scrub).frameOffset||2,scrubDuration:(e=null==e?!1:e)?0:t.duration}};return null!=t.toTime&&(e.event.time=t.toTime),null!=t.toRatio&&(e.event.ratio=t.toRatio),e},n)},1923:function(e,t,i){var n,o={}.hasOwnProperty;function s(){return s.__super__.constructor.apply(this,arguments)}n=i(1470),i(44).me,e.exports=(function(e,t){for(var i in t)o.call(t,i)&&(e[i]=t[i]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(s,n),s.neededFor=function(e){return null!=e.sound},s.prototype.startNotes=function(){var e=[];return null!=this.noteGroup.sound.suppressSelectionSounds&&e.push(this.addSuppressSelectionSoundsNote()),null!=this.noteGroup.sound.music&&e.push(this.addMusicNote()),e},s.prototype.endNotes=function(){return[]},s.prototype.skipNotes=function(){return this.startNotes()},s.prototype.addSuppressSelectionSoundsNote=function(){return{channel:"level:suppress-selection-sounds",event:{suppress:this.noteGroup.sound.suppressSelectionSounds}}},s.prototype.addMusicNote=function(){return{channel:"music-player:play-music",event:this.noteGroup.sound.music}},s)},1924:function(e,t,i){"use strict";i.r(t);var n,o=i(1925),s=i.n(o);for(n in o)["default"].indexOf(n)<0&&function(e){i.d(t,e,function(){return o[e]})}(n);t.default=s.a},1925:function(e,t,i){i(44).me,i(6);i=i(2552).default;e.exports=Vue.extend({props:["showStatus"],data:function(){return{overallStatus:"",timedOut:!1,goals:[],goalStates:{},casting:!1}},computed:{classToShow:function(){var e;return"success"===this.overallStatus&&(e="success"),"failure"===this.overallStatus&&(e="incomplete"),null==(e=this.timedOut&&null==e?"timed-out":e)&&(e="incomplete"),e=this.casting?"running":e},levelGoals:function(){return this.goals.filter(function(e){return!(null!=(e=e.concepts)&&e.length)})},conceptGoals:function(){return this.goals.filter(function(e){return null!=(e=e.concepts)?e.length:void 0})},conceptStatus:function(){for(var e,t=this.conceptGoals,i=0,n=t.length;i<n;i++)if(e=t[i],"success"===(null!=(e=this.goalStates[e.id])?e.status:void 0))return"success";return"incomplete"}},components:{LevelGoal:i}})},1926:function(e,t,i){"use strict";i.r(t);var n,o=i(1927),s=i.n(o);for(n in o)["default"].indexOf(n)<0&&function(e){i.d(t,e,function(){return o[e]})}(n);t.default=s.a},1927:function(e,t,i){var n=i(44).me,o=i(6),s={success:"glyphicon-ok",failure:"glyphicon-remove"};e.exports=Vue.extend({props:{goal:{type:Object},state:{type:Object,default:function(){return{status:"incomplete"}}}},computed:{showGoal:function(){if(this.goal.optional&&"course"===this.$store.state.game.level.type&&"success"!==this.state.status)return!1;if(this.goal.hiddenGoal){if(this.goal.optional&&"success"!==this.state.status)return!1;if(!this.goal.optional&&"failure"!==this.state.status)return!1}return!this.goal.team||n.team===this.goal.team},isConceptGoal:function(){var e;return null!=(e=this.goal.concepts)?e.length:void 0},goalText:function(){var e,t,i=o.i18n(this.goal,"name");return this.state.killed&&(e=_.filter(_.values(this.state.killed)).length,1<(t=_.values(this.state.killed).length)&&(i=i+" ("+(this.goal.isPositive?e:t-e)+"/"+t+")")),i},goalClass:function(){return"status-"+this.state.status},iconClass:function(){return s[this.state.status]||""}}})},1928:function(e,t,i){var n=i(2554);(n="string"==typeof n?[[e.i,n,""]]:n).locals&&(e.exports=n.locals);(0,i(21).default)("6ea7d64c",n,!0,{})},1929:function(e,t,i){var n=i(2556);(n="string"==typeof n?[[e.i,n,""]]:n).locals&&(e.exports=n.locals);(0,i(21).default)("1cd274c1",n,!0,{})},1930:function(a,e,l){!function(t){var i,e,n,o,s={}.hasOwnProperty;function r(e){r.__super__.constructor.call(this,e),this.level=this.options.level,this.options.levelID=this.options.level.get("slug"),this.options.startingSessionHeroConfig=t.extend({},!0,null!=(e=this.options.session.get("heroConfig"))?e:{}),Backbone.Mediator.publish("music-player:enter-menu",{terrain:null!=(e=this.options.level.get("terrain",!0))?e:"Dungeon"})}l(2560),e=l(80),i=l(118),o=l(2562),n=[l(2563),l(2567)],a.exports=(function(e,t){for(var i in t)s.call(t,i)&&(e[i]=t[i]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(r,e),r.prototype.className="modal fade play-modal",r.prototype.template=o,r.prototype.id="game-menu-modal",r.prototype.instant=!0,r.prototype.events={"change input.select":"onSelectionChanged","shown.bs.tab #game-menu-nav a":"onTabShown","click #change-hero-tab":function(){return this.trigger("change-hero")},"click #close-modal":"hide","click .auth-tab":"onClickSignupButton",'click [data-toggle="coco-modal"][data-target="core/CreateAccountModal"]':"openCreateAccountModal"},r.prototype.getRenderData=function(e){var t,i;return e=r.__super__.getRenderData.call(this,e=null==e?{}:e),t=this.options.level.get("documentation"),i=["options","save-load"],window.serverConfig.picoCTF&&(i=_.without(i,"options")),me.isAdmin()||/https?:\/\/localhost/.test(window.location.href)||(i=_.without(i,"save-load")),this.includedSubmenus=i,e.showTab=null!=(t=this.options.showTab)?t:i[0],e.submenus=i,e.iconMap={options:"cog","save-load":"floppy-disk"},e},r.prototype.showsChooseHero=function(){var e;return(null==(e=this.level)||!e.isType("course","course-ladder","game-dev","web-dev","ladder"))&&("open-ended"!==(null!=(e=this.level)?e.get("assessment"):void 0)&&(null==(e=this.level)||!e.usesConfiguredMultiplayerHero()))},r.prototype.afterRender=function(){var e,t,i;for(r.__super__.afterRender.call(this),t=0,i=n.length;t<i;t++)this.insertSubView(new n[t](this.options));return(e=this.subviews.options_view).$el.addClass("active"),"function"==typeof e.onShown&&e.onShown(),this.playSound("game-menu-open"),this.$el.find(".nano:visible").nanoScroller()},r.prototype.onTabShown=function(e){var t,i,n,o,s;for(s in this.playSound("game-menu-tab-switch"),n=e.target.hash.substring(1).replace(/-/g,"_"),"function"==typeof(e=this.subviews[n]).onShown&&e.onShown(),i=[],t=this.subviews)o=t[s],s!==n&&i.push("function"==typeof o.onHidden?o.onHidden():void 0);return i},r.prototype.onHidden=function(){var e,t,i;for(i in r.__super__.onHidden.call(this),e=this.subviews)"function"==typeof(t=e[i]).onHidden&&t.onHidden();return this.playSound("game-menu-close"),Backbone.Mediator.publish("music-player:exit-menu",{})},r.prototype.openCreateAccountModal=function(e){return e.stopPropagation(),this.openModalView(new i)},r.prototype.onClickSignupButton=function(e){var t;return null!=(t=window.tracker)&&t.trackEvent("Started Signup",{category:"Play Level",label:"Game Menu",level:this.options.levelID}),e.preventDefault(),this.openModalView(new i)},r)}.call(this,l(3))},1931:function(r,e,a){!function(t){var e,i,n,o={}.hasOwnProperty;function s(){return s.__super__.constructor.apply(this,arguments)}a(1932),e=a(80),i=a(57),n=a(6),r.exports=(function(e,t){for(var i in t)o.call(t,i)&&(e[i]=t[i]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(s,e),s.prototype.id="image-gallery-modal",s.prototype.template=a(1934),s.prototype.events={"click .image-list-item":"onClickImageListItem","click .copy-url-button":"onClickCopyUrlButton","click .copy-tag-button":"onClickCopyTagButton"},s.prototype.getRenderData=function(){return _.merge(s.__super__.getRenderData.apply(this,arguments),{utils:n})},s.prototype.initialize=function(){return this.state=new i,this.listenTo(this.state,"all",(e=this,function(){return e.renderSelectors(".render"),e.afterRender()}));var e},s.prototype.afterRender=function(){if(-1<n.userAgent().indexOf("Mac"))return this.$(".windows-only").addClass("hidden"),this.$(".mac-only").removeClass("hidden")},s.prototype.onClickImageListItem=function(e){e=t(e.currentTarget).data("portrait-url");return this.state.set({selectedUrl:e})},s.prototype.onClickCopyUrlButton=function(e){return t(".image-url").select(),this.tryCopy()},s.prototype.onClickCopyTagButton=function(e){return t(".image-tag").select(),this.tryCopy()},s.prototype.images=[{slug:"archer-f",name:"Archer F",original:"529ab1a24b67a988ad000002",portraitURL:"/file/db/thang.type/529ab1a24b67a988ad000002/portrait.png",kind:"Unit"},{slug:"archer-m",name:"Archer M",original:"52cee45a76ebd5196b00003a",portraitURL:"/file/db/thang.type/52cee45a76ebd5196b00003a/portrait.png",kind:"Unit"},{slug:"artist",name:"Artist",original:"56d0c4f601476e2100de76c0",portraitURL:"/file/db/thang.type/56d0c4f601476e2100de76c0/portrait.png",kind:"Unit"},{slug:"assassin",name:"Assassin",original:"566a2202e132c81f00f38c81",portraitURL:"/file/db/thang.type/566a2202e132c81f00f38c81/portrait.png",kind:"Hero"},{slug:"baby-griffin",name:"baby griffin",original:"57586f0a22179b2800efda37",portraitURL:"/file/db/thang.type/57586f0a22179b2800efda37/portrait.png",kind:"Item"},{slug:"basic-flags",name:"Basic Flags",original:"545bacb41e649a4495f887da",portraitURL:"/file/db/thang.type/545bacb41e649a4495f887da/portrait.png",kind:"Item"},{slug:"boom-ball",name:"Boom Ball",original:"54eb540b49fa2d5c905ddf1a",portraitURL:"/file/db/thang.type/54eb540b49fa2d5c905ddf1a/portrait.png",kind:"Item"},{slug:"breaker",name:"Breaker",original:"56d0dd5b441ddd2f002ba3d8",portraitURL:"/file/db/thang.type/56d0dd5b441ddd2f002ba3d8/portrait.png",kind:"Unit"},{slug:"burl",name:"Burl",original:"530e5926c06854403ba68693",portraitURL:"/file/db/thang.type/530e5926c06854403ba68693/portrait.png",kind:"Unit"},{slug:"captain",name:"Captain",original:"529ec584c423d4e83b000014",portraitURL:"/file/db/thang.type/529ec584c423d4e83b000014/portrait.png",kind:"Hero"},{slug:"champion",name:"Champion",original:"575848b522179b2800efbfbf",portraitURL:"/file/db/thang.type/575848b522179b2800efbfbf/portrait.png",kind:"Hero"},{slug:"chest-of-gems",name:"Chest of Gems",original:"5432f9d18364d30000d1f943",portraitURL:"/file/db/thang.type/5432f9d18364d30000d1f943/portrait.png",kind:"Misc"},{slug:"confuse",name:"Confuse",original:"53024b76a6efdd32359c5340",portraitURL:"/file/db/thang.type/53024b76a6efdd32359c5340/portrait.png",kind:"Mark"},{slug:"control",name:"Control",original:"53024c7b27471514685d5397",portraitURL:"/file/db/thang.type/53024c7b27471514685d5397/portrait.png",kind:"Mark"},{slug:"cougar",name:"Cougar",original:"5744e3683af6bf590cd27371",portraitURL:"/file/db/thang.type/5744e3683af6bf590cd27371/portrait.png",kind:"Item"},{slug:"cow",name:"Cow",original:"52e95a5022efc8e709001743",portraitURL:"/file/db/thang.type/52e95a5022efc8e709001743/portrait.png",kind:"Doodad"},{slug:"dantdm",name:"DanTDM",original:"578674c3a6c641350091b645",portraitURL:"/file/db/thang.type/578674c3a6c641350091b645/portrait.png",kind:"Unit"},{slug:"desert-bones-2",name:"Desert Bones 2",original:"548cf11b0f559d0000be7e2b",portraitURL:"/file/db/thang.type/548cf11b0f559d0000be7e2b/portrait.png",kind:"Doodad"},{slug:"duelist",name:"Duelist",original:"57588f09046caf2e0012ed41",portraitURL:"/file/db/thang.type/57588f09046caf2e0012ed41/portrait.png",kind:"Hero"},{slug:"equestrian",name:"Equestrian",original:"52e95b4222efc8e70900175d",portraitURL:"/file/db/thang.type/52e95b4222efc8e70900175d/portrait.png",kind:"Unit"},{slug:"flower-1",name:"Flower 1",original:"54e951c8f54ef5794f354ed1",portraitURL:"/file/db/thang.type/54e951c8f54ef5794f354ed1/portrait.png",kind:"Doodad"},{slug:"flower-2",name:"Flower 2",original:"54e9525ff54ef5794f354ed5",portraitURL:"/file/db/thang.type/54e9525ff54ef5794f354ed5/portrait.png",kind:"Doodad"},{slug:"flower-3",name:"Flower 3",original:"54e95293f54ef5794f354ed9",portraitURL:"/file/db/thang.type/54e95293f54ef5794f354ed9/portrait.png",kind:"Doodad"},{slug:"flower-4",name:"Flower 4",original:"54e952b7f54ef5794f354edd",portraitURL:"/file/db/thang.type/54e952b7f54ef5794f354edd/portrait.png",kind:"Doodad"},{slug:"flower-5",name:"Flower 5",original:"54e952daf54ef5794f354ee1",portraitURL:"/file/db/thang.type/54e952daf54ef5794f354ee1/portrait.png",kind:"Doodad"},{slug:"flower-6",name:"Flower 6",original:"54e95308f54ef5794f354ee5",portraitURL:"/file/db/thang.type/54e95308f54ef5794f354ee5/portrait.png",kind:"Doodad"},{slug:"flower-7",name:"Flower 7",original:"54e9532ff54ef5794f354ee9",portraitURL:"/file/db/thang.type/54e9532ff54ef5794f354ee9/portrait.png",kind:"Doodad"},{slug:"flower-8",name:"Flower 8",original:"54e9534ef54ef5794f354eed",portraitURL:"/file/db/thang.type/54e9534ef54ef5794f354eed/portrait.png",kind:"Doodad"},{slug:"forest-archer",name:"Forest Archer",original:"5466d4f2417c8b48a9811e87",portraitURL:"/file/db/thang.type/5466d4f2417c8b48a9811e87/portrait.png",kind:"Hero"},{slug:"frozen-munchkin",name:"Frozen Munchkin",original:"5576686e1e82182d9e6889bb",portraitURL:"/file/db/thang.type/5576686e1e82182d9e6889bb/portrait.png",kind:"Doodad"},{slug:"frozen-soldier-f",name:"Frozen Soldier F",original:"5576683e1e82182d9e6889b7",portraitURL:"/file/db/thang.type/5576683e1e82182d9e6889b7/portrait.png",kind:"Doodad"},{slug:"frozen-soldier-m",name:"Frozen Soldier M",original:"557662bf1e82182d9e6889af",portraitURL:"/file/db/thang.type/557662bf1e82182d9e6889af/portrait.png",kind:"Doodad"},{slug:"gem",name:"Gem",original:"52aa3b9eccbd588d4d000003",portraitURL:"/file/db/thang.type/52aa3b9eccbd588d4d000003/portrait.png",kind:"Misc"},{slug:"gold-coin",name:"Gold Coin",original:"535ef031c519160709f2f63a",portraitURL:"/file/db/thang.type/535ef031c519160709f2f63a/portrait.png",kind:"Misc"},{slug:"goliath",name:"Goliath",original:"55e1a6e876cb0948c96af9f8",portraitURL:"/file/db/thang.type/55e1a6e876cb0948c96af9f8/portrait.png",kind:"Hero"},{slug:"guardian",name:"Guardian",original:"566a058620de41290036a745",portraitURL:"/file/db/thang.type/566a058620de41290036a745/portrait.png",kind:"Hero"},{slug:"horse",name:"Horse",original:"52e989a4427172ae56001f04",portraitURL:"/file/db/thang.type/52e989a4427172ae56001f04/portrait.png",kind:"Doodad"},{slug:"knight",name:"Knight",original:"529ffbf1cf1818f2be000001",portraitURL:"/file/db/thang.type/529ffbf1cf1818f2be000001/portrait.png",kind:"Hero"},{slug:"librarian",name:"Librarian",original:"52fbf74b7e01835453bd8d8e",portraitURL:"/file/db/thang.type/52fbf74b7e01835453bd8d8e/portrait.png",kind:"Hero"},{slug:"necromancer",name:"Necromancer",original:"55652fb3b9effa46a1f775fd",portraitURL:"/file/db/thang.type/55652fb3b9effa46a1f775fd/portrait.png",kind:"Hero"},{slug:"ninja",name:"Ninja",original:"52fc0ed77e01835453bd8f6c",portraitURL:"/file/db/thang.type/52fc0ed77e01835453bd8f6c/portrait.png",kind:"Hero"},{slug:"ogre-brawler",name:"Ogre Brawler",original:"529e5ee76febb9ca7e00000b",portraitURL:"/file/db/thang.type/529e5ee76febb9ca7e00000b/portrait.png",kind:"Unit"},{slug:"ogre-chieftain",name:"Ogre Chieftain",original:"55370661428ddac5686fd026",portraitURL:"/file/db/thang.type/55370661428ddac5686fd026/portrait.png",kind:"Unit"},{slug:"ogre-f",name:"Ogre F",original:"52cedd3e0b0d5c1b4c003ec6",portraitURL:"/file/db/thang.type/52cedd3e0b0d5c1b4c003ec6/portrait.png",kind:"Unit"},{slug:"ogre-fangrider",name:"Ogre Fangrider",original:"529e5f0c6febb9ca7e00000c",portraitURL:"/file/db/thang.type/529e5f0c6febb9ca7e00000c/portrait.png",kind:"Unit"},{slug:"ogre-headhunter",name:"Ogre Headhunter",original:"54c96c3cdef3ad363ff998a1",portraitURL:"/file/db/thang.type/54c96c3cdef3ad363ff998a1/portrait.png",kind:"Unit"},{slug:"ogre-m",name:"Ogre M",original:"529e40856febb9ca7e000004",portraitURL:"/file/db/thang.type/529e40856febb9ca7e000004/portrait.png",kind:"Unit"},{slug:"ogre-munchkin-f",name:"Ogre Munchkin F",original:"52cee1d976ebd5196b000038",portraitURL:"/file/db/thang.type/52cee1d976ebd5196b000038/portrait.png",kind:"Unit"},{slug:"ogre-munchkin-m",name:"Ogre Munchkin M",original:"529e5d756febb9ca7e00000a",portraitURL:"/file/db/thang.type/529e5d756febb9ca7e00000a/portrait.png",kind:"Unit"},{slug:"ogre-shaman",name:"Ogre Shaman",original:"529f92f9dacd325127000008",portraitURL:"/file/db/thang.type/529f92f9dacd325127000008/portrait.png",kind:"Unit"},{slug:"ogre-thrower",name:"Ogre Thrower",original:"529fff23cf1818f2be000003",portraitURL:"/file/db/thang.type/529fff23cf1818f2be000003/portrait.png",kind:"Unit"},{slug:"ogre-warlock",name:"Ogre Warlock",original:"5536f88c428ddac5686fd00c",portraitURL:"/file/db/thang.type/5536f88c428ddac5686fd00c/portrait.png",kind:"Unit"},{slug:"ogre-witch",name:"Ogre Witch",original:"5536ce98428ddac5686fcfd3",portraitURL:"/file/db/thang.type/5536ce98428ddac5686fcfd3/portrait.png",kind:"Unit"},{slug:"oracle",name:"Oracle",original:"56d0cfa063103d2a00af5449",portraitURL:"/file/db/thang.type/56d0cfa063103d2a00af5449/portrait.png",kind:"Unit"},{slug:"paladin",name:"Paladin",original:"552be965c54551e79b57b766",portraitURL:"/file/db/thang.type/552be965c54551e79b57b766/portrait.png",kind:"Unit"},{slug:"peasant-f",name:"Peasant F",original:"52d48f02d0ce9936e2000005",portraitURL:"/file/db/thang.type/52d48f02d0ce9936e2000005/portrait.png",kind:"Unit"},{slug:"peasant-m",name:"Peasant M",original:"529f9026dacd325127000005",portraitURL:"/file/db/thang.type/529f9026dacd325127000005/portrait.png",kind:"Unit"},{slug:"polar-bear-cub",name:"Polar Bear Cub",original:"578691f9bd31c1440083251d",portraitURL:"/file/db/thang.type/578691f9bd31c1440083251d/portrait.png",kind:"Item"},{slug:"potion-master",name:"Potion Master",original:"52e9adf7427172ae56002172",portraitURL:"/file/db/thang.type/52e9adf7427172ae56002172/portrait.png",kind:"Hero"},{slug:"pugicorn",name:"Pugicorn",original:"577d5d4dab818b210046b3bf",portraitURL:"/file/db/thang.type/577d5d4dab818b210046b3bf/portrait.png",kind:"Item"},{slug:"raider",name:"Raider",original:"55527eb0b8abf4ba1fe9a107",portraitURL:"/file/db/thang.type/55527eb0b8abf4ba1fe9a107/portrait.png",kind:"Hero"},{slug:"raven",name:"Raven",original:"5786a472a6c64135009238d3",portraitURL:"/file/db/thang.type/5786a472a6c64135009238d3/portrait.png",kind:"Item"},{slug:"raven-pet",name:"Raven Pet",original:"540f389a821af8000097dc5a",portraitURL:"/file/db/thang.type/540f389a821af8000097dc5a/portrait.png",kind:"Unit"},{slug:"razordisc",name:"Razordisc",original:"54eb4d5949fa2d5c905ddf06",portraitURL:"/file/db/thang.type/54eb4d5949fa2d5c905ddf06/portrait.png",kind:"Item"},{slug:"samurai",name:"Samurai",original:"53e12be0d042f23505c3023b",portraitURL:"/file/db/thang.type/53e12be0d042f23505c3023b/portrait.png",kind:"Hero"},{slug:"skeleton",name:"Skeleton",original:"54c83b8ae2829db30d0310e0",portraitURL:"/file/db/thang.type/54c83b8ae2829db30d0310e0/portrait.png",kind:"Unit"},{slug:"soldier-f",name:"Soldier F",original:"52d49552d0ce9936e2000007",portraitURL:"/file/db/thang.type/52d49552d0ce9936e2000007/portrait.png",kind:"Unit"},{slug:"soldier-m",name:"Soldier M",original:"529e680ac423d4e83b000001",portraitURL:"/file/db/thang.type/529e680ac423d4e83b000001/portrait.png",kind:"Unit"},{slug:"sorcerer",name:"Sorcerer",original:"52fd1524c7e6cf99160e7bc9",portraitURL:"/file/db/thang.type/52fd1524c7e6cf99160e7bc9/portrait.png",kind:"Hero"},{slug:"target",name:"Target",original:"52b32ad97385ec3d03000001",portraitURL:"/file/db/thang.type/52b32ad97385ec3d03000001/portrait.png",kind:"Mark"},{slug:"thoktar",name:"Thoktar",original:"52a00542cf1818f2be000006",portraitURL:"/file/db/thang.type/52a00542cf1818f2be000006/portrait.png",kind:"Unit"},{slug:"tinker",name:"Tinker",original:"56cdd89be906e72400f13451",portraitURL:"/file/db/thang.type/56cdd89be906e72400f13451/portrait.png",kind:"Unit"},{slug:"trapper",name:"Trapper",original:"5466d449417c8b48a9811e83",portraitURL:"/file/db/thang.type/5466d449417c8b48a9811e83/portrait.png",kind:"Hero"},{slug:"wizard",name:"Wizard",original:"52a00d55cf1818f2be00000b",portraitURL:"/file/db/thang.type/52a00d55cf1818f2be00000b/portrait.png",kind:"Unit"},{slug:"wyrm",name:"Wyrm",original:"56ba2b34e942de2600c792ed",portraitURL:"/file/db/thang.type/56ba2b34e942de2600c792ed/portrait.png",kind:"Unit"}],s.prototype.otherImages=[{slug:"hero-placeholder",name:"Hero Placeholder",original:"53ed1d9c2b65b0e32b9c96a9",portraitURL:"/file/db/thang.type/53ed1d9c2b65b0e32b9c96a9/portrait.png",kind:"Unit"},{slug:"flag",name:"Flag",original:"53fa25f25bc220000052c2be",portraitURL:"/file/db/thang.type/53fa25f25bc220000052c2be/portrait.png",kind:"Misc"},{slug:"ace-of-coders-background",name:"Ace of Coders Background",original:"55ef24a10e11a95a0d0ab103",portraitURL:"/file/db/thang.type/55ef24a10e11a95a0d0ab103/portrait.png",kind:"Floor"},{slug:"advanced-flags",name:"Advanced Flags",original:"5478b97e8707a2c3a2493b2f",portraitURL:"/file/db/thang.type/5478b97e8707a2c3a2493b2f/portrait.png",kind:"Item"},{slug:"aerial-spear",name:"Aerial Spear",original:"5400da521130f1881ca255e4",portraitURL:"/file/db/thang.type/5400da521130f1881ca255e4/portrait.png",kind:"Misc"},{slug:"altar",name:"Altar",original:"54ef8eb683b08b7d054b7f04",portraitURL:"/file/db/thang.type/54ef8eb683b08b7d054b7f04/portrait.png",kind:"Doodad"},{slug:"amber-sense-stone",name:"Amber Sense Stone",original:"54693413a2b1f53ce79443dd",portraitURL:"/file/db/thang.type/54693413a2b1f53ce79443dd/portrait.png",kind:"Item"},{slug:"angel-fountain",name:"Angel Fountain",original:"54f11438021968810565376b",portraitURL:"/file/db/thang.type/54f11438021968810565376b/portrait.png",kind:"Doodad"},{slug:"angel-statue",name:"Angel Statue",original:"54f1152a021968810565378a",portraitURL:"/file/db/thang.type/54f1152a021968810565378a/portrait.png",kind:"Doodad"},{slug:"archway",name:"Archway",original:"534dd3531a52ddd804f34efc",portraitURL:"/file/db/thang.type/534dd3531a52ddd804f34efc/portrait.png",kind:"Misc"},{slug:"arrow",name:"Arrow",original:"529ce66b0bf0bccdc6000005",portraitURL:"/file/db/thang.type/529ce66b0bf0bccdc6000005/portrait.png",kind:"Missile"},{slug:"arrow-tower",name:"Arrow Tower",original:"529f93cfdacd32512700000a",portraitURL:"/file/db/thang.type/529f93cfdacd32512700000a/portrait.png",kind:"Unit"},{slug:"artillery",name:"Artillery",original:"529e7a16c423d4e83b000003",portraitURL:"/file/db/thang.type/529e7a16c423d4e83b000003/portrait.png",kind:"Unit"},{slug:"baby-griffin-pet",name:"Baby Griffin Pet",original:"5750ef2f9f734c20005f1f57",portraitURL:"/file/db/thang.type/5750ef2f9f734c20005f1f57/portrait.png",kind:"Unit"},{slug:"ball",name:"Ball",original:"5580af39b43ce0b15a91b299",portraitURL:"/file/db/thang.type/5580af39b43ce0b15a91b299/portrait.png",kind:"Doodad"},{slug:"balsa-staff",name:"Balsa Staff",original:"544d88478494308424f56505",portraitURL:"/file/db/thang.type/544d88478494308424f56505/portrait.png",kind:"Item"},{slug:"banded-redwood-wand",name:"Banded Redwood Wand",original:"544d887c8494308424f56509",portraitURL:"/file/db/thang.type/544d887c8494308424f56509/portrait.png",kind:"Item"},{slug:"barn",name:"Barn",original:"54f1136f25be5e88058374b3",portraitURL:"/file/db/thang.type/54f1136f25be5e88058374b3/portrait.png",kind:"Doodad"},{slug:"barrel",name:"Barrel",original:"52aa5ff120fccb0000000003",portraitURL:"/file/db/thang.type/52aa5ff120fccb0000000003/portrait.png",kind:"Doodad"},{slug:"barrel-animated",name:"Barrel Animated",original:"54d2b28e7e1b915605556c37",portraitURL:"/file/db/thang.type/54d2b28e7e1b915605556c37/portrait.png",kind:"Doodad"},{slug:"barrel-animated-2",name:"Barrel Animated 2",original:"54d2b4fdae912a520569cff1",portraitURL:"/file/db/thang.type/54d2b4fdae912a520569cff1/portrait.png",kind:"Doodad"},{slug:"bat",name:"Bat",original:"55c13175c87e47c60604f987",portraitURL:"/file/db/thang.type/55c13175c87e47c60604f987/portrait.png",kind:"Doodad"},{slug:"beam",name:"Beam",original:"529ec2cec423d4e83b000011",portraitURL:"/file/db/thang.type/529ec2cec423d4e83b000011/portrait.png",kind:"Missile"},{slug:"beam-tower",name:"Beam Tower",original:"529ec0c1c423d4e83b00000d",portraitURL:"/file/db/thang.type/529ec0c1c423d4e83b00000d/portrait.png",kind:"Unit"},{slug:"bear",name:"Bear",original:"54e95b22f54ef5794f354f41",portraitURL:"/file/db/thang.type/54e95b22f54ef5794f354f41/portrait.png",kind:"Doodad"},{slug:"bear-trap",name:"Bear Trap",original:"54d2b8ef3e16915505f0bfeb",portraitURL:"/file/db/thang.type/54d2b8ef3e16915505f0bfeb/portrait.png",kind:"Doodad"},{slug:"big-rocks-1",name:"Big Rocks 1",original:"557f950db43ce0b15a91b1d9",portraitURL:"/file/db/thang.type/557f950db43ce0b15a91b1d9/portrait.png",kind:"Doodad"},{slug:"big-rocks-2",name:"Big Rocks 2",original:"557f959ab43ce0b15a91b1dd",portraitURL:"/file/db/thang.type/557f959ab43ce0b15a91b1dd/portrait.png",kind:"Doodad"},{slug:"big-rocks-3",name:"Big Rocks 3",original:"557f95e7b43ce0b15a91b1e1",portraitURL:"/file/db/thang.type/557f95e7b43ce0b15a91b1e1/portrait.png",kind:"Doodad"},{slug:"big-rocks-4",name:"Big Rocks 4",original:"557f9627b43ce0b15a91b1e5",portraitURL:"/file/db/thang.type/557f9627b43ce0b15a91b1e5/portrait.png",kind:"Doodad"},{slug:"big-rocks-5",name:"Big Rocks 5",original:"557f9661b43ce0b15a91b1e9",portraitURL:"/file/db/thang.type/557f9661b43ce0b15a91b1e9/portrait.png",kind:"Doodad"},{slug:"bird",name:"Bird",original:"53e2e31f6f406a3505b3eab0",portraitURL:"/file/db/thang.type/53e2e31f6f406a3505b3eab0/portrait.png",kind:"Doodad"},{slug:"bloodhenge",name:"Bloodhenge",original:"54f1168802196881056537df",portraitURL:"/file/db/thang.type/54f1168802196881056537df/portrait.png",kind:"Doodad"},{slug:"blue-cart",name:"Blue Cart",original:"5435d3207b554def1f99c49c",portraitURL:"/file/db/thang.type/5435d3207b554def1f99c49c/portrait.png",kind:"Doodad"},{slug:"bluff-1",name:"Bluff 1",original:"52afce51c5b1813ec200001a",portraitURL:"/file/db/thang.type/52afce51c5b1813ec200001a/portrait.png",kind:"Doodad"},{slug:"bluff-2",name:"Bluff 2",original:"52afcecbc5b1813ec200001c",portraitURL:"/file/db/thang.type/52afcecbc5b1813ec200001c/portrait.png",kind:"Doodad"},{slug:"bolt",name:"Bolt",original:"55c658a8a03e2014d693990a",portraitURL:"/file/db/thang.type/55c658a8a03e2014d693990a/portrait.png",kind:"Missile"},{slug:"bolt-spitter",name:"Bolt Spitter",original:"544d85d88494308424f564e4",portraitURL:"/file/db/thang.type/544d85d88494308424f564e4/portrait.png",kind:"Item"},{slug:"boltsaw",name:"Boltsaw",original:"544d6f5e8494308424f56476",portraitURL:"/file/db/thang.type/544d6f5e8494308424f56476/portrait.png",kind:"Item"},{slug:"bone-dagger",name:"Bone Dagger",original:"54eb4b2249fa2d5c905ddefe",portraitURL:"/file/db/thang.type/54eb4b2249fa2d5c905ddefe/portrait.png",kind:"Item"},{slug:"book-of-life-i",name:"Book of Life I",original:"546375653839c6e02811d30b",portraitURL:"/file/db/thang.type/546375653839c6e02811d30b/portrait.png",kind:"Item"},{slug:"book-of-life-ii",name:"Book of Life II",original:"546375813839c6e02811d30e",portraitURL:"/file/db/thang.type/546375813839c6e02811d30e/portrait.png",kind:"Item"},{slug:"book-of-life-iii",name:"Book of Life III",original:"546375a43839c6e02811d311",portraitURL:"/file/db/thang.type/546375a43839c6e02811d311/portrait.png",kind:"Item"},{slug:"book-of-life-iv",name:"Book of Life IV",original:"546376ca3839c6e02811d31d",portraitURL:"/file/db/thang.type/546376ca3839c6e02811d31d/portrait.png",kind:"Item"},{slug:"book-of-life-v",name:"Book of Life V",original:"546376ea3839c6e02811d320",portraitURL:"/file/db/thang.type/546376ea3839c6e02811d320/portrait.png",kind:"Item"},{slug:"bookshelf",name:"Bookshelf",original:"52e994ea427172ae56001fc9",portraitURL:"/file/db/thang.type/52e994ea427172ae56001fc9/portrait.png",kind:"Doodad"},{slug:"bookshelf-2",name:"Bookshelf 2",original:"54ef925a64112781056c18b5",portraitURL:"/file/db/thang.type/54ef925a64112781056c18b5/portrait.png",kind:"Doodad"},{slug:"boom-ball-missile",name:"Boom Ball Missile",original:"5535b5d4428ddac5686fcf82",portraitURL:"/file/db/thang.type/5535b5d4428ddac5686fcf82/portrait.png",kind:"Missile"},{slug:"boomrod",name:"Boomrod",original:"544d85898494308424f564df",portraitURL:"/file/db/thang.type/544d85898494308424f564df/portrait.png",kind:"Item"},{slug:"boots-of-jumping",name:"Boots of Jumping",original:"546d4e289df4a17d0d449ad5",portraitURL:"/file/db/thang.type/546d4e289df4a17d0d449ad5/portrait.png",kind:"Item"},{slug:"boots-of-leaping",name:"Boots of Leaping",original:"53e214f153457600003e3eab",portraitURL:"/file/db/thang.type/53e214f153457600003e3eab/portrait.png",kind:"Item"},{slug:"boss-star-i",name:"Boss Star I",original:"54eb58e449fa2d5c905ddf46",portraitURL:"/file/db/thang.type/54eb58e449fa2d5c905ddf46/portrait.png",kind:"Item"},{slug:"boss-star-ii",name:"Boss Star II",original:"54eb5bf649fa2d5c905ddf4a",portraitURL:"/file/db/thang.type/54eb5bf649fa2d5c905ddf4a/portrait.png",kind:"Item"},{slug:"boss-star-iii",name:"Boss Star III",original:"54eb5c8f49fa2d5c905ddf4e",portraitURL:"/file/db/thang.type/54eb5c8f49fa2d5c905ddf4e/portrait.png",kind:"Item"},{slug:"boss-star-iv",name:"Boss Star IV",original:"54eb5d1649fa2d5c905ddf52",portraitURL:"/file/db/thang.type/54eb5d1649fa2d5c905ddf52/portrait.png",kind:"Item"},{slug:"boss-star-v",name:"Boss Star V",original:"54eb5dbc49fa2d5c905ddf56",portraitURL:"/file/db/thang.type/54eb5dbc49fa2d5c905ddf56/portrait.png",kind:"Item"},{slug:"boulder",name:"Boulder",original:"544d86828494308424f564ec",portraitURL:"/file/db/thang.type/544d86828494308424f564ec/portrait.png",kind:"Missile"},{slug:"boulder-trap",name:"Boulder Trap",original:"55c246b1dfc8d0b576e60a23",portraitURL:"/file/db/thang.type/55c246b1dfc8d0b576e60a23/portrait.png",kind:"Doodad"},{slug:"box",name:"Box",original:"54d2b68a3e16915505f0bc8a",portraitURL:"/file/db/thang.type/54d2b68a3e16915505f0bc8a/portrait.png",kind:"Doodad"},{slug:"box-2",name:"Box 2",original:"54d2b797051a3a5305424c62",portraitURL:"/file/db/thang.type/54d2b797051a3a5305424c62/portrait.png",kind:"Doodad"},{slug:"brawlwood",name:"Brawlwood",original:"533b1f1642aef2202fdcc487",portraitURL:"/file/db/thang.type/533b1f1642aef2202fdcc487/portrait.png",kind:"Floor"},{slug:"breakout-background",name:"Breakout Background",original:"56c65f8b79735337006047df",portraitURL:"/file/db/thang.type/56c65f8b79735337006047df/portrait.png",kind:"Floor"},{slug:"broken-tower",name:"Broken Tower",original:"5376b2caff7b2d3805a396a9",portraitURL:"/file/db/thang.type/5376b2caff7b2d3805a396a9/portrait.png",kind:"Doodad"},{slug:"bronze-coin",name:"Bronze Coin",original:"535ef2d54f10444d08486ba8",portraitURL:"/file/db/thang.type/535ef2d54f10444d08486ba8/portrait.png",kind:"Misc"},{slug:"bronze-shield",name:"Bronze Shield",original:"544c310ae0017993fce214bf",portraitURL:"/file/db/thang.type/544c310ae0017993fce214bf/portrait.png",kind:"Item"},{slug:"bullet",name:"Bullet",original:"544d82bd8494308424f564d0",portraitURL:"/file/db/thang.type/544d82bd8494308424f564d0/portrait.png",kind:"Missile"},{slug:"cabin-1",name:"Cabin 1",original:"54e93b41970f0b0a263c0400",portraitURL:"/file/db/thang.type/54e93b41970f0b0a263c0400/portrait.png",kind:"Doodad"},{slug:"cabin-2",name:"Cabin 2",original:"54e93cb4970f0b0a263c0406",portraitURL:"/file/db/thang.type/54e93cb4970f0b0a263c0406/portrait.png",kind:"Doodad"},{slug:"cabin-3",name:"Cabin 3",original:"54e93d1cf54ef5794f354e7d",portraitURL:"/file/db/thang.type/54e93d1cf54ef5794f354e7d/portrait.png",kind:"Doodad"},{slug:"cabin-4",name:"Cabin 4",original:"54e93db7f54ef5794f354e83",portraitURL:"/file/db/thang.type/54e93db7f54ef5794f354e83/portrait.png",kind:"Doodad"},{slug:"cabinet",name:"Cabinet",original:"54ef9101c1f3bd7c0593f232",portraitURL:"/file/db/thang.type/54ef9101c1f3bd7c0593f232/portrait.png",kind:"Doodad"},{slug:"cactus-1",name:"Cactus 1",original:"546e24949df4a17d0d449bc5",portraitURL:"/file/db/thang.type/546e24949df4a17d0d449bc5/portrait.png",kind:"Doodad"},{slug:"cactus-2",name:"Cactus 2",original:"546e24039df4a17d0d449bb9",portraitURL:"/file/db/thang.type/546e24039df4a17d0d449bb9/portrait.png",kind:"Doodad"},{slug:"caltrop-belt",name:"Caltrop Belt",original:"54694af7a2b1f53ce7944441",portraitURL:"/file/db/thang.type/54694af7a2b1f53ce7944441/portrait.png",kind:"Item"},{slug:"caltrops",name:"Caltrops",original:"557f9700b43ce0b15a91b1ed",portraitURL:"/file/db/thang.type/557f9700b43ce0b15a91b1ed/portrait.png",kind:"Doodad"},{slug:"camel",name:"Camel",original:"548cf4cd0f559d0000be7e57",portraitURL:"/file/db/thang.type/548cf4cd0f559d0000be7e57/portrait.png",kind:"Doodad"},{slug:"camp-fire",name:"Camp Fire",original:"52e097c110012a5b250000b2",portraitURL:"/file/db/thang.type/52e097c110012a5b250000b2/portrait.png",kind:"Doodad"},{slug:"campfire-stone",name:"Campfire Stone",original:"54f118e125be5e880583759a",portraitURL:"/file/db/thang.type/54f118e125be5e880583759a/portrait.png",kind:"Doodad"},{slug:"candle",name:"Candle",original:"52e95fb222efc8e7090017d7",portraitURL:"/file/db/thang.type/52e95fb222efc8e7090017d7/portrait.png",kind:"Doodad"},{slug:"carved-steel-ring",name:"Carved Steel Ring",original:"54692dfaa2b1f53ce794439f",portraitURL:"/file/db/thang.type/54692dfaa2b1f53ce794439f/portrait.png",kind:"Item"},{slug:"catapult",name:"Catapult",original:"553e7ba29bdea5d00f1fd905",portraitURL:"/file/db/thang.type/553e7ba29bdea5d00f1fd905/portrait.png",kind:"Unit"},{slug:"cave",name:"Cave",original:"52e95983427172ae560018ce",portraitURL:"/file/db/thang.type/52e95983427172ae560018ce/portrait.png",kind:"Doodad"},{slug:"chainmail-tunic",name:"Chainmail Tunic",original:"5441c4dd4e9aeb727cc9713b",portraitURL:"/file/db/thang.type/5441c4dd4e9aeb727cc9713b/portrait.png",kind:"Item"},{slug:"chains",name:"Chains",original:"52aa602020fccb0000000004",portraitURL:"/file/db/thang.type/52aa602020fccb0000000004/portrait.png",kind:"Doodad"},{slug:"chair",name:"Chair",original:"52e9960e427172ae56001fdf",portraitURL:"/file/db/thang.type/52e9960e427172ae56001fdf/portrait.png",kind:"Doodad"},{slug:"charge-belt",name:"Charge Belt",original:"54694b27a2b1f53ce7944445",portraitURL:"/file/db/thang.type/54694b27a2b1f53ce7944445/portrait.png",kind:"Item"},{slug:"choppable-tree-1",name:"Choppable Tree 1",original:"52fbd1d67e01835453bd8a26",portraitURL:"/file/db/thang.type/52fbd1d67e01835453bd8a26/portrait.png",kind:"Doodad"},{slug:"choppable-tree-2",name:"Choppable Tree 2",original:"52fbd7e07e01835453bd8afc",portraitURL:"/file/db/thang.type/52fbd7e07e01835453bd8afc/portrait.png",kind:"Doodad"},{slug:"choppable-tree-3",name:"Choppable Tree 3",original:"52fbd9beab6e45c813bc79c6",portraitURL:"/file/db/thang.type/52fbd9beab6e45c813bc79c6/portrait.png",kind:"Doodad"},{slug:"choppable-tree-4",name:"Choppable Tree 4",original:"52fbdb747e01835453bd8b4a",portraitURL:"/file/db/thang.type/52fbdb747e01835453bd8b4a/portrait.png",kind:"Doodad"},{slug:"circle-tree-stand-1",name:"Circle Tree Stand 1",original:"541cb842c6362edfb0f3447d",portraitURL:"/file/db/thang.type/541cb842c6362edfb0f3447d/portrait.png",kind:"Doodad"},{slug:"circle-tree-stand-2",name:"Circle Tree Stand 2",original:"541cc5708e78524aad94de69",portraitURL:"/file/db/thang.type/541cc5708e78524aad94de69/portrait.png",kind:"Doodad"},{slug:"circle-tree-stand-3",name:"Circle Tree Stand 3",original:"541cc6898e78524aad94de6f",portraitURL:"/file/db/thang.type/541cc6898e78524aad94de6f/portrait.png",kind:"Doodad"},{slug:"circlet-of-the-magi",name:"Circlet of the Magi",original:"54ea39342b7506e891ca70f2",portraitURL:"/file/db/thang.type/54ea39342b7506e891ca70f2/portrait.png",kind:"Item"},{slug:"classroom-bench",name:"classroom bench",original:"56eb09520c6e9f1f00990e81",portraitURL:"/file/db/thang.type/56eb09520c6e9f1f00990e81/portrait.png",kind:"Doodad"},{slug:"classroom-floor",name:"Classroom Floor",original:"56a139f9d987c52900d4de5a",portraitURL:"/file/db/thang.type/56a139f9d987c52900d4de5a/portrait.png",kind:"Floor"},{slug:"classroom-sculpture",name:"Classroom Sculpture",original:"56a16510088f002400720564",portraitURL:"/file/db/thang.type/56a16510088f002400720564/portrait.png",kind:"Doodad"},{slug:"classroom-students-desk",name:"Classroom Students Desk",original:"56a15d88d987c52900d4ecdb",portraitURL:"/file/db/thang.type/56a15d88d987c52900d4ecdb/portrait.png",kind:"Doodad"},{slug:"classroom-students-seat",name:"Classroom Students Seat",original:"56a162348431922e0042fae3",portraitURL:"/file/db/thang.type/56a162348431922e0042fae3/portrait.png",kind:"Doodad"},{slug:"classroom-viewscreen",name:"Classroom Viewscreen",original:"569fdf3c6ff9591f000050bf",portraitURL:"/file/db/thang.type/569fdf3c6ff9591f000050bf/portrait.png",kind:"Doodad"},{slug:"classroom-wall",name:"Classroom Wall",original:"56a0150cf363ed1f0029e11c",portraitURL:"/file/db/thang.type/56a0150cf363ed1f0029e11c/portrait.png",kind:"Wall"},{slug:"claymore",name:"Claymore",original:"544d6d4a8494308424f56471",portraitURL:"/file/db/thang.type/544d6d4a8494308424f56471/portrait.png",kind:"Item"},{slug:"cloud-1",name:"Cloud 1",original:"550b42b7343675176d05a919",portraitURL:"/file/db/thang.type/550b42b7343675176d05a919/portrait.png",kind:"Doodad"},{slug:"cloud-2",name:"Cloud 2",original:"550b43fc343675176d05a923",portraitURL:"/file/db/thang.type/550b43fc343675176d05a923/portrait.png",kind:"Doodad"},{slug:"cloud-3",name:"Cloud 3",original:"550b4506343675176d05a933",portraitURL:"/file/db/thang.type/550b4506343675176d05a933/portrait.png",kind:"Doodad"},{slug:"coin",name:"Coin",original:"52aa3a8fccbd588d4d000001",portraitURL:"/file/db/thang.type/52aa3a8fccbd588d4d000001/portrait.png",kind:"Misc"},{slug:"compound-boots",name:"Compound Boots",original:"546d4d8e9df4a17d0d449acd",portraitURL:"/file/db/thang.type/546d4d8e9df4a17d0d449acd/portrait.png",kind:"Item"},{slug:"cougar-pet",name:"Cougar Pet",original:"540f3a33821af8000097dc62",portraitURL:"/file/db/thang.type/540f3a33821af8000097dc62/portrait.png",kind:"Unit"},{slug:"crevasse-1",name:"Crevasse 1",original:"5576080a1e82182d9e6888cd",portraitURL:"/file/db/thang.type/5576080a1e82182d9e6888cd/portrait.png",kind:"Doodad"},{slug:"crevasse-2",name:"Crevasse 2",original:"557630c31e82182d9e688921",portraitURL:"/file/db/thang.type/557630c31e82182d9e688921/portrait.png",kind:"Doodad"},{slug:"crevasse-3",name:"Crevasse 3",original:"557631321e82182d9e688925",portraitURL:"/file/db/thang.type/557631321e82182d9e688925/portrait.png",kind:"Doodad"},{slug:"crisscross-back",name:"Crisscross Back",original:"53b495e37e17883a05754216",portraitURL:"/file/db/thang.type/53b495e37e17883a05754216/portrait.png",kind:"Floor"},{slug:"crisscross-front",name:"Crisscross Front",original:"53b495b02082f23505b844e5",portraitURL:"/file/db/thang.type/53b495b02082f23505b844e5/portrait.png",kind:"Floor"},{slug:"cross-bones-background",name:"Cross Bones Background",original:"572e51175366918e018060e5",portraitURL:"/file/db/thang.type/572e51175366918e018060e5/portrait.png",kind:"Floor"},{slug:"crossbeam-support",name:"crossbeam support",original:"5786828a0d397a2e0026f274",portraitURL:"/file/db/thang.type/5786828a0d397a2e0026f274/portrait.png",kind:"Doodad"},{slug:"crossbow",name:"Crossbow",original:"53e21ae653457600003e3ec2",portraitURL:"/file/db/thang.type/53e21ae653457600003e3ec2/portrait.png",kind:"Item"},{slug:"crude-builders-hammer",name:"Crude Builder's Hammer",original:"53f4e6e3d822c23505b74f42",portraitURL:"/file/db/thang.type/53f4e6e3d822c23505b74f42/portrait.png",kind:"Item"},{slug:"crude-crossbow",name:"Crude Crossbow",original:"544d7ffd8494308424f564c3",portraitURL:"/file/db/thang.type/544d7ffd8494308424f564c3/portrait.png",kind:"Item"},{slug:"crude-dagger",name:"Crude Dagger",original:"544d952b8494308424f56517",portraitURL:"/file/db/thang.type/544d952b8494308424f56517/portrait.png",kind:"Item"},{slug:"crude-dagger-missile",name:"Crude Dagger Missile",original:"546e292d9df4a17d0d449c0c",portraitURL:"/file/db/thang.type/546e292d9df4a17d0d449c0c/portrait.png",kind:"Missile"},{slug:"crude-glasses",name:"Crude Glasses",original:"53e238df53457600003e3f0b",portraitURL:"/file/db/thang.type/53e238df53457600003e3f0b/portrait.png",kind:"Item"},{slug:"crude-spike",name:"Crude Spike",original:"544d79e28494308424f56482",portraitURL:"/file/db/thang.type/544d79e28494308424f56482/portrait.png",kind:"Item"},{slug:"crude-telephoto-glasses",name:"Crude Telephoto Glasses",original:"5469415aa2b1f53ce7944411",portraitURL:"/file/db/thang.type/5469415aa2b1f53ce7944411/portrait.png",kind:"Item"},{slug:"crypt-key",name:"Crypt Key",original:"54eb573549fa2d5c905ddf36",portraitURL:"/file/db/thang.type/54eb573549fa2d5c905ddf36/portrait.png",kind:"Item"},{slug:"crystal-wand",name:"Crystal Wand",original:"54eab63b2b7506e891ca71f2",portraitURL:"/file/db/thang.type/54eab63b2b7506e891ca71f2/portrait.png",kind:"Item"},{slug:"cupboards-of-kgard-background",name:"Cupboards of Kgard background",original:"56994ec3d32e4c1f0075460d",portraitURL:"/file/db/thang.type/56994ec3d32e4c1f0075460d/portrait.png",kind:"Floor"},{slug:"curse",name:"Curse",original:"53024d18a6efdd32359c5365",portraitURL:"/file/db/thang.type/53024d18a6efdd32359c5365/portrait.png",kind:"Mark"},{slug:"cut-garnet-sense-stone",name:"Cut Garnet Sense Stone",original:"546933a5a2b1f53ce79443d5",portraitURL:"/file/db/thang.type/546933a5a2b1f53ce79443d5/portrait.png",kind:"Item"},{slug:"cut-stone-builders-hammer",name:"Cut Stone Builder's Hammer",original:"54694c0ba2b1f53ce7944456",portraitURL:"/file/db/thang.type/54694c0ba2b1f53ce7944456/portrait.png",kind:"Item"},{slug:"darksteel-blade",name:"Darksteel Blade",original:"544d7f558494308424f564bb",portraitURL:"/file/db/thang.type/544d7f558494308424f564bb/portrait.png",kind:"Item"},{slug:"deadeye-crossbow",name:"Deadeye Crossbow",original:"54eaad752b7506e891ca71d1",portraitURL:"/file/db/thang.type/54eaad752b7506e891ca71d1/portrait.png",kind:"Item"},{slug:"decoy",name:"Decoy",original:"5498bb758e52573b10d3bce6",portraitURL:"/file/db/thang.type/5498bb758e52573b10d3bce6/portrait.png",kind:"Unit"},{slug:"defensive-boots",name:"Defensive Boots",original:"546d4e019df4a17d0d449ad1",portraitURL:"/file/db/thang.type/546d4e019df4a17d0d449ad1/portrait.png",kind:"Item"},{slug:"defensive-infantry-shield",name:"Defensive Infantry Shield",original:"544d7b408494308424f5648f",portraitURL:"/file/db/thang.type/544d7b408494308424f5648f/portrait.png",kind:"Item"},{slug:"deflector",name:"Deflector",original:"54eabff349fa2d5c905ddeee",portraitURL:"/file/db/thang.type/54eabff349fa2d5c905ddeee/portrait.png",kind:"Item"},{slug:"derrick",name:"Derrick",original:"546e24339df4a17d0d449bbd",portraitURL:"/file/db/thang.type/546e24339df4a17d0d449bbd/portrait.png",kind:"Doodad"},{slug:"desert-bones-1",name:"Desert Bones 1",original:"548cf0cc0f559d0000be7e27",portraitURL:"/file/db/thang.type/548cf0cc0f559d0000be7e27/portrait.png",kind:"Doodad"},{slug:"desert-bones-3",name:"Desert Bones 3",original:"548cf1630f559d0000be7e2f",portraitURL:"/file/db/thang.type/548cf1630f559d0000be7e2f/portrait.png",kind:"Doodad"},{slug:"desert-green-1",name:"Desert Green 1",original:"548cef670f559d0000be7e17",portraitURL:"/file/db/thang.type/548cef670f559d0000be7e17/portrait.png",kind:"Doodad"},{slug:"desert-green-2",name:"Desert Green 2",original:"548cefc50f559d0000be7e1b",portraitURL:"/file/db/thang.type/548cefc50f559d0000be7e1b/portrait.png",kind:"Doodad"},{slug:"desert-house-1",name:"Desert House 1",original:"548cf35a0f559d0000be7e43",portraitURL:"/file/db/thang.type/548cf35a0f559d0000be7e43/portrait.png",kind:"Doodad"},{slug:"desert-house-2",name:"Desert House 2",original:"548cf3ae0f559d0000be7e47",portraitURL:"/file/db/thang.type/548cf3ae0f559d0000be7e47/portrait.png",kind:"Doodad"},{slug:"desert-house-3",name:"Desert House 3",original:"548cf4000f559d0000be7e4b",portraitURL:"/file/db/thang.type/548cf4000f559d0000be7e4b/portrait.png",kind:"Doodad"},{slug:"desert-house-4",name:"Desert House 4",original:"548cf44c0f559d0000be7e4f",portraitURL:"/file/db/thang.type/548cf44c0f559d0000be7e4f/portrait.png",kind:"Doodad"},{slug:"desert-palm-1",name:"Desert Palm 1",original:"548cf0110f559d0000be7e1f",portraitURL:"/file/db/thang.type/548cf0110f559d0000be7e1f/portrait.png",kind:"Doodad"},{slug:"desert-palm-2",name:"Desert Palm 2",original:"548cf06f0f559d0000be7e23",portraitURL:"/file/db/thang.type/548cf06f0f559d0000be7e23/portrait.png",kind:"Doodad"},{slug:"desert-pillar",name:"Desert Pillar",original:"541c5ff487338f570851ad83",portraitURL:"/file/db/thang.type/541c5ff487338f570851ad83/portrait.png",kind:"Doodad"},{slug:"desert-pyramid",name:"Desert Pyramid",original:"53e239c253457600003e3f11",portraitURL:"/file/db/thang.type/53e239c253457600003e3f11/portrait.png",kind:"Doodad"},{slug:"desert-rubble-1",name:"Desert Rubble 1",original:"53126c48f5a594b00fbfcc42",portraitURL:"/file/db/thang.type/53126c48f5a594b00fbfcc42/portrait.png",kind:"Doodad"},{slug:"desert-rubble-2",name:"Desert Rubble 2",original:"52f01b0b5071878f7650e11a",portraitURL:"/file/db/thang.type/52f01b0b5071878f7650e11a/portrait.png",kind:"Doodad"},{slug:"desert-rubble-3",name:"Desert Rubble 3",original:"546e23a89df4a17d0d449bb1",portraitURL:"/file/db/thang.type/546e23a89df4a17d0d449bb1/portrait.png",kind:"Doodad"},{slug:"desert-sand-rock",name:"Desert Sand Rock",original:"55c64774ef141c65665beb84",portraitURL:"/file/db/thang.type/55c64774ef141c65665beb84/portrait.png",kind:"Doodad"},{slug:"desert-shrub-big-1",name:"Desert Shrub Big 1",original:"546e237d9df4a17d0d449bad",portraitURL:"/file/db/thang.type/546e237d9df4a17d0d449bad/portrait.png",kind:"Doodad"},{slug:"desert-shrub-big-2",name:"Desert Shrub Big 2",original:"546e22c59df4a17d0d449ba1",portraitURL:"/file/db/thang.type/546e22c59df4a17d0d449ba1/portrait.png",kind:"Doodad"},{slug:"desert-shrub-big-3",name:"Desert Shrub Big 3",original:"53f4c776d822c23505b7091c",portraitURL:"/file/db/thang.type/53f4c776d822c23505b7091c/portrait.png",kind:"Doodad"},{slug:"desert-shrub-small-1",name:"Desert Shrub Small 1",original:"548ceec80f559d0000be7e0f",portraitURL:"/file/db/thang.type/548ceec80f559d0000be7e0f/portrait.png",kind:"Doodad"},{slug:"desert-shrub-small-2",name:"Desert Shrub Small 2",original:"548cef1f0f559d0000be7e13",portraitURL:"/file/db/thang.type/548cef1f0f559d0000be7e13/portrait.png",kind:"Doodad"},{slug:"desert-skullcave",name:"Desert Skullcave",original:"546e231c9df4a17d0d449ba5",portraitURL:"/file/db/thang.type/546e231c9df4a17d0d449ba5/portrait.png",kind:"Doodad"},{slug:"desert-wall-1",name:"Desert Wall 1",original:"5404fe5f1d10b2f170618ae9",portraitURL:"/file/db/thang.type/5404fe5f1d10b2f170618ae9/portrait.png",kind:"Doodad"},{slug:"desert-wall-2",name:"Desert Wall 2",original:"540100ba794c1a8b4d328437",portraitURL:"/file/db/thang.type/540100ba794c1a8b4d328437/portrait.png",kind:"Doodad"},{slug:"desert-wall-3",name:"Desert Wall 3",original:"53f4e7fff7bc7336054dcf64",portraitURL:"/file/db/thang.type/53f4e7fff7bc7336054dcf64/portrait.png",kind:"Doodad"},{slug:"desert-wall-4",name:"Desert Wall 4",original:"53f3ef04e7a7643005c0f4a1",portraitURL:"/file/db/thang.type/53f3ef04e7a7643005c0f4a1/portrait.png",kind:"Doodad"},{slug:"desert-wall-5",name:"Desert Wall 5",original:"53ebafdd1a100989a40ce479",portraitURL:"/file/db/thang.type/53ebafdd1a100989a40ce479/portrait.png",kind:"Doodad"},{slug:"desert-wall-6",name:"Desert Wall 6",original:"53eb989b1a100989a40ce46a",portraitURL:"/file/db/thang.type/53eb989b1a100989a40ce46a/portrait.png",kind:"Doodad"},{slug:"desert-wall-7",name:"Desert Wall 7",original:"53eaa7de786ccc3405a9f2a4",portraitURL:"/file/db/thang.type/53eaa7de786ccc3405a9f2a4/portrait.png",kind:"Doodad"},{slug:"desert-wall-8",name:"Desert Wall 8",original:"53eaa6f6ef27b33605514a64",portraitURL:"/file/db/thang.type/53eaa6f6ef27b33605514a64/portrait.png",kind:"Doodad"},{slug:"desert-well",name:"Desert Well",original:"548cf4880f559d0000be7e53",portraitURL:"/file/db/thang.type/548cf4880f559d0000be7e53/portrait.png",kind:"Doodad"},{slug:"destroyed-human-tower",name:"destroyed human tower",original:"57867e5acca8994b002702a9",portraitURL:"/file/db/thang.type/57867e5acca8994b002702a9/portrait.png",kind:"Doodad"},{slug:"destroyed-human-tower-with-trees",name:"destroyed human tower with trees",original:"572d5abed7787fc300d85964",portraitURL:"/file/db/thang.type/572d5abed7787fc300d85964/portrait.png",kind:"Doodad"},{slug:"destroyed-human-tower-with-trees-2",name:"destroyed human tower with trees 2",original:"572d5b42d7787fc300d8596f",portraitURL:"/file/db/thang.type/572d5b42d7787fc300d8596f/portrait.png",kind:"Doodad"},{slug:"destroyed-ogre-tower-footing",name:"destroyed ogre tower footing",original:"578680980d397a2e0026eff9",portraitURL:"/file/db/thang.type/578680980d397a2e0026eff9/portrait.png",kind:"Doodad"},{slug:"diamond-sense-stone",name:"Diamond Sense Stone",original:"546934b7a2b1f53ce79443e1",portraitURL:"/file/db/thang.type/546934b7a2b1f53ce79443e1/portrait.png",kind:"Item"},{slug:"dirt-path-1",name:"Dirt Path 1",original:"5302acfd27471514685d5fd4",portraitURL:"/file/db/thang.type/5302acfd27471514685d5fd4/portrait.png",kind:"Floor"},{slug:"disintegrate",name:"Disintegrate",original:"54d2bb1abb157252059b1d29",portraitURL:"/file/db/thang.type/54d2bb1abb157252059b1d29/portrait.png",kind:"Mark"},{slug:"dispel",name:"Dispel",original:"55c2807d3767fd3435eb4465",portraitURL:"/file/db/thang.type/55c2807d3767fd3435eb4465/portrait.png",kind:"Mark"},{slug:"dragonscale-chainmail-coif",name:"Dragonscale Chainmail Coif",original:"546d477d9df4a17d0d449a6b",portraitURL:"/file/db/thang.type/546d477d9df4a17d0d449a6b/portrait.png",kind:"Item"},{slug:"dragonscale-chainmail-tunic",name:"Dragonscale Chainmail Tunic",original:"546d3d149df4a17d0d449a43",portraitURL:"/file/db/thang.type/546d3d149df4a17d0d449a43/portrait.png",kind:"Item"},{slug:"dragontooth",name:"Dragontooth",original:"54eb51d349fa2d5c905ddf0e",portraitURL:"/file/db/thang.type/54eb51d349fa2d5c905ddf0e/portrait.png",kind:"Item"},{slug:"drain-life",name:"Drain Life",original:"54d2bc5b4e4a08550556da55",portraitURL:"/file/db/thang.type/54d2bc5b4e4a08550556da55/portrait.png",kind:"Mark"},{slug:"dread-door-background",name:"Dread Door Background",original:"572e46a3f8c4f9b601ede6c0",portraitURL:"/file/db/thang.type/572e46a3f8c4f9b601ede6c0/portrait.png",kind:"Floor"},{slug:"dueling-grounds-background",name:"Dueling Grounds Background",original:"572e5163e8db5195014848b3",portraitURL:"/file/db/thang.type/572e5163e8db5195014848b3/portrait.png",kind:"Floor"},{slug:"dunes",name:"Dunes",original:"546e251d9df4a17d0d449bd1",portraitURL:"/file/db/thang.type/546e251d9df4a17d0d449bd1/portrait.png",kind:"Doodad"},{slug:"dungeon-door",name:"Dungeon Door",original:"52a0e5123abf480000000001",portraitURL:"/file/db/thang.type/52a0e5123abf480000000001/portrait.png",kind:"Doodad"},{slug:"dungeon-entrance",name:"Dungeon Entrance",original:"544d850e8494308424f564dd",portraitURL:"/file/db/thang.type/544d850e8494308424f564dd/portrait.png",kind:"Doodad"},{slug:"dungeon-floor",name:"Dungeon Floor",original:"52af688f6320a8049d000001",portraitURL:"/file/db/thang.type/52af688f6320a8049d000001/portrait.png",kind:"Floor"},{slug:"dungeon-pillar",name:"Dungeon Pillar",original:"543ea0ff9692aa00006208e7",portraitURL:"/file/db/thang.type/543ea0ff9692aa00006208e7/portrait.png",kind:"Doodad"},{slug:"dungeon-pit",name:"Dungeon Pit",original:"52b09408ccbc671372000002",portraitURL:"/file/db/thang.type/52b09408ccbc671372000002/portrait.png",kind:"Floor"},{slug:"dungeon-rock-1",name:"Dungeon Rock 1",original:"54ef944764112781056c1f96",portraitURL:"/file/db/thang.type/54ef944764112781056c1f96/portrait.png",kind:"Doodad"},{slug:"dungeon-rock-2",name:"Dungeon Rock 2",original:"54ef99bf223edd8105b00eaa",portraitURL:"/file/db/thang.type/54ef99bf223edd8105b00eaa/portrait.png",kind:"Doodad"},{slug:"dungeon-rock-3",name:"Dungeon Rock 3",original:"54ef9af5b4740779058448c6",portraitURL:"/file/db/thang.type/54ef9af5b4740779058448c6/portrait.png",kind:"Doodad"},{slug:"dungeon-rock-4",name:"Dungeon Rock 4",original:"54ef9c26933e1e7b0584663e",portraitURL:"/file/db/thang.type/54ef9c26933e1e7b0584663e/portrait.png",kind:"Doodad"},{slug:"dungeon-rock-5",name:"Dungeon Rock 5",original:"54ef9d376aea7d7805535cc8",portraitURL:"/file/db/thang.type/54ef9d376aea7d7805535cc8/portrait.png",kind:"Doodad"},{slug:"dungeon-rock-group",name:"Dungeon Rock Group",original:"54ef9e0583b08b7d054ba331",portraitURL:"/file/db/thang.type/54ef9e0583b08b7d054ba331/portrait.png",kind:"Doodad"},{slug:"dungeon-stairs-horizontal",name:"Dungeon Stairs Horizontal",original:"5463dc27c295cc4fb9c06257",portraitURL:"/file/db/thang.type/5463dc27c295cc4fb9c06257/portrait.png",kind:"Doodad"},{slug:"dungeon-stairs-vertical",name:"Dungeon Stairs Vertical",original:"5463d8a0c295cc4fb9c06255",portraitURL:"/file/db/thang.type/5463d8a0c295cc4fb9c06255/portrait.png",kind:"Doodad"},{slug:"dungeon-wall",name:"Dungeon Wall",original:"529e7aecc423d4e83b000004",portraitURL:"/file/db/thang.type/529e7aecc423d4e83b000004/portrait.png",kind:"Wall"},{slug:"dungeons-of-kgard-background",name:"Dungeons of Kgard Background",original:"563d3c02f5b71e8405fabff8",portraitURL:"/file/db/thang.type/563d3c02f5b71e8405fabff8/portrait.png",kind:"Floor"},{slug:"dynamic-flags",name:"Dynamic Flags",original:"5478b9068707a2c3a2493b2b",portraitURL:"/file/db/thang.type/5478b9068707a2c3a2493b2b/portrait.png",kind:"Item"},{slug:"earthskin",name:"Earthskin",original:"54d2bcf66ec7cf53051e7855",portraitURL:"/file/db/thang.type/54d2bcf66ec7cf53051e7855/portrait.png",kind:"Mark"},{slug:"east-mounted-camera-facing-east-west",name:"east mounted camera facing east west",original:"56f183091e1daf0a016c670b",portraitURL:"/file/db/thang.type/56f183091e1daf0a016c670b/portrait.png",kind:"Doodad"},{slug:"east-mounted-camera-facing-north",name:"east mounted camera facing north",original:"56f1782541c1a0cb00f8d66c",portraitURL:"/file/db/thang.type/56f1782541c1a0cb00f8d66c/portrait.png",kind:"Doodad"},{slug:"east-mounted-camera-facing-south",name:"east mounted camera facing south",original:"56f1811841c1a0cb00f8ddb1",portraitURL:"/file/db/thang.type/56f1811841c1a0cb00f8ddb1/portrait.png",kind:"Doodad"},{slug:"edge-of-darkness",name:"Edge of Darkness",original:"54eaa8762b7506e891ca71a9",portraitURL:"/file/db/thang.type/54eaa8762b7506e891ca71a9/portrait.png",kind:"Item"},{slug:"eldritch-icicle",name:"Eldritch Icicle",original:"54ea311e2b7506e891ca70b0",portraitURL:"/file/db/thang.type/54ea311e2b7506e891ca70b0/portrait.png",kind:"Item"},{slug:"electrocute",name:"Electrocute",original:"55c281263767fd3435eb4469",portraitURL:"/file/db/thang.type/55c281263767fd3435eb4469/portrait.png",kind:"Mark"},{slug:"electrowall",name:"Electrowall",original:"54177e26571f116c0b1f00c0",portraitURL:"/file/db/thang.type/54177e26571f116c0b1f00c0/portrait.png",kind:"Doodad"},{slug:"elemental-codex-i",name:"Elemental Codex I",original:"5463755a3839c6e02811d30a",portraitURL:"/file/db/thang.type/5463755a3839c6e02811d30a/portrait.png",kind:"Item"},{slug:"elemental-codex-ii",name:"Elemental Codex II",original:"546375783839c6e02811d30d",portraitURL:"/file/db/thang.type/546375783839c6e02811d30d/portrait.png",kind:"Item"},{slug:"elemental-codex-iii",name:"Elemental Codex III",original:"5463759c3839c6e02811d310",portraitURL:"/file/db/thang.type/5463759c3839c6e02811d310/portrait.png",kind:"Item"},{slug:"elemental-codex-iv",name:"Elemental Codex IV",original:"546376bf3839c6e02811d31c",portraitURL:"/file/db/thang.type/546376bf3839c6e02811d31c/portrait.png",kind:"Item"},{slug:"elemental-codex-v",name:"Elemental Codex V",original:"546376e23839c6e02811d31f",portraitURL:"/file/db/thang.type/546376e23839c6e02811d31f/portrait.png",kind:"Item"},{slug:"embroidered-griffin-wool-hat",name:"Embroidered Griffin Wool Hat",original:"546d4ca19df4a17d0d449abf",portraitURL:"/file/db/thang.type/546d4ca19df4a17d0d449abf/portrait.png",kind:"Item"},{slug:"embroidered-griffin-wool-robe",name:"Embroidered Griffin Wool Robe",original:"546d4a549df4a17d0d449a97",portraitURL:"/file/db/thang.type/546d4a549df4a17d0d449a97/portrait.png",kind:"Item"},{slug:"emerald-chainmail-coif",name:"Emerald Chainmail Coif",original:"546d46cf9df4a17d0d449a63",portraitURL:"/file/db/thang.type/546d46cf9df4a17d0d449a63/portrait.png",kind:"Item"},{slug:"emerald-chainmail-tunic",name:"Emerald Chainmail Tunic",original:"546d3c8d9df4a17d0d449a3b",portraitURL:"/file/db/thang.type/546d3c8d9df4a17d0d449a3b/portrait.png",kind:"Item"},{slug:"emperors-gloves",name:"Emperor's Gloves",original:"546949aca2b1f53ce7944431",portraitURL:"/file/db/thang.type/546949aca2b1f53ce7944431/portrait.png",kind:"Item"},{slug:"enameled-dragonplate",name:"Enameled Dragonplate",original:"546ab1e53777d61863292876",portraitURL:"/file/db/thang.type/546ab1e53777d61863292876/portrait.png",kind:"Item"},{slug:"enameled-dragonplate-helmet",name:"Enameled Dragonplate Helmet",original:"546d3a539df4a17d0d449a1f",portraitURL:"/file/db/thang.type/546d3a539df4a17d0d449a1f/portrait.png",kind:"Item"},{slug:"enameled-dragonshield",name:"Enameled Dragonshield",original:"54eabf022b7506e891ca7236",portraitURL:"/file/db/thang.type/54eabf022b7506e891ca7236/portrait.png",kind:"Item"},{slug:"enchanted-lambswool-cloak",name:"Enchanted Lambswool Cloak",original:"546d49109df4a17d0d449a7f",portraitURL:"/file/db/thang.type/546d49109df4a17d0d449a7f/portrait.png",kind:"Item"},{slug:"enchanted-lenses",name:"Enchanted Lenses",original:"546941cba2b1f53ce7944419",portraitURL:"/file/db/thang.type/546941cba2b1f53ce7944419/portrait.png",kind:"Item"},{slug:"enchanted-stick",name:"Enchanted Stick",original:"544d87188494308424f564f1",portraitURL:"/file/db/thang.type/544d87188494308424f564f1/portrait.png",kind:"Item"},{slug:"enemy-mine-background",name:"Enemy Mine Background",original:"563cdd340b2c7c87054e102b",portraitURL:"/file/db/thang.type/563cdd340b2c7c87054e102b/portrait.png",kind:"Floor"},{slug:"energy-ball",name:"Energy Ball",original:"53025d83222f73867774d8ed",portraitURL:"/file/db/thang.type/53025d83222f73867774d8ed/portrait.png",kind:"Missile"},{slug:"energy-ball-diet",name:"Energy Ball Diet",original:"531a6ddf1ddc910545d5e96d",portraitURL:"/file/db/thang.type/531a6ddf1ddc910545d5e96d/portrait.png",kind:"Missile"},{slug:"enforcer",name:"Enforcer",original:"56d0ca1263103d2a00af5331",portraitURL:"/file/db/thang.type/56d0ca1263103d2a00af5331/portrait.png",kind:"Unit"},{slug:"engraved-builders-hammer",name:"Engraved Builder's Hammer",original:"54694ca7a2b1f53ce7944462",portraitURL:"/file/db/thang.type/54694ca7a2b1f53ce7944462/portrait.png",kind:"Item"},{slug:"engraved-obsidian-breastplate",name:"Engraved Obsidian Breastplate",original:"546ab15e3777d6186329286e",portraitURL:"/file/db/thang.type/546ab15e3777d6186329286e/portrait.png",kind:"Item"},{slug:"engraved-obsidian-helmet",name:"Engraved Obsidian Helmet",original:"546d39d89df4a17d0d449a17",portraitURL:"/file/db/thang.type/546d39d89df4a17d0d449a17/portrait.png",kind:"Item"},{slug:"engraved-obsidian-shield",name:"Engraved Obsidian Shield",original:"54eabbd22b7506e891ca721e",portraitURL:"/file/db/thang.type/54eabbd22b7506e891ca721e/portrait.png",kind:"Item"},{slug:"engraved-wristwatch",name:"Engraved Wristwatch",original:"546937dea2b1f53ce79443ed",portraitURL:"/file/db/thang.type/546937dea2b1f53ce79443ed/portrait.png",kind:"Item"},{slug:"explosive-potion",name:"Explosive Potion",original:"5466d9a5417c8b48a9811e8e",portraitURL:"/file/db/thang.type/5466d9a5417c8b48a9811e8e/portrait.png",kind:"Missile"},{slug:"ezeroths-timepiece",name:"Ezeroth's Timepiece",original:"546938cea2b1f53ce79443f5",portraitURL:"/file/db/thang.type/546938cea2b1f53ce79443f5/portrait.png",kind:"Item"},{slug:"farm",name:"Farm",original:"52ea853d427172ae56003494",portraitURL:"/file/db/thang.type/52ea853d427172ae56003494/portrait.png",kind:"Doodad"},{slug:"faux-fur-hat",name:"Faux Fur Hat",original:"5441c2be4e9aeb727cc97105",portraitURL:"/file/db/thang.type/5441c2be4e9aeb727cc97105/portrait.png",kind:"Item"},{slug:"fear",name:"Fear",original:"53024db827471514685d53b2",portraitURL:"/file/db/thang.type/53024db827471514685d53b2/portrait.png",kind:"Mark"},{slug:"fence",name:"Fence",original:"5421bc5218adb78d98d265e8",portraitURL:"/file/db/thang.type/5421bc5218adb78d98d265e8/portrait.png",kind:"Doodad"},{slug:"fence-wall",name:"Fence Wall",original:"54349179a4cc5c900efa4814",portraitURL:"/file/db/thang.type/54349179a4cc5c900efa4814/portrait.png",kind:"Doodad"},{slug:"filing-cabinet",name:"Filing Cabinet",original:"52e9fa73427172ae56002593",portraitURL:"/file/db/thang.type/52e9fa73427172ae56002593/portrait.png",kind:"Doodad"},{slug:"fine-boots",name:"Fine Boots",original:"53e2388e53457600003e3f09",portraitURL:"/file/db/thang.type/53e2388e53457600003e3f09/portrait.png",kind:"Item"},{slug:"fine-leather-chainmail-coif",name:"Fine Leather Chainmail Coif",original:"546d455f9df4a17d0d449a4f",portraitURL:"/file/db/thang.type/546d455f9df4a17d0d449a4f/portrait.png",kind:"Item"},{slug:"fine-leather-chainmail-tunic",name:"Fine Leather Chainmail Tunic",original:"546d3b129df4a17d0d449a27",portraitURL:"/file/db/thang.type/546d3b129df4a17d0d449a27/portrait.png",kind:"Item"},{slug:"fine-stone-builders-hammer",name:"Fine Stone Builder's Hammer",original:"54694c44a2b1f53ce794445a",portraitURL:"/file/db/thang.type/54694c44a2b1f53ce794445a/portrait.png",kind:"Item"},{slug:"fine-telephoto-glasses",name:"Fine Telephoto Glasses",original:"54694194a2b1f53ce7944415",portraitURL:"/file/db/thang.type/54694194a2b1f53ce7944415/portrait.png",kind:"Item"},{slug:"fine-wooden-glasses",name:"Fine Wooden Glasses",original:"5469405ba2b1f53ce7944404",portraitURL:"/file/db/thang.type/5469405ba2b1f53ce7944404/portrait.png",kind:"Item"},{slug:"fir-tree-1",name:"Fir Tree 1",original:"54e9503df54ef5794f354ec1",portraitURL:"/file/db/thang.type/54e9503df54ef5794f354ec1/portrait.png",kind:"Doodad"},{slug:"fir-tree-2",name:"Fir Tree 2",original:"54e95107f54ef5794f354ec5",portraitURL:"/file/db/thang.type/54e95107f54ef5794f354ec5/portrait.png",kind:"Doodad"},{slug:"fir-tree-3",name:"Fir Tree 3",original:"54e9513ff54ef5794f354ec9",portraitURL:"/file/db/thang.type/54e9513ff54ef5794f354ec9/portrait.png",kind:"Doodad"},{slug:"fir-tree-4",name:"Fir Tree 4",original:"54e9518df54ef5794f354ecd",portraitURL:"/file/db/thang.type/54e9518df54ef5794f354ecd/portrait.png",kind:"Doodad"},{slug:"fire",name:"Fire",original:"54d2bdea4e4a08550556dbfe",portraitURL:"/file/db/thang.type/54d2bdea4e4a08550556dbfe/portrait.png",kind:"Mark"},{slug:"fire-dancing-background",name:"Fire Dancing Background",original:"576ad6ab7e64f325002df2e4",portraitURL:"/file/db/thang.type/576ad6ab7e64f325002df2e4/portrait.png",kind:"Floor"},{slug:"fire-opal-sense-stone",name:"Fire Opal Sense Stone",original:"546932e4a2b1f53ce79443cd",portraitURL:"/file/db/thang.type/546932e4a2b1f53ce79443cd/portrait.png",kind:"Item"},{slug:"fire-trap",name:"Fire Trap",original:"5449536afb56d566e86972ba",portraitURL:"/file/db/thang.type/5449536afb56d566e86972ba/portrait.png",kind:"Misc"},{slug:"fireball",name:"Fireball",original:"531a6a2f1ddc910545d5e944",portraitURL:"/file/db/thang.type/531a6a2f1ddc910545d5e944/portrait.png",kind:"Missile"},{slug:"firewall",name:"firewall",original:"56f56687db0216900f086ac1",portraitURL:"/file/db/thang.type/56f56687db0216900f086ac1/portrait.png",kind:"Doodad"},{slug:"firewood-1",name:"Firewood 1",original:"52e953d0427172ae5600181d",portraitURL:"/file/db/thang.type/52e953d0427172ae5600181d/portrait.png",kind:"Doodad"},{slug:"firewood-2",name:"Firewood 2",original:"52e9575d22efc8e7090016ed",portraitURL:"/file/db/thang.type/52e9575d22efc8e7090016ed/portrait.png",kind:"Doodad"},{slug:"firewood-3",name:"Firewood 3",original:"52e957ec22efc8e7090016fd",portraitURL:"/file/db/thang.type/52e957ec22efc8e7090016fd/portrait.png",kind:"Doodad"},{slug:"firn-1",name:"Firn 1",original:"557639fa1e82182d9e68894d",portraitURL:"/file/db/thang.type/557639fa1e82182d9e68894d/portrait.png",kind:"Floor"},{slug:"firn-2",name:"Firn 2",original:"55763a971e82182d9e688951",portraitURL:"/file/db/thang.type/55763a971e82182d9e688951/portrait.png",kind:"Floor"},{slug:"firn-3",name:"Firn 3",original:"55763ab51e82182d9e688955",portraitURL:"/file/db/thang.type/55763ab51e82182d9e688955/portrait.png",kind:"Floor"},{slug:"firn-4",name:"Firn 4",original:"55763ad11e82182d9e688959",portraitURL:"/file/db/thang.type/55763ad11e82182d9e688959/portrait.png",kind:"Floor"},{slug:"firn-5",name:"Firn 5",original:"55763aea1e82182d9e68895d",portraitURL:"/file/db/thang.type/55763aea1e82182d9e68895d/portrait.png",kind:"Floor"},{slug:"firn-6",name:"Firn 6",original:"55763b111e82182d9e688961",portraitURL:"/file/db/thang.type/55763b111e82182d9e688961/portrait.png",kind:"Floor"},{slug:"firn-cliff",name:"Firn Cliff",original:"55c277983767fd3435eb444e",portraitURL:"/file/db/thang.type/55c277983767fd3435eb444e/portrait.png",kind:"Floor"},{slug:"flame-armor",name:"Flame Armor",original:"55c27b5c3767fd3435eb445a",portraitURL:"/file/db/thang.type/55c27b5c3767fd3435eb445a/portrait.png",kind:"Mark"},{slug:"flaming-shell",name:"Flaming Shell",original:"553e80669bdea5d00f1fd90e",portraitURL:"/file/db/thang.type/553e80669bdea5d00f1fd90e/portrait.png",kind:"Missile"},{slug:"flippable-land",name:"Flippable Land",original:"53a20126610a6b3505568163",portraitURL:"/file/db/thang.type/53a20126610a6b3505568163/portrait.png",kind:"Floor"},{slug:"floppy-lambswool-hat",name:"Floppy Lambswool Hat",original:"546d4b069df4a17d0d449aa3",portraitURL:"/file/db/thang.type/546d4b069df4a17d0d449aa3/portrait.png",kind:"Item"},{slug:"force-bolt",name:"Force Bolt",original:"5467807c417c8b48a9811efd",portraitURL:"/file/db/thang.type/5467807c417c8b48a9811efd/portrait.png",kind:"Missile"},{slug:"forest-river-tile-deadend",name:"Forest River tile deadend",original:"577d5b367e0491260074b95b",portraitURL:"/file/db/thang.type/577d5b367e0491260074b95b/portrait.png",kind:"undefined"},{slug:"forest-river-tile-full-intersection",name:"forest river tile full intersection",original:"5786badaa6c6413500926209",portraitURL:"/file/db/thang.type/5786badaa6c6413500926209/portrait.png",kind:"undefined"},{slug:"forest-river-tile-straight",name:"forest river tile straight",original:"577d58d5dbf35b24001b91cb",portraitURL:"/file/db/thang.type/577d58d5dbf35b24001b91cb/portrait.png",kind:"undefined"},{slug:"forest-river-tile-t-intersection",name:"Forest River tile t intersection",original:"577d5b927e0491260074ba3a",portraitURL:"/file/db/thang.type/577d5b927e0491260074ba3a/portrait.png",kind:"undefined"},{slug:"forest-river-tile-turn",name:"Forest River tile turn",original:"577d59e37e0491260074b5bd",portraitURL:"/file/db/thang.type/577d59e37e0491260074b5bd/portrait.png",kind:"undefined"},{slug:"forgetful-gemsmith-background",name:"Forgetful Gemsmith Background",original:"562a9b9ea4cdd48805fb98ca",portraitURL:"/file/db/thang.type/562a9b9ea4cdd48805fb98ca/portrait.png",kind:"Floor"},{slug:"forgotten-bronze-ring",name:"Forgotten Bronze Ring",original:"54692d8aa2b1f53ce7944397",portraitURL:"/file/db/thang.type/54692d8aa2b1f53ce7944397/portrait.png",kind:"Item"},{slug:"frog",name:"Frog",original:"57869cf7bd31c14400834028",portraitURL:"/file/db/thang.type/57869cf7bd31c14400834028/portrait.png",kind:"Item"},{slug:"frog-pet",name:"Frog Pet",original:"540f3678821af8000097dc56",portraitURL:"/file/db/thang.type/540f3678821af8000097dc56/portrait.png",kind:"Unit"},{slug:"gargoyle",name:"Gargoyle",original:"52afc8f0c5b1813ec2000008",portraitURL:"/file/db/thang.type/52afc8f0c5b1813ec2000008/portrait.png",kind:"Doodad"},{slug:"gargoyle-side",name:"Gargoyle Side",original:"54efa07f4bb4788505d2339e",portraitURL:"/file/db/thang.type/54efa07f4bb4788505d2339e/portrait.png",kind:"Doodad"},{slug:"gauntlets-of-strength",name:"Gauntlets of Strength",original:"53e2202953457600003e3ed9",portraitURL:"/file/db/thang.type/53e2202953457600003e3ed9/portrait.png",kind:"Item"},{slug:"gem-pile-medium",name:"Gem Pile Medium",original:"543306638364d30000d1f951",portraitURL:"/file/db/thang.type/543306638364d30000d1f951/portrait.png",kind:"Misc"},{slug:"gem-pile-small",name:"Gem Pile Small",original:"543305f78364d30000d1f94a",portraitURL:"/file/db/thang.type/543305f78364d30000d1f94a/portrait.png",kind:"Misc"},{slug:"gems-of-the-deep-background",name:"Gems of the Deep Background",original:"563aa55276289f86054a7c02",portraitURL:"/file/db/thang.type/563aa55276289f86054a7c02/portrait.png",kind:"Floor"},{slug:"generic-armor-mark-1",name:"Generic Armor Mark 1",original:"54d2be25bb157252059b2202",portraitURL:"/file/db/thang.type/54d2be25bb157252059b2202/portrait.png",kind:"Mark"},{slug:"generic-armor-mark-2",name:"Generic Armor Mark 2",original:"54d2be9e3e16915505f0c7a4",portraitURL:"/file/db/thang.type/54d2be9e3e16915505f0c7a4/portrait.png",kind:"Mark"},{slug:"generic-item",name:"Generic Item",original:"545d3eb52d03e700001b5a5b",portraitURL:"/file/db/thang.type/545d3eb52d03e700001b5a5b/portrait.png",kind:"Item"},{slug:"gift-of-the-trees",name:"Gift of the Trees",original:"54eab0a32b7506e891ca71dd",portraitURL:"/file/db/thang.type/54eab0a32b7506e891ca71dd/portrait.png",kind:"Item"},{slug:"gilt-wristwatch",name:"Gilt Wristwatch",original:"54693830a2b1f53ce79443f1",portraitURL:"/file/db/thang.type/54693830a2b1f53ce79443f1/portrait.png",kind:"Item"},{slug:"glasses-doodad",name:"Glasses Doodad",original:"5420c4c5a0feb36ad21d45e2",portraitURL:"/file/db/thang.type/5420c4c5a0feb36ad21d45e2/portrait.png",kind:"Item"},{slug:"glitterbomb",name:"Glitterbomb",original:"54eb50f649fa2d5c905ddf0a",portraitURL:"/file/db/thang.type/54eb50f649fa2d5c905ddf0a/portrait.png",kind:"Item"},{slug:"goal-trigger",name:"Goal Trigger",original:"52bcbf0dce43b70000000006",portraitURL:"/file/db/thang.type/52bcbf0dce43b70000000006/portrait.png",kind:"Misc"},{slug:"gold-ball",name:"Gold Ball",original:"550b742b8a7d3c197a824dad",portraitURL:"/file/db/thang.type/550b742b8a7d3c197a824dad/portrait.png",kind:"Missile"},{slug:"gold-cloud",name:"Gold Cloud",original:"550b4b9d8a7d3c197a824d5e",portraitURL:"/file/db/thang.type/550b4b9d8a7d3c197a824d5e/portrait.png",kind:"Doodad"},{slug:"golden-wand",name:"Golden Wand",original:"54eab7f52b7506e891ca7202",portraitURL:"/file/db/thang.type/54eab7f52b7506e891ca7202/portrait.png",kind:"Item"},{slug:"goldspun-silk-cloak",name:"Goldspun Silk Cloak",original:"546d49da9df4a17d0d449a8f",portraitURL:"/file/db/thang.type/546d49da9df4a17d0d449a8f/portrait.png",kind:"Item"},{slug:"goldspun-silk-hat",name:"Goldspun Silk Hat",original:"546d4c249df4a17d0d449ab7",portraitURL:"/file/db/thang.type/546d4c249df4a17d0d449ab7/portrait.png",kind:"Item"},{slug:"grass-cliffs",name:"Grass Cliffs",original:"52bcb96ece43b70000000003",portraitURL:"/file/db/thang.type/52bcb96ece43b70000000003/portrait.png",kind:"Floor"},{slug:"grass01",name:"Grass01",original:"53016dddd82649ec2c0c9b29",portraitURL:"/file/db/thang.type/53016dddd82649ec2c0c9b29/portrait.png",kind:"Floor"},{slug:"grass02",name:"Grass02",original:"53016fc098f2ca1f6e82eebd",portraitURL:"/file/db/thang.type/53016fc098f2ca1f6e82eebd/portrait.png",kind:"Floor"},{slug:"grass03",name:"Grass03",original:"5301702d98f2ca1f6e82eec4",portraitURL:"/file/db/thang.type/5301702d98f2ca1f6e82eec4/portrait.png",kind:"Floor"},{slug:"grass04",name:"Grass04",original:"530170a198f2ca1f6e82eecf",portraitURL:"/file/db/thang.type/530170a198f2ca1f6e82eecf/portrait.png",kind:"Floor"},{slug:"grass05",name:"Grass05",original:"5301716398f2ca1f6e82eedc",portraitURL:"/file/db/thang.type/5301716398f2ca1f6e82eedc/portrait.png",kind:"Floor"},{slug:"gravestone-cross",name:"Gravestone Cross",original:"54f1100e8d380d7f05acc975",portraitURL:"/file/db/thang.type/54f1100e8d380d7f05acc975/portrait.png",kind:"Doodad"},{slug:"gravestone-rounded",name:"Gravestone Rounded",original:"54f110e3f854c97a05551616",portraitURL:"/file/db/thang.type/54f110e3f854c97a05551616/portrait.png",kind:"Doodad"},{slug:"gravestone-square",name:"Gravestone Square",original:"54f10f08d2969f8405ef51fd",portraitURL:"/file/db/thang.type/54f10f08d2969f8405ef51fd/portrait.png",kind:"Doodad"},{slug:"graveyard-fence",name:"Graveyard Fence",original:"54f111b379054c8705757747",portraitURL:"/file/db/thang.type/54f111b379054c8705757747/portrait.png",kind:"Doodad"},{slug:"great-sword",name:"Great Sword",original:"544d7f8d8494308424f564bf",portraitURL:"/file/db/thang.type/544d7f8d8494308424f564bf/portrait.png",kind:"Item"},{slug:"greed-background",name:"Greed Background",original:"53764e4ea7b5ab3805f153a4",portraitURL:"/file/db/thang.type/53764e4ea7b5ab3805f153a4/portrait.png",kind:"Floor"},{slug:"green-bubble-missile",name:"Green Bubble Missile",original:"540e35a34f21cd879ba4f140",portraitURL:"/file/db/thang.type/540e35a34f21cd879ba4f140/portrait.png",kind:"Missile"},{slug:"griffin-rider",name:"Griffin Rider",original:"52d45d1ab10ae4b024000002",portraitURL:"/file/db/thang.type/52d45d1ab10ae4b024000002/portrait.png",kind:"Unit"},{slug:"griffin-wool-hat",name:"Griffin Wool Hat",original:"546d4c699df4a17d0d449abb",portraitURL:"/file/db/thang.type/546d4c699df4a17d0d449abb/portrait.png",kind:"Item"},{slug:"griffin-wool-robe",name:"Griffin Wool Robe",original:"546d4a159df4a17d0d449a93",portraitURL:"/file/db/thang.type/546d4a159df4a17d0d449a93/portrait.png",kind:"Item"},{slug:"hand-sewn-linen-wizards-hat",name:"Hand-sewn Linen Wizard's Hat",original:"546d4bec9df4a17d0d449ab3",portraitURL:"/file/db/thang.type/546d4bec9df4a17d0d449ab3/portrait.png",kind:"Item"},{slug:"hardened-emerald-chainmail-coif",name:"Hardened Emerald Chainmail Coif",original:"546d47159df4a17d0d449a67",portraitURL:"/file/db/thang.type/546d47159df4a17d0d449a67/portrait.png",kind:"Item"},{slug:"hardened-emerald-chainmail-tunic",name:"Hardened Emerald Chainmail Tunic",original:"546d3cce9df4a17d0d449a3f",portraitURL:"/file/db/thang.type/546d3cce9df4a17d0d449a3f/portrait.png",kind:"Item"},{slug:"hardened-steel-glasses",name:"Hardened Steel Glasses",original:"546940d8a2b1f53ce794440d",portraitURL:"/file/db/thang.type/546940d8a2b1f53ce794440d/portrait.png",kind:"Item"},{slug:"harrowland-background",name:"Harrowland Background",original:"572e51e3f8c4f9b601ede885",portraitURL:"/file/db/thang.type/572e51e3f8c4f9b601ede885/portrait.png",kind:"Floor"},{slug:"haste",name:"Haste",original:"530251cfa6efdd32359c53d5",portraitURL:"/file/db/thang.type/530251cfa6efdd32359c53d5/portrait.png",kind:"Mark"},{slug:"haunted-kithmaze-background",name:"Haunted Kithmaze Background",original:"569dd4f2b55fd82e0011b79b",portraitURL:"/file/db/thang.type/569dd4f2b55fd82e0011b79b/portrait.png",kind:"Floor"},{slug:"heal",name:"Heal",original:"55c63ebcef141c65665beb59",portraitURL:"/file/db/thang.type/55c63ebcef141c65665beb59/portrait.png",kind:"Mark"},{slug:"health-potion-large",name:"Health Potion Large",original:"52afc634c5b1813ec2000002",portraitURL:"/file/db/thang.type/52afc634c5b1813ec2000002/portrait.png",kind:"Misc"},{slug:"health-potion-medium",name:"Health Potion Medium",original:"52afc742c5b1813ec2000004",portraitURL:"/file/db/thang.type/52afc742c5b1813ec2000004/portrait.png",kind:"Misc"},{slug:"health-potion-small",name:"Health Potion Small",original:"52afc7b6c5b1813ec2000006",portraitURL:"/file/db/thang.type/52afc7b6c5b1813ec2000006/portrait.png",kind:"Misc"},{slug:"heavy-iron-breastplate",name:"Heavy Iron Breastplate",original:"546aaf1b3777d6186329285e",portraitURL:"/file/db/thang.type/546aaf1b3777d6186329285e/portrait.png",kind:"Item"},{slug:"heavy-iron-helmet",name:"Heavy Iron Helmet",original:"546d390b9df4a17d0d449a0b",portraitURL:"/file/db/thang.type/546d390b9df4a17d0d449a0b/portrait.png",kind:"Item"},{slug:"helmet-fall-1",name:"Helmet Fall 1",original:"53e2e3e66c59f5340504108f",portraitURL:"/file/db/thang.type/53e2e3e66c59f5340504108f/portrait.png",kind:"Doodad"},{slug:"hide",name:"Hide",original:"55c281e83767fd3435eb446d",portraitURL:"/file/db/thang.type/55c281e83767fd3435eb446d/portrait.png",kind:"Mark"},{slug:"highlight",name:"Highlight",original:"529f8fdbdacd325127000003",portraitURL:"/file/db/thang.type/529f8fdbdacd325127000003/portrait.png",kind:"Mark"},{slug:"holoball",name:"Holoball",original:"56d0fa8a087ee32400764bb8",portraitURL:"/file/db/thang.type/56d0fa8a087ee32400764bb8/portrait.png",kind:"Doodad"},{slug:"holy-sword",name:"Holy Sword",original:"53e21249b82921000051ce11",portraitURL:"/file/db/thang.type/53e21249b82921000051ce11/portrait.png",kind:"Item"},{slug:"house-1",name:"House 1",original:"52b095bbccbc671372000006",portraitURL:"/file/db/thang.type/52b095bbccbc671372000006/portrait.png",kind:"Doodad"},{slug:"house-2",name:"House 2",original:"52b09d35ccbc671372000009",portraitURL:"/file/db/thang.type/52b09d35ccbc671372000009/portrait.png",kind:"Doodad"},{slug:"house-3",name:"House 3",original:"52b09dd0ccbc67137200000b",portraitURL:"/file/db/thang.type/52b09dd0ccbc67137200000b/portrait.png",kind:"Doodad"},{slug:"house-4",name:"House 4",original:"52b09e2fccbc67137200000d",portraitURL:"/file/db/thang.type/52b09e2fccbc67137200000d/portrait.png",kind:"Doodad"},{slug:"hoverboard-stand",name:"Hoverboard Stand",original:"56c630aeed946a44004ff139",portraitURL:"/file/db/thang.type/56c630aeed946a44004ff139/portrait.png",kind:"Doodad"},{slug:"human-barracks",name:"Human Barracks",original:"530ce329ec5bdaba2a72a99c",portraitURL:"/file/db/thang.type/530ce329ec5bdaba2a72a99c/portrait.png",kind:"Unit"},{slug:"hunting-rifle",name:"Hunting Rifle",original:"544d82aa8494308424f564cf",portraitURL:"/file/db/thang.type/544d82aa8494308424f564cf/portrait.png",kind:"Item"},{slug:"ice-crystals-1",name:"Ice Crystals 1",original:"557639501e82182d9e688945",portraitURL:"/file/db/thang.type/557639501e82182d9e688945/portrait.png",kind:"Doodad"},{slug:"ice-crystals-2",name:"Ice Crystals 2",original:"557639b91e82182d9e688949",portraitURL:"/file/db/thang.type/557639b91e82182d9e688949/portrait.png",kind:"Doodad"},{slug:"ice-door",name:"Ice Door",original:"557f32b0b43ce0b15a91b16d",portraitURL:"/file/db/thang.type/557f32b0b43ce0b15a91b16d/portrait.png",kind:"Doodad"},{slug:"ice-gargoyle",name:"Ice Gargoyle",original:"55760d3f1e82182d9e6888f6",portraitURL:"/file/db/thang.type/55760d3f1e82182d9e6888f6/portrait.png",kind:"Doodad"},{slug:"ice-gargoyle-fore",name:"Ice Gargoyle Fore",original:"55760e311e82182d9e688902",portraitURL:"/file/db/thang.type/55760e311e82182d9e688902/portrait.png",kind:"Doodad"},{slug:"ice-gargoyle-ruin",name:"Ice Gargoyle Ruin",original:"55760dc31e82182d9e6888fa",portraitURL:"/file/db/thang.type/55760dc31e82182d9e6888fa/portrait.png",kind:"Doodad"},{slug:"ice-gargoyle-ruin-fore",name:"Ice Gargoyle Ruin Fore",original:"55760dfa1e82182d9e6888fe",portraitURL:"/file/db/thang.type/55760dfa1e82182d9e6888fe/portrait.png",kind:"Doodad"},{slug:"ice-rink-1",name:"Ice Rink 1",original:"557f321bb43ce0b15a91b161",portraitURL:"/file/db/thang.type/557f321bb43ce0b15a91b161/portrait.png",kind:"Floor"},{slug:"ice-rink-2",name:"Ice Rink 2",original:"557f325cb43ce0b15a91b165",portraitURL:"/file/db/thang.type/557f325cb43ce0b15a91b165/portrait.png",kind:"Floor"},{slug:"ice-rink-3",name:"Ice Rink 3",original:"557f3275b43ce0b15a91b169",portraitURL:"/file/db/thang.type/557f3275b43ce0b15a91b169/portrait.png",kind:"Floor"},{slug:"ice-tree-1",name:"Ice Tree 1",original:"557635641e82182d9e688929",portraitURL:"/file/db/thang.type/557635641e82182d9e688929/portrait.png",kind:"Doodad"},{slug:"ice-tree-2",name:"Ice Tree 2",original:"557636401e82182d9e68892d",portraitURL:"/file/db/thang.type/557636401e82182d9e68892d/portrait.png",kind:"Doodad"},{slug:"ice-tree-3",name:"Ice Tree 3",original:"557636e11e82182d9e688931",portraitURL:"/file/db/thang.type/557636e11e82182d9e688931/portrait.png",kind:"Doodad"},{slug:"ice-wall",name:"Ice Wall",original:"5575f002f3f8d13b4ee1e7fc",portraitURL:"/file/db/thang.type/5575f002f3f8d13b4ee1e7fc/portrait.png",kind:"Wall"},{slug:"ice-yak",name:"Ice Yak",original:"557f3917b43ce0b15a91b175",portraitURL:"/file/db/thang.type/557f3917b43ce0b15a91b175/portrait.png",kind:"Unit"},{slug:"igloo-1",name:"Igloo 1",original:"557608f61e82182d9e6888cf",portraitURL:"/file/db/thang.type/557608f61e82182d9e6888cf/portrait.png",kind:"Doodad"},{slug:"igloo-2",name:"Igloo 2",original:"557609b01e82182d9e6888d3",portraitURL:"/file/db/thang.type/557609b01e82182d9e6888d3/portrait.png",kind:"Doodad"},{slug:"igloo-3",name:"Igloo 3",original:"557609dd1e82182d9e6888d7",portraitURL:"/file/db/thang.type/557609dd1e82182d9e6888d7/portrait.png",kind:"Doodad"},{slug:"igloo-4",name:"Igloo 4",original:"55760a2c1e82182d9e6888db",portraitURL:"/file/db/thang.type/55760a2c1e82182d9e6888db/portrait.png",kind:"Doodad"},{slug:"impaling-firebolt",name:"Impaling Firebolt",original:"54f767c4b3e4927805021022",portraitURL:"/file/db/thang.type/54f767c4b3e4927805021022/portrait.png",kind:"Missile"},{slug:"importer-of-great-justice",name:"Importer of Great Justice",original:"54938575e9850ae3e8fbdd74",portraitURL:"/file/db/thang.type/54938575e9850ae3e8fbdd74/portrait.png",kind:"undefined"},{slug:"indoor-floor",name:"Indoor Floor",original:"52ead2b2207133f35c000833",portraitURL:"/file/db/thang.type/52ead2b2207133f35c000833/portrait.png",kind:"Floor"},{slug:"indoor-wall",name:"Indoor Wall",original:"52ea9a13d23f140d100000b2",portraitURL:"/file/db/thang.type/52ea9a13d23f140d100000b2/portrait.png",kind:"Wall"},{slug:"infantry-shield",name:"Infantry Shield",original:"544d7bb88494308424f56493",portraitURL:"/file/db/thang.type/544d7bb88494308424f56493/portrait.png",kind:"Item"},{slug:"invisible",name:"Invisible",original:"52b0f9c75c5c4af6bd000004",portraitURL:"/file/db/thang.type/52b0f9c75c5c4af6bd000004/portrait.png",kind:"Misc"},{slug:"iron-chainmail-coif",name:"Iron Chainmail Coif",original:"546d45c59df4a17d0d449a53",portraitURL:"/file/db/thang.type/546d45c59df4a17d0d449a53/portrait.png",kind:"Item"},{slug:"iron-chainmail-tunic",name:"Iron Chainmail Tunic",original:"546d3b7c9df4a17d0d449a2b",portraitURL:"/file/db/thang.type/546d3b7c9df4a17d0d449a2b/portrait.png",kind:"Item"},{slug:"iron-defender",name:"Iron Defender",original:"54eaabe62b7506e891ca71c9",portraitURL:"/file/db/thang.type/54eaabe62b7506e891ca71c9/portrait.png",kind:"Item"},{slug:"iron-link",name:"Iron Link",original:"54692d5ca2b1f53ce7944393",portraitURL:"/file/db/thang.type/54692d5ca2b1f53ce7944393/portrait.png",kind:"Item"},{slug:"iron-maiden",name:"Iron Maiden",original:"54ef9f0a83b08b7d054ba50d",portraitURL:"/file/db/thang.type/54ef9f0a83b08b7d054ba50d/portrait.png",kind:"Doodad"},{slug:"iron-shield",name:"Iron Shield",original:"5441c3f44e9aeb727cc97129",portraitURL:"/file/db/thang.type/5441c3f44e9aeb727cc97129/portrait.png",kind:"Item"},{slug:"kings-ring",name:"King's Ring",original:"54eb56df49fa2d5c905ddf2e",portraitURL:"/file/db/thang.type/54eb56df49fa2d5c905ddf2e/portrait.png",kind:"Item"},{slug:"kithgard-gates-background",name:"Kithgard Gates Background",original:"572e52b17a9c3e8101b8be0e",portraitURL:"/file/db/thang.type/572e52b17a9c3e8101b8be0e/portrait.png",kind:"Floor"},{slug:"kithgard-workers-glasses",name:"Kithgard Worker's Glasses",original:"53eb99f41a100989a40ce46e",portraitURL:"/file/db/thang.type/53eb99f41a100989a40ce46e/portrait.png",kind:"Item"},{slug:"kithsteel-blade",name:"Kithsteel Blade",original:"54eaa78a2b7506e891ca719d",portraitURL:"/file/db/thang.type/54eaa78a2b7506e891ca719d/portrait.png",kind:"Item"},{slug:"knightfire-charge",name:"Knightfire Charge",original:"544d96328494308424f56533",portraitURL:"/file/db/thang.type/544d96328494308424f56533/portrait.png",kind:"Item"},{slug:"knightfire-charge-missile",name:"Knightfire Charge Missile",original:"546297f1f44055a4b5e735bb",portraitURL:"/file/db/thang.type/546297f1f44055a4b5e735bb/portrait.png",kind:"Missile"},{slug:"known-enemy-background",name:"Known Enemy Background",original:"572e4e61b2088976012429eb",portraitURL:"/file/db/thang.type/572e4e61b2088976012429eb/portrait.png",kind:"Floor"},{slug:"koraths-promise",name:"Korath's Promise",original:"54eb575749fa2d5c905ddf3a",portraitURL:"/file/db/thang.type/54eb575749fa2d5c905ddf3a/portrait.png",kind:"Item"},{slug:"krummholz-1",name:"Krummholz 1",original:"54e953adf54ef5794f354ef1",portraitURL:"/file/db/thang.type/54e953adf54ef5794f354ef1/portrait.png",kind:"Doodad"},{slug:"krummholz-2",name:"Krummholz 2",original:"54e9545bf54ef5794f354ef5",portraitURL:"/file/db/thang.type/54e9545bf54ef5794f354ef5/portrait.png",kind:"Doodad"},{slug:"krummholz-3",name:"Krummholz 3",original:"54e95492f54ef5794f354ef9",portraitURL:"/file/db/thang.type/54e95492f54ef5794f354ef9/portrait.png",kind:"Doodad"},{slug:"lambswool-cloak",name:"Lambswool Cloak",original:"546d48ce9df4a17d0d449a7b",portraitURL:"/file/db/thang.type/546d48ce9df4a17d0d449a7b/portrait.png",kind:"Item"},{slug:"large-bolt-crossbow",name:"Large Bolt Crossbow",original:"544d80598494308424f564c7",portraitURL:"/file/db/thang.type/544d80598494308424f564c7/portrait.png",kind:"Item"},{slug:"large-classroom-viewscreen-off",name:"Large Classroom Viewscreen Off",original:"56c632c6abf4a61f009040b5",portraitURL:"/file/db/thang.type/56c632c6abf4a61f009040b5/portrait.png",kind:"Doodad"},{slug:"large-classroom-viewscreen-on",name:"Large Classroom Viewscreen On",original:"56eb28b267a0142000a36358",portraitURL:"/file/db/thang.type/56eb28b267a0142000a36358/portrait.png",kind:"Doodad"},{slug:"lava-grate",name:"Lava Grate",original:"54ef9fb8c1f3bd7c05941750",portraitURL:"/file/db/thang.type/54ef9fb8c1f3bd7c05941750/portrait.png",kind:"Doodad"},{slug:"leather-belt",name:"Leather Belt",original:"5437002a7beba4a82024a97d",portraitURL:"/file/db/thang.type/5437002a7beba4a82024a97d/portrait.png",kind:"Item"},{slug:"leather-boots",name:"Leather Boots",original:"53e2384453457600003e3f07",portraitURL:"/file/db/thang.type/53e2384453457600003e3f07/portrait.png",kind:"Item"},{slug:"leather-chainmail-coif",name:"Leather Chainmail Coif",original:"546d45089df4a17d0d449a4b",portraitURL:"/file/db/thang.type/546d45089df4a17d0d449a4b/portrait.png",kind:"Item"},{slug:"leather-chainmail-tunic",name:"Leather Chainmail Tunic",original:"546d3ab69df4a17d0d449a23",portraitURL:"/file/db/thang.type/546d3ab69df4a17d0d449a23/portrait.png",kind:"Item"},{slug:"leather-tunic",name:"Leather Tunic",original:"545d3cf22d03e700001b5a58",portraitURL:"/file/db/thang.type/545d3cf22d03e700001b5a58/portrait.png",kind:"Item"},{slug:"level-banner",name:"Level Banner",original:"5432c9688364d30000d1f935",portraitURL:"/file/db/thang.type/5432c9688364d30000d1f935/portrait.png",kind:"Misc"},{slug:"lightning-bolt",name:"Lightning Bolt",original:"54f3fa515fcc6a3950c7eabd",portraitURL:"/file/db/thang.type/54f3fa515fcc6a3950c7eabd/portrait.png",kind:"Missile"},{slug:"lightning-stick",name:"Lightning Stick",original:"544d86318494308424f564e8",portraitURL:"/file/db/thang.type/544d86318494308424f564e8/portrait.png",kind:"Item"},{slug:"lightning-twig",name:"Lightning Twig",original:"54eab1ec2b7506e891ca71e1",portraitURL:"/file/db/thang.type/54eab1ec2b7506e891ca71e1/portrait.png",kind:"Item"},{slug:"lightstone",name:"Lightstone",original:"54da20b7163110520551ed33",portraitURL:"/file/db/thang.type/54da20b7163110520551ed33/portrait.png",kind:"Misc"},{slug:"log-1",name:"Log 1",original:"54e954d7f54ef5794f354efd",portraitURL:"/file/db/thang.type/54e954d7f54ef5794f354efd/portrait.png",kind:"Doodad"},{slug:"log-2",name:"Log 2",original:"54e9553ef54ef5794f354f01",portraitURL:"/file/db/thang.type/54e9553ef54ef5794f354f01/portrait.png",kind:"Doodad"},{slug:"log-3",name:"Log 3",original:"54e9556af54ef5794f354f05",portraitURL:"/file/db/thang.type/54e9556af54ef5794f354f05/portrait.png",kind:"Doodad"},{slug:"long-sword",name:"Long Sword",original:"544d7d1f8494308424f564a3",portraitURL:"/file/db/thang.type/544d7d1f8494308424f564a3/portrait.png",kind:"Item"},{slug:"loop-da-loop-background",name:"Loop Da Loop Background",original:"56c67cba797353370060506d",portraitURL:"/file/db/thang.type/56c67cba797353370060506d/portrait.png",kind:"Floor"},{slug:"magic-missile",name:"Magic Missile",original:"5467beaf69d1ba0000fb91fb",portraitURL:"/file/db/thang.type/5467beaf69d1ba0000fb91fb/portrait.png",kind:"Missile"},{slug:"magnetize",name:"Magnetize",original:"55c6403eef141c65665beb5e",portraitURL:"/file/db/thang.type/55c6403eef141c65665beb5e/portrait.png",kind:"Mark"},{slug:"mahogany-glasses",name:"Mahogany Glasses",original:"54694093a2b1f53ce7944408",portraitURL:"/file/db/thang.type/54694093a2b1f53ce7944408/portrait.png",kind:"Item"},{slug:"mahogany-staff",name:"Mahogany Staff",original:"544d88158494308424f56501",portraitURL:"/file/db/thang.type/544d88158494308424f56501/portrait.png",kind:"Item"},{slug:"maka-test-wall",name:"maka-test-wall",original:"56a7d85fb679392600e31138",portraitURL:"/file/db/thang.type/56a7d85fb679392600e31138/portrait.png",kind:"Wall"},{slug:"market-stand",name:"Market Stand",original:"54f11600f854c97a055516da",portraitURL:"/file/db/thang.type/54f11600f854c97a055516da/portrait.png",kind:"Doodad"},{slug:"master-of-names-background",name:"Master of Names Background",original:"572e4ec2e8db519501484869",portraitURL:"/file/db/thang.type/572e4ec2e8db519501484869/portrait.png",kind:"Floor"},{slug:"master-sword",name:"Master Sword",original:"54ea89112b7506e891ca717d",portraitURL:"/file/db/thang.type/54ea89112b7506e891ca717d/portrait.png",kind:"Item"},{slug:"masters-flags",name:"Master's Flags",original:"5478b9be8707a2c3a2493b33",portraitURL:"/file/db/thang.type/5478b9be8707a2c3a2493b33/portrait.png",kind:"Item"},{slug:"mausoleum",name:"Mausoleum",original:"54f1128a25be5e8805837491",portraitURL:"/file/db/thang.type/54f1128a25be5e8805837491/portrait.png",kind:"Doodad"},{slug:"mayhem-background",name:"Mayhem Background",original:"572e5071e8db519501484896",portraitURL:"/file/db/thang.type/572e5071e8db519501484896/portrait.png",kind:"Floor"},{slug:"mcp",name:"mcp",original:"576322da0d81132500afdc8d",portraitURL:"/file/db/thang.type/576322da0d81132500afdc8d/portrait.png",kind:"Unit"},{slug:"megaphone",name:"Megaphone",original:"53e216ff53457600003e3eb7",portraitURL:"/file/db/thang.type/53e216ff53457600003e3eb7/portrait.png",kind:"Item"},{slug:"metal-builders-hammer",name:"Metal Builder's Hammer",original:"54694c79a2b1f53ce794445e",portraitURL:"/file/db/thang.type/54694c79a2b1f53ce794445e/portrait.png",kind:"Item"},{slug:"moonless-night",name:"Moonless Night",original:"54692f44a2b1f53ce79443b8",portraitURL:"/file/db/thang.type/54692f44a2b1f53ce79443b8/portrait.png",kind:"Item"},{slug:"moonlit-blade",name:"Moonlit Blade",original:"544d95a48494308424f56523",portraitURL:"/file/db/thang.type/544d95a48494308424f56523/portrait.png",kind:"Item"},{slug:"moonlit-blade-missile",name:"Moonlit Blade Missile",original:"544d97bc8494308424f5653c",portraitURL:"/file/db/thang.type/544d97bc8494308424f5653c/portrait.png",kind:"Missile"},{slug:"mornings-edge",name:"Morning's Edge",original:"54eaa69a2b7506e891ca7195",portraitURL:"/file/db/thang.type/54eaa69a2b7506e891ca7195/portrait.png",kind:"Item"},{slug:"mountain-1",name:"Mountain 1",original:"54e931d7970f0b0a263c03ef",portraitURL:"/file/db/thang.type/54e931d7970f0b0a263c03ef/portrait.png",kind:"Doodad"},{slug:"mountain-2",name:"Mountain 2",original:"54e9340b970f0b0a263c03f3",portraitURL:"/file/db/thang.type/54e9340b970f0b0a263c03f3/portrait.png",kind:"Doodad"},{slug:"mountain-3",name:"Mountain 3",original:"54e935d1970f0b0a263c03f7",portraitURL:"/file/db/thang.type/54e935d1970f0b0a263c03f7/portrait.png",kind:"Doodad"},{slug:"mountain-4",name:"Mountain 4",original:"54e9377e970f0b0a263c03fc",portraitURL:"/file/db/thang.type/54e9377e970f0b0a263c03fc/portrait.png",kind:"Doodad"},{slug:"mountain-lake-1",name:"Mountain Lake 1",original:"54e93f0ef54ef5794f354e99",portraitURL:"/file/db/thang.type/54e93f0ef54ef5794f354e99/portrait.png",kind:"Doodad"},{slug:"mountain-lake-2",name:"Mountain Lake 2",original:"54e94106f54ef5794f354ea3",portraitURL:"/file/db/thang.type/54e94106f54ef5794f354ea3/portrait.png",kind:"Doodad"},{slug:"mountain-shrub-1",name:"Mountain Shrub 1",original:"54e9567ff54ef5794f354f11",portraitURL:"/file/db/thang.type/54e9567ff54ef5794f354f11/portrait.png",kind:"Doodad"},{slug:"mountain-shrub-2",name:"Mountain Shrub 2",original:"54e956b7f54ef5794f354f15",portraitURL:"/file/db/thang.type/54e956b7f54ef5794f354f15/portrait.png",kind:"Doodad"},{slug:"mountain-shrub-3",name:"Mountain Shrub 3",original:"54e956def54ef5794f354f19",portraitURL:"/file/db/thang.type/54e956def54ef5794f354f19/portrait.png",kind:"Doodad"},{slug:"mountain-shrub-4",name:"Mountain Shrub 4",original:"54e95724f54ef5794f354f1d",portraitURL:"/file/db/thang.type/54e95724f54ef5794f354f1d/portrait.png",kind:"Doodad"},{slug:"mountain-tree-stand-1",name:"Mountain Tree Stand 1",original:"55c24e91dfc8d0b576e60a5e",portraitURL:"/file/db/thang.type/55c24e91dfc8d0b576e60a5e/portrait.png",kind:"Doodad"},{slug:"mountain-tree-stand-2",name:"Mountain Tree Stand 2",original:"55c25141dfc8d0b576e60a64",portraitURL:"/file/db/thang.type/55c25141dfc8d0b576e60a64/portrait.png",kind:"Doodad"},{slug:"mountain-tree-stand-3",name:"Mountain Tree Stand 3",original:"55c25173dfc8d0b576e60a6a",portraitURL:"/file/db/thang.type/55c25173dfc8d0b576e60a6a/portrait.png",kind:"Doodad"},{slug:"mountain-tree-stand-4",name:"Mountain Tree Stand 4",original:"55c25190dfc8d0b576e60a70",portraitURL:"/file/db/thang.type/55c25190dfc8d0b576e60a70/portrait.png",kind:"Doodad"},{slug:"movement-stone",name:"Movement Stone",original:"546e257a9df4a17d0d449bd9",portraitURL:"/file/db/thang.type/546e257a9df4a17d0d449bd9/portrait.png",kind:"Doodad"},{slug:"movement-stone-loop",name:"Movement Stone Loop",original:"546e24679df4a17d0d449bc1",portraitURL:"/file/db/thang.type/546e24679df4a17d0d449bc1/portrait.png",kind:"Doodad"},{slug:"multiplayer-treasure-grove-background",name:"Multiplayer Treasure Grove Background",original:"572e526e7a9c3e8101b8be02",portraitURL:"/file/db/thang.type/572e526e7a9c3e8101b8be02/portrait.png",kind:"Floor"},{slug:"mummy",name:"Mummy",original:"54ef799c8d75558205e98a8e",portraitURL:"/file/db/thang.type/54ef799c8d75558205e98a8e/portrait.png",kind:"Doodad"},{slug:"mushroom",name:"Mushroom",original:"52bcc23a8c4289607b00000a",portraitURL:"/file/db/thang.type/52bcc23a8c4289607b00000a/portrait.png",kind:"Misc"},{slug:"mushroom-cluster-1",name:"Mushroom Cluster 1",original:"5576376f1e82182d9e688935",portraitURL:"/file/db/thang.type/5576376f1e82182d9e688935/portrait.png",kind:"Doodad"},{slug:"mushroom-cluster-2",name:"Mushroom Cluster 2",original:"557638341e82182d9e688939",portraitURL:"/file/db/thang.type/557638341e82182d9e688939/portrait.png",kind:"Doodad"},{slug:"mushroom-cluster-3",name:"Mushroom Cluster 3",original:"557638731e82182d9e68893d",portraitURL:"/file/db/thang.type/557638731e82182d9e68893d/portrait.png",kind:"Doodad"},{slug:"mushroom-cluster-4",name:"Mushroom Cluster 4",original:"5576390e1e82182d9e688941",portraitURL:"/file/db/thang.type/5576390e1e82182d9e688941/portrait.png",kind:"Doodad"},{slug:"musty-linen-robe",name:"Musty Linen Robe",original:"546d49409df4a17d0d449a83",portraitURL:"/file/db/thang.type/546d49409df4a17d0d449a83/portrait.png",kind:"Item"},{slug:"newmakatesthushbaum",name:"newmakatesthushbaum",original:"56ce223647c33f2400d98c66",portraitURL:"/file/db/thang.type/56ce223647c33f2400d98c66/portrait.png",kind:"undefined"},{slug:"nightingales-song",name:"Nightingale's Song",original:"54eb570b49fa2d5c905ddf32",portraitURL:"/file/db/thang.type/54eb570b49fa2d5c905ddf32/portrait.png",kind:"Item"},{slug:"north-mounted-camera-facing-east-west",name:"north mounted camera facing east-west",original:"56f175f2f3ae4cc900a0c5fc",portraitURL:"/file/db/thang.type/56f175f2f3ae4cc900a0c5fc/portrait.png",kind:"Doodad"},{slug:"north-mounted-camera-facing-north",name:"north mounted camera facing north",original:"56f173384852efd20059948a",portraitURL:"/file/db/thang.type/56f173384852efd20059948a/portrait.png",kind:"Doodad"},{slug:"north-mounted-camera-facing-south",name:"north mounted camera facing south",original:"56f17562f3ae4cc900a0c57a",portraitURL:"/file/db/thang.type/56f17562f3ae4cc900a0c57a/portrait.png",kind:"Doodad"},{slug:"oak-crossbow",name:"Oak Crossbow",original:"544d80928494308424f564cb",portraitURL:"/file/db/thang.type/544d80928494308424f564cb/portrait.png",kind:"Item"},{slug:"oak-sphere-staff",name:"Oak Sphere Staff",original:"544d88b78494308424f5650d",portraitURL:"/file/db/thang.type/544d88b78494308424f5650d/portrait.png",kind:"Item"},{slug:"oak-wand",name:"Oak Wand",original:"544d87d18494308424f564fd",portraitURL:"/file/db/thang.type/544d87d18494308424f564fd/portrait.png",kind:"Item"},{slug:"oasis-1",name:"Oasis 1",original:"544d79678494308424f56480",portraitURL:"/file/db/thang.type/544d79678494308424f56480/portrait.png",kind:"Doodad"},{slug:"oasis-2",name:"Oasis 2",original:"544d71198494308424f5647c",portraitURL:"/file/db/thang.type/544d71198494308424f5647c/portrait.png",kind:"Doodad"},{slug:"oasis-3",name:"Oasis 3",original:"5435d22f7b554def1f99c49a",portraitURL:"/file/db/thang.type/5435d22f7b554def1f99c49a/portrait.png",kind:"Doodad"},{slug:"obsidian-breastplate",name:"Obsidian Breastplate",original:"546ab11b3777d6186329286a",portraitURL:"/file/db/thang.type/546ab11b3777d6186329286a/portrait.png",kind:"Item"},{slug:"obsidian-helmet",name:"Obsidian Helmet",original:"546d39989df4a17d0d449a13",portraitURL:"/file/db/thang.type/546d39989df4a17d0d449a13/portrait.png",kind:"Item"},{slug:"obsidian-shield",name:"Obsidian Shield",original:"54eaba502b7506e891ca7216",portraitURL:"/file/db/thang.type/54eaba502b7506e891ca7216/portrait.png",kind:"Item"},{slug:"obsidian-staff",name:"Obsidian Staff",original:"54eab4b92b7506e891ca71ea",portraitURL:"/file/db/thang.type/54eab4b92b7506e891ca71ea/portrait.png",kind:"Item"},{slug:"obstacle",name:"Obstacle",original:"52bcc10d1f766a891c000001",portraitURL:"/file/db/thang.type/52bcc10d1f766a891c000001/portrait.png",kind:"Misc"},{slug:"office-chair",name:"office-chair",original:"56b25d8cc9d8ed21008354b8",portraitURL:"/file/db/thang.type/56b25d8cc9d8ed21008354b8/portrait.png",kind:"Doodad"},{slug:"office-desk",name:"Office Desk",original:"56b26c487168802600d26218",portraitURL:"/file/db/thang.type/56b26c487168802600d26218/portrait.png",kind:"Doodad"},{slug:"office-door",name:"Office Door",original:"56ba3366131fde2a000b84db",portraitURL:"/file/db/thang.type/56ba3366131fde2a000b84db/portrait.png",kind:"Doodad"},{slug:"office-filing-cabinet",name:"Office Filing Cabinet",original:"56b267eec2958a26005fbb58",portraitURL:"/file/db/thang.type/56b267eec2958a26005fbb58/portrait.png",kind:"Doodad"},{slug:"office-filing-cabinet-2",name:"Office Filing Cabinet 2",original:"56b268dd7168802600d25f3d",portraitURL:"/file/db/thang.type/56b268dd7168802600d25f3d/portrait.png",kind:"Doodad"},{slug:"office-floor",name:"Office Floor",original:"56b26e39bb550b26003adef0",portraitURL:"/file/db/thang.type/56b26e39bb550b26003adef0/portrait.png",kind:"Floor"},{slug:"office-wall",name:"office-wall",original:"56abc26c26c92a26005b3745",portraitURL:"/file/db/thang.type/56abc26c26c92a26005b3745/portrait.png",kind:"Wall"},{slug:"ogre-barracks",name:"Ogre Barracks",original:"530d11faa8583eb90a2fc76f",portraitURL:"/file/db/thang.type/530d11faa8583eb90a2fc76f/portrait.png",kind:"Unit"},{slug:"ogre-fence",name:"Ogre Fence",original:"5456b5c5d5ada30000525609",portraitURL:"/file/db/thang.type/5456b5c5d5ada30000525609/portrait.png",kind:"Doodad"},{slug:"ogre-fence-2",name:"Ogre Fence 2",original:"5456b631d5ada3000052560b",portraitURL:"/file/db/thang.type/5456b631d5ada3000052560b/portrait.png",kind:"Doodad"},{slug:"ogre-headhunter-hero",name:"Ogre Headhunter Hero",original:"5670779dfb9b702400cf6987",portraitURL:"/file/db/thang.type/5670779dfb9b702400cf6987/portrait.png",kind:"Unit"},{slug:"ogre-peon-f",name:"Ogre Peon F",original:"53765709a7b5ab3805f15512",portraitURL:"/file/db/thang.type/53765709a7b5ab3805f15512/portrait.png",kind:"Unit"},{slug:"ogre-peon-m",name:"Ogre Peon M",original:"53793734f883583805e356e2",portraitURL:"/file/db/thang.type/53793734f883583805e356e2/portrait.png",kind:"Unit"},{slug:"ogre-scout-f",name:"Ogre Scout F",original:"54909436b30e9eb7027fe21c",portraitURL:"/file/db/thang.type/54909436b30e9eb7027fe21c/portrait.png",kind:"Unit"},{slug:"ogre-scout-m",name:"Ogre Scout M",original:"54908ce5b30e9eb7027fe201",portraitURL:"/file/db/thang.type/54908ce5b30e9eb7027fe201/portrait.png",kind:"Unit"},{slug:"ogre-tent",name:"Ogre Tent",original:"5456b49dd5ada30000525607",portraitURL:"/file/db/thang.type/5456b49dd5ada30000525607/portrait.png",kind:"Doodad"},{slug:"ogre-tower",name:"ogre tower",original:"578686459fabcb1f0087d064",portraitURL:"/file/db/thang.type/578686459fabcb1f0087d064/portrait.png",kind:"Doodad"},{slug:"ogre-tower-with-desert-rocks",name:"ogre tower with desert rocks",original:"572d465dab2d38ad00a1c918",portraitURL:"/file/db/thang.type/572d465dab2d38ad00a1c918/portrait.png",kind:"Doodad"},{slug:"ogre-towers-with-trees",name:"ogre towers with trees",original:"572d47eee24ce2fb0025c6f3",portraitURL:"/file/db/thang.type/572d47eee24ce2fb0025c6f3/portrait.png",kind:"Doodad"},{slug:"ogre-treasure-chest",name:"Ogre Treasure Chest",original:"540e16d6821af8000097dc55",portraitURL:"/file/db/thang.type/540e16d6821af8000097dc55/portrait.png",kind:"Doodad"},{slug:"ogre-wall",name:"ogre wall",original:"5786834a2437842400f4009c",portraitURL:"/file/db/thang.type/5786834a2437842400f4009c/portrait.png",kind:"Doodad"},{slug:"ogre-witch-hero",name:"Ogre Witch Hero",original:"5638f6c4ef9d6464094a559d",portraitURL:"/file/db/thang.type/5638f6c4ef9d6464094a559d/portrait.png",kind:"Unit"},{slug:"old-selection",name:"Old Selection",original:"52aa5f7520fccb0000000002",portraitURL:"/file/db/thang.type/52aa5f7520fccb0000000002/portrait.png",kind:"Mark"},{slug:"order-of-the-paladin",name:"Order of the Paladin",original:"54eb55af49fa2d5c905ddf22",portraitURL:"/file/db/thang.type/54eb55af49fa2d5c905ddf22/portrait.png",kind:"Item"},{slug:"overseer",name:"Overseer",original:"56e75e0b67a0142000a12699",portraitURL:"/file/db/thang.type/56e75e0b67a0142000a12699/portrait.png",kind:"Unit"},{slug:"painted-steel-breastplate",name:"Painted Steel Breastplate",original:"546ab0dd3777d61863292866",portraitURL:"/file/db/thang.type/546ab0dd3777d61863292866/portrait.png",kind:"Item"},{slug:"painted-steel-helmet",name:"Painted Steel Helmet",original:"546d39589df4a17d0d449a0f",portraitURL:"/file/db/thang.type/546d39589df4a17d0d449a0f/portrait.png",kind:"Item"},{slug:"painted-steel-shield",name:"Painted Steel Shield",original:"544d7c5b8494308424f5649b",portraitURL:"/file/db/thang.type/544d7c5b8494308424f5649b/portrait.png",kind:"Item"},{slug:"palisade",name:"Palisade",original:"546e24bd9df4a17d0d449bc9",portraitURL:"/file/db/thang.type/546e24bd9df4a17d0d449bc9/portrait.png",kind:"Doodad"},{slug:"paralyze",name:"Paralyze",original:"53024e6b222f73867774d773",portraitURL:"/file/db/thang.type/53024e6b222f73867774d773/portrait.png",kind:"Mark"},{slug:"pedestal",name:"Pedestal",original:"542ae4750048dcb95727a1e6",portraitURL:"/file/db/thang.type/542ae4750048dcb95727a1e6/portrait.png",kind:"Doodad"},{slug:"phoenixfire",name:"Phoenixfire",original:"54ea8b602b7506e891ca718d",portraitURL:"/file/db/thang.type/54ea8b602b7506e891ca718d/portrait.png",kind:"Item"},{slug:"plasma-ball",name:"Plasma Ball",original:"5589fe594bed1b6c2a2cab6b",portraitURL:"/file/db/thang.type/5589fe594bed1b6c2a2cab6b/portrait.png",kind:"Missile"},{slug:"poison",name:"Poison",original:"53024020222f73867774d619",portraitURL:"/file/db/thang.type/53024020222f73867774d619/portrait.png",kind:"Mark"},{slug:"poisoned-throwing-shard-missile",name:"Poisoned Throwing Shard Missile",original:"544d97088494308424f56539",portraitURL:"/file/db/thang.type/544d97088494308424f56539/portrait.png",kind:"Missile"},{slug:"polar-bear-cub-pet",name:"Polar Bear Cub pet",original:"57588d4b87b06e1f00ded849",portraitURL:"/file/db/thang.type/57588d4b87b06e1f00ded849/portrait.png",kind:"Unit"},{slug:"polished-agate-sense-stone",name:"Polished Agate Sense Stone",original:"54693274a2b1f53ce79443c9",portraitURL:"/file/db/thang.type/54693274a2b1f53ce79443c9/portrait.png",kind:"Item"},{slug:"polished-bronze-breastplate",name:"Polished Bronze Breastplate",original:"545d3f0b2d03e700001b5a5d",portraitURL:"/file/db/thang.type/545d3f0b2d03e700001b5a5d/portrait.png",kind:"Item"},{slug:"polished-bronze-helmet",name:"Polished Bronze Helmet",original:"546d38779df4a17d0d449a03",portraitURL:"/file/db/thang.type/546d38779df4a17d0d449a03/portrait.png",kind:"Item"},{slug:"polished-bronze-shield",name:"Polished Bronze Shield",original:"544d7a888494308424f56487",portraitURL:"/file/db/thang.type/544d7a888494308424f56487/portrait.png",kind:"Item"},{slug:"polished-emerald-sense-stone",name:"Polished Emerald Sense Stone",original:"546933dda2b1f53ce79443d9",portraitURL:"/file/db/thang.type/546933dda2b1f53ce79443d9/portrait.png",kind:"Item"},{slug:"polished-sense-stone",name:"Polished Sense Stone",original:"53e215a253457600003e3eaf",portraitURL:"/file/db/thang.type/53e215a253457600003e3eaf/portrait.png",kind:"Item"},{slug:"polished-steel-scale-chainmail-coif",name:"Polished Steel Scale Chainmail Coif",original:"546d46889df4a17d0d449a5f",portraitURL:"/file/db/thang.type/546d46889df4a17d0d449a5f/portrait.png",kind:"Item"},{slug:"polished-steel-scale-chainmail-tunic",name:"Polished Steel Scale Chainmail Tunic",original:"546d3c3f9df4a17d0d449a37",portraitURL:"/file/db/thang.type/546d3c3f9df4a17d0d449a37/portrait.png",kind:"Item"},{slug:"pot-1",name:"Pot 1",original:"54ef882f83b08b7d054b6d49",portraitURL:"/file/db/thang.type/54ef882f83b08b7d054b6d49/portrait.png",kind:"Doodad"},{slug:"pot-2",name:"Pot 2",original:"54ef89dc4bb4788505d21234",portraitURL:"/file/db/thang.type/54ef89dc4bb4788505d21234/portrait.png",kind:"Doodad"},{slug:"pot-3",name:"Pot 3",original:"54ef8b1f305d7e790557d5d5",portraitURL:"/file/db/thang.type/54ef8b1f305d7e790557d5d5/portrait.png",kind:"Doodad"},{slug:"pot-4",name:"Pot 4",original:"54ef8becace2147e05868483",portraitURL:"/file/db/thang.type/54ef8becace2147e05868483/portrait.png",kind:"Doodad"},{slug:"potion-belt",name:"Potion Belt",original:"54694ac4a2b1f53ce794443d",portraitURL:"/file/db/thang.type/54694ac4a2b1f53ce794443d/portrait.png",kind:"Item"},{slug:"potted-tree",name:"Potted Tree",original:"56b2c8baf2ea182100d8ce78",portraitURL:"/file/db/thang.type/56b2c8baf2ea182100d8ce78/portrait.png",kind:"Doodad"},{slug:"powder-charge",name:"Powder Charge",original:"5462952cf44055a4b5e73599",portraitURL:"/file/db/thang.type/5462952cf44055a4b5e73599/portrait.png",kind:"Item"},{slug:"powder-charge-missile",name:"Powder Charge Missile",original:"544d99328494308424f56540",portraitURL:"/file/db/thang.type/544d99328494308424f56540/portrait.png",kind:"Missile"},{slug:"power-up",name:"Power Up",original:"55c64140ef141c65665beb6b",portraitURL:"/file/db/thang.type/55c64140ef141c65665beb6b/portrait.png",kind:"Mark"},{slug:"power-up-2",name:"Power Up 2",original:"55c6419fef141c65665beb6f",portraitURL:"/file/db/thang.type/55c6419fef141c65665beb6f/portrait.png",kind:"Mark"},{slug:"precision-rifle",name:"Precision Rifle",original:"54eaaecc2b7506e891ca71d9",portraitURL:"/file/db/thang.type/54eaaecc2b7506e891ca71d9/portrait.png",kind:"Item"},{slug:"programmaticon-i",name:"Programmaticon I",original:"53e4108204c00d4607a89f78",portraitURL:"/file/db/thang.type/53e4108204c00d4607a89f78/portrait.png",kind:"Item"},{slug:"programmaticon-ii",name:"Programmaticon II",original:"546e25d99df4a17d0d449be1",portraitURL:"/file/db/thang.type/546e25d99df4a17d0d449be1/portrait.png",kind:"Item"},{slug:"programmaticon-iii",name:"Programmaticon III",original:"546e266e9df4a17d0d449be5",portraitURL:"/file/db/thang.type/546e266e9df4a17d0d449be5/portrait.png",kind:"Item"},{slug:"programmaticon-iv",name:"Programmaticon IV",original:"55240951f76d6ee949f66512",portraitURL:"/file/db/thang.type/55240951f76d6ee949f66512/portrait.png",kind:"Item"},{slug:"programmaticon-v",name:"Programmaticon V",original:"557871261ff17fef5abee3ee",portraitURL:"/file/db/thang.type/557871261ff17fef5abee3ee/portrait.png",kind:"Item"},{slug:"pugicorn-pet",name:"Pugicorn Pet",original:"577d5edcab818b210046b73c",portraitURL:"/file/db/thang.type/577d5edcab818b210046b73c/portrait.png",kind:"Unit"},{slug:"pushcart",name:"Pushcart",original:"54f119a6d2969f8405ef539f",portraitURL:"/file/db/thang.type/54f119a6d2969f8405ef539f/portrait.png",kind:"Doodad"},{slug:"quartz-sense-stone",name:"Quartz Sense Stone",original:"54693240a2b1f53ce79443c5",portraitURL:"/file/db/thang.type/54693240a2b1f53ce79443c5/portrait.png",kind:"Item"},{slug:"ragged-silk-hat",name:"Ragged Silk Hat",original:"546d4ba19df4a17d0d449aaf",portraitURL:"/file/db/thang.type/546d4ba19df4a17d0d449aaf/portrait.png",kind:"Item"},{slug:"railgun",name:"Railgun",original:"54ea8ea52b7506e891ca7191",portraitURL:"/file/db/thang.type/54ea8ea52b7506e891ca7191/portrait.png",kind:"Item"},{slug:"rapidfire-rifle",name:"Rapidfire Rifle",original:"54eaae422b7506e891ca71d5",portraitURL:"/file/db/thang.type/54eaae422b7506e891ca71d5/portrait.png",kind:"Item"},{slug:"rat",name:"Rat",original:"55c11b70c87e47c60604f974",portraitURL:"/file/db/thang.type/55c11b70c87e47c60604f974/portrait.png",kind:"Doodad"},{slug:"razor-ring",name:"Razor Ring",original:"54c97c9bdef3ad363ff998b7",portraitURL:"/file/db/thang.type/54c97c9bdef3ad363ff998b7/portrait.png",kind:"Missile"},{slug:"razordisc-missile",name:"Razordisc Missile",original:"5318d3e56ad8999d34bdf338",portraitURL:"/file/db/thang.type/5318d3e56ad8999d34bdf338/portrait.png",kind:"Missile"},{slug:"rectangle",name:"Rectangle",original:"568d915e1717e2f90e9a1250",portraitURL:"/file/db/thang.type/568d915e1717e2f90e9a1250/portrait.png",kind:"Misc"},{slug:"red-button",name:"Red Button",original:"56d102c0441ddd2f002ba760",portraitURL:"/file/db/thang.type/56d102c0441ddd2f002ba760/portrait.png",kind:"Doodad"},{slug:"regen",name:"Regen",original:"53024f8b27471514685d53e1",portraitURL:"/file/db/thang.type/53024f8b27471514685d53e1/portrait.png",kind:"Mark"},{slug:"reindeer",name:"Reindeer",original:"54e95a88f54ef5794f354f3d",portraitURL:"/file/db/thang.type/54e95a88f54ef5794f354f3d/portrait.png",kind:"Doodad"},{slug:"reinforced-boots",name:"Reinforced Boots",original:"546d4d259df4a17d0d449ac5",portraitURL:"/file/db/thang.type/546d4d259df4a17d0d449ac5/portrait.png",kind:"Item"},{slug:"reinforced-crossbow",name:"Reinforced Crossbow",original:"54eaacdd2b7506e891ca71cd",portraitURL:"/file/db/thang.type/54eaacdd2b7506e891ca71cd/portrait.png",kind:"Item"},{slug:"reinforced-iron-chainmail-coif",name:"Reinforced Iron Chainmail Coif",original:"546d46099df4a17d0d449a57",portraitURL:"/file/db/thang.type/546d46099df4a17d0d449a57/portrait.png",kind:"Item"},{slug:"reinforced-iron-chainmail-tunic",name:"Reinforced Iron Chainmail Tunic",original:"546d3bbb9df4a17d0d449a2f",portraitURL:"/file/db/thang.type/546d3bbb9df4a17d0d449a2f/portrait.png",kind:"Item"},{slug:"repair",name:"Repair",original:"52bcc4591f766a891c000003",portraitURL:"/file/db/thang.type/52bcc4591f766a891c000003/portrait.png",kind:"Mark"},{slug:"ring-of-developer-experimentation",name:"Ring of Developer Experimentation",original:"54bac99bacbf5aea089da177",portraitURL:"/file/db/thang.type/54bac99bacbf5aea089da177/portrait.png",kind:"Item"},{slug:"ring-of-earth",name:"Ring of Earth",original:"5441c35c4e9aeb727cc9711d",portraitURL:"/file/db/thang.type/5441c35c4e9aeb727cc9711d/portrait.png",kind:"Item"},{slug:"ring-of-fire",name:"Ring of Fire",original:"54692ea2a2b1f53ce79443ab",portraitURL:"/file/db/thang.type/54692ea2a2b1f53ce79443ab/portrait.png",kind:"Item"},{slug:"ring-of-flowers",name:"Ring of Flowers",original:"5523224b0676ecb7d5c89319",portraitURL:"/file/db/thang.type/5523224b0676ecb7d5c89319/portrait.png",kind:"Item"},{slug:"ring-of-ice",name:"Ring of Ice",original:"54692ed3a2b1f53ce79443af",portraitURL:"/file/db/thang.type/54692ed3a2b1f53ce79443af/portrait.png",kind:"Item"},{slug:"ring-of-speed",name:"Ring of Speed",original:"54692d2aa2b1f53ce794438f",portraitURL:"/file/db/thang.type/54692d2aa2b1f53ce794438f/portrait.png",kind:"Item"},{slug:"riveted-dragonscale-chainmail-coif",name:"Riveted Dragonscale Chainmail Coif",original:"546d47c09df4a17d0d449a6f",portraitURL:"/file/db/thang.type/546d47c09df4a17d0d449a6f/portrait.png",kind:"Item"},{slug:"riveted-dragonscale-chainmail-tunic",name:"Riveted Dragonscale Chainmail Tunic",original:"546d3d549df4a17d0d449a47",portraitURL:"/file/db/thang.type/546d3d549df4a17d0d449a47/portrait.png",kind:"Item"},{slug:"robe-of-the-magi",name:"Robe of the Magi",original:"54ea3ec22b7506e891ca7126",portraitURL:"/file/db/thang.type/54ea3ec22b7506e891ca7126/portrait.png",kind:"Item"},{slug:"robobomb",name:"Robobomb",original:"55b7fb22a337d9b0ea024bb4",portraitURL:"/file/db/thang.type/55b7fb22a337d9b0ea024bb4/portrait.png",kind:"Unit"},{slug:"robot-walker",name:"Robot Walker",original:"5301696ad82649ec2c0c9b0d",portraitURL:"/file/db/thang.type/5301696ad82649ec2c0c9b0d/portrait.png",kind:"Unit"},{slug:"rock-1",name:"Rock 1",original:"52afcc1fc5b1813ec2000010",portraitURL:"/file/db/thang.type/52afcc1fc5b1813ec2000010/portrait.png",kind:"Doodad"},{slug:"rock-2",name:"Rock 2",original:"52afcce4c5b1813ec2000012",portraitURL:"/file/db/thang.type/52afcce4c5b1813ec2000012/portrait.png",kind:"Doodad"},{slug:"rock-3",name:"Rock 3",original:"52afcd43c5b1813ec2000014",portraitURL:"/file/db/thang.type/52afcd43c5b1813ec2000014/portrait.png",kind:"Doodad"},{slug:"rock-4",name:"Rock 4",original:"52afcd7bc5b1813ec2000016",portraitURL:"/file/db/thang.type/52afcd7bc5b1813ec2000016/portrait.png",kind:"Doodad"},{slug:"rock-5",name:"Rock 5",original:"52afcdc7c5b1813ec2000018",portraitURL:"/file/db/thang.type/52afcdc7c5b1813ec2000018/portrait.png",kind:"Doodad"},{slug:"rock-6",name:"Rock 6",original:"54e95916f54ef5794f354f2d",portraitURL:"/file/db/thang.type/54e95916f54ef5794f354f2d/portrait.png",kind:"Doodad"},{slug:"rock-7",name:"Rock 7",original:"54e959d6f54ef5794f354f31",portraitURL:"/file/db/thang.type/54e959d6f54ef5794f354f31/portrait.png",kind:"Doodad"},{slug:"rock-8",name:"Rock 8",original:"54e95a10f54ef5794f354f35",portraitURL:"/file/db/thang.type/54e95a10f54ef5794f354f35/portrait.png",kind:"Doodad"},{slug:"rock-cluster-1",name:"Rock Cluster 1",original:"52afcb47c5b1813ec200000a",portraitURL:"/file/db/thang.type/52afcb47c5b1813ec200000a/portrait.png",kind:"Doodad"},{slug:"rock-cluster-2",name:"Rock Cluster 2",original:"52afcb98c5b1813ec200000c",portraitURL:"/file/db/thang.type/52afcb98c5b1813ec200000c/portrait.png",kind:"Doodad"},{slug:"rock-cluster-3",name:"Rock Cluster 3",original:"52afcbe0c5b1813ec200000e",portraitURL:"/file/db/thang.type/52afcbe0c5b1813ec200000e/portrait.png",kind:"Doodad"},{slug:"rock-field-1",name:"Rock Field 1",original:"54e95753f54ef5794f354f21",portraitURL:"/file/db/thang.type/54e95753f54ef5794f354f21/portrait.png",kind:"Doodad"},{slug:"rock-field-2",name:"Rock Field 2",original:"54e95861f54ef5794f354f25",portraitURL:"/file/db/thang.type/54e95861f54ef5794f354f25/portrait.png",kind:"Doodad"},{slug:"rock-field-3",name:"Rock Field 3",original:"54e958aaf54ef5794f354f29",portraitURL:"/file/db/thang.type/54e958aaf54ef5794f354f29/portrait.png",kind:"Doodad"},{slug:"root",name:"Root",original:"55c640feef141c65665beb67",portraitURL:"/file/db/thang.type/55c640feef141c65665beb67/portrait.png",kind:"Mark"},{slug:"rough-sense-stone",name:"Rough Sense Stone",original:"54693140a2b1f53ce79443bc",portraitURL:"/file/db/thang.type/54693140a2b1f53ce79443bc/portrait.png",kind:"Item"},{slug:"roughedge",name:"Roughedge",original:"544d7d918494308424f564a7",portraitURL:"/file/db/thang.type/544d7d918494308424f564a7/portrait.png",kind:"Item"},{slug:"rs-demo",name:"RS Demo",original:"56ce48892438c720001e3ca3",portraitURL:"/file/db/thang.type/56ce48892438c720001e3ca3/portrait.png",kind:"undefined"},{slug:"runesword",name:"Runesword",original:"54eaa9622b7506e891ca71b1",portraitURL:"/file/db/thang.type/54eaa9622b7506e891ca71b1/portrait.png",kind:"Item"},{slug:"rusted-iron-breastplate",name:"Rusted Iron Breastplate",original:"545d3fe42d03e700001b5a5f",portraitURL:"/file/db/thang.type/545d3fe42d03e700001b5a5f/portrait.png",kind:"Item"},{slug:"rusted-iron-helmet",name:"Rusted Iron Helmet",original:"546d38d09df4a17d0d449a07",portraitURL:"/file/db/thang.type/546d38d09df4a17d0d449a07/portrait.png",kind:"Item"},{slug:"rusted-steel-scale-chainmail-coif",name:"Rusted Steel Scale Chainmail Coif",original:"546d46419df4a17d0d449a5b",portraitURL:"/file/db/thang.type/546d46419df4a17d0d449a5b/portrait.png",kind:"Item"},{slug:"rusted-steel-scale-chainmail-tunic",name:"Rusted Steel Scale Chainmail Tunic",original:"546d3bf99df4a17d0d449a33",portraitURL:"/file/db/thang.type/546d3bf99df4a17d0d449a33/portrait.png",kind:"Item"},{slug:"sand-01",name:"Sand 01",original:"5484df79d7b7b862291456af",portraitURL:"/file/db/thang.type/5484df79d7b7b862291456af/portrait.png",kind:"Floor"},{slug:"sand-02",name:"Sand 02",original:"5484e7c5d7b7b862291456b3",portraitURL:"/file/db/thang.type/5484e7c5d7b7b862291456b3/portrait.png",kind:"Floor"},{slug:"sand-03",name:"Sand 03",original:"5484e81bd7b7b862291456b7",portraitURL:"/file/db/thang.type/5484e81bd7b7b862291456b7/portrait.png",kind:"Floor"},{slug:"sand-04",name:"Sand 04",original:"5484e857d7b7b862291456bb",portraitURL:"/file/db/thang.type/5484e857d7b7b862291456bb/portrait.png",kind:"Floor"},{slug:"sand-05",name:"Sand 05",original:"5484e89cd7b7b862291456bf",portraitURL:"/file/db/thang.type/5484e89cd7b7b862291456bf/portrait.png",kind:"Floor"},{slug:"sand-06",name:"Sand 06",original:"5484e8ddd7b7b862291456c3",portraitURL:"/file/db/thang.type/5484e8ddd7b7b862291456c3/portrait.png",kind:"Floor"},{slug:"sand-yak",name:"Sand Yak",original:"5480b2251bf0b10000711c51",portraitURL:"/file/db/thang.type/5480b2251bf0b10000711c51/portrait.png",kind:"Unit"},{slug:"sapphire-sense-stone",name:"Sapphire Sense Stone",original:"54693363a2b1f53ce79443d1",portraitURL:"/file/db/thang.type/54693363a2b1f53ce79443d1/portrait.png",kind:"Item"},{slug:"sarcophagus",name:"sarcophagus",original:"572d5a2d3ff46db2000a381b",portraitURL:"/file/db/thang.type/572d5a2d3ff46db2000a381b/portrait.png",kind:"Doodad"},{slug:"scaled-gloves",name:"Scaled Gloves",original:"5469496ca2b1f53ce794442d",portraitURL:"/file/db/thang.type/5469496ca2b1f53ce794442d/portrait.png",kind:"Item"},{slug:"school-locker",name:"School locker",original:"56eb14804eb67a25009be23e",portraitURL:"/file/db/thang.type/56eb14804eb67a25009be23e/portrait.png",kind:"Doodad"},{slug:"scoreboard",name:"Scoreboard",original:"56de0ff26f9cc02400831e06",portraitURL:"/file/db/thang.type/56de0ff26f9cc02400831e06/portrait.png",kind:"Doodad"},{slug:"scorpion",name:"Scorpion",original:"548cf5340f559d0000be7e5b",portraitURL:"/file/db/thang.type/548cf5340f559d0000be7e5b/portrait.png",kind:"Doodad"},{slug:"selection",name:"Selection",original:"546e23d49df4a17d0d449bb5",portraitURL:"/file/db/thang.type/546e23d49df4a17d0d449bb5/portrait.png",kind:"Misc"},{slug:"shadow-guard-background",name:"Shadow Guard Background",original:"55bfc4c950cac5d58def9a67",portraitURL:"/file/db/thang.type/55bfc4c950cac5d58def9a67/portrait.png",kind:"Floor"},{slug:"shadowless-bird",name:"Shadowless Bird",original:"55079c55cea461db22519e9d",portraitURL:"/file/db/thang.type/55079c55cea461db22519e9d/portrait.png",kind:"Doodad"},{slug:"shadowless-cloud-1",name:"Shadowless Cloud 1",original:"53e2df9cd12e873205b6bce8",portraitURL:"/file/db/thang.type/53e2df9cd12e873205b6bce8/portrait.png",kind:"Doodad"},{slug:"shadowless-cloud-2",name:"Shadowless Cloud 2",original:"53e2e0176c59f5340504102f",portraitURL:"/file/db/thang.type/53e2e0176c59f5340504102f/portrait.png",kind:"Doodad"},{slug:"shadowless-cloud-3",name:"Shadowless Cloud 3",original:"53e2e08eae44ec37059f2148",portraitURL:"/file/db/thang.type/53e2e08eae44ec37059f2148/portrait.png",kind:"Doodad"},{slug:"sharpened-sword",name:"Sharpened Sword",original:"544d7deb8494308424f564ab",portraitURL:"/file/db/thang.type/544d7deb8494308424f564ab/portrait.png",kind:"Item"},{slug:"sharpsong",name:"Sharpsong",original:"544d95c78494308424f56527",portraitURL:"/file/db/thang.type/544d95c78494308424f56527/portrait.png",kind:"Item"},{slug:"sharpsong-missile",name:"Sharpsong Missile",original:"544d98368494308424f5653e",portraitURL:"/file/db/thang.type/544d98368494308424f5653e/portrait.png",kind:"Missile"},{slug:"shell",name:"Shell",original:"52ba2c6c981fbb7e48000093",portraitURL:"/file/db/thang.type/52ba2c6c981fbb7e48000093/portrait.png",kind:"Missile"},{slug:"shield",name:"Shield",original:"573fa531d0bee72000a4255f",portraitURL:"/file/db/thang.type/573fa531d0bee72000a4255f/portrait.png",kind:"Mark"},{slug:"short-sword",name:"Short Sword",original:"544d7f1a8494308424f564b7",portraitURL:"/file/db/thang.type/544d7f1a8494308424f564b7/portrait.png",kind:"Item"},{slug:"shrub-1",name:"Shrub 1",original:"52b0a113ccbc671372000017",portraitURL:"/file/db/thang.type/52b0a113ccbc671372000017/portrait.png",kind:"Doodad"},{slug:"shrub-2",name:"Shrub 2",original:"52b0a15accbc671372000019",portraitURL:"/file/db/thang.type/52b0a15accbc671372000019/portrait.png",kind:"Doodad"},{slug:"shrub-3",name:"Shrub 3",original:"52b0a1a3ccbc67137200001b",portraitURL:"/file/db/thang.type/52b0a1a3ccbc67137200001b/portrait.png",kind:"Doodad"},{slug:"sign",name:"Sign",original:"5435cbe77b554def1f99c491",portraitURL:"/file/db/thang.type/5435cbe77b554def1f99c491/portrait.png",kind:"Doodad"},{slug:"silver-coin",name:"Silver Coin",original:"535ef1f64f10444d08486b61",portraitURL:"/file/db/thang.type/535ef1f64f10444d08486b61/portrait.png",kind:"Misc"},{slug:"simple-boots",name:"Simple Boots",original:"53e237bf53457600003e3f05",portraitURL:"/file/db/thang.type/53e237bf53457600003e3f05/portrait.png",kind:"Item"},{slug:"simple-katana",name:"Simple Katana",original:"544d7ed58494308424f564b3",portraitURL:"/file/db/thang.type/544d7ed58494308424f564b3/portrait.png",kind:"Item"},{slug:"simple-rifle",name:"Simple Rifle",original:"544d70a18494308424f5647a",portraitURL:"/file/db/thang.type/544d70a18494308424f5647a/portrait.png",kind:"Item"},{slug:"simple-sword",name:"Simple Sword",original:"53e218d853457600003e3ebe",portraitURL:"/file/db/thang.type/53e218d853457600003e3ebe/portrait.png",kind:"Item"},{slug:"simple-wand",name:"Simple Wand",original:"544d874f8494308424f564f5",portraitURL:"/file/db/thang.type/544d874f8494308424f564f5/portrait.png",kind:"Item"},{slug:"simple-wristwatch",name:"Simple Wristwatch",original:"54693797a2b1f53ce79443e9",portraitURL:"/file/db/thang.type/54693797a2b1f53ce79443e9/portrait.png",kind:"Item"},{slug:"skeleton-bits-1",name:"Skeleton Bits 1",original:"54ef85bdc1f3bd7c0593d125",portraitURL:"/file/db/thang.type/54ef85bdc1f3bd7c0593d125/portrait.png",kind:"Doodad"},{slug:"skeleton-bits-2",name:"Skeleton Bits 2",original:"54ef874370ff9c8005e1eb0d",portraitURL:"/file/db/thang.type/54ef874370ff9c8005e1eb0d/portrait.png",kind:"Doodad"},{slug:"sky-span-background-1",name:"Sky Span Background 1",original:"53e3f096ae44ec37059f92d8",portraitURL:"/file/db/thang.type/53e3f096ae44ec37059f92d8/portrait.png",kind:"Floor"},{slug:"sky-span-background-2",name:"Sky Span Background 2",original:"53e3f3556c59f5340504359e",portraitURL:"/file/db/thang.type/53e3f3556c59f5340504359e/portrait.png",kind:"Floor"},{slug:"sky-span-background-3",name:"Sky Span Background 3",original:"53e3f500ae44ec37059f9415",portraitURL:"/file/db/thang.type/53e3f500ae44ec37059f9415/portrait.png",kind:"Doodad"},{slug:"sky-span-background-4",name:"Sky Span Background 4",original:"53e3f5dbae44ec37059f944a",portraitURL:"/file/db/thang.type/53e3f5dbae44ec37059f944a/portrait.png",kind:"Doodad"},{slug:"sky-span-background-5",name:"Sky Span Background 5",original:"53e3f646d12e873205b72abd",portraitURL:"/file/db/thang.type/53e3f646d12e873205b72abd/portrait.png",kind:"Floor"},{slug:"sky-span-background-6",name:"Sky Span Background 6",original:"53e3f724d12e873205b72af9",portraitURL:"/file/db/thang.type/53e3f724d12e873205b72af9/portrait.png",kind:"Floor"},{slug:"sky-span-background-7",name:"Sky Span Background 7",original:"53e3f74dae44ec37059f94b3",portraitURL:"/file/db/thang.type/53e3f74dae44ec37059f94b3/portrait.png",kind:"Doodad"},{slug:"sleep",name:"Sleep",original:"5302504b222f73867774d7a1",portraitURL:"/file/db/thang.type/5302504b222f73867774d7a1/portrait.png",kind:"Mark"},{slug:"slow",name:"Slow",original:"5302511327471514685d5405",portraitURL:"/file/db/thang.type/5302511327471514685d5405/portrait.png",kind:"Mark"},{slug:"snake",name:"Snake",original:"548cf57c0f559d0000be7e5f",portraitURL:"/file/db/thang.type/548cf57c0f559d0000be7e5f/portrait.png",kind:"Doodad"},{slug:"snake-pillar",name:"Snake Pillar",original:"54ef8db1223edd8105aff2b9",portraitURL:"/file/db/thang.type/54ef8db1223edd8105aff2b9/portrait.png",kind:"Doodad"},{slug:"soft-leather-gloves",name:"Soft Leather Gloves",original:"546948e9a2b1f53ce7944425",portraitURL:"/file/db/thang.type/546948e9a2b1f53ce7944425/portrait.png",kind:"Item"},{slug:"softened-leather-boots",name:"Softened Leather Boots",original:"546d4d589df4a17d0d449ac9",portraitURL:"/file/db/thang.type/546d4d589df4a17d0d449ac9/portrait.png",kind:"Item"},{slug:"sparkbomb",name:"Sparkbomb",original:"54eb528449fa2d5c905ddf12",portraitURL:"/file/db/thang.type/54eb528449fa2d5c905ddf12/portrait.png",kind:"Item"},{slug:"sparkbomb-missile",name:"Sparkbomb Missile",original:"5535b3bd428ddac5686fcf7a",portraitURL:"/file/db/thang.type/5535b3bd428ddac5686fcf7a/portrait.png",kind:"Missile"},{slug:"spear",name:"Spear",original:"52ba2affd68e4b7c48000030",portraitURL:"/file/db/thang.type/52ba2affd68e4b7c48000030/portrait.png",kind:"Missile"},{slug:"spider",name:"Spider",original:"55c1353bc87e47c60604f997",portraitURL:"/file/db/thang.type/55c1353bc87e47c60604f997/portrait.png",kind:"Doodad"},{slug:"spiderweb-1",name:"Spiderweb 1",original:"54ef7c69223edd8105afc1f4",portraitURL:"/file/db/thang.type/54ef7c69223edd8105afc1f4/portrait.png",kind:"Doodad"},{slug:"spiderweb-2",name:"Spiderweb 2",original:"54ef7d41ace2147e058655a8",portraitURL:"/file/db/thang.type/54ef7d41ace2147e058655a8/portrait.png",kind:"Doodad"},{slug:"spiderweb-3",name:"Spiderweb 3",original:"54ef7ed7b4740779058410c9",portraitURL:"/file/db/thang.type/54ef7ed7b4740779058410c9/portrait.png",kind:"Doodad"},{slug:"spiderweb-4",name:"Spiderweb 4",original:"54ef8938ace2147e05867d6d",portraitURL:"/file/db/thang.type/54ef8938ace2147e05867d6d/portrait.png",kind:"Doodad"},{slug:"spike-walls",name:"Spike Walls",original:"5422f63718adb78d98d265f7",portraitURL:"/file/db/thang.type/5422f63718adb78d98d265f7/portrait.png",kind:"Doodad"},{slug:"spiked-ogre-wall",name:"spiked ogre wall",original:"578682dccca8994b002708eb",portraitURL:"/file/db/thang.type/578682dccca8994b002708eb/portrait.png",kind:"Doodad"},{slug:"stalactite-1",name:"Stalactite 1",original:"55760f0a1e82182d9e688912",portraitURL:"/file/db/thang.type/55760f0a1e82182d9e688912/portrait.png",kind:"Doodad"},{slug:"stalactite-2",name:"Stalactite 2",original:"55760f4a1e82182d9e688916",portraitURL:"/file/db/thang.type/55760f4a1e82182d9e688916/portrait.png",kind:"Doodad"},{slug:"stalactite-3",name:"Stalactite 3",original:"55760f6f1e82182d9e68891a",portraitURL:"/file/db/thang.type/55760f6f1e82182d9e68891a/portrait.png",kind:"Doodad"},{slug:"stalagmite-1",name:"Stalagmite 1",original:"55760e6f1e82182d9e688906",portraitURL:"/file/db/thang.type/55760e6f1e82182d9e688906/portrait.png",kind:"Doodad"},{slug:"stalagmite-2",name:"Stalagmite 2",original:"55760eb61e82182d9e68890a",portraitURL:"/file/db/thang.type/55760eb61e82182d9e68890a/portrait.png",kind:"Doodad"},{slug:"stalagmite-3",name:"Stalagmite 3",original:"55760ee51e82182d9e68890e",portraitURL:"/file/db/thang.type/55760ee51e82182d9e68890e/portrait.png",kind:"Doodad"},{slug:"statue-stone-hooded",name:"Statue Stone Hooded",original:"546e23469df4a17d0d449ba9",portraitURL:"/file/db/thang.type/546e23469df4a17d0d449ba9/portrait.png",kind:"Doodad"},{slug:"steel-breastplate",name:"Steel Breastplate",original:"546ab0a83777d61863292862",portraitURL:"/file/db/thang.type/546ab0a83777d61863292862/portrait.png",kind:"Item"},{slug:"steel-helmet",name:"Steel Helmet",original:"5441c2ed4e9aeb727cc9710b",portraitURL:"/file/db/thang.type/5441c2ed4e9aeb727cc9710b/portrait.png",kind:"Item"},{slug:"steel-ring",name:"Steel Ring",original:"54692dbca2b1f53ce794439b",portraitURL:"/file/db/thang.type/54692dbca2b1f53ce794439b/portrait.png",kind:"Item"},{slug:"steel-shield",name:"Steel Shield",original:"544d7bec8494308424f56497",portraitURL:"/file/db/thang.type/544d7bec8494308424f56497/portrait.png",kind:"Item"},{slug:"steel-striker",name:"Steel Striker",original:"544d7c948494308424f5649f",portraitURL:"/file/db/thang.type/544d7c948494308424f5649f/portrait.png",kind:"Item"},{slug:"steel-wand",name:"Steel Wand",original:"544d88e48494308424f56511",portraitURL:"/file/db/thang.type/544d88e48494308424f56511/portrait.png",kind:"Item"},{slug:"stiff-lambswool-hat",name:"Stiff Lambswool Hat",original:"546d4b379df4a17d0d449aa7",portraitURL:"/file/db/thang.type/546d4b379df4a17d0d449aa7/portrait.png",kind:"Item"},{slug:"stone-builders-hammer",name:"Stone Builder's Hammer",original:"54694bcca2b1f53ce7944451",portraitURL:"/file/db/thang.type/54694bcca2b1f53ce7944451/portrait.png",kind:"Item"},{slug:"stone-fall-1",name:"Stone Fall 1",original:"53e2e5046f406a3505b3ead6",portraitURL:"/file/db/thang.type/53e2e5046f406a3505b3ead6/portrait.png",kind:"Doodad"},{slug:"stone-fall-2",name:"Stone Fall 2",original:"53e2e66d6c59f534050410d0",portraitURL:"/file/db/thang.type/53e2e66d6c59f534050410d0/portrait.png",kind:"Doodad"},{slug:"stone-fall-3",name:"Stone Fall 3",original:"53e2e728ae44ec37059f2438",portraitURL:"/file/db/thang.type/53e2e728ae44ec37059f2438/portrait.png",kind:"Doodad"},{slug:"stone-pillars",name:"stone pillars",original:"572d5958f5da8e29013e4e8d",portraitURL:"/file/db/thang.type/572d5958f5da8e29013e4e8d/portrait.png",kind:"Doodad"},{slug:"stone-statue",name:"Stone Statue",original:"546e25479df4a17d0d449bd5",portraitURL:"/file/db/thang.type/546e25479df4a17d0d449bd5/portrait.png",kind:"Doodad"},{slug:"stormbringer",name:"Stormbringer",original:"54ea87342b7506e891ca7175",portraitURL:"/file/db/thang.type/54ea87342b7506e891ca7175/portrait.png",kind:"Item"},{slug:"stretched-hide",name:"Stretched Hide",original:"557608901e82182d9e6888ce",portraitURL:"/file/db/thang.type/557608901e82182d9e6888ce/portrait.png",kind:"Doodad"},{slug:"student-a",name:"Student A",original:"56d0edd0441ddd2f002ba5aa",portraitURL:"/file/db/thang.type/56d0edd0441ddd2f002ba5aa/portrait.png",kind:"Unit"},{slug:"student-b",name:"Student B",original:"56d0efc14292981f009f51de",portraitURL:"/file/db/thang.type/56d0efc14292981f009f51de/portrait.png",kind:"Unit"},{slug:"stump-1",name:"Stump 1",original:"54e955f6f54ef5794f354f09",portraitURL:"/file/db/thang.type/54e955f6f54ef5794f354f09/portrait.png",kind:"Doodad"},{slug:"stump-2",name:"Stump 2",original:"54e95634f54ef5794f354f0d",portraitURL:"/file/db/thang.type/54e95634f54ef5794f354f0d/portrait.png",kind:"Doodad"},{slug:"stump-3",name:"Stump 3",original:"557f91f9b43ce0b15a91b1cd",portraitURL:"/file/db/thang.type/557f91f9b43ce0b15a91b1cd/portrait.png",kind:"Doodad"},{slug:"stump-4",name:"Stump 4",original:"557f923eb43ce0b15a91b1d1",portraitURL:"/file/db/thang.type/557f923eb43ce0b15a91b1d1/portrait.png",kind:"Doodad"},{slug:"stump-5",name:"Stump 5",original:"557f925ab43ce0b15a91b1d5",portraitURL:"/file/db/thang.type/557f925ab43ce0b15a91b1d5/portrait.png",kind:"Doodad"},{slug:"sturdy-bronze-shield",name:"Sturdy Bronze Shield",original:"544d7b028494308424f5648b",portraitURL:"/file/db/thang.type/544d7b028494308424f5648b/portrait.png",kind:"Item"},{slug:"sulphur-staff",name:"Sulphur Staff",original:"54eab7132b7506e891ca71fa",portraitURL:"/file/db/thang.type/54eab7132b7506e891ca71fa/portrait.png",kind:"Item"},{slug:"sundial-wristwatch",name:"Sundial Wristwatch",original:"53e2396a53457600003e3f0f",portraitURL:"/file/db/thang.type/53e2396a53457600003e3f0f/portrait.png",kind:"Item"},{slug:"sword",name:"Sword",original:"52bcda141f766a891c00000a",portraitURL:"/file/db/thang.type/52bcda141f766a891c00000a/portrait.png",kind:"Misc"},{slug:"sword-belt",name:"Sword Belt",original:"5441beb74e9aeb727cc970d3",portraitURL:"/file/db/thang.type/5441beb74e9aeb727cc970d3/portrait.png",kind:"Item"},{slug:"sword-fall-1",name:"Sword Fall 1",original:"53e2e8a7d12e873205b6c0f1",portraitURL:"/file/db/thang.type/53e2e8a7d12e873205b6c0f1/portrait.png",kind:"Doodad"},{slug:"sword-fall-2",name:"Sword Fall 2",original:"53e2e9a9ae44ec37059f2571",portraitURL:"/file/db/thang.type/53e2e9a9ae44ec37059f2571/portrait.png",kind:"Doodad"},{slug:"sword-of-the-forgotten",name:"Sword of the Forgotten",original:"54eaaa522b7506e891ca71b9",portraitURL:"/file/db/thang.type/54eaaa522b7506e891ca71b9/portrait.png",kind:"Item"},{slug:"sword-of-the-temple-guard",name:"Sword of the Temple Guard",original:"54eaab372b7506e891ca71c1",portraitURL:"/file/db/thang.type/54eaab372b7506e891ca71c1/portrait.png",kind:"Item"},{slug:"table",name:"Table",original:"52e9987a427172ae56001ffd",portraitURL:"/file/db/thang.type/52e9987a427172ae56001ffd/portrait.png",kind:"Doodad"},{slug:"tailored-linen-robe",name:"Tailored Linen Robe",original:"546d49759df4a17d0d449a87",portraitURL:"/file/db/thang.type/546d49759df4a17d0d449a87/portrait.png",kind:"Item"},{slug:"talus-1",name:"Talus 1",original:"54e944a3f54ef5794f354ea9",portraitURL:"/file/db/thang.type/54e944a3f54ef5794f354ea9/portrait.png",kind:"Floor"},{slug:"talus-2",name:"Talus 2",original:"54e94880f54ef5794f354ead",portraitURL:"/file/db/thang.type/54e94880f54ef5794f354ead/portrait.png",kind:"Floor"},{slug:"talus-3",name:"Talus 3",original:"54e948daf54ef5794f354eb1",portraitURL:"/file/db/thang.type/54e948daf54ef5794f354eb1/portrait.png",kind:"Floor"},{slug:"talus-4",name:"Talus 4",original:"54e94908f54ef5794f354eb5",portraitURL:"/file/db/thang.type/54e94908f54ef5794f354eb5/portrait.png",kind:"Floor"},{slug:"talus-5",name:"Talus 5",original:"54e9493cf54ef5794f354eb9",portraitURL:"/file/db/thang.type/54e9493cf54ef5794f354eb9/portrait.png",kind:"Floor"},{slug:"talus-6",name:"Talus 6",original:"54e94965f54ef5794f354ebd",portraitURL:"/file/db/thang.type/54e94965f54ef5794f354ebd/portrait.png",kind:"Floor"},{slug:"tarnished-bronze-breastplate",name:"Tarnished Bronze Breastplate",original:"53e22eac53457600003e3efc",portraitURL:"/file/db/thang.type/53e22eac53457600003e3efc/portrait.png",kind:"Item"},{slug:"tarnished-bronze-helmet",name:"Tarnished Bronze Helmet",original:"546d38269df4a17d0d4499ff",portraitURL:"/file/db/thang.type/546d38269df4a17d0d4499ff/portrait.png",kind:"Item"},{slug:"tarnished-copper-band",name:"Tarnished Copper Band",original:"54692a75a2b1f53ce7944387",portraitURL:"/file/db/thang.type/54692a75a2b1f53ce7944387/portrait.png",kind:"Item"},{slug:"tauran-helm",name:"Tauran Helm",original:"54ea49982b7506e891ca7165",portraitURL:"/file/db/thang.type/54ea49982b7506e891ca7165/portrait.png",kind:"Item"},{slug:"tauran-plate",name:"Tauran Plate",original:"54ea4b302b7506e891ca716d",portraitURL:"/file/db/thang.type/54ea4b302b7506e891ca716d/portrait.png",kind:"Item"},{slug:"teacher-b",name:"Teacher B",original:"56de0554d048927700b4f741",portraitURL:"/file/db/thang.type/56de0554d048927700b4f741/portrait.png",kind:"Doodad"},{slug:"tent-1",name:"Tent 1",original:"548cf2280f559d0000be7e37",portraitURL:"/file/db/thang.type/548cf2280f559d0000be7e37/portrait.png",kind:"Doodad"},{slug:"tent-2",name:"Tent 2",original:"548cf2b10f559d0000be7e3b",portraitURL:"/file/db/thang.type/548cf2b10f559d0000be7e3b/portrait.png",kind:"Doodad"},{slug:"tent-3",name:"Tent 3",original:"548cf30b0f559d0000be7e3f",portraitURL:"/file/db/thang.type/548cf30b0f559d0000be7e3f/portrait.png",kind:"Doodad"},{slug:"the-final-kithmaze-background",name:"the final kithmaze background",original:"577ecc2b67053f25007eb916",portraitURL:"/file/db/thang.type/577ecc2b67053f25007eb916/portrait.png",kind:"Floor"},{slug:"the-gauntlet-background",name:"The Gauntlet Background",original:"572d631812f2abce00164c15",portraitURL:"/file/db/thang.type/572d631812f2abce00164c15/portrait.png",kind:"Floor"},{slug:"the-monolith",name:"The Monolith",original:"54eabcb72b7506e891ca7226",portraitURL:"/file/db/thang.type/54eabcb72b7506e891ca7226/portrait.png",kind:"Item"},{slug:"the-precious",name:"The Precious",original:"54eb56ae49fa2d5c905ddf2a",portraitURL:"/file/db/thang.type/54eb56ae49fa2d5c905ddf2a/portrait.png",kind:"Item"},{slug:"thick-burlap-robe",name:"Thick Burlap Robe",original:"546d48989df4a17d0d449a77",portraitURL:"/file/db/thang.type/546d48989df4a17d0d449a77/portrait.png",kind:"Item"},{slug:"thin-burlap-robe",name:"Thin Burlap Robe",original:"546d485b9df4a17d0d449a73",portraitURL:"/file/db/thang.type/546d485b9df4a17d0d449a73/portrait.png",kind:"Item"},{slug:"thoktars-discarded-hammer",name:"Thoktar's Discarded Hammer",original:"54694cd6a2b1f53ce7944466",portraitURL:"/file/db/thang.type/54694cd6a2b1f53ce7944466/portrait.png",kind:"Item"},{slug:"thornprick",name:"Thornprick",original:"54692e75a2b1f53ce79443a7",portraitURL:"/file/db/thang.type/54692e75a2b1f53ce79443a7/portrait.png",kind:"Item"},{slug:"threadbare-burlap-wizards-hat",name:"Threadbare Burlap Wizards Hat",original:"546d4a909df4a17d0d449a9b",portraitURL:"/file/db/thang.type/546d4a909df4a17d0d449a9b/portrait.png",kind:"Item"},{slug:"throne",name:"Throne",original:"54efa174933e1e7b05846fe6",portraitURL:"/file/db/thang.type/54efa174933e1e7b05846fe6/portrait.png",kind:"Doodad"},{slug:"tomb-ring",name:"Tomb Ring",original:"54eb55d849fa2d5c905ddf26",portraitURL:"/file/db/thang.type/54eb55d849fa2d5c905ddf26/portrait.png",kind:"Item"},{slug:"tool-belt",name:"Tool Belt",original:"5441beff4e9aeb727cc970d9",portraitURL:"/file/db/thang.type/5441beff4e9aeb727cc970d9/portrait.png",kind:"Item"},{slug:"torch",name:"Torch",original:"52aa608b20fccb0000000005",portraitURL:"/file/db/thang.type/52aa608b20fccb0000000005/portrait.png",kind:"Doodad"},{slug:"torn-silk-cloak",name:"Torn Silk Cloak",original:"546d49a79df4a17d0d449a8b",portraitURL:"/file/db/thang.type/546d49a79df4a17d0d449a8b/portrait.png",kind:"Item"},{slug:"torture-table",name:"Torture Table",original:"54ef8fd4b474077905843564",portraitURL:"/file/db/thang.type/54ef8fd4b474077905843564/portrait.png",kind:"Doodad"},{slug:"tower-ruined",name:"Tower Ruined",original:"54f117c548724e7d052b540b",portraitURL:"/file/db/thang.type/54f117c548724e7d052b540b/portrait.png",kind:"Doodad"},{slug:"training-dummy",name:"Training Dummy",original:"53e65923bc5cc012113e07b1",portraitURL:"/file/db/thang.type/53e65923bc5cc012113e07b1/portrait.png",kind:"Doodad"},{slug:"trap-belt",name:"Trap Belt",original:"54694a8fa2b1f53ce7944439",portraitURL:"/file/db/thang.type/54694a8fa2b1f53ce7944439/portrait.png",kind:"Item"},{slug:"treasure-chest",name:"Treasure Chest",original:"52aa3be0ccbd588d4d000005",portraitURL:"/file/db/thang.type/52aa3be0ccbd588d4d000005/portrait.png",kind:"Doodad"},{slug:"tree-1",name:"Tree 1",original:"52b09ef7ccbc67137200000f",portraitURL:"/file/db/thang.type/52b09ef7ccbc67137200000f/portrait.png",kind:"Doodad"},{slug:"tree-2",name:"Tree 2",original:"52b09fdeccbc671372000011",portraitURL:"/file/db/thang.type/52b09fdeccbc671372000011/portrait.png",kind:"Doodad"},{slug:"tree-3",name:"Tree 3",original:"52b0a04fccbc671372000013",portraitURL:"/file/db/thang.type/52b0a04fccbc671372000013/portrait.png",kind:"Doodad"},{slug:"tree-4",name:"Tree 4",original:"52b0a0a5ccbc671372000015",portraitURL:"/file/db/thang.type/52b0a0a5ccbc671372000015/portrait.png",kind:"Doodad"},{slug:"tree-stand-1",name:"Tree Stand 1",original:"541cc7c48e78524aad94de7d",portraitURL:"/file/db/thang.type/541cc7c48e78524aad94de7d/portrait.png",kind:"Doodad"},{slug:"tree-stand-2",name:"Tree Stand 2",original:"542068f38e78524aad94de83",portraitURL:"/file/db/thang.type/542068f38e78524aad94de83/portrait.png",kind:"Doodad"},{slug:"tree-stand-3",name:"Tree Stand 3",original:"5420693d8e78524aad94de89",portraitURL:"/file/db/thang.type/5420693d8e78524aad94de89/portrait.png",kind:"Doodad"},{slug:"tree-stand-4",name:"Tree Stand 4",original:"542069888e78524aad94de8f",portraitURL:"/file/db/thang.type/542069888e78524aad94de8f/portrait.png",kind:"Doodad"},{slug:"tree-stand-5",name:"Tree Stand 5",original:"542092628e78524aad94deca",portraitURL:"/file/db/thang.type/542092628e78524aad94deca/portrait.png",kind:"Doodad"},{slug:"tree-stand-6",name:"Tree Stand 6",original:"542092c38e78524aad94ded0",portraitURL:"/file/db/thang.type/542092c38e78524aad94ded0/portrait.png",kind:"Doodad"},{slug:"true-names-background",name:"True Names Background",original:"55e451bd206f7df7df6ba966",portraitURL:"/file/db/thang.type/55e451bd206f7df7df6ba966/portrait.png",kind:"Floor"},{slug:"twilight-glasses",name:"Twilight Glasses",original:"546941fda2b1f53ce794441d",portraitURL:"/file/db/thang.type/546941fda2b1f53ce794441d/portrait.png",kind:"Item"},{slug:"twisted-pine-wand",name:"Twisted Pine Wand",original:"544d877d8494308424f564f9",portraitURL:"/file/db/thang.type/544d877d8494308424f564f9/portrait.png",kind:"Item"},{slug:"undead",name:"Undead",original:"55c284933767fd3435eb4471",portraitURL:"/file/db/thang.type/55c284933767fd3435eb4471/portrait.png",kind:"Mark"},{slug:"undergrowth-dagger",name:"Undergrowth Dagger",original:"544d95e68494308424f5652b",portraitURL:"/file/db/thang.type/544d95e68494308424f5652b/portrait.png",kind:"Item"},{slug:"undergrowth-dagger-missile",name:"Undergrowth Dagger Missile",original:"544d99618494308424f56541",portraitURL:"/file/db/thang.type/544d99618494308424f56541/portrait.png",kind:"Missile"},{slug:"undying-ring",name:"Undying Ring",original:"54eb54d349fa2d5c905ddf1e",portraitURL:"/file/db/thang.type/54eb54d349fa2d5c905ddf1e/portrait.png",kind:"Item"},{slug:"unholy-tome-i",name:"Unholy Tome I",original:"546374bc3839c6e02811d308",portraitURL:"/file/db/thang.type/546374bc3839c6e02811d308/portrait.png",kind:"Item"},{slug:"unholy-tome-ii",name:"Unholy Tome II",original:"5463756f3839c6e02811d30c",portraitURL:"/file/db/thang.type/5463756f3839c6e02811d30c/portrait.png",kind:"Item"},{slug:"unholy-tome-iii",name:"Unholy Tome III",original:"5463758f3839c6e02811d30f",portraitURL:"/file/db/thang.type/5463758f3839c6e02811d30f/portrait.png",kind:"Item"},{slug:"unholy-tome-iv",name:"Unholy Tome IV",original:"546376b63839c6e02811d31b",portraitURL:"/file/db/thang.type/546376b63839c6e02811d31b/portrait.png",kind:"Item"},{slug:"unholy-tome-v",name:"Unholy Tome V",original:"546376da3839c6e02811d31e",portraitURL:"/file/db/thang.type/546376da3839c6e02811d31e/portrait.png",kind:"Item"},{slug:"viking-helmet",name:"Viking Helmet",original:"5441c3144e9aeb727cc97111",portraitURL:"/file/db/thang.type/5441c3144e9aeb727cc97111/portrait.png",kind:"Item"},{slug:"viking-helmet-doodad",name:"Viking Helmet Doodad",original:"5518239d1f12482609b44f76",portraitURL:"/file/db/thang.type/5518239d1f12482609b44f76/portrait.png",kind:"Doodad"},{slug:"vine-staff",name:"Vine Staff",original:"54eab92b2b7506e891ca720a",portraitURL:"/file/db/thang.type/54eab92b2b7506e891ca720a/portrait.png",kind:"Item"},{slug:"volcano",name:"Volcano",original:"55c64512ef141c65665beb7e",portraitURL:"/file/db/thang.type/55c64512ef141c65665beb7e/portrait.png",kind:"Doodad"},{slug:"vr-artist",name:"VR Artist",original:"56d0c6bf087ee32400763d49",portraitURL:"/file/db/thang.type/56d0c6bf087ee32400763d49/portrait.png",kind:"Unit"},{slug:"vr-breaker",name:"VR Breaker",original:"56d0e6e563103d2a00af5795",portraitURL:"/file/db/thang.type/56d0e6e563103d2a00af5795/portrait.png",kind:"Unit"},{slug:"vr-door",name:"VR Door",original:"56aa6bf503ec4e2000878867",portraitURL:"/file/db/thang.type/56aa6bf503ec4e2000878867/portrait.png",kind:"Doodad"},{slug:"vr-floor",name:"VR Floor",original:"56a2e305b0b7242000e9986e",portraitURL:"/file/db/thang.type/56a2e305b0b7242000e9986e/portrait.png",kind:"Floor"},{slug:"vr-oracle",name:"VR Oracle",original:"56d0d144a7daf22000023a13",portraitURL:"/file/db/thang.type/56d0d144a7daf22000023a13/portrait.png",kind:"Unit"},{slug:"vr-security",name:"VR Security",original:"56d758b787781b1f00cf4b20",portraitURL:"/file/db/thang.type/56d758b787781b1f00cf4b20/portrait.png",kind:"Unit"},{slug:"vr-tinker",name:"VR Tinker",original:"56d07d682a1e1736005b1b37",portraitURL:"/file/db/thang.type/56d07d682a1e1736005b1b37/portrait.png",kind:"Unit"},{slug:"vr-wall",name:"vr-wall",original:"56b0c75302b7db290079b542",portraitURL:"/file/db/thang.type/56b0c75302b7db290079b542/portrait.png",kind:"Wall"},{slug:"vr-wyrm",name:"VR Wyrm",original:"56bb944d203af82000b2a406",portraitURL:"/file/db/thang.type/56bb944d203af82000b2a406/portrait.png",kind:"Unit"},{slug:"wagon-broken",name:"Wagon Broken",original:"548cf1cd0f559d0000be7e33",portraitURL:"/file/db/thang.type/548cf1cd0f559d0000be7e33/portrait.png",kind:"Doodad"},{slug:"wakka-maul-background",name:"Wakka Maul Background",original:"5654eae2f9285e86053f7504",portraitURL:"/file/db/thang.type/5654eae2f9285e86053f7504/portrait.png",kind:"Floor"},{slug:"warcry",name:"Warcry",original:"53024777222f73867774d6cd",portraitURL:"/file/db/thang.type/53024777222f73867774d6cd/portrait.png",kind:"Mark"},{slug:"waterfall",name:"Waterfall",original:"53e2eaffae44ec37059f262a",portraitURL:"/file/db/thang.type/53e2eaffae44ec37059f262a/portrait.png",kind:"Doodad"},{slug:"weak-charge",name:"Weak Charge",original:"544d957d8494308424f5651f",portraitURL:"/file/db/thang.type/544d957d8494308424f5651f/portrait.png",kind:"Item"},{slug:"weak-charge-missile",name:"Weak Charge Missile",original:"544d97798494308424f5653b",portraitURL:"/file/db/thang.type/544d97798494308424f5653b/portrait.png",kind:"Missile"},{slug:"weighted-throwing-knives",name:"Weighted Throwing Knives",original:"544d96108494308424f5652f",portraitURL:"/file/db/thang.type/544d96108494308424f5652f/portrait.png",kind:"Item"},{slug:"weighted-throwing-knives-missile",name:"Weighted Throwing Knives Missile",original:"544d99b98494308424f56545",portraitURL:"/file/db/thang.type/544d99b98494308424f56545/portrait.png",kind:"Missile"},{slug:"well",name:"Well",original:"52b094cbccbc671372000004",portraitURL:"/file/db/thang.type/52b094cbccbc671372000004/portrait.png",kind:"Doodad"},{slug:"white-deerhide-gloves",name:"White Deerhide Gloves",original:"54694936a2b1f53ce7944429",portraitURL:"/file/db/thang.type/54694936a2b1f53ce7944429/portrait.png",kind:"Item"},{slug:"windwalker-coif",name:"Windwalker Coif",original:"54ea48512b7506e891ca7157",portraitURL:"/file/db/thang.type/54ea48512b7506e891ca7157/portrait.png",kind:"Item"},{slug:"windwalker-mail",name:"Windwalker Mail",original:"54ea46092b7506e891ca7143",portraitURL:"/file/db/thang.type/54ea46092b7506e891ca7143/portrait.png",kind:"Item"},{slug:"winged-boots",name:"Winged Boots",original:"546d4e5c9df4a17d0d449ad9",portraitURL:"/file/db/thang.type/546d4e5c9df4a17d0d449ad9/portrait.png",kind:"Item"},{slug:"wizard-bird-f",name:"Wizard Bird F",original:"52fc0c9e7e01835453bd8ef8",portraitURL:"/file/db/thang.type/52fc0c9e7e01835453bd8ef8/portrait.png",kind:"Unit"},{slug:"wizard-bird-m",name:"Wizard Bird M",original:"52fd015f3a58c6c50fcf4782",portraitURL:"/file/db/thang.type/52fd015f3a58c6c50fcf4782/portrait.png",kind:"Unit"},{slug:"wizard-doctor",name:"Wizard Doctor",original:"52fc04fbab6e45c813bc7ced",portraitURL:"/file/db/thang.type/52fc04fbab6e45c813bc7ced/portrait.png",kind:"Unit"},{slug:"wizard-dude",name:"Wizard Dude",original:"53e126a4e06b897606d38bef",portraitURL:"/file/db/thang.type/53e126a4e06b897606d38bef/portrait.png",kind:"Unit"},{slug:"wizard-hermes",name:"Wizard Hermes",original:"52fc09daab6e45c813bc7d52",portraitURL:"/file/db/thang.type/52fc09daab6e45c813bc7d52/portrait.png",kind:"Unit"},{slug:"wizard-knight",name:"Wizard Knight",original:"52fc00ffab6e45c813bc7cb2",portraitURL:"/file/db/thang.type/52fc00ffab6e45c813bc7cb2/portrait.png",kind:"Unit"},{slug:"wizard-ninja-m",name:"Wizard Ninja M",original:"52fd04aff0cd954d619a9a4c",portraitURL:"/file/db/thang.type/52fd04aff0cd954d619a9a4c/portrait.png",kind:"Unit"},{slug:"wizard-overseer-f",name:"Wizard Overseer F",original:"52fc11fbb2b91c0d5a7b6a14",portraitURL:"/file/db/thang.type/52fc11fbb2b91c0d5a7b6a14/portrait.png",kind:"Unit"},{slug:"wizard-overseer-m",name:"Wizard Overseer M",original:"52fd0728ccb2653821eaf8b0",portraitURL:"/file/db/thang.type/52fd0728ccb2653821eaf8b0/portrait.png",kind:"Unit"},{slug:"wizard-purple",name:"Wizard Purple",original:"52fd0e16c7e6cf99160e7b6a",portraitURL:"/file/db/thang.type/52fd0e16c7e6cf99160e7b6a/portrait.png",kind:"Unit"},{slug:"wizard-spine",name:"Wizard Spine",original:"52fcfed63a58c6c50fcf4732",portraitURL:"/file/db/thang.type/52fcfed63a58c6c50fcf4732/portrait.png",kind:"Unit"},{slug:"wizard-spine-m",name:"Wizard Spine M",original:"52fd0c70f0cd954d619a9b10",portraitURL:"/file/db/thang.type/52fd0c70f0cd954d619a9b10/portrait.png",kind:"Unit"},{slug:"wizard-thorn-f",name:"Wizard Thorn F",original:"52fc1460b2b91c0d5a7b6af3",portraitURL:"/file/db/thang.type/52fc1460b2b91c0d5a7b6af3/portrait.png",kind:"Unit"},{slug:"wizard-thorn-m",name:"Wizard Thorn M",original:"52fd0a40f0cd954d619a9ad7",portraitURL:"/file/db/thang.type/52fd0a40f0cd954d619a9ad7/portrait.png",kind:"Unit"},{slug:"wizard-top-hat",name:"Wizard Top Hat",original:"52fd124accb2653821eaf991",portraitURL:"/file/db/thang.type/52fd124accb2653821eaf991/portrait.png",kind:"Unit"},{slug:"wooden-builders-hammer",name:"Wooden Builder's Hammer",original:"54694ba3a2b1f53ce794444d",portraitURL:"/file/db/thang.type/54694ba3a2b1f53ce794444d/portrait.png",kind:"Item"},{slug:"wooden-glasses",name:"Wooden Glasses",original:"53e2167653457600003e3eb3",portraitURL:"/file/db/thang.type/53e2167653457600003e3eb3/portrait.png",kind:"Item"},{slug:"wooden-shield",name:"Wooden Shield",original:"53e22aa153457600003e3ef5",portraitURL:"/file/db/thang.type/53e22aa153457600003e3ef5/portrait.png",kind:"Item"},{slug:"wooden-strand",name:"Wooden Strand",original:"54692e3ea2b1f53ce79443a3",portraitURL:"/file/db/thang.type/54692e3ea2b1f53ce79443a3/portrait.png",kind:"Item"},{slug:"workers-gloves",name:"Worker's Gloves",original:"5469425ca2b1f53ce7944421",portraitURL:"/file/db/thang.type/5469425ca2b1f53ce7944421/portrait.png",kind:"Item"},{slug:"worn-dragonplate",name:"Worn Dragonplate",original:"546ab1a13777d61863292872",portraitURL:"/file/db/thang.type/546ab1a13777d61863292872/portrait.png",kind:"Item"},{slug:"worn-dragonplate-helmet",name:"Worn Dragonplate Helmet",original:"546d3a199df4a17d0d449a1b",portraitURL:"/file/db/thang.type/546d3a199df4a17d0d449a1b/portrait.png",kind:"Item"},{slug:"worn-dragonshield",name:"Worn Dragonshield",original:"54eabd662b7506e891ca722e",portraitURL:"/file/db/thang.type/54eabd662b7506e891ca722e/portrait.png",kind:"Item"},{slug:"wyrm2",name:"wyrm2",original:"56c32fd1807b9f36005e5fd0",portraitURL:"/file/db/thang.type/56c32fd1807b9f36005e5fd0/portrait.png",kind:"Unit"},{slug:"wyvernclaw",name:"Wyvernclaw",original:"54ea35fd2b7506e891ca70d5",portraitURL:"/file/db/thang.type/54ea35fd2b7506e891ca70d5/portrait.png",kind:"Item"},{slug:"x-mark-bones",name:"X Mark Bones",original:"54938352e9850ae3e8fbdd64",portraitURL:"/file/db/thang.type/54938352e9850ae3e8fbdd64/portrait.png",kind:"Doodad"},{slug:"x-mark-forest",name:"X Mark Forest",original:"549381a7e9850ae3e8fbdd60",portraitURL:"/file/db/thang.type/549381a7e9850ae3e8fbdd60/portrait.png",kind:"Doodad"},{slug:"x-mark-red",name:"X Mark Red",original:"5493844be9850ae3e8fbdd70",portraitURL:"/file/db/thang.type/5493844be9850ae3e8fbdd70/portrait.png",kind:"Doodad"},{slug:"x-mark-stone",name:"X Mark Stone",original:"549383aae9850ae3e8fbdd68",portraitURL:"/file/db/thang.type/549383aae9850ae3e8fbdd68/portrait.png",kind:"Doodad"},{slug:"x-mark-wood",name:"X Mark Wood",original:"54938408e9850ae3e8fbdd6c",portraitURL:"/file/db/thang.type/54938408e9850ae3e8fbdd6c/portrait.png",kind:"Doodad"},{slug:"x-marker",name:"X Marker",original:"5452ec9f06a59e000067e518",portraitURL:"/file/db/thang.type/5452ec9f06a59e000067e518/portrait.png",kind:"Doodad"},{slug:"x-ray-goggles",name:"X-Ray Goggles",original:"53e2392453457600003e3f0d",portraitURL:"/file/db/thang.type/53e2392453457600003e3f0d/portrait.png",kind:"Item"},{slug:"yeti",name:"Yeti",original:"54e91dc5970f0b0a263c03de",portraitURL:"/file/db/thang.type/54e91dc5970f0b0a263c03de/portrait.png",kind:"Unit"},{slug:"yeti-cave",name:"Yeti Cave",original:"557f8f84b43ce0b15a91b1c7",portraitURL:"/file/db/thang.type/557f8f84b43ce0b15a91b1c7/portrait.png",kind:"Doodad"},{slug:"yeti-skin",name:"Yeti Skin",original:"557f370ab43ce0b15a91b171",portraitURL:"/file/db/thang.type/557f370ab43ce0b15a91b171/portrait.png",kind:"Doodad"}],s)}.call(this,a(3))},1932:function(e,t,i){var n=i(1933);(n="string"==typeof n?[[e.i,n,""]]:n).locals&&(e.exports=n.locals);(0,i(21).default)("830c77d4",n,!0,{})},1933:function(e,t,i){},1934:function(e,t,i){var l=i(11);e.exports=function(e){var i,a=[],e=e||{};return function(s,e,t,r){a.push('<div class="modal-dialog"><div id="modal-base-flat" class="modal-content style-flat"><div class="modal-header">'),r.closeButton&&a.push('<div type="button" data-dismiss="modal" aria-hidden="true" class="button close">&times;</div>'),a.push('</div><div class="modal-body"><div class="row modal-body-content"><div class="image-list-container col-sm-7"><h3>'+l.escape(i="1. ")+'<span data-i18n="web_dev.select_an_image"></span></h3><ul class="image-list">'),function(){var e=r.images;if("number"==typeof e.length)for(var t=0,i=e.length;t<i;t++){var n=e[t],o=s.get("selectedUrl")===n.portraitURL?"selected":"";a.push("<li"+l.attr("data-portrait-url",n.portraitURL,!0,!0)+l.attr("selected",o,!0,!0)+l.cls(["image-list-item","render",o],[null,null,!0])+"><img"+l.attr("src",n.portraitURL,!0,!0)+"></li>")}else{i=0;for(t in e){i++;n=e[t],o=s.get("selectedUrl")===n.portraitURL?"selected":"";a.push("<li"+l.attr("data-portrait-url",n.portraitURL,!0,!0)+l.attr("selected",o,!0,!0)+l.cls(["image-list-item","render",o],[null,null,!0])+"><img"+l.attr("src",n.portraitURL,!0,!0)+"></li>")}}}.call(this),a.push('</ul><div class="small text-center"><span data-i18n="web_dev.scroll_down_for_more_images"></span></div></div><div class="col-sm-5 flex-col render"><h3>'+l.escape(i="2. ")+'<span data-i18n="web_dev.copy_the_url"></span></h3><div data-i18n="web_dev.copy_the_url_description" class="text-h3 subtitle"></div><div class="copy-row m-t-1"><div class="copy-textarea-col"><textarea class="image-url copyable">'),r.state.get("selectedUrl")&&a.push(l.escape(null==(i=t.pathToUrl(r.state.get("selectedUrl")))?"":i)),a.push('</textarea></div><div class="copy-button-col"><button class="btn btn-forest copy-url-button"><span data-i18n="web_dev.copy_url"></span></button></div></div><div class="hr-text m-t-1"><hr><span data-i18n="general.or"></span></div><h3 data-i18n="web_dev.copy_the_img_tag"></h3><div data-i18n="web_dev.copy_the_img_tag_description" class="text-h3 subtitle"></div><div class="copy-row m-t-1"><div class="copy-textarea-col"><textarea class="image-tag copyable">'),r.state.get("selectedUrl")&&a.push(l.escape(null==(i='<img src="'+t.pathToUrl(r.state.get("selectedUrl"))+'"/>')?"":i)),a.push('</textarea></div><div class="copy-button-col"><button class="btn btn-forest copy-tag-button"><span data-i18n="web_dev.copy_img"></span></button></div></div><div class="how-to-copy-paste m-t-3"><div class="m-b-1 text-center"><span data-i18n="web_dev.how_to_copy_paste"></span></div><div class="windows-only"><span data-i18n="web_dev.copy"></span>: ControlC<br><span data-i18n="web_dev.paste"></span>: ControlV</div><div class="mac-only hidden"><span data-i18n="web_dev.copy"></span>: Command C<br><span data-i18n="web_dev.paste"></span>: Command V</div></div><div class="close-button"><a href="#" data-dismiss="modal" aria-hidden="true" data-i18n="web_dev.back_to_editing" class="btn btn-lg btn-primary"></a></div></div></div></div><div class="modal-body wait secret"><h3>Reticulating Splines...</h3><div class="progress progress-striped active"><div class="progress-bar"></div></div></div><div class="modal-footer"></div></div></div>')}.call(this,"state"in e?e.state:"undefined"!=typeof state?state:void 0,"undefined"in e?e.undefined:void 0,"utils"in e?e.utils:"undefined"!=typeof utils?utils:void 0,"view"in e?e.view:"undefined"!=typeof view?view:void 0),a.join("")}},1935:function(e,t,i){var n,o,s,r={}.hasOwnProperty;function a(){return a.__super__.constructor.apply(this,arguments)}i(1936),n=i(26),s=i(6),o=i(1421),e.exports=(function(e,t){for(var i in t)r.call(t,i)&&(e[i]=t[i]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(a,n),a.prototype.id="progress-view",a.prototype.className="modal-content",a.prototype.template=i(1938),a.prototype.events={"click #done-btn":"onClickDoneButton","click #next-level-btn":"onClickNextLevelButton","click #start-challenge-btn":"onClickStartChallengeButton","click #map-btn":"onClickMapButton","click #ladder-btn":"onClickLadderButton","click #publish-btn":"onClickPublishButton","click #share-level-btn":"onClickShareLevelButton"},a.prototype.initialize=function(e){if(this.level=e.level,this.course=e.course,this.classroom=e.classroom,this.nextLevel=e.nextLevel,this.nextAssessment=e.nextAssessment,this.levelSessions=e.levelSessions,this.session=e.session,this.courseInstanceID=e.courseInstanceID,this.nextLevel.get("description",!0),this.nextLevelDescription=marked(s.i18n(this.nextLevel.attributesWithDefaults,"description").replace(/!\[.*?\]\(.*?\)\n*/g,"")),this.nextAssessment.get("description",!0),this.nextAssessmentDescription=marked(s.i18n(this.nextAssessment.attributesWithDefaults,"description").replace(/!\[.*?\]\(.*?\)\n*/g,"")),this.level.isProject())return this.shareURL=o.playDevLevel({level:this.level,session:this.session,course:this.course})},a.prototype.onClickDoneButton=function(){return this.trigger("done")},a.prototype.onClickNextLevelButton=function(){return this.trigger("next-level")},a.prototype.onClickStartChallengeButton=function(){return this.trigger("start-challenge")},a.prototype.onClickPublishButton=function(){return this.trigger("publish")},a.prototype.onClickMapButton=function(){return this.trigger("to-map")},a.prototype.onClickLadderButton=function(){return this.trigger("ladder")},a.prototype.onClickShareLevelButton=function(){var e,t=_.string.startsWith(this.course.get("slug"),"game-dev")?(e="Student Game Dev - Copy URL","GameDev"):(e="Student Web Dev - Copy URL","WebDev"),i={levelID:this.level.id,levelSlug:this.level.get("slug"),classroomID:this.classroom.id,courseID:this.course.id,category:t};return null!=(t=window.tracker)&&t.trackEvent(e,i,["MixPanel"]),this.$("#share-level-input").val(this.shareURL).select(),this.tryCopy()},a)},1936:function(e,t,i){var n=i(1937);(n="string"==typeof n?[[e.i,n,""]]:n).locals&&(e.exports=n.locals);(0,i(21).default)("4574d0c7",n,!0,{})},1937:function(e,t,i){},1938:function(e,t,i){var r=i(11);e.exports=function(e){var o,s=[],e=e||{};return function(e,t,i){s.push('<div class="modal-header"><div id="close-modal" data-dismiss="modal" class="btn well well-sm well-parchment"><span class="glyphicon glyphicon-remove"></span></div>'),i.level.isProject()?s.push('<h1 data-i18n="play_level.project_complete"></h1>'):s.push('<h1 data-i18n="play_level.level_complete"></h1>'),s.push('</div><div class="modal-body"><div class="container-fluid"><div class="row">');var n=i.nextLevel.isNew()?"col-sm-12":"col-sm-7";s.push("<div"+r.cls([n],[!0])+">"),i.level.isProject()||(s.push('<div class="well well-sm well-parchment rtl-allowed"><h3 data-i18n="play_level.completed_level" class="text-uppercase"></h3><h2 class="text-uppercase text-center">'+r.escape(null==(o=e(i.level.attributes,"name"))?"":o)+'</h2></div><div class="well well-sm well-parchment rtl-allowed">'),t.isSessionless()?s.push('<h3 class="course-title"><span data-i18n="play_level.course" class="text-uppercase spr"></span><span class="text-uppercase text-center">'+r.escape(null==(o=e(i.course.attributes,"name"))?"":o)+'</span></h3><span data-i18n="play_level.victory_no_progress_for_teachers"></span>'):(s.push('<h3 data-i18n="play_level.course" class="text-uppercase"></h3><div class="row"><div class="col-sm-8"><h3 class="text-uppercase text-center">'+r.escape(null==(o=e(i.course.attributes,"name"))?"":o)+'</h3></div><div class="col-sm-4">'),t=i.classroom.statsForSessions(i.levelSessions,i.course.id),s.push("<h1><span>"+r.escape(null==(o=t.levels.numDone)?"":o)+"/"+r.escape(null==(o=t.levels.size)?"":o)+"</span></h1></div></div>")),s.push("</div>")),s.push("</div>"),i.nextAssessment.isNew()&&i.nextLevel.isNew()||(s.push('<div class="col-sm-5">'),i.nextAssessment.isNew()||(s.push('<div class="well well-sm well-parchment rtl-allowed rtl-allowed"><h3 class="text-uppercase"><span data-i18n="play_level.challenge_unlocked"></span><span>:</span></h3><h2 class="text-uppercase">'+r.escape(null==(o=e(i.nextAssessment.attributes,"name").replace("Course: ",""))?"":o)+'</h2><div class="next-level-description">'+(null==(o=i.nextAssessmentDescription)?"":o)+"</div></div>"),i.nextAssessment.isNew()||s.push('<button id="start-challenge-btn" data-i18n="play_level.start_challenge" class="btn btn-illustrated btn-success btn-block btn-lg text-uppercase"></button>')),i.nextLevel.isNew()||s.push('<div class="well well-sm well-parchment rtl-allowed rtl-allowed"><h3 class="text-uppercase"><span data-i18n="play_level.next_level"></span><span>:</span></h3><h2 class="text-uppercase">'+r.escape(null==(o=e(i.nextLevel.attributes,"name").replace("Course: ",""))?"":o)+'</h2><div class="next-level-description">'+(null==(o=i.nextLevelDescription)?"":o)+"</div></div>"),s.push("</div>")),s.push("</div>"),i.level.isProject()&&(i.classroom?(s.push('<div class="well well-sm well-parchment rtl-allowed"><div class="row publish-text"><div class="col-xs-8 col-xs-offset-2"><p><b data-i18n="play_level.share_this_project"></b></p></div></div>'),i.session.isFake()?s.push('<div class="row"><div class="col-xs-8 col-xs-offset-2"><div data-i18n="sharing.unavailable" class="alert alert-warning"></div></div></div>'):s.push('<div class="row"><div class="col-sm-6 col-sm-offset-2"><input id="share-level-input"'+r.attr("value",i.shareURL,!0,!0)+' class="text-h4 semibold form-control"></div><div class="col-sm-2"><button id="share-level-btn" class="btn btn-illustrated btn-primary"><span data-i18n="sharing.copy_url"></span></button></div></div>'),s.push('</div><div class="well well-sm well-parchment"><div class="row publish-text"><div class="col-xs-8 col-xs-offset-2 rtl-allowed">'),i.session.get("published")?s.push('<p><b data-i18n="play_level.already_published_prefix"></b><br><span data-i18n="play_level.already_published_suffix"></span></p>'):s.push('<p><b data-i18n="play_level.ready_to_share"></b><br><span data-i18n="play_level.click_publish"></span></p>'),s.push("</div></div></div>")):(s.push('<div class="well well-sm well-parchment rtl-allowed"><h3 class="text-uppercase">'),i.level.isType("game-dev")?s.push('<span data-i18n="sharing.share_game"></span>'):s.push('<span data-i18n="sharing.share_web"></span>'),s.push('</h3><p><span data-i18n="sharing.victory_course_share_prefix"></span><span>'+r.escape(o=" ")+"</span><a"+r.attr("href",i.shareURL,!0,!0)+' target="_blank">'),i.level.isType("game-dev")?s.push('<span data-i18n="sharing.victory_course_share_game"></span>'):s.push('<span data-i18n="sharing.victory_course_share_web"></span>'),s.push("</a><span>"+r.escape(o=" ")+'</span><span data-i18n="sharing.victory_course_share_suffix"></span></p>'),i.session.isFake()?s.push('<div data-i18n="sharing.unavailable" class="alert alert-warning"></div>'):s.push('<div class="row"><div class="col-sm-10"><input id="share-level-input"'+r.attr("value",i.shareURL,!0,!0)+' class="text-h4 semibold form-control"></div><div class="col-sm-2"><button id="share-level-btn" class="btn btn-illustrated"><span data-i18n="sharing.copy_url"></span></button></div></div>'),s.push("</div>"))),s.push('<div class="row"><div class="col-sm-5 col-sm-offset-2 rtl-allowed">'),i.level.isProject()?s.push('<button id="keep-editing-btn" data-i18n="play_level.keep_editing" data-dismiss="modal" class="btn btn-illustrated btn-default btn-block btn-lg text-uppercase"></button>'):"course-ladder"===i.level.get("type")?s.push('<button id="ladder-btn" data-i18n="general.ladder" class="btn btn-illustrated btn-default btn-block btn-lg text-uppercase"></button>'):!i.nextLevel.isNew()&&i.classroom&&s.push('<button id="map-btn" data-i18n="play_level.back_to_map" class="btn btn-illustrated btn-primary btn-block btn-lg text-uppercase"></button>'),s.push('</div><div class="col-sm-5 rtl-allowed">'),i.level.isProject()?i.session.get("published")?s.push('<button id="publish-btn" data-i18n="play_level.view_gallery" class="btn btn-illustrated btn-success btn-block btn-lg text-uppercase"></button>'):s.push('<button id="publish-btn" data-i18n="common.publish" class="btn btn-illustrated btn-success btn-block btn-lg text-uppercase"></button>'):i.nextLevel.isNew()?s.push('<button id="done-btn" data-i18n="play_level.done" class="btn btn-illustrated btn-primary btn-block btn-lg text-uppercase"></button>'):s.push('<button id="next-level-btn" data-i18n="play_level.next_level" class="btn btn-illustrated btn-success btn-block btn-lg text-uppercase"></button>'),s.push("</div></div></div></div>")}.call(this,"i18n"in e?e.i18n:"undefined"!=typeof i18n?i18n:void 0,"me"in e?e.me:"undefined"!=typeof me?me:void 0,"view"in e?e.view:"undefined"!=typeof view?view:void 0),s.join("")}},1939:function(e,t,i){"use strict";i.r(t);var n,o=i(1940),s=i.n(o);for(n in o)["default"].indexOf(n)<0&&function(e){i.d(t,e,function(){return o[e]})}(n);t.default=s.a},1940:function(e,t,i){var n=[].indexOf||function(e){for(var t=0,i=this.length;t<i;t++)if(t in this&&this[t]===e)return t;return-1},o=i(1482).default,s=i(6),r=i(177),a=i(1488),l=(i(267),i(1375),_.invert(r.heroes));e.exports=Vue.extend({props:["nextLevel","nextAssessment","session","course","courseInstanceID","stats","supermodel","parent","codeLanguage"],components:{PieChart:o},computed:{challengeLink:function(){var e;return me.isSessionless()?e="/play/level/"+this.nextAssessment.slug+"?course="+this.course._id+"&codeLanguage="+s.getQueryVariable("codeLanguage","python"):(e="/play/level/"+this.nextAssessment.slug+"?course="+this.course._id+"&course-instance="+this.courseInstanceID,this.level.primerLanguage&&(e+="&codeLanguage="+this.level.primerLanguage)),e},mapLink:function(){var e=me.isSessionless()?"/teachers/courses":"/play/"+this.course.campaignID+"?course-instance="+this.courseInstanceID;return e},nextLevelLink:function(){var e;if(!me.showHeroAndInventoryModalsToStudents())return me.isSessionless()?e="/play/level/"+this.nextLevel.slug+"?course="+this.course._id+"&codeLanguage="+s.getQueryVariable("codeLanguage","python"):(e="/play/level/"+this.nextLevel.slug+"?course="+this.course._id+"&course-instance="+this.courseInstanceID,this.level.primerLanguage&&(e+="&codeLanguage="+this.level.primerLanguage)),e},nextLevelVideoLink:function(){var e="/play/video/level/"+this.nextLevel.slug+"?course="+this.course._id+"&course-instance="+this.courseInstanceID;return this.level.primerLanguage&&(e+="&codeLanguage="+this.level.primerLanguage),e+="&level="+this.nextLevel.original},nextLevelLinkClasses:function(){return this.assessmentNext?{"btn-default":!0}:{"btn-success":!0,"btn-glow":!0}},headerImage:function(){return this.level.assessment?"/images/pages/play/modal/challenge_complete.png":this.assessmentNext?"/images/pages/play/modal/challenge_unlocked.png":"/images/pages/play/modal/level_complete.png"},assessmentNext:function(){return this.nextAssessment._id},primaryConcept:function(){var e=_.first(this.level.primaryConcepts);return e&&this.$t("concepts."+e)},conceptGoals:function(){return this.level.goals.filter(function(e){return null!=(e=e.concepts)?e.length:void 0})},conceptGoalsCompleted:function(){return this.conceptGoals.filter((t=this,function(e){return"success"===t.session.state.goalStates[e.id].status})).length;var t},percentConceptsCompleted:function(){return 100*this.conceptGoalsCompleted/this.conceptGoals.length},allConceptsUsed:function(){return this.conceptGoalsCompleted===this.conceptGoals.length},level:function(){return this.$store.state.game.level},heroImage:function(){var e,t;return null==(e=this.$store.state.me.heroConfig)||!e.thangType||null==(t=l[this.$store.state.me.heroConfig.thangType])?"/images/pages/play/modal/captain.png":0<=n.call(r.heroClasses.Warrior,t)?"/images/pages/play/modal/"+t+".png":void 0},comboImage:function(){return this.allConceptsUsed?"/images/pages/play/modal/combo_complete.png":"/images/pages/play/modal/combo_incomplete.png"},nextLevelVideo:function(){if(me.isStudent()&&this.course._id===s.courseIDs.INTRODUCTION_TO_COMPUTER_SCIENCE&&!me.showHeroAndInventoryModalsToStudents())return s.videoLevels[this.nextLevel.original]}},methods:{marked:marked,onStartChallenge:function(){var e;return null!=(e=window.tracker)?e.trackEvent("Play Level Victory Modal Start Challenge",{category:"Students",levelSlug:this.level.slug,nextAssessmentSlug:this.nextAssessment.slug},[]):void 0},onBackToMap:function(){var e;return null!=(e=window.tracker)?e.trackEvent("Play Level Victory Modal Back to Map",{category:"Students",levelSlug:this.level.slug},[]):void 0},onNextLevelVideo:function(){var e;return null!=(e=window.tracker)?e.trackEvent("Play Level Victory Modal Next Level Video",{category:"Students",levelSlug:this.level.slug,nextLevelSlug:this.nextLevel.slug,nextLevelVideoTitle:this.nextLevelVideo.title},[]):void 0},onNextLevel:function(){var e;if(null!=(e=window.tracker)&&e.trackEvent("Play Level Victory Modal Next Level",{category:"Students",levelSlug:this.level.slug,nextLevelSlug:this.nextLevel.slug},[]),me.showHeroAndInventoryModalsToStudents()&&(null!=(e=this.setupManager)&&e.destroy(),this.setupManager=new a({supermodel:this.supermodel,levelID:this.nextLevel.slug,levelPath:"level",hadEverChosenHero:!0,parent:this.parent,courseID:this.course._id,courseInstanceID:this.courseInstanceID,codeLanguage:this.codeLanguage}),null==(e=this.setupManager)||!e.navigatingToPlay))return this.setupManager.open()},onReplayLevel:function(){var e;return null!=(e=window.tracker)&&e.trackEvent("Play Level Victory Modal Replay",{category:"Students",levelSlug:this.level.slug,nextLevelSlug:this.nextLevel.slug},[]),document.location.reload()}}})},1941:function(e,t,i){var n=i(2655);(n="string"==typeof n?[[e.i,n,""]]:n).locals&&(e.exports=n.locals);(0,i(21).default)("46e9d338",n,!0,{})},1942:function(c,e,h){!function(i){var e,t,r,n,o,s=function(e,t){return function(){return e.apply(t,arguments)}},a={}.hasOwnProperty;function l(){return this.incrementHintViewTime=s(this.incrementHintViewTime,this),l.__super__.constructor.apply(this,arguments)}e=h(26),t=h(57),h(1383),o=h(6),r=h(1403),n=h(167),c.exports=(function(e,t){for(var i in t)a.call(t,i)&&(e[i]=t[i]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(l,e),l.prototype.template=h(1943),l.prototype.className="hints-view",l.prototype.hintUsedThresholdSeconds=10,l.prototype.events={"click .next-btn":"onClickNextButton","click .previous-btn":"onClickPreviousButton","click .close-hint-btn":"hideView"},l.prototype.subscriptions={"level:show-victory":"hideView","tome:manual-cast":"hideView"},l.prototype.initialize=function(e){return this.level=e.level,this.session=e.session,this.hintsState=e.hintsState,this.state=new t({hintIndex:0,hintsViewTime:{},hintsUsed:{}}),this.updateHint(),e=_.debounce(this.render),this.listenTo(this.state,"change",e),this.listenTo(this.hintsState,"change",e),this.listenTo(this.state,"change:hintIndex",this.updateHint),this.listenTo(this.hintsState,"change:hidden",this.visibilityChanged)},l.prototype.destroy=function(){return clearInterval(this.timerIntervalID),l.__super__.destroy.call(this)},l.prototype.afterRender=function(){var t,i,e,n,o,s;for(this.$el.toggleClass("hide",this.hintsState.get("hidden")),l.__super__.afterRender.call(this),this.playSound("game-menu-open"),this.$("a").attr("target","_blank"),i=this.options.session.get("codeLanguage")||(null!=(o=me.get("aceConfig"))?o.language:void 0)||"python",e=0,n=(s=null!=(o=this.aceEditors)?o:[]).length;e<n;e++)s[e].destroy();return this.aceEditors=[],t=this.aceEditors,this.$el.find('pre:has(code[class*="lang-"])').each(function(){var e=r.initializeACE(this,i);return t.push(e)})},l.prototype.getProcessedHint=function(){var e=this.session.get("codeLanguage"),t=this.state.get("hint");if(t)return t=o.i18n(t,"body"),e=n.filterMarkdownCodeLanguages(t,e),marked(e)},l.prototype.updateHint=function(){var e=this.state.get("hintIndex"),t=i.i18n.t("play_level.hints_title").replace("{{number}}",e+1);return this.state.set({hintsTitle:t,hint:this.hintsState.getHint(e)})},l.prototype.onClickNextButton=function(){var e,t;return null!=(e=window.tracker)&&e.trackEvent("Hints Next Clicked",{category:"Students",levelSlug:this.level.get("slug"),hintCount:null!=(t=null!=(t=this.hintsState.get("hints"))?t.length:void 0)?t:0,hintCurrent:this.state.get("hintIndex")},[]),t=this.hintsState.get("total")-1,this.state.set("hintIndex",Math.min(this.state.get("hintIndex")+1,t)),this.playSound("menu-button-click"),this.updateHintTimer()},l.prototype.onClickPreviousButton=function(){var e;return null!=(e=window.tracker)&&e.trackEvent("Hints Previous Clicked",{category:"Students",levelSlug:this.level.get("slug"),hintCount:null!=(e=null!=(e=this.hintsState.get("hints"))?e.length:void 0)?e:0,hintCurrent:this.state.get("hintIndex")},[]),this.state.set("hintIndex",Math.max(this.state.get("hintIndex")-1,0)),this.playSound("menu-button-click"),this.updateHintTimer()},l.prototype.hideView=function(){var e;return null!=(e=this.hintsState)&&e.set("hidden",!0),this.playSound("game-menu-close")},l.prototype.visibilityChanged=function(e){return this.updateHintTimer()},l.prototype.updateHintTimer=function(){var e;if(clearInterval(this.timerIntervalID),!(this.hintsState.get("hidden")||null!=(e=this.state.get("hintsUsed"))&&e[this.state.get("hintIndex")]))return this.timerIntervalID=setInterval(this.incrementHintViewTime,1e3)},l.prototype.incrementHintViewTime=function(){var e,t,i=this.state.get("hintIndex"),n=this.state.get("hintsViewTime");return null==n[i]&&(n[i]=0),n[i]++,e=this.state.get("hintsUsed"),n[i]>this.hintUsedThresholdSeconds&&!e[i]&&(null!=(t=window.tracker)&&t.trackEvent("Hint Used",{category:"Students",levelSlug:this.level.get("slug"),hintCount:null!=(t=null!=(t=this.hintsState.get("hints"))?t.length:void 0)?t:0,hintCurrent:i},[]),e[i]=!0,this.state.set("hintsUsed",e),clearInterval(this.timerIntervalID)),this.state.set("hintsViewTime",n)},l)}.call(this,h(3))},1943:function(e,t,i){var n=i(11);e.exports=function(e){var t,i=[],e=e||{};return function(e){i.push('<button class="close-hint-btn btn btn-illustrated btn-danger"><span class="glyphicon glyphicon-remove"></span></button><h1 dir="auto" class="text-center hint-title"><span dir="auto">'+n.escape(null==(t=e.state.get("hintsTitle"))?"":t)+'</span></h1><div dir="auto" class="hint-body">'+(null==(t=e.getProcessedHint())?"":t)+'</div><div class="row btn-area"><div class="col-md-4">'),0<e.state.get("hintIndex")&&i.push('<button data-i18n="about.previous" class="previous-btn btn btn-illustrated pull-left"></button>'),i.push('</div><div class="col-md-4"><h2 class="text-center hint-pagination">'+n.escape(null==(t=e.state.get("hintIndex")+1)?"":t)+" / "+n.escape(null==(t=e.hintsState.get("total"))?"":t)+'</h2></div><div class="col-md-4">'),e.state.get("hintIndex")<e.hintsState.get("total")-1&&i.push('<button data-i18n="play.next" class="next-btn btn btn-illustrated pull-right"></button>'),i.push('</div></div><div class="clearfix"></div>')}.call(this,"view"in e?e.view:"undefined"!=typeof view?view:void 0),i.join("")}},1944:function(e,t,i){var n=i(1945);(n="string"==typeof n?[[e.i,n,""]]:n).locals&&(e.exports=n.locals);(0,i(21).default)("6d38082e",n,!0,{})},1945:function(e,t,i){},1946:function(e,t,i){var o=i(11);e.exports=function(e){var n=[],e=e||{};return function(e,t,i){n.push("<iframe"+o.attr("src","//"+i+"/web-dev-iframe.html?chinaUx="+e(t.chinaUx),!0,!0)+"></iframe>")}.call(this,"Boolean"in e?e.Boolean:"undefined"!=typeof Boolean?Boolean:void 0,"features"in e?e.features:"undefined"!=typeof features?features:void 0,"fullUnsafeContentHostname"in e?e.fullUnsafeContentHostname:"undefined"!=typeof fullUnsafeContentHostname?fullUnsafeContentHostname:void 0),n.join("")}},1947:function(e,t,i){"use strict";i.r(t);var n,o=i(2209),s=i(1524);for(n in s)["default"].indexOf(n)<0&&function(e){i.d(t,e,function(){return s[e]})}(n);i(1948);var r=i(19),o=Object(r.a)(s.default,o.a,o.b,!1,null,null,null);t.default=o.exports},1948:function(e,t,i){"use strict";var n=i(1526);i.n(n).a},1949:function(e,t,i){},2209:function(e,t,i){"use strict";i.d(t,"a",function(){return n}),i.d(t,"b",function(){return o});var n=function(){var e=this,t=e.$createElement,t=e._self._c||t;return t("flat-layout",[t("div",{staticClass:"video-container container"},[t("div",{staticClass:"video-background container"},[t("div",{staticClass:"row title-row"},[e.videoData?t("div",{staticClass:"col-sm-12"},[t("h3",{staticClass:"text-center text-uppercase video-title"},[e._v(e._s(e.$t("play_level.concept_unlocked"))+" : "+e._s(e.$t("courses."+e.videoData.i18name)))])]):e._e()]),t("div",{staticClass:"row video-row"},[e.videoData?t("div",{staticClass:"col-sm-12 video-col"},[t("iframe",{staticClass:"video",attrs:{src:e.videoUrl,frameborder:"0",webkitallowfullscreen:"",mozallowfullscreen:"",allowfullscreen:""}})]):e._e()]),t("div",{staticClass:"row buttons-row"},[t("div",{staticClass:"col-sm-6"},[t("a",{attrs:{id:"skip-btn",href:e.nextLevelLink},on:{click:e.onSkip}},[t("u",[e._v(e._s(e.$t("play_level.skip")))])])]),t("div",{staticClass:"col-sm-6 text-uppercase"},[t("a",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"btn-illustrated btn-success btn-block btn-lg btn",attrs:{id:"next-level-btn",href:e.nextLevelLink},on:{click:e.onNextLevel}},[e._v(e._s(e.$t("play_level.next_level")))])])]),t("img",{staticClass:"img-unlocked",attrs:{src:"/images/pages/play/modal/unlocked_banner.png"}})])])])},o=[]},2223:function(e,t,i){var n=i(2544);(n="string"==typeof n?[[e.i,n,""]]:n).locals&&(e.exports=n.locals);(0,i(21).default)("65108bb2",n,!0,{})},2224:function(e,t,p){!function(s){var i,r,c,a,n,h,l=function(e,t){return function(){return e.apply(t,arguments)}},o={}.hasOwnProperty;function u(){var e,t,i,n,o;this.onChatAdded=l(this.onChatAdded,this),this.onPlayerJoined=l(this.onPlayerJoined,this),this.onMeSynced=l(this.onMeSynced,this),this.incrementSessionPlaytime=l(this.incrementSessionPlaytime,this),u.__super__.constructor.apply(this,arguments),this.changedSessionProperties={},t=null!=(i=window.serverConfig)?i.sessionSaveDelay:void 0,i=(e=function(){switch(!1){case!(!s.isProduction||!t):return[1,5];case!c.isAnonymous():return[t.anonymous.min,t.anonymous.max];default:return[t.registered.min,t.registered.max]}}())[0],e=e[1],this.saveSession=_.debounce(this.reallySaveSession,1e3*i,{maxWait:1e3*e}),this.playerIsIdle=!1,this.vuexDestroyFunctions=[],this.vuexDestroyFunctions.push(a.watch(function(e){return e.game.timesCodeRun},(n=this,function(e){return n.session.set({timesCodeRun:e}),n.changedSessionProperties.timesCodeRun=!0}))),this.vuexDestroyFunctions.push(a.watch(function(e){return e.game.timesAutocompleteUsed},(o=this,function(e){return o.session.set({timesAutocompleteUsed:e}),o.changedSessionProperties.timesAutocompleteUsed=!0})))}i=p(2550),c=p(44).me,r=p(1375),h=p(6),n=p(1731),a=p(52),e.exports=(function(e,t){for(var i in t)o.call(t,i)&&(e[i]=t[i]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(u,i),u.get=function(e,t){t="play/level/"+e+"/"+t;return i.getFromCache(t)||new u(t)},u.prototype.subscriptions={"tome:editing-began":"onEditingBegan","tome:editing-ended":"onEditingEnded","script:state-changed":"onScriptStateChanged","script:ended":"onScriptEnded","script:reset":"onScriptReset","surface:sprite-selected":"onSpriteSelected","level:show-victory":"onVictory","tome:spell-changed":"onSpellChanged","tome:spell-created":"onSpellCreated","tome:cast-spells":"onCastSpells","tome:winnability-updated":"onWinnabilityUpdated","application:idle-changed":"onIdleChanged","goal-manager:new-goal-states":"onNewGoalStates","god:new-world-created":"onNewWorldCreated"},u.prototype.init=function(){var e;return u.__super__.init.call(this),this.fireScriptsRef=null!=(e=this.fireRef)?e.child("scripts"):void 0},u.prototype.setSession=function(e){return this.session=e,this.timerIntervalID=setInterval(this.incrementSessionPlaytime,1e3)},u.prototype.onIdleChanged=function(e){return this.playerIsIdle=e.idle},u.prototype.incrementSessionPlaytime=function(){var e;if(!this.playerIsIdle)return this.changedSessionProperties.playtime=!0,this.session.set("playtime",(null!=(e=this.session.get("playtime"))?e:0)+1),a.state.game.hintsVisible?(this.session.set("hintTime",(null!=(e=this.session.get("hintTime"))?e:0)+1),this.changedSessionProperties.hintTime=!0):void 0},u.prototype.onPoint=function(){return!0},u.prototype.onMeSynced=function(){return u.__super__.onMeSynced.call(this)},u.prototype.join=function(){return u.__super__.join.call(this)},u.prototype.disconnect=function(){var e;return null!=(e=this.fireScriptsRef)&&e.off(),this.fireScriptsRef=null,u.__super__.disconnect.call(this)},u.prototype.removeFirebaseData=function(e){return this.myConnection?(this.myConnection.child("connected"),this.fireRef.remove(),this.onDisconnect.cancel(function(){return"function"==typeof e?e():void 0})):"function"==typeof e?e():void 0},u.prototype.onEditingBegan=function(){},u.prototype.onEditingEnded=function(){},u.prototype.setSpells=function(e){var t,i,n=[];for(i in e)t=e[i],n.push(this.onSpellCreated({spell:t}));return n},u.prototype.onSpellChanged=function(e){var t,i,n;if(this.onPoint())return null==(t=null==(t=this.session.get("code"))?{}:t)[i=(n=e.spell.spellKey.split("/"))[0]]&&(t[i]={}),t[n[0]][n[1]]=e.spell.getSource(),this.changedSessionProperties.code={},this.changedSessionProperties.code[n[0]]=n[0],e.spell.level.isType("ladder")&&"ogres"===e.spell.team&&(this.changedSessionProperties.code[n[0]]="hero-placeholder"),this.session.set({code:t}),this.saveSession()},u.prototype.onSpellCreated=function(e){if(this.onPoint())return this.changedSessionProperties.teamSpells=!0,this.session.set({teamSpells:h.teamSpells}),this.saveSession(),e.spell.team===c.team||e.spell.otherSession&&e.spell.team!==e.spell.otherSession.get("team")?this.onSpellChanged(e):void 0},u.prototype.onCastSpells=function(e){if(this.onPoint()&&e.realTime)return this.changedSessionProperties.state=!0,this.saveSession()},u.prototype.onWinnabilityUpdated=function(e){if(this.onPoint()&&e.winnable&&e.level.get("mirrorMatch")&&(null==(e=this.session.get("state"))||!e.complete))return this.onVictory()},u.prototype.onNewWorldCreated=function(o){var s,e,t;if(this.onPoint()&&(t=this.session.get("state"),e=function(){for(var e=o.world.flagHistory,t=[],i=0,n=e.length;i<n;i++)"code"!==(s=e[i]).source&&t.push(s);return t}(),!_.isEqual(t.flagHistory,e)))return t.flagHistory=e,this.changedSessionProperties.state=!0,this.session.set("state",t),this.saveSession()},u.prototype.onScriptStateChanged=function(e){var t,i;if(this.onPoint())return null!=(t=this.fireScriptsRef)&&t.update(e),(t=null!=(t=(i=this.session.get("state")).scripts)?t:{}).currentScript=e.currentScript,t.currentScriptOffset=e.currentScriptOffset,this.changedSessionProperties.state=!0,this.session.set("state",i),this.saveSession()},u.prototype.onScriptEnded=function(e){var t,i,n,o;if(this.onPoint()&&(n=(o=this.session.get("state")).scripts)&&(null==n.ended&&(n.ended={}),null==n.ended[e.scriptID]))return t=_.keys(n.ended).length+1,null!=(i=this.fireScriptsRef)&&i.child("ended").child(e.scriptID).set(t),n.ended[e.scriptID]=t,this.session.set("state",o),this.changedSessionProperties.state=!0,this.saveSession()},u.prototype.onScriptReset=function(){var e;if(this.onPoint())return null!=(e=this.fireScriptsRef)&&e.set({}),(e=this.session.get("state")).scripts={},this.session.set("state",e),this.changedSessionProperties.state=!0,this.saveSession()},u.prototype.onSpriteSelected=function(e){var t;if(this.onPoint())return(t=this.session.get("state")).selected=(null!=(e=e.thang)?e.id:void 0)||null,this.session.set("state",t),this.changedSessionProperties.state=!0,this.saveSession()},u.prototype.onVictory=function(e){var t;if(this.onPoint()&&!(t=this.session.get("state")).complete)return t.complete=!0,this.session.set("state",t),this.changedSessionProperties.state=!0,this.reallySaveSession()},u.prototype.onNewGoalStates=function(e){var t,i,n,o,s,r,a,l=e.goalStates;if(_.find(o,function(e){return!e.status}))return console.error("Somehow trying to save null goal states!",o);if("success"===e.overallStatus){for(i in o=l,s=(a=this.session.get("state")).goalStates||{},t=!1,o)n=o[i],!c.isStudent()&&"success"===(null!=(r=s[i])?r.status:void 0)&&"success"!==n.status||h.kindaEqual(null!=(r=a.goalStates)?r[i]:void 0,n)||(t=!0,s[i]=_.cloneDeep(o[i]));return t?(a.goalStates=s,this.session.set("state",a),this.changedSessionProperties.state=!0,this.saveSession()):void 0}},u.prototype.onPlayerJoined=function(e){var t,i;if(u.__super__.onPlayerJoined.apply(this,arguments),this.onPoint()&&null==(i=null==(i=this.session.get("players"))?{}:i)[(t=e.val()).id])return i[t.id]={},this.session.set("players",i),this.changedSessionProperties.players=!0,this.saveSession()},u.prototype.onChatAdded=function(e){var t,i;if(u.__super__.onChatAdded.apply(this,arguments),null==(t=this.session.get("chat"))&&(t=[]),!(i=e.val()).system)return t.push(i),50<t.length&&(t=t.slice(t.length-50)),this.session.set("chat",t),this.changedSessionProperties.chat=!0,this.saveSession()},u.prototype.reallySaveSession=function(){var e,t,i,n,o,s;if(!_.isEmpty(this.changedSessionProperties)&&this.session.get("creator")===c.id&&!this.session.fake){for(i in this.changedSessionProperties.code&&(this.updateSessionConcepts(),n=this.changedSessionProperties.code,delete this.changedSessionProperties.code),Backbone.Mediator.publish("level:session-will-save",{session:this.session}),t={},this.changedSessionProperties)t[i]=this.session.get(i);if(n)for(s in e=this.session.get("code"),t.code=null!=e?e:{"hero-placeholder":{plan:""},"hero-placeholder-1":{plan:""}},n)o=n[s],t.code[o]=e[s];return this.changedSessionProperties={},new r({_id:this.session.id}).save(t,{patch:!0,type:"PUT"})}},u.prototype.updateSessionConcepts=function(){var e,t;if("javascript"===(e=this.session.get("codeLanguage"))||"python"===e)try{return t=n({ast:this.session.lastAST,language:this.session.get("codeLanguage")}),t=_.without(t,"basic_syntax"),this.session.set("codeConcepts",t),this.changedSessionProperties.codeConcepts=!0}catch(e){return t=e,console.error("Unable to parse concepts from this AST."),console.error(t)}},u.prototype.destroy=function(){var e,t,i;for(clearInterval(this.timerIntervalID),e=0,t=(i=this.vuexDestroyFunctions).length;e<t;e++)(0,i[e])();return u.__super__.destroy.call(this)},u)}.call(this,p(17))},2225:function(p,e,d){!function(n){var e,o,s,a,i,r,t,l,c=function(e,t){return function(){return e.apply(t,arguments)}},h={}.hasOwnProperty;function u(){return this.onWindowResize=c(this.onWindowResize,this),this.onUnveilEnded=c(this.onUnveilEnded,this),this.unveilIntro=c(this.unveilIntro,this),this.onClickStartLevel=c(this.onClickStartLevel,this),this.finishShowingReady=c(this.finishShowingReady,this),u.__super__.constructor.apply(this,arguments)}d(2223),e=d(26),t=d(2551),d(1383),l=d(6),a=d(1403),i=d(167),s=d(622),o=d(2226).default,r=d(52),p.exports=(function(e,t){for(var i in t)h.call(t,i)&&(e[i]=t[i]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(u,e),u.prototype.id="level-loading-view",u.prototype.template=t,u.prototype.events={"mousedown .start-level-button":"startUnveiling","click .start-level-button":"onClickStartLevel","click .start-subscription-button":"onClickStartSubscription"},u.prototype.subscriptions={"level:loaded":"onLevelLoaded","level:session-loaded":"onSessionLoaded","level:subscription-required":"onSubscriptionRequired","level:course-membership-required":"onCourseMembershipRequired","level:license-required":"onLicenseRequired","subscribe-modal:subscribed":"onSubscribed"},u.prototype.shortcuts={enter:"onEnterPressed"},u.prototype.afterRender=function(){var e,t;return u.__super__.afterRender.call(this),null!=(e=this.level)&&e.get("loadingTip")||(_.random(1,10)<9&&this.$el.find(".tip.rare").remove(),t=this.$el.find(".tip").addClass("to-remove"),t=_.sample(t),n(t).removeClass("to-remove").addClass("secret"),this.$el.find(".to-remove").remove()),null!=(t=this.options.level)&&t.get("goals")&&this.onLevelLoaded({level:this.options.level}),this.configureACEEditors()},u.prototype.configureACEEditors=function(){for(var t,e,i,n=(null!=(e=this.session)?e.get("codeLanguage"):void 0)||(null!=(i=me.get("aceConfig"))?i.language:void 0)||"python",o=null!=(i=this.aceEditors)?i:[],s=0,r=o.length;s<r;s++)o[s].destroy();return this.aceEditors=[],t=this.aceEditors,this.$el.find('pre:has(code[class*="lang-"])').each(function(){var e=a.initializeACE(this,n);return t.push(e)})},u.prototype.afterInsert=function(){return u.__super__.afterInsert.call(this)},u.prototype.onLevelLoaded=function(e){if(!this.level)return this.level=e.level,this.prepareGoals(e),this.prepareTip(),this.prepareIntro()},u.prototype.onSessionLoaded=function(e){if(!this.session)return e.session.get("creator")===me.id?this.session=e.session:void 0},u.prototype.prepareGoals=function(){var t,i;return this.levelGoalsComponent=new o({el:this.$(".list-unstyled")[0],store:r,propsData:{showStatus:!1}}),this.levelGoalsComponent.goals=this.level.get("goals"),t=this.$el.find(".level-loading-goals"),this.buttonTranslationKey="play_level.loading_start","cumulative"===this.level.get("assessment")?this.buttonTranslationKey="play_level.loading_start_combo":this.level.get("assessment")&&(this.buttonTranslationKey="play_level.loading_start_concept"),this.$(".start-level-button").text(n.i18n.t(this.buttonTranslationKey)),Vue.nextTick((i=this,function(){var e=t.find("li").length;if(e)return t.removeClass("secret"),"cumulative"===i.level.get("assessment")?i.goalHeaderTranslationKey=1<e?"play_level.combo_challenge_goals":"play_level.combo_challenge_goal":i.level.get("assessment")?i.goalHeaderTranslationKey=1<e?"play_level.concept_challenge_goals":"play_level.concept_challenge_goal":i.goalHeaderTranslationKey=1<e?"play_level.goals":"play_level.goal",t.find(".goals-title").text(n.i18n.t(i.goalHeaderTranslationKey))}))},u.prototype.prepareTip=function(){var e,t=this.$el.find(".tip");return this.level.get("loadingTip")&&(e=l.i18n(this.level.attributes,"loadingTip"),e=marked(e),t.html(e).removeAttr("data-i18n")),t.removeClass("secret")},u.prototype.prepareIntro=function(){var e;if(this.docs=null!=(e=this.level.get("documentation"))?e:{},e=this.docs.specificArticles||[],this.intro=_.find(e,{name:"Intro"}),window.serverConfig.picoCTF)return null!=this.intro?this.intro:this.intro={body:""}},u.prototype.showReady=function(){if(!this.shownReady)return this.shownReady=!0,_.delay(this.finishShowingReady,100)},u.prototype.finishShowingReady=function(){var e;if(!this.destroyed)return(null!=(e=l.getQueryVariable("intro"))?!e:this.options.autoUnveil||(null!=(e=this.session)?e.get("state").complete:void 0))?(this.startUnveiling(),this.unveil(!0)):(this.playSound("level_loaded",.75),this.$el.find(".progress").hide(),this.$el.find(".start-level-button").show(),this.unveil(!1))},u.prototype.startUnveiling=function(e){return this.playSound("menu-button-click"),this.unveiling=!0,Backbone.Mediator.publish("level:loading-view-unveiling",{}),_.delay(this.onClickStartLevel,1e3)},u.prototype.onClickStartLevel=function(e){if(!this.destroyed)return this.unveil(!0)},u.prototype.onEnterPressed=function(e){if(this.shownReady&&!this.unveiled)return this.startUnveiling(),this.onClickStartLevel()},u.prototype.unveil=function(e){var t;if(!this.destroyed&&!this.unveiled)return this.unveiled=e,this.$loadingDetails=this.$el.find("#loading-details"),t=1e3*parseFloat(this.$loadingDetails.css("transition-duration")),this.$el.hasClass("unveiled")||(this.$el.addClass("unveiled"),this.unveilWings(t)),e?(this.unveilLoadingFull(),_.delay(this.onUnveilEnded,t)):this.unveilLoadingPreview(t)},u.prototype.unveilLoadingFull=function(){var e,t,i;if(this.unveiling||(Backbone.Mediator.publish("level:loading-view-unveiling",{}),this.unveiling=!0),this.$el.hasClass("preview-screen")?this.$loadingDetails.css("right",-this.$loadingDetails.outerWidth(!0)):this.$loadingDetails.css("top",-this.$loadingDetails.outerHeight(!0)),this.$el.removeClass("preview-screen"),n("#canvas-wrapper").removeClass("preview-overlay"),this.unveilPreviewTime)return e=(null!=(i=this.level)?i.get("slug"):void 0)||(null!=(t=this.options.level)?t.get("slug"):void 0),i=((new Date).getTime()-this.unveilPreviewTime)/1e3,null!=(t=window.tracker)?t.trackEvent("Finish Viewing Intro",{category:"Play Level",label:"level loading",level:e,levelID:e,timespent:i}):void 0},u.prototype.unveilLoadingPreview=function(e){if(!this.$el.hasClass("preview-screen"))return n("#canvas-wrapper").addClass("preview-overlay"),this.$el.addClass("preview-screen"),this.$loadingDetails.addClass("preview"),this.resize(),this.onWindowResize=_.debounce(this.onWindowResize,700),n(window).on("resize",this.onWindowResize),this.intro&&(this.$el.find(".progress-or-start-container").addClass("intro-footer"),this.$el.find("#tip-wrapper").remove(),_.delay(this.unveilIntro,e)),this.unveilPreviewTime=(new Date).getTime()},u.prototype.resize=function(){var e,t=n("#page-container").outerHeight(!0),i=n("#code-area").outerHeight(!0);if(i-=20,this.$el.css({height:t}),this.$loadingDetails.css({minHeight:i,maxHeight:t}),this.intro)return(e=this.$el.find(".intro-doc")).css({height:i-e.offset().top-this.$el.find(".progress-or-start-container").outerHeight()-30-20}),_.defer(function(){return e.find(".nano").nanoScroller({alwaysVisible:!0})})},u.prototype.unveilWings=function(e){var t;if(this.playSound("loading-view-unveil",.5),this.$el.find(".left-wing").css({left:"-100%",backgroundPosition:"right -400px top 0"}),this.$el.find(".right-wing").css({right:"-100%",backgroundPosition:"left -400px top 0"}),null==(t=this.level)||!t.isType("web-dev"))return n("#level-footer-background").detach().appendTo("#page-container").slideDown(e)},u.prototype.unveilIntro=function(){var e,t;if(!this.destroyed&&this.intro&&!this.unveiled)return t=window.serverConfig.picoCTF&&(e=this.level.picoCTFProblem)?marked("### "+e.name+"\n\n"+this.intro.body+"\n\n"+e.description+"\n\n"+e.category+" - "+e.score+" points",{sanitize:!1}):(t=null!=(t=this.session)?t.get("codeLanguage"):void 0,marked(i.filterMarkdownCodeLanguages(l.i18n(this.intro,"body"),t))),this.$el.find(".intro-doc").removeClass("hidden").find(".intro-doc-content").html(t),this.resize(),this.configureACEEditors()},u.prototype.onUnveilEnded=function(){if(!this.destroyed)return Backbone.Mediator.publish("level:loading-view-unveiled",{view:this})},u.prototype.onWindowResize=function(e){if(!this.destroyed)return this.$loadingDetails.css({transition:"none"}),this.resize()},u.prototype.onSubscriptionRequired=function(e){return this.$el.find(".level-loading-goals, .tip, .progress-or-start-container").hide(),this.$el.find(".subscription-required").show()},u.prototype.onCourseMembershipRequired=function(e){return this.$el.find(".level-loading-goals, .tip, .progress-or-start-container").hide(),this.$el.find(".course-membership-required").show()},u.prototype.onLicenseRequired=function(e){return this.$el.find(".level-loading-goals, .tip, .progress-or-start-container").hide(),this.$el.find(".license-required").show()},u.prototype.onLoadError=function(e){return this.$el.find(".level-loading-goals, .tip, .progress-or-start-container").hide(),this.$el.find(".could-not-load").show()},u.prototype.onClickStartSubscription=function(e){var t,i;return this.openModalView(new s),t=(null!=(t=this.level)?t.get("slug"):void 0)||(null!=(i=this.options.level)?i.get("slug"):void 0),null!=(i=window.tracker)?i.trackEvent("Show subscription modal",{category:"Subscription",label:"level loading",level:t,levelID:t}):void 0},u.prototype.onSubscribed=function(){return document.location.reload()},u.prototype.destroy=function(){var e,t;return n(window).off("resize",this.onWindowResize),t={commit:_.noop,dispatch:_.noop},null!=(e=this.levelGoalsComponent)&&e.$destroy(),null!=(e=this.levelGoalsComponent)&&(e.$store=t),u.__super__.destroy.call(this)},u)}.call(this,d(3))},2226:function(e,t,i){"use strict";i.r(t);var n,o=i(3036),s=i(1924);for(n in s)["default"].indexOf(n)<0&&function(e){i.d(t,e,function(){return s[e]})}(n);i(2555);var r=i(19),o=Object(r.a)(s.default,o.a,o.b,!1,null,"3673d432",null);t.default=o.exports},2227:function(c,e,h){!function(t){var i,e,L,n,M,o,s,D,r={}.hasOwnProperty,a=[].indexOf||function(e){for(var t=0,i=this.length;t<i;t++)if(t in this&&this[t]===e)return t;return-1};function l(e){var t;l.__super__.constructor.call(this,e),this.unwatchFn=o.watch(function(e,t){return t["game/levelSolution"]},(t=this,function(e){if(null!=e&&e.source)return t.onChangeMyCode(e.source)})),e.god||"web-dev"===e.level.get("type")||console.error("TomeView created with no God!")}h(2572),e=h(26),s=h(2574),M=h(44).me,L=h(2575),h(2228),i=h(2602),D=h(6),o=h(52),n=h(53),c.exports=(function(e,t){for(var i in t)r.call(t,i)&&(e[i]=t[i]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(l,e),l.prototype.id="tome-view",l.prototype.template=s,l.prototype.controlsEnabled=!0,l.prototype.cache=!1,l.prototype.subscriptions={"tome:spell-loaded":"onSpellLoaded","tome:cast-spell":"onCastSpell","tome:change-language":"updateLanguageForAllSpells","surface:sprite-selected":"onSpriteSelected","god:new-world-created":"onNewWorld","tome:comment-my-code":"onCommentMyCode","tome:select-primary-sprite":"onSelectPrimarySprite"},l.prototype.events={click:"onClick"},l.prototype.afterRender=function(){var e,t;return l.__super__.afterRender.call(this),this.worker=this.createWorker(),t=_.filter(this.options.thangs,function(e){return e.isProgrammable&&e.programmableMethods}),this.options.level.isType("web-dev")&&(this.fakeProgrammableThang=this.createFakeProgrammableThang())&&(t=[this.fakeProgrammableThang]),this.createSpells(t,null!=(e=t[0])?e.world:void 0),this.castButton=this.insertSubView(new i({spells:this.spells,level:this.options.level,session:this.options.session,god:this.options.god})),this.teamSpellMap=this.generateTeamSpellMap(this.spells),t.length||(this.cast(),t="Warning: There are no Programmable Thangs in this level, which makes it unplayable.",noty({text:t,layout:"topCenter",type:"warning",killer:!1,timeout:15e3,dismissQueue:!0,maxVisible:3}),console.warn(t)),delete this.options.thangs},l.prototype.onNewWorld=function(e){var t=_.filter(e.thangs,function(e){return e.isProgrammable&&e.programmableMethods&&e.inThangList});return this.createSpells(t,e.world)},l.prototype.onCommentMyCode=function(e){var t,i,n,o=this.spells;for(n in o)(i=o[n]).canWrite()&&(console.log("Commenting out",n),t=i.view.commentOutMyCode()+"Commented out to stop infinite loop.\n"+i.getSource(),i.view.updateACEText(t),i.view.recompile(!1));return this.cast()},l.prototype.onChangeMyCode=function(e){var t,i,n=this.spells,o=[];for(i in n)(t=n[i]).canWrite()&&(t.view.updateACEText(e),o.push(t.view.recompile(!1)));return o},l.prototype.createWorker=function(){return"undefined"==typeof Worker||null===Worker||n.application.isIPadApp?null:new Worker("/javascripts/workers/aether_worker.js")},l.prototype.generateTeamSpellMap=function(e){var t,i,n,o,s={};for(t in e)null==s[n=e[t].team]&&(s[n]=[]),o=(i=t.split("/"))[0],t=i[1],a.call(s[n],o)<0&&s[n].push(o);return s},l.prototype.createSpells=function(e,t){var i,n,o,s,r,a,l,c,h,u,p,d,m,f,g,y,v,b,w,k,x,S,C=null!=(p=null!=(u=this.options.session.get("codeLanguage"))?u:null!=(p=M.get("aceConfig"))?p.language:void 0)?p:"python",T=["play","level",this.options.levelID,this.options.session.id,"code"];for(null==this.spells&&(this.spells={}),null==this.thangSpells&&(this.thangSpells={}),i=0,s=e.length;i<s;i++)if(x=e[i],null==this.thangSpells[x.id])for(c in this.thangSpells[x.id]=[],d=x.programmableMethods)l=d[c],(h=[x.id,c])[0]=_.string.slugify(h[0]),w=h.join("/"),this.thangSpells[x.id].push(w),v=D.getQueryVariable("skip_protect_api",!1),b=this.spells[w]=new L({hintsState:this.options.hintsState,programmableMethod:l,spellKey:w,pathComponents:T.concat(h),session:this.options.session,otherSession:this.options.otherSession,supermodel:this.supermodel,skipProtectAPI:v,worker:this.worker,language:C,spectateView:this.options.spectateView,spectateOpponentCodeLanguage:this.options.spectateOpponentCodeLanguage,observing:this.options.observing,levelID:this.options.levelID,level:this.options.level,god:this.options.god,courseID:this.options.courseID,courseInstanceID:this.options.courseInstanceID});for(S in m=this.thangSpells)if(k=m[S],x=null!=(f=this.fakeProgrammableThang)?f:t.getThangByID(S))for(n=0,r=k.length;n<r;n++)w=k[n],this.spells[w].addThang(x);else for(delete this.thangSpells[S],o=0,a=(g=this.spells).length;o<a;o++)(b=g[o]).removeThangID(S);for(w in y=this.spells)(b=y[w]).canRead()||(b.transpile(),b.loaded=!0);return null},l.prototype.onSpellLoaded=function(e){var t,i,n=this.spells;for(i in n)if(!n[i].loaded)return;return t=this.options.level.isType("game-dev"),this.cast(!1,!1,t)},l.prototype.onCastSpell=function(e){return this.cast(null!=e?e.preload:void 0,null!=e?e.realTime:void 0,null!=e?e.justBegin:void 0,null!=e?e.cinematic:void 0)},l.prototype.cast=function(e,t,i,n){var o;if(null==e&&(e=!1),null==t&&(t=!1),null==i&&(i=!1),null==n&&(n=!1),!this.options.level.isType("web-dev")){var s,r=null!=(r=this.options.session.get("state"))?r:{};return t&&(r.submissionCount=(null!=(o=r.submissionCount)?o:0)+1,r.flagHistory=_.filter(null!=(o=r.flagHistory)?o:[],(s=this,function(e){return e.team!==(null!=(e=s.options.session.get("team"))?e:"humans")})),this.options.level.get("replayable")&&(r.lastUnsuccessfulSubmissionTime=new Date),this.options.session.set("state",r)),o=null!=(o=r.difficulty)?o:0,this.options.observing&&(o=Math.max(0,o-1)),Backbone.Mediator.publish("level:set-playing",{playing:!1}),Backbone.Mediator.publish("tome:cast-spells",{spells:this.spells,preload:e,realTime:t,synchronous:this.options.level.isType("game-dev")&&!i,justBegin:i,cinematic:n,difficulty:o,submissionCount:null!=(o=r.submissionCount)?o:0,flagHistory:null!=(r=r.flagHistory)?r:[],god:this.options.god,fixedSeed:this.options.fixedSeed,keyValueDb:null!=(r=this.options.session.get("keyValueDb"))?r:{}})}},l.prototype.onClick=function(e){if(!t(e.target).parents(".popover").length)return Backbone.Mediator.publish("tome:focus-editor",{})},l.prototype.onSpriteSelected=function(e){var t;if(!this.spellView||"hero"!==(t=this.options.level.get("type",!0))&&"hero-ladder"!==t&&"hero-coop"!==t&&"course"!==t&&"course-ladder"!==t&&"game-dev"!==t&&"web-dev"!==t&&"ladder"!==t)return null!=(t=this.spellFor(e.thang,e.spellName))&&t.canRead()?this.setSpellView(t,e.thang):void 0},l.prototype.setSpellView=function(e,t){var i;return e.view!==this.spellView&&(this.spellView=e.view,this.spellTopBarView=e.topBarView,this.$el.find("#"+this.spellView.id).after(this.spellView.el).remove(),this.$el.find("#"+this.spellTopBarView.id).after(this.spellTopBarView.el).remove(),null!=(i=this.castButton)&&i.attachTo(this.spellView)),this.updateSpellPalette(t,e),null!=(e=this.spellView)?e.setThang(t):void 0},l.prototype.updateSpellPalette=function(e,t){var i;return null!=(i=this.options.playLevelView)?i.updateSpellPalette(e,t):void 0},l.prototype.spellFor=function(o,e){var t,i,s;return null!=o&&o.isProgrammable?this.thangSpells[o.id]?(t=function(){for(var e=this.thangSpells[o.id],t=[],i=0,n=e.length;i<n;i++)s=e[i],t.push(this.spells[s]);return t}.call(this),e?i=_.find(t,{name:e}):null==(i=_.find(t,function(e){return e.canWrite()}))&&(i=_.find(t,function(e){return e.canRead()})),i):void 0:null},l.prototype.reloadAllCode=function(){var e,t,i,n;for(n in D.getQueryVariable("dev")&&(this.options.playLevelView.spellPaletteView.destroy(),this.updateSpellPalette(this.spellView.thang,this.spellView.spell)),e=this.spells)!(i=e[n]).view||i.team!==M.team&&"common"!==(t=i.team)&&"neutral"!==t&&null!==t||i.view.reloadCode(!1);return this.cast(!1,!1)},l.prototype.updateLanguageForAllSpells=function(e){var t,i,n=this.spells;for(i in n)(t=n[i]).canWrite()&&t.updateLanguageAether(e.language);return e.reload?this.reloadAllCode():this.cast()},l.prototype.onSelectPrimarySprite=function(e){if(!this.options.level.isType("web-dev"))return"ogres"===this.options.session.get("team")?Backbone.Mediator.publish("level:select-sprite",{thangID:"Hero Placeholder 1"}):Backbone.Mediator.publish("level:select-sprite",{thangID:"Hero Placeholder"});this.setSpellView(this.spells["hero-placeholder/plan"],this.fakeProgrammableThang)},l.prototype.createFakeProgrammableThang=function(){var e,t,i,n,o;return(n=_.find(this.options.level.get("thangs"),{id:"Hero Placeholder"}))&&(e=_.find(n.components,function(e){return null!=(e=e.config)?e.programmableMethods:void 0}).config)?(i=_.find(n.components,function(e){return null!=(e=e.config)?e.programmableHTMLProperties:void 0}).config,o=null!=(t=_.find(n.components,function(e){return null!=(e=e.config)?e.programmableWebJavaScriptProperties:void 0}))?t.config:void 0,n=null!=(t=_.find(n.components,function(e){return null!=(e=e.config)?e.programmableJQueryProperties:void 0}))?t.config:void 0,i||console.warn("Couldn't find usesHTML config; is it presented and not defaulted on the Hero Placeholder?"),t={id:"Hero Placeholder",isProgrammable:!0},_.merge(t,e,i,o,n)):null},l.prototype.destroy=function(){var e,t,i=this.spells;for(t in i)i[t].destroy();return null!=(e=this.worker)&&e.terminate(),this.unwatchFn(),l.__super__.destroy.call(this)},l)}.call(this,h(3))},2228:function(r,e,l){!function(D,i){var e,n,p,o,I,A,te,a,t=function(e,t){return function(){return e.apply(t,arguments)}},s={}.hasOwnProperty,ie=[].indexOf||function(e){for(var t=0,i=this.length;t<i;t++)if(t in this&&this[t]===e)return t;return-1};function R(){return this.hide=t(this.hide,this),this.onResize=t(this.onResize,this),R.__super__.constructor.apply(this,arguments)}l(2595),e=l(26),l(44).me,l(1741),I=l(2597),A=l(2599),p=l(619),te=l(1374),n=l(1930),o=l(1488),l(1383),a=l(1403),r.exports=(function(e,t){for(var i in t)s.call(t,i)&&(e[i]=t[i]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(R,e),R.prototype.id="spell-palette-view",R.prototype.template=l(2601),R.prototype.controlsEnabled=!0,R.prototype.subscriptions={"level:disable-controls":"onDisableControls","level:enable-controls":"onEnableControls","surface:frame-changed":"onFrameChanged","tome:change-language":"onTomeChangedLanguage","tome:palette-clicked":"onPalleteClick","surface:stage-mouse-down":"hide"},R.prototype.events={"click #spell-palette-help-button":"onClickHelp","click .closeBtn":"onClickClose","click .section-header":"onSectionHeaderClick"},R.prototype.initialize=function(e){var t;return this.level=e.level,this.session=e.session,this.thang=e.thang,this.useHero=e.useHero,this.aceEditors=[],e=null!=(t=this.options.level.get("documentation"))?t:{},this.showsHelp=(null!=(t=e.specificArticles)?t.length:void 0)||(null!=(e=e.generalArticles)?e.length:void 0),this.createPalette(),D(window).on("resize",this.onResize)},R.prototype.getRenderData=function(){var e=R.__super__.getRenderData.call(this);return e.entryGroups=this.entryGroups,e.entryGroupSlugs=this.entryGroupSlugs,e.entryGroupNames=this.entryGroupNames,e.tabbed=1<_.size(this.entryGroups),e.defaultGroupSlug=this.defaultGroupSlug,e.showsHelp=this.showsHelp,e.tabs=this.tabs,e.thisName={coffeescript:"@",lua:"self",python:"self",java:"hero",cpp:"hero"}[this.options.language]||"this",e._=_,e},R.prototype.afterRender=function(){var e,t,i,n,o,s,r,a,l,c,h,u,p,d,m,f,g,y,v,b,w,k,x,S,C,T,L,M;if(R.__super__.afterRender.call(this),this.entryGroupSlugs){for(l in w=this.entryGroups)for(t in o=w[l],c=this.entryGroupSlugs[l],o)for(r=o[t],e=D('<div class="property-entry-column"></div>').appendTo(this.$el.find(".properties-"+c)),m=0,y=r.length;m<y;m++)s=r[m],e.append(s.el),s.render();this.$(".nano").nanoScroller({alwaysVisible:!0}),this.updateCodeLanguage(this.options.language)}else{for(l in this.entryGroupElements={},k=this.entryGroups)for(o=k[l],this.entryGroupElements[l]=u=D('<div class="property-entry-item-group"></div>').appendTo(this.$el.find(".properties-this")),null!=(x=o[0].options.item)&&x.getPortraitURL&&(p=D('<img class="item-image" draggable=false></img>').attr("src",o[0].options.item.getPortraitURL()),u.append(p),function(t){p.on("mouseenter",function(e){return t.onMouseEnter(e)}),p.on("mouseleave",function(e){return t.onMouseLeave(e)})}(o[0])),a=f=0,v=o.length;f<v;a=++f)s=o[a],u.append(s.el),s.render(),1===o.length&&s.$el.addClass("single-entry"),0===a&&s.$el.addClass("first-entry");for(C in S=this.tabs||{})for(o=S[C],T=_.string.slugify(C),a=g=d=0,b=o.length;g<b;a=++g)s=o[a],(0===d||2===d&&a!==o.length-1)&&(u=D('<div class="property-entry-item-group"></div>').appendTo(this.$el.find(".properties-"+T)),d=0),++d,u.append(s.el),s.render(),0===d&&s.$el.addClass("first-entry");this.$el.addClass("hero"),this.$el.toggleClass("shortenize",Boolean(this.shortenize)),this.$el.toggleClass("web-dev",this.options.level.isType("web-dev"))}for(i in M=this.supermodel.getModels(te),this.deferredDocs){if("spawnable"===(n=this.deferredDocs[i]).type){if(L=n.name,this.thang.spawnAliases[L]&&(L=this.thang.spawnAliases[L][0]),h=this.thang.buildables[L],null==(L=_.find(M,function(e){return e.get("original")===(null!=h?h.thangType:void 0)})))continue;L=new A({doc:n,thang:L,buildable:h,buildableName:n.name,shortenize:!0,language:this.options.language,level:this.options.level,useHero:this.useHero}),this.$el.find("#palette-tab-stuff-area").append(L.el),L.render()}"event"===n.type&&(L=new I({doc:n,thang:this.thang,shortenize:!0,language:this.options.language,level:this.options.level,useHero:this.useHero}),this.$el.find("#palette-tab-events").append(L.el),L.render()),"handler"===n.type&&(L=new I({doc:n,thang:this.thang,shortenize:!0,language:this.options.language,level:this.options.level,useHero:this.useHero}),this.$el.find("#palette-tab-handlers").append(L.el),L.render()),"property"===n.type&&(L=new I({doc:n,thang:this.thang,shortenize:!0,language:this.options.language,level:this.options.level,writable:!0}),this.$el.find("#palette-tab-properties").append(L.el),L.render()),"snippet"===n.type&&"game-dev"===this.level.get("type")&&(L=new I({doc:n,thang:this.thang,isSnippet:!0,shortenize:!0,language:this.options.language,level:this.options.level}),this.$el.find("#palette-tab-snippets").append(L.el),L.render())}return this.$(".section-header:has(+.collapse:empty)").hide()},R.prototype.afterInsert=function(){return R.__super__.afterInsert.call(this),_.delay((t=this,function(){var e;if(!D("#spell-view").is(".shown"))return null!=(e=t.$el)?e.css("bottom",0):void 0}));var t},R.prototype.updateCodeLanguage=function(e){return this.options.language=e},R.prototype.onResize=function(e){return"function"==typeof this.updateMaxHeight?this.updateMaxHeight():void 0},R.prototype.createPalette=function(){var e,t,i,n,o,s,r,a,l,c,h,u;for(Backbone.Mediator.publish("tome:palette-cleared",{thangID:this.thang.id}),e={},i={},n=0,r=(s=this.supermodel.getModels(p)).length;n<r;n++)for(o=0,a=(h=null!=(c=s[n].get("propertyDocumentation"))?c:[]).length;o<a;o++)!(t=h[o]).codeLanguages||(u=this.options.language,0<=ie.call(t.codeLanguages,u))?(null==e[u="__"+t.name]&&(e[u]=[]),e["__"+t.name].push(t),"snippet"===t.type&&(t.owner="snippets")):i["__"+t.name]=t;return l=this.options.programmable?{this:"programmableProperties",more:"moreProgrammableProperties",Math:"programmableMathProperties",Array:"programmableArrayProperties",Object:"programmableObjectProperties",String:"programmableStringProperties",Global:"programmableGlobalProperties",Function:"programmableFunctionProperties",RegExp:"programmableRegExpProperties",Date:"programmableDateProperties",Number:"programmableNumberProperties",JSON:"programmableJSONProperties",LoDash:"programmableLoDashProperties",Vector:"programmableVectorProperties",HTML:"programmableHTMLProperties",WebJavaScript:"programmableWebJavaScriptProperties",jQuery:"programmableJQueryProperties",CSS:"programmableCSSProperties",snippets:"programmableSnippets"}:{this:["apiProperties","apiMethods"]},this.options.level.isType("hero","hero-ladder","hero-coop","course","course-ladder","game-dev","web-dev","ladder")&&this.options.programmable?this.organizePaletteHero(l,e,i):this.organizePalette(l,e,i)},R.prototype.organizePalette=function(e,t,i){var n,o,s,r,a,l,c,h,u,p,d,m,f,g,y,v,b,w=0,k={};for(h in e)for(y=e[h],r=0,l=(y=_.isString(y)?[y]:y).length;r<l;r++)g=y[r],p=_.reject(null!=(d=this.thang[g])?d:[],function(e){return"_"===e[0]}),p=_.reject(p,function(e){if(this.thang.excludedProperties)return 0<=ie.call(this.thang.excludedProperties,e)}),p=_.uniq(p),g=_.sortBy(p).slice(),k[h]=(null!=(d=k[h])?d:[]).concat(g),w+=g.length;for(h in Backbone.Mediator.publish("tome:update-snippets",{propGroups:k,allDocs:t,language:this.options.language}),this.shortenize=6<w,v=10<=w,this.entries=[],k)for(a=0,c=(p=k[h]).length;a<c;a++)u=p[a],(m=_.find(null!=(m=t["__"+u])?m:[],function(e){return e.owner===h||!("this"!==h&&"more"!==h||null!=e.owner&&"this"!==e.owner)}))||i["__"+u]||(console.log("could not find doc for",u,"from",t["__"+u],"for",h,"of",k),null==m&&(m=u)),m&&this.entries.push(this.addEntry(m,this.shortenize,"snippets"===h));for(o in s=function(e){var t,i;return"this"===e.doc.owner&&(t=e.doc.name,0<=ie.call(null!=(i=k.more)?i:[],t))?"more":e.doc.owner},this.entries=_.sortBy(this.entries,function(e){var t=["this","more","Math","Vector","String","Object","Array","Function","HTML","CSS","WebJavaScript","jQuery","snippets"],i=t.indexOf(s(e));return(i=String.fromCharCode(-1===i?t.length:i))+e.doc.name}),v&&_.find(this.entries,function(e){return"this"!==e.doc.owner})?this.entryGroups=_.groupBy(this.entries,s):(b=D.i18n.t("play_level.tome_your_skills"),this.entryGroups={},this.entryGroups[b]=this.entries,this.defaultGroupSlug=_.string.slugify(b)),this.entryGroupSlugs={},this.entryGroupNames={},f=this.entryGroups)n=f[o],this.entryGroups[o]=_.groupBy(n,function(e,t){return Math.floor(t/4)}),this.entryGroupSlugs[o]=_.string.slugify(o),this.entryGroupNames[o]=o;if((b={coffeescript:"@",lua:"self",python:"self"}[this.options.language])&&this.entryGroupNames.this)return this.entryGroupNames.this=b},R.prototype.organizePaletteHero=function(e,t,i){var n,o,s,r,a,l,c,h,u,p,d,m,f,g,y,v,b,w,k,x,S,C,T,L,M,D,I,A,R,P,E,B,F,N,U,V,O,G,z,H,W,q,j,$,J,Y,K,X,Z,Q,ee;for(this.isHero=!0,u={},d=0,g=(F=this.supermodel.getModels(te)).length;d<g;d++)u[(ee=F[d]).get("name")]=ee;for(B={},R=0,p={},this.deferredDocs={},m=0,y=(Y=_.sortBy(_.keys(null!=(N=this.thang.inventoryThangTypeNames)?N:{}),function(e){return"left-hand"===e?0:"right-hand"===e?1:2})).length;m<y;m++)if(J=Y[m],c=u[Q=this.thang.inventoryThangTypeNames[J]]){for(c.get("components")||console.error("Item",c,"did not have any components when we went to assemble docs."),f=0,v=(G=null!=(O=c.get("components"))?O:[]).length;f<v;f++)if((n=G[f]).config)for(M in e)if(Z=e[M],E=n.config[Z])for(S=0,b=(z=_.sortBy(E)).length;S<b;S++)"_"===(A=z[S])[0]||p[A]||"moveXY"===A&&"slalom"===this.options.level.get("slug")||this.thang.excludedProperties&&0<=ie.call(this.thang.excludedProperties,A)||(null==B[T=c.get("name")]&&(B[T]=[]),B[c.get("name")].push({owner:M,prop:A,item:c}),p[A]=c,++R)}else console.log(this.thang.id,"couldn't find item ThangType for",J,Q);for(M in e)if(X=e[M],"this"!==M&&"more"!==M&&"snippets"!==M&&"HTML"!==M&&"CSS"!==M&&"WebJavaScript"!==M&&"jQuery"!==M&&null!=(H=this.thang[X])&&H.length)for(null==this.tabs&&(this.tabs={}),this.tabs[M]=[],I=u[this.thang.inventoryThangTypeNames["programming-book"]],C=0,w=(K=this.thang[X].slice().sort()).length;C<w;C++)A=K[C],this.thang.excludedProperties&&0<=ie.call(this.thang.excludedProperties,A)||(o=_.find(null!=(W=t["__"+A])?W:[],{owner:M}))&&(r=this.addEntry(o,!1,!1,I),this.tabs[M].push(r));for(M in e)if(X=e[M],"this"===M||"more"===M||"snippets"===M||"HTML"===M||"CSS"===M||"WebJavaScript"===M||"jQuery"===M)for(L=0,k=(j=_.reject(null!=(q=this.thang[X])?q:[],function(e){return p[e]||"_"===e[0]})).length;L<k;L++)"say"===(A=j[L])&&this.options.level.get("hidesSay")||"moveXY"===A&&"slalom"===this.options.level.get("slug")||this.thang.excludedProperties&&0<=ie.call(this.thang.excludedProperties,A)||(null==B.Hero&&(B.Hero=[]),B.Hero.push({owner:M,prop:A,item:u[this.thang.spriteName]}),++R);for(h in Backbone.Mediator.publish("tome:update-snippets",{propGroups:B,allDocs:t,language:this.options.language}),this.shortenize=6<R,this.entries=[],B)for(P=D=0,x=(E=B[h]).length;D<x;P=++D)c=(A=E[P]).item,M=A.owner,A=A.prop,(o=_.find(null!=($=t["__"+A])?$:[],function(e){return e.owner===M||!("this"!==M&&"more"!==M||null!=e.owner&&"this"!==e.owner&&"ui"!==e.owner)}))||i["__"+A]||(console.log("could not find doc for",A,"from",t["__"+A],"for",M,"of",B,"with item",c),null==o&&(o=A)),o&&("spawnable"===($=o.type)||"event"===$||"handler"===$||"property"===$||"snippet"===o.type&&"game-dev"===this.level.get("type")?this.deferredDocs[o.name]=o:this.entries.push(this.addEntry(o,this.shortenize,"snippets"===M,c,0<P)));for(a in this.options.level.isType("web-dev")?this.entryGroups=_.groupBy(this.entries,function(e){return e.doc.type}):this.entryGroups=_.groupBy(this.entries,function(e){return null!=(e=null!=(e=p[e.doc.name])?e.get("name"):void 0)?e:"Hero"}),l={},U=this.entryGroups)s=U[a],l[a]={item:{name:a,imageURL:null!=(V=u[a])?V.getPortraitURL():void 0},props:function(){for(var e=[],t=0,i=s.length;t<i;t++)r=s[t],e.push(r.doc);return e}()};return Backbone.Mediator.publish("tome:palette-updated",{thangID:this.thang.id,entryGroups:JSON.stringify(l)})},R.prototype.addEntry=function(e,t,i,n,o){var s,r;return null==i&&(i=!1),null==n&&(n=null),null==o&&(o=!1),r=_.isString(e)?e:e.name,r=0<=ie.call(null!=(s=this.thang.apiUserProperties)?s:[],r),new I({doc:e,thang:this.thang,shortenize:t,isSnippet:i,language:this.options.language,writable:r,level:this.options.level,item:n,showImage:o,useHero:this.useHero})},R.prototype.onDisableControls=function(e){return this.toggleControls(e,!1)},R.prototype.onEnableControls=function(e){return this.toggleControls(e,!0)},R.prototype.toggleControls=function(e,t){if((!e.controls||0<=ie.call(e.controls,"palette"))&&t!==this.controlsEnabled)return this.controlsEnabled=t,this.$el.find("*").attr("disabled",!t),this.$el.toggleClass("controls-disabled",!t)},R.prototype.onFrameChanged=function(e){var t;if((null!=(t=e.selectedThang)?t.id:void 0)===this.thang.id)return this.options.thang=this.thang=e.selectedThang},R.prototype.onTomeChangedLanguage=function(e){var t,i,n;for(this.updateCodeLanguage(e.language),t=0,i=(n=this.entries).length;t<i;t++)n[t].destroy();return this.createPalette(),this.render()},R.prototype.onSectionHeaderClick=function(e){var t,i=this.$(e.currentTarget),n=this.$(i.attr("data-panel"));return!n.hasClass("in")?(n.collapse("show"),i.find(".glyphicon").removeClass("glyphicon-chevron-right").addClass("glyphicon-chevron-down")):(n.collapse("hide"),i.find(".glyphicon").removeClass("glyphicon-chevron-down").addClass("glyphicon-chevron-right")),setTimeout((t=this,function(){return t.$(".nano").nanoScroller({alwaysVisible:!0})}),200),e.preventDefault()},R.prototype.onClickHelp=function(e){var t;return null!=(t=i.tracker)&&t.trackEvent("Spell palette help clicked",{levelID:this.level.get("slug")}),t=new n({showTab:"guide",level:this.level,session:this.session,supermodel:this.supermodel}),this.openModalView(t),this.listenToOnce(t,"change-hero",function(){var e;return null!=(e=this.setupManager)&&e.destroy(),this.setupManager=new o({supermodel:this.supermodel,level:this.level,levelID:this.level.get("slug"),parent:this,session:this.session,courseID:this.options.courseID,courseInstanceID:this.options.courseInstanceID}),this.setupManager.open()})},R.prototype.onClickClose=function(e){return this.hide()},R.prototype.hide=function(){return this.$el.find(".left .selected").removeClass("selected"),this.$el.removeClass("open")},R.prototype.onPalleteClick=function(e){var t,i,n,o,s,r;for(this.$el.addClass("open"),(n=this.$el.find(".rightContentTarget")).html(e.entry.doc.initialHTML),n.i18n(),this.applyRTLIfNeeded(),i=e.entry.options.language,o=0,s=(r=this.aceEditors).length;o<s;o++)r[o].destroy();return this.aceEditors=[],t=this.aceEditors,n.find(".docs-ace").each(function(){var e=a.initializeACE(this,i);return t.push(e)})},R.prototype.destroy=function(){for(var e,t=this.entries,i=0,n=t.length;i<n;i++)t[i].destroy();return this.toggleBackground=null,D(window).off("resize",this.onResize),null!=(e=this.setupManager)&&e.destroy(),R.__super__.destroy.call(this)},R)}.call(this,l(3),l(17))},2229:function(e,t,i){var I,a,l,s,A;function n(e){this.options=e,this.doc=_.cloneDeep(this.options.doc),this.fillOutDoc()}l=i(2230),a=i(81).downTheChain,window.Vector=i(47),A=i(6),I=i(167),s=function(e,a){var l=function(e,t,i){var n,o,s,r={};if(t=t||"",i=i||0,i++,a&&a<i)return"{depth over "+a+"}";for(n in e)o=(t?t+".":"")+n,"function"==typeof e[n]?r[n]="{function}":"object"==typeof e[n]?-1!==(s=c.indexOf(e[n]))?r[n]="{reference to "+h[s]+"}":(c.push(e[n]),h.push(o),r[n]=l(e[n],o,i)):r[n]=e[n];return r},c=[],h=[];return a=a||5,e="object"==typeof e?l(e):e,JSON.stringify(e,null,1)},e.exports=(n.prototype.fillOutDoc=function(){var e,t,i,n,o,s,r,a,l,c,h,u,p,d,m,f,g,y,v,b,w,k,x,S,C,T,L,M,D;for(_.isString(this.doc)&&(this.doc={name:this.doc,type:typeof this.options.thang[this.doc]}),this.options.isSnippet?(this.doc.type="snippet",this.doc.owner="snippets",this.doc.shortName=this.doc.shorterName=this.doc.title=this.doc.name):"HTML"===(m=this.doc.owner)||"CSS"===m||"WebJavaScript"===m||"jQuery"===m?this.doc.shortName=this.doc.shorterName=this.doc.title=this.doc.name:(null==(m=this.doc).owner&&(m.owner="this"),p=function(){if("this"!==this.doc.owner)return this.doc.owner;switch(this.options.language){case"python":case"lua":return this.options.useHero?"hero":"self";case"java":case"cpp":return"hero";case"coffeescript":return"@";default:return this.options.useHero?"hero":"this"}}.call(this),this.options.level.isType("game-dev")&&(p="game"),this.doc.ownerName=p,"function"===this.doc.type?(y=this.getDocNameAndArguments(),n=y[0],y=y[1].join(", "),t=y?"__ARGS__":"",this.doc.shortName=function(){switch(this.options.language){case"coffeescript":return p+("@"===p?"":".")+n+(t?" "+t:"()");case"python":return p+"."+n+"("+t+")";case"lua":return p+":"+n+"("+t+")";default:return p+"."+n+"("+t+");"}}.call(this)):this.doc.shortName=function(){switch(this.options.language){case"coffeescript":return p+("@"===p?"":".")+this.doc.name;case"python":case"lua":return p+"."+this.doc.name;default:return p+"."+this.doc.name+";"}}.call(this),this.doc.shorterName=this.doc.shortName,"function"===this.doc.type&&t&&(this.doc.shortName=this.doc.shorterName.replace(t,y),this.doc.shorterName=this.doc.shorterName.replace(t,!/cast[A-Z]/.test(this.doc.name)&&6<y.length?"...":y)),"event"!==(y=this.doc.type)&&"handler"!==y||(this.doc.shortName=this.doc.name,this.doc.shorterName=this.doc.name),"property"===this.doc.type&&(this.doc.shortName=this.doc.name.split(".").pop()||this.doc.name,this.doc.shorterName=this.doc.shortName),"ui"===this.doc.owner&&(this.doc.shortName=this.doc.shortName.replace(/^game./,""),this.doc.shorterName=this.doc.shortName),"javascript"===(y=this.options.language)||"java"===y||"cpp"===y?(this.doc.shorterName=this.doc.shortName.replace(";",""),"this"!==this.doc.owner&&!this.options.tabbify&&"game"!==p||(this.doc.shorterName=this.doc.shorterName.replace(/^(this|hero)\./,""))):"python"!==(L=this.options.language)&&"lua"!==L||"this"!==this.doc.owner&&!this.options.tabbify&&"game"!==p||(this.doc.shorterName=this.doc.shortName.replace(/^(self|hero|game)[:.]/,"")),this.doc.title=this.options.shortenize?this.doc.shorterName:this.doc.shortName,(L=A.i18n(this.doc,"name"))!==this.doc.name&&(this.doc.translatedShortName=this.doc.shortName.replace(this.doc.name,L))),T=[{obj:this.doc,prop:"description"},{obj:this.doc,prop:"example"}],s=0,l=(v=null!=(L=this.doc.args)?L:[]).length;s<l;s++)e=v[s],T.push({obj:e,prop:"example"},{obj:e,prop:"description"});for(this.doc.returns&&T.push({obj:this.doc.returns,prop:"example"},{obj:this.doc.returns,prop:"description"}),r=0,c=T.length;r<c;r++)if(null!=(b=(u=(b=T[r]).obj)[d=b.prop])&&b[this.options.language]||null==(w=u[d])||!w.javascript||("example"===d?u[d][this.options.language]=I.translateJS(u[d].javascript,this.options.language,!1):"lua"===(D=this.options.language)||"coffeescript"===D||"python"===D?u[d][this.options.language]=null!=(M=u[d].python)?M:u[d].javascript:"java"!==(f=this.options.language)&&"cpp"!==f||(u[d][this.options.language]=u[d].javascript)),(M=null!=(D=u[d])?D[this.options.language]:void 0)?u[d]=M:_.isString(u[d])||(u[d]=null),M=f=u[d]){if(i=this.doc.context,u[d]=M=A.i18n(u,d),_.isObject(M)&&((D=null!=(D=u[d])?D[this.options.language]:void 0)?u[d]=M=D:u[d]=f),this.doc.i18n)for(x=me.get("preferredLanguage");x;){if(null!=o&&(x=x.substr(0,x.lastIndexOf("-"))),S=null!=(S=this.doc.i18n[x])?S.context:void 0){i=_.merge(i,S);break}o=!0}if(i)try{u[d]=_.template(M,i)}catch(e){console.error("Couldn't create docs template of",M,"\nwith context",i,"\nError:",e)}u[d]=this.replaceSpriteName(u[d])}if(this.options.useHero&&(C={python:/self/g,javascript:/this/g,java:/this/g,cpp:/this/g,lua:/self/g})[this.options.language]&&(this.doc.example&&(this.doc.example=this.doc.example.replace(C[this.options.language],"hero")),null!=(L=this.doc.snippets)&&(null!=(L=L[this.options.language])&&L.code)&&this.doc.snippets[this.options.language].code.replace(C[this.options.language],"hero"),this.doc.args)){for(k=[],a=0,h=(g=this.doc.args).length;a<h;a++)(e=g[a]).example&&k.push(e.example=e.example.replace(C[this.options.language],"hero"));return k}},n.prototype.formatPopover=function(){var s,i,n,o,e=this.getDocNameAndArguments(),t=e[0],r=e[1],e=function(){for(var e,t=null!=(e=this.doc.args)?e:[],i=[],n=0,o=t.length;n<o;n++)s=t[n],i.push(s.example||s.default||s.name);return i}.call(this);return r.length>e.length&&e.unshift(r[0]),e=l({doc:this.doc,docName:t,language:this.options.language,value:this.formatValue(void 0,!0),marked:marked,argumentExamples:e,writable:this.options.writable,selectedMethod:this.options.selectedMethod,cooldowns:this.inferCooldowns(),item:this.options.item,_:_}),i="this"===this.doc.owner?this.options.thang:window[this.doc.owner],(e=(e=this.replaceSpriteName(e)).replace(/\#\{(.*?)\}/g,(n=this,function(e,t){return n.formatValue(a(i,t.split(".")))}))).replace(/{([a-z]+)}([^]*?){\/\1}/g,(o=this,function(e,t,i){return t!==o.options.language&&("javascript"!==t||"java"!==(t=o.options.language)&&"cpp"!==t)?"":i}))},n.prototype.replaceSpriteName=function(e){var t=null!=(t=this.options.thang.type)?t:this.options.thang.spriteName;return/Hero Placeholder/.test(this.options.thang.id)&&(t="hero"),e.replace(/#{spriteName}/g,t)},n.prototype.getDocNameAndArguments=function(){var s,e,t;return"function"!==this.doc.type?[this.doc.name,[]]:(t=this.doc.name,e=function(){for(var e,t=null!=(e=this.doc.args)?e:[],i=[],n=0,o=t.length;n<o;n++)s=t[n],i.push(s.name);return i}.call(this),/cast[A-Z]/.test(t)&&(t="cast",e.unshift('"'+_.string.dasherize(this.doc.name).replace("cast-","")+'"')),[t,e])},n.prototype.formatValue=function(n,e){var o;return null==e&&(e=!1),this.options.level.isType("web-dev")||"snippet"===this.doc.type?null:"now"===this.doc.name?this.options.thang.now():null==n&&"function"===this.doc.type&&e?"[Function]":(null==n&&(n=("this"===this.doc.owner?this.options.thang:window[this.doc.owner])[this.doc.name]),"number"!==this.doc.type||_.isNaN(n)?_.isString(n)?'"'+n+'"':null!=n&&n.id?n.id:null!=n&&n.name?n.name:_.isArray(n)?"["+function(){for(var e=[],t=0,i=n.length;t<i;t++)o=n[t],e.push(this.formatValue(o));return e}.call(this).join(", ")+"]":_.isPlainObject(n)?s(n,2):n:n===Math.round(n)?n:_.isNumber(n)?n.toFixed(2):null==n?"null":""+n)},n.prototype.inferCooldowns=function(){var e,t,i,n,o,s,r,a,l,c,h;if("function"!==this.doc.type||"this"!==this.doc.owner)return null;if(o=this.options.thang,t=null,c=(l=this.doc.name.match(/^cast(.+)$/))?(e=_.string.slugify(_.string.underscored(l[1])),r=null!=(r=o.spells)?r[e]:void 0,"spell"):(e=_.string.slugify(_.string.underscored(this.doc.name)),r=null!=(c=o.actions)?c[e]:void 0,"action"),!r)return null;for(t={cooldown:r.cooldown,specificCooldown:r.specificCooldown,name:e,type:c},i=0,n=(a=["range","radius","duration","damage"]).length;i<n;i++)s=a[i],h=o[_.string.camelize(e+_.string.capitalize(s))],"range"===s&&h<=5||(t[s]=h,_.isNumber(h)&&h!==Math.round(h)&&(t[s]=h.toFixed(2)));return t},n)},2230:function(e,t,i){var y=i(11);e.exports=function(e){var m,f=[],g={},e=e||{};return function(e,t,i,o,n,s,r,a,l,c,h,u,p){f.push('<h4 dir="ltr"><span class="prop-name">'+y.escape(null==(m=o.shortName)?"":m)+"</span> - ");var d="function"==o.type&&"this"==o.owner?"method":o.type;f.push("<code"+y.attr("data-i18n","skill_docs."+d,!0,!0)+' class="prop-type">\x3c!-- In case there\'s no translation in en.coffee because we missed one--\x3e'+y.escape(null==(m=d)?"":m)+"</code>\x3c!-- Redundant in case some tag docs are missing an owner--\x3e"),e.contains(["function","handler","basic tag","spawnable","event","snippet"],o.type)||"HTML"==o.owner||(f.push(" ("),p?f.push('<span data-i18n="skill_docs.writable">writable</span>'):f.push('<span data-i18n="skill_docs.read_only">read-only</span>'),f.push(")")),f.push("</h4>"),o.translatedShortName&&f.push('<h5><span class="translated-name">'+y.escape(null==(m=o.translatedShortName)?"":m)+"</span></h5>"),f.push('<div dir="auto" class="description rtl-allowed rtl-right-aligned"><p dir="auto">'+(null==(m=a(o.description||"Still undocumented, sorry."))?"":m)+'</p><div style="clear: both" class="clear"></div>'),i&&(i.cooldown||i.specificCooldown)&&(f.push("<p><span>"),"spell"==i.type?f.push('<span data-i18n="skill_docs.spell">Spell</span>'):f.push('<span data-i18n="skill_docs.action">Action</span>'),f.push('<span data-i18n="skill_docs.action_name" class="spl">name</span><span class="spr">:</span><code>"'+y.escape(null==(m=i.name)?"":m)+'"</code>.</span><span class="spl"><span data-i18n="skill_docs.action_cooldown">Takes</span><span class="spr">:</span><code>'+y.escape(null==(m=i.cooldown)?"":m)+"</code>s.\x3c!-- TODO: localize seconds (ex. Hebrew should say  instead of s)--\x3e</span>"),i.specificCooldown&&f.push('<span class="spl"><span data-i18n="skill_docs.action_specific_cooldown">Cooldown</span><span class="spr">:</span><code>'+y.escape(null==(m=i.specificCooldown)?"":m)+"</code>s.</span>"),i.damage&&f.push('<span class="spl"><span data-i18n="skill_docs.action_damage">Damage</span><span class="spr">:</span><code>'+y.escape(null==(m=i.damage)?"":m)+"</code>.</span>"),i.range&&f.push('<span class="spl"><span data-i18n="skill_docs.action_range">Range</span><span class="spr">:</span><code>'+y.escape(null==(m=i.range)?"":m)+"</code>m.</span>"),i.radius&&f.push('<span class="spl"><span data-i18n="skill_docs.action_radius">Radius</span><span class="spr">:</span><code>'+y.escape(null==(m=i.radius)?"":m)+"</code>m.</span>"),i.duration&&f.push('<span class="spl"><span data-i18n="skill_docs.action_duration">Duration</span><span class="spr">:</span><code>'+y.escape(null==(m=i.duration)?"":m)+"</code>s.</span>"),f.push("</p>")),f.push("</div>"),c||(o.example?f.push('<p class="example"><strong><span data-i18n="skill_docs.example">Example</span>:</strong><div class="docs-ace-container"><div class="docs-ace">'+y.escape(null==(m=o.example)?"":m)+"</div></div></p>"):"function"==o.type&&t.length&&(f.push('<p class="example"><strong><span data-i18n="skill_docs.example">Example</span>:</strong><div><div class="docs-ace-container"><div class="docs-ace">'),/javascript|java|cpp/.test(r)?f.push("<span>"+y.escape(null==(m=o.ownerName+"."+n+"("+t.join(", ")+");")?"":m)+"</span>"):"coffeescript"==r?f.push("<span>"+y.escape(null==(m=o.ownerName+("@"==o.ownerName?"":".")+n+" "+t.join(", "))?"":m)+"</span>"):"python"==r?f.push("<span>"+y.escape(null==(m=o.ownerName+"."+n+"("+t.join(", ")+")")?"":m)+"</span>"):"lua"==r&&f.push("<span>"+y.escape(null==(m=o.ownerName+":"+n+"("+t.join(", ")+")")?"":m)+"</span>"),f.push("</div></div></div></p>"))),("function"==o.type||"snippet"==o.type||"spawnable"==o.type||"event"==o.type||"handler"==o.type||"property"==o.type||e.contains(["HTML","CSS","WebJavaScript","jQuery"],o.owner))&&"now"!=o.name||f.push('<p class="value"><strong><span data-i18n="skill_docs.current_value">Current Value</span><span class="spr">:</span></strong><pre><code'+y.attr("data-prop",o.name,!0,!0)+' class="current-value">'+y.escape(null==(m=u)?"":m)+"</code></pre></p>"),g.argumentEntry=m=function(e){this&&this.block,this&&this.attributes;-1==["he","ar","fa","ur"].indexOf(l.get("preferredLanguage",!0))?(f.push("<div><code>"+y.escape(null==(m=e.name)?"":m)+'</code><span class="spr">:</span><code>'+y.escape(null==(m=e.type)?"":m)+"</code>"),e.example&&f.push(' (<span data-i18n="skill_docs.ex">ex</span><span class="spr">:</span><code>'+y.escape(null==(m=e.example)?"":m)+"</code>)"),e.description&&f.push("<div>"+(null==(m=a(e.description))?"":m)+"</div>"),e.default&&f.push('<div><em><span data-i18n="skill_docs.default_value">Default value</span><span class="spr">:</span></em><code>'+y.escape(null==(m=e.default)?"":m)+"</code></div>")):(f.push('<div dir="rtl"><code dir="rtl">'+y.escape(null==(m=e.name)?"":m)+'</code><span dir="rtl">'+y.escape(m=": ")+'</span><code dir="rtl">'+y.escape(null==(m=e.type)?"":m)+"</code>"),e.example&&f.push('<br><span data-i18n="skill_docs.ex" dir="rtl">ex</span><span dir="rtl">'+y.escape(m=": ")+'</span><code dir="ltr">'+y.escape(null==(m=e.example)?"":m)+"</code>"),e.description&&f.push('<div dir="auto" class="rtl-right-aligned">'+(null==(m=a(e.description))?"":m)+"</div>"),e.default&&f.push('<div class="rtl-allowed"><em><span data-i18n="skill_docs.default_value">Default value</span><span dir="rtl">'+y.escape(m=": ")+'</span></em><code dir="ltr">'+y.escape(null==(m=e.default)?"":m)+"</code></div>")),f.push("</div>")},o.args&&o.args.length&&(u=e.any(o.args,function(e){return e.optional}),e.any(o.args,function(e){return!e.optional})&&(f.push('<p dir="auto" class="args"><strong><span data-i18n="skill_docs.required_parameters">Required Parameters</span><span class="spr">:</span></strong></p>'),function(){var e=o.args;if("number"==typeof e.length)for(var t=0,i=e.length;t<i;t++)(n=e[t]).optional||g.argumentEntry(n);else{var n,i=0;for(t in e)i++,(n=e[t]).optional||g.argumentEntry(n)}}.call(this)),u&&(f.push('<p dir="auto" class="args"><strong><span data-i18n="skill_docs.optional_parameters">Optional Parameters</span><span class="spr">:</span></strong>'),function(){var e=o.args;if("number"==typeof e.length)for(var t=0,i=e.length;t<i;t++)(n=e[t]).optional&&g.argumentEntry(n);else{var n,i=0;for(t in e)i++,(n=e[t]).optional&&g.argumentEntry(n)}}.call(this),f.push("</p>"))),o.returns&&(f.push('<p dir="auto" class="returns"><strong><span data-i18n="skill_docs.returns">Returns</span><span class="spr">:</span></strong><div><code>'+y.escape(null==(m=o.returns.type)?"":m)+"</code>"),o.returns.example&&f.push(' (<span data-i18n="skill_docs.ex">ex</span><span class="spr">:</span><code>'+y.escape(null==(m=o.returns.example)?"":m)+"</code>)"),o.returns.description&&f.push("<div>"+(null==(m=a(o.returns.description))?"":m)+"</div>"),f.push("</div></p>")),s&&"function"==typeof s.get&&f.push('<p><em><span data-i18n="skill_docs.granted_by" class="spr">Granted by</span>'+y.escape(null==(m=s.get("name"))?"":m)+".</em></p>"),c&&f.push("<p><em>Write the body of this method below.</em></p>")}.call(this,"_"in e?e._:"undefined"!=typeof _?_:void 0,"argumentExamples"in e?e.argumentExamples:"undefined"!=typeof argumentExamples?argumentExamples:void 0,"cooldowns"in e?e.cooldowns:"undefined"!=typeof cooldowns?cooldowns:void 0,"doc"in e?e.doc:"undefined"!=typeof doc?doc:void 0,"docName"in e?e.docName:"undefined"!=typeof docName?docName:void 0,"item"in e?e.item:"undefined"!=typeof item?item:void 0,"language"in e?e.language:"undefined"!=typeof language?language:void 0,"marked"in e?e.marked:"undefined"!=typeof marked?marked:void 0,"me"in e?e.me:"undefined"!=typeof me?me:void 0,"selectedMethod"in e?e.selectedMethod:"undefined"!=typeof selectedMethod?selectedMethod:void 0,"undefined"in e?e.undefined:void 0,"value"in e?e.value:"undefined"!=typeof value?value:void 0,"writable"in e?e.writable:"undefined"!=typeof writable?writable:void 0),f.join("")}},2231:function(l,e,c){!function(a){var e,t,n,i,o=function(e,t){return function(){return e.apply(t,arguments)}},s={}.hasOwnProperty;function r(e){this.clearOldMessages=o(this.clearOldMessages,this),this.levelID=e.levelID,this.session=e.session,this.listenTo(this.session,"change:multiplayer",this.updateMultiplayerVisibility),this.sessionID=e.sessionID,this.bus=t.get(this.levelID,this.sessionID),r.__super__.constructor.call(this),this.regularlyClearOldMessages(),this.playNoise=_.debounce(this.playNoise,100)}c(2606),e=c(26),i=c(2608),n=c(44).me,t=c(2224),l.exports=(function(e,t){for(var i in t)s.call(t,i)&&(e[i]=t[i]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(r,e),r.prototype.id="level-chat-view",r.prototype.template=i,r.prototype.open=!1,r.prototype.events={"keypress textarea":"onChatKeydown","click i":"onIconClick"},r.prototype.subscriptions={"bus:new-message":"onNewMessage"},r.prototype.updateMultiplayerVisibility=function(){var t;if(null!=this.$el)try{return this.$el.toggle(Boolean(this.session.get("multiplayer")))}catch(e){return t=e,console.error("Couldn't toggle the style on the LevelChatView to "+Boolean(this.session.get("multiplayer"))+" because of an error:",t)}},r.prototype.afterRender=function(){return this.chatTables=a("table",this.$el),this.updateMultiplayerVisibility()},r.prototype.regularlyClearOldMessages=function(){return this.clearOldMessagesInterval=setInterval(this.clearOldMessages,5e3)},r.prototype.clearOldMessages=function(){for(var e,t,i=a(".closed-chat-area tr"),n=[],o=0,s=i.length;o<s;o++)t=i[o],e=(t=a(t)).data("added"),6e4<(new Date).getTime()-e?n.push(t.fadeOut(1e3,function(){return a(this).remove()})):n.push(void 0);return n},r.prototype.onNewMessage=function(e){if(e.message.system||this.$el.show(),this.addOne(e.message),this.trimClosedPanel(),e.message.authorID!==n.id)return this.playNoise()},r.prototype.playNoise=function(){return this.playSound("chat_received")},r.prototype.messageObjectToJQuery=function(e){var t=a("<td></td>"),i=e.content;return i=(i=(i=_.string.escapeHTML(i)).replace(/\n/g,"<br/>")).replace(RegExp("  ","g"),"&nbsp; "),_.string.startsWith(i,"/me")&&(i=e.authorName+i.slice(3)),e.system?t.append(a('<span class="system"></span>').html(i)):_.string.startsWith(i,"/me")?t.append(a('<span class="action"></span>').html(i)):(t.append(a("<strong></strong>").text(e.authorName+": ")),t.append(a("<span></span>").html(i))),i=a("<tr></tr>"),e.authorID===n.id&&i.addClass("me"),i.append(t)},r.prototype.addOne=function(e){var t,i;if(!e.system||e.authorID!==n.id)return this.open&&(t=(i=a(".open-chat-area",this.$el)).outerHeight(),i=i[0].scrollHeight-t-i[0].scrollTop<10),(e=this.messageObjectToJQuery(e)).data("added",(new Date).getTime()),this.chatTables.append(e),i?this.scrollDown():void 0},r.prototype.trimClosedPanel=function(){for(var e,t,i=a(".closed-chat-area",this.$el),n=a("tr",i),o=[],s=e=0,r=n.length;e<r&&(t=n[s],!(n.length-s<=5));s=++e)o.push(t.remove());return o},r.prototype.onChatKeydown=function(e){var t;if(key.isPressed("enter"))return(t=_.string.strip(a(e.target).val()))&&(this.bus.sendMessage(t),a(e.target).val("")),!1},r.prototype.onIconClick=function(){var e;return this.open=!this.open,a(".open-chat-area",this.$el).toggle(this.open),a(".closed-chat-area",this.$el).toggle(!this.open),this.open&&this.scrollDown(),null!=window.getSelection?("function"==typeof(e=window.getSelection()).empty&&e.empty(),"function"==typeof e.removeAllRanges?e.removeAllRanges():void 0):document.selection.empty()},r.prototype.scrollDown=function(){var e=a(".open-chat-area",this.$el)[0];return e.scrollTop=e.scrollHeight||1e6},r.prototype.destroy=function(){return key.deleteScope("level"),this.clearOldMessagesInterval&&clearInterval(this.clearOldMessagesInterval),r.__super__.destroy.call(this)},r)}.call(this,c(3))},2232:function(r,e,c){!function(a){var e,t,i,l,o={}.hasOwnProperty,n=[].indexOf||function(e){for(var t=0,i=this.length;t<i;t++)if(t in this&&this[t]===e)return t;return-1};function s(){return s.__super__.constructor.apply(this,arguments)}c(2609),e=c(26),i=c(2611),t=c(2612),l=c(6),r.exports=(function(e,t){for(var i in t)o.call(t,i)&&(e[i]=t[i]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(s,e),s.prototype.id="thang-hud",s.prototype.template=i,s.prototype.subscriptions={"surface:frame-changed":"onFrameChanged","level:disable-controls":"onDisableControls","level:enable-controls":"onEnableControls","surface:sprite-selected":"onSpriteSelected","sprite:thang-began-talking":"onThangBeganTalking","sprite:thang-finished-talking":"onThangFinishedTalking","god:new-world-created":"onNewWorld"},s.prototype.events={click:"onClick"},s.prototype.afterRender=function(){if(s.__super__.afterRender.call(this),this.$el.addClass("no-selection"),this.options.level.get("hidesHUD"))return this.hidesHUD=!0,this.$el.addClass("hide-hud-properties")},s.prototype.onClick=function(e){if(!a(e.target).parents(".thang-props").length)return Backbone.Mediator.publish("tome:focus-editor",{})},s.prototype.onFrameChanged=function(e){return this.timeProgress=e.progress,this.update()},s.prototype.onDisableControls=function(e){if(!e.controls||0<=n.call(e.controls,"hud"))return this.disabled=!0,this.$el.addClass("controls-disabled")},s.prototype.onEnableControls=function(e){if(!e.controls||0<=n.call(e.controls,"hud"))return this.disabled=!1,this.$el.removeClass("controls-disabled")},s.prototype.onSpriteSelected=function(e){if(!this.disabled)return this.setThang(e.thang,null!=(e=e.sprite)?e.thangType:void 0)},s.prototype.onNewWorld=function(e){var t=this.thang;if(this.thang&&(this.thang=e.world.thangMap[this.thang.id]),t&&!this.thang)return this.setThang(null,null)},s.prototype.setThang=function(e,t){if((null!=e||null!=this.thang)&&(null==e||null==this.thang||e.id!==this.thang.id)&&(null==e||!this.hidesHUD||"Hero Placeholder"===e.id)&&e&&(this.thang=e,this.thangType=t,this.thang))return this.createAvatar(t,this.thang),this.createProperties(),this.update()},s.prototype.createAvatar=function(e,t,i){var n,o,s,r;if(!e.isFullyLoaded())return n=arguments,void(this.listeningToCreateAvatar||(this.listenToOnce(e,"sync",function(){return this.createAvatar.apply(this,n)}),this.listeningToCreateAvatar=!0));if(this.listeningToCreateAvatar=!1,(o=t.getLankOptions()||{}).async=!1,i&&(o.colorConfig=i),r=this.$el.find(".thang-canvas-wrapper"),s=null!=(s=this.thang)?s.team:void 0,r.removeClass("hide"),r.removeClass(function(e,t){return(t.match(/\bteam-\S+/g)||[]).join(" ")}),r.addClass("team-"+s),e.get("raster"))r.empty().append(a('<img draggable="false"/>').addClass("avatar").attr("src","/file/"+e.get("raster")));else{if(!(s=e.getPortraitStage(o,100)))return;o=a(s.canvas).addClass("thang-canvas avatar"),r.empty().append(o),s.update(),null!=(o=this.stage)&&o.stopTalking(),this.stage=s}return r.append(a('<img draggable="false" />').addClass("avatar-frame").attr("src","/images/level/thang_avatar_frame.png"))},s.prototype.onThangBeganTalking=function(e){if(this.stage&&this.thang===e.thang)return null!=(e=this.stage)?e.startTalking():void 0},s.prototype.onThangFinishedTalking=function(e){if(this.stage&&this.thang===e.thang)return null!=(e=this.stage)?e.stopTalking():void 0},s.prototype.createProperties=function(){var e,t,i,n,o,s,r,a=this.options.level.isType("game-dev")?"Game":"Hero Placeholder"===(s=this.thang.id)||"Hero Placeholder 1"===s?(null!=(a=this.thangType)?a.getHeroShortName():void 0)||"Hero":this.thang.hudName||(this.thang.type?this.thang.id+" - "+this.thang.type:this.thang.id);for(l.replaceText(this.$el.find(".thang-name"),a),(o=this.$el.find(".thang-props")).find(".prop").remove(),e=t=0,i=(r=null!=(a=this.thang.hudProperties)?a:[]).length;t<i;e=++t)n=r[e],null!=(n=this.createPropElement(n))&&(n.find(".bar").is("*")&&o.find(".bar").is("*")?o.find(".bar-prop").last().after(n):o.append(n));return null},s.prototype.update=function(){var e,t,i,n,o,s;if(this.thang&&(this.$el.find(".thang-props-column").toggleClass("nonexistent",!this.thang.exists),this.thang.exists)){for(s=[],e=0,t=(o=null!=(n=this.thang.hudProperties)?n:[]).length;e<t;e++)i=o[e],s.push(this.updatePropElement(i,this.thang[i]));return s}},s.prototype.createPropElement=function(e){return"maxHealth"===e?null:a(t({prop:e,hasIcon:"health"===e||"pos"===e||"target"===e||"collectedThangIDs"===e||"gold"===e||"bountyGold"===e||"value"===e||"visualRange"===e||"attackDamage"===e||"attackRange"===e||"maxSpeed"===e||"attackNearbyEnemyRange"===e,hasBar:"health"===e}))},s.prototype.updatePropElement=function(e,t){var i,n,o,s=this.$el.find(".thang-props *[name="+e+"]");if("maxHealth"!==e)return"health"===e?(i=this.thang["max"+e.charAt(0).toUpperCase()+e.slice(1)],o=this.thang[e+"ReplenishRate"],n=Math.round(100*t/i),s.find(".bar").css("width",n+"%"),i=e+": "+this.formatValue(e,t)+" / "+this.formatValue(e,i),o&&(i+=" (+"+this.formatValue(e,o)+"/s)"),l.replaceText(s.find(".bar-prop-value"),Math.round(t))):(i=e+": "+(o=this.formatValue(e,t)),"attackDamage"===e&&(t=this.thang.actions.attack.cooldown,e=this.thang.attackDamage/t,i+=" / "+t.toFixed(2)+"s (DPS: "+e.toFixed(2)+")"),l.replaceText(s.find(".prop-value"),o)),s.attr("title",i),s},s.prototype.formatValue=function(e,t){if("target"!==e||t||null!=(t=this.thang.targetPos)&&t.isZero()&&(t=null),"rotation"===e)return(180*t/Math.PI).toFixed(0)+"";if(-1!==e.search(/Range$/))return t+"m";if("number"==typeof t)return Math.round(t)===t||"gold"===e?t.toFixed(0):-10<t&&t<10?t.toFixed(2):-100<t&&t<100?t.toFixed(1):t.toFixed(0);if(t&&"object"==typeof t){if(t.id)return t.id;if(t.x&&t.y)return"x: "+t.x.toFixed(0)+" y: "+t.y.toFixed(0)}else if(null==t)return"No "+e;return t},s.prototype.destroy=function(){var e;return null!=(e=this.stage)&&e.stopTalking(),s.__super__.destroy.call(this)},s)}.call(this,c(3))},2233:function(g,e,y){!function(n,o){var s,r,e,a,l,t,i,c,h,u,p,d={}.hasOwnProperty,m=[].indexOf||function(e){for(var t=0,i=this.length;t<i;t++)if(t in this&&this[t]===e)return t;return-1};function f(e){var t,i,n,o;this.supermodel=e.supermodel,this.courseID=e.courseID,this.courseInstanceID=e.courseInstanceID,this.worldName=e.worldName,this.session=e.session,this.level=e.level,this.levelSlug=this.level.get("slug"),this.levelID=this.levelSlug||this.level.id,this.spectateGame=null!=(i=e.spectateGame)&&i,this.observing=e.session.get("creator")!==h.id,this.levelNumber="",this.level.isType("course","game-dev","web-dev")&&null!=this.level.get("campaignIndex")&&(this.levelNumber=this.level.get("campaignIndex")+1),this.courseInstanceID?(this.courseInstance=new l({_id:this.courseInstanceID}),t=this.courseInstance.fetch(),this.supermodel.trackRequest(t),new Promise(t.then).then((o=this,function(){return o.classroom=new r({_id:o.courseInstance.get("classroomID")}),o.course=new a({_id:o.courseInstance.get("courseID")}),o.supermodel.trackRequest(o.classroom.fetch()),o.supermodel.trackRequest(o.course.fetch())}))):this.courseID&&(this.course=new a({_id:this.courseID}),t=this.course.fetch(),this.supermodel.trackRequest(t),new Promise(t.then).then((n=this,function(){return n.campaign=new s({_id:n.course.get("campaignID")}),n.supermodel.trackRequest(n.campaign.fetch())}))),f.__super__.constructor.call(this,e),this.level.get("replayable")&&this.listenTo(this.session,"change-difficulty",this.onSessionDifficultyChanged)}y(2618),y(32),e=y(26),u=y(2620),h=y(44).me,p=y(6),s=y(1378),r=y(116),a=y(1376),l=y(166),i=y(1930),c=y(1488),t=y(118),g.exports=(function(e,t){for(var i in t)d.call(t,i)&&(e[i]=t[i]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(f,e),f.prototype.id="control-bar-view",f.prototype.template=u,f.prototype.subscriptions={"level:disable-controls":"onDisableControls","level:enable-controls":"onEnableControls","ipad:memory-warning":"onIPadMemoryWarning"},f.prototype.events={"click #next-game-button":function(){return Backbone.Mediator.publish("level:next-game-pressed",{})},"click #game-menu-button":"showGameMenuModal",click:function(){return Backbone.Mediator.publish("tome:focus-editor",{})},"click .levels-link-area":"onClickHome","click .home a":"onClickHome","click #control-bar-sign-up-button":"onClickSignupButton","click #version-switch-button":"onClickVersionSwitchButton","click #version-switch-button .code-language-selector":"onClickVersionSwitchButton",'click [data-toggle="coco-modal"][data-target="core/CreateAccountModal"]':"openCreateAccountModal"},f.prototype.setLevelName=function(e){return this.levelName=e,this.render()},f.prototype.onLoaded=function(){return this.classroom?this.levelNumber=this.classroom.getLevelNumber(this.level.get("original"),this.levelNumber):this.campaign&&(this.levelNumber=this.campaign.getLevelNumber(this.level.get("original"),this.levelNumber)),(n.getHocCampaign()||this.level.get("assessment"))&&(this.levelNumber=null),f.__super__.onLoaded.call(this)},f.prototype.openCreateAccountModal=function(e){return e.stopPropagation(),this.openModalView(new t)},f.prototype.setBus=function(e){this.bus=e},f.prototype.getRenderData=function(e){var t,i;return f.__super__.getRenderData.call(this,e=null==e?{}:e),e.worldName=this.worldName,e.ladderGame=this.level.isLadder(),this.level.get("replayable")&&(e.levelDifficulty=null!=(t=null!=(t=this.session.get("state"))?t.difficulty:void 0)?t:0,this.observing&&(e.levelDifficulty=Math.max(0,e.levelDifficulty-1)),e.difficultyTitle=""+o.i18n.t("play.level_difficulty")+e.levelDifficulty,this.lastDifficulty=e.levelDifficulty),e.spectateGame=this.spectateGame,e.observing=this.observing,this.homeViewArgs=[{supermodel:this.hasReceivedMemoryWarning?null:this.supermodel}],(t=n.getHocCampaign())?(this.homeLink="/play/"+t,this.homeViewClass="views/play/CampaignView",this.homeViewArgs.push(t)):h.isSessionless()?(this.homeLink="/teachers/courses",this.homeViewClass="views/courses/TeacherCoursesView"):this.level.isLadder()?(t=(null!=(t=this.level.get("slug"))?t.replace(/\-tutorial$/,""):void 0)||this.level.id,this.homeLink="/play/ladder/"+t,this.homeViewClass="views/ladder/LadderView",this.homeViewArgs.push(t),(t=p.getQueryVariable("league")||p.getQueryVariable("course-instance"))&&(i=this.level.isType("course-ladder")?"course":"clan",this.homeViewArgs.push(i),this.homeViewArgs.push(t),this.homeLink+="/"+i+"/"+t,(i=p.getQueryVariable("tournament"))&&(this.homeLink+="?tournament="+i))):this.level.isType("course")||this.courseID?(this.homeLink="/play",null!=this.course&&(this.homeLink+="/"+this.course.get("campaignID"),this.homeViewArgs.push(this.course.get("campaignID"))),this.courseInstanceID&&(this.homeLink+="?course-instance="+this.courseInstanceID),this.homeViewClass="views/play/CampaignView"):this.level.isType("hero","hero-coop","game-dev","web-dev")||window.serverConfig.picoCTF?(this.homeLink="/play",this.homeViewClass="views/play/CampaignView",i=this.level.get("campaign"),this.homeLink+="/"+i,this.homeViewArgs.push(i)):(this.homeLink="/",this.homeViewClass="views/HomeView"),e.editorLink="/editor/level/"+(this.level.get("slug")||this.level.id),e.homeLink=this.homeLink,e},f.prototype.showGameMenuModal=function(e,t){t=new i({level:this.level,session:this.session,supermodel:this.supermodel,showTab:t=null==t?null:t});return this.openModalView(t),this.listenToOnce(t,"change-hero",function(){var e;return null!=(e=this.setupManager)&&e.destroy(),this.setupManager=new c({supermodel:this.supermodel,level:this.level,levelID:this.levelID,parent:this,session:this.session,courseID:this.courseID,courseInstanceID:this.courseInstanceID}),this.setupManager.open()})},f.prototype.onClickHome=function(e){var t,i;return this.level.isType("course")&&(t=h.isTeacher()?"Teachers":"Students",null!=(i=window.tracker)&&i.trackEvent("Play Level Back To Levels",{category:t,levelSlug:this.levelSlug},["Mixpanel"])),e.preventDefault(),e.stopImmediatePropagation(),Backbone.Mediator.publish("router:navigate",{route:this.homeLink,viewClass:this.homeViewClass,viewArgs:this.homeViewArgs})},f.prototype.onClickSignupButton=function(e){var t;return null!=(t=window.tracker)?t.trackEvent("Started Signup",{category:"Play Level",label:"Control Bar",level:this.levelID}):void 0},f.prototype.onClickVersionSwitchButton=function(e){var t;if(!this.destroyed)return t="/play/level/"+this.level.get("slug")+"?dev=true",this.course||(t+="&course=560f1a9f22961295f9427742"),(e=o(e.target).data("code-language"))&&(t+="&codeLanguage="+e),document.location.href=t},f.prototype.onDisableControls=function(e){return this.toggleControls(e,!1)},f.prototype.onEnableControls=function(e){return this.toggleControls(e,!0)},f.prototype.toggleControls=function(e,t){if((!e.controls||0<=m.call(e.controls,"level"))&&t!==this.controlsEnabled)return this.controlsEnabled=t,this.$el.toggleClass("controls-disabled",!t)},f.prototype.onIPadMemoryWarning=function(e){return this.hasReceivedMemoryWarning=!0},f.prototype.onSessionDifficultyChanged=function(){var e;if((null!=(e=this.session.get("state"))?e.difficulty:void 0)!==this.lastDifficulty)return this.render()},f.prototype.destroy=function(){var e;return null!=(e=this.setupManager)&&e.destroy(),f.__super__.destroy.call(this)},f)}.call(this,y(17),y(3))},2234:function(m,e,f){!function(a,n){function e(e,t){for(var i in t)c.call(t,i)&&(e[i]=t[i]);function n(){this.constructor=e}return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e}var t,i,o,s,r,l=function(e,t){return function(){return e.apply(t,arguments)}},c={}.hasOwnProperty,h=[].slice,u=[].indexOf||function(e){for(var t=0,i=this.length;t<i;t++)if(t in this&&this[t]===e)return t;return-1};function p(){this.onWindowResize=l(this.onWindowResize,this),this.formatTime=l(this.formatTime,this),p.__super__.constructor.apply(this,arguments),o.on("change:music",this.updateMusicButton,this)}function d(){this.enabled=!0,this.shown=!1,this.type="HoverPopup",this.options={placement:"top",container:"body",animation:!0,html:!0,delay:{show:400}},this.$element=a("#timeProgress"),this.$tip=a("#timePopover"),this.content=""}f(2621),t=f(26),r=f(2623),o=f(44).me,s=f(52),m.exports=(e(p,t),p.prototype.id="playback-view",p.prototype.template=r,p.prototype.subscriptions={"level:disable-controls":"onDisableControls","level:enable-controls":"onEnableControls","level:set-playing":"onSetPlaying","level:toggle-playing":"onTogglePlay","level:scrub-forward":"onScrubForward","level:scrub-back":"onScrubBack","level:set-volume":"onSetVolume","surface:frame-changed":"onFrameChanged","god:new-world-created":"onNewWorld","god:streaming-world-updated":"onNewWorld","level:set-letterbox":"onSetLetterbox","tome:cast-spells":"onTomeCast","playback:real-time-playback-ended":"onRealTimePlaybackEnded","playback:cinematic-playback-ended":"onCinematicPlaybackEnded","playback:stop-real-time-playback":"onStopRealTimePlayback","playback:stop-cinematic-playback":"onStopCinematicPlayback"},p.prototype.events={"click #music-button":"onToggleMusic","click #zoom-in-button":function(){if(!this.shouldIgnore())return Backbone.Mediator.publish("camera:zoom-in",{})},"click #zoom-out-button":function(){if(!this.shouldIgnore())return Backbone.Mediator.publish("camera:zoom-out",{})},"click #volume-button":"onToggleVolume","click #play-button":"onTogglePlay",click:function(){if(!this.realTime)return Backbone.Mediator.publish("tome:focus-editor",{})},"mouseenter #timeProgress":"onProgressEnter","mouseleave #timeProgress":"onProgressLeave","mousemove #timeProgress":"onProgressHover","tapstart #timeProgress":"onProgressTapStart","tapend #timeProgress":"onProgressTapEnd","tapmove #timeProgress":"onProgressTapMove"},p.prototype.shortcuts={"+p, p, ctrl+p":"onTogglePlay","+[, ctrl+[":"onScrubBack","++[, ctrl++[":"onSingleScrubBack","+], ctrl+]":"onScrubForward","++], ctrl++]":"onSingleScrubForward"},p.prototype.afterRender=function(){var e;if(p.__super__.afterRender.call(this),this.$progressScrubber=a(".scrubber .progress",this.$el),this.options.level.isType("game-dev")||this.hookUpScrubber(),this.updateMusicButton(),a(window).on("resize",this.onWindowResize),e=navigator.userAgent.toLowerCase(),/safari/.test(e)&&!/chrome/.test(e)&&this.$el.find(".toggle-fullscreen").hide(),null==this.timePopup&&(this.timePopup=new i),this.second=a.i18n.t("units.second"),this.seconds=a.i18n.t("units.seconds"),this.minute=a.i18n.t("units.minute"),this.minutes=a.i18n.t("units.minutes"),this.goto=a.i18n.t("play_level.time_goto"),this.current=a.i18n.t("play_level.time_current"),this.total=a.i18n.t("play_level.time_total"),this.options.level.get("hidesPlayButton"))return this.$el.find("#play-button").css("visibility","hidden")},p.prototype.updatePopupContent=function(){var e;return null!=(e=this.timePopup)?e.updateContent("<h2>"+this.timeToString(this.newTime)+"</h2>"+this.formatTime(this.current,this.currentTime)+"<br/>"+this.formatTime(this.total,this.totalTime)):void 0},p.prototype.pad2=function(e){return null==e||0===e?"00":(e<10?"0":"")+e},p.prototype.formatTime=function(e,t){return e+"\t"+this.timeToString(t)},p.prototype.timeToString=function(e,t){var i;return null==t&&(t=!1),e=((e=null==e?0:e)-60*(i=Math.floor(e/60))).toFixed(1),t?(t="",0<i&&(t=i+" "+(1===i?this.minute:this.minutes)),0<e||0===i?t+" "+e+" "+(1===e?this.second:this.seconds):void 0):i+":"+this.pad2(e)},p.prototype.updateMusicButton=function(){return this.$el.find("#music-button").toggleClass("music-on",o.get("music"))},p.prototype.onSetLetterbox=function(e){if(!this.realTime&&!this.cinematic)return this.togglePlaybackControls(!e.on),this.disabled=e.on},p.prototype.togglePlaybackControls=function(e){return this.$el.find("#play-button, .scrubber-handle").css("visibility",e?"visible":"hidden")},p.prototype.onTomeCast=function(e){return e.realTime?(this.realTime=!0,this.togglePlaybackControls(!1),Backbone.Mediator.publish("playback:real-time-playback-started",{}),this.playSound("real-time-playback-start")):e.cinematic?(this.cinematic=!0,Backbone.Mediator.publish("playback:cinematic-playback-started",{})):void 0},p.prototype.onWindowResize=function(){1<=arguments.length&&h.call(arguments,0);return this.barWidth=a(".progress",this.$el).width()},p.prototype.onNewWorld=function(e){return this.updateBarWidth(e.world.frames.length,e.world.maxTotalFrames,e.world.dt)},p.prototype.updateBarWidth=function(e,t,i){return this.totalTime=(e-1)*i,t=parseInt(100*e/(t-1))+"%",this.barWidth=a(".progress",this.$el).css("width",t).show().width(),a(".scrubber .progress",this.$el).slider("enable",!0),this.newTime=0,this.currentTime=0,this.lastLoadedFrameCount=e},p.prototype.onDisableControls=function(e){if(!e.controls||0<=u.call(e.controls,"playback")){this.disabled=!0,a("button",this.$el).addClass("disabled");try{this.$progressScrubber.slider("disable",!0)}catch(e){console.warn("error disabling scrubber",e)}return null!=(e=this.timePopup)&&e.disable(),a("#volume-button",this.$el).removeClass("disabled"),this.$el.addClass("controls-disabled")}},p.prototype.onEnableControls=function(e){if(!this.realTime&&!this.cinematic&&(!e.controls||0<=u.call(e.controls,"playback"))){this.disabled=!1,a("button",this.$el).removeClass("disabled");try{this.$progressScrubber.slider("enable",!0)}catch(e){console.warn("error enabling scrubber",e)}return null!=(e=this.timePopup)&&e.enable(),this.$el.removeClass("controls-disabled")}},p.prototype.onSetPlaying=function(e){var t=s.state.game.playing,i=this.$el.find("#play-button"),n=i.hasClass("ended");i.hasClass("playing");i.toggleClass("playing",t&&!n).toggleClass("paused",!t&&!n),this.options.level.isType("game-dev")||this.playSound(t?"playback-play":"playback-pause")},p.prototype.onSetVolume=function(e){for(var t=["vol-off","vol-down","vol-up"],i=a("#volume-button",this.$el),n=0,o=t.length;n<o;n++)i.removeClass(t[n]);if(e.volume<=0&&i.addClass(t[0]),0<e.volume&&e.volume<1&&i.addClass(t[1]),1<=e.volume)return i.addClass(t[2])},p.prototype.onScrub=function(e,t){return null!=e&&"function"==typeof e.preventDefault&&e.preventDefault(),t.scrubDuration=500,Backbone.Mediator.publish("level:set-time",t)},p.prototype.onScrubForward=function(e){return this.onScrub(e,{ratioOffset:.05})},p.prototype.onSingleScrubForward=function(e){return this.onScrub(e,{frameOffset:1})},p.prototype.onScrubBack=function(e){return this.onScrub(e,{ratioOffset:-.05})},p.prototype.onSingleScrubBack=function(e){return this.onScrub(e,{frameOffset:-1})},p.prototype.onFrameChanged=function(e){var t;return e.progress!==this.lastProgress&&(this.currentTime=e.frame/e.world.frameRate,null!=(t=this.timePopup)&&t.shown&&this.updatePopupContent(),this.updateProgress(e.progress,e.world),this.updatePlayButton(e.progress)),this.lastProgress=e.progress},p.prototype.onProgressEnter=function(e){var t;return null!=(t=this.timePopup)?t.enter(this.timePopup):void 0},p.prototype.onProgressLeave=function(e){var t;return null!=(t=this.timePopup)?t.leave(this.timePopup):void 0},p.prototype.onProgressHover=function(e,t){var i=this.$progressScrubber.width()/this.totalTime;if(null==t&&(t=e.clientX-a(e.target).closest("#timeProgress").offset().left),t=Math.max(0,t),this.newTime=t/i,this.updatePopupContent(),null!=(i=this.timePopup)&&i.onHover(e),this.timePopup&&Math.abs(this.currentTime-this.newTime)<1&&!this.timePopup.shown)return this.timePopup.show()},p.prototype.onProgressTapStart=function(e,t){var i;if(n.isIPadApp)return this.onProgressEnter(e),e=(null!=(t=null!=(i=e.clientX)?i:null!=t?t.position.x:void 0)?t:0)-a(e.target).closest("#timeProgress").offset().left,e=Math.max(e,0),this.scrubTo(e/this.$progressScrubber.width()),this.$el.find("#play-button").hasClass("playing")?this.onTogglePlay():void 0},p.prototype.onProgressTapEnd=function(e,t){if(n.isIPadApp)return this.onProgressLeave(e)},p.prototype.onProgressTapMove=function(e,t){var i;if(n.isIPadApp)return t=(null!=(t=null!=(i=e.clientX)?i:null!=t?t.position.x:void 0)?t:0)-a(e.target).closest("#timeProgress").offset().left,t=Math.max(t,0),this.onProgressHover(e,t),this.scrubTo(t/this.$progressScrubber.width())},p.prototype.updateProgress=function(e,t){var i;return t.frames.length!==this.lastLoadedFrameCount&&this.updateBarWidth(t.frames.length,t.maxTotalFrames,t.dt),i=this.worldCompletelyLoaded,this.worldCompletelyLoaded=t.frames.length===t.totalFrames,this.realTime&&this.worldCompletelyLoaded&&!i&&(Backbone.Mediator.publish("playback:real-time-playback-ended",{}),Backbone.Mediator.publish("level:set-letterbox",{on:!1})),a(".scrubber .progress-bar",this.$el).css("width",100*e+"%")},p.prototype.updatePlayButton=function(e){var t=this.$el.find("#play-button"),i=t.hasClass("ended");if(this.worldCompletelyLoaded&&.99<=e&&this.lastProgress<.99&&(t.removeClass("playing").removeClass("paused").addClass("ended"),(this.realTime||this.cinematic)&&Backbone.Mediator.publish("level:set-letterbox",{on:!1}),this.realTime&&Backbone.Mediator.publish("playback:real-time-playback-ended",{}),this.cinematic&&Backbone.Mediator.publish("playback:cinematic-playback-ended",{})),e<.99&&.99<=this.lastProgress&&(e=s.state.game.playing,t.removeClass("ended"),t.addClass(e?"playing":"paused")),i!==(t=t.hasClass("ended")))return Backbone.Mediator.publish("playback:ended-changed",{ended:t})},p.prototype.onRealTimePlaybackEnded=function(e){if(this.realTime)return this.realTime=!1,this.togglePlaybackControls(!0),this.playSound("real-time-playback-end")},p.prototype.onCinematicPlaybackEnded=function(e){return this.cinematic=!1,this.togglePlaybackControls(!0)},p.prototype.onStopRealTimePlayback=function(e){return Backbone.Mediator.publish("level:set-letterbox",{on:!1}),Backbone.Mediator.publish("playback:real-time-playback-ended",{})},p.prototype.onStopCinematicPlayback=function(e){if(this.cinematic)return Backbone.Mediator.publish("level:set-letterbox",{on:!1}),Backbone.Mediator.publish("playback:cinematic-playback-ended",{})},p.prototype.hookUpScrubber=function(){return this.sliderIncrements=500,this.$progressScrubber.slider({max:this.sliderIncrements,animate:"slow",slide:function(e,t){var i,n;if(!o.shouldIgnore())return++o.slideCount,i=o.getScrubRatio(),o.scrubTo(t.value/o.sliderIncrements),(i=o.getScrubRatio()-i)&&(n="playback-scrub-slide-"+(0<i?"forward":"back")+"-"+o.slideCount%3,!/back/.test(n))?o.playSound(n,Math.min(1,Math.abs(50*i))):void 0},start:function(e,t){var i;if(!n.shouldIgnore())return n.slideCount=0,i=s.state.game.playing,n.wasPlaying=i&&!a("#play-button").hasClass("ended"),Backbone.Mediator.publish("level:set-playing",{playing:!1}),n.playSound("playback-scrub-start",.5)},stop:(i=n=o=this,function(e,t){if(!i.shouldIgnore())return i.actualProgress=t.value/i.sliderIncrements,Backbone.Mediator.publish("playback:manually-scrubbed",{ratio:i.actualProgress}),Backbone.Mediator.publish("level:set-playing",{playing:i.wasPlaying}),i.slideCount<3?(i.wasPlaying=!1,Backbone.Mediator.publish("level:set-playing",{playing:!1}),i.$el.find(".scrubber-handle").effect("bounce",{times:2})):i.playSound("playback-scrub-end",.5)})});var i,n,o},p.prototype.getScrubRatio=function(){return this.$progressScrubber.find(".progress-bar").width()/this.$progressScrubber.width()},p.prototype.scrubTo=function(e,t){if(null==t&&(t=0),!this.shouldIgnore())return Backbone.Mediator.publish("level:set-time",{ratio:e,scrubDuration:t})},p.prototype.shouldIgnore=function(){return this.disabled||this.realTime},p.prototype.onTogglePlay=function(e){if(null!=e&&"function"==typeof e.preventDefault&&e.preventDefault(),!this.shouldIgnore())return e=(e=a("#play-button")).hasClass("paused")||e.hasClass("ended"),Backbone.Mediator.publish("level:set-playing",{playing:e}),a(document.activeElement).blur()},p.prototype.onToggleVolume=function(e){for(var t,i,n=a(e.target).closest("#volume-button"),o=["vol-off","vol-down","vol-up"],e=[0,.4,1],s=t=0,r=o.length;t<r;s=++t){if(n.hasClass(o[s])){i=(s+1)%o.length;break}s===o.length-1&&(i=2)}return Backbone.Mediator.publish("level:set-volume",{volume:e[i]}),a(document.activeElement).blur()},p.prototype.onToggleMusic=function(e){return null!=e&&e.preventDefault(),o.set("music",!o.get("music",!0)),o.patch(),a(document.activeElement).blur()},p.prototype.destroy=function(){return o.off("change:music",this.updateMusicButton,this),a(window).off("resize",this.onWindowResize),this.onWindowResize=null,p.__super__.destroy.call(this)},p),r=a.fn.popover.Constructor,e(d,r),d.prototype.getContent=function(){return this.content},d.prototype.show=function(){if(!this.shown)return d.__super__.show.call(this),this.shown=!0},d.prototype.updateContent=function(e){return this.content=e,this.setContent(),this.$tip.addClass("fade top in")},d.prototype.onHover=function(e){var t,i;return this.e=e,i=this.getPosition(),t=this.$tip[0].offsetWidth,e=this.$tip[0].offsetHeight,t={top:i.top-e,left:i.left+i.width/2-t/2},this.applyPlacement(t,"top")},d.prototype.getPosition=function(){return{top:this.$element.offset().top,left:null!=this.e?this.e.pageX:this.$element.offset().left,height:0,width:0}},d.prototype.hide=function(){return d.__super__.hide.call(this),this.shown=!1},d.prototype.disable=function(){return d.__super__.disable.call(this),this.hide()},i=d}.call(this,f(3),f(17))},2235:function(e,t,i){var n,o,s,r,a=function(e,t){return function(){return e.apply(t,arguments)}},l={}.hasOwnProperty;function c(e){this.playToggleSound=a(this.playToggleSound,this),c.__super__.constructor.call(this,e),this.level=e.level}i(2624),n=i(26),r=i(2626),i(44).me,i(6),i(1375),i(267),i(284),o=i(2226).default,s=i(52),e.exports=(function(e,t){for(var i in t)l.call(t,i)&&(e[i]=t[i]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(c,n),c.prototype.id="goals-view",c.prototype.template=r,c.prototype.className="secret expanded",c.prototype.playbackEnded=!1,c.prototype.subscriptions={"goal-manager:new-goal-states":"onNewGoalStates","tome:cast-spells":"onTomeCast","level:set-letterbox":"onSetLetterbox","level:set-playing":"onSetPlaying","surface:playback-restarted":"onSurfacePlaybackRestarted","surface:playback-ended":"onSurfacePlaybackEnded"},c.prototype.events={mouseenter:function(){return this.playbackEnded?this.onSurfacePlaybackRestarted():(this.mouseEntered=!0,this.updatePlacement())},mouseleave:function(){return this.mouseEntered=!1,this.updatePlacement()}},c.prototype.afterRender=function(){return this.levelGoalsComponent=new o({el:this.$(".goals-component")[0],store:s,propsData:{showStatus:!0}})},c.prototype.onNewGoalStates=function(e){var t,i,n,o,s,r;for(_.assign(this.levelGoalsComponent,_.pick(e,"overallStatus","timedOut","goals","goalStates")),this.levelGoalsComponent.casting=!1,t=null==this.previousGoalStatus,null==this.previousGoalStatus&&(this.previousGoalStatus={}),this.succeeded="success"===e.overallStatus,n=0,o=(s=e.goals).length;n<o;n++)i=s[n],r=e.goalStates[i.id]||{status:"incomplete"},t||"success"!==r.status||"success"===this.previousGoalStatus[i.id]?t||"success"===r.status||"success"!==this.previousGoalStatus[i.id]?this.soundToPlayWhenPlaybackEnded=null:this.soundToPlayWhenPlaybackEnded="goal-incomplete-again":this.soundToPlayWhenPlaybackEnded="goal-success",this.previousGoalStatus[i.id]=r.status;return 0<e.goals.length&&this.$el.hasClass("secret")&&(this.$el.removeClass("secret"),this.lastSizeTweenTime=new Date),this.updatePlacement()},c.prototype.onTomeCast=function(e){if(!e.preload)return this.levelGoalsComponent.casting=!0},c.prototype.onSetPlaying=function(e){if(e.playing)return this.mouseEntered=!1,this.expanded=!0,this.updatePlacement()},c.prototype.onSurfacePlaybackRestarted=function(){return this.playbackEnded=!1,this.$el.removeClass("brighter"),this.lastSizeTweenTime=new Date,this.updatePlacement()},c.prototype.onSurfacePlaybackEnded=function(){if(!this.level.isType("game-dev"))return this.playbackEnded=!0,this.updateHeight(),this.$el.addClass("brighter"),this.lastSizeTweenTime=new Date,this.updatePlacement(),this.soundToPlayWhenPlaybackEnded?this.playSound(this.soundToPlayWhenPlaybackEnded):void 0},c.prototype.updateHeight=function(){if(!(this.$el.hasClass("brighter")||this.$el.hasClass("secret")||new Date-this.lastSizeTweenTime<500))return this.normalHeight=this.$el.outerHeight()},c.prototype.updatePlacement=function(){var e,t,i=this.playbackEnded!==this.mouseEntered;if(i!==this.expanded)return this.updateHeight(),e=i?"goals-expand":"goals-collapse",t=i?-5:41-(t=!(t=this.normalHeight)||this.playbackEnded?this.$el.outerHeight():t),this.$el.css("top",t),this.soundTimeout?(clearTimeout(this.soundTimeout),this.soundTimeout=null):null!=this.expanded&&(this.soundTimeout=_.delay(this.playToggleSound,500,e)),this.expanded=i},c.prototype.playToggleSound=function(e){if(!this.destroyed)return this.options.level.isType("game-dev")||this.playSound(e),this.soundTimeout=null},c.prototype.onSetLetterbox=function(e){return this.$el.toggle(!e.on),this.updatePlacement()},c.prototype.destroy=function(){var e,t={commit:_.noop,dispatch:_.noop};return null!=(e=this.levelGoalsComponent)&&e.$destroy(),null!=(e=this.levelGoalsComponent)&&(e.$store=t),c.__super__.destroy.call(this)},c)},2236:function(e,t,i){var n,o,s,r={}.hasOwnProperty;function a(e){a.__super__.constructor.call(this,e),this.teamGold={},this.teamGoldEarned={},this.shownOnce=!1}i(2631),n=i(26),s=i(2633),o=i(2634),e.exports=(function(e,t){for(var i in t)r.call(t,i)&&(e[i]=t[i]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(a,n),a.prototype.id="gold-view",a.prototype.template=s,a.prototype.subscriptions={"surface:gold-changed":"onGoldChanged","level:set-letterbox":"onSetLetterbox"},a.prototype.onGoldChanged=function(e){var t,i;if(this.teamGold[e.team]!==e.gold||this.teamGoldEarned[e.team]!==e.goldEarned)return this.teamGold[e.team]=e.gold,this.teamGoldEarned[e.team]=e.goldEarned,(t=this.$el.find(".gold-amount.team-"+e.team)).length||(i=o({team:e.team}),this.$el["humans"===e.team?"prepend":"append"](i),t=this.$el.find(".gold-amount.team-"+e.team)),i=""+e.gold,e.goldEarned&&e.goldEarned>e.gold&&(i+=" ("+e.goldEarned+")"),t.text(i),this.updateTitle(),this.$el.show(),this.shownOnce=!0},a.prototype.updateTitle=function(){var e,t,i=[],n=this.teamGold;for(t in n)e=n[t],this.teamGoldEarned[t]?i.push("Team '"+t+"' has "+e+" now of "+this.teamGoldEarned[t]+" gold earned."):i.push("Team '"+t+"' has "+e+" gold.");return this.$el.attr("title",i.join(" "))},a.prototype.onSetLetterbox=function(e){if(this.shownOnce)return this.$el.toggle(!e.on)},a)},2237:function(e,t,i){var n,o={}.hasOwnProperty;function s(e){s.__super__.constructor.call(this,e),this.listings={}}i(2635),n=i(26),i=i(2637),e.exports=(function(e,t){for(var i in t)o.call(t,i)&&(e[i]=t[i]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(s,n),s.prototype.id="game-dev-track-view",s.prototype.template=i,s.prototype.subscriptions={"surface:frame-changed":"onFrameChanged","playback:real-time-playback-started":"onRealTimePlaybackStarted","playback:real-time-playback-ended":"onRealTimePlaybackEnded"},s.prototype.onFrameChanged=function(e){var t,i,n,o,s,r,a,l,c,h,u,p,d,m,f,g,y,v,b,w,k,x,S,C,T,L;if(this.listings={},m=null!=(g=e.world.uiText)?g.scoreLabel:void 0,e.world.synchronous){for(i=0,a=(y=e.world.thangs).length;i<a;i++)if("Hero Placeholder"===(b=y[i]).id&&(t=b),L=b.uiTrackedProperties)for(n=0,l=L.length;n<l;n++)d=L[n],this.listings[null!=m?m:d]=b[d];if(t&&t.objTrackedProperties)for(o=0,c=(v=t.objTrackedProperties).length;o<c;o++)d=v[o],this.listings[null!=m?m:d]=t["__"+d]}else for(s in k=null!=(e=e.world.frames[e.frame])?e.thangStateMap:void 0)if((w=k[s]).trackedPropertyKeys){if(-1!==(T=w.trackedPropertyKeys.indexOf("uiTrackedProperties"))&&(C=w.props[T]))for(r=0,h=C.length;r<h;r++)d=C[r],-1!==(f=w.trackedPropertyKeys.indexOf(d))&&(this.listings[null!=m?m:d]=w.props[f]);if("Hero Placeholder"===s&&-1!==(S=w.trackedPropertyKeys.indexOf("objTrackedProperties")))for(p=0,u=(x=w.props[S]).length;p<u;p++)d=x[p],-1!==(f=w.trackedPropertyKeys.indexOf("__"+d))&&(this.listings[null!=m?m:d]=w.props[f])}return _.isEqual(this.listings,{})?this.$el.hide():(this.$el.show(),this.renderSelectors("#listings"))},s.prototype.onRealTimePlaybackStarted=function(e){return this.$el.addClass("playback-float-right")},s.prototype.onRealTimePlaybackEnded=function(e){return this.$el.removeClass("playback-float-right")},s.prototype.titleize=function(e){return _.string.titleize(_.string.humanize(e))},s.prototype.beautify=function(e,t){return"object"==typeof t&&null!=t.x&&null!=t.y&&null!=t.z?"x: "+Math.round(t.x)+"\ny: "+Math.round(t.y):"number"==typeof t?Math.round(t):null!=t?t:""},s)},2238:function(r,e,a){!function(i){var e,n,t,g,o={}.hasOwnProperty,y=[].indexOf||function(e){for(var t=0,i=this.length;t<i;t++)if(t in this&&this[t]===e)return t;return-1};function s(t){var e,o;s.__super__.constructor.call(this,t),t.thangs=_.filter(t.thangs,"inThangList"),t.otherSession||(t.otherSession={get:function(e){return{creatorName:i.i18n.t("ladder.simple_ai"),team:"humans"===t.session.get("team")?"ogres":"humans",heroConfig:t.session.get("heroConfig")}[e]}}),this.showsPower="wakka-maul"!==(e=t.level.get("slug"))&&"cross-bones"!==e&&"dueling-grounds"!==e&&"cavern-survival"!==e&&"multiplayer-treasure-grove"!==e,this.teamGold={},this.players=function(){for(var e=["humans","ogres"],t=[],i=0,n=e.length;i<n;i++)o=e[i],t.push(this.formatPlayer(o));return t}.call(this)}a(2638),e=a(26),t=a(2640),n=a(2641),g=a(6),r.exports=(function(e,t){for(var i in t)o.call(t,i)&&(e[i]=t[i]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(s,e),s.prototype.id="duel-stats-view",s.prototype.template=t,s.prototype.subscriptions={"surface:gold-changed":"onGoldChanged","god:new-world-created":"onNewWorld","god:streaming-world-updated":"onNewWorld","surface:frame-changed":"onFrameChanged","sprite:speech-updated":"onSpriteDialogue","level:sprite-clear-dialogue":"onSpriteClearDialogue"},s.prototype.formatPlayer=function(t){var e={team:t},i=_.find([this.options.session,this.options.otherSession],function(e){return e.get("team")===t});return e.name=i.get("creatorName"),e.heroThangType=(null!=(i=i.get("heroConfig"))?i:{}).thangType||"529ffbf1cf1818f2be000001",e.heroID="ogres"===t?"Hero Placeholder 1":"Hero Placeholder",e},s.prototype.afterRender=function(){var e,t,i,n;for(s.__super__.afterRender.call(this),e=0,t=(n=this.players).length;e<t;e++)i=n[e],this.buildAvatar(i.heroID,i.team);return this.$el.css("display","flex")},s.prototype.buildAvatar=function(e,t){if(null==this.avatars&&(this.avatars={}),!this.avatars[t])return e=_.find(this.options.thangs,{id:e}),this.avatars[t]=e=new n({thang:e,includeName:!1,supermodel:this.supermodel}),this.$find(t,".thang-avatar-placeholder").replaceWith(e.$el),e.render()},s.prototype.onNewWorld=function(e){return this.options.thangs=_.filter(e.world.thangs,"inThangList")},s.prototype.onFrameChanged=function(e){return this.update()},s.prototype.update=function(){for(var e,t=this.players,i=0,n=t.length;i<n;i++)e=t[i],e=_.find(this.options.thangs,{id:this.avatars[e.team].thang.id}),this.updateHealth(e);if(this.showsPower)return this.updatePower()},s.prototype.updateHealth=function(e){var t=this.$find(e.team,".player-health");return t.find(".health-bar").css("width",Math.max(0,Math.min(100,100*e.health/e.maxHealth))+"%"),g.replaceText(t.find(".health-value"),Math.round(e.health))},s.prototype.updatePower=function(){var e,t,i,n,o,s,r,a,l,c,h,u,p,d,m,f;for(null==this.costTable&&(this.costTable={soldier:20,archer:25,decoy:25,"griffin-rider":50,paladin:80,artillery:75,"arrow-tower":100,palisade:10,peasant:50,thrower:9,scout:18}),l={humans:0,ogres:0},m=[],t=0,o=(c=this.players).length;t<o;t++)a=c[t],null!=(e=_.find(this.options.thangs,{id:this.avatars[a.team].thang.id})).teamPower&&null!=l[e.team]&&(l[e.team]=e.teamPower,m.push(e.team));for(i=0,s=(h=this.options.thangs).length;i<s;i++)u=(f=h[i]).team,y.call(m,u)<0&&0<f.health&&f.exists&&null!=l[f.team]&&(l[f.team]+=this.costTable[f.type]||0);for(d=[],n=0,r=(p=this.players).length;n<r;n++)a=p[n],d.push(g.replaceText(this.$find(a.team,".power-value"),l[a.team]));return d},s.prototype.$find=function(e,t){return this.$el.find(".player-container.team-"+e+" "+t)},s.prototype.destroy=function(){var e,t,i=null!=(e=this.avatars)?e:{};for(t in i)i[t].destroy();return s.__super__.destroy.call(this)},s.prototype.onGoldChanged=function(e){if(this.options.showsGold&&this.teamGold[e.team]!==e.gold)return this.teamGold[e.team]=e.gold,g.replaceText(this.$find(e.team,".gold-value"),""+e.gold)},s.prototype.onSpriteDialogue=function(e){if(e.message)return this.$el.css("display","none")},s.prototype.onSpriteClearDialogue=function(){return this.$el.css("display","flex")},s)}.call(this,a(3))},2239:function(u,e,p){!function(t,i){var n,e,o,s,r,a,l,c={}.hasOwnProperty;function h(e){var t;i.router.initializeSocialMediaServices(),t=e.level.get("victory",!0),t=l.i18n(t,"body")||"Sorry, this level has no victory message yet.",this.body=marked(t),this.level=e.level,this.session=e.session,this.saveReviewEventually=_.debounce(this.saveReviewEventually,2e3),this.loadExistingFeedback(),h.__super__.constructor.call(this,e)}p(2643),s=p(80),n=p(118),a=p(2645),r=p(44).me,e=p(1683),o=p(1405),l=p(6),u.exports=(function(e,t){for(var i in t)c.call(t,i)&&(e[i]=t[i]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(h,s),h.prototype.id="level-victory-modal",h.prototype.template=a,h.prototype.subscriptions={"ladder:game-submitted":"onGameSubmitted"},h.prototype.events={"click .sign-up-button":"onClickSignupButton","mouseover .rating i":function(e){return this.showStars(this.starNum(t(e.target)))},"mouseout .rating i":function(){return this.showStars()},"click .rating i":function(e){return this.setStars(this.starNum(t(e.target))),this.$el.find(".review").show()},"keypress .review textarea":function(){return this.saveReviewEventually()}},h.prototype.loadExistingFeedback=function(){var e="/db/level/"+this.level.id+"/feedback";return this.feedback=new o,this.feedback.setURL(e),this.feedback.fetch({cache:!1}),this.listenToOnce(this.feedback,"sync",function(){return this.onFeedbackLoaded()}),this.listenToOnce(this.feedback,"error",function(){return this.onFeedbackNotFound()})},h.prototype.onFeedbackLoaded=function(){return this.feedback.url=function(){return"/db/level.feedback/"+this.id},this.$el.find(".review textarea").val(this.feedback.get("review")),this.$el.find(".review").show(),this.showStars()},h.prototype.onFeedbackNotFound=function(){return this.feedback=new o,this.feedback.set("levelID",this.level.get("slug")||this.level.id),this.feedback.set("levelName",this.level.get("name")||""),this.feedback.set("level",{majorVersion:this.level.get("version").major,original:this.level.get("original")}),this.showStars()},h.prototype.onClickSignupButton=function(e){return e.preventDefault(),null!=(e=window.tracker)&&e.trackEvent("Started Signup",{category:"Play Level",label:"Victory Modal",level:this.level.get("slug")}),this.openModalView(new n)},h.prototype.onGameSubmitted=function(e){var t="/play/ladder/"+this.level.get("slug")+"#my-matches";return Backbone.Mediator.publish("router:navigate",{route:t})},h.prototype.getRenderData=function(){var e=h.__super__.getRenderData.call(this);return e.body=this.body,e.me=r,e.levelName=l.i18n(this.level.attributes,"name"),e.level=this.level,e.level.isType("ladder")&&(e.readyToRank=this.session.readyToRank()),e},h.prototype.afterRender=function(){return h.__super__.afterRender.call(this),this.ladderSubmissionView=new e({session:this.session,level:this.level}),this.insertSubView(this.ladderSubmissionView,this.$el.find(".ladder-submission-view"))},h.prototype.afterInsert=function(){var e,t,i;return h.__super__.afterInsert.call(this),this.playSound("victory"),"undefined"!=typeof gapi&&null!==gapi&&null!=(e=gapi.plusone)&&"function"==typeof e.go&&e.go(this.$el[0]),"undefined"!=typeof FB&&null!==FB&&null!=(t=FB.XFBML)&&"function"==typeof t.parse&&t.parse(this.$el[0]),"undefined"!=typeof twttr&&null!==twttr&&null!=(i=twttr.widgets)&&"function"==typeof i.load?i.load():void 0},h.prototype.destroy=function(){return this.$el.find(".review textarea").val()&&this.saveReview(),this.feedback.off(),h.__super__.destroy.call(this)},h.prototype.starNum=function(e){return e.prevAll("i").length+1},h.prototype.showStars=function(e){var t;return this.$el.find(".rating").show(),null==e&&(e=(null!=(t=this.feedback)?t.get("rating"):void 0)||0),(t=this.$el.find(".rating i")).removeClass("icon-star").addClass("icon-star-empty"),t.slice(0,e).removeClass("icon-star-empty").addClass("icon-star")},h.prototype.setStars=function(e){return this.feedback.set("rating",e),this.feedback.save()},h.prototype.saveReviewEventually=function(){return this.saveReview()},h.prototype.saveReview=function(){return this.feedback.set("review",this.$el.find(".review textarea").val()),this.feedback.save()},h)}.call(this,p(3),p(17))},2240:function(e,t,i){var n=i(2651);(n="string"==typeof n?[[e.i,n,""]]:n).locals&&(e.exports=n.locals);(0,i(21).default)("52d55bae",n,!0,{})},2241:function(e,t,i){var n,o={}.hasOwnProperty;function s(){return s.__super__.constructor.apply(this,arguments)}n=i(80),i=i(2662),e.exports=(function(e,t){for(var i in t)o.call(t,i)&&(e[i]=t[i]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(s,n),s.prototype.id="#infinite-loop-modal",s.prototype.template=i,s.prototype.events={"click #restart-level-infinite-loop-retry-button":function(){return Backbone.Mediator.publish("tome:cast-spell",{})},"click #restart-level-infinite-loop-confirm-button":function(){return Backbone.Mediator.publish("level:restart",{})},"click #restart-level-infinite-loop-comment-button":function(){return Backbone.Mediator.publish("tome:comment-my-code",{})}},s)},2544:function(e,t,i){},2545:function(e,t,i){var n=i(2546);(n="string"==typeof n?[[e.i,n,""]]:n).locals&&(e.exports=n.locals);(0,i(21).default)("5baea9be",n,!0,{})},2546:function(e,t,i){},2547:function(e,t,i){var n=i(2548);(n="string"==typeof n?[[e.i,n,""]]:n).locals&&(e.exports=n.locals);(0,i(21).default)("7b60ebba",n,!0,{})},2548:function(e,t,i){},2549:function(e,t,i){var l=i(11);e.exports=function(e){var r,a=[],i={},e=e||{};return function(e,t){i["game-dev-goals"]=r=function(o){this&&this.block,this&&this.attributes;a.push('<ul class="goals">');var s=!1;!function(){var e=o;if("number"==typeof e.length)for(var t=0,i=e.length;t<i;t++)"manual"==(n=e[t]).type?a.push('<li class="goal">'+l.escape(null==(r=n.config.description)?"":r)+"</li>"):"survive"==n.type?n.config.seconds?a.push('<li data-i18n="play_game_dev_level.goal_survive_time"'+l.attr("data-i18n-options",{seconds:n.config.seconds},!0,!0)+' class="goal"></li>'):a.push('<li data-i18n="play_game_dev_level.goal_survive" class="goal"></li>'):"defeat"==n.type?n.config.amount?a.push('<li data-i18n="play_game_dev_level.goal_defeat_amount"'+l.attr("data-i18n-options",{amount:n.config.amount},!0,!0)+' class="goal"></li>'):a.push('<li data-i18n="play_game_dev_level.goal_defeat" class="goal"></li>'):"move"!=n.type||s?"collect"==n.type?n.config.amount?a.push('<li data-i18n="play_game_dev_level.goal_collect_amount"'+l.attr("data-i18n-options",{amount:n.config.amount},!0,!0)+' class="goal"></li>'):a.push('<li data-i18n="play_game_dev_level.goal_collect" class="goal"></li>'):"user_defined"==n.type&&a.push('<li class="goal">'+l.escape(null==(r=n.direction)?"":r)+"</li>"):(a.push('<li data-i18n="play_game_dev_level.goal_move" class="goal"></li>'),s=!0);else{var n,i=0;for(t in e)i++,"manual"==(n=e[t]).type?a.push('<li class="goal">'+l.escape(null==(r=n.config.description)?"":r)+"</li>"):"survive"==n.type?n.config.seconds?a.push('<li data-i18n="play_game_dev_level.goal_survive_time"'+l.attr("data-i18n-options",{seconds:n.config.seconds},!0,!0)+' class="goal"></li>'):a.push('<li data-i18n="play_game_dev_level.goal_survive" class="goal"></li>'):"defeat"==n.type?n.config.amount?a.push('<li data-i18n="play_game_dev_level.goal_defeat_amount"'+l.attr("data-i18n-options",{amount:n.config.amount},!0,!0)+' class="goal"></li>'):a.push('<li data-i18n="play_game_dev_level.goal_defeat" class="goal"></li>'):"move"!=n.type||s?"collect"==n.type?n.config.amount?a.push('<li data-i18n="play_game_dev_level.goal_collect_amount"'+l.attr("data-i18n-options",{amount:n.config.amount},!0,!0)+' class="goal"></li>'):a.push('<li data-i18n="play_game_dev_level.goal_collect" class="goal"></li>'):"user_defined"==n.type&&a.push('<li class="goal">'+l.escape(null==(r=n.direction)?"":r)+"</li>"):(a.push('<li data-i18n="play_game_dev_level.goal_move" class="goal"></li>'),s=!0)}}.call(this),a.push("</ul>")},a.push('<div class="game-container"><div id="level-loading-view"></div><div class="level-content"><div id="control-bar-view"></div><div id="fullscreen-editor-background-screen" title="Click to minimize the code editor"></div><div id="code-area"><div id="code-area-gradient" class="gradient"></div><div id="tome-view"></div></div><div id="spell-palette-view"></div><div id="problem-alert-view"></div><div id="game-area"><div id="canvas-wrapper"><canvas width="924" height="589" id="webgl-surface"></canvas><canvas width="924" height="589" id="normal-surface"></canvas><div id="web-surface-view"></div><div id="ascii-surface"></div><div id="canvas-left-gradient" class="gradient"></div><div id="canvas-top-gradient" class="gradient"></div><div id="goals-view"></div></div><div id="level-flags-view"></div><div id="gold-view"></div><div id="game-dev-track-view"></div><div id="level-chat-view"></div><div id="multiplayer-status-view"></div><div id="duel-stats-view"></div><div id="playback-view"></div><div id="thang-hud"></div><div id="level-dialogue-view"></div><button id="stop-cinematic-playback-button" data-i18n="[title]common.continue;common.continue" class="btn btn-lg btn-primary banner header-font"></button></div><div id="surface-context-menu-view"></div><button id="stop-real-time-playback-button" title="Stop real-time playback" class="btn btn-lg btn-warning banner header-font">'),t.level&&t.level.isType("game-dev")?a.push('<span data-i18n="play_level.edit_level"></span>'):a.push('<span data-i18n="play_level.skip"></span>'),a.push('</button><div id="cinematic-code-display">'),function(){var e=[0,1,2,3,4,5,6];if("number"==typeof e.length)for(var t=0,i=e.length;t<i;t++){var n=e[t];a.push("<div"+l.cls(["code-line code-line-"+n],[!0])+'><code class="line-number"></code><code class="indentation"></code><code class="code-text"></code></div>')}else{i=0;for(t in e){i++;n=e[t];a.push("<div"+l.cls(["code-line code-line-"+n],[!0])+'><code class="line-number"></code><code class="indentation"></code><code class="code-text"></code></div>')}}}.call(this),a.push('</div><div id="how-to-play-game-dev-panel" class="panel panel-default hide style-flat"><div class="panel-heading"><h3 class="panel-title"><span data-i18n="play_level.directions"></span>:</h3></div>'),t.studentGoals&&t.studentGoals.length?(a.push('<div class="panel-body">'),i["game-dev-goals"](t.studentGoals),a.push("</div>")):a.push('<div class="panel-body">'+(null==(r=t.howToPlayText)?"":r)+"</div>"),a.push('</div><div class="hints-view hide"></div></div><div id="level-footer-shadow"></div><div id="level-footer-background"></div></div>')}.call(this,"undefined"in e?e.undefined:void 0,"view"in e?e.view:"undefined"!=typeof view?view:void 0),a.join("")}},2550:function(e,t,i){var n,o,s=function(e,t){return function(){return e.apply(t,arguments)}},r={}.hasOwnProperty;function a(e){this.docName=e,this.onPlayerChanged=s(this.onPlayerChanged,this),this.onPlayerLeft=s(this.onPlayerLeft,this),this.onPlayerJoined=s(this.onPlayerJoined,this),this.onChatAdded=s(this.onChatAdded,this),this.onFireOpen=s(this.onFireOpen,this),a.__super__.constructor.call(this),this.players={},a.activeBuses[this.docName]=this}n=i(45),o=i(44).me,e.exports=(function(e,t){for(var i in t)r.call(t,i)&&(e[i]=t[i]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(a,n),a.prototype.joined=null,a.prototype.players=null,a.get=function(e){return this.getFromCache||new a(e)},a.getFromCache=function(e){return a.activeBuses[e]},a.activeBuses={},a.fireHost="https://codecombat.firebaseio.com",a.prototype.subscriptions={"auth:me-synced":"onMeSynced"},a.prototype.connect=function(){return Backbone.Mediator.publish("bus:connecting",{bus:this}),Firebase.goOnline(),this.fireRef=new Firebase(a.fireHost+"/"+this.docName),this.fireRef.once("value",this.onFireOpen)},a.prototype.onFireOpen=function(e){if(!this.destroyed)return this.init(),Backbone.Mediator.publish("bus:connected",{bus:this});console.log("Leaving '"+this.docName+"' because class has been destroyed.")},a.prototype.disconnect=function(){var e;return null!=(e=this.fireRef)&&e.off(),(this.fireRef=null)!=(e=this.fireChatRef)&&e.off(),(this.fireChatRef=null)!=(e=this.firePlayersRef)&&e.off(),(this.firePlayersRef=null)!=(e=this.myConnection)&&e.off(),this.myConnection=null,this.joined=!1,Backbone.Mediator.publish("bus:disconnected",{bus:this})},a.prototype.init=function(){return this.fireChatRef=this.fireRef.child("chat"),this.firePlayersRef=this.fireRef.child("players"),this.join(),this.listenForChanges(),this.sendMessage("/me joined.",!0)},a.prototype.join=function(){return this.joined=!0,this.myConnection=this.firePlayersRef.child(o.id),this.myConnection.set({id:o.id,name:o.get("name"),connected:!0}),this.onDisconnect=this.myConnection.child("connected").onDisconnect(),this.onDisconnect.set(!1)},a.prototype.listenForChanges=function(){return this.fireChatRef.limit(500).on("child_added",this.onChatAdded),this.firePlayersRef.on("child_added",this.onPlayerJoined),this.firePlayersRef.on("child_removed",this.onPlayerLeft),this.firePlayersRef.on("child_changed",this.onPlayerChanged)},a.prototype.onChatAdded=function(e){return Backbone.Mediator.publish("bus:new-message",{message:e.val(),bus:this})},a.prototype.onPlayerJoined=function(e){e=e.val();if(e.connected)return this.players[e.id]=e,Backbone.Mediator.publish("bus:player-joined",{player:e,bus:this})},a.prototype.onPlayerLeft=function(e){var t,e=e.val();if(e&&(t=this.players[e.id]))return delete this.players[t.id],Backbone.Mediator.publish("bus:player-left",{player:t,bus:this})},a.prototype.onPlayerChanged=function(e){var t=e.val(),i=null!=(i=this.players[t.id])?i.connected:void 0;return this.players[t.id]=t,i&&!t.connected&&this.onPlayerLeft(e),t.connected&&!i&&this.onPlayerJoined(e),Backbone.Mediator.publish("bus:player-states-changed",{states:this.players,bus:this})},a.prototype.onMeSynced=function(){var e;return null!=(e=this.myConnection)?e.child("name").set(o.get("name")):void 0},a.prototype.countPlayers=function(){return _.size(this.players)},a.prototype.onPoint=function(){var e=_.keys(this.players);return e.sort(),e[0]===o.id},a.prototype.sendSystemMessage=function(e){return this.sendMessage(e,!0)},a.prototype.sendMessage=function(e,t){return null==t&&(t=!1),e={content:e.slice(0,400),authorName:o.displayName(),authorID:o.id,dateMade:new Date},t&&(e.system=t),this.fireChatRef.push(e)},a.prototype.destroy=function(){return this.joined&&this.sendMessage("/me left.",!0),this.docName in a.activeBuses&&delete a.activeBuses[this.docName],this.disconnect(),a.__super__.destroy.call(this)},a)},2551:function(e,t,i){var o=i(11);e.exports=function(e){var i,n=[],e=e||{};return function(e,t){n.push('<div class="left-wing"></div><div class="right-wing"></div><div id="loading-details" class="loading-container"><div class="level-loading-goals secret rtl-allowed"><div'+o.attr("data-i18n",t.goalHeaderTransationKey,!0,!0)+' class="goals-title">Goals</div><ul dir="auto" class="list-unstyled"></ul></div><div class="errors"></div><div class="intro-doc hidden"><div class="nano"><div class="nano-content"><div dir="auto" class="intro-doc-content"></div></div></div></div><div class="progress-or-start-container"><button'+o.attr("data-i18n",t.buttonTranslationKey,!0,!0)+' class="start-level-button btn btn-lg btn-success btn-illustrated header-font needsclick">Start Level</button><div class="load-progress"><div class="progress"><div class="progress-background"></div><div class="progress-bar-container"><div class="progress-bar progress-bar-success"></div></div><div class="rim"></div></div></div></div><div class="could-not-load"><span data-i18n="loading_error.could_not_load"></span></div><div class="subscription-required"><span data-i18n="subscribe.subscription_required_to_play"></span><button data-i18n="subscribe.subscribe_title" class="start-subscription-button btn btn-lg btn-warning"></button></div><div class="course-membership-required"><span data-i18n="courses.course_membership_required_to_play"></span><a data-i18n="courses.back_courses" href="/students" class="btn btn-lg btn-warning"></a></div><div class="license-required"><span data-i18n="courses.license_required_to_play"></span><a data-i18n="courses.back_courses" href="/students" class="btn btn-lg btn-warning"></a></div><div id="tip-wrapper" class="picoctf-hide"><strong data-i18n="play_level.tip_toggle_play" class="tip">Toggle play/paused with Ctrl+P.</strong><strong data-i18n="play_level.tip_scrub_shortcut" class="tip">Ctrl+[ and Ctrl+] rewind and fast-forward.</strong><strong data-i18n="play_level.tip_guide_exists" class="tip">Click the guide, inside game menu (at the top of the page), for useful info.</strong><strong data-i18n="play_level.tip_open_source" class="tip">CodeCombat is part of the open source community!</strong><strong data-i18n="play_level.tip_tell_friends" class="tip">Enjoying CodeCombat? Tell your friends about us!</strong><strong data-i18n="play_level.tip_beta_launch" class="tip">CodeCombat launched its beta in October, 2013.</strong><strong data-i18n="play_level.tip_think_solution" class="tip">Think of the solution, not the problem.</strong><strong data-i18n="play_level.tip_theory_practice" class="tip">In theory there is no difference between theory and practice; in practice there is. - Yogi Berra</strong><strong data-i18n="play_level.tip_error_free" class="tip">There are two ways to write error-free programs; only the third one works. - Alan Perlis</strong><strong data-i18n="play_level.tip_debugging_program" class="tip">If debugging is the process of removing bugs, then programming must be the process of putting them in. - Edsger W. Dijkstra</strong><strong data-i18n="play_level.tip_forums" class="tip">Head over to the forums and tell us what you think!</strong><strong data-i18n="play_level.tip_impossible" class="tip">It always seems impossible until it\'s done. - Nelson Mandela</strong><strong data-i18n="play_level.tip_move_forward" class="tip">Whatever you do, keep moving forward. - Martin Luther King Jr.</strong><strong data-i18n="play_level.tip_google" class="tip">Have a problem you can\'t solve? Google it!</strong><strong data-i18n="play_level.tip_solve_then_write" class="tip">First, solve the problem. Then, write the code.  John Johnson</strong><strong data-i18n="play_level.tip_mistakes_proof_of_trying" class="tip">Mistakes in your code are just proof that you are trying.</strong><strong data-i18n="play_level.tip_baby_coders" class="tip rare">In the future, even babies will be Archmages.</strong><strong data-i18n="play_level.tip_hardware_problem" class="tip rare">Q: How many programmers does it take to change a light bulb?  A: None, it\'s a hardware problem.</strong><strong data-i18n="play_level.tip_morale_improves" class="tip rare">Loading will continue until morale improves.</strong><strong data-i18n="play_level.tip_all_species" class="tip rare">We believe in equal opportunities to learn programming for all species.</strong><strong data-i18n="play_level.tip_reticulating" class="tip rare">Reticulating spines.</strong><strong data-i18n="play_level.tip_great_responsibility" class="tip rare">With great coding skill comes great debug responsibility.</strong><strong data-i18n="play_level.tip_munchkin" class="tip rare">If you don\'t eat your vegetables, a munchkin will come after you while you\'re asleep.</strong><strong data-i18n="play_level.tip_binary" class="tip rare">There are only 10 types of people in the world: those who understand binary, and those who don\'t.</strong><strong data-i18n="play_level.tip_commitment_yoda" class="tip rare">A programmer must have the deepest commitment, the most serious mind. ~ Yoda</strong><strong data-i18n="play_level.tip_no_try" class="tip rare">Do. Or do not. There is no try. - Yoda</strong><strong data-i18n="play_level.tip_patience" class="tip rare">Patience you must have, young Padawan. - Yoda</strong><strong data-i18n="play_level.tip_documented_bug" class="tip rare">A documented bug is not a bug; it is a feature.</strong><strong data-i18n="play_level.tip_talk_is_cheap" class="tip rare">Talk is cheap. Show me the code. - Linus Torvalds</strong><strong data-i18n="play_level.tip_first_language" class="tip rare">The most disastrous thing that you can ever learn is your first programming language. - Alan Kay</strong><strong data-i18n="play_level.tip_hofstadters_law" class="tip rare">Hofstadter\'s Law: It always takes longer than you expect, even when you take into account Hofstadter\'s Law.</strong><strong data-i18n="play_level.tip_premature_optimization" class="tip rare">Premature optimization is the root of all evil - Donald Knuth</strong><strong data-i18n="play_level.tip_brute_force" class="tip rare">When in doubt, use brute force. - Ken Thompson</strong><strong data-i18n="play_level.tip_extrapolation" class="tip rare">There are only two kinds of people: those that can extrapolate from incomplete data...</strong><strong data-i18n="play_level.tip_superpower" class="tip rare">Coding is the closest thing we have to a superpower</strong><strong data-i18n="play_level.tip_source_code" class="tip rare">I want to change the world but they would not give me the source code.</strong><strong data-i18n="play_level.tip_javascript_java" class="tip rare">Java is to JavaScript what Car is to Carpet. - Chris Heilmann</strong><strong class="tip rare"><span data-i18n="play_level.tip_harry" class="spr">Yer a Wizard,</span><span>'+o.escape(null==(i=e.get("name",!0))?"":i)+'</span></strong><strong data-i18n="play_level.tip_control_destiny" class="tip rare">In real open source, you have the right to control your own destiny. - Linus Torvalds</strong><strong data-i18n="play_level.tip_no_code" class="tip rare">No code is faster than no code.</strong><strong data-i18n="play_level.tip_code_never_lies" class="tip rare">Code never lies, comments sometimes do.  Ron Jeffries</strong><strong data-i18n="play_level.tip_reusable_software" class="tip rare">Before software can be reusable it first has to be usable.</strong><strong data-i18n="play_level.tip_optimization_operator" class="tip rare">Every language has an optimization operator. In most languages that operator is //</strong><strong data-i18n="play_level.tip_lines_of_code" class="tip rare">Measuring programming progress by lines of code is like measuring aircraft building progress by weight.  Bill Gates</strong><strong data-i18n="play_level.tip_adding_evil" class="tip rare">Adding a pinch of evil.</strong><strong data-i18n="play_level.tip_adding_orgres" class="tip rare">Rounding up ogres.</strong><strong data-i18n="play_level.tip_sharpening_swords" class="tip rare">Sharpening the swords.</strong><strong data-i18n="play_level.tip_hate_computers" class="tip rare">That\'s the thing about people who think they hate computers. What they really hate is lousy programmers. - Larry Niven</strong><strong class="tip rare"><a href="https://github.com/codecombat/codecombat/wiki" data-i18n="play_level.tip_open_source_contribute">You can help CodeCombat improve!</a></strong><strong data-i18n="play_level.tip_recurse" class="tip rare">To iterate is human, to recurse divine. - L. Peter Deutsch</strong><strong data-i18n="play_level.tip_free_your_mind" class="tip rare">You have to let it all go, Neo. Fear, doubt, and disbelief. Free your mind. - Morpheus</strong><strong data-i18n="play_level.tip_strong_opponents" class="tip rare">Even the strongest of opponents always has a weakness. - Itachi Uchiha</strong><strong data-i18n="play_level.tip_paper_and_pen" class="tip rare">Before you start coding, you can always plan with a sheet of paper and a pen.</strong><strong data-i18n="play_level.tip_compiler_ignores_comments" class="tip rare">Sometimes I think that the compiler ignores my comments.</strong><strong data-i18n="play_level.tip_understand_recursion" class="tip rare">The only way to understand recursion is to understand recursion.</strong><strong data-i18n="play_level.tip_open_source_and_polymorphism" class="tip rare">Open Source projects are like totally polymorphic heterogeneous structures: All types are welcome.</strong><strong data-i18n="play_level.tip_ratatouille" class="tip rare">You must not let anyone define your limits because of where you come from. Your only limit is your soul. - Gusteau, Ratatouille</strong><strong data-i18n="play_level.tip_nemo" class="tip rare">When life gets you down, want to know what you\'ve gotta do? Just keep swimming, just keep swimming. - Dory, Finding Nemo</strong><strong data-i18n="play_level.tip_internet_weather" class="tip rare">Just move to the internet, it\'s great here. We get to live inside where the weather is always awesome. - John Green</strong><strong data-i18n="play_level.tip_nerds" class="tip rare">Nerds are allowed to love stuff, like jump-up-and-down-in-the-chair-can\'t-control-yourself love it. - John Green</strong><strong data-i18n="play_level.tip_self_taught" class="tip rare">I taught myself 90% of what I\'ve learned. And that\'s normal! - Hank Green</strong><strong data-i18n="play_level.tip_luna_lovegood" class="tip rare">Don\'t worry, you\'re just as sane as I am. - Luna Lovegood</strong><strong data-i18n="play_level.tip_good_idea" class="tip rare">The best way to have a good idea is to have a lot of ideas. - Linus Pauling</strong><strong data-i18n="play_level.tip_programming_not_about_computers" class="tip rare">Computer Science is no more about computers than astronomy is about telescopes. - Edsger Dijkstra</strong><strong data-i18n="play_level.tip_mulan" class="tip rare">Believe you can, then you will. - Mulan</strong></div></div>')}.call(this,"me"in e?e.me:"undefined"!=typeof me?me:void 0,"view"in e?e.view:"undefined"!=typeof view?view:void 0),n.join("")}},2552:function(e,t,i){"use strict";i.r(t);var n,o=i(3059),s=i(1926);for(n in s)["default"].indexOf(n)<0&&function(e){i.d(t,e,function(){return s[e]})}(n);i(2553);var r=i(19),o=Object(r.a)(s.default,o.a,o.b,!1,null,"1dce20e3",null);t.default=o.exports},2553:function(e,t,i){"use strict";var n=i(1928);i.n(n).a},2554:function(e,t,i){},2555:function(e,t,i){"use strict";var n=i(1929);i.n(n).a},2556:function(e,t,i){},2557:function(a,e,l){!function(o,t){var e,i,n=function(e,t){return function(){return e.apply(t,arguments)}},s={}.hasOwnProperty;function r(e){this.onWindowResize=n(this.onWindowResize,this),this.supermodel=e.supermodel,r.__super__.constructor.call(this,e),this.level=e.level,this.session=e.session,null!=e.problem?(this.problem=e.problem,this.onWindowResize()):this.$el.hide(),this.duckImg=_.sample(this.duckImages),o(window).on("resize",this.onWindowResize)}l(2558),e=l(26),l(1930),i=l(2571),l(44).me,a.exports=(function(e,t){for(var i in t)s.call(t,i)&&(e[i]=t[i]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(r,e),r.prototype.id="problem-alert-view",r.prototype.className="problem-alert",r.prototype.template=i,r.prototype.duckImages=["/images/pages/play/duck_alejandro.png","/images/pages/play/duck_anya2.png","/images/pages/play/duck_ida.png","/images/pages/play/duck_okar.png","/images/pages/play/duck_tharin2.png","/images/pages/play/duck_amara.png","/images/pages/play/duck_arryn.png","/images/pages/play/duck_hattori.png","/images/pages/play/duck_hushbaum.png","/images/pages/play/duck_illia.png","/images/pages/play/duck_nalfar.png","/images/pages/play/duck_naria.png","/images/pages/play/duck_omarn.png","/images/pages/play/duck_pender.png","/images/pages/play/duck_ritic.png","/images/pages/play/duck_senick.png","/images/pages/play/duck_usara.png","/images/pages/play/duck_zana.png"],r.prototype.subscriptions={"tome:show-problem-alert":"onShowProblemAlert","tome:hide-problem-alert":"onHideProblemAlert","level:restart":"onHideProblemAlert","tome:jiggle-problem-alert":"onJiggleProblemAlert","tome:manual-cast":"onHideProblemAlert"},r.prototype.events={"click .close":"onRemoveClicked",click:function(){return Backbone.Mediator.publish("tome:focus-editor",{})}},r.prototype.destroy=function(){return o(window).off("resize",this.onWindowResize),r.__super__.destroy.call(this)},r.prototype.afterRender=function(){if(r.__super__.afterRender.call(this),null!=this.problem)return this.$el.addClass("alert").addClass("alert-"+this.problem.level).hide().fadeIn("slow"),this.problem.hint||this.$el.addClass("no-hint"),this.playSound("error_appear")},r.prototype.setProblemMessage=function(){var e,t,i;if(null!=this.problem)return e=function(e){if(null!=e)return marked(e)},t=this.problem.message,null!=this.problem.hint&&/(?:null|undefined)/.test(this.problem.hint)&&null!=(i=null!=(i=this.problem.userInfo)?i.age:void 0)&&(t=/^Line \d+:/.test(t)?t.replace(/^(Line \d+)/,"$1, time "+i.toFixed(1)):"Time "+i.toFixed(1)+": "+t),this.message=e(t),this.hint=e(this.problem.hint)},r.prototype.onShowProblemAlert=function(e){if(o("#code-area").is(":visible")||this.level.isType("game-dev"))return null!=this.problem&&(this.$el.hasClass("alert-"+this.problem.level)&&this.$el.removeClass("alert-"+this.problem.level),this.$el.hasClass("no-hint")&&this.$el.removeClass("no-hint")),this.problem=e.problem,this.lineOffsetPx=e.lineOffsetPx||0,this.$el.show(),this.onWindowResize(),this.setProblemMessage(),this.render(),this.onJiggleProblemAlert(),null!=(e=t.tracker)?e.trackEvent("Show problem alert",{levelID:this.level.get("slug"),ls:null!=(e=this.session)?e.get("_id"):void 0}):void 0},r.prototype.onJiggleProblemAlert=function(){var t;if(null!=this.problem)return this.$el.is(":visible")||this.$el.show(),this.$el.addClass("jiggling"),this.playSound("error_appear"),t=this,_.delay(function(){var e;return null!=(e=t.$el)?e.removeClass("jiggling"):void 0},1e3)},r.prototype.onHideProblemAlert=function(){if(this.$el.is(":visible"))return this.onRemoveClicked()},r.prototype.onRemoveClicked=function(){return this.playSound("menu-button-click"),this.$el.hide(),Backbone.Mediator.publish("tome:focus-editor",{})},r.prototype.onWindowResize=function(e){var t,i,n;if(null!=this.problem)return n=o(".level-content").outerWidth(!0),i=o("#goals-view").outerWidth(!0),t=o("#code-area").outerWidth(!0),this.$el.css("max-width",n-t-i+40+"px"),this.$el.css("right",t+"px"),this.$el.css("top",110+this.lineOffsetPx+"px")},r)}.call(this,l(3),l(17))},2558:function(e,t,i){var n=i(2559);(n="string"==typeof n?[[e.i,n,""]]:n).locals&&(e.exports=n.locals);(0,i(21).default)("0920dfd2",n,!0,{})},2559:function(e,t,i){},2560:function(e,t,i){var n=i(2561);(n="string"==typeof n?[[e.i,n,""]]:n).locals&&(e.exports=n.locals);(0,i(21).default)("7fe95800",n,!0,{})},2561:function(e,t,i){},2562:function(e,t,i){var c=i(11);e.exports=function(e){var l=[],e=e||{};return function(e,s,t,r,a,i,n){l.push('<div class="modal-dialog"><div class="modal-content"><img src="/images/pages/play/modal/game-menu-background.png" draggable="false" id="game-menu-background"><div id="close-modal"><span class="glyphicon glyphicon-remove"></span></div><ul id="game-menu-nav" dir="ltr" class="nav nav-pills nav-stacked">'),n.showsChooseHero()&&l.push('<li><a id="change-hero-tab"><span class="glyphicon glyphicon-user"></span><span data-i18n="[title]game_menu.choose_hero_caption;play.change_hero"></span></a></li>'),function(){var e=a;if("number"==typeof e.length)for(var t=0,i=e.length;t<i;t++){var n=e[t];l.push("<li"+c.cls([n===r?"active":""],[!0])+"><a"+c.attr("href","#"+n+"-view",!0,!0)+' data-toggle="tab"><span'+c.cls(["glyphicon","glyphicon-"+s[n]],[null,!0])+"></span>");var o="game_menu."+n.replace("-","_");l.push("<span"+c.attr("data-i18n","[title]"+o+"_caption;"+o+"_tab",!0,!0)+"></span></a></li>")}else{i=0;for(t in e){i++;n=e[t];l.push("<li"+c.cls([n===r?"active":""],[!0])+"><a"+c.attr("href","#"+n+"-view",!0,!0)+' data-toggle="tab"><span'+c.cls(["glyphicon","glyphicon-"+s[n]],[null,!0])+"></span>");o="game_menu."+n.replace("-","_");l.push("<span"+c.attr("data-i18n","[title]"+o+"_caption;"+o+"_tab",!0,!0)+"></span></a></li>")}}}.call(this),t.get("anonymous")&&!e.noAuth&&l.push('<li data-toggle="coco-modal" data-target="core/CreateAccountModal" class="auth-tab"><a data-toggle="coco-modal" data-target="core/CreateAccountModal"><span class="glyphicon glyphicon-pencil"></span><span data-i18n="[title]game_menu.auth_caption;game_menu.auth_tab"></span></a></li>'),l.push('</ul><div class="tab-content game-menu-tab-content">'),function(){var e=a;if("number"==typeof e.length)for(var t=0,i=e.length;t<i;t++){var n=e[t];l.push("<div"+c.attr("id",n+"-view",!0,!0)+' class="tab-pane"></div>')}else{i=0;for(t in e){i++;n=e[t];l.push("<div"+c.attr("id",n+"-view",!0,!0)+' class="tab-pane"></div>')}}}.call(this),l.push("</div></div></div>")}.call(this,"features"in e?e.features:"undefined"!=typeof features?features:void 0,"iconMap"in e?e.iconMap:"undefined"!=typeof iconMap?iconMap:void 0,"me"in e?e.me:"undefined"!=typeof me?me:void 0,"showTab"in e?e.showTab:"undefined"!=typeof showTab?showTab:void 0,"submenus"in e?e.submenus:"undefined"!=typeof submenus?submenus:void 0,"undefined"in e?e.undefined:void 0,"view"in e?e.view:"undefined"!=typeof view?view:void 0),l.join("")}},2563:function(s,e,r){!function(t){var e,i,o={}.hasOwnProperty;function n(){return n.__super__.constructor.apply(this,arguments)}r(2564),e=r(26),i=r(2566),r(44).me,r(1374),s.exports=(function(e,t){for(var i in t)o.call(t,i)&&(e[i]=t[i]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(n,e),n.prototype.id="save-load-view",n.prototype.className="tab-pane",n.prototype.template=i,n.prototype.events={"change #save-granularity-toggle input":"onSaveGranularityChanged"},n.prototype.afterRender=function(){return n.__super__.afterRender.call(this)},n.prototype.onSaveGranularityChanged=function(e){return this.playSound("menu-button-click"),e=t(e.target).val(),this.$el.find(".save-list, .save-pane").hide(),this.$el.find(".save-list."+e+", .save-pane."+e).show()},n)}.call(this,r(3))},2564:function(e,t,i){var n=i(2565);(n="string"==typeof n?[[e.i,n,""]]:n).locals&&(e.exports=n.locals);(0,i(21).default)("637bcc18",n,!0,{})},2565:function(e,t,i){},2566:function(e,t,i){i(11);e.exports=function(e){var t=[];return t.push('<div class="row"><div class="col-sm-4"><div data-toggle="buttons" id="save-granularity-toggle" class="btn-group"><label class="btn btn-primary active"><input type="radio" checked value="level-sessions"><span data-i18n="save_load.granularity_saved_games" title="Manage your saved games"></span></label><label class="btn btn-primary"><input type="radio" value="change-history"><span data-i18n="save_load.granularity_change_history" title="See your autosaved code edit history"></span></label></div><div class="save-list level-sessions"><ul class="list-group"><li class="list-group-item">Save 001</li><li class="list-group-item">Greedy Algorithm</li><li class="list-group-item">Defensive Strategy</li></ul></div><div class="save-list change-history secret"><ul class="list-group"><li class="list-group-item">--item switches yeah--</li><li class="list-group-item">Autosaved 17:05</li><li class="list-group-item">Autosaved 14:45</li><li class="list-group-item">Autosaved 16:40</li><li class="list-group-item">Autosaved 5:05</li><li class="list-group-item">Autosaved 5:00</li><li class="list-group-item">--item switches yeah--</li><li class="list-group-item">Autosaved 4:50</li><li class="list-group-item">Autosaved 7/7/14</li><li class="list-group-item">Autosaved 7/7/14</li></ul></div></div><div class="col-sm-8"><div class="save-pane level-sessions"><img src="/images/pages/game-menu/save-load-stub.png"><h3>Interactions:</h3><ul><li>On the left is a flat list of saves for this level. Click one and the stuff on the right appears.</li><li>There are name and description input boxes. Editing them auto updates the save on the left.</li><li>There are also items showing what the current equipment is, and below the current code. Neither are editable.</li><li>If you click the red box on any save, or click the delete button for the selected save, it asks for confirmation, then deletes.</li><li>Click the new save button: current code, items and empty name/description appear on the right, and a new save slot appears at the top of the list on the left, which is selected. Works like editing otherwise.</li></ul></div><div class="save-pane change-history secret"><img src="/images/pages/game-menu/save-load-history-stub.png"><h3>Interactions</h3><ul><li>Similar to WebStorm. Click history tab in the upper left of the save/load screen to switch to this view.</li><li>Click the left row of VCS versions, and the hero, language, items and code for it shows on the right.</li><li>Click revert to set the code back to the version of the code on the left. Modal closes with the new code.</li><li>Might experiment with showing diffs with difflib. More of an interface issue than a showing-diff issue.</li></ul></div></div></div>'),t.join("")}},2567:function(e,t,i){var n,o,s,r=function(e,t){return function(){return e.apply(t,arguments)}},a={}.hasOwnProperty;function l(e){this.onVolumeSliderChange=r(this.onVolumeSliderChange,this),l.__super__.constructor.call(this,e)}i(2568),n=i(26),s=i(2570),o=i(44).me,i(1374),i(37),i(27),e.exports=(function(e,t){for(var i in t)a.call(t,i)&&(e[i]=t[i]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(l,n),l.prototype.id="options-view",l.prototype.className="tab-pane",l.prototype.template=s,l.prototype.aceConfig={},l.prototype.defaultConfig={language:"python",keyBindings:"default",behaviors:!1,liveCompletion:!0},l.prototype.events={"change #option-music":"updateMusic","change #option-behaviors":"updateBehaviors","change #option-live-completion":"updateLiveCompletion","click .profile-photo":"onEditProfilePhoto","click .editable-icon":"onEditProfilePhoto"},l.prototype.getRenderData=function(e){var t;return e=l.__super__.getRenderData.call(this,e=null==e?{}:e),this.aceConfig=_.cloneDeep(null!=(t=o.get("aceConfig"))?t:{}),this.aceConfig=_.defaults(this.aceConfig,this.defaultConfig),e.aceConfig=this.aceConfig,e.music=o.get("music",!0),e},l.prototype.afterRender=function(){return l.__super__.afterRender.call(this),this.volumeSlider=this.$el.find("#option-volume").slider({animate:"fast",min:0,max:1,step:.05}),this.volumeSlider.slider("value",o.get("volume")),this.volumeSlider.on("slide",this.onVolumeSliderChange),this.volumeSlider.on("slidechange",this.onVolumeSliderChange)},l.prototype.destroy=function(){var e;return null!=(e=this.volumeSlider)&&"function"==typeof e.slider&&e.slider("destroy"),l.__super__.destroy.call(this)},l.prototype.onVolumeSliderChange=function(e){var t=this.volumeSlider.slider("value");return o.set("volume",t),this.$el.find("#option-volume-value").text((100*t).toFixed(0)+"%"),Backbone.Mediator.publish("level:set-volume",{volume:t}),this.playSound("menu-button-click")},l.prototype.onHidden=function(){return this.aceConfig.keyBindings="default",this.aceConfig.behaviors=this.$el.find("#option-behaviors").prop("checked"),this.aceConfig.liveCompletion=this.$el.find("#option-live-completion").prop("checked"),o.set("aceConfig",this.aceConfig),o.patch(),Backbone.Mediator.publish("tome:change-config",{})},l.prototype.updateMusic=function(){return o.set("music",this.$el.find("#option-music").prop("checked"))},l.prototype.updateKeyBindings=function(){return this.aceConfig.keyBindings=this.$el.find("#option-key-bindings").val()},l.prototype.updateBehaviors=function(){return this.aceConfig.behaviors=this.$el.find("#option-behaviors").prop("checked")},l.prototype.updateLiveCompletion=function(){return this.aceConfig.liveCompletion=this.$el.find("#option-live-completion").prop("checked")},l)},2568:function(e,t,i){var n=i(2569);(n="string"==typeof n?[[e.i,n,""]]:n).locals&&(e.exports=n.locals);(0,i(21).default)("6b314598",n,!0,{})},2569:function(e,t,i){},2570:function(e,t,i){var n=i(11);e.exports=function(e){var i=[],e=e||{};return function(e,t){i.push('<div class="form"><h3 data-i18n="options.general_options">General Options</h3><div id="volume-group" class="form-group slider-group"><span class="glyphicon glyphicon-volume-down"></span><div id="option-volume" class="slider spr spl"></div><span class="glyphicon glyphicon-volume-up"></span></div><div class="form-group checkbox"><label for="option-music" class="control-label"><input id="option-music" name="option-music" type="checkbox"'+n.attr("checked",t,!0,!0)+'><span class="custom-checkbox"><div class="glyphicon glyphicon-ok"></div></span><span data-i18n="options.music_label">Music</span></label><span data-i18n="options.music_description" class="help-block">Turn background music on/off.</span></div><img src="/images/pages/play/modal/hr.png" draggable="false" class="hr"><h3 data-i18n="options.editor_config_title">Editor Configuration</h3><div class="form-group checkbox"><label for="option-live-completion"><input id="option-live-completion" name="liveCompletion" type="checkbox"'+n.attr("checked",e.liveCompletion,!0,!0)+'><span class="custom-checkbox"><div class="glyphicon glyphicon-ok"></div></span><span data-i18n="options.editor_config_livecompletion_label">Live Autocompletion</span></label><span data-i18n="options.editor_config_livecompletion_description" class="help-block">Displays autocomplete suggestions while typing.</span></div><div class="form-group checkbox"><label for="option-behaviors"><input id="option-behaviors" name="behaviors" type="checkbox"'+n.attr("checked",e.behaviors,!0,!0)+'><span class="custom-checkbox"><div class="glyphicon glyphicon-ok"></div></span><span data-i18n="options.editor_config_behaviors_label">Smart Behaviors</span></label><span data-i18n="options.editor_config_behaviors_description" class="help-block">Autocompletes brackets, braces, and quotes.</span></div></div>')}.call(this,"aceConfig"in e?e.aceConfig:"undefined"!=typeof aceConfig?aceConfig:void 0,"music"in e?e.music:"undefined"!=typeof music?music:void 0),i.join("")}},2571:function(e,t,i){var n=i(11);e.exports=function(e){var t,i=[],e=e||{};return function(e){i.push('<button type="button" class="close">&times;</button><table><tr>'),e.duckImg&&i.push("<td><img"+n.attr("src",e.duckImg,!0,!0)+' width="100" class="duck-img"></td>'),i.push('<td><h3 data-i18n="play_level.problem_alert_title" class="problem-alert-title">Fix Your Code</h3>'),e.hint?i.push('<span class="problem-title">'+(null==(t=e.hint)?"":t)+'</span><br><span class="problem-subtitle">'+(null==(t=e.message)?"":t)+"</span>"):i.push('<span class="problem-title">'+(null==(t=e.message)?"":t)+"</span>"),i.push("</td></tr></table>")}.call(this,"view"in e?e.view:"undefined"!=typeof view?view:void 0),i.join("")}},2572:function(e,t,i){var n=i(2573);(n="string"==typeof n?[[e.i,n,""]]:n).locals&&(e.exports=n.locals);(0,i(21).default)("7bf1f81e",n,!0,{})},2573:function(e,t,i){},2574:function(e,t,i){i(11);e.exports=function(e){var t=[];return t.push('<div id="spell-top-bar-view"></div><div id="cast-button-view"></div><div id="spell-view"></div>'),t.join("")}},2575:function(s,e,r){!function(l){var t,i,n,c,e,h,u,p,d=[].indexOf||function(e){for(var t=0,i=this.length;t<i;t++)if(t in this&&this[t]===e)return t;return-1};function o(e){this.spellKey=e.spellKey,this.pathComponents=e.pathComponents,this.session=e.session,this.otherSession=e.otherSession,this.spectateView=e.spectateView,this.spectateOpponentCodeLanguage=e.spectateOpponentCodeLanguage,this.observing=e.observing,this.supermodel=e.supermodel,this.skipProtectAPI=e.skipProtectAPI,this.worker=e.worker,this.level=e.level,this.createFromProgrammableMethod(e.programmableMethod,e.language),this.canRead()&&(this.view=new i({spell:this,level:e.level,session:this.session,otherSession:this.otherSession,worker:this.worker,god:e.god,supermodel:this.supermodel,levelID:e.levelID}),this.view.render(),this.topBarView=new t({hintsState:e.hintsState,spell:this,supermodel:this.supermodel,codeLanguage:this.language,level:e.level,session:e.session,courseID:e.courseID,courseInstanceID:e.courseInstanceID}),this.topBarView.render()),Backbone.Mediator.publish("tome:spell-created",{spell:this})}i=r(2576),t=r(2589),c=r(44).me,e=r(167),n=e.createAetherOptions,h=e.replaceSimpleLoops,u=e.translateJS,p=r(6),s.exports=(o.prototype.loaded=!1,o.prototype.view=null,o.prototype.topBarView=null,o.prototype.createFromProgrammableMethod=function(e,t){var i,n,e=e;if(this.commentI18N=e.i18n,this.commentContext=e.context,e.sourceVariants?this.languages=_.clone(_.sample(e.sourceVariants)):this.languages=null!=(i=e.languages)?i:{},null==(i=this.languages).javascript&&(i.javascript=e.source),this.name=e.name,this.permissions={read:null!=(i=null!=(i=e.permissions)?i.read:void 0)?i:[],readwrite:null!=(i=null!=(i=e.permissions)?i.readwrite:void 0)?i:["humans"]},this.team=null!=(i=this.permissions.readwrite[0])?i:"common",this.canWrite()?this.setLanguage(t):this.otherSession&&this.team===this.otherSession.get("team")?this.setLanguage(this.otherSession.get("submittedCodeLanguage")||this.otherSession.get("codeLanguage")):this.setLanguage("javascript"),this.source=this.originalSource,this.parameters=e.parameters,(this.otherSession&&this.team===this.otherSession.get("team")&&(n=this.otherSession.getSourceFor(this.spellKey))||this.permissions.readwrite.length&&(n=this.session.getSourceFor(this.spellKey))&&"// Should fill in some default source\n"!==n)&&(this.source=h(n,this.language)),e.aiSource&&!this.otherSession&&!this.canWrite())return this.source=this.originalSource=e.aiSource,this.isAISource=!0},o.prototype.destroy=function(){var e;return null!=(e=this.view)&&e.destroy(),null!=(e=this.topBarView)&&e.destroy(),this.thang=null,this.worker=null},o.prototype.setLanguage=function(e){var t,i,n,o,s,r,a;if(this.language=e,this.level.isType("web-dev")&&(this.language="html"),this.displayCodeLanguage=p.capitalLanguages[this.language],"java"!==this.language||this.languages[this.language]||(""!==(o=(null!=(o=this.languages.javascript)?o:"").split("\n"))[o.length-1]&&o.push(""),this.languages.java="public class AI {\n  public static void main(String[] args) {\n"+o.map(function(e){return"    "+e}).join("\n")+"\n  }\n}"),"cpp"!==(o=this.language)&&"java"!==o&&"lua"!==o&&"coffeescript"!==o&&"python"!==o||this.languages[this.language]||(this.languages[this.language]=u(this.languages.javascript,this.language)),this.originalSource=null!=(o=this.languages[this.language])?o:this.languages.javascript,window.serverConfig.picoCTF&&(this.originalSource=this.addPicoCTFProblem()),this.level.isType("web-dev")&&(o=p.extractPlayerCodeTag(this.originalSource),this.wrapperCode=this.originalSource.replace(/<playercode>[\s\S]*<\/playercode>/,""),this.originalSource=o),this.commentContext){if(t=l.extend(!0,{},this.commentContext),"lua"===this.language)for(n in t)a=t[n],t[n]=a.replace(/\b([a-zA-Z]+)\.([a-zA-Z_]+\()/,"$1:$2");if(this.commentI18N)for(s=c.get("preferredLanguage");s;){if(null!=i&&(s=s.substr(0,s.lastIndexOf("-"))),r=null!=(r=this.commentI18N[s])?r.context:void 0){t=_.merge(t,r);break}i=!0}try{this.originalSource=_.template(this.originalSource,t),this.wrapperCode=_.template(this.wrapperCode,t)}catch(e){console.error("Couldn't create example code template of",this.originalSource,"\nwith context",t,"\nError:",e)}return/loop/.test(this.originalSource)&&this.level.isType("course","course-ladder","hero","hero-ladder")?this.originalSource=h(this.originalSource,this.language):void 0}},o.prototype.constructHTML=function(e){return this.wrapperCode.replace("",e)},o.prototype.addPicoCTFProblem=function(){var o,s,e;return(e=this.level.picoCTFProblem)?(o=("-- "+e.name+" --\n"+e.description).replace(/<p>(.*?)<\/p>/gi,"$1"),function(){for(var e=o.split("\n"),t=[],i=0,n=e.length;i<n;i++)s=e[i],t.push("// "+s);return t}().join("\n")+"\n"+this.originalSource):this.originalSource},o.prototype.addThang=function(e){var t;return(null!=(t=this.thang)?t.thang.id:void 0)===e.id?this.thang.thang=e:this.thang={thang:e,aether:this.createAether(e),castAether:null}},o.prototype.removeThangID=function(e){var t;if((null!=(t=this.thang)?t.thang.id:void 0)===e)return this.thang=null},o.prototype.canRead=function(e){var t=null!=e?e:c.team;return 0<=d.call(this.permissions.read,t)||(e=null!=e?e:c.team,0<=d.call(this.permissions.readwrite,e))},o.prototype.canWrite=function(e){e=null!=e?e:c.team;return 0<=d.call(this.permissions.readwrite,e)},o.prototype.getSource=function(){var e;return null!=(e=null!=(e=this.view)?e.getSource():void 0)?e:this.source},o.prototype.transpile=function(e){var t;return e?this.source=e:e=this.getSource(),"html"!==this.language&&(null!=(t=this.thang)&&t.aether.transpile(e),this.session.lastAST=null!=(e=this.thang)?e.aether.ast:void 0),null},o.prototype.hasChanged=function(e,t){return(null!=(e=null==e?null:e)?e:this.originalSource)!==(null!=(t=null==t?null:t)?t:this.source)},o.prototype.hasChangedSignificantly=function(e,t,i){var n,o,s;return null==e&&(e=null),null==t&&(t=null),(n=null!=(o=this.thang)?o.aether:void 0)||(console.error(this.toString(),"couldn't find a spellThang with aether",this.thang),i(!1)),this.worker?(o={function:"hasChangedSignificantly",a:null!=e?e:this.originalSource,spellKey:this.spellKey,b:null!=t?t:this.source,careAboutLineNumbers:!0,careAboutLint:!0},this.worker.addEventListener("message",(s=this,function(e){var t=JSON.parse(e.data);if("hasChangedSignificantly"===t.function&&t.spellKey===s.spellKey)return s.worker.removeEventListener("message",arguments.callee,!1),i(t.hasChanged)})),this.worker.postMessage(JSON.stringify(o))):i(n.hasChangedSignificantly(null!=e?e:this.originalSource,null!=t?t:this.source,!0,!0))},o.prototype.createAether=function(e){var t=0<this.permissions.readwrite.length&&!this.isAISource,i=this.skipProtectAPI||!t||this.level.isType("game-dev"),t=this.createProblemContext(e),e=this.level.isType("hero","hero-ladder","hero-coop","course","course-ladder","game-dev","ladder")&&!i,e=n({functionName:this.name,codeLanguage:this.language,functionParameters:this.parameters,skipProtectAPI:i,includeFlow:e,problemContext:t,useInterpreter:!0}),t=new Aether(e);return this.worker&&(e={function:"createAether",spellKey:this.spellKey,options:e},this.worker.postMessage(JSON.stringify(e))),t},o.prototype.updateLanguageAether=function(e){var t;return this.language=e,null!=(e=this.thang)&&null!=(t=e.aether)&&t.setLanguage(this.language),null!=(t=this.thang)&&(t.castAether=null),Backbone.Mediator.publish("tome:spell-changed-language",{spell:this,language:this.language}),this.worker&&(t={function:"updateLanguageAether",newLanguage:this.language},this.worker.postMessage(JSON.stringify(t))),this.transpile()},o.prototype.toString=function(){return"<Spell: "+this.spellKey+">"},o.prototype.createProblemContext=function(e){var t,i,n,o,s,r,a,l,c;if(null!=this.problemContext)return this.problemContext;if(this.problemContext={stringReferences:[],thisMethods:[],thisProperties:[]},this.problemContext.commonThisMethods=["moveRight","moveLeft","moveUp","moveDown","attack","findNearestEnemy","buildXY","moveXY","say","move","distance","findEnemies","findFriends","addFlag","findFlag","removeFlag","findFlags","attackRange","cast","buildTypes","jump","jumpTo","attackXY"],null==e)return this.problemContext;for(i in r=null!=(s=e.world)?s.thangMap:void 0)((c=r[i]).isAttackable||c.isSelectable)&&(a=c.id,d.call(this.problemContext.stringReferences,a)<0)&&this.problemContext.stringReferences.push(c.id);if(null!=e.programmableProperties)for(t=0,n=(l=e.programmableProperties).length;t<n;t++)o=l[t],(_.isFunction(e[o])?this.problemContext.thisMethods:this.problemContext.thisProperties).push(o);return this.problemContext.thisValueAlias=this.level.isType("game-dev")?"game":"hero",this.problemContext},o.prototype.reloadCode=function(){var e,t,i;if(i=null!=(e=this.thang)&&null!=(t=e.thang)&&null!=(i=t.programmableMethods)?i[this.name]:void 0)return this.createFromProgrammableMethod(i,this.language)},o)}.call(this,r(3))},2576:function(v,e,b){!function($,J){var u,t,e,i,n,o,Y,s,r,a,l,c,B,h,S,p,L,d,K,m=function(e,t){return function(){return e.apply(t,arguments)}},f={}.hasOwnProperty,g=[].indexOf||function(e){for(var t=0,i=this.length;t<i;t++)if(t in this&&this[t]===e)return t;return-1};function y(e){this.checkSuspectCode=m(this.checkSuspectCode,this),this.checkRequiredCode=m(this.checkRequiredCode,this),this.onWindowResize=m(this.onWindowResize,this),this.toggleBackground=m(this.toggleBackground,this),this.onGutterClick=m(this.onGutterClick,this),this.highlightCurrentLine=m(this.highlightCurrentLine,this),this.onAceMouseMove=m(this.onAceMouseMove,this),this.updateAether=m(this.updateAether,this),this.fetchTokenForSource=m(this.fetchTokenForSource,this),this.fetchToken=m(this.fetchToken,this),this.updateHTML=m(this.updateHTML,this),this.onCursorActivity=m(this.onCursorActivity,this),this.saveSpade=m(this.saveSpade,this),this.updateLines=m(this.updateLines,this),this.notifyEditingBegan=m(this.notifyEditingBegan,this),this.notifyEditingEnded=m(this.notifyEditingEnded,this),this.notifySpellChanged=m(this.notifySpellChanged,this),this.onAllLoaded=m(this.onAllLoaded,this),this.supermodel=e.supermodel,y.__super__.constructor.call(this,e),this.worker=e.worker,this.session=e.session,this.spell=e.spell,this.problems=[],this.savedProblems={},e=L.team,g.call(this.spell.permissions.readwrite,e)<0&&(this.writable=!1),this.highlightCurrentLine=_.throttle(this.highlightCurrentLine,100),$(window).on("resize",this.onWindowResize),this.observing=this.session.get("creator")!==L.id}b(2577),e=b(26),d=b(2579),L=b(44).me,p=b(1741),B=b(1383),Y=B.require("ace/range").Range,l=B.require("ace/undomanager").UndoManager,o=b(1681),s=b(2580),a=b(2582),r=b(2584),b(619),c=b(1414),h=b(1403),i=b(1404),t=b(2586),B.require("ace/token_iterator").TokenIterator,n=b(1448),K=b(6),u=b(181),v.exports=(function(e,t){for(var i in t)f.call(t,i)&&(e[i]=t[i]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(y,e),y.prototype.id="spell-view",y.prototype.className="shown",y.prototype.template=d,y.prototype.controlsEnabled=!0,y.prototype.eventsSuppressed=!0,y.prototype.writable=!0,y.prototype.languagesThatUseWorkers=["html"],y.prototype.keyBindings={default:null,vim:"ace/keyboard/vim",emacs:"ace/keyboard/emacs"},y.prototype.subscriptions={"level:disable-controls":"onDisableControls","level:enable-controls":"onEnableControls","surface:frame-changed":"onFrameChanged","surface:coordinate-selected":"onCoordinateSelected","god:new-world-created":"onNewWorld","god:user-code-problem":"onUserCodeProblem","god:non-user-code-problem":"onNonUserCodeProblem","tome:manual-cast":"onManualCast","tome:spell-changed":"onSpellChanged","level:session-will-save":"onSessionWillSave","modal:closed":"focus","tome:focus-editor":"focus","tome:spell-statement-index-updated":"onStatementIndexUpdated","tome:change-language":"onChangeLanguage","tome:change-config":"onChangeEditorConfig","tome:update-snippets":"addAutocompleteSnippets","tome:insert-snippet":"onInsertSnippet","tome:spell-beautify":"onSpellBeautify","tome:maximize-toggled":"onMaximizeToggled","tome:problems-updated":"onProblemsUpdated","script:state-changed":"onScriptStateChange","playback:ended-changed":"onPlaybackEndedChanged","level:contact-button-pressed":"onContactButtonPressed","level:show-victory":"onShowVictory","web-dev:error":"onWebDevError"},y.prototype.events={mouseout:"onMouseOut"},y.prototype.afterRender=function(){return y.__super__.afterRender.call(this),this.createACE(),this.createACEShortcuts(),this.hookACECustomBehavior(),this.fillACE(),this.createOnCodeChangeHandlers(),this.lockDefaultCode(),_.defer(this.onAllLoaded)},y.prototype.createACE=function(){var e,i,t=null!=(e=L.get("aceConfig"))?e:{};if(this.destroyAceEditor(this.ace),this.ace=B.edit(this.$el.find(".ace")[0]),this.aceSession=this.ace.getSession(),this.reallySetAnnotations=this.aceSession.setAnnotations.bind(this.aceSession),this.aceSession.setAnnotations=(i=this,function(e){var t=i.aceSession.getAnnotations(),e=_.filter(t,function(e){return null!=e.createdBy}).concat(_.reject(e,function(e){return"Start tag seen without seeing a doctype first. Expected e.g. <!DOCTYPE html>."===e.text}));return i.reallySetAnnotations(e)}),this.aceDoc=this.aceSession.getDocument(),this.aceSession.setUseWorker((e=this.spell.language,0<=g.call(this.languagesThatUseWorkers,e))),this.aceSession.setMode(h.aceEditModes[this.spell.language]),this.aceSession.setWrapLimitRange(null),this.aceSession.setUseWrapMode(!0),this.aceSession.setNewLineMode("unix"),this.aceSession.setUseSoftTabs(!0),this.ace.setTheme("ace/theme/textmate"),this.ace.setDisplayIndentGuides(!1),this.ace.setShowPrintMargin(!1),this.ace.setShowInvisibles(!1),this.ace.setBehavioursEnabled(t.behaviors),this.ace.setAnimatedScroll(!0),this.ace.setShowFoldWidgets(!1),this.ace.setKeyboardHandler(this.keyBindings[null!=(e=t.keyBindings)?e:"default"]),this.ace.$blockScrolling=1/0,this.ace.on("mousemove",this.onAceMouseMove),this.ace.on("mouseout",this.onAceMouseOut),this.toggleControls(null,this.writable),this.aceSession.selection.on("changeCursor",this.onCursorActivity),$(this.ace.container).find(".ace_gutter").on("click mouseenter",".ace_error, .ace_warning, .ace_info",this.onAnnotationClick),$(this.ace.container).find(".ace_gutter").on("click",this.onGutterClick),this.initAutocomplete(null==(t=t.liveCompletion)||t),this.session.get("creator")===L.id&&!this.session.fake)return this.spade=new Spade,this.spade.track(this.ace),this.saveSpadeTimeout=setTimeout(this.saveSpade,6e5)},y.prototype.createACEShortcuts=function(){var t,e,i,n,o,s,r,a,l,c;if(this.aceCommands=t=[],(e=function(e){return i.ace.commands.addCommand(e),t.push(e.name)})({name:"run-code",bindKey:{win:"Shift-Enter|Ctrl-Enter",mac:"Shift-Enter|Command-Enter|Ctrl-Enter"},exec:(n=i=this,function(){return Backbone.Mediator.publish("tome:manual-cast",{realTime:n.options.level.isType("game-dev")})})}),this.observing||e({name:"run-code-real-time",bindKey:{win:"Ctrl-Shift-Enter",mac:"Command-Shift-Enter|Ctrl-Shift-Enter"},exec:(o=this,function(){var e,t=o.$(".done-button:visible");return t.length?t.trigger("click"):o.options.level.get("replayable")&&0<(e=o.session.timeUntilResubmit())?Backbone.Mediator.publish("tome:manual-cast-denied",{timeUntilResubmit:e}):Backbone.Mediator.publish("tome:manual-cast",{realTime:!0})})}),e({name:"no-op",bindKey:{win:"Ctrl-S",mac:"Command-S|Ctrl-S"},exec:function(){}}),e({name:"previous-line",bindKey:{mac:"Ctrl-P"},passEvent:!0,exec:(s=this,function(){return s.ace.execCommand("golineup")})}),e({name:"toggle-playing",bindKey:{win:"Ctrl-P",mac:"Command-P"},readOnly:!0,exec:function(){return Backbone.Mediator.publish("level:toggle-playing",{})}}),e({name:"end-current-script",bindKey:{win:"Shift-Space",mac:"Shift-Space"},readOnly:!0,exec:(r=this,function(){return r.scriptRunning?Backbone.Mediator.publish("level:shift-space-pressed",{}):r.ace.insert(" ")})}),e({name:"end-all-scripts",bindKey:{win:"Escape",mac:"Escape"},readOnly:!0,exec:function(){return Backbone.Mediator.publish("level:escape-pressed",{})}}),e({name:"toggle-grid",bindKey:{win:"Ctrl-G",mac:"Command-G|Ctrl-G"},readOnly:!0,exec:function(){return Backbone.Mediator.publish("level:toggle-grid",{})}}),e({name:"toggle-debug",bindKey:{win:"Ctrl-\\",mac:"Command-\\|Ctrl-\\"},readOnly:!0,exec:function(){return Backbone.Mediator.publish("level:toggle-debug",{})}}),e({name:"toggle-pathfinding",bindKey:{win:"Ctrl-O",mac:"Command-O|Ctrl-O"},readOnly:!0,exec:function(){return Backbone.Mediator.publish("level:toggle-pathfinding",{})}}),e({name:"level-scrub-forward",bindKey:{win:"Ctrl-]",mac:"Command-]|Ctrl-]"},readOnly:!0,exec:function(){return Backbone.Mediator.publish("level:scrub-forward",{})}}),e({name:"level-scrub-back",bindKey:{win:"Ctrl-[",mac:"Command-[|Ctrl-]"},readOnly:!0,exec:function(){return Backbone.Mediator.publish("level:scrub-back",{})}}),e({name:"spell-step-forward",bindKey:{win:"Ctrl-Alt-]",mac:"Command-Alt-]|Ctrl-Alt-]"},readOnly:!0,exec:function(){return Backbone.Mediator.publish("tome:spell-step-forward",{})}}),e({name:"spell-step-backward",bindKey:{win:"Ctrl-Alt-[",mac:"Command-Alt-[|Ctrl-Alt-]"},readOnly:!0,exec:function(){return Backbone.Mediator.publish("tome:spell-step-backward",{})}}),e({name:"spell-beautify",bindKey:{win:"Ctrl-Shift-B",mac:"Command-Shift-B|Ctrl-Shift-B"},exec:function(){return Backbone.Mediator.publish("tome:spell-beautify",{})}}),e({name:"prevent-line-jump",bindKey:{win:"Ctrl-L",mac:"Command-L"},passEvent:!0,exec:function(){}}),e({name:"open-fullscreen-editor",bindKey:{win:"Ctrl-Shift-M",mac:"Command-Shift-M|Ctrl-Shift-M"},exec:function(){return Backbone.Mediator.publish("tome:toggle-maximize",{})}}),e({name:"enter-skip-delimiters",bindKey:"Enter|Return",exec:(a=this,function(){var e,t;return a.aceSession.selection.isEmpty()&&(t=a.ace.getCursorPosition(),(e=a.aceDoc.getLine(t.row).substring(t.column).match(/^(["|']?\)+;?)/))&&((t=a.ace.getSelectionRange()).setStart(t.start.row,t.start.column+e[1].length),t.setEnd(t.end.row,t.end.column+e[1].length),a.aceSession.selection.setSelectionRange(t))),a.ace.execCommand("insertstring","\n")})}),e({name:"disable-spaces",bindKey:"Space",exec:(l=this,function(){var e=l.options.level.get("disableSpaces")||!1,t=null!=(t=L.get("aceConfig"))?t:{};return t.keyBindings&&"default"!==t.keyBindings&&(e=!1),!(e="lua"===(t=l.spell.language)||"java"===t||"cpp"===t||"coffeescript"===t||"html"===t?!1:e)||_.isNumber(e)&&e<L.level()?l.ace.execCommand("insertstring"," "):(e=l.aceDoc.getLine(l.ace.getCursorPosition().row),l.singleLineCommentRegex().test(e)?l.ace.execCommand("insertstring"," "):void 0)})}),this.options.level.get("backspaceThrottle"))return e({name:"throttle-backspaces",bindKey:"Backspace",exec:(c=this,function(){var e,t,i=Date.now();return c.aceSession.selection.isEmpty()&&(e=c.ace.getCursorPosition(),t=c.aceDoc.getLine(e.row),/^\s*$/.test(t.substring(0,e.column)))?(null==c.backspaceThrottleMs&&(c.backspaceThrottleMs=500),void((null==c.lastBackspace||i-c.lastBackspace>c.backspaceThrottleMs)&&(c.backspaceThrottleMs=100,c.lastBackspace=i,c.ace.remove("left")))):(c.backspaceThrottleMs=null,c.lastBackspace=i,c.ace.remove("left"))})})},y.prototype.hookACECustomBehavior=function(){var R,P,e,i,E;e=L.get("aceConfig");return this.ace.commands.on("exec",(i=this,function(e){var t;if("enter-skip-delimiters"===e.command.name&&((t=i.ace.selection.getRange()).start.column!==t.end.column||t.start.row!==t.end.row))return e.editor.execCommand("gotolineend"),!0})),P=this.spell.language,R=function(e){return"python"===P&&(null!=(e=/^\s*([^#]+)/.exec(e))&&/:\s*$/.test(e[1]))},this.indentDivMarkers=[],this.aceSession.addDynamicMarker({update:(E=this,function(e,t,i,n){var o,s,r,a,l,c,h,u,p,d,m,f,g,y,v,b,_,w,k,x,S,C,T,L,M,D,I,A;if(Y=B.require("ace/range").Range,null!=(l=E.aceSession.foldWidgets)){for(m=E.aceDoc.getAllLines(),L=function(e){return m[e].match(/^\s*/).pop().length},s=[{border:"74,144,226",fill:"108,162,226"},{border:"132,180,235",fill:"230,237,245"}],E.indentDivMarkers.forEach(function(e){return e.remove()}),E.indentDivMarkers=[],C=u=0,v=E.aceSession.getLength();0<=v?u<=v:v<=u;C=0<=v?++u:--u)if(null==l[C]&&(l[C]=E.aceSession.getFoldWidget(C)),null!=l&&"start"===l[C]){try{a=E.aceSession.getFoldWidgetRange(C)}catch(e){console.warn("Couldn't find fold widget docRange for row "+C+":",e)}if(null==a&&(c=L(C),a=new Y(C,c,C,c+4)),R(m[C])){if(/^\s+$/.test(m[a.end.row+1])&&(a.end.row+=1),A=L(C),"python"===P)for(x=new RegExp("^"+new Array(Math.floor(A/4+1)).join("(    |\t)")+"(    |\t)+(\\S|\\s*$)"),r=p=b=a.start.row+1,_=a.end.row;b<=_?p<=_:_<=p;r=b<=_?++p:--p)if(!x.test(m[r])){a.end.row=r-1;break}T=E.aceSession.documentToScreenPosition(a.start.row,a.start.column),I=E.aceSession.documentToScreenPosition(a.end.row,a.end.column),y=new Y(T.row,T.column,I.row,I.column),o=s[Math.floor(A/4)%s.length],D=t.$getTop(y.start.row,n),M=t.$getTop(y.start.row+1,n),c=n.lineHeight*(y.end.row-y.start.row),T=t.$padding+A*n.characterWidth,I=4*n.characterWidth,y=n.characterWidth*(E.aceSession.getScreenLastRowColumn(y.start.row)-A),(A=document.createElement("div")).setAttribute("style","position: absolute; top: "+D+"px; left: "+T+"px; width: "+(3+y)+"px; height: "+n.lineHeight+"px;\nborder: 3px solid rgba("+o.border+",1); border-left: none;"),(y=document.createElement("div")).setAttribute("style","position: absolute; top: "+M+"px; left: "+T+"px; width: "+I+"px; height: "+c+"px; background-color: rgba("+o.fill+",0.5);\nborder-right: 3px solid rgba("+o.border+",1); border-bottom: 3px solid rgba("+o.border+",1);"),(h=document.createElement("div")).appendChild(A),h.appendChild(y),E.indentDivMarkers.push(h)}}for(t.elt("indent-highlight"),g=null!=(w=t.element.childNodes[t.i-1])?w:t.element.lastChild,S=[],f=0,d=(k=E.indentDivMarkers).length;f<d;f++)h=k[f],S.push(g.appendChild(h));return S}})})},y.prototype.fillACE=function(){return this.ace.setValue(this.spell.source),this.aceSession.setUndoManager(new l),this.ace.clearSelection()},y.prototype.lockDefaultCode=function(e){var r,a,l,t,i,n,o,s,c,h,u,p,d,m,f,g,y,v,b,w,k,x,S,C,T;if(null==e&&(e=!1),(p=this.options.level.get("lockDefaultCode")||!1)&&!(_.isNumber(p)&&p<L.level())&&(this.spell.source===this.spell.originalSource||e)&&!(this.isIE()||(b=null!=(y=L.get("aceConfig"))?y:{}).keyBindings&&"default"!==b.keyBindings)){if(console.info("Locking down default code."),r=function(){for(var e,t=x.readOnlyRanges,i=0,n=t.length;i<n;i++)if(e=t[i],x.ace.getSelectionRange().intersects(e))return!0;return!1},a=function(){var e,t,i,n,o=S.ace.getSelectionRange().clone();for(0<o.start.column?o.setStart(o.start.row,o.start.column-1):0<o.start.row&&o.setStart(o.start.row-1,0),e=0,t=(n=S.readOnlyRanges).length;e<t;e++)if(i=n[e],o.intersects(i))return!0;return!1},l=function(){var e,t,i,n,o=C.ace.getSelectionRange().clone();for(o.end.column<C.aceDoc.getLine(o.end.row).length?o.setEnd(o.end.row,o.end.column+1):o.start.row<C.aceDoc.getLength()-1&&o.setEnd(o.end.row+1,0),e=0,t=(n=C.readOnlyRanges).length;e<t;e++)if(i=n[e],o.intersects(i))return!0;return!1},f=function(){return $(".locked-code").finish().addClass("pulsating").effect("shake",{times:1,distance:2,direction:"down"}).removeClass("pulsating")},e=function(e){return r()?(f(),!0):"function"==typeof e?e():void 0},y=function(t,e,i){var n=t[e];return t[e]=function(){var e=Array.prototype.slice.call(arguments);return i(function(){return n.apply(t,e)})},t[e]},null!=(C=S=x=this).lockedCodeMarkerIDs)for(t=0,o=(v=this.lockedCodeMarkerIDs).length;t<o;t++)d=v[t],this.aceSession.removeMarker(d);if(this.lockedCodeMarkerIDs=[],this.readOnlyRanges=[],"python"===(b=this.spell.language)||"coffeescript"===b){for(k=i=0,s=(u=this.aceDoc.getAllLines()).length;i<s;k=++i)h=u[k],/^\s*$/.test(h)||(n=k);null!=n&&this.readOnlyRanges.push(new Y(0,0,n,u[n].length-1))}for(m=0,c=(w=this.readOnlyRanges).length;m<c;m++)g=w[m],this.lockedCodeMarkerIDs.push(this.aceSession.addMarker(g,"locked-code","fullLine"));return y(this.ace,"onPaste",e),y(this.ace,"onCut",e),this.ace.commands.on("exec",(T=this,function(e){var t,i,n,o,s;if(e.stopPropagation(),e.preventDefault(),"insertstring"===e.command.name&&r()||("Backspace"===(n=e.command.name)||"throttle-backspaces"===n)&&a()||"del"===e.command.name&&l())return null!=(o=T.autocomplete)&&"function"==typeof o.off&&o.off(),f(),!1;if("enter-skip-delimiters"===(o=e.command.name)||"Enter"===o||"Return"===o){if(r())return e.editor.navigateDown(1),e.editor.navigateLineStart(),!1;if(!("Enter"!==(o=e.command.name)&&"Return"!==o||null!=(o=e.editor)&&null!=(s=o.completer)&&null!=(t=s.popup)&&t.isOpen))return null!=(i=T.autocomplete)&&"function"==typeof i.on&&i.on(),e.editor.execCommand("enter-skip-delimiters")}return null!=(i=T.autocomplete)&&"function"==typeof i.on&&i.on(),e.command.exec(e.editor,e.args||{})}))}},y.prototype.initAutocomplete=function(e){if(this.autocompleteOn=e,"html"!==this.spell.language)return e=null!=(e=this.options.level.get("autocompleteFontSizePx"))?e:16,this.autocomplete=new t(this.ace,{basic:!1,liveCompletion:!1,snippetsLangDefaults:!1,completers:{keywords:!1,snippets:this.autocompleteOn},autoLineEndings:{javascript:";",java:";",c_cpp:";"},popupFontSizePx:e,popupLineHeightPx:1.5*e,popupWidthPx:380})},y.prototype.updateAutocomplete=function(e){return this.autocompleteOn=e,null!=(e=this.autocomplete)?e.set("snippets",this.autocompleteOn):void 0},y.prototype.addAutocompleteSnippets=function(e){if(this.autocomplete&&this.autocompleteOn)return this.autocomplete.addCodeCombatSnippets(this.options.level,this,e)},y.prototype.translateFindNearest=function(){var e,t=this.getSource(),i=t.replace(/(self:|self.|this.|@)findNearestEnemy\(\)/g,"$1findNearest($1findEnemies())");if(t!==(i=i.replace(/(self:|self.|this.|@)findNearestItem\(\)/g,"$1findNearest($1findItems())")))return this.spell.originalSource=i,this.updateACEText(i),_.delay((e=this,function(){return"function"==typeof e.recompile?e.recompile():void 0}),1e3)},y.prototype.createFirepad=function(){var e,t;if(!this.firepadLoading)return this.eventsSuppressed=!0,this.loaded=!1,this.previousSource=this.ace.getValue(),this.ace.setValue(""),this.aceSession.setUndoManager(new l),e="https://codecombat.firebaseio.com/"+this.spell.pathComponents.join("/"),this.fireRef=new Firebase(e),e={userId:L.id},this.firepad=Firepad.fromACE(this.fireRef,this.ace,e),this.firepadLoading=!0,this.firepad.on("ready",(t=this,function(){var e;if(!t.destroyed)return t.firepadLoading=!1,(e=t.ace.getValue())?t.spell.source=e:(t.ace.setValue(t.previousSource),t.aceSession.setUndoManager(new l),t.ace.clearSelection()),t.onAllLoaded()}))},y.prototype.onAllLoaded=function(){return this.fetchToken(this.spell.source,this.spell.language).then((t=this,function(e){if(t.spell.transpile(e),t.spell.loaded=!0,Backbone.Mediator.publish("tome:spell-loaded",{spell:t.spell}),t.eventsSuppressed=!1,t.createToolbarView(),t.options.level.isType("web-dev"))return t.updateHTML({create:!0})}));var t},y.prototype.createDebugView=function(){if(!this.options.level.isType("hero","hero-ladder","hero-coop","course","course-ladder","game-dev","web-dev","ladder"))return this.debugView=new s({ace:this.ace,thang:this.thang,spell:this.spell}),this.$el.append(this.debugView.render().$el.hide())},y.prototype.createTranslationView=function(){return this.translationView=new a({ace:this.ace,supermodel:this.supermodel}),this.$el.append(this.translationView.render().$el.hide())},y.prototype.createToolbarView=function(){return this.toolbarView=new r({ace:this.ace}),this.$el.append(this.toolbarView.render().$el)},y.prototype.onMouseOut=function(e){var t;return null!=(t=this.debugView)?t.onMouseOut(e):void 0},y.prototype.onContactButtonPressed=function(e){return this.saveSpade()},y.prototype.getSource=function(){return this.ace.getValue()},y.prototype.setThang=function(e){var t;if(this.focus(),this.lastScreenLineCount=null,this.updateLines(),e.id!==(null!=(t=this.thang)?t.id:void 0))return this.thang=e,this.spellThang=this.spell.thang,this.debugView||this.createDebugView(),null!=(e=this.debugView)&&(e.thang=this.thang),this.translationView||this.createTranslationView(),null!=(e=this.toolbarView)&&e.toggleFlow(!1),this.updateAether(!1,!1),this.highlightCurrentLine()},y.prototype.cast=function(e,t,i,n){return null==e&&(e=!1),null==t&&(t=!1),null==i&&(i=!1),null==n&&(n=!1),Backbone.Mediator.publish("tome:cast-spell",{spell:this.spell,thang:this.thang,preload:e,realTime:t,justBegin:i,cinematic:n})},y.prototype.notifySpellChanged=function(){if(!this.destroyed)return Backbone.Mediator.publish("tome:spell-changed",{spell:this.spell})},y.prototype.notifyEditingEnded=function(){if(!this.destroyed&&!this.aceDoc.undergoingFirepadOperation)return Backbone.Mediator.publish("tome:editing-ended",{})},y.prototype.notifyEditingBegan=function(){if(!this.destroyed&&!this.aceDoc.undergoingFirepadOperation)return Backbone.Mediator.publish("tome:editing-began",{})},y.prototype.updateLines=function(){var e,t,i,n,o,s;if(!this.destroyed)return o=this.aceDoc.getLength(),t=this.aceDoc.$lines[o-1],/\S/.test(t)&&(s=(n=this.ace.getCursorPosition()).row===o-1&&n.column===t.length,this.aceDoc.insertNewLine({row:o,column:0}),s&&this.ace.navigateLeft(1),null!=(n=this.ace)&&null!=(i=n.completer)&&i.showPopup(this.ace)),(t=this.aceSession.getScreenLength())!==this.lastScreenLineCount&&(this.lastScreenLineCount=t,s=this.ace.renderer.lineHeight||20,o=$("#tome-view").innerHeight(),n=$("#spell-top-bar-view").outerHeight(),i=$(".spell-toolbar-view").outerHeight(),null==this.spellPaletteHeight&&(this.spellPaletteHeight=75),i=o-n-i-Math.min(this.spellPaletteHeight,o/3),o=Math.max(8,Math.min($("#canvas-wrapper").outerHeight(),$("#level-view").innerHeight()-175)/s-2),i=Math.floor(i/s),i=Math.max(o,Math.min(t+2,i),8),_.isNaN(i)&&(i=8),this.ace.setOptions({minLines:i,maxLines:i}),0),null!=this.firstEntryToScrollLine&&null!=(e=this.ace)&&(null!=(e=e.renderer)&&(null!=(e=e.$cursorLayer)&&e.config))?(this.ace.scrollToLine(this.firstEntryToScrollLine,!0,!0),this.firstEntryToScrollLine=void 0):void 0},y.prototype.hideProblemAlert=function(){if(!this.destroyed)return Backbone.Mediator.publish("tome:hide-problem-alert",{})},y.prototype.saveSpade=function(){var e;if(!this.destroyed&&this.spade&&(e=this.spade.compile(),(e=this.spade.condense(e)).length))return e=n.compressToUTF16(JSON.stringify(e)),new i({sessionID:this.options.session.id,level:{original:this.options.level.get("original"),majorVersion:this.options.level.get("version").major},levelSlug:this.options.level.get("slug"),userID:this.options.session.get("creator"),log:e}).save()},y.prototype.onShowVictory=function(e){if(null!=this.saveSpadeTimeout)return window.clearTimeout(this.saveSpadeTimeout),this.saveSpadeTimeout=null},y.prototype.onManualCast=function(e){var t=this.$el.parent().length;if(this.recompile(t,e.realTime,!1),t&&this.focus(),this.options.level.isType("web-dev"))return this.sourceAtLastCast=this.getSource(),this.ace.setStyle("spell-cast"),this.updateHTML({create:!0})},y.prototype.reloadCode=function(e){return(e=null==e?!0:e)&&this.spell.reloadCode(),this.thang=this.spell.thang.thang,this.updateACEText(this.spell.originalSource),this.lockDefaultCode(!0),this.recompile(e),Backbone.Mediator.publish("tome:spell-loaded",{spell:this.spell}),this.hasSetInitialCursor=!1,this.highlightCurrentLine(),this.updateLines()},y.prototype.recompile=function(i,n,o){return null==i&&(i=!0),null==n&&(n=!1),null==o&&(o=!1),this.fetchTokenForSource().then((s=this,function(e){var t=u.getTokenSource(e),t=s.spell.source!==t;if(t&&(s.spell.transpile(e),s.updateAether(!0,!1)),i&&s.cast(!1,n,!1,o),t)return s.notifySpellChanged()}));var s},y.prototype.updateACEText=function(e){this.eventsSuppressed=!0,this.firepad?this.firepad.setText(e):(this.ace.setValue(e),this.aceSession.setUndoManager(new l)),this.eventsSuppressed=!1;try{return this.ace.resize(!0)}catch(e){return console.warn("Error resizing ACE after an update:",e)}},y.prototype.createOnCodeChangeHandlers=function(){var a,l,c;return this.onCodeChangeMetaHandler&&this.aceDoc.removeListener("change",this.onCodeChangeMetaHandler),l=[],a=[_.debounce(this.updateAether,this.options.level.isType("game-dev")?10:500),_.debounce(this.notifyEditingEnded,1e3),_.throttle(this.notifyEditingBegan,250),_.throttle(this.notifySpellChanged,300),_.throttle(this.updateLines,500),_.throttle(this.hideProblemAlert,500)],this.options.level.get("requiredCode")&&l.push(_.debounce(this.checkRequiredCode,750)),this.options.level.get("suspectCode")&&l.push(_.debounce(this.checkSuspectCode,750)),this.options.level.isType("web-dev")&&a.push(_.throttle(this.updateHTML,10)),this.onCodeChangeMetaHandler=(c=this,function(){if(!c.eventsSuppressed)return c.spellThang?c.spell.hasChangedSignificantly(c.getSource(),c.spellThang.aether.raw,function(e){var t,i,n,o,s,r;if(!c.spellThang||e)for(i=0,o=l.length;i<o;i++)(t=l[i])();for(r=[],n=0,s=a.length;n<s;n++)t=a[n],r.push(t());return r}):void 0}),this.aceDoc.on("change",this.onCodeChangeMetaHandler)},y.prototype.onCursorActivity=function(){},y.prototype.updateHTML=function(e){return null==e&&(e={}),this.spell.hasChanged(this.spell.getSource(),this.sourceAtLastCast)&&this.ace.unsetStyle("spell-cast"),this.clearWebDevErrors(),Backbone.Mediator.publish("tome:html-updated",{html:this.spell.constructHTML(this.getSource()),create:Boolean(e.create)})},y.prototype.fetchToken=function(e,t){var i,n;return"java"!==t&&"cpp"!==t?Promise.resolve(e):(i={Accept:"application/json","Content-Type":"application/json"},document.cookie.match(/JWT=([a-zA-Z0-9.]+)/),n=("undefined"!=typeof window&&null!==window&&null!=(n=window.localStorage)?n.kodeKeeperService:void 0)||"https://asm14w94nk.execute-api.us-east-1.amazonaws.com/service/parse-code-kodekeeper",fetch(n,{method:"POST",mode:"cors",headers:i,body:JSON.stringify({code:e,language:t})}).then(function(e){return e.json()}).then(function(e){return e.token}))},y.prototype.fetchTokenForSource=function(){var e=this.ace.getValue();return this.fetchToken(e,this.spell.language)},y.prototype.updateAether=function(a,l){var c,e,h;if(null==a&&(a=!1),null==l&&(l=!0),c=null!=(e=this.spellThang)?e.aether:void 0)return this.fetchTokenForSource().then((h=this,function(s){var r=u.getTokenSource(s);return h.spell.hasChangedSignificantly(s,c.raw,function(e){var t,i,n=a||e,o=n||h.spellThang!==h.lastUpdatedAetherSpellThang;if((o||c!==h.displayedAether)&&(e=h.spellThang.castAether,(t=e&&r===e.raw)&&(c=e),o||c!==h.displayedAether))return i=function(e){if(h.clearAetherDisplay(),h.displayAether(e,t),h.lastUpdatedAetherSpellThang=h.spellThang,l)return h.guessWhetherFinished(e)},h.clearAetherDisplay(),n&&!t?h.worker?(n={function:"transpile",spellKey:h.spell.spellKey,source:s},h.worker.addEventListener("message",function(e){var t=JSON.parse(e.data);if("transpile"===t.function&&t.spellKey===h.spell.spellKey)return h.worker.removeEventListener("message",arguments.callee,!1),c.problems=t.problems,c.raw=r,i(c)}),h.worker.postMessage(JSON.stringify(n))):(c.transpile(s),i(c)):i(c)})}))},y.prototype.clearAetherDisplay=function(){return this.clearProblemsCreatedBy("aether"),this.highlightCurrentLine({})},y.prototype.clearWebDevErrors=function(){return this.clearProblemsCreatedBy("web-dev-iframe")},y.prototype.clearProblemsCreatedBy=function(t){var e=_.reject(this.aceSession.getAnnotations(),function(e){return e.createdBy===t});return this.reallySetAnnotations(e),(e=_.filter(this.problems,function(e){return e.createdBy===t})).forEach(function(e){return e.destroy()}),this.problems=_.difference(this.problems,e),Backbone.Mediator.publish("tome:problems-updated",{spell:this.spell,problems:this.problems,isCast:!1})},y.prototype.convertAetherProblems=function(t,e,i){return _.unique(e,function(e){return null!=(e=e.userInfo)?e.key:void 0}).map((n=this,function(e){return new o({aether:t,aetherProblem:e,ace:n.ace,isCast:i,levelID:n.options.levelID})}));var n},y.prototype.displayAether=function(e,t){var i,n,o,s,r,a,l;for(null==t&&(t=!1),this.displayedAether=e,t=t||!_.isEmpty(e.metrics)||_.some(e.getAllProblems(),{type:"runtime"}),i=this.aceSession.getAnnotations(),n=0,s=(a=this.convertAetherProblems(e,e.getAllProblems(),t)).length;n<s;n++)(l=a[n]).annotation&&i.push(l.annotation);if(t)for(a[0]&&this.displayProblemBanner(a[0]),o=0,r=a.length;o<r;o++)l=a[o],this.saveUserCodeProblem(e,l.aetherProblem);return this.problems=this.problems.concat(a),this.aceSession.setAnnotations(i),_.isEmpty(e.flow)||this.highlightCurrentLine(e.flow),Backbone.Mediator.publish("tome:problems-updated",{spell:this.spell,problems:this.problems,isCast:t}),this.ace.resize()},y.prototype.displayProblemBanner=function(e){var t,i,n,o,s=0;if(null!=e.row){for(t=i=0,n=e.row;0<=n?i<n:n<i;t=0<=n?++i:--i)s+=this.aceSession.getRowLength(t)*this.ace.renderer.lineHeight;s-=this.ace.session.getScrollTop()}return"info"!==(o=e.level)&&"warning"!==o&&Backbone.Mediator.publish("playback:stop-cinematic-playback",{}),Backbone.Mediator.publish("tome:show-problem-alert",{problem:e,lineOffsetPx:Math.max(s,0)})},y.prototype.linesBeforeScript=function(e){return _.size(e.split("<script>")[0].match(/\n/g))},y.prototype.addAnnotation=function(e){var t=this.aceSession.getAnnotations();return t.push(e),this.reallySetAnnotations(t)},y.prototype.onWebDevError=function(e){var t=_.merge({},e,{line:e.line+this.linesBeforeScript(this.getSource())}),e=this.spell.hasChanged(this.spell.getSource(),this.sourceAtLastCast),i=new o({error:t,ace:this.ace,levelID:this.options.levelID,userCodeHasChangedSinceLastCast:e});return _.any(this.problems,function(e){return i.isEqual(e)})?i.destroy():(this.problems.push(i),this.displayProblemBanner(i),i.annotation&&this.addAnnotation(i.annotation),Backbone.Mediator.publish("tome:problems-updated",{spell:this.spell,problems:this.problems,isCast:!1}))},y.prototype.onProblemsUpdated=function(e){e.spell;var t=e.problems,e=e.isCast;return this.ace[t.length?"setStyle":"unsetStyle"]("user-code-problem"),this.ace[e?"setStyle":"unsetStyle"]("spell-cast")},y.prototype.saveUserCodeProblem=function(e,t){var i,n,o=e.raw+t.message;if(!(o in this.savedProblems)&&(this.savedProblems[o]=!0,n=.01*Math.max(1,2*(L.level()-2)),Math.random()<n))return this.userCodeProblem=new c,this.userCodeProblem.set("code",e.raw),t.range&&(i=e.raw.split("\n").slice(t.range[0].row,t.range[1].row+1),this.userCodeProblem.set("codeSnippet",i.join("\n"))),t.hint&&this.userCodeProblem.set("errHint",t.hint),t.id&&this.userCodeProblem.set("errId",t.id),t.level&&this.userCodeProblem.set("errLevel",t.level),t.message&&(this.userCodeProblem.set("errMessage",t.message),(i=(n=t.message).match(/^Line [0-9]+\: /))&&(n=n.slice(i[0].length)),this.userCodeProblem.set("errMessageNoLineInfo",n)),t.range&&this.userCodeProblem.set("errRange",t.range),t.type&&this.userCodeProblem.set("errType",t.type),null!=(t=e.language)&&t.id&&this.userCodeProblem.set("language",e.language.id),this.options.levelID&&this.userCodeProblem.set("levelID",this.options.levelID),this.userCodeProblem.save(),null},y.prototype.guessWhetherFinished=function(e){var t,i,n=!e.getAllProblems().length;if(n)return t=this.ace.getCursorPosition(),e=_.string.rtrim(this.aceDoc.$lines[t.row].replace(this.singleLineCommentRegex(),"")),n=t.column>=e.length,t=!e.substr(0,t.column).trim().length,!(e=/^(s|se|sel|self|t|th|thi|this|g|ga|gam|game|h|he|her|hero)$/.test(e.trim()))&&this.options.level.isType("game-dev")?this.fetchTokenForSource().then((i=this,function(e){return i.spell.transpile(e),i.cast(!1,!1,!0)})):!n&&!t||e?void 0:this.preload()},y.prototype.singleLineCommentRegex=function(){var e;return this._singleLineCommentRegex?this._singleLineCommentRegex.lastIndex=0:(e="html"===this.spell.language?S.html+"|"+S.css+"|"+S.javascript:S[this.spell.language]||"//",this._singleLineCommentRegex=new RegExp("[ \t]*("+e+")[^\"'\n]*")),this._singleLineCommentRegex},y.prototype.singleLineCommentOnlyRegex=function(){return this._singleLineCommentOnlyRegex?this._singleLineCommentOnlyRegex.lastIndex=0:this._singleLineCommentOnlyRegex=new RegExp("^"+this.singleLineCommentRegex().source),this._singleLineCommentOnlyRegex},y.prototype.commentOutMyCode=function(){var e;return("javascript"===(e=this.spell.language)||"java"===e||"cpp"===e?"return;  ":"return  ")+S[this.spell.language]},y.prototype.preload=function(){var e,t,i,n,o,s,r;if(-1===this.spell.source.indexOf("while")&&!(500<this.spell.source.length||2e3<(null!=(i=this.spellThang)&&null!=(n=i.castAether)&&null!=(o=n.metrics)?o.statementsExecuted:void 0)||this.options.level.isType("web-dev"))){for(e in n=this.spell.source,t=null!=(o=this.spell.thang)?o.aether.serialize():void 0,this.spell.transpile(this.getSource()),this.cast(!0),this.spell.source=n,s=[],t)r=t[e],s.push(this.spell.thang.aether[e]=r);return s}},y.prototype.onSpellChanged=function(e){return this.spellHasChanged=!0},y.prototype.onAceMouseOut=function(e){return Backbone.Mediator.publish("web-dev:stop-hovering-line")},y.prototype.onAceMouseMove=function(e){var t;if(!this.destroyed&&(t=e.getDocumentPosition().row)!==this.lastRowHovered)return this.lastRowHovered=t,e=this.aceSession.getLine(t),Backbone.Mediator.publish("web-dev:hover-line",{row:t,line:e}),null},y.prototype.onSessionWillSave=function(e){var t;if(this.spellHasChanged&&L.isAdmin())return setTimeout((t=this,function(){if(!t.destroyed&&!t.spellHasChanged)return t.$el.find(".save-status").finish().show().fadeOut(2e3)}),1e3),this.spellHasChanged=!1},y.prototype.onUserCodeProblem=function(i){var e,n;if(i.god===this.options.god){if("runtime_InfiniteLoop"===i.problem.id)return this.onInfiniteLoop(i);if(i.problem.userInfo.methodName===this.spell.name)if((null!=(e=this.spell.thang)?e.thang.id:void 0)===i.problem.userInfo.thangID)return this.spell.hasChangedSignificantly(this.getSource(),null,(n=this,function(e){var t;if(!e)return"runtime"===i.problem.type?null!=(e=n.spellThang)&&null!=(t=e.castAether)&&t.addProblem(i.problem):n.spell.thang.aether.addProblem(i.problem),n.lastUpdatedAetherSpellThang=null,n.updateAether(!1,!1)}))}},y.prototype.onNonUserCodeProblem=function(e){var t;if(e.god===this.options.god&&this.spellThang)return t=this.spellThang.aether.createUserCodeProblem({type:"runtime",kind:"Unhandled",message:"Unhandled error: "+e.problem.message}),this.spellThang.aether.addProblem(t),null!=(e=this.spellThang.castAether)&&e.addProblem(t),this.lastUpdatedAetherSpellThang=null,this.updateAether(!1,!1)},y.prototype.onInfiniteLoop=function(e){var t;if(this.spellThang)return this.spellThang.aether.addProblem(e.problem),null!=(t=this.spellThang.castAether)&&t.addProblem(e.problem),this.lastUpdatedAetherSpellThang=null,this.updateAether(!1,!1)},y.prototype.onNewWorld=function(n){return this.fetchTokenForSource().then((o=this,function(e){var t,i;return(i=n.world.getThangByID(null!=(t=o.spell.thang)?t.thang.id:void 0))?(t=null!=(t=n.world.userCodeMap[i.id])?t[o.spell.name]:void 0,o.spell.thang.castAether=t,o.spell.thang.aether=o.spell.createAether(i)):o.spell.thang=null,o.spell.transpile(e),o.updateAether(!1,!1)}));var o},y.prototype.focus=function(){if(this.controlsEnabled&&this.writable&&0===$(".modal:visible").length&&!this.ace.isFocused())return this.ace.focus(),this.ace.clearSelection()},y.prototype.onFrameChanged=function(e){var t;if(this.spellThang&&(null!=(t=e.selectedThang)?t.id:void 0)===(null!=(t=this.spellThang)?t.thang.id:void 0))return this.thang=e.selectedThang,this.highlightCurrentLine()},y.prototype.onCoordinateSelected=function(e){if(this.ace.isFocused()&&null!=e.x&&null!=e.y)return"python"===this.spell.language?this.ace.insert('{"x": '+e.x+', "y": '+e.y+"}"):"lua"===this.spell.language?this.ace.insert("{x="+e.x+", y="+e.y+"}"):this.ace.insert("{x: "+e.x+", y: "+e.y+"}"),this.highlightCurrentLine()},y.prototype.onStatementIndexUpdated=function(e){if(e.ace===this.ace)return this.highlightCurrentLine()},y.prototype.highlightCurrentLine=function(e){var t,i,n,o,s,r,a,l,c,h,u,p,d,m,f,g,y,v,b,w,k,x,S,C,T,L,M,D,I,A,R,P,E,B,F,N,U,V,O,G,z,H,W,q,j;if(this.destroyed||this.highlightEntryPoints(),(e=null==e?null!=(D=this.spellThang)&&null!=(I=D.castAether)?I.flow:void 0:e)&&this.thang){for(c=[],C=!(h={}),n=m=0,y=(j=(a=null)!=(e=e.states)?e:[]).length;m<y;n=++m){if(o=j[n],null==a&&(null!=(B=o.userInfo)?B.time:void 0)>this.thang.world.age&&(a=n-1),C){c.pop();break}for(c.push([]),q=f=0,v=(F=o.statements).length;f<v;q=++f){if((null!=(N=(W=F[q]).userInfo)?N.time:void 0)>this.thang.world.age){C=!0;break}_.last(c).push(W),h[W.range[0].row]=!0}}for(null==a&&(a=n-1),this.decoratedGutter=this.decoratedGutter||{},T=0,b=(U=null!=this.markerRanges?this.markerRanges:this.markerRanges=[]).length;T<b;T++)(x=U[T]).start.detach(),x.end.detach(),this.aceSession.removeMarker(x.id);for(this.markerRanges=[],O=L=0,V=this.aceSession.getLength();0<=V?L<V:V<L;O=0<=V?++L:--L)h[O]||(this.aceSession.removeGutterDecoration(O,"executing"),this.aceSession.removeGutterDecoration(O,"executed"),this.decoratedGutter[O]="");for(g=_.last(c),c.length&&3<this.spellThang.castAether.metrics.statementsExecuted&&this.options.level.get("hidesCodeToolbar"),null!=(e=this.toolbarView)&&e.toggleFlow(!1),null!=(e=this.debugView)&&e.setVariableStates({}),u=!(k={}),d=M=0,w=(A=null!=g?g:[]).length;M<w;d=++M){if(H=(R=(W=A[d]).range)[0],l=R[1],"executed"==(s=d===g.length-1?"executing":"executed")){if(k[H.row])continue;k[H.row]=!0,S="fullLine"}else null!=(R=this.debugView)&&R.setVariableStates(W.variables),u=!0,S="text";if((x=new Y(H.row,H.col,l.row,l.col)).start=this.aceDoc.createAnchor(x.start),x.end=this.aceDoc.createAnchor(x.end),x.id=this.aceSession.addMarker(x,s,S),this.markerRanges.push(x),h[H.row]&&this.decoratedGutter[H.row]!==s)for(""!==this.decoratedGutter[H.row]&&this.aceSession.removeGutterDecoration(H.row,this.decoratedGutter[H.row]),this.aceSession.addGutterDecoration(H.row,s),this.decoratedGutter[H.row]=s,J.isIPadApp&&Backbone.Mediator.publish("tome:highlight-line",{line:H.row}),t=$("#cinematic-code-display"),p=0,z=G=P=l.row-3,E=l.row+3;P<=E?G<=E:E<=G;z=P<=E?++G:--G)r=_.string.rtrim(this.aceDoc.$lines[z]),i=t.find(".code-line-"+p++),K.replaceText(i.find(".line-number"),0<=z?z+1:""),K.replaceText(i.find(".indentation"),r.match(/\s*/)[0]),K.replaceText(i.find(".code-text"),_.string.trim(r))}return u||null!=(e=this.debugView)&&e.setVariableStates({}),null}},y.prototype.highlightEntryPoints=function(){for(var e,t,i,n,o,s,r,a,l,c,h,u,p,d=this.aceDoc.$lines,m=this.spell.originalSource.split("\n"),f=this.aceSession,g=(S[this.spell.language],!1),y=null,v=!1,b=!1,_=!1,w=[],k=t=0,x=d.length;t<x;k=++t){for(o=d[k],f.removeGutterDecoration(k,"entry-point"),f.removeGutterDecoration(k,"next-entry-point"),n=(u=[i=0,4,8,12,16]).length;i<n;i++)f.removeGutterDecoration(k,"entry-point-indent-"+u[i]);if(a=this.singleLineCommentRegex().test(o),r=o.trim()[0]&&!this.singleLineCommentOnlyRegex().test(o),c=/^[ \t]*$/.test(o),l=-1!==o.indexOf(""),s=o!==m[k],(p=c&&v&&!b&&_)&&s&&(-1!==(h=m.indexOf(y))&&o===m[h+1]?s=!1:p=!1),l&&(s?-1!==m.indexOf(o)&&(p=!(s=!1)):p=!0),p){for(f.addGutterDecoration(k,"entry-point"),g||(f.addGutterDecoration(k,"next-entry-point"),g=!0,this.hasSetInitialCursor||(this.hasSetInitialCursor=!0,this.ace.navigateTo(k,null!=(p=null!=(p=o.match(/\S/))?p.index:void 0)?p:o.length),this.firstEntryToScrollLine=k)),e=0;/\s/.test(o[e]);)e++;e=Math.min(16,4*Math.floor(e/4)),f.addGutterDecoration(k,"entry-point-indent-"+e)}y=o,v=a,b=r,w.push(_=_||(r||c))}return w},y.prototype.onAnnotationClick=function(){return Backbone.Mediator.publish("tome:jiggle-problem-alert",{})},y.prototype.onGutterClick=function(){return this.ace.clearSelection()},y.prototype.onDisableControls=function(e){return this.toggleControls(e,!1)},y.prototype.onEnableControls=function(e){return this.toggleControls(e,this.writable)},y.prototype.toggleControls=function(e,t){if(!this.destroyed&&(null==e||!e.controls||0<=g.call(e.controls,"editor"))&&t!==this.controlsEnabled)return this.controlsEnabled=t&&this.writable,e=!t,t=this.ace.isFocused(),this.ace.setReadOnly(e),this.ace[e?"setStyle":"unsetStyle"]("disabled"),this.toggleBackground(),e&&t?$("body").focus():void 0},y.prototype.toggleBackground=function(){var e=this.$el.find("img.code-background")[0];return 0===e.naturalWidth?_.delay(this.toggleBackground,100):(this.controlsEnabled&&p.revertImage(e,"span.code-background"),this.controlsEnabled?void 0:p.darkenImage(e,"span.code-background",.8))},y.prototype.onSpellBeautify=function(e){if(this.spellThang&&(this.ace.isFocused()||e.spell===this.spell))return e=this.getSource(),e=this.spellThang.aether.beautify(e.replace(/\bloop\b/g,"while (__COCO_LOOP_CONSTRUCT__)")).replace(/while \(__COCO_LOOP_CONSTRUCT__\)/g,"loop"),this.ace.setValue(e)},y.prototype.onMaximizeToggled=function(e){return _.delay((t=this,function(){return t.resize()}),600);var t},y.prototype.onWindowResize=function(e){return this.spellPaletteHeight=null,_.delay((t=this,function(){return"function"==typeof t.resize?t.resize():void 0}),600);var t},y.prototype.resize=function(){var e;return null!=(e=this.ace)&&e.resize(!0),this.lastScreenLineCount=null,this.updateLines()},y.prototype.onChangeEditorConfig=function(e){var t,i=null!=(t=L.get("aceConfig"))?t:{};return this.ace.setBehavioursEnabled(i.behaviors),this.ace.setKeyboardHandler(this.keyBindings[null!=(t=i.keyBindings)?t:"default"]),this.updateAutocomplete(null!=(i=i.liveCompletion)&&i)},y.prototype.onChangeLanguage=function(e){var t;if(this.spell.canWrite())return this.aceSession.setMode(h.aceEditModes[e.language]),null!=(t=this.autocomplete)&&t.set("language",h.aceEditModes[e.language].substr("ace/mode/")),t=this.getSource()===this.spell.originalSource,this.spell.setLanguage(e.language),t?this.reloadCode(!0):void 0},y.prototype.onInsertSnippet=function(e){var t,i=null;null!=(t=e.doc.snippets)&&(null!=(t=t[e.language])&&t.code)?i=e.doc.snippets[e.language].code:"snippet"!==e.formatted.type&&null!=e.formatted.shortName&&(i=e.formatted.shortName),null!=i&&B.require("ace/snippets").snippetManager.insertSnippet(this.ace,i)},y.prototype.dismiss=function(){return this.spell.hasChangedSignificantly(this.getSource(),null,(t=this,function(e){if(e)return t.recompile()}));var t},y.prototype.onScriptStateChange=function(e){return this.scriptRunning=null!==e.currentScript},y.prototype.onPlaybackEndedChanged=function(e){var t;return $(null!=(t=this.ace)?t.container:void 0).toggleClass("playback-ended",e.ended)},y.prototype.checkRequiredCode=function(){var e,t,i,n,o,s;if(!this.destroyed){for(s=this.getSource().replace(this.singleLineCommentRegex(),""),o=[],e=0,t=(n=this.options.level.get("requiredCode")).length;e<t;e++)i=n[e],-1===s.indexOf(i)?(null==this.warnedCodeFragments&&(this.warnedCodeFragments={}),this.warnedCodeFragments[i]||Backbone.Mediator.publish("tome:required-code-fragment-deleted",{codeFragment:i}),o.push(this.warnedCodeFragments[i]=!0)):o.push(void 0);return o}},y.prototype.checkSuspectCode=function(){var e,t,i,n,o,s,r,a,l,c,h;if(!this.destroyed){for(l=this.getSource().replace(this.singleLineCommentRegex(),""),e=[],t=0,o=(h=this.options.level.get("suspectCode")).length;t<o;t++)c=h[t],new RegExp(c.pattern,"m").test(l)&&(null==this.warnedCodeFragments&&(this.warnedCodeFragments={}),this.warnedCodeFragments[c.name]||Backbone.Mediator.publish("tome:suspect-code-fragment-added",{codeFragment:c.name,codeLanguage:this.spell.language}),this.warnedCodeFragments[c.name]=!0,e.push(c.name));for(i=0,s=(a=null!=(r=this.lastDetectedSuspectCodeFragmentNames)?r:[]).length;i<s;i++)n=a[i],g.call(e,n)<0&&Backbone.Mediator.publish("tome:suspect-code-fragment-deleted",{codeFragment:n,codeLanguage:this.spell.language});return this.lastDetectedSuspectCodeFragmentNames=e}},y.prototype.destroy=function(){var e,t,i,n,o,s,r;for($(null!=(r=this.ace)?r.container:void 0).find(".ace_gutter").off("click mouseenter",".ace_error, .ace_warning, .ace_info"),$(null!=(r=this.ace)?r.container:void 0).find(".ace_gutter").off(),null!=(r=this.firepad)&&r.dispose(),t=0,i=(o=this.aceCommands).length;t<i;t++)e=o[t],null!=(s=this.ace)&&s.commands.removeCommand(e);return null!=(r=this.ace)&&r.destroy(),null!=(r=this.aceDoc)&&r.off("change",this.onCodeChangeMetaHandler),null!=(r=this.aceSession)&&r.selection.off("changeCursor",this.onCursorActivity),this.destroyAceEditor(this.ace),null!=(r=this.debugView)&&r.destroy(),null!=(r=this.translationView)&&r.destroy(),null!=(r=this.toolbarView)&&r.destroy(),null!=this.editorLang&&null!=(n=this.autocomplete)&&n.addSnippets([],this.editorLang),$(window).off("resize",this.onWindowResize),window.clearTimeout(this.saveSpadeTimeout),(this.saveSpadeTimeout=null)!=(n=this.autocomplete)&&n.destroy(),y.__super__.destroy.call(this)},y),S={javascript:"//",python:"#",coffeescript:"#",lua:"--",java:"//",cpp:"//",html:"\x3c!--",css:"/\\*"}}.call(this,b(3),b(17))},2577:function(e,t,i){var n=i(2578);(n="string"==typeof n?[[e.i,n,""]]:n).locals&&(e.exports=n.locals);(0,i(21).default)("28886d82",n,!0,{})},2578:function(e,t,i){},2579:function(e,t,i){var n=i(11);e.exports=function(e){var t,i=[],e=e||{};return function(e){i.push('<img src="/images/level/code_editor_background.png" class="code-background"><span class="code-background"></span><div class="ace"></div><div data-i18n="play_level.code_saved" class="save-status"></div><div class="programming-language-container rtl-allowed">'),e.spell.level.isType("web-dev")?0<=(e.spell.level.get("campaign")||"").indexOf("web-dev-1")?i.push('<span data-i18n="teacher.language" class="programming-language-label"></span><span class="programming-language-label spr">:</span><span class="programming-language">HTML</span>'):i.push('<span data-i18n="play_level.languages" class="programming-language-label"></span><span class="programming-language-label spr">:</span><span class="programming-language spr">HTML</span><span class="programming-language-label spr">/</span><span class="programming-language">JavaScript</span>'):i.push('<span data-i18n="play_level.programming_language" class="programming-language-label"></span><span class="programming-language-label spr">:</span><span class="programming-language">'+n.escape(null==(t=e.spell.displayCodeLanguage)?"":t)+"</span>"),i.push("</div>")}.call(this,"view"in e?e.view:"undefined"!=typeof view?view:void 0),i.join("")}},2580:function(a,e,l){!function(d){var e,m,f,t,n,i,o=function(e,t){return function(){return e.apply(t,arguments)}},s={}.hasOwnProperty;function r(e){var t,i;for(t in this.notifyPropertyHovered=o(this.notifyPropertyHovered,this),this.updateTooltipProgress=o(this.updateTooltipProgress,this),this.onMouseMove=o(this.onMouseMove,this),this.setTooltipProgress=o(this.setTooltipProgress,this),this.setTooltipText=o(this.setTooltipText,this),this.setTooltipKeyAndValue=o(this.setTooltipKeyAndValue,this),this.calculateCurrentTimeString=o(this.calculateCurrentTimeString,this),r.__super__.constructor.call(this,e),this.ace=e.ace,this.thang=e.thang,this.spell=e.spell,this.progress=0,this.variableStates={},this.globals={Math:Math,_:_,String:String,Number:Number,Array:Array,Object:Object},n)i=n[t],this.globals[t]=i;this.onMouseMove=_.throttle(this.onMouseMove,25),this.cache={},this.lastFrameRequested=-1,this.workerIsSimulating=!1,this.spellHasChanged=!1,this.currentFrame=0,this.frameRate=10,this.debouncedTooltipUpdate=_.debounce(this.updateTooltipProgress,100)}e=l(26),i=l(2581),t=l(1383),m=t.require("ace/range").Range,f=t.require("ace/token_iterator").TokenIterator,n={Thang:l(168),Vector:l(47),Rectangle:l(94),Ellipse:l(119),LineSegment:l(82)},a.exports=(function(e,t){for(var i in t)s.call(t,i)&&(e[i]=t[i]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(r,e),r.prototype.className="spell-debug-view",r.prototype.template=i,r.prototype.subscriptions={"god:new-world-created":"onNewWorld","god:debug-value-return":"handleDebugValue","god:debug-world-load-progress-changed":"handleWorldLoadProgressChanged","tome:cast-spells":"onTomeCast","surface:frame-changed":"onFrameChanged","tome:spell-has-changed-significantly-calculation":"onSpellChangedCalculation"},r.prototype.events={},r.prototype.pad2=function(e){return null==e||0===e?"00":(e<10?"0":"")+e},r.prototype.calculateCurrentTimeString=function(){var e=this.currentFrame/this.frameRate,t=Math.floor(e/60),e=(e-60*t).toFixed(1);return t+":"+this.pad2(e)},r.prototype.setTooltipKeyAndValue=function(e,t){return this.hideProgressBarAndShowText(),t="Time: "+this.calculateCurrentTimeString()+"\n"+e+": "+t,this.$el.find("code").text(t),this.$el.show().css(this.pos)},r.prototype.setTooltipText=function(e){return this.hideProgressBarAndShowText(),this.$el.find("code").text(e),this.$el.show().css(this.pos)},r.prototype.setTooltipProgress=function(e){return this.showProgressBarAndHideText(),this.$el.find(".progress-bar").css("width",e+"%").attr("aria-valuenow",e),this.$el.show().css(this.pos)},r.prototype.showProgressBarAndHideText=function(){return this.$el.find("pre").css("display","none"),this.$el.find(".progress").css("display","block")},r.prototype.hideProgressBarAndShowText=function(){return this.$el.find("pre").css("display","block"),this.$el.find(".progress").css("display","none")},r.prototype.onTomeCast=function(){return this.invalidateCache()},r.prototype.invalidateCache=function(){return this.cache={}},r.prototype.retrieveValueFromCache=function(e,t,i,n){var o,s,i=i.join(),i=null!=(n=this.cache[n])&&null!=(o=n[e])&&null!=(s=o[t])?s[i]:void 0;return null!=i?i:void 0},r.prototype.updateCache=function(e,t,i,n,o){for(var s,r,a=this.cache,l=[n,e,t,i.join()],c=s=0,h=l.length-1;0<=h?s<h:h<s;c=0<=h?++s:--s)(r=l[c])in a||(a[r]={}),a=a[r];return a[l[l.length-1]]=o},r.prototype.handleDebugValue=function(e){var t=e.key,e=e.value;if(this.workerIsSimulating=!1,this.updateCache(this.thang.id,this.spell.name,t.split("."),this.lastFrameRequested,e),!this.variableChain||!t!==this.variableChain.join("."))return this.setTooltipKeyAndValue(t,e)},r.prototype.handleWorldLoadProgressChanged=function(e){return this.progress=e.progress},r.prototype.afterRender=function(){return r.__super__.afterRender.call(this),this.ace.on("mousemove",this.onMouseMove)},r.prototype.setVariableStates=function(e){return this.variableStates=e,this.update()},r.prototype.isIdentifier=function(e){return e&&("identifier"===e.type||"this"===e.value||this.globals[e.value])},r.prototype.onMouseMove=function(e){var t,i,n,o,s,r,a,l,c,h,u,p;if(!this.destroyed){for(s=e.getDocumentPosition(),n=(null!=(a=(o=new f(e.editor.session,s.row,s.column)).getCurrentToken())?a.index:void 0)===o.$rowTokens.length-1;o.getCurrentTokenRow()===s.row&&!this.isIdentifier(u=o.getCurrentToken())&&!n&&u;)o.stepBackward();if(this.isIdentifier(u))for(h=o.getCurrentTokenColumn(),t=(p=[[u.value],h,h+u.value.length])[0],h=p[1],i=p[2];o.getCurrentTokenRow()===s.row&&(o.stepBackward(),"."===(null!=(l=o.getCurrentToken())?l.value:void 0))&&(o.stepBackward(),u=null,this.isIdentifier(r=o.getCurrentToken()));)u=r,h=o.getCurrentTokenColumn(),t.unshift(u.value);return u?(this.variableChain=t,a=null!=(c=e.domEvent.offsetX)?c:e.clientX-d(e.domEvent.target).offset().left,c=null!=(p=e.domEvent.offsetY)?p:e.clientY-d(e.domEvent.target).offset().top,p=d(document).width(),e.clientX+300>p&&(a=p-d(e.domEvent.target).offset().left-300),this.pos={left:a+50,top:c+20},this.markerRange=new m(s.row,h,s.row,i)):this.variableChain=this.markerRange=null,this.update()}},r.prototype.onMouseOut=function(e){return this.variableChain=this.markerRange=null,this.update()},r.prototype.updateTooltipProgress=function(){if(this.variableChain&&this.progress<1)return this.setTooltipProgress(100*this.progress),_.delay(this.updateTooltipProgress,100)},r.prototype.onNewWorld=function(e){return this.thang&&(this.thang=this.options.thang=e.world.thangMap[this.thang.id]),this.frameRate=e.world.frameRate},r.prototype.onFrameChanged=function(e){return this.currentFrame=Math.round(e.frame),this.frameRate=e.world.frameRate},r.prototype.onSpellChangedCalculation=function(e){return this.spellHasChanged=e.hasChangedSignificantly},r.prototype.update=function(){var e;return this.variableChain?this.spellHasChanged?this.setTooltipText("You've changed this spell! \nPlease recast to use the hover debugger."):2===this.variableChain.length&&"this"===this.variableChain[0]?this.setTooltipKeyAndValue(this.variableChain.join("."),this.stringifyValue(this.thang[this.variableChain[1]],0)):1===this.variableChain.length&&Aether.globals[this.variableChain[0]]?this.setTooltipKeyAndValue(this.variableChain.join("."),this.stringifyValue(Aether.globals[this.variableChain[0]],0)):this.workerIsSimulating&&this.progress<1?this.debouncedTooltipUpdate():this.currentFrame===this.lastFrameRequested&&(e=this.retrieveValueFromCache(this.thang.id,this.spell.name,this.variableChain,this.currentFrame))?this.setTooltipKeyAndValue(this.variableChain.join("."),e):(Backbone.Mediator.publish("tome:spell-debug-value-request",{thangID:this.thang.id,spellID:this.spell.name,variableChain:this.variableChain,frame:this.currentFrame}),this.currentFrame!==this.lastFrameRequested&&(this.workerIsSimulating=!0),this.lastFrameRequested=this.currentFrame,this.progress=0,this.debouncedTooltipUpdate()):this.$el.hide(),2===(null!=(e=this.variableChain)?e.length:void 0)?(this.hoveredPropertyTimeout&&clearTimeout(this.hoveredPropertyTimeout),this.hoveredPropertyTimeout=_.delay(this.notifyPropertyHovered,500)):this.notifyPropertyHovered(),this.updateMarker()},r.prototype.stringifyValue=function(e,n){var t,i,o,s,r,a,l,c,h,u,p,d,m,f;if(!e||_.isString(e))return e;if(_.isFunction(e))return 2===n?void 0:"<Function>";if(e===this.thang&&n)return"<this "+e.id+">";if(2===n)return e="Thang"===(null!=(d=e.constructor)?d.className:void 0)?"<"+(e.type||e.spriteName)+" - "+e.id+", "+(e.pos?e.pos.toString():"non-physical")+">":e.toString();if(i=_.isArray(e),o=_.isObject(e),!i&&!o)return e.toString();if(t=i?["[","]"]:["{","}"],!_.size(e))return t.join("");if(f=[],i)for(s=0,l=e.length;s<l;s++)m=e[s],void 0!==(p=this.stringifyValue(m,n+1))&&f.push(""+p);else for(r=0,c=(h=null!=(u=e.apiProperties)?u:_.keys(e)).length;r<c;r++)a=h[r],void 0!==(p=this.stringifyValue(e[a],n+1))&&f.push(a+": "+p);return d="\n"+function(){var e,t,i=[];for(e=0,t=n;0<=t?e<t:t<e;0<=t?++e:--e)i.push("  ");return i}().join(""),u=null!=(u=e.constructor)?u.className:void 0,i&&null==u&&(u="Array"),""+(u=(u=o&&null==u?"Object":u)?u+" ":"")+t[0]+d+"  "+f.join(d+"  ")+d+t[1]},r.prototype.notifyPropertyHovered=function(){var e,t;if(this.hoveredPropertyTimeout&&clearTimeout(this.hoveredPropertyTimeout),this.hoveredPropertyTimeout=null,e=this.hoveredProperty,this.hoveredProperty=2===(null!=(t=this.variableChain)?t.length:void 0)?{owner:this.variableChain[0],property:this.variableChain[1]}:{},!_.isEqual(e,this.hoveredProperty))return Backbone.Mediator.publish("tome:spell-debug-property-hovered",this.hoveredProperty)},r.prototype.updateMarker=function(){if(this.marker&&(this.ace.getSession().removeMarker(this.marker),this.marker=null),this.markerRange)return this.marker=this.ace.getSession().addMarker(this.markerRange,"ace_bracket","text")},r.prototype.destroy=function(){var e;return null!=(e=this.ace)&&e.removeEventListener("mousemove",this.onMouseMove),r.__super__.destroy.call(this)},r)}.call(this,l(3))},2581:function(e,t,i){i(11);e.exports=function(e){var t=[];return t.push('<div class="progress"><div role="progressbar" aria-valuenow="50" aria-valuemin="0" aria-valuemax="100" class="progress-bar"><span>Inspecting variable...</span></div></div><pre><code></code></pre>'),t.join("")}},2582:function(u,e,p){!function(o){var e,t,a,l,i,n,c,s=function(e,t){return function(){return e.apply(t,arguments)}},r={}.hasOwnProperty;function h(e){this.onMouseMove=s(this.onMouseMove,this),this.setTooltipText=s(this.setTooltipText,this),h.__super__.constructor.call(this,e),this.ace=e.ace,e=this.supermodel.getModels(t),this.componentTranslations=e.reduce(function(e,t){for(var i,n,o=null!=(t=t.get("propertyDocumentation"))?t:[],s=0,r=o.length;s<r;s++)i=o[s],(n=c.i18n(i,"name",null,!1))!==i.name&&(e[i.name]=n);return e},{}),this.onMouseMove=_.throttle(this.onMouseMove,25)}e=p(26),t=p(619),n=p(2583),i=p(1383),a=i.require("ace/range").Range,l=i.require("ace/token_iterator").TokenIterator,c=p(6),u.exports=(function(e,t){for(var i in t)r.call(t,i)&&(e[i]=t[i]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(h,e),h.prototype.className="spell-translation-view",h.prototype.template=n,h.prototype.events={mousemove:function(){return this.$el.hide()}},h.prototype.afterRender=function(){return h.__super__.afterRender.call(this),this.ace.on("mousemove",this.onMouseMove)},h.prototype.setTooltipText=function(e){return this.$el.find("code").text(e),this.$el.show().css(this.pos)},h.prototype.isIdentifier=function(t){return t&&(_.any([/identifier/,/keyword/],function(e){return e.test(t.type)})||"this"===t.value)},h.prototype.onMouseMove=function(e){var t,i,n,o,s,r;if(!this.destroyed){for(n=e.getDocumentPosition(),t=(null!=(o=(i=new l(e.editor.session,n.row,n.column)).getCurrentToken())?o.index:void 0)===i.$rowTokens.length-1;i.getCurrentTokenRow()===n.row&&!this.isIdentifier(r=i.getCurrentToken())&&!t&&r;)i.stepBackward();if(!this.isIdentifier(r))return this.word=null,void this.update();try{s=i.getCurrentTokenColumn()}catch(e){s=0}return o=s+r.value.length,this.isIdentifier(r)&&(this.word=r.value,this.markerRange=new a(n.row,s,n.row,o),this.reposition(e.domEvent)),this.update()}},h.prototype.reposition=function(e){var t=null!=(i=e.offsetX)?i:e.clientX-o(e.target).offset().left,i=null!=(n=e.offsetY)?n:e.clientY-o(e.target).offset().top,n=o(document).width()-20;return e.clientX+this.$el.width()>n&&(t=n-o(e.target).offset().left-this.$el.width()),this.pos={left:t+80,top:i-20},this.$el.css(this.pos)},h.prototype.onMouseOut=function(){return this.word=null,this.markerRange=null,this.update()},h.prototype.update=function(){var e="code."+this.word,t=this.componentTranslations[this.word]||o.t(e);return this.word&&t&&t!==e&&t!==this.word?this.setTooltipText(t):this.$el.hide()},h.prototype.destroy=function(){var e;return null!=(e=this.ace)&&e.removeEventListener("mousemove",this.onMouseMove),h.__super__.destroy.call(this)},h)}.call(this,p(3))},2583:function(e,t,i){i(11);e.exports=function(e){var t=[];return t.push("<pre><code></code></pre>"),t.join("")}},2584:function(e,t,i){var n,o={}.hasOwnProperty;function s(e){s.__super__.constructor.call(this,e),this.ace=e.ace}n=i(26),i=i(2585),e.exports=(function(e,t){for(var i in t)o.call(t,i)&&(e[i]=t[i]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(s,n),s.prototype.className="spell-toolbar-view",s.prototype.template=i,s.prototype.progressHoverDelay=500,s.prototype.subscriptions={"tome:spell-step-backward":"onStepBackward","tome:spell-step-forward":"onStepForward"},s.prototype.events={"mousedown .spell-progress":"onProgressMouseDown","mouseup .spell-progress":"onProgressMouseUp","mousemove .spell-progress":"onProgressMouseMove","tapstart .spell-progress":"onProgressTapStart","tapend .spell-progress":"onProgressTapEnd","tapmove .spell-progress":"onProgressTapMove","click .step-backward":"onStepBackward","click .step-forward":"onStepForward"},s.prototype.afterRender=function(){return s.__super__.afterRender.call(this)},s.prototype.toggleFlow=function(e){return this.$el.find(".flow").toggle(e)},s.prototype.setStatementIndex=function(e){var t,i;if(t=null!=(t=this.callState)?t.statementsExecuted:void 0)return this.statementIndex=Math.min(t-1,Math.max(0,e)),this.statementRatio=this.statementIndex/(t-1),this.statementTime=null!=(e=null!=(e=this.callState.statements[this.statementIndex])?e.userInfo.time:void 0)?e:0,this.$el.find(".progress-bar").css("width",100*this.statementRatio+"%"),this.$el.find(".step-backward").prop("disabled",0===this.statementIndex),this.$el.find(".step-forward").prop("disabled",this.statementIndex===t-1),this.updateMetrics(),_.defer((i=this,function(){return Backbone.Mediator.publish("tome:spell-statement-index-updated",{statementIndex:i.statementIndex,ace:i.ace})}))},s.prototype.updateMetrics=function(){var e,t=this.callState.statementsExecuted,i=this.$el.find(".metrics");return this.suppressMetricsUpdates||!t&&!this.metrics.statementsExecuted?i.hide():(1<this.metrics.callsExecuted?(i.find(".call-index").text(this.callIndex+1),i.find(".calls-executed").text(this.metrics.callsExecuted),i.find(".calls-metric").show().attr("title","Method call "+(this.callIndex+1)+" of "+this.metrics.callsExecuted+" calls")):i.find(".calls-metric").hide(),this.metrics.statementsExecuted?(i.find(".statement-index").text(this.statementIndex+1),i.find(".statements-executed").text(t),e=this.metrics.statementsExecuted>t?(i.find(".statements-executed-total").text(" ("+this.metrics.statementsExecuted+")")," ("+this.metrics.statementsExecuted+" statements total)"):(i.find(".statements-executed-total").text(""),""),i.find(".statements-metric").show().attr("title","Statement "+(this.statementIndex+1)+" of "+t+" this call"+e)):i.find(".statements-metric").hide(),e=this.$el.find(".scrubber-handle").position().left+this.$el.find(".spell-progress").position().left,i.finish().show().css({left:e-i.width()/2}).delay(2e3).fadeOut("fast"))},s.prototype.setStatementRatio=function(e){var t;if(t=null!=(t=this.callState)?t.statementsExecuted:void 0)return(t=Math.floor(e*t))!==this.statementIndex?this.setStatementIndex(t):void 0},s.prototype.onProgressMouseDown=function(e){return this.dragging=!0,this.scrubProgress(e),Backbone.Mediator.publish("level:set-playing",{playing:!1})},s.prototype.onProgressMouseUp=function(e){return this.dragging=!1},s.prototype.onProgressMouseMove=function(e){if(this.dragging)return this.scrubProgress(e)},s.prototype.onProgressTapStart=function(e,t){return this.dragging=!0,this.scrubProgress(e,t)},s.prototype.onProgressTapEnd=function(e,t){return this.dragging=!1},s.prototype.onProgressTapMove=function(e,t){if(this.dragging)return this.scrubProgress(e,t)},s.prototype.scrubProgress=function(e,t){t=(null!=(t=null!=(e=e.clientX)?e:null!=t?t.position.x:void 0)?t:0)-this.$el.find(".spell-progress").offset().left;return t=Math.max(t,0),this.setStatementRatio(t/this.$el.find(".spell-progress").width()),this.updateTime(),this.updateScroll()},s.prototype.onStepBackward=function(e){return this.step(-1)},s.prototype.onStepForward=function(e){return this.step(1)},s.prototype.step=function(e){var t=this.statementTime;return this.setStatementIndex(this.statementIndex+e),this.statementTime!==t&&this.updateTime(),this.updateScroll(),Backbone.Mediator.publish("level:set-playing",{playing:!1})},s.prototype.updateTime=function(){var e;return this.maintainIndexScrub=!0,this.maintainIndexScrubTimeout&&clearTimeout(this.maintainIndexScrubTimeout),this.maintainIndexScrubTimeout=_.delay((e=this,function(){return e.maintainIndexScrub=!1}),500),Backbone.Mediator.publish("level:set-time",{time:this.statementTime,scrubDuration:500})},s.prototype.updateScroll=function(){var e,t,i;if(i=null!=(e=this.callState)&&null!=(t=e.statements)&&null!=(i=t[this.statementIndex])?i.range[0]:void 0)return this.ace.getValue(),i=i.row,this.ace.scrollToLine(i,!0,!0)},s.prototype.setCallState=function(e,t,i,n){if(this.callIndex=i,this.metrics=n,(e!==this.callState||t!==this.statementIndex)&&(this.callState=e))return this.suppressMetricsUpdates=!0,this.maintainIndexScrub||this.dragging||null==t||(null!=(e=e.statements[t])?e.userInfo.time:void 0)===this.statementTime?this.setStatementRatio(this.statementRatio):this.setStatementIndex(t),this.suppressMetricsUpdates=!1},s)},2585:function(e,t,i){i(11);e.exports=function(e){var t=[];return t.push('<div class="flow"><div class="spell-progress"><div class="progress"><div class="progress-bar"><div class="scrubber-handle"></div></div></div></div><div class="btn-group steppers"><button title="Ctrl/Cmd + Alt + [: Step Backward" class="btn btn-mini btn-inverse banner step-backward"><i class="icon-arrow-left icon-white"></i></button><button title="Ctrl/Cmd + Alt + ]: Step Forward" class="btn btn-mini btn-inverse banner step-forward"><i class="icon-arrow-right icon-white"></i></button></div><div class="metrics"><div class="statements-metric">Statement <span class="metric statement-index"></span> / <span class="metric statements-executed"></span><span class="metric statements-executed-total"></span></div><div class="calls-metric">Call <span class="metric call-index"></span> / <span class="metric calls-executed"></span></div></div></div>'),t.join("")}},2586:function(e,t,i){!function(U){var u,V,s,r,a;function p(e,t){var i,n,o;this.doLiveCompletion=(i=this.doLiveCompletion,n=this,function(){return i.apply(n,arguments)}),a=u.require("ace/tokenizer").Tokenizer,r=u.require("ace/background_tokenizer").BackgroundTokenizer,this.editor=e,u.require("ace/config"),null==t&&(t={}),e=_.extend({},s),this.options=_.merge(e,t),u.config.loadModule("ace/ext/language_tools",(o=this,function(){var e;return o.snippetManager=u.require("ace/snippets").snippetManager,o.snippetManager.expandWithTab=function(){return!1},e=new(o.editor.getSession().getMode().HighlightRules),e=new a(e.getRules()),o.bgTokenizer=new r(e,o.editor),e=o.editor.getSession().getDocument(),o.bgTokenizer.setDocument(e),o.bgTokenizer.start(0),o.setAceOptions(),o.copyCompleters(),o.activateCompleter(),o.editor.commands.on("afterExec",o.doLiveCompletion)}))}V=i(1403),u=i(1383),s={autoLineEndings:{},basic:!0,snippetsLangDefaults:!0,liveCompletion:!0,language:"javascript",languagePrefixes:"this.,@,self.",completers:{snippets:!0}},e.exports=(r=a="",p.prototype.destroy=function(){var e;if(this.editor.commands.off("afterExec",this.doLiveCompletion),null!=(e=this.bgTokenizer)&&"function"==typeof e.stop&&e.stop(),null!=this.oldSnippets)return null!=(e=this.snippetManager)?e.unregister(this.oldSnippets):void 0},p.prototype.setAceOptions=function(){var e={enableLiveAutocompletion:this.options.liveCompletion,enableBasicAutocompletion:this.options.basic,enableSnippets:this.options.completers.snippets};return this.editor.setOptions(e),null!=(e=this.editor.completer)?e.autoSelect=!0:void 0},p.prototype.copyCompleters=function(){var e;if(this.completers={snippets:{},text:{},keywords:{}},null!=this.editor.completers&&(e=this.editor.completers,this.completers.snippets.comp=e[0],this.completers.text.comp=e[1],this.completers.keywords.comp=e[2]),this.options.completers.snippets)return this.completers.snippets={pos:0},this.completers.snippets.comp=i(2587)(this.snippetManager,this.options.autoLineEndings)},p.prototype.activateCompleter=function(e){var t,i,n;if(Array.isArray(e))return this.editor.completers=e;if("string"==typeof e)return null!=this.completers[e]&&this.editor.completers[this.completers[e].pos]!==this.completers[e].comp?this.editor.completers.splice(this.completers[e].pos,0,this.completers[e].comp):void 0;for(n in this.editor.completers=[],i=[],t=this.completers)t[n],!0===this.options.completers[n]?i.push(this.activateCompleter(n)):i.push(void 0);return i},p.prototype.addSnippets=function(s,r){return this.options.language=r,u.config.loadModule("ace/ext/language_tools",(a=this,function(){return a.snippetManager=u.require("ace/snippets").snippetManager,u.config.loadModule("ace/snippets/"+r,function(e){var t,i,n,o;if(null!=e){for(0<(null!=(n=(a.snippetManager.files[r]=e).snippets)?n.length:void 0)&&a.snippetManager.unregister(e.snippets),null!=a.oldSnippets&&a.snippetManager.unregister(a.oldSnippets),e.snippets=a.options.snippetsLangDefaults?a.snippetManager.parseSnippetFile(e.snippetText):[],t=0,i=s.length;t<i;t++)o=s[t],e.snippets.push(o);return a.snippetManager.register(e.snippets),a.oldSnippets=e.snippets}})}));var a},p.prototype.setLiveCompletion=function(e){if(!0===e||!1===e)return this.options.liveCompletion=e,this.setAceOptions()},p.prototype.set=function(e,t){switch(e){case"snippets":if("boolean"!=typeof t)return;this.options.completers.snippets=t,this.setAceOptions(),this.activateCompleter("snippets");break;case"basic":if("boolean"!=typeof t)return;this.options.basic=t,this.setAceOptions(),this.activateCompleter();break;case"liveCompletion":if("boolean"!=typeof t)return;this.options.liveCompletion=t,this.setAceOptions(),this.activateCompleter();break;case"language":if("string"!=typeof t)return;this.options.language=t,this.setAceOptions(),this.activateCompleter();break;case"completers.keywords":if("boolean"!=typeof t)return;this.options.completers.keywords=t,this.activateCompleter();break;case"completers.text":if("boolean"!=typeof t)return;this.options.completers.text=t,this.activateCompleter()}},p.prototype.on=function(){return this.paused=!1},p.prototype.off=function(){return this.paused=!0},p.prototype.doLiveCompletion=function(e){var t,i,n,o,s,r,a,l,c,h;if((this.options.basic||this.options.liveCompletion||this.options.completers.snippets)&&!this.paused){if(t=t||u.require("ace/token_iterator").TokenIterator,i=e.editor,e.args,n=i.completer&&i.completer.activated,("backspace"===e.command.name||"insertstring"===e.command.name)&&(c=i.getCursorPosition(),null!=(c=new t(i.getSession(),c.row,c.column).getCurrentToken())&&"comment"!==(o=c.type)&&"string"!==o)){if(o=this.getCompletionPrefix(i),n&&null!=(s=i.completer)&&s.detach(),/^x$|^y$/i.test(o))return;o&&(i.completer||(null!=(null!=(p=u.require("ace/autocomplete").Autocomplete)&&null!=(r=p.prototype)?r.commands:void 0)&&(h=this,p.prototype.commands["Shift-Return"]=function(e){return e.completer.detach(),h.editor.insert("\n")}),i.completer=new p),i.completer.autoSelect=!0,i.completer.autoInsert=!1,i.completer.showPopup(i),20<(null!=(r=i.completer)&&null!=(a=r.completions)&&null!=(l=a.filtered)?l.length:void 0)?i.completer.detach():null!=i.completer.popup&&(U(".ace_autocomplete").find(".ace_content").css("cursor","pointer"),null!=this.options.popupFontSizePx&&U(".ace_autocomplete").css("font-size",this.options.popupFontSizePx+"px"),null!=this.options.popupLineHeightPx&&U(".ace_autocomplete").css("line-height",this.options.popupLineHeightPx+"px"),null!=this.options.popupWidthPx&&U(".ace_autocomplete").css("width",this.options.popupWidthPx+"px"),"function"==typeof(i=i.completer.popup).resize&&i.resize()))}return!this.options.completers.text||"backspace"!==(e=e.command.name)&&"del"!==e&&"insertstring"!==e&&"removetolinestart"!==e&&"Enter"!==e&&"Return"!==e&&"Space"!==e&&"Tab"!==e?void 0:this.bgTokenizer.fireUpdateEvent(0,this.editor.getSession().getLength())}},p.prototype.getCompletionPrefix=function(e){var t=t||u.require("ace/autocomplete/util"),i=e.getCursorPosition(),n=e.session.getLine(i.row),o=null;return null!=(e=e.completers)&&e.forEach(function(e){if(null!=e&&e.identifierRegexps)return e.identifierRegexps.forEach(function(e){if(!o&&e)return o=t.retrievePrecedingIdentifier(n,i.column,e)})}),o=null==o?t.retrievePrecedingIdentifier(n,i.column):o},p.prototype.addCodeCombatSnippets=function(e,t,i){var n,o,s,r,a,l,c,h,u,p,d,m,f,g,y,v,b,w,k,x,S,C,T,L,M,D,I,A,R=[],P=t.getSource(),E=!1,B=!1,F=null!=(m=e.get("autocompleteReplacement"))?m:[],N=i.propGroups;for(r in N)for(a=0,c=(d=N[r]).length;a<c;a++)v=d[a],_.isString(v)?p=r:(p=v.owner,v=v.prop),v=_.find(null!=(C=i.allDocs["__"+v])?C:[],function(e){return e.owner===p||!("this"!==p&&"more"!==p||null!=e.owner&&"this"!==e.owner)}),"java"!==(C=i.language)&&"cpp"!==C||null!=v&&null!=(x=v.snippets)&&x[i.language]||null==v||null==(S=v.snippets)||!S.javascript||(v.snippets[i.language]=v.snippets.javascript),"lua"!==(C=i.language)&&"coffeescript"!==C&&"python"!==C||null!=v&&null!=(T=v.snippets)&&T[i.language]||!(null!=v&&(null!=(L=v.snippets)&&L.python)||null!=v&&(null!=(L=v.snippets)&&L.javascript))||(v.snippets[i.language]=(null!=v&&null!=(f=v.snippets)?f.python:void 0)||v.snippets.javascript),null!=v&&(null!=(M=v.snippets)&&M[i.language])&&(u=v.name,M=_.find(F,function(e){return e.name===u}),o=(null!=M&&null!=(g=M.snippets)&&null!=(y=g[i.language])?y.code:void 0)||v.snippets[i.language].code,/loop/.test(o)&&e.get("moveRightLoopSnippet")&&(o=function(){switch(i.language){case"python":return"while True:\n    hero.moveRight()\n    ${1:}";case"javascript":case"java":case"cpp":return"while (true) {\n    hero.moveRight();\n    ${1:}\n}";default:return o}}()),/loop/.test(o)&&e.isType("course","course-ladder")&&(o=function(){switch(i.language){case"python":return o.replace(/loop:/,"while True:");case"javascript":case"java":case"cpp":return o.replace(/loop/,"while (true)");case"lua":return o.replace(/loop/,"while true then");case"coffeescript":default:return o}}(),u=function(){switch(i.language){case"python":return"while True";case"coffeescript":return"loop";default:return"while true"}}()),!/hero/.test(P)&&/(self[\.\:]|this\.|\@)/.test(P)||(D={python:/self/,javascript:/this/,java:/this/,cpp:/this/,lua:/self/})[i.language]&&D[i.language].test(o)&&(o=o.replace(D[i.language],"hero")),s={content:o,meta:U.i18n.t("keyboard_shortcuts.press_enter",{defaultValue:"press enter"}),name:u,tabTrigger:v.snippets[i.language].tab,importance:null!=(D=v.autoCompletePriority)?D:1},E=E||"findNearestEnemy"===u,B=B||"findNearest"===u,"attack"===u?n=s:R.push(s),v.userShouldCaptureReturn&&(A=null!=(D=v.userShouldCaptureReturn.variableName)?D:"result",null==(I=null!=(v=v.userShouldCaptureReturn.type)?v[i.language]:void 0)&&(I=function(){switch(i.language){case"javascript":case"java":return"var";case"cpp":return"auto";case"lua":return"local";default:return""}}()),s.captureReturn=function(){switch(i.language){case"javascript":case"java":case"cpp":case"lua":return I+" "+A+" = ";default:return A+" = "}}()));for(null!=n&&(E||B||"known-enemy"===(b=e.get("slug"))||"course-known-enemy"===b||(n.content=n.content.replace("${1:enemy}",'"${1:Enemy Name}"')),R.push(n)),l=0,h=R.length;l<h;l++)0===(null!=(w=(s=R[l]).content)?w.indexOf("hero."):void 0)&&(null!=(k=s.name)?k.indexOf("hero."):void 0)<0?s.name="hero."+s.name:0===(null!=(k=s.content)?k.indexOf("game."):void 0)&&(null!=(k=s.name)?k.indexOf("game."):void 0)<0&&(s.name="game."+s.name);return B&&!E&&t.translateFindNearest(),b=V.aceEditModes[i.language].substr("ace/mode/".length),this.addSnippets(R,b),t.editorLang=b},p)}.call(this,i(3))},2587:function(e,t,i){var a,l,f,g=[].indexOf||function(e){for(var t=0,i=this.length;t<i;t++)if(t in this&&this[t]===e)return t;return-1},y=fuzzaldrin.score,v=/\r\n|[\n\r\u2028\u2029]/g,C=/[\.a-zA-Z_0-9\$\-\u00A2-\uFFFF]/,T=i(2588),n=i(1383),L=i(52);e.exports=function(r,w){var k=n.require("ace/range").Range,x=n.require("ace/autocomplete/util"),S=r.insertSnippet;return r.insertSnippet=function(e,t){var i,n,o,s,r,a,l,c,h,u,p,d,m,f,g,y,v,b,_;if(L.commit("game/incrementTimesAutocompleteUsed"),o=e.getCursorPosition(),h=e.session.getLine(o.row),0<o.column&&0<(m=x.retrievePrecedingIdentifier(h,o.column-1,C)).length)if(0===t.toLowerCase().indexOf(m.toLowerCase()))f=new k(o.row,o.column-1-m.length,o.row,o.column),e.session.remove(f);else{for(r=0,l=(g=e.completers).length;r<l;r++)if(null!=(i=g[r]).completions){for(a=0,c=(y=i.completions).length;a<c;a++)if((n=y[a]).snippet===t){u=n;break}if(u)break}if(null!=u&&(_=null!=(b=e.session.getMode())&&null!=(v=b.$id)?v.substr("ace/mode/".length):void 0,p=1,null!=w[_]&&(p+=w[_].length),v=(b=u.content.indexOf(t.substr(0,t.length-p)))?u.content.substring(0,b):"",0<(_=o.column-v.length)&&_<=h.length))if("."===h[s=_-1]){if(p=u.content.substring(0,u.content.indexOf(".")),0<=(d=s-1)&&/\w/.test(h[d])){for(;0<=d&&/\w/.test(h[d]);)d--;(d<0||!/\w/.test(h[d]))&&d++,b=h.substring(d,s),v=0,.5<(v=(p=new T(p))?p.score(b):v)?(f=new k(o.row,d,o.row,_),e.session.remove(f)):/^[^.]+\./.test(t)&&(t=t.replace(/^[^.]+\./,""))}}else if(/\w/.test(h[s])){for(;0<=s&&/\w/.test(h[s]);)s--;(s<0||!/\w/.test(h[s]))&&s++,f=new k(o.row,s,o.row,_),e.session.remove(f)}}return _=o.column,(f=h.substring(_).match(/^[a-zA-Z_0-9]*(\(\s*\))?/))&&(_+=f[0].length),_=new k(o.row,o.column,o.row,_),e.session.remove(_),S.call(this,e,t)},{getCompletions:function(e,t,c,h,i){var n,o,u,p=null!=(s=t.getMode())&&null!=(n=s.$id)?n.substr("ace/mode/".length):void 0,d=t.getLine(c.row),m=[],s=l(t,c).split(/[.:]/g);a(t,c);return 2<s.length?(this.completions=[],i(null,m)):(n=t.getLine(c.row).substring(0,c.column-h.length),s.length<3&&/^(hero|self|this|@|db|game|ui)$/.test(s[0])||/^\s*$/.test(n)?(u=r.snippetMap,r.getActiveScopes(e).forEach(function(e){for(var t,i,n,o,s=u[e]||[],r=[],a=0,l=s.length;a<l;a++)(t=(n=s[a]).name||n.tabTrigger)&&(o=(i=f(n.content,t,d,h,c,p,w,n.captureReturn))[0],i=i[1],r.push(m.push({content:n.content,caption:t,snippet:o,score:null!=(i=i*n.importance)?i:1,meta:n.meta||(n.tabTrigger&&!n.name?n.tabTrigger+"":"snippets")})));return r},this),(o=null!=(t=t.getMode())&&null!=(o=t.$highlightRules)?o.$keywordList:void 0)&&0<=g.call(o,h)?(this.completions=_.filter(m,function(e){return e.caption.indexOf(0===h)}),i(null,this.completions)):i(null,this.completions=m)):i(null,this.completions=m))}}},a=function(e,t){for(var i=t.column,n=i-1,o=e.getLine(t.row);0<=n&&!o[n].match(/\s+|[\.\@]/);)n--;return 0<=n&&n++,o.substring(n,i)},l=function(e,t){for(var i=t.column,n=i-1,o=e.getLine(t.row);0<=n&&!o[n].match(/\s+/);)n--;return 0<=n&&n++,o.substring(n,i)},f=function(e,t,i,n,o,s,r,a){var l,c,h,u,p,d=.1,m=(e.match(v)||[]).length;if(-1<e.toLowerCase().indexOf(n.toLowerCase())){if(p=e.indexOf(t),h=e.substring(0,p),p=e.substring(h.length+t.length),0<=(c=o.column-n.length-1)&&0<h.length&&i[c]===h[h.length-1]){for(u=h.length-1;i[c]===h[u]&&0!==c&&0!==u;)c--,u--;l=i.substr(c,o.column-n.length-c)}else l="";p=i.substr(o.column,p.length-1+t.length-n.length+1),e.indexOf(p)<0&&(p=""),0<=o.column-n.length&&"("===i[o.column-n.length-1]&&o.column<i.length&&")"===i[o.column]&&")"===p&&(p=""),d+=y(e,l+n+p),0<h.length&&h===l&&(e=e.slice(h.length)),0<p.length&&(e=e.slice(0,e.length-p.length)),0===p.length&&/^\s*$/.test(i.slice(o.column))&&(o=i.substring(0,c),(c<0||0<=c&&!/[\(\)]/.test(o)&&!/^[ \t]*(?:if\b|elif\b)/.test(o))&&(0===m&&r[s]&&(e+=r[s]),0!==m||/\$\{/.test(e)||(e+="\n"),a&&/^\s*$/.test(o)&&(e=a+l+e)))}else i.trim()===n&&(0===m&&r[s]&&(e+=r[s]),0!==m||/\$\{/.test(e)||(e+="\n")),d+=y(e,n);return function(e,t,i){return e.substr(i=i||0,t.length)===t}(t,n)&&(d*=2),d-=t.length/500,[e,d=t===n?10:d]}},2588:function(t,e,i){"use strict";!function(a){function e(e,t,i){var n=e||"";n&&(0<n.indexOf(",")&&(e=n.indexOf(","),n=n.slice(e+1)+" "+n.slice(0,e)),n=(n=(n=n.toLowerCase()).replace(/[.'"]/gi," ")).replace(/\s{2,}/g," ")),this.DEBUG=t||!1,this.DEBUG_AREA=i,this.nameSource=n,this.nameSourceLength=this.nameSource.length+1,this.nameSourceScore=0,this._reset()}e.prototype={_reset:function(e){e=(e=e||"")&&(e=(e=e.toLowerCase()).replace(/[.,'"]/gi,"")).replace(/\s{2,}/g," ");this.nameTarget=e,this.nameTargetLength=this.nameTarget.length+1,this.nameTargetScore=0,this.dynamicMatrix=[],this.maxMatrixValue=0,this.overallScore=0,this.finalScore=0},characterMatrix:["a0004000000000400000000000","0a000000000000000000000000","00a00000004000002000000000","000a0000000000000002000000","4000a000000000000000000020","00000a00000000020000020000","000000a0000000000000000000","0000000a040000000000000000","00000000a20400000000000020","000000042a0000000000000040","0040000000a000002000000000","00000000400a00000000000000","000000000000a4000000000000","0000000000004a000000000000","40000000000000a00000000000","000002000000000a0000000000","0020000000200000a000000000","00000000000000000a00000000","000000000000000000a0000000","0002000000000000000a000000","00000000000000000000a00000","000002000000000000000a4000","0000000000000000000004a000","00000000000000000000000a00","000020002400000000000000a0","0000000000000000002000000a","00000000000000400000000000","00000000400400000000000000","00000000000000000100000002","00002000000000000000000001","20000002000000000000000000","00000000000000000020000000","01000010000000000000000000","00000000100100000002000000","01000000000000000000000000","00000020000000000000000000"],charMatrixDictionary:{a:0,b:1,c:2,d:3,e:4,f:5,g:6,h:7,i:8,j:9,k:10,l:11,m:12,n:13,o:14,p:15,q:16,r:17,s:18,t:19,u:20,v:21,w:22,x:23,y:24,z:25,0:26,1:27,2:28,3:29,4:30,5:31,6:32,7:33,8:34,9:35},_characterScore:function(e,t){var i,n,o;return e&&t?e==t?10:(n=this.charMatrixDictionary[e],o=this.charMatrixDictionary[t],n&&o?(i=this.characterMatrix[n][o],parseInt(i,16)||-4):-4):-4},_gappedScore:function(e,t){return" "==e||" "==t?-3:-4},_transposedScore:function(e,t){return-2},_buildMatrix:function(){for(var e,t,i,n=[],o=0;o<this.nameTargetLength;o++)n.push(0);for(var s=0;s<this.nameSourceLength;s++)this.dynamicMatrix.push(n.slice(0));for(s=1;s<this.nameSourceLength;s++)for(o=1;o<this.nameTargetLength;o++)e=this.nameSource[s-1],t=this.nameTarget[o-1],i=this._gappedScore(e,t),this.dynamicMatrix[s][o]=Math.max(this.dynamicMatrix[s-1][o-1]+this._characterScore(e,t),0,this.dynamicMatrix[s-1][o]+i,this.dynamicMatrix[s][o-1]+i),this.dynamicMatrix[s-1][o]>this.dynamicMatrix[s-1][o-1]&&this.dynamicMatrix[s][o-1]>this.dynamicMatrix[s-1][o-1]&&(this.dynamicMatrix[s-1][o-1]=Math.max(this.dynamicMatrix[s-1][o],this.dynamicMatrix[s][o-1]),this.dynamicMatrix[s][o]=Math.max(this.dynamicMatrix[s-1][o-1]+this._transposedScore(e,t),this.dynamicMatrix[s][o]))},_backtrack:function(){for(var e=0,t=0,i=this.nameTargetLength-1;0<i&&(this.dynamicMatrix[this.nameSourceLength-1][i]>e&&(e=this.dynamicMatrix[this.nameSourceLength-1][i],t=i),!(0<e&&0==this.dynamicMatrix[this.nameSourceLength-1][i+1]));i--);if(e<=0)return!1;for(var n,o,s,i=t,r=this.nameSourceLength-1;0<r&&0<i;)this.dynamicMatrix[r][i]>this.maxMatrixValue&&(this.maxMatrixValue=this.dynamicMatrix[r][i]),this.DEBUG&&a("#"+this.DEBUG_AC+"-"+(r+1)+"-"+(i+1)).css("background-color","#ccc"),n=this.dynamicMatrix[r-1][i-1],o=this.dynamicMatrix[r][i-1],s=this.dynamicMatrix[r-1][i],o<=n&&s<=n?(r--,i--):n<=o&&s<=o?i--:n<=s&&o<=s&&r--,0==n&&0==o&&0==s&&(i=r=0);return!0},_finalMatchScore:function(){var e=(this.nameSourceLength+this.nameTargetLength)/2;this.overallScore=2*this.maxMatrixValue/e,this.finalScore=this.overallScore/10},_debug_ShowDVtable:function(){var e,t="";DEBUG_AC=Math.round(9999*Math.random()),this.DEBUG_AC=DEBUG_AC,t+='<table class="example">';for(var i=0;i<=this.nameSourceLength;i++){t+="<tr>";for(var n=0;n<=this.nameTargetLength;n++)0==i?t+=1<n?'<td id="'+DEBUG_AC+"-"+i+"-"+n+'">'+this.nameTarget[n-2]+"</td>":'<td id="'+DEBUG_AC+"-"+i+"-"+n+'"></td>':0<n?(e=Math.round(100*this.dynamicMatrix[i-1][n-1])/100,t+='<td id="'+DEBUG_AC+"-"+i+"-"+n+'">'+e+"</td>"):t+=1<i?'<td id="'+DEBUG_AC+"-"+i+"-"+n+'">'+this.nameSource[i-2]+"</td>":'<td id="'+DEBUG_AC+"-"+i+"-"+n+'"></td>';t+="</tr>"}t+="</table>",a(this.DEBUG_AREA).append(t)},score:function(e){return this._reset(e),this._buildMatrix(),this.DEBUG&&this._debug_ShowDVtable(),this._backtrack(),this._finalMatchScore(),this.finalScore},topMatchesFromArray:function(e,t){for(var i,n=t||10,o=[],s=0;s<n;++s)o.push({v:0,n:"-"});for(s=0;s<e.length;s++)if((i=this.score(allNames[s]))>o[n-1].v){newObj={v:i,n:e[s]},tmpObj={v:0,n:""};for(var r=0;r<n;++r)newObj.v>o[r].v&&(tmpObj.v=o[r].v,tmpObj.n=o[r].n,o[r].v=newObj.v,o[r].n=newObj.n,newObj.v=tmpObj.v,newObj.n=tmpObj.n)}for(s=0;s<o.length;s++)tmp=o[s],o[s]=tmp.n;return o}},t.exports=e}.call(this,i(3))},2589:function(d,e,m){!function(s,n){var e,t,i,o,r,a,l,c=function(e,t){return function(){return e.apply(t,arguments)}},h={}.hasOwnProperty,u=[].indexOf||function(e){for(var t=0,i=this.length;t<i;t++)if(t in this&&this[t]===e)return t;return-1};function p(e){this.onSwitchTeam=c(this.onSwitchTeam,this),this.otherTeam=c(this.otherTeam,this),this.attachTransitionEventListener=c(this.attachTransitionEventListener,this),this.hintsState=e.hintsState,this.spell=e.spell,this.courseInstanceID=e.courseInstanceID,this.courseID=e.courseID,p.__super__.constructor.call(this,e)}m(2590),a=m(2592),o=m(2593),e=m(26),i=m(1931),l=m(6),t=m(1556),r=m(52),d.exports=(function(e,t){for(var i in t)h.call(t,i)&&(e[i]=t[i]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(p,e),p.prototype.template=a,p.prototype.id="spell-top-bar-view",p.prototype.controlsEnabled=!0,p.prototype.subscriptions={"level:disable-controls":"onDisableControls","level:enable-controls":"onEnableControls","tome:spell-loaded":"onSpellLoaded","tome:spell-changed":"onSpellChanged","tome:spell-changed-language":"onSpellChangedLanguage","tome:toggle-maximize":"onToggleMaximize"},p.prototype.events={"click .reload-code":"onCodeReload","click .beautify-code":"onBeautifyClick","click .fullscreen-code":"onToggleMaximize","click .hints-button":"onClickHintsButton","click .image-gallery-button":"onClickImageGalleryButton","click .videos-button":"onClickVideosButton","click #fill-solution":"onFillSolution","click #switch-team":"onSwitchTeam"},p.prototype.getRenderData=function(e){var t,i;return e=p.__super__.getRenderData.call(this,e=null==e?{}:e),t=this.isMac()?"Cmd":"Ctrl",i=s.i18n.t("keyboard_shortcuts.shift"),e.beautifyShortcutVerbose=t+"+"+i+"+B: "+s.i18n.t("keyboard_shortcuts.beautify"),e.maximizeShortcutVerbose=t+"+"+i+"+M: "+s.i18n.t("keyboard_shortcuts.maximize_editor"),e.codeLanguage=this.options.codeLanguage,e.showAmazonLogo="game-dev-hoc"===n.getHocCampaign(),e},p.prototype.afterRender=function(){return p.__super__.afterRender.call(this),this.attachTransitionEventListener(),this.$('[data-toggle="popover"]').popover()},p.prototype.showVideosButton=function(){return me.isStudent()&&this.courseID===l.courseIDs.INTRODUCTION_TO_COMPUTER_SCIENCE},p.prototype.onDisableControls=function(e){return this.toggleControls(e,!1)},p.prototype.onEnableControls=function(e){return this.toggleControls(e,!0)},p.prototype.onClickImageGalleryButton=function(e){return this.openModalView(new i)},p.prototype.onClickHintsButton=function(){var e;if(null!=this.hintsState)return this.hintsState.set("hidden",!this.hintsState.get("hidden")),null!=(e=window.tracker)?e.trackEvent("Hints Clicked",{category:"Students",levelSlug:this.options.level.get("slug"),hintCount:null!=(e=null!=(e=this.hintsState.get("hints"))?e.length:void 0)?e:0},[]):void 0},p.prototype.onClickVideosButton=function(){return this.openModalView(new t({courseInstanceID:this.courseInstanceID,courseID:this.courseID}))},p.prototype.onFillSolution=function(){if(me.canAutoFillCode())return r.dispatch("game/autoFillSolution",this.options.codeLanguage)},p.prototype.onCodeReload=function(e){return key.shift?Backbone.Mediator.publish("level:restart",{}):this.openModalView(new o)},p.prototype.onBeautifyClick=function(e){if(this.controlsEnabled)return Backbone.Mediator.publish("tome:spell-beautify",{spell:this.spell})},p.prototype.onToggleMaximize=function(e){return s("html").hasClass("fullscreen-editor")||s("#code-area").css("z-index",20),s("html").toggleClass("fullscreen-editor"),s(".fullscreen-code").toggleClass("maximized"),Backbone.Mediator.publish("tome:maximize-toggled",{})},p.prototype.updateReloadButton=function(){var e=this.spell.hasChanged(null,this.spell.getSource());return this.$el.find(".reload-code").css("display",e?"inline-block":"none")},p.prototype.onSpellLoaded=function(e){if(e.spell===this.spell)return this.updateReloadButton()},p.prototype.onSpellChanged=function(e){if(e.spell===this.spell)return this.updateReloadButton()},p.prototype.onSpellChangedLanguage=function(e){if(e.spell===this.spell)return this.options.codeLanguage=e.language,this.render(),this.updateReloadButton()},p.prototype.toggleControls=function(e,t){if((!e.controls||0<=u.call(e.controls,"editor"))&&t!==this.controlsEnabled)return this.controlsEnabled=t,this.$el.toggleClass("read-only",!t)},p.prototype.attachTransitionEventListener=function(){var e,t,i="",n=document.createElement("fakeelement"),o={transition:"transitionend",OTransition:"oTransitionEnd",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"};for(t in o)if(void 0!==n.style[t]){i=o[t];break}return(e=s("#code-area")).on(i,function(){if(!s("html").hasClass("fullscreen-editor"))return e.css("z-index",2)})},p.prototype.otherTeam=function(){return _.without(["humans","ogres"],this.options.spell.team)[0]},p.prototype.onSwitchTeam=function(){var e=window.location.protocol+"//",t=window.location.host,i=window.location.pathname,n=window.location.search;return(n=n.replace(/team=[^&]*&?/,""))?n.endsWith("?")||n.endsWith("&")?n+="team=":n+="&team=":n="?team=",window.location.href=e+t+i+n+this.otherTeam()},p.prototype.destroy=function(){return p.__super__.destroy.call(this)},p)}.call(this,m(3),m(17))},2590:function(e,t,i){var n=i(2591);(n="string"==typeof n?[[e.i,n,""]]:n).locals&&(e.exports=n.locals);(0,i(21).default)("77d9e2d1",n,!0,{})},2591:function(e,t,i){},2592:function(e,t,i){var c=i(11);e.exports=function(e){var l=[],e=e||{};return function(e,t,i,n,o,s,r,a){s&&l.push('<img id="amazon-level-logo" src="/images/pages/play/amazon_horz_lockup.png">'),l.push('<div class="hinge hinge-0"></div><div class="hinge hinge-1"></div><div class="hinge hinge-2"></div><div class="hinge hinge-3"></div><div class="spell-tool-buttons"><div data-i18n="[title]play_level.tome_reload_method" class="btn btn-small btn-illustrated btn-warning reload-code"><div class="glyphicon glyphicon-repeat"></div></div>'),15<=o.level()&&l.push("<div"+c.attr("title",n,!0,!0)+' class="btn btn-small btn-illustrated fullscreen-code"><div class="glyphicon glyphicon-fullscreen"></div><div class="glyphicon glyphicon-resize-small"></div></div>'),"javascript"===t&&15<=o.level()&&l.push("<div"+c.attr("title",e,!0,!0)+' class="btn btn-small btn-illustrated beautify-code"><div class="glyphicon glyphicon-magnet"></div></div>'),a.options.level.isType("ladder")&&(e=a.otherTeam(),l.push('<button id="switch-team"'+c.cls(["btn btn-small btn-illustrated "+("ogres"==e?"btn-primary":"btn-danger")],[!0])+"><span"+c.attr("data-i18n","play_level.play_as_"+e,!0,!0)+"></span></button>")),o.canAutoFillCode()&&l.push('<button id="fill-solution" class="btn btn-small btn-illustrated btn-success"><span data-i18n="play_level.fill_in_solution"></span></button>'),a.hintsState&&0<a.hintsState.get("total")&&l.push('<div class="btn btn-small btn-illustrated hints-button"><span data-i18n="play_level.hints"></span></div>'),a.showVideosButton()&&l.push('<div class="btn btn-small btn-illustrated btn-success videos-button"><span data-i18n="play_level.videos"></span></div>'),a.options.level.isType("web-dev")&&l.push('<div class="btn btn-small btn-illustrated image-gallery-button"><span data-i18n="web_dev.image_gallery_title"></span></div>'),a.options.level.get("shareable")&&(i=a.options.level.isType("game-dev")?"sharing.game":"sharing.webpage",a.options.session.isFake()?l.push("<button"+c.attr("data-i18n",i,!0,!0)+' data-toggle="popover" data-placement="bottom"'+c.attr("data-content",r("sharing.your_students_preview"),!0,!0)+' data-trigger="hover" class="btn btn-small btn-illustrated"></button>'):(r="/play/"+a.options.level.get("type")+"-level/"+a.options.level.get("slug")+"/"+a.options.session.id,a.options.courseID&&(r+="?course="+a.options.courseID,a.options.courseInstanceID&&(r+="&course-instance="+a.options.courseInstanceID)),l.push("<a"+c.attr("href",r,!0,!0)+c.attr("data-i18n",i,!0,!0)+' class="btn btn-small btn-illustrated"></a>'))),l.push('<div class="clearfix"></div></div>')}.call(this,"beautifyShortcutVerbose"in e?e.beautifyShortcutVerbose:"undefined"!=typeof beautifyShortcutVerbose?beautifyShortcutVerbose:void 0,"codeLanguage"in e?e.codeLanguage:"undefined"!=typeof codeLanguage?codeLanguage:void 0,"i18nName"in e?e.i18nName:"undefined"!=typeof i18nName?i18nName:void 0,"maximizeShortcutVerbose"in e?e.maximizeShortcutVerbose:"undefined"!=typeof maximizeShortcutVerbose?maximizeShortcutVerbose:void 0,"me"in e?e.me:"undefined"!=typeof me?me:void 0,"showAmazonLogo"in e?e.showAmazonLogo:"undefined"!=typeof showAmazonLogo?showAmazonLogo:void 0,"translate"in e?e.translate:"undefined"!=typeof translate?translate:void 0,"view"in e?e.view:"undefined"!=typeof view?view:void 0),l.join("")}},2593:function(e,t,i){var n,o={}.hasOwnProperty;function s(){return s.__super__.constructor.apply(this,arguments)}n=i(80),i=i(2594),e.exports=(function(e,t){for(var i in t)o.call(t,i)&&(e[i]=t[i]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(s,n),s.prototype.id="#reload-level-modal",s.prototype.template=i,s.prototype.events={"click #restart-level-confirm-button":"onClickRestart"},s.prototype.onClickRestart=function(e){return this.playSound("menu-button-click"),Backbone.Mediator.publish("level:restart",{})},s)},2594:function(e,t,i){i(11);e.exports=function(e){var t=[],e=e||{};return function(e){t.push('<div class="modal-dialog game"><div class="background-wrapper"><div class="modal-content"><div class="modal-header">'),e.closeButton&&t.push('<div type="button" data-dismiss="modal" aria-hidden="true" class="button close">&times;</div>'),t.push('<h3 data-i18n="play_level.reload_title">Reload All Code?</h3></div><div class="modal-body"><p data-i18n="play_level.reload_really">Are you sure you want to reload this level back to the beginning?</p></div><div class="modal-body wait secret"><h3>Reticulating Splines...</h3><div class="progress progress-striped active"><div class="progress-bar"></div></div></div><div class="modal-footer"><a href="#" data-dismiss="modal" aria-hidden="true" data-i18n="modal.close" class="btn">Close</a><a href="#" data-dismiss="modal" aria-hidden="true" data-i18n="play_level.reload_confirm" id="restart-level-confirm-button" class="btn btn-primary">Reload All</a></div></div></div></div>')}.call(this,"view"in e?e.view:"undefined"!=typeof view?view:void 0),t.join("")}},2595:function(e,t,i){var n=i(2596);(n="string"==typeof n?[[e.i,n,""]]:n).locals&&(e.exports=n.locals);(0,i(21).default)("0960425e",n,!0,{})},2596:function(e,t,i){},2597:function(a,e,l){!function(n){var e,t,i,o=function(e,t){return function(){return e.apply(t,arguments)}},s={}.hasOwnProperty;function r(e){this.onClick=o(this.onClick,this),this.onPaletteClicked=o(this.onPaletteClicked,this),r.__super__.constructor.call(this,e),this.thang=e.thang,this.docFormatter=new t(e),this.doc=this.docFormatter.doc,this.doc.initialHTML=this.docFormatter.formatPopover(),this.aceEditors=[]}e=l(26),i=l(2598),l(44).me,l(1741),t=l(2229),l(1383),l(6),a.exports=(function(e,t){for(var i in t)s.call(t,i)&&(e[i]=t[i]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(r,e),r.prototype.tagName="div",r.prototype.className="spell-palette-entry-view",r.prototype.template=i,r.prototype.popoverPinned=!1,r.prototype.overridePopoverTemplate='<div class="popover spell-palette-popover" role="tooltip"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>',r.prototype.subscriptions={"surface:frame-changed":"onFrameChanged","tome:palette-hovered":"onPaletteHovered","tome:palette-clicked":"onPaletteClicked","tome:palette-pin-toggled":"onPalettePinToggled","tome:spell-debug-property-hovered":"onSpellDebugPropertyHovered"},r.prototype.events={mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",click:"onClick"},r.prototype.afterRender=function(){return r.__super__.afterRender.call(this),this.$el.addClass(_.string.slugify(this.doc.type))},r.prototype.resetPopoverContent=function(){},r.prototype.onMouseEnter=function(e){this.popoverPinned||this.otherPopoverPinned},r.prototype.onMouseLeave=function(e){},r.prototype.togglePinned=function(){var e;return this.popoverPinned?(this.popoverPinned=!1,this.$el.add(".spell-palette-popover.popover").removeClass("pinned"),n(".spell-palette-popover.popover .close").remove(),this.$el.popover("hide"),this.playSound("spell-palette-entry-unpin")):(this.popoverPinned=!0,this.resetPopoverContent(),this.$el.add(".spell-palette-popover.popover").addClass("pinned"),this.$el.popover("show"),e=n('<button type="button" data-dismiss="modal" aria-hidden="true" class="close"></button>'),n(".spell-palette-popover.popover").append(e),e.on("click",this.onClick),this.playSound("spell-palette-entry-pin")),Backbone.Mediator.publish("tome:palette-pin-toggled",{entry:this,pinned:this.popoverPinned})},r.prototype.onPaletteClicked=function(e){return this.$el.toggleClass("selected",e.prop===this.doc.name)},r.prototype.onClick=function(e){if(!key.shift)return Backbone.Mediator.publish("tome:palette-clicked",{thang:this.thang,prop:this.doc.name,entry:this});Backbone.Mediator.publish("tome:insert-snippet",{doc:this.options.doc,language:this.options.language,formatted:this.doc})},r.prototype.onFrameChanged=function(e){var t;if((null!=(t=e.selectedThang)?t.id:void 0)===(null!=(t=this.thang)?t.id:void 0))return this.options.thang=this.thang=this.docFormatter.options.thang=e.selectedThang},r.prototype.onPaletteHovered=function(e){if(e.entry!==this)return this.popoverPinned?this.togglePinned():void 0},r.prototype.onPalettePinToggled=function(e){if(e.entry!==this)return this.otherPopoverPinned=e.pinned},r.prototype.onSpellDebugPropertyHovered=function(e){e=e.property===this.doc.name&&e.owner===this.doc.owner;return e&&!this.debugHovered?(this.debugHovered=!0,this.popoverPinned||this.togglePinned()):this.debugHovered&&!e&&(this.debugHovered=!1,this.popoverPinned&&this.togglePinned()),null},r.prototype.destroy=function(){var e,t,i;for(this.popoverPinned&&n(".popover.pinned").remove(),this.popoverPinned&&this.togglePinned(),this.$el.popover("destroy"),this.$el.off(),e=0,t=(i=this.aceEditors).length;e<t;e++)i[e].destroy();return r.__super__.destroy.call(this)},r)}.call(this,l(3))},2598:function(e,t,i){var n=i(11);e.exports=function(e){var t,i=[],e=e||{};return function(e){i.push("<span"+n.attr("data-property-name",e.doc.name,!0,!0)+' class="doc-title">'+n.escape(null==(t=e.doc.title)?"":t)+"</span>")}.call(this,"view"in e?e.view:"undefined"!=typeof view?view:void 0),i.join("")}},2599:function(e,t,i){var n,o,s,r,a=function(e,t){return function(){return e.apply(t,arguments)}},l={}.hasOwnProperty;function c(e){var t,i,n;this.onClick=a(this.onClick,this),this.onPaletteClicked=a(this.onPaletteClicked,this),c.__super__.constructor.call(this,e),this.thang=e.thang,i=null!=e.doc.example?null!=(n=e.doc.example)?n[e.language]:void 0:'# usage code \ngame.spawnXY("'+e.buildableName+'", 21, 20)',t=r.i18n(e.doc,"description"),n=r.i18n(e.doc,"name"),this.doc={name:e.buildableName,initialHTML:o({_:_,marked:marked,doc:{shortName:e.doc.name,translatedShortName:n!==e.doc.name?n:void 0,type:"spawnable",description:"!["+this.thang.get("name")+"]("+this.thang.getPortraitURL()+") "+t,example:i}}),example:i}}n=i(26),s=i(2600),o=i(2230),i(44).me,i(1741),i(2229),r=i(6),e.exports=(function(e,t){for(var i in t)l.call(t,i)&&(e[i]=t[i]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(c,n),c.prototype.tagName="div",c.prototype.className="spell-palette-thang-entry-view",c.prototype.template=s,c.prototype.subscriptions={"surface:frame-changed":"onFrameChanged","tome:palette-hovered":"onPaletteHovered","tome:palette-clicked":"onPaletteClicked","tome:spell-debug-property-hovered":"onSpellDebugPropertyHovered"},c.prototype.events={mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",click:"onClick"},c.prototype.afterRender=function(){return c.__super__.afterRender.call(this)},c.prototype.resetPopoverContent=function(){},c.prototype.onMouseEnter=function(e){this.popoverPinned||this.otherPopoverPinned},c.prototype.onMouseLeave=function(e){},c.prototype.onPaletteClicked=function(e){return this.$el.toggleClass("selected",e.prop===this.doc.name)},c.prototype.onClick=function(e){if(!key.shift)return Backbone.Mediator.publish("tome:palette-clicked",{thang:this.thang,prop:this.doc.name,entry:this});Backbone.Mediator.publish("tome:insert-snippet",{doc:this.options.doc,language:this.options.language,formatted:this.doc})},c.prototype.onFrameChanged=function(e){},c.prototype.onPaletteHovered=function(e){e.entry},c.prototype.onSpellDebugPropertyHovered=function(e){e=e.property===this.doc.name&&e.owner===this.doc.owner;return e&&!this.debugHovered?(this.debugHovered=!0,this.popoverPinned||this.togglePinned()):this.debugHovered&&!e&&(this.debugHovered=!1,this.popoverPinned&&this.togglePinned()),null},c.prototype.destroy=function(){var e,t,i;for(this.$el.off(),e=0,t=(i=this.aceEditors).length;e<t;e++)i[e].destroy();return c.__super__.destroy.call(this)},c)},2600:function(e,t,i){var n=i(11);e.exports=function(e){var t=[],e=e||{};return function(e){t.push("\x3c!--span.doc-title(data-property-name=view.doc.name)= view.doc.title--\x3e<img"+n.attr("src",e.thang.getPortraitURL(),!0,!0)+">")}.call(this,"view"in e?e.view:"undefined"!=typeof view?view:void 0),t.join("")}},2601:function(e,t,i){var c=i(11);e.exports=function(e){var r,a=[],l={},e=e||{};return function(n,e,o,s,t,i){l.header=r=function(e,t){this&&this.block,this&&this.attributes;var i=s("apis."+n.string.slugify(t).replace("-","_"));a.push('<a role="button"'+c.attr("id","#palette-header-"+n.string.slugify(e),!0,!0)+c.attr("data-panel","#palette-tab-"+n.string.slugify(e),!0,!0)+' class="section-header btn btn-small btn-illustrated btn-warning">'),t.toLocaleLowerCase()==i.toLocaleLowerCase()||-1!=["Methods","Events","Spawnable"].indexOf(t)?a.push("<span>"+c.escape(null==(r=i)?"":r)+"</span>"):a.push("<span>"+c.escape(null==(r=t+" ("+i+")")?"":r)+"</span>"),"api-area"==e||"stuff-area"==e?a.push('<div style="float: right" class="glyphicon glyphicon-chevron-down"></div>'):a.push('<div style="float: right" class="glyphicon glyphicon-chevron-right"></div>'),a.push("</a>")},a.push('<div class="container"><div class="left nano"><div id="spell-palette-api-bar" class="nano-content panel-group">'),"web-dev"==i.level.get("type")?l.header("api-area","HTML"):l.header("api-area","Methods"),a.push('<div id="palette-tab-api-area" class="apis panel-collapse collapse in"><div class="properties properties-this"></div></div>'),o&&function(){var e=o;if("number"==typeof e.length)for(var t=0,i=e.length;t<i;t++){e[t];l.header(t,t),a.push("<div"+c.attr("id","palette-tab-"+n.string.slugify(t),!0,!0)+' class="panel-collapse collapse"><div'+c.cls(["properties properties-"+n.string.slugify(t)],[!0])+"></div></div>")}else{i=0;for(t in e){i++;e[t];l.header(t,t),a.push("<div"+c.attr("id","palette-tab-"+n.string.slugify(t),!0,!0)+' class="panel-collapse collapse"><div'+c.cls(["properties properties-"+n.string.slugify(t)],[!0])+"></div></div>")}}}.call(this),l.header("events","Events"),a.push('<div id="palette-tab-events" class="apis panel-collapse collapse"></div>'),l.header("handlers","Handlers"),a.push('<div id="palette-tab-handlers" class="apis panel-collapse collapse"></div>'),l.header("properties","Properties"),a.push('<div id="palette-tab-properties" class="apis panel-collapse collapse"></div>'),l.header("snippets","Snippets"),a.push('<div id="palette-tab-snippets" class="apis panel-collapse collapse"></div>'),l.header("stuff-area","Spawnable"),a.push('<div id="palette-tab-stuff-area" class="apis panel-collapse collapse in"></div></div></div><div class="right"><div class="closeBtn btn btn-illustrated btn-danger"><span class="glyphicon glyphicon-remove"></span></div>'),e?a.push('<div class="scrollArea always-scroll-y"><div class="scrollableArea"><div class="rightContentTarget content"></div></div></div>'):a.push('<div class="scrollArea"><div class="scrollableArea"><div class="rightContentTarget content"></div></div></div>'),a.push("</div></div>")}.call(this,"_"in e?e._:"undefined"!=typeof _?_:void 0,"isIE"in e?e.isIE:"undefined"!=typeof isIE?isIE:void 0,"tabs"in e?e.tabs:"undefined"!=typeof tabs?tabs:void 0,"translate"in e?e.translate:"undefined"!=typeof translate?translate:void 0,"undefined"in e?e.undefined:void 0,"view"in e?e.view:"undefined"!=typeof view?view:void 0),a.join("")}},2602:function(h,e,u){!function(o){var e,s,t,n,r,i,a=function(e,t){return function(){return e.apply(t,arguments)}},l={}.hasOwnProperty;function c(e){this.updateReplayability=a(this.updateReplayability,this),c.__super__.constructor.call(this,e),this.spells=e.spells,this.castShortcut="",this.updateReplayabilityInterval=setInterval(this.updateReplayability,1e3),this.observing=e.session.get("creator")!==r.id,this.options.level.get("mirrorMatch")&&this.loadMirrorSession(),this.mirror=null!=this.mirrorSession,this.autoSubmitsToLadder=this.options.level.isType("course-ladder"),e.session.get("published")&&Backbone.Mediator.publish("level:show-victory",{showModal:!0,manual:!1})}u(2603),e=u(26),i=u(2605),r=u(44).me,s=u(1683),t=u(1375),n=u(1908),h.exports=(function(e,t){for(var i in t)l.call(t,i)&&(e[i]=t[i]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(c,e),c.prototype.id="cast-button-view",c.prototype.template=i,c.prototype.events={"click .cast-button":"onCastButtonClick","click .submit-button":"onCastRealTimeButtonClick","click .done-button":"onDoneButtonClick","click .game-dev-play-btn":"onClickGameDevPlayButton"},c.prototype.subscriptions={"tome:spell-changed":"onSpellChanged","tome:cast-spells":"onCastSpells","tome:manual-cast-denied":"onManualCastDenied","god:new-world-created":"onNewWorld","goal-manager:new-goal-states":"onNewGoalStates","god:goals-calculated":"onGoalsCalculated","playback:ended-changed":"onPlaybackEndedChanged"},c.prototype.destroy=function(){return clearInterval(this.updateReplayabilityInterval),c.__super__.destroy.call(this)},c.prototype.afterRender=function(){var e,t,i,n;for(n in c.__super__.afterRender.call(this),this.castButton=o(".cast-button",this.$el),e=this.spells)null!=(t=e[n].view)&&t.createOnCodeChangeHandlers();return(this.options.level.get("hidesSubmitUntilRun")||this.options.level.get("hidesRealTimePlayback")||this.options.level.isType("web-dev"))&&this.$el.find(".submit-button").hide(),null!=(i=this.options.session.get("state"))&&i.complete&&(this.options.level.get("hidesRealTimePlayback")||this.options.level.isType("web-dev"))&&this.$el.find(".done-button").show(),"course-thornbush-farm"!==(i=this.options.level.get("slug"))&&"thornbush-farm"!==i||this.$el.find(".submit-button").hide(),this.updateReplayability(),this.updateLadderSubmissionViews()},c.prototype.attachTo=function(e){return this.$el.detach().prependTo(e.toolbarView.$el).show()},c.prototype.castShortcutVerbose=function(){return o.i18n.t("keyboard_shortcuts.shift")+"+"+o.i18n.t("keyboard_shortcuts.enter")},c.prototype.castVerbose=function(){return this.castShortcutVerbose()+": "+o.i18n.t("keyboard_shortcuts.run_code")},c.prototype.castRealTimeVerbose=function(){return(this.isMac()?"Cmd":"Ctrl")+"+"+this.castShortcutVerbose()+": "+o.i18n.t("keyboard_shortcuts.run_real_time")},c.prototype.onCastButtonClick=function(e){return Backbone.Mediator.publish("tome:manual-cast",{realTime:!1})},c.prototype.onCastRealTimeButtonClick=function(e){var t;return this.options.level.get("replayable")&&0<(t=this.options.session.timeUntilResubmit())?Backbone.Mediator.publish("tome:manual-cast-denied",{timeUntilResubmit:t}):Backbone.Mediator.publish("tome:manual-cast",{realTime:!0}),this.updateReplayability()},c.prototype.onClickGameDevPlayButton=function(){return Backbone.Mediator.publish("tome:manual-cast",{realTime:!0})},c.prototype.onDoneButtonClick=function(e){var t;if(!this.options.level.hasLocalChanges())return this.options.session.recordScores(null!=(t=this.world)?t.scores:void 0,this.options.level),Backbone.Mediator.publish("level:show-victory",{showModal:!0,manual:!0})},c.prototype.onSpellChanged=function(e){return this.updateCastButton()},c.prototype.onCastSpells=function(e){if(!e.preload)return this.casting=!0,this.hasStartedCastingOnce&&(this.options.level.isType("game-dev")||this.playSound("cast",.5)),this.hasStartedCastingOnce=!0,this.updateCastButton()},c.prototype.onManualCastDenied=function(e){e=moment().add(e.timeUntilResubmit,"ms").fromNow();return noty({text:"You can try again "+e+".",layout:"center",type:"warning",killer:!1,timeout:6e3})},c.prototype.onNewWorld=function(e){var t,i;return this.casting=!1,this.hasCastOnce&&(this.options.level.isType("game-dev")||this.playSound("cast-end",.5),t="ogres"===r.team?"Hero Placeholder 1":"Hero Placeholder",(this.autoSubmitsToLadder||this.options.level.isType("ladder")&&!this.options.session.get("submitDate")&&!this.autosubmittedOnce)&&!(null!=(t=e.world.thangMap[t])&&t.errorsOut||r.get("anonymous"))&&(this.autosubmittedOnce=!0,this.ladderSubmissionView&&_.delay((i=this,function(){var e;return null!=(e=i.ladderSubmissionView)?e.rankSession():void 0}),1e3))),this.hasCastOnce=!0,this.updateCastButton(),this.world=e.world},c.prototype.onNewGoalStates=function(e){var e="success"===e.overallStatus;if(this.winnable!==e)return this.winnable=e,this.$el.toggleClass("winnable",this.winnable),Backbone.Mediator.publish("tome:winnability-updated",{winnable:this.winnable,level:this.options.level}),"resource-tycoon"===this.options.level.get("slug")?null:this.options.level.get("hidesRealTimePlayback")||this.options.level.isType("web-dev","game-dev")?this.$el.find(".done-button").toggle(this.winnable):!this.winnable||"course-thornbush-farm"!==(e=this.options.level.get("slug"))&&"thornbush-farm"!==e?void 0:this.$el.find(".submit-button").show()},c.prototype.onGoalsCalculated=function(e){var t;if(e.god===this.god&&e.preload&&!this.options.level.get("hidesRealTimePlayback")&&"course-thornbush-farm"!==(t=this.options.level.get("slug"))&&"thornbush-farm"!==t)return this.onNewGoalStates(e)},c.prototype.onPlaybackEndedChanged=function(e){if(e.ended&&this.winnable)return this.$el.toggleClass("has-seen-winning-replay",!0)},c.prototype.updateCastButton=function(){var i;if(!_.some(this.spells,function(e){return!e.loaded}))return n.some(_.values(this.spells),function(e,t){return e.hasChangedSignificantly(e.getSource(),null,t)},(i=this,function(e){var t;return Backbone.Mediator.publish("tome:spell-has-changed-significantly-calculation",{hasChangedSignificantly:e}),i.castButton.toggleClass("castable",e).toggleClass("casting",i.casting),i.casting?t=o.i18n.t("play_level.tome_cast_button_running"):(t=o.i18n.t("play_level.tome_cast_button_run"),i.options.level.get("hidesRunShortcut")||(t+=" "+i.castShortcut)),i.castButton.text(t),null!=(t=i.ladderSubmissionView)?t.updateButton():void 0}))},c.prototype.updateReplayability=function(){var e,t,i;if(!this.destroyed&&this.options.level.get("replayable"))return e=0<(i=this.options.session.timeUntilResubmit()),t=this.$el.find(".submit-button").toggleClass("disabled",e).find(".submit-again-time").toggleClass("secret",!e),e?(i=moment().add(i,"ms").fromNow(),t.text(i)):void 0},c.prototype.loadMirrorSession=function(){var e="/db/level/"+(this.options.level.get("slug")||this.options.level.id)+"/session";return e+="?team="+("humans"===r.team?"ogres":"humans"),e=(new t).setURL(e),this.mirrorSession=this.supermodel.loadModel(e,{cache:!1}).model,this.listenToOnce(this.mirrorSession,"sync",function(){var e;return null!=(e=this.ladderSubmissionView)?e.mirrorSession=this.mirrorSession:void 0})},c.prototype.updateLadderSubmissionViews=function(){var e,t,i,n=this.subviews;for(e in n)(i=n[e])instanceof s&&this.removeSubView(i);if((t=this.$el.find(".ladder-submission-view")).length)return this.ladderSubmissionView=new s({session:this.options.session,level:this.options.level,mirrorSession:this.mirrorSession}),this.insertSubView(this.ladderSubmissionView,t)},c)}.call(this,u(3))},2603:function(e,t,i){var n=i(2604);(n="string"==typeof n?[[e.i,n,""]]:n).locals&&(e.exports=n.locals);(0,i(21).default)("1e7e66eb",n,!0,{})},2604:function(e,t,i){},2605:function(e,t,i){var n=i(11);e.exports=function(e){var i=[],e=e||{};return function(e,t){t.options.level.isType("game-dev")?i.push('<button class="btn btn-lg btn-illustrated btn-success game-dev-play-btn"><span data-i18n="common.play"></span></button><button class="btn btn-lg btn-illustrated btn-success done-button secret"><span data-i18n="play_level.done"></span></button>'):(i.push("<button"+n.attr("title",t.castVerbose(),!0,!0)+' class="btn btn-lg btn-illustrated cast-button"><span data-i18n="play_level.tome_cast_button_ran">Ran</span></button>'),t.observing||(t.mirror||t.options.level.isType("ladder")&&(!e.isAnonymous()||!e.get("hourOfCode"))?i.push('<div class="ladder-submission-view"></div>'):(i.push("<button"+n.attr("title",t.castRealTimeVerbose(),!0,!0)+' class="btn btn-lg btn-illustrated submit-button"><span data-i18n="play_level.tome_submit_button">Submit</span><span class="spl secret submit-again-time"></span></button><button class="btn btn-lg btn-illustrated btn-success done-button secret"><span data-i18n="play_level.done">Done</span></button>'),t.autoSubmitsToLadder&&i.push('<div class="hidden"><div class="ladder-submission-view"></div></div>'))))}.call(this,"me"in e?e.me:"undefined"!=typeof me?me:void 0,"view"in e?e.view:"undefined"!=typeof view?view:void 0),i.join("")}},2606:function(e,t,i){var n=i(2607);(n="string"==typeof n?[[e.i,n,""]]:n).locals&&(e.exports=n.locals);(0,i(21).default)("c1700416",n,!0,{})},2607:function(e,t,i){},2608:function(e,t,i){i(11);e.exports=function(e){var t=[];return t.push('<div class="closed-chat-area"><table><tbody></tbody></table></div><div class="open-chat-area secret"><table><tbody></tbody></table></div><textarea></textarea><i class="icon-comment icon-white"></i>'),t.join("")}},2609:function(e,t,i){var n=i(2610);(n="string"==typeof n?[[e.i,n,""]]:n).locals&&(e.exports=n.locals);(0,i(21).default)("6cd192bf",n,!0,{})},2610:function(e,t,i){},2611:function(e,t,i){i(11);e.exports=function(e){var t=[];return t.push('<div class="wood-background"></div><div class="hinge hinge-0"></div><div class="hinge hinge-1"></div><div class="hinge hinge-2"></div><div class="hinge hinge-3"></div><div class="avatar-wrapper-container"><div class="thang-canvas-wrapper thang-elem hide"><canvas class="thang-canvas"></canvas></div></div><div class="center"><div class="thang-name"></div><div class="thang-props thang-elem"></div></div>'),t.join("")}},2612:function(e,t,i){var s=i(11);e.exports=function(e){var n,o=[],e=e||{};return function(e,t,i){o.push("<div"+s.attr("name",""+i,!0,!0)+' class="prop">'),t?o.push("<span"+s.cls(["prop-label prop-label-icon prop-label-icon-"+i],[!0])+"></span>"):o.push('<span class="prop-label">'+s.escape(null==(n=i)?"":n)+": </span>"),e?o.push('<span class="prop-value bar-prop"><div class="bar"></div></span><span class="prop-value bar-prop-value"></span>'):o.push('<span class="prop-value"></span>'),o.push("</div>")}.call(this,"hasBar"in e?e.hasBar:"undefined"!=typeof hasBar?hasBar:void 0,"hasIcon"in e?e.hasIcon:"undefined"!=typeof hasIcon?hasIcon:void 0,"prop"in e?e.prop:"undefined"!=typeof prop?prop:void 0),o.join("")}},2613:function(r,e,a){!function(c){var e,h,i,t,n=function(e,t){return function(){return e.apply(t,arguments)}},o={}.hasOwnProperty;function s(e){this.animateEnterButton=n(this.animateEnterButton,this),this.addMoreMessage=n(this.addMoreMessage,this),s.__super__.constructor.call(this,e),this.level=e.level,this.sessionID=e.sessionID}a(2614),e=a(26),t=a(2616),h=a(2617),i=a(1554),r.exports=(function(e,t){for(var i in t)o.call(t,i)&&(e[i]=t[i]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(s,e),s.prototype.id="level-dialogue-view",s.prototype.template=t,s.prototype.subscriptions={"sprite:speech-updated":"onSpriteDialogue","level:sprite-clear-dialogue":"onSpriteClearDialogue","level:shift-space-pressed":"onShiftSpacePressed","level:escape-pressed":"onEscapePressed","sprite:dialogue-sound-completed":"onDialogueSoundCompleted","level:open-items-modal":"openItemsModal"},s.prototype.events={click:"onClick","click a":"onClickLink"},s.prototype.onClick=function(e){return Backbone.Mediator.publish("tome:focus-editor",{})},s.prototype.onClickLink=function(e){var t=c(e.target).attr("href");if(t&&/item-store/.test(t))return this.openModalView(new i({supermodel:this.supermodal})),e.stopPropagation()},s.prototype.openItemsModal=function(e){return this.openModalView(new i({supermodel:this.supermodal}))},s.prototype.onSpriteDialogue=function(e){if(e.message)return this.$el.addClass("active speaking"),c("body").addClass("dialogue-view-active"),this.setMessage(e.message,e.mood,e.responses),"debrief"===e.mood?null!=e.sprite.thangType.get("poseImage")?this.$el.find(".dialogue-area").append(c("<img/>").addClass("embiggen").attr("src","/file/"+e.sprite.thangType.get("poseImage"))):this.$el.find(".dialogue-area").append(c("<img/>").attr("src",e.sprite.thangType.getPortraitURL())):void 0},s.prototype.onDialogueSoundCompleted=function(){return this.$el.removeClass("speaking")},s.prototype.onSpriteClearDialogue=function(){if(this.$el.removeClass("active speaking"),c("body").removeClass("dialogue-view-active"),this.$el.find("img").remove(),this.lastMood)return this.$el.removeClass(this.lastMood)},s.prototype.setMessage=function(e,t,i){var n,o,s,r,a,l;if(e=(e=marked(e)).replace(/&lt;i class=&#39;(.+?)&#39;&gt;&lt;\/i&gt;/,"<i class='$1'></i>"),this.messageInterval&&clearInterval(this.messageInterval),this.bubble=c(".dialogue-bubble",this.$el),this.lastMood&&this.$el.removeClass(this.lastMood),this.$el.find("img").remove(),this.$el.addClass(t),this.lastMood=t,this.bubble.text(""),o=c('<div class="enter secret" dir="ltr"></div>'),this.bubble.append(o),i)for(s=0,r=(this.lastResponses=i).length;s<r;s++)a=i[s],n=c('<button class="btn btn-small banner"></button>').text(a.text),a.buttonClass&&n.addClass(a.buttonClass),o.append(n),a.button=c("button:last",o);else l=c.i18n.t("common.continue",{defaultValue:"Continue"}),t=c.i18n.t("play_level.skip_tutorial",{defaultValue:"skip: esc"}),this.escapePressed||this.isFullScreen()||o.append('<span class="hud-hint">'+t+"</span>"),o.append(c('<button class="btn btn-small banner with-dot">'+l+' <div class="dot"></div></button>')),this.lastResponses=null;return this.animator=new h(e,this.bubble),this.messageInterval=setInterval(this.addMoreMessage,1e3/30)},s.prototype.isFullScreen=function(){return document.fullScreen||document.mozFullScreen||document.webkitIsFullScreen},s.prototype.addMoreMessage=function(){var e,t,i,n,o,s,r,a;if(!this.animator.done())return this.animator.tick();if(clearInterval(this.messageInterval),this.messageInterval=null,c(".enter",this.bubble).removeClass("secret").css("opacity",0).delay(500).animate({opacity:1},500,this.animateEnterButton),this.lastResponses)for(e=c(".enter button"),n=o=0,s=(r=this.lastResponses).length;o<s;n=++o)a=r[n],t=a.channel.replace("level-set-playing","level:set-playing"),i=function(e){return function(){return setTimeout(function(){return Backbone.Mediator.publish(t,e.event||{})},10)}},c(e[n]).click(i(a));else c(".enter",this.bubble).click(function(){return Backbone.Mediator.publish("script:end-current-script",{})})},s.prototype.onShiftSpacePressed=function(e){var t,i,n;if(this.shiftSpacePressed=(this.shiftSpacePressed||0)+1,null!=(n=this.lastResponses)&&n.length)return i=this.lastResponses[this.lastResponses.length-1],t=i.channel.replace("level-set-playing","level:set-playing"),_.delay(function(){return Backbone.Mediator.publish(t,i.event||{})},10)},s.prototype.onEscapePressed=function(e){return this.escapePressed=!0},s.prototype.animateEnterButton=function(){var e;if(this.bubble)return e=c(".enter",this.bubble),c(".dot",e).animate({opacity:.2},300).animate({opacity:1.9},600,this.animateEnterButton)},s.prototype.destroy=function(){return this.messageInterval&&clearInterval(this.messageInterval),s.__super__.destroy.call(this)},s)}.call(this,a(3))},2614:function(e,t,i){var n=i(2615);(n="string"==typeof n?[[e.i,n,""]]:n).locals&&(e.exports=n.locals);(0,i(21).default)("e342db02",n,!0,{})},2615:function(e,t,i){},2616:function(e,t,i){i(11);e.exports=function(e){var t=[];return t.push('<div class="dialogue-area"><p dir="auto" class="bubble dialogue-bubble"></p></div>'),t.join("")}},2617:function(e,t,i){!function(i){function n(e,t){this.jqueryElement=t,e=i("<div></div>").html(e),this.childrenToAdd=_.map(e[0].childNodes,function(e){return e}),this.t0=new Date,this.charsAdded=0,this.charsPerSecond=25}e.exports=(n.prototype.jqueryElement=null,n.prototype.childrenToAdd=null,n.prototype.charsToAdd=null,n.prototype.childAnimator=null,n.prototype.tick=function(){if(this.charsToAdd||this.childAnimator||this.addNextElement(),!this.charsToAdd)return this.childAnimator&&(this.childAnimator.tick(),this.childAnimator.done())?this.childAnimator=null:void 0;this.addSingleChar()},n.prototype.addNextElement=function(){var e,t;if(this.childrenToAdd.length)return e=this.childrenToAdd[0],this.childrenToAdd=this.childrenToAdd.slice(1),"#text"===e.nodeName?this.charsToAdd=e.nodeValue:(t=e.innerHTML,e=i(e).html(""),this.jqueryElement.append(e),t?(this.childAnimator&&(this.charsAdded+=this.childAnimator.getCharsAdded()),this.childAnimator=new n(t,e)):void 0)},n.prototype.addSingleChar=function(){var e=new Date-this.t0,t=this.getCharsAdded(),e=Math.round(this.charsPerSecond*e/1e3),t=Math.min(e-t,this.charsToAdd.length);return this.jqueryElement.html(this.jqueryElement.html()+this.charsToAdd.slice(0,t)),this.charsToAdd=this.charsToAdd.slice(t),0===this.charsToAdd.length&&(this.charsToAdd=null),this.charsAdded+=t},n.prototype.getCharsAdded=function(){var e;return this.charsAdded+(null!=(e=null!=(e=this.childAnimator)?e.charsAdded:void 0)?e:0)},n.prototype.done=function(){return!(0<this.childrenToAdd.length)&&(!this.charsToAdd&&!this.childAnimator)},n)}.call(this,i(3))},2618:function(e,t,i){var n=i(2619);(n="string"==typeof n?[[e.i,n,""]]:n).locals&&(e.exports=n.locals);(0,i(21).default)("ddca74f2",n,!0,{})},2619:function(e,t,i){},2620:function(e,t,n){!function(t,i){var f=n(11);e.exports=function(e){var d,m=[],e=e||{};return function(e,t,i,n,o,s,r,a,l,c,h,u,p){t=t.getHocCampaign()||!((l.isStudent()||l.isTeacher())&&!u.course)||u.level.isType("course-ladder","ladder");m.push('\x3c!-- No "Done" button for standalone tournament game-dev project levels outside of a campaign--\x3e'),(t=-1!=["resource-tycoon"].indexOf(u.level.get("slug"))?!1:t)&&m.push('<div class="left-cap"></div>'),m.push('<div class="right-cap"></div><div class="center-chain"></div><div class="right-chain"></div><div class="wood-background"></div>'),t&&m.push('<div class="levels-link-area"><a'+f.attr("href",o||"/",!0,!0)+' dir="ltr" class="levels-link"><div class="glyphicon glyphicon-play"></div><span'+f.attr("data-i18n",l.isSessionless()?"nav.courses":r?"general.ladder":"nav.map",!0,!0)+' class="home-text"></span></a></div>'),m.push('<div class="level-name-area-container"><div class="level-name-area">'),u.course&&m.push('<div class="level-label">'+f.escape(null==(d=s(u.course.attributes,"name"))?"":d)+"</div>"),m.push("<div"+f.attr("title",i||"",!0,!0)+' class="level-name">'),u.levelName?m.push('<span dir="auto">'+f.escape(null==(d=u.levelName)?"":d)+"</span>"):(i="",u.level&&u.level.get("assessment")?i=e.i18n.t("courses.challenge")+" ":u.levelNumber&&(i=u.levelNumber+". "),m.push('<span dir="auto">'+f.escape(null==(d=i)?"":d)+f.escape(null==(d=p.replace("Course: ",""))?"":d)+"</span>")),a&&m.push('<sup class="level-difficulty">'+f.escape(null==(d=a)?"":d)+"</sup>"),m.push('</div></div></div><div class="buttons-area">'),c||m.push('<button id="game-menu-button" data-i18n="[title]play_level.show_menu" title="Show game menu" class="btn btn-inverse"><div class="hamburger"><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></div><span data-i18n="play_level.game_menu" class="game-menu-text">Game Menu</span></button>'),h&&m.push('<button id="next-game-button" data-i18n="play_level.next_game" class="btn btn-xs btn-inverse banner">Next game</button>'),c||m.push('<button id="level-done-button" data-i18n="play_level.done" class="btn btn-xs btn-primary banner">Done</button>'),l.get("anonymous")&&!n.noAuth&&m.push('<button id="control-bar-sign-up-button" data-toggle="coco-modal" data-target="core/CreateAccountModal" data-i18n="signup.sign_up" class="btn btn-xs btn-primary banner"></button>'),l.isAdmin()&&(u=u.course?"Home":"Classroom",m.push('<button id="version-switch-button" class="btn btn-xs btn-inverse banner"><span>'+f.escape(null==(d=u)?"":d)+"</span><span>"+f.escape(d=" ")+'</span><span data-code-language="javascript" class="code-language-selector">JS</span><span>'+f.escape(d=" | ")+'</span><span data-code-language="python" class="code-language-selector">PY</span></button>')),m.push("</div>")}.call(this,"$"in e?e.$:void 0!==t?t:void 0,"application"in e?e.application:void 0!==i?i:void 0,"difficultyTitle"in e?e.difficultyTitle:"undefined"!=typeof difficultyTitle?difficultyTitle:void 0,"features"in e?e.features:"undefined"!=typeof features?features:void 0,"homeLink"in e?e.homeLink:"undefined"!=typeof homeLink?homeLink:void 0,"i18n"in e?e.i18n:"undefined"!=typeof i18n?i18n:void 0,"ladderGame"in e?e.ladderGame:"undefined"!=typeof ladderGame?ladderGame:void 0,"levelDifficulty"in e?e.levelDifficulty:"undefined"!=typeof levelDifficulty?levelDifficulty:void 0,"me"in e?e.me:"undefined"!=typeof me?me:void 0,"observing"in e?e.observing:"undefined"!=typeof observing?observing:void 0,"spectateGame"in e?e.spectateGame:"undefined"!=typeof spectateGame?spectateGame:void 0,"view"in e?e.view:"undefined"!=typeof view?view:void 0,"worldName"in e?e.worldName:"undefined"!=typeof worldName?worldName:void 0),m.join("")}}.call(this,n(3),n(17))},2621:function(e,t,i){var n=i(2622);(n="string"==typeof n?[[e.i,n,""]]:n).locals&&(e.exports=n.locals);(0,i(21).default)("4602de5f",n,!0,{})},2622:function(e,t,i){},2623:function(e,t,i){i(11);e.exports=function(e){var t=[],e=e||{};return function(e){t.push('<button id="play-button" title="Ctrl/Cmd + P: Toggle level play/pause" class="btn btn-xs btn-inverse paused"><div class="glyphicon glyphicon-play"></div><div class="glyphicon glyphicon-pause"></div><div class="glyphicon glyphicon-repeat"></div></button><button id="volume-button" title="Adjust volume" class="btn btn-xs btn-inverse picoctf-hide"><div class="glyphicon glyphicon-volume-off"></div><div class="glyphicon glyphicon-volume-down"></div><div class="glyphicon glyphicon-volume-up"></div></button><button id="music-button" title="Toggle Music" class="btn btn-xs btn-inverse picoctf-hide"><span></span></button>'),e.options.level.isType("game-dev")||t.push('<div class="scrubber"><div class="scrubber-inner"><div id="timeProgress" class="progress secret"><div class="progress-bar"><div class="scrubber-handle"></div><div id="timePopover" class="popover fade top in"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div></div></div></div></div>'),t.push('<div id="playback-settings" class="btn-group dropup"><button title="Toggle fullscreen" class="btn btn-xs btn-inverse toggle-fullscreen"><div class="glyphicon glyphicon-fullscreen"></div></button><button id="zoom-in-button" title="Zoom In (or scroll down)" class="btn btn-xs btn-inverse"><div class="glyphicon glyphicon-zoom-in"></div></button><button id="zoom-out-button" title="Zoom Out (or scroll up)" class="btn btn-xs btn-inverse"><div class="glyphicon glyphicon-zoom-out"></div></button></div>')}.call(this,"view"in e?e.view:"undefined"!=typeof view?view:void 0),t.join("")}},2624:function(e,t,i){var n=i(2625);(n="string"==typeof n?[[e.i,n,""]]:n).locals&&(e.exports=n.locals);(0,i(21).default)("79b73a42",n,!0,{})},2625:function(e,t,i){},2626:function(e,t,i){i(11);e.exports=function(e){var t=[];return t.push('<div class="goals-component"></div>'),t.join("")}},2627:function(e,t,i){var n,o,s,r={}.hasOwnProperty;function a(e){a.__super__.constructor.call(this,e),this.levelID=e.levelID,this.world=e.world}i(2628),n=i(26),s=i(2630),o=i(44).me,e.exports=(function(e,t){for(var i in t)r.call(t,i)&&(e[i]=t[i]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(a,n),a.prototype.id="level-flags-view",a.prototype.template=s,a.prototype.className="secret",a.prototype.subscriptions={"playback:real-time-playback-started":"onRealTimePlaybackStarted","playback:real-time-playback-ended":"onRealTimePlaybackEnded","surface:stage-mouse-down":"onStageMouseDown","god:new-world-created":"onNewWorld","god:streaming-world-updated":"onNewWorld","surface:remove-flag":"onRemoveFlag"},a.prototype.events={"click .green-flag":function(){return this.onFlagSelected({color:"green",source:"button"})},"click .black-flag":function(){return this.onFlagSelected({color:"black",source:"button"})},"click .violet-flag":function(){return this.onFlagSelected({color:"violet",source:"button"})}},a.prototype.shortcuts={g:function(){return this.onFlagSelected({color:"green",source:"shortcut"})},b:function(){return this.onFlagSelected({color:"black",source:"shortcut"})},v:function(){return this.onFlagSelected({color:"violet",source:"shortcut"})},esc:function(){return this.onFlagSelected({color:null,source:"shortcut"})},"delete, del, backspace":"onDeletePressed"},a.prototype.onRealTimePlaybackStarted=function(e){return this.realTime=!0,this.$el.show(),this.flags={},this.flagHistory=[]},a.prototype.onRealTimePlaybackEnded=function(e){return this.onFlagSelected({color:null}),this.realTime=!1,this.$el.hide()},a.prototype.onFlagSelected=function(e){if(this.realTime)return e.color&&this.playSound("menu-button-click"),e=e.color===this.flagColor?null:e.color,this.flagColor=e,Backbone.Mediator.publish("level:flag-color-selected",{color:e}),this.$el.find(".flag-button").removeClass("active"),e?this.$el.find("."+e+"-flag").addClass("active"):void 0},a.prototype.onStageMouseDown=function(e){var t;if(this.flagColor&&this.realTime)return this.playSound("menu-button-click"),t={x:e.worldPos.x,y:e.worldPos.y},e=this.world.dt*this.world.frames.length,t={player:o.id,team:o.team,color:this.flagColor,pos:t,time:e,active:!0,source:"click"},this.flags[this.flagColor]=t,this.flagHistory.push(t),null!=(e=this.realTimeFlags)&&e.create(t),Backbone.Mediator.publish("level:flag-updated",t)},a.prototype.onDeletePressed=function(e){if(this.realTime)return Backbone.Mediator.publish("surface:remove-selected-flag",{})},a.prototype.onRemoveFlag=function(e){var t;return delete this.flags[e.color],t=this.world.dt*this.world.frames.length,t={player:o.id,team:o.team,color:e.color,time:t,active:!1,source:"click"},this.flagHistory.push(t),Backbone.Mediator.publish("level:flag-updated",t)},a.prototype.onNewWorld=function(e){if(e.world.name===this.world.name)return this.world=this.options.world=e.world},a)},2628:function(e,t,i){var n=i(2629);(n="string"==typeof n?[[e.i,n,""]]:n).locals&&(e.exports=n.locals);(0,i(21).default)("472b33fd",n,!0,{})},2629:function(e,t,i){},2630:function(e,t,i){i(11);e.exports=function(e){var t=[];return t.push('<button title="G: Place a green flag" class="flag-button btn btn-lg green-flag"><span class="glyphicon glyphicon-flag"></span><span class="flag-caption"><span class="flag-shortcut">G</span>reen</span></button><button title="B: Place a black flag" class="flag-button btn btn-lg black-flag"><span class="glyphicon glyphicon-flag"></span><span class="flag-caption"><span class="flag-shortcut">B</span>lack</span></button><button title="V: Place a violet flag" class="flag-button btn btn-lg violet-flag"><span class="glyphicon glyphicon-flag"></span><span class="flag-caption"><span class="flag-shortcut">V</span>iolet</span></button>'),t.join("")}},2631:function(e,t,i){var n=i(2632);(n="string"==typeof n?[[e.i,n,""]]:n).locals&&(e.exports=n.locals);(0,i(21).default)("506833e5",n,!0,{})},2632:function(e,t,i){},2633:function(e,t,i){i(11);e.exports=function(e){return[].join("")}},2634:function(e,t,i){var n=i(11);e.exports=function(e){var t=[],e=e||{};return function(e){t.push("<div"+n.cls(["team-gold team-"+e],[!0])+'><img src="/images/level/gold_icon.png" alt="" draggable="false"><div'+n.cls(["gold-amount team-"+e],[!0])+"></div></div>")}.call(this,"team"in e?e.team:"undefined"!=typeof team?team:void 0),t.join("")}},2635:function(e,t,i){var n=i(2636);(n="string"==typeof n?[[e.i,n,""]]:n).locals&&(e.exports=n.locals);(0,i(21).default)("819dc5c2",n,!0,{})},2636:function(e,t,i){},2637:function(e,t,i){var c=i(11);e.exports=function(e){var a,l=[],e=e||{};return function(e,r){l.push('<div id="track-view-container"><div id="listings">'),function(){var e=r.listings;if("number"==typeof e.length)for(var o=0,t=e.length;o<t;o++){var s=e[o];l.push('<div class="track-elem"><div class="track-icon"><div>'+c.escape(null==(a=r.titleize(o))?"":a)+'</div></div><div class="track-text">'),r.beautify(o,s).split?function(){var e=r.beautify(o,s).split("\n");if("number"==typeof e.length)for(var t=0,i=e.length;t<i;t++){var n=e[t];l.push("<div>"+c.escape(null==(a=n)?"":a)+"</div>")}else{i=0;for(t in e){i++;n=e[t];l.push("<div>"+c.escape(null==(a=n)?"":a)+"</div>")}}}.call(this):l.push("<div>"+c.escape(null==(a=r.beautify(o,s))?"":a)+"</div>"),l.push("</div></div>")}else{t=0;for(o in e){t++;s=e[o];l.push('<div class="track-elem"><div class="track-icon"><div>'+c.escape(null==(a=r.titleize(o))?"":a)+'</div></div><div class="track-text">'),r.beautify(o,s).split?function(){var e=r.beautify(o,s).split("\n");if("number"==typeof e.length)for(var t=0,i=e.length;t<i;t++){var n=e[t];l.push("<div>"+c.escape(null==(a=n)?"":a)+"</div>")}else{i=0;for(t in e){i++;n=e[t];l.push("<div>"+c.escape(null==(a=n)?"":a)+"</div>")}}}.call(this):l.push("<div>"+c.escape(null==(a=r.beautify(o,s))?"":a)+"</div>"),l.push("</div></div>")}}}.call(this),l.push("</div></div>")}.call(this,"undefined"in e?e.undefined:void 0,"view"in e?e.view:"undefined"!=typeof view?view:void 0),l.join("")}},2638:function(e,t,i){var n=i(2639);(n="string"==typeof n?[[e.i,n,""]]:n).locals&&(e.exports=n.locals);(0,i(21).default)("e45a92c2",n,!0,{})},2639:function(e,t,i){},2640:function(e,t,i){var a=i(11);e.exports=function(e){var s,r=[],e=e||{};return function(e,o){r.push('<div class="duel-stats-background"></div>'),function(){var e=o.players;if("number"==typeof e.length)for(var t=0,i=e.length;t<i;t++){var n=e[t];r.push("<div"+a.cls(["player-container team-"+n.team],[!0])+'><div class="player-portrait"><div class="thang-avatar-placeholder"></div></div><div class="player-info"><div class="name-and-power">'),o.showsPower&&r.push('<div class="player-power"><div class="power-icon"></div><div class="power-value"></div></div>'),o.options.showsGold&&r.push('<div class="player-gold"><div class="gold-icon"></div><div class="gold-value"></div></div>'),r.push('<div class="player-name">'+a.escape(null==(s=n.name||"Anonymous")?"":s)+'</div></div><div class="player-health"><div class="health-icon"></div><div class="health-bar-container"><div class="health-bar"></div></div><div class="health-value"></div></div></div></div>')}else{i=0;for(t in e){i++;n=e[t];r.push("<div"+a.cls(["player-container team-"+n.team],[!0])+'><div class="player-portrait"><div class="thang-avatar-placeholder"></div></div><div class="player-info"><div class="name-and-power">'),o.showsPower&&r.push('<div class="player-power"><div class="power-icon"></div><div class="power-value"></div></div>'),o.options.showsGold&&r.push('<div class="player-gold"><div class="gold-icon"></div><div class="gold-value"></div></div>'),r.push('<div class="player-name">'+a.escape(null==(s=n.name||"Anonymous")?"":s)+'</div></div><div class="player-health"><div class="health-icon"></div><div class="health-bar-container"><div class="health-bar"></div></div><div class="health-value"></div></div></div></div>')}}}.call(this)}.call(this,"undefined"in e?e.undefined:void 0,"view"in e?e.view:"undefined"!=typeof view?view:void 0),r.join("")}},2641:function(e,t,i){var n,s,o,r={}.hasOwnProperty;function a(e){a.__super__.constructor.call(this,e),this.thang=e.thang,this.includeName=e.includeName,this.thangType=this.getSpriteThangType(),this.thangType?(this.thangType.isFullyLoaded()||this.thangType.loading||this.thangType.fetch(),this.listenTo(this.thangType,"sync",this.render),this.listenTo(this.thangType,"build-complete",this.render)):console.error("Thang avatar view expected a thang type to be provided.")}n=i(26),o=i(2642),s=i(1374),e.exports=(function(e,t){for(var i in t)r.call(t,i)&&(e[i]=t[i]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(a,n),a.prototype.className="thang-avatar-view",a.prototype.template=o,a.prototype.subscriptions={"tome:problems-updated":"onProblemsUpdated","god:new-world-created":"onNewWorld"},a.prototype.getSpriteThangType=function(){var n,o=this.supermodel.getModels(s);return o=function(){for(var e=[],t=0,i=o.length;t<i;t++)(n=o[t]).get("name")===this.thang.spriteName&&e.push(n);return e}.call(this),function(){for(var e=[],t=0,i=o.length;t<i;t++)(n=o[t]).isFullyLoaded()&&e.push(n);return e}()[0]||o[0]},a.prototype.getRenderData=function(e){var t;return(e=a.__super__.getRenderData.call(this,e=null==e?{}:e)).thang=this.thang,t=(null!=(t=this.thang)?t.getLankOptions():void 0)||{},this.thangType.loading||(e.avatarURL=this.thangType.getPortraitSource(t)),e.includeName=this.includeName,e},a.prototype.setProblems=function(e,t){e=this.$el.find(".badge.problems").text(e?"x":"");if(e.removeClass("error warning info"),t)return e.addClass(t)},a.prototype.setSharedThangs=function(e){return this.$el.find(".badge.shared-thangs").text(1<e?e:"")},a.prototype.setSelected=function(e){return this.$el.toggleClass("selected",Boolean(e))},a.prototype.onProblemsUpdated=function(e){var t,i,n,o,s,r,a;if((null!=(s=this.thang)?s.id:void 0)===(null!=(s=e.spell.thang)?s.thang.id:void 0)){for(o=null!=(e=null!=(e=e.spell.thang.castAether)?e.getAllProblems():void 0)?e:[],a=null,t=0,i=(r=["error","warning","info"]).length;t<i;t++)if(n=r[t],_.some(o,{level:n})){a=n;break}return this.setProblems(o.length,a)}},a.prototype.onNewWorld=function(e){if(this.thang&&e.world.thangMap[this.thang.id])return this.options.thang=this.thang=e.world.thangMap[this.thang.id]},a.prototype.destroy=function(){return a.__super__.destroy.call(this)},a)},2642:function(e,t,i){var s=i(11);e.exports=function(e){var n,o=[],e=e||{};return function(e,t,i){o.push("<div"+s.cls(["thang-avatar-wrapper","team-"+(i.team||"neutral")],[null,!0])+'>\x3c!--canvas(width=100, height=100, title=thang.id + " - " + thang.team)--\x3e<img'+s.attr("src",e,!0,!0)+' draggable="false" class="avatar"><img src="/images/level/thang_avatar_frame.png" draggable="false" class="avatar-frame"><div class="badge problems"></div><div class="badge shared-thangs"></div></div>'),t&&o.push('<div class="thang-name">'+s.escape(null==(n=i.id)?"":n)+"</div>")}.call(this,"avatarURL"in e?e.avatarURL:"undefined"!=typeof avatarURL?avatarURL:void 0,"includeName"in e?e.includeName:"undefined"!=typeof includeName?includeName:void 0,"thang"in e?e.thang:"undefined"!=typeof thang?thang:void 0),o.join("")}},2643:function(e,t,i){var n=i(2644);(n="string"==typeof n?[[e.i,n,""]]:n).locals&&(e.exports=n.locals);(0,i(21).default)("3f2e9d67",n,!0,{})},2644:function(e,t,i){},2645:function(e,t,i){var c=i(11);e.exports=function(e){var a,l=[],e=e||{};return function(e,t,i,n,o,s,r){l.push('<div class="modal-dialog game"><div class="background-wrapper"><div class="modal-content"><div class="modal-header">'),r.closeButton&&l.push('<div type="button" data-dismiss="modal" aria-hidden="true" class="button close">&times;</div>'),l.push('<h3><span data-i18n="play_level.victory_title_prefix"></span><span>'+c.escape(null==(a=n)?"":a)+'</span><span data-i18n="play_level.victory_title_suffix">Complete</span></h3></div><div class="modal-body"><img src="/images/level/victory.png" alt="" class="victory-banner"><div>'+(null==(a=e)?"":a)+'</div></div><div class="modal-body wait secret"><h3>Reticulating Splines...</h3><div class="progress progress-striped active"><div class="progress-bar"></div></div></div><div class="modal-footer">'),s?l.push('<div class="ladder-submission-view"></div>'):i.isType("ladder")?l.push("<a"+c.attr("href","/play/ladder/"+i.get("slug")+"#my-matches",!0,!0)+' data-dismiss="modal" data-i18n="play_level.victory_return_to_ladder" class="btn btn-primary">Return to Ladder</a>'):l.push('<a href="/" data-dismiss="modal" data-i18n="play_level.victory_go_home" class="btn btn-primary">Go Home</a>'),o.get("anonymous")?l.push('<p class="sign-up-poke"><button data-dismiss="modal" data-i18n="play_level.victory_sign_up" class="btn btn-success sign-up-button btn-large">Sign Up to Save Progress</button><span data-i18n="play_level.victory_sign_up_poke">Want to save your code? Create a free account!</span></p><p class="clearfix"></p>'):l.push('<div class="rating secret"><span data-i18n="play_level.victory_rate_the_level">Rate the level:</span><i class="icon-star-empty"></i><i class="icon-star-empty"></i><i class="icon-star-empty"></i><i class="icon-star-empty"></i><i class="icon-star-empty"></i></div>'),o.get("anonymous")||l.push('<div class="review secret"><span data-i18n="play_level.victory_review">Tell us more!</span><br><textarea></textarea></div>'),l.push('<div class="share-buttons"><div data-href="http://codecombat.com" data-size="medium" class="g-plusone"></div><div data-href="https://www.facebook.com/codecombat" data-send="false" data-layout="button_count" data-width="350" data-show-faces="true"'+c.attr("data-ref","coco_victory_"+t,!0,!0)+' class="fb-like"></div><a href="https://twitter.com/CodeCombat" data-show-count="true" data-show-screen-name="false" data-dnt="true" data-align="right" data-i18n="nav.twitter_follow" class="twitter-follow-button">Follow</a><iframe src="https://ghbtns.com/github-btn.html?user=codecombat&amp;repo=codecombat&amp;type=watch&amp;count=true" allowtransparency="true" frameborder="0" scrolling="0" width="110" height="20" class="github-star-button"></iframe></div></div></div></div></div>')}.call(this,"body"in e?e.body:"undefined"!=typeof body?body:void 0,"fbRef"in e?e.fbRef:"undefined"!=typeof fbRef?fbRef:void 0,"level"in e?e.level:"undefined"!=typeof level?level:void 0,"levelName"in e?e.levelName:"undefined"!=typeof levelName?levelName:void 0,"me"in e?e.me:"undefined"!=typeof me?me:void 0,"readyToRank"in e?e.readyToRank:"undefined"!=typeof readyToRank?readyToRank:void 0,"view"in e?e.view:"undefined"!=typeof view?view:void 0),l.join("")}},2646:function(C,e,T){!function(w,k){var t,i,n,o,s,g,r,a,y,e,l,v,c,h,u,p,d,x,m=function(e,t){return function(){return e.apply(t,arguments)}},f={}.hasOwnProperty,b=[].indexOf||function(e){for(var t=0,i=this.length;t<i;t++)if(t in this&&this[t]===e)return t;return-1};function S(e){this.tickSequentialAnimation=m(this.tickSequentialAnimation,this),S.__super__.constructor.call(this,e),this.courseID=e.courseID,this.courseInstanceID=e.courseInstanceID,this.session=e.session,this.level=e.level,this.thangTypes={},this.level.isType("hero","hero-ladder","course","course-ladder","game-dev","web-dev","ladder")?(e=new o([],{url:"/db/achievement?related="+this.session.get("level").original,model:t}),this.achievements=this.supermodel.loadCollection(e,"achievements").model,this.listenToOnce(this.achievements,"sync",this.onAchievementsLoaded),this.readyToContinue=!1,this.waitingToContinueSince=new Date,this.previousXP=me.get("points",!0),this.previousLevel=me.level()):this.readyToContinue=!0,this.playSound("victory"),this.level.isType("course","course-ladder")&&(this.saveReviewEventually=_.debounce(this.saveReviewEventually,2e3)),"project"===this.level.get("shareable")&&(this.shareURL=window.location.origin+"/play/"+this.level.get("type")+"-level/"+this.session.id),this.trackAwsButtonShown=_.once(function(){var e;return null!=(e=window.tracker)?e.trackEvent("Show Amazon Modal Button"):void 0})}T(2647),e=T(80),s=T(118),d=T(2649),t=T(269),g=T(624),o=T(115),y=T(1742),x=T(6),v=T(1374),r=T(1683),n=T(1390),c=T(37),x=T(6),T(1376),T(267),a=T(1405),T(32),l=T(622),i=T(1555),p=T(27),u=T(627),C.exports=(function(e,t){for(var i in t)f.call(t,i)&&(e[i]=t[i]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(S,e),S.prototype.id="hero-victory-modal",S.prototype.template=d,S.prototype.closeButton=!1,S.prototype.closesOnClickOutside=!1,S.prototype.subscriptions={"ladder:game-submitted":"onGameSubmitted"},S.prototype.events={"click #continue-button":"onClickContinue","click .leaderboard-button":"onClickLeaderboard","click .return-to-course-button":"onClickReturnToCourse","click .return-to-ladder-button":"onClickReturnToLadder","click .sign-up-button":"onClickSignupButton","click .continue-from-offer-button":"onClickContinueFromOffer","click .skip-offer-button":"onClickSkipOffer","click #share-level-btn":"onClickShareLevelButton","click .subscribe-button":"onSubscribeButtonClicked","click #amazon-hoc-button":"onClickAmazonHocButton","input #share-game-with-teacher-input":"onChangeShareGameWithTeacherInput","click #share-game-with-teacher-btn":"onClickShareGameWithTeacherButton","mouseover .rating i":function(e){return this.showStars(this.starNum(w(e.target)))},"mouseout .rating i":function(){return this.showStars()},"click .rating i":function(e){return this.setStars(this.starNum(w(e.target))),this.$el.find(".review, .review-label").show()},"keypress .review textarea":function(){return this.saveReviewEventually()}},S.prototype.destroy=function(){var e;return clearInterval(this.sequentialAnimationInterval),this.$el.find(".review textarea").val()&&this.saveReview(),null!=(e=this.feedback)&&e.off(),S.__super__.destroy.call(this)},S.prototype.onHidden=function(){return Backbone.Mediator.publish("music-player:exit-menu",{}),S.__super__.onHidden.call(this)},S.prototype.loadExistingFeedback=function(){var e="/db/level/"+this.level.id+"/feedback";return this.feedback=new a,this.feedback.setURL(e),this.feedback.fetch({cache:!1}),this.listenToOnce(this.feedback,"sync",function(){return this.onFeedbackLoaded()}),this.listenToOnce(this.feedback,"error",function(){return this.onFeedbackNotFound()})},S.prototype.onFeedbackLoaded=function(){return this.feedback.url=function(){return"/db/level.feedback/"+this.id},this.$el.find(".review textarea").val(this.feedback.get("review")),this.$el.find(".review, .review-label").show(),this.showStars()},S.prototype.onFeedbackNotFound=function(){return this.feedback=new a,this.feedback.set("levelID",this.level.get("slug")||this.level.id),this.feedback.set("levelName",this.level.get("name")||""),this.feedback.set("level",{majorVersion:this.level.get("version").major,original:this.level.get("original")}),this.showStars()},S.prototype.onAchievementsLoaded=function(){var e,t,o,i,n,s,r,a,l,c,h,u,p,d,m,f;for(this.achievements.models=_.filter(this.achievements.models,function(e){return!(null!=(e=e.get("query"))&&e.ladderAchievementDifficulty)}),this.$el.toggleClass("full-achievements",3===this.achievements.models.length),f=[],t=[],n=0,a=(h=this.achievements.models).length;n<a;n++)p=(e=h[n]).get("rewards")||{},f.push(p.heroes||[]),f.push(p.items||[]),e.completed=y.matchesQuery(this.session.attributes,e.get("query")),e.completed&&t.push(e.id);for(s=0,l=(f=_.uniq(_.flatten(f))).length;s<l;s++)m=f[s],(d=new v).url="/db/thang.type/"+m+"/version",d.project=["original","rasterIcon","name","slug","soundTriggers","featureImages","gems","heroClass","description","components","extendedName","shortName","unlockLevelName","i18n","subscriber"],this.thangTypes[m]=this.supermodel.loadModel(d).model;for(i=!(this.newEarnedAchievements=[]),r=0,c=(u=this.achievements.models).length;r<c;r++)(e=u[r]).completed&&(i=!0,(o=new g({collection:e.get("collection"),triggeredBy:this.session.id,achievement:e.id})).save(),this.newEarnedAchievements.push(o),this.listenToOnce(o,"sync",function(){if(_.all(function(){for(var e=this.newEarnedAchievements,t=[],i=0,n=e.length;i<n;i++)o=e[i],t.push(o.id);return t}.call(this))&&(this.newEarnedAchievementsResource.markLoaded(),this.listenToOnce(me,"sync",function(){return this.readyToContinue=!0,this.updateSavingProgressStatus()}),!me.loading))return me.fetch({cache:!1})}));if(i||(this.readyToContinue=!0),this.newEarnedAchievements.length)return this.newEarnedAchievementsResource=this.supermodel.addSomethingResource("earned achievements")},S.prototype.getRenderData=function(){var e,t,i,n,o,s,r,a,l,c,h,u,p,d,m,f,g,y,v,b=S.__super__.getRenderData.call(this);for(b.levelName=x.i18n(this.level.attributes,"name"),this.level.isType("hero","game-dev","web-dev")&&(b.victoryText=x.i18n(null!=(u=this.level.get("victory"))?u:{},"body")),i=_.indexBy(this.newEarnedAchievements||[],function(e){return e.get("achievement")}),s=0,a=(p=(null!=(y=this.achievements)?y.models:void 0)||[]).length;s<a;s++)(d=i[(t=p[s]).id])&&(t.completedAWhileAgo=3e4<(new Date).getTime()-Date.parse(d.attributes.changed)),t.worth=t.get("worth",!0),t.gems=null!=(d=t.get("rewards"))?d.gems:void 0;for(b.achievements=(null!=(v=this.achievements)?v.models.slice():void 0)||[],r=0,l=(m=b.achievements).length;r<l;r++)(t=m[r]).description=x.i18n(t.attributes,"description"),this.supermodel.finished()&&(h=t.get("proportionalTo"))&&(e=x.getByPath(this.session.attributes,h),c=Math.max(0,e-1),n=t.getExpFunction(),t.previousWorth=(null!=(g=t.get("worth"))?g:0)*n(c),t.worth=(null!=(g=t.get("worth"))?g:0)*n(e),null!=(g=t.get("rewards"))&&g.gems&&(t.gems=(null!=g?g.gems:void 0)*n(e)),null!=g&&g.gems&&(t.previousGems=(null!=g?g.gems:void 0)*n(c)));return b.thangTypes=this.thangTypes,b.me=me,b.readyToRank=this.level.isLadder()&&this.session.readyToRank(),b.level=this.level,b.i18n=x.i18n,u=new Date-new Date(me.get("dateCreated")),me.get("hourOfCode")&&(o=k.getHocCampaign()&&"intro"!==k.getHocCampaign(),y=function(){switch(o){case"game-dev-hoc":return"57ee6f5786cf4e1f00afca2c";case"game-dev-hoc-2":return"57b71dce7a14ff35003a8f71";case"ai-league-hoc":return"60e69b24bed8ae001ac6ce3e";default:return"541c9a30c6362edfb0f34479"}}(),f=this.level.get("original")===y||this.level.isType("ladder"),v=72e5<u,y=18e5<=u&&!v||f,!(12e5<=u||f)||v||me.get("hourOfCodeComplete")||(v=function(){switch(o){case"game-dev-hoc":return"code_combat_gamedev";case"game-dev-hoc-2":return"code_combat_gamedev2";case"ai-league-hoc":return"cc_ai";default:return"code_combat"}}(),w("body").append(w("<img src='https://code.org/api/hour/finish_"+v+".png' style='visibility: hidden;'>")),me.set("hourOfCodeComplete",!0),me.patch(),null!=(v=window.tracker)&&v.trackEvent("Hour of Code Finish")),b.showHourOfCodeDoneButton=y,this.showAmazonHocButton="game-dev-hoc"===o&&f,this.showAmazonHocButton&&this.trackAwsButtonShown(),this.showHoc2016ExploreButton=o&&f,this.showShareGameWithTeacher=/game-dev/.test(o)&&f),b.showLeaderboard=0<(null!=(f=this.level.get("scoreTypes"))?f.length:void 0)&&!this.level.isType("course")&&!this.showAmazonHocButton&&!this.showHoc2016ExploreButton,b.showReturnToCourse=!b.showLeaderboard&&!me.get("anonymous")&&this.level.isType("course","course-ladder"),b.isCourseLevel=this.level.isType("course"),b.currentCourseName=null!=(f=this.course)?f.get("name"):void 0,b.currentLevelName=null!=(f=this.level)?f.get("name"):void 0,b.nextLevelName=null!=(f=this.nextLevel)?f.get("name"):void 0,b},S.prototype.afterRender=function(){var e,t,i;if(S.__super__.afterRender.call(this),this.$el.toggleClass("with-achievements",this.level.isType("hero","hero-ladder","game-dev","web-dev","ladder")),this.supermodel.finished()){for(t in i=this.thangTypes)e=i[t],this.playSelectionSound(e,!0);return this.updateSavingProgressStatus(),this.initializeAnimations(),this.level.isLadder()?(this.ladderSubmissionView=new r({session:this.session,level:this.level}),this.insertSubView(this.ladderSubmissionView,this.$el.find(".ladder-submission-view"))):void 0}},S.prototype.initializeAnimations=function(){var e,t,i,n,o;if(!this.level.isType("hero","hero-ladder","game-dev","web-dev","ladder"))return this.endSequentialAnimations();for(this.updateXPBars(0),this.$el.find("#victory-header").delay(250).queue(function(){return w(this).removeClass("out").dequeue()}),e=_.once(_.bind(this.beginSequentialAnimations,this)),this.animatedPanels=w(),t=0,i=(o=this.$el.find(".achievement-panel")).length;t<i;t++)n=o[t],null!=(n=w(n)).data("animate")&&(this.animatedPanels=this.animatedPanels.add(n),n.delay(500),n.queue(function(){return w(this).addClass("earned"),w(this).dequeue()}),n.delay(500),n.queue(function(){return w(this).find(".reward-image-container").addClass("show"),w(this).dequeue()}),n.delay(500),n.queue(function(){return e()}));return this.animationComplete=!this.animatedPanels.length,this.animationComplete?e():void 0},S.prototype.beginSequentialAnimations=function(){var e,t,i,n,o,s,r;if(!this.destroyed&&this.level.isType("hero","hero-ladder","game-dev","web-dev","ladder")){for(this.sequentialAnimatedPanels=_.map(this.animatedPanels.find(".reward-panel"),function(e){return{number:w(e).data("number"),previousNumber:w(e).data("previous-number"),textEl:w(e).find(".reward-text"),rootEl:w(e),unit:w(e).data("number-unit"),hero:w(e).data("hero-thang-type"),item:w(e).data("item-thang-type")}}),e=this.totalXP=0,i=(s=this.sequentialAnimatedPanels).length;e<i;e++)"xp"===(o=s[e]).unit&&(this.totalXP+=o.number);for(t=this.totalGems=0,n=(r=this.sequentialAnimatedPanels).length;t<n;t++)"gem"===(o=r[t]).unit&&(this.totalGems+=o.number);return this.gemEl=w("#gem-total"),this.XPEl=w("#xp-total"),this.totalXPAnimated=this.totalGemsAnimated=this.lastTotalXP=this.lastTotalGems=0,this.sequentialAnimationStart=new Date,this.sequentialAnimationInterval=setInterval(this.tickSequentialAnimation,1e3/60)}},S.prototype.tickSequentialAnimation=function(){var e,t,i,n,o;return(t=this.sequentialAnimatedPanels[0])?(i=t.number?Math.log(t.number+1)/Math.LN10*1e3:1e3,i=this.getEaseRatio(new Date-this.sequentialAnimationStart,i),"xp"===t.unit?(e=Math.floor(i*(t.number-t.previousNumber)),(o=this.totalXPAnimated+e)!==this.lastTotalXP&&(t.textEl.text("+"+e),this.XPEl.text(o),this.updateXPBars(o),this.playSound("xp-"+o%6,.5+i/2),1e3<=o&&this.lastTotalXP<1e3&&this.XPEl.addClass("four-digits"),1e4<=o&&this.lastTotalXP<1e4&&this.XPEl.addClass("five-digits"),this.lastTotalXP=o)):"gem"===t.unit?(e=Math.floor(i*(t.number-t.previousNumber)),(o=this.totalGemsAnimated+e)!==this.lastTotalGems&&(t.textEl.text("+"+e),this.gemEl.text(o),e="gem-"+parseInt(t.number*i)%4,this.playSound(e,.5+i/2),1e3<=o&&this.lastTotalGems<1e3&&this.gemEl.addClass("four-digits"),1e4<=o&&this.lastTotalGems<1e4&&this.gemEl.addClass("five-digits"),this.lastTotalGems=o)):t.item?(n=this.thangTypes[t.item],t.textEl.text(x.i18n(n.attributes,"name")),.5<i&&i<.6&&this.playSound("item-unlocked")):t.hero&&(n=this.thangTypes[t.hero],t.textEl.text(x.i18n(n.attributes,"name")),.5<i&&i<.6&&this.playSelectionSound(n)),1===i?(t.rootEl.removeClass("animating").find(".reward-image-container img").removeClass("pulse"),this.sequentialAnimationStart=new Date,"xp"===t.unit?this.totalXPAnimated+=t.number-t.previousNumber:"gem"===t.unit&&(this.totalGemsAnimated+=t.number-t.previousNumber),void this.sequentialAnimatedPanels.shift()):t.rootEl.addClass("animating").find(".reward-image-container").removeClass("pending-reward-image").find("img").addClass("pulse")):this.endSequentialAnimations()},S.prototype.getEaseRatio=function(e,t){return(t=2*(e=Math.min(e,t))/t)<1?.5*t*t:-.5*(--t*(t-2)-1)},S.prototype.updateXPBars=function(e){var t,i,n,o,s,r=this.previousXP;return me.isInGodMode()&&(r+=1e6),o=this.previousLevel,t=c.levelFromExp(n=r+e),(r=100*(r-(i=c.expForLevel(t)))/(s=c.expForLevel(t+1)-i))<0&&(r=0),e=(o=o<t)?100*(n-i)/s:100*e/s,(s=w("#xp-wrapper")).find(".xp-bar-already-achieved").css("width",r+"%"),s.find(".xp-bar-total").css("width",r+e+"%"),s=s.find(".level"),x.replaceText(s,t),o&&(!this.displayedLevel||t>this.displayedLevel)&&this.playSound("level-up"),this.displayedLevel=t},S.prototype.endSequentialAnimations=function(){return clearInterval(this.sequentialAnimationInterval),this.animationComplete=!0,this.updateSavingProgressStatus(),Backbone.Mediator.publish("music-player:enter-menu",{terrain:this.level.get("terrain",!0)||"forest"})},S.prototype.updateSavingProgressStatus=function(){return this.$el.find("#saving-progress-label").toggleClass("hide",this.readyToContinue),this.$el.find(".next-level-button").toggleClass("hide",!this.readyToContinue),this.$el.find(".sign-up-poke").toggleClass("hide",!this.readyToContinue)},S.prototype.onGameSubmitted=function(e){return this.returnToLadder()},S.prototype.returnToLadder=function(){var e,t,i=[{supermodel:this.options.hasReceivedMemoryWarning?null:this.supermodel},this.level.get("slug")],n="/play/ladder/"+(this.level.get("slug")||this.level.id);return(t=this.courseInstanceID||x.getQueryVariable("league"))&&(e=this.level.isType("course-ladder")?"course":"clan",i.push(e),i.push(t),n+="/"+e+"/"+t,(t=x.getQueryVariable("tournament"))&&(n+="?tournament="+t)),n+="#my-matches",this.hide(),Backbone.Mediator.publish("router:navigate",{route:n,viewClass:"views/ladder/LadderView",viewArgs:i})},S.prototype.playSelectionSound=function(e,t){var i;if(null==t&&(t=!1),(e=null!=(e=e.get("soundTriggers"))?e.selected:void 0)&&(i=e[Math.floor(Math.random()*e.length)]))return e=n.nameForSoundReference(i),t?n.preloadSoundReference(i):n.playSound(e,1)},S.prototype.getNextLevelCampaign=function(){var e=this.level.get("campaign"),t=this.level.get("slug");return 0<=b.call(h,t)&&(e=""),e=k.getHocCampaign()?k.getHocCampaign():e},S.prototype.getNextLevelLink=function(e){var t;return null==e&&(e=!1),this.level.isType("course")?(t="/students",this.courseID&&(t+="/"+this.courseID,this.courseInstanceID&&(t+="/"+this.courseInstanceID))):(t="/play",t+="/"+this.getNextLevelCampaign()),t},S.prototype.onClickContinue=function(e,t){var i,n,o,s,r,a;return null==t&&(t=null),this.playSound("menu-button-click"),i=this.getNextLevelLink(null!=t?t.returnToCourse:void 0),n={justBeatLevel:this.level,supermodel:this.options.hasReceivedMemoryWarning?null:this.supermodel},t&&_.merge(n,t),this.showHoc2016ExploreButton?(i="/play",a="views/play/CampaignView",r=[n]):this.level.isType("course")&&this.nextLevel&&!n.returnToCourse?(a="views/play/level/PlayLevelView",n.courseID=this.courseID,n.courseInstanceID=this.courseInstanceID,r=[n,this.nextLevel.get("slug")]):this.level.isType("course")?(a="views/courses/CoursesView",r=[n],this.courseID&&(a="views/courses/CourseDetailsView",r.push(this.courseID),this.courseInstanceID&&r.push(this.courseInstanceID))):this.level.isType("course-ladder")?(o=this.courseInstanceID||x.getQueryVariable("league"),i="/play/ladder/"+this.level.get("slug"),o&&(i+="/course/"+o),a="views/ladder/LadderView",r=[n,this.level.get("slug")],o&&(r=r.concat(["course",o]))):(o=this.level.get("slug"),0<=b.call(h,o)&&(n.worldComplete=this.level.get("campaign")||!0),a="views/play/CampaignView",r=[n,this.getNextLevelCampaign()]),r={route:i,viewClass:a,viewArgs:r},"lost-viking"===this.level.get("slug")&&"0-13"!==(s=me.get("age"))&&"14-17"!==s?this.showOffer(r):(this.hide(),Backbone.Mediator.publish("router:navigate",r))},S.prototype.onClickLeaderboard=function(e){return this.onClickContinue(e,{showLeaderboard:!0})},S.prototype.onClickReturnToCourse=function(e){return this.onClickContinue(e,{returnToCourse:!0})},S.prototype.onClickReturnToLadder=function(e){return this.playSound("menu-button-click"),e.preventDefault(),this.returnToLadder()},S.prototype.onClickSignupButton=function(e){return e.preventDefault(),null!=(e=window.tracker)&&e.trackEvent("Started Signup",{category:"Play Level",label:"Hero Victory Modal",level:this.level.get("slug")}),me.isInHourOfCode()&&(window.nextURL=window.location.href),this.openModalView(new s)},S.prototype.showOffer=function(e){return this.navigationEventUponCompletion=e,this.$el.find(".modal-footer > *").hide(),this.$el.find(".modal-footer > .offer."+this.level.get("slug")).show()},S.prototype.onClickContinueFromOffer=function(e){var t={"lost-viking":"http://www.vikingcodeschool.com/codecombat?utm_source=codecombat&utm_medium=viking_level&utm_campaign=affiliate&ref=Code+Combat+Elite"}[this.level.get("slug")];if(this.hide(),Backbone.Mediator.publish("router:navigate",this.navigationEventUponCompletion),t)return window.open(t,"_blank")},S.prototype.onClickSkipOffer=function(e){return this.hide(),Backbone.Mediator.publish("router:navigate",this.navigationEventUponCompletion)},S.prototype.onClickShareLevelButton=function(){return this.$("#share-level-input").val(this.shareURL).select(),this.tryCopy()},S.prototype.onClickAmazonHocButton=function(){var e;return null!=(e=window.tracker)&&e.trackEvent("Click Amazon Modal Button"),this.openModalView(new i)},S.prototype.onSubscribeButtonClicked=function(){return this.openModalView(new l)},S.prototype.onChangeShareGameWithTeacherInput=function(e){var t=_.string.trim(this.$("#share-game-with-teacher-input").val()),t=p.validateEmail(t)&&!/codecombat/i.test(t);return this.$("#share-game-with-teacher-btn").attr("disabled",!t).text(w.i18n.t("common.send"))},S.prototype.onClickShareGameWithTeacherButton=function(e){var t,i,n=_.string.trim(this.$("#share-game-with-teacher-input").attr("disabled",!0).val());return this.$("#share-game-with-teacher-btn").attr("disabled",!0).text(w.i18n.t("common.sending")),u.sendTeacherGameDevProjectShare({teacherEmail:n,sessionId:this.session.id,codeLanguage:this.session.get("codeLanguage")||"python",levelName:x.i18n(this.level.attributes,"name")}).then((i=this,function(){return i.$("#share-game-with-teacher-btn").text(w.i18n.t("common.sent"))})).catch((t=this,function(){return t.$("#share-game-with-teacher-input").attr("disabled",!1).focus(),t.$("#share-game-with-teacher-btn").text(w.i18n.t("loading_error.error"))}))},S.prototype.starNum=function(e){return e.prevAll("i").length+1},S.prototype.showStars=function(e){var t;return this.$el.find(".rating").show(),null==e&&(e=(null!=(t=this.feedback)?t.get("rating"):void 0)||0),(t=this.$el.find(".rating i")).removeClass("glyphicon-star").addClass("glyphicon-star-empty"),t.slice(0,e).removeClass("glyphicon-star-empty").addClass("glyphicon-star")},S.prototype.setStars=function(e){return this.feedback.set("rating",e),this.feedback.save()},S.prototype.saveReviewEventually=function(){return this.saveReview()},S.prototype.saveReview=function(){return this.feedback.set("review",this.$el.find(".review textarea").val()),this.feedback.save()},S),h=["kithgard-gates","kithgard-mastery","tabula-rasa","wanted-poster","siege-of-stonehold","go-fetch","game-dev-2-final-project","quizlet","clash-of-clones","game-dev-3-final-project","summits-gate"]}.call(this,T(3),T(17))},2647:function(e,t,i){var n=i(2648);(n="string"==typeof n?[[e.i,n,""]]:n).locals&&(e.exports=n.locals);(0,i(21).default)("6ed9deaa",n,!0,{})},2648:function(e,t,i){},2649:function(e,t,i){!function(t){var _=i(11);e.exports=function(e){var v,b=[],e=e||{};return function(h,e,t,i,n,u,o,s,p,r,a,l,c,d,m,f,g,y){b.push('<div class="modal-dialog game"><div class="background-wrapper"><div class="modal-content"><div class="modal-header">'),y.closeButton&&b.push('<div type="button" data-dismiss="modal" aria-hidden="true" class="button close">&times;</div>'),b.push('<div id="victory-header" class="out"><div id="victory-title">'),p.get("preferredLanguage")&&"en"!=p.get("preferredLanguage").split("-")[0]?b.push('<h1 data-i18n="play_level.victory">Victory</h1>'):b.push('<img src="/images/pages/play/level/modal/victory_word.png" draggable="false">'),b.push('</div></div></div><div class="modal-body">'),g&&b.push('<div id="victory-text" dir="auto">'+_.escape(null==(v=g)?"":v)+"</div>"),o&&(b.push('<div class="course-name-container">'),t&&b.push('<p><span data-i18n="play_level.course" class="spr level-title"></span><span dir="auto" class="level-name">'+_.escape(null==(v=t)?"":v)+"</span></p>"),b.push('</div><div class="container-fluid"><div class="row"><div class="col-md-6">'),i&&b.push('<div data-i18n="play_level.completed_level" class="level-title"></div><div dir="auto" class="level-name">'+_.escape(null==(v=i.replace("Course: ",""))?"":v)+"</div>"),b.push('</div><div class="col-md-6">'),r?b.push('<div data-i18n="play_level.next_level" class="level-title"></div><div dir="auto" class="level-name">'+_.escape(null==(v=r.replace("Course: ",""))?"":v)+"</div>"):b.push('<div data-i18n="play_level.course" class="level-title"></div><div data-i18n="play_level.victory_title_suffix" class="level-name"></div>'),b.push("</div></div></div><br>")),b.push('<div id="level-feedback"><div class="rating secret rtl-allowed"><div data-i18n="play_level.victory_rate_the_level" class="rating-label">Rate the level:</div><i class="glyphicon glyphicon-star-empty"></i><i class="glyphicon glyphicon-star-empty"></i><i class="glyphicon glyphicon-star-empty"></i><i class="glyphicon glyphicon-star-empty"></i><i class="glyphicon glyphicon-star-empty"></i></div>'),p.get("anonymous")||b.push('<span data-i18n="play_level.victory_review" class="review-label secret">Tell us more!</span><div class="review secret"><br><textarea data-i18n="[placeholder]play_level.victory_review_placeholder"></textarea></div>'),b.push('<div class="clearfix"></div></div>'),s.isType("hero","hero-ladder","game-dev","web-dev","ladder")&&function(){var e=h;if("number"==typeof e.length)for(var t=0,i=e.length;t<i;t++)(n=e[t]).get("hidden")||(o=n.completed&&!n.completedAWhileAgo,b.push("<div"+_.attr("data-achievement-id",n.id,!0,!0)+_.attr("data-animate",o,!0,!0)+_.cls(["achievement-panel",n.completedAWhileAgo?"earned":""],[null,!0])+">"),s=n.get("rewards")||{},b.push('<div dir="auto" class="achievement-description">'+_.escape(null==(v=n.description)?"":v)+'</div><div class="achievement-rewards">'),r=n.worth,a=n.previousWorth,l=n.gems,c=n.previousGems,r&&b.push("<div"+_.attr("data-number",r,!0,!0)+' data-number-unit="xp"'+_.attr("data-previous-number",a||0,!0,!0)+' class="reward-panel numerical xp"><div'+_.cls(["reward-image-container",o?"pending-reward-image":"show"],[null,!0])+'><img src="/images/pages/play/level/modal/reward_icon_xp.png"></div><div class="reward-text">'+_.escape(null==(v=o?"+0":"+"+r)?"":v)+"</div></div>"),l&&b.push("<div"+_.attr("data-number",l,!0,!0)+' data-number-unit="gem"'+_.attr("data-previous-number",c||0,!0,!0)+' class="reward-panel numerical gems"><div'+_.cls(["reward-image-container",o?"pending-reward-image":"show"],[null,!0])+'><img src="/images/pages/play/level/modal/reward_icon_gems.png"></div><div class="reward-text">'+_.escape(null==(v=o?"+0":"+"+l)?"":v)+"</div></div>"),s.heroes&&function(){var e=s.heroes;if("number"==typeof e.length)for(var t=0,i=e.length;t<i;t++){var n=e[t],n=m[n];b.push("<div"+_.attr("data-hero-thang-type",n.get("original"),!0,!0)+' class="reward-panel hero"><div'+_.cls(["reward-image-container",o?"pending-reward-image":"show"],[null,!0])+"><img"+_.attr("src",n.getPortraitURL(),!0,!0)+"></div>"),o?b.push('<div data-i18n="play_level.victory_new_hero" class="reward-text">New Hero</div>'):b.push('<div dir="auto" class="reward-text">'+_.escape(null==(v=u(n.attributes,"name"))?"":v)+"</div>"),b.push("</div>")}else{i=0;for(t in e){i++;n=e[t],n=m[n];b.push("<div"+_.attr("data-hero-thang-type",n.get("original"),!0,!0)+' class="reward-panel hero"><div'+_.cls(["reward-image-container",o?"pending-reward-image":"show"],[null,!0])+"><img"+_.attr("src",n.getPortraitURL(),!0,!0)+"></div>"),o?b.push('<div data-i18n="play_level.victory_new_hero" class="reward-text">New Hero</div>'):b.push('<div dir="auto" class="reward-text">'+_.escape(null==(v=u(n.attributes,"name"))?"":v)+"</div>"),b.push("</div>")}}}.call(this),s.items&&function(){var e=s.items;if("number"==typeof e.length)for(var t=0,i=e.length;t<i;t++){var n=e[t];(n=m[n]).get("subscriber")&&p.freeOnly()||(b.push("<div"+_.attr("data-item-thang-type",n.get("original"),!0,!0)+_.cls(["reward-panel","item",n.get("subscriber")?"premium":""],[null,null,!0])+">"),n.get("subscriber")&&b.push('<div class="reward-border"></div>'),b.push("<div"+_.cls(["reward-image-container",o?"pending-reward-image":"show"],[null,!0])+"><img"+_.attr("src",n.getPortraitURL(),!0,!0)+"></div>"),o?b.push('<div data-i18n="play_level.victory_new_item" class="reward-text">New Item</div>'):b.push('<div dir="auto" class="reward-text">'+_.escape(null==(v=u(n.attributes,"name"))?"":v)+"</div>"),b.push("</div>"))}else{i=0;for(t in e){i++;n=e[t];(n=m[n]).get("subscriber")&&p.freeOnly()||(b.push("<div"+_.attr("data-item-thang-type",n.get("original"),!0,!0)+_.cls(["reward-panel","item",n.get("subscriber")?"premium":""],[null,null,!0])+">"),n.get("subscriber")&&b.push('<div class="reward-border"></div>'),b.push("<div"+_.cls(["reward-image-container",o?"pending-reward-image":"show"],[null,!0])+"><img"+_.attr("src",n.getPortraitURL(),!0,!0)+"></div>"),o?b.push('<div data-i18n="play_level.victory_new_item" class="reward-text">New Item</div>'):b.push('<div dir="auto" class="reward-text">'+_.escape(null==(v=u(n.attributes,"name"))?"":v)+"</div>"),b.push("</div>"))}}}.call(this),b.push("</div></div>"));else{var n,o,s,r,a,l,c,i=0;for(t in e)i++,(n=e[t]).get("hidden")||(o=n.completed&&!n.completedAWhileAgo,b.push("<div"+_.attr("data-achievement-id",n.id,!0,!0)+_.attr("data-animate",o,!0,!0)+_.cls(["achievement-panel",n.completedAWhileAgo?"earned":""],[null,!0])+">"),s=n.get("rewards")||{},b.push('<div dir="auto" class="achievement-description">'+_.escape(null==(v=n.description)?"":v)+'</div><div class="achievement-rewards">'),r=n.worth,a=n.previousWorth,l=n.gems,c=n.previousGems,r&&b.push("<div"+_.attr("data-number",r,!0,!0)+' data-number-unit="xp"'+_.attr("data-previous-number",a||0,!0,!0)+' class="reward-panel numerical xp"><div'+_.cls(["reward-image-container",o?"pending-reward-image":"show"],[null,!0])+'><img src="/images/pages/play/level/modal/reward_icon_xp.png"></div><div class="reward-text">'+_.escape(null==(v=o?"+0":"+"+r)?"":v)+"</div></div>"),l&&b.push("<div"+_.attr("data-number",l,!0,!0)+' data-number-unit="gem"'+_.attr("data-previous-number",c||0,!0,!0)+' class="reward-panel numerical gems"><div'+_.cls(["reward-image-container",o?"pending-reward-image":"show"],[null,!0])+'><img src="/images/pages/play/level/modal/reward_icon_gems.png"></div><div class="reward-text">'+_.escape(null==(v=o?"+0":"+"+l)?"":v)+"</div></div>"),s.heroes&&function(){var e=s.heroes;if("number"==typeof e.length)for(var t=0,i=e.length;t<i;t++){var n=e[t],n=m[n];b.push("<div"+_.attr("data-hero-thang-type",n.get("original"),!0,!0)+' class="reward-panel hero"><div'+_.cls(["reward-image-container",o?"pending-reward-image":"show"],[null,!0])+"><img"+_.attr("src",n.getPortraitURL(),!0,!0)+"></div>"),o?b.push('<div data-i18n="play_level.victory_new_hero" class="reward-text">New Hero</div>'):b.push('<div dir="auto" class="reward-text">'+_.escape(null==(v=u(n.attributes,"name"))?"":v)+"</div>"),b.push("</div>")}else{i=0;for(t in e){i++;n=e[t],n=m[n];b.push("<div"+_.attr("data-hero-thang-type",n.get("original"),!0,!0)+' class="reward-panel hero"><div'+_.cls(["reward-image-container",o?"pending-reward-image":"show"],[null,!0])+"><img"+_.attr("src",n.getPortraitURL(),!0,!0)+"></div>"),o?b.push('<div data-i18n="play_level.victory_new_hero" class="reward-text">New Hero</div>'):b.push('<div dir="auto" class="reward-text">'+_.escape(null==(v=u(n.attributes,"name"))?"":v)+"</div>"),b.push("</div>")}}}.call(this),s.items&&function(){var e=s.items;if("number"==typeof e.length)for(var t=0,i=e.length;t<i;t++){var n=e[t];(n=m[n]).get("subscriber")&&p.freeOnly()||(b.push("<div"+_.attr("data-item-thang-type",n.get("original"),!0,!0)+_.cls(["reward-panel","item",n.get("subscriber")?"premium":""],[null,null,!0])+">"),n.get("subscriber")&&b.push('<div class="reward-border"></div>'),b.push("<div"+_.cls(["reward-image-container",o?"pending-reward-image":"show"],[null,!0])+"><img"+_.attr("src",n.getPortraitURL(),!0,!0)+"></div>"),o?b.push('<div data-i18n="play_level.victory_new_item" class="reward-text">New Item</div>'):b.push('<div dir="auto" class="reward-text">'+_.escape(null==(v=u(n.attributes,"name"))?"":v)+"</div>"),b.push("</div>"))}else{i=0;for(t in e){i++;n=e[t];(n=m[n]).get("subscriber")&&p.freeOnly()||(b.push("<div"+_.attr("data-item-thang-type",n.get("original"),!0,!0)+_.cls(["reward-panel","item",n.get("subscriber")?"premium":""],[null,null,!0])+">"),n.get("subscriber")&&b.push('<div class="reward-border"></div>'),b.push("<div"+_.cls(["reward-image-container",o?"pending-reward-image":"show"],[null,!0])+"><img"+_.attr("src",n.getPortraitURL(),!0,!0)+"></div>"),o?b.push('<div data-i18n="play_level.victory_new_item" class="reward-text">New Item</div>'):b.push('<div dir="auto" class="reward-text">'+_.escape(null==(v=u(n.attributes,"name"))?"":v)+"</div>"),b.push("</div>"))}}}.call(this),b.push("</div></div>"))}}.call(this),b.push('</div><div class="modal-body wait secret"><h3>Reticulating Splines...</h3><div class="progress progress-striped active"><div class="progress-bar"></div></div></div><div class="modal-footer"><div id="totals"'+_.cls([y.showShareGameWithTeacher?"hide":""],[!0])+'><div id="xp-wrapper" class="total-wrapper"><div id="xp-total" class="total-count">0</div><div class="total-label rtl-allowed"><span data-i18n="play_level.victory_experience_gained" class="spr">XP Gained</span>-<span data-i18n="general.player_level" class="spl spr">Level</span><span class="level">'+_.escape(null==(v=p.level())?"":v)+'</span></div><div class="xp-bar-outer"><div class="xp-bar-already-achieved"></div><div class="xp-bar-total"></div></div></div><div id="gem-wrapper" class="total-wrapper"><div id="gem-total" class="total-count">0</div><div data-i18n="play_level.victory_gems_gained" class="total-label">Gems Gained</div></div></div>'),y.shareURL&&(b.push('<div id="share-level-container"'+_.cls([y.showShareGameWithTeacher?"with-email":""],[!0])+'><span class="share-level-label">'),y.showShareGameWithTeacher?b.push('<span data-i18n="sharing.victory_share_prefix_short">Invite people to</span>'):b.push('<span data-i18n="sharing.victory_share_prefix">Share this link to invite your friends & family to</span>'),b.push("<span>"+_.escape(v=" ")+"</span><a"+_.attr("href",y.shareURL,!0,!0)+' target="_blank">'),y.level.isType("game-dev")?b.push('<span data-i18n="sharing.victory_share_game">play your game level</span>'):b.push('<span data-i18n="sharing.victory_share_web">view your webpage</span>'),b.push('</a><span data-i18n="sharing.victory_share_suffix">.</span></span>'),y.showShareGameWithTeacher&&b.push('<div class="row"><div class="col-sm-4"><div data-i18n="sharing.share_with_teacher_email" class="share-level-label">Send to your teacher</div></div><div class="col-sm-5"><input id="share-game-with-teacher-input" data-i18n="[placeholder]anonymous_teacher.teacher_email_placeholder" class="text-h4 semibold form-control input-md"></div><div class="col-sm-3"><button id="share-game-with-teacher-btn" disabled data-i18n="common.send" class="btn btn-illustrated btn-success btn-md">Send</button></div></div>'),b.push('<div class="row">'),y.showShareGameWithTeacher?b.push('<div class="col-sm-4"><div data-i18n="sharing.share_this_link" class="share-level-label">Share this link</div></div><div class="col-sm-5"><input id="share-level-input"'+_.attr("value",y.shareURL,!0,!0)+' class="text-h4 semibold form-control input-md"></div>'):b.push('<div class="col-sm-9"><input id="share-level-input"'+_.attr("value",y.shareURL,!0,!0)+' class="text-h4 semibold form-control input-md"></div>'),b.push('<div class="col-sm-3"><button id="share-level-btn" class="btn btn-md btn-success btn-illustrated"><span data-i18n="sharing.copy_url">Copy URL</span></button></div></div></div>')),!p.get("anonymous")||n.noAuth||l?p.isPremium()||p.freeOnly()||l||e.getHocCampaign()||p.isStudent()||p.isTeacher()||b.push('<button data-dismiss="modal" data-i18n="subscribe.subscribe_title" class="btn subscribe-button"></button>'):b.push('<div class="sign-up-poke hide"><div data-i18n="play_level.victory_sign_up_poke" class="sign-up-blurb"></div><button data-dismiss="modal" data-i18n="play_level.victory_sign_up" class="btn btn-illustrated btn-warning sign-up-button btn-lg"></button></div>'),b.push('<button id="saving-progress-label" disabled data-i18n="play_level.victory_saving_progress" class="btn btn-illustrated btn-lg btn-warning hide">Saving Progress</button><div class="next-level-buttons">'),a?b.push('<div class="ladder-submission-view"></div>'):y.showAmazonHocButton?b.push('<button id="amazon-hoc-button" data-i18n="play_level.keep_learning" class="btn btn-illustrated btn-success btn-lg world-map-button next-level-button hide"></button>'):y.showHoc2016ExploreButton?b.push('<button id="continue-button" data-i18n="play_level.explore_codecombat" class="btn btn-illustrated btn-success btn-lg world-map-button next-level-button hide"></button>'):s.isType("hero-ladder","ladder")?b.push("<button"+_.attr("data-href","/play/ladder/"+s.get("slug")+"#my-matches",!0,!0)+' data-dismiss="modal" data-i18n="play_level.victory_return_to_ladder" class="btn btn-illustrated btn-primary btn-lg return-to-ladder-button">Return to Ladder</button>'):b.push('<button id="continue-button" data-i18n="common.continue" class="btn btn-illustrated btn-success btn-lg world-map-button next-level-button hide">Continue</button>'),b.push("</div>"),p.get("anonymous")||l||!c?d&&b.push('<button data-dismiss="modal" data-i18n="play_level.victory_go_home" class="btn btn-illustrated btn-warning return-to-course-button btn-lg">Go Home</button>'):b.push('<button data-dismiss="modal" data-i18n="leaderboard.view_other_solutions" class="btn btn-illustrated btn-success leaderboard-button btn-lg"></button>'),l&&b.push('<div class="hour-of-code-done"><div data-i18n="play_level.get_certificate" class="hoc-label"></div><a href="https://code.org/api/hour/finish" data-i18n="play_level.finished_hoc" target="_blank" class="btn btn-md btn-illustrated"></a></div>'),"lost-viking"==y.level.get("slug")&&b.push('<div class="offer lost-viking"><p><img src="/file/db/level/55144b509f0c4854051769c1/viking1.png" class="pull-left"><img src="/file/db/level/55144b509f0c4854051769c1/viking_2.png" class="pull-right"><span data-i18n="play_level.victory_viking_code_school"></span></p><button data-i18n="play_level.victory_become_a_viking" class="btn btn-illustrated btn-primary btn-lg world-map-button continue-from-offer-button">Become a Viking</button></div>'),b.push("</div></div></div></div>")}.call(this,"achievements"in e?e.achievements:"undefined"!=typeof achievements?achievements:void 0,"application"in e?e.application:void 0!==t?t:void 0,"currentCourseName"in e?e.currentCourseName:"undefined"!=typeof currentCourseName?currentCourseName:void 0,"currentLevelName"in e?e.currentLevelName:"undefined"!=typeof currentLevelName?currentLevelName:void 0,"features"in e?e.features:"undefined"!=typeof features?features:void 0,"i18n"in e?e.i18n:"undefined"!=typeof i18n?i18n:void 0,"isCourseLevel"in e?e.isCourseLevel:"undefined"!=typeof isCourseLevel?isCourseLevel:void 0,"level"in e?e.level:"undefined"!=typeof level?level:void 0,"me"in e?e.me:"undefined"!=typeof me?me:void 0,"nextLevelName"in e?e.nextLevelName:"undefined"!=typeof nextLevelName?nextLevelName:void 0,"readyToRank"in e?e.readyToRank:"undefined"!=typeof readyToRank?readyToRank:void 0,"showHourOfCodeDoneButton"in e?e.showHourOfCodeDoneButton:"undefined"!=typeof showHourOfCodeDoneButton?showHourOfCodeDoneButton:void 0,"showLeaderboard"in e?e.showLeaderboard:"undefined"!=typeof showLeaderboard?showLeaderboard:void 0,"showReturnToCourse"in e?e.showReturnToCourse:"undefined"!=typeof showReturnToCourse?showReturnToCourse:void 0,"thangTypes"in e?e.thangTypes:"undefined"!=typeof thangTypes?thangTypes:void 0,"undefined"in e?e.undefined:void 0,"victoryText"in e?e.victoryText:"undefined"!=typeof victoryText?victoryText:void 0,"view"in e?e.view:"undefined"!=typeof view?view:void 0),b.join("")}}.call(this,i(17))},2650:function(v,e,b){!function(n){var r,a,l,c,t,h,u,p,e,i,d,o,s,m,f,g={}.hasOwnProperty;function y(){return y.__super__.constructor.apply(this,arguments)}b(2240),e=b(80),s=b(2652),h=b(267),l=b(1376),b(1375),u=b(1398),i=b(1935),a=b(116),f=b(6),d=b(46),m=b(1421),o=b(52),t=b(2653).default,c=b(2656),r=b(1521),p=b(1742),v.exports=(function(e,t){for(var i in t)g.call(t,i)&&(e[i]=t[i]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(y,e),y.prototype.id="course-victory-modal",y.prototype.template=s,y.prototype.closesOnClickOutside=!1,y.prototype.initialize=function(e){var t,i,n,o,s;if(this.courseID=e.courseID,this.courseInstanceID=e.courseInstanceID||f.getQueryVariable("course-instance")||f.getQueryVariable("league"),!features.china||this.courseID||this.courseInstanceID||(this.courseID="560f1a9f22961295f9427742",this.courseInstanceID="5cb8403a60778e004634ee6e"),this.views=[],this.session=e.session,this.level=e.level,this.courseInstanceID&&(this.classroom=new a,this.supermodel.trackRequest(this.classroom.fetchForCourseInstance(this.courseInstanceID,{}))),this.playSound("victory"),this.nextLevel=new h,this.nextAssessment=new h,i=d.levels.fetchNextForCourse({levelOriginalID:this.level.get("original"),courseInstanceID:this.courseInstanceID,courseID:this.courseID,sessionID:this.session.id}).then((s=this,function(e){var t=e.level,e=e.assessment;return s.nextLevel.set(t),s.nextAssessment.set(e)})),this.supermodel.trackPromise(i),this.course=e.course,this.courseID&&!this.course&&(this.course=(new l).setURL("/db/course/"+this.courseID),this.course=this.supermodel.loadModel(this.course).model),this.courseInstanceID&&(this.course||(this.course=new l,this.supermodel.trackRequest(this.course.fetchForCourseInstance(this.courseInstanceID,{}))),this.level.isProject()&&(this.galleryURL=m.projectGallery({courseInstanceID:this.courseInstanceID}))),n={category:"Students",levelSlug:this.level.get("slug")},(i=this.level.get("goals").filter(function(e){return e.concepts}).map(function(e){return e.id})).length&&(t=this.session.get("state").goalStates,o=i.filter(function(e){return"success"===(null!=(e=t[e])?e.status:void 0)}),_.assign(n,{concepts:i,succeededConcepts:o})),null!=(o=window.tracker)&&o.trackEvent("Play Level Victory Modal Loaded",n,[]),this.level.isType("hero","course","course-ladder","game-dev","web-dev")&&(this.achievements=e.achievements,!this.achievements))return this.achievements=new r,this.achievements.fetchRelatedToLevel(this.session.get("level").original),this.achievements=this.supermodel.loadCollection(this.achievements,"achievements").model},y.prototype.onResourceLoadFailed=function(e){if(e.resource.jqxhr!==this.nextLevelRequest)return y.__super__.onResourceLoadFailed.apply(this,arguments)},y.prototype.onLoaded=function(){var e,t,i,n,o,s,r;if(y.__super__.onLoaded.call(this),this.views=[],me.showGemsAndXp()&&0<this.achievements.length){for(this.achievements.models=_.filter(this.achievements.models,function(e){return!(null!=(e=e.get("query"))&&e.ladderAchievementDifficulty)}),s=!1,t=0,i=(n=this.achievements.models).length;t<i;t++)(e=n[t]).completed=p.matchesQuery(this.session.attributes,e.get("query")),e.completed&&(s=!0);s&&((o=new c({level:this.level,session:this.session,achievements:this.achievements,supermodel:this.supermodel})).on("continue",this.onViewContinue,this),this.views.push(o))}return this.courseInstanceID?(this.levelSessions=new u,this.levelSessions.fetchForCourseInstance(this.courseInstanceID,{}).then((r=this,function(){return r.levelSessionsLoaded()}))):this.levelSessionsLoaded()},y.prototype.levelSessionsLoaded=function(){var e;return null!=(e=this.levelSessions)&&e.remove(this.session),null!=(e=this.levelSessions)&&e.add(this.session),this.loadViews()},y.prototype.loadViews=function(){var e;return(this.level.isLadder()||this.level.isProject())&&(null==this.courseID&&(this.courseID=this.course.id),(e=new i({level:this.level,nextLevel:this.nextLevel,nextAssessment:this.nextAssessment,course:this.course,classroom:this.classroom,levelSessions:this.levelSessions,session:this.session,courseInstanceID:this.courseInstanceID})).once("done",this.onDone,this),e.once("next-level",this.onNextLevel,this),e.once("start-challenge",this.onStartChallenge,this),e.once("to-map",this.onToMap,this),e.once("ladder",this.onLadder,this),e.once("publish",this.onPublish,this),this.views.push(e)),0<this.views.length?this.showView(_.first(this.views)):this.showVictoryComponent()},y.prototype.afterRender=function(){return y.__super__.afterRender.call(this),this.showView(this.currentView)},y.prototype.showView=function(e){if(e)return e.setElement(this.$(".modal-content")),e.$el.attr("id",e.id),e.$el.addClass(e.className),e.render(),this.currentView=e},y.prototype.onViewContinue=function(){var e;return this.level.isLadder()||this.level.isProject()?(e=_.indexOf(this.views,this.currentView),this.showView(this.views[e+1])):this.showVictoryComponent()},y.prototype.showVictoryComponent=function(){var e={nextLevel:this.nextLevel.toJSON(),nextAssessment:this.nextAssessment.toJSON(),level:this.level.toJSON(),session:this.session.toJSON(),course:this.course.toJSON(),courseInstanceID:this.courseInstanceID,stats:null!=(e=this.classroom)?e.statsForSessions(this.levelSessions,this.course.id):void 0,supermodel:this.supermodel,parent:this.options.parent,codeLanguage:this.session.get("codeLanguage")};return new t({el:this.$el.find(".modal-content")[0],propsData:e,store:o})},y.prototype.onNextLevel=function(){var e,t;return null!=(t=window.tracker)&&t.trackEvent("Play Level Victory Modal Next Level",{category:"Students",levelSlug:this.level.get("slug"),nextLevelSlug:this.nextLevel.get("slug")},[]),me.isSessionless()?e="/play/level/"+this.nextLevel.get("slug")+"?course="+this.courseID+"&codeLanguage="+f.getQueryVariable("codeLanguage","python"):(e="/play/level/"+this.nextLevel.get("slug")+"?course="+this.courseID+"&course-instance="+this.courseInstanceID,this.level.get("primerLanguage")&&(e+="&codeLanguage="+this.level.get("primerLanguage"))),n.router.navigate(e,{trigger:!0})},y.prototype.onToMap=function(){var e,t=me.isSessionless()?"/teachers/courses":"/play/"+this.course.get("campaignID")+"?course-instance="+this.courseInstanceID;return null!=(e=window.tracker)&&e.trackEvent("Play Level Victory Modal Back to Map",{category:"Students",levelSlug:this.level.get("slug")},[]),n.router.navigate(t,{trigger:!0})},y.prototype.onDone=function(){var e;return null!=(e=window.tracker)&&e.trackEvent("Play Level Victory Modal Done",{category:"Students",levelSlug:this.level.get("slug")},[]),e=me.isSessionless()?"/teachers/courses":"/students",this.submitLadder(),n.router.navigate(e,{trigger:!0})},y.prototype.onPublish=function(){var e,t,i;return null!=(e=window.tracker)&&e.trackEvent("Play Level Victory Modal Publish",{category:"Students",levelSlug:this.level.get("slug")},[]),this.session.isFake()?n.router.navigate(this.galleryURL,{trigger:!0}):(t=this.session.get("published"),this.session.set({published:!0}),this.session.save().then((i=this,function(){var e;if(n.router.navigate(i.galleryURL,{trigger:!0}),e=i18n.t("play_level.project_published_noty"),!t)return noty({text:e,layout:"topCenter",type:"success",timeout:5e3})})))},y.prototype.onLadder=function(){var e,t,i=[{supermodel:this.options.hasReceivedMemoryWarning?null:this.supermodel},this.level.get("slug")],n="/play/ladder/"+(this.level.get("slug")||this.level.id);return(e=this.courseInstanceID||f.getQueryVariable("league"))&&(t="course-ladder"===this.level.get("type")?"course":"clan",i.push(t),i.push(e),n+="/"+t+"/"+e),n+="#my-matches",this.submitLadder(),Backbone.Mediator.publish("router:navigate",{route:n,viewClass:"views/ladder/LadderView",viewArgs:i})},y.prototype.submitLadder=function(){if(!n.testing)return"course-ladder"===this.level.get("type")&&this.session.readyToRank()||!this.session.inLeague(this.courseInstanceID)?d.levelSessions.submitToRank({session:this.session.id,courseInstanceId:this.courseInstanceID}):void 0},y)}.call(this,b(17))},2651:function(e,t,i){},2652:function(e,t,i){i(11);e.exports=function(e){var t=[];return t.push('<div class="modal-dialog"><div class="background-wrapper"><div class="modal-content"><div class="modal-body"></div></div></div></div>'),t.join("")}},2653:function(e,t,i){"use strict";i.r(t);var n,o=i(3049),s=i(1939);for(n in s)["default"].indexOf(n)<0&&function(e){i.d(t,e,function(){return s[e]})}(n);i(2654);var r=i(19),o=Object(r.a)(s.default,o.a,o.b,!1,null,null,null);t.default=o.exports},2654:function(e,t,i){"use strict";var n=i(1941);i.n(n).a},2655:function(e,t,i){},2656:function(i,e,n){!function(a){var e,m,f,g,t=function(e,t){return function(){return e.apply(t,arguments)}},o={}.hasOwnProperty;function y(){return this.tickSequentialAnimation=t(this.tickSequentialAnimation,this),y.__super__.constructor.apply(this,arguments)}n(2657),e=n(26),f=n(1374),m=n(624),g=n(6),n(37),i.exports=(function(e,t){for(var i in t)o.call(t,i)&&(e[i]=t[i]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(y,e),y.prototype.id="course-rewards-view",y.prototype.className="modal-content",y.prototype.template=n(2659),y.prototype.events={"click #continue-btn":"onClickContinueButton"},y.prototype.initialize=function(e){return y.__super__.initialize.call(this),this.level=e.level,this.session=e.session,this.thangTypes={},this.achievements=e.achievements},y.prototype.render=function(){return this.loadAchievementsData(),this.previousXP=me.get("points",!0),this.previousLevel=me.level(),y.__super__.render.call(this)},y.prototype.afterRender=function(){return y.__super__.afterRender.call(this),this.initializeAnimations()},y.prototype.onClickContinueButton=function(){return this.trigger("continue")},y.prototype.loadAchievementsData=function(){for(var e,o,t,i,n,s,r,a,l,c,h=[],u=this.achievements.models,p=0,d=u.length;p<d;p++)l=(e=u[p]).get("rewards")||{},h.push(l.items||[]);for(i=0,s=(h=_.uniq(_.flatten(h))).length;i<s;i++)t=h[i],(c=new f).url="/db/thang.type/"+t+"/version",c.project=["original","rasterIcon","name","slug","soundTriggers","featureImages","gems","heroClass","description","components","extendedName","shortName","unlockLevelName","i18n","subscriber"],this.thangTypes[t]=this.supermodel.loadModel(c).model;for(this.newEarnedAchievements=[],n=0,r=(a=this.achievements.models).length;n<r;n++)(e=a[n]).completed&&(o=new m({collection:e.get("collection"),triggeredBy:this.session.id,achievement:e.id}),me.isSessionless()?this.newEarnedAchievements.push(o):(o.save(),this.newEarnedAchievements.push(o),this.listenToOnce(o,"sync",function(e){if(_.all(function(){for(var e=this.newEarnedAchievements,t=[],i=0,n=e.length;i<n;i++)o=e[i],t.push(o.id);return t}.call(this))&&(me.loading||this.supermodel.loadModel(me,{cache:!1}),this.newEarnedAchievementsResource.markLoaded()),!me.loading)return me.fetch({cache:!1})})));if(!me.isSessionless()&&this.newEarnedAchievements.length)return this.newEarnedAchievementsResource=this.supermodel.addSomethingResource("earned achievements")},y.prototype.getRenderData=function(){for(var e,t,i,n,o,s,r,a,l,c,h,u=y.__super__.getRenderData.call(this),p=_.indexBy(this.newEarnedAchievements||[],function(e){return e.get("achievement")}),d=(null!=(l=this.achievements)?l.models:void 0)||[],m=0,f=d.length;m<f;m++)(a=p[(t=d[m]).id])&&(t.completedAWhileAgo=3e4<(new Date).getTime()-Date.parse(a.attributes.changed)),t.worth=t.get("worth",!0),t.gems=null!=(a=t.get("rewards"))?a.gems:void 0;for(u.achievements=(null!=(l=this.achievements)?l.models.slice():void 0)||[],n=0,o=(c=u.achievements).length;n<o;n++)(t=c[n]).description=g.i18n(t.attributes,"description"),this.supermodel.finished()&&(r=t.get("proportionalTo"))&&(e=g.getByPath(this.session.attributes,r),s=Math.max(0,e-1),i=t.getExpFunction(),t.previousWorth=(null!=(h=t.get("worth"))?h:0)*i(s),t.worth=(null!=(h=t.get("worth"))?h:0)*i(e),null!=(h=t.get("rewards"))&&h.gems&&(t.gems=(null!=h?h.gems:void 0)*i(e)),null!=h&&h.gems&&(t.previousGems=(null!=h?h.gems:void 0)*i(s)));return u.thangTypes=this.thangTypes,u},y.prototype.initializeAnimations=function(){var e,t,i,n,o;if(!this.level.isType("course","hero","course-ladder","game-dev","web-dev"))return this.endSequentialAnimations();for(e=_.once(_.bind(this.beginSequentialAnimations,this)),this.animatedPanels=a(),t=0,i=(o=this.$el.find(".achievement-panel")).length;t<i;t++)n=o[t],null!=(n=a(n)).data("animate")&&(this.animatedPanels=this.animatedPanels.add(n),n.queue(function(){return a(this).addClass("earned"),a(this).dequeue()}),n.delay(500),n.queue(function(){return a(this).find(".reward-image-container").addClass("show"),a(this).dequeue()}),n.delay(500),n.queue(function(){return e()}));return this.animationComplete=!this.animatedPanels.length,this.animationComplete?e():void 0},y.prototype.beginSequentialAnimations=function(){var e,t,i,n,o,s,r;if(!this.destroyed&&this.level.isType("course","hero","course-ladder","game-dev","web-dev")){for(this.sequentialAnimatedPanels=_.map(this.animatedPanels.find(".reward-panel"),function(e){return{number:a(e).data("number"),previousNumber:a(e).data("previous-number"),textEl:a(e).find(".reward-text"),rootEl:a(e),unit:a(e).data("number-unit"),item:a(e).data("item-thang-type")}}),e=this.totalXP=0,i=(s=this.sequentialAnimatedPanels).length;e<i;e++)"xp"===(o=s[e]).unit&&(this.totalXP+=o.number);for(t=this.totalGems=0,n=(r=this.sequentialAnimatedPanels).length;t<n;t++)"gem"===(o=r[t]).unit&&(this.totalGems+=o.number);return this.totalXPAnimated=this.totalGemsAnimated=this.lastTotalXP=this.lastTotalGems=0,this.sequentialAnimationStart=new Date,this.sequentialAnimationInterval=setInterval(this.tickSequentialAnimation,1e3/60)}},y.prototype.tickSequentialAnimation=function(){var e,t,i,n,o;return(t=this.sequentialAnimatedPanels[0])?(e=t.number?Math.log(t.number+1)/Math.LN10*1e3:1e3,i=this.getEaseRatio(new Date-this.sequentialAnimationStart,e),"xp"===t.unit?(e=Math.floor(i*(t.number-t.previousNumber)),(o=this.totalXPAnimated+e)!==this.lastTotalXP&&(t.textEl.text("+"+e),this.playSound("xp-"+o%6,.5+i/2),this.lastTotalXP=o)):"gem"===t.unit?(o=Math.floor(i*(t.number-t.previousNumber)),(n=this.totalGemsAnimated+o)!==this.lastTotalGems&&(t.textEl.text("+"+o),o="gem-"+parseInt(t.number*i)%4,this.playSound(o,.5+i/2),this.lastTotalGems=n)):t.item&&(n=this.thangTypes[t.item],t.textEl.text(g.i18n(n.attributes,"name")),.5<i&&i<.6&&this.playSound("item-unlocked")),1===i?(t.rootEl.removeClass("animating").find(".reward-image-container img").removeClass("pulse"),this.sequentialAnimationStart=new Date,"xp"===t.unit?this.totalXPAnimated+=t.number-t.previousNumber:"gem"===t.unit&&(this.totalGemsAnimated+=t.number-t.previousNumber),void this.sequentialAnimatedPanels.shift()):t.rootEl.addClass("animating").find(".reward-image-container").removeClass("pending-reward-image").find("img").addClass("pulse")):this.endSequentialAnimations()},y.prototype.getEaseRatio=function(e,t){return(t=2*(e=Math.min(e,t))/t)<1?.5*t*t:-.5*(--t*(t-2)-1)},y.prototype.endSequentialAnimations=function(){return clearInterval(this.sequentialAnimationInterval),this.animationComplete=!0,Backbone.Mediator.publish("music-player:enter-menu",{terrain:this.level.get("terrain",!0)||"forest"})},y)}.call(this,n(3))},2657:function(e,t,i){var n=i(2658);(n="string"==typeof n?[[e.i,n,""]]:n).locals&&(e.exports=n.locals);(0,i(21).default)("aa574eb2",n,!0,{})},2658:function(e,t,i){},2659:function(e,t,i){var g=i(11);e.exports=function(e){var m,f=[],e=e||{};return function(h,u,p,d,e){f.push('<div class="modal-header"><div id="rewards-header"><img src="/images/pages/play/modal/level_complete.png" class="header-img"><div id="close-modal" data-dismiss="modal" class="btn well well-sm well-parchment"><span class="glyphicon glyphicon-remove"></span></div></div></div><div class="modal-body"><div class="container-fluid"><div class="row">'),function(){var e=h;if("number"==typeof e.length)for(var t=0,i=e.length;t<i;t++)(n=e[t]).get("hidden")||(o=n.completed&&!n.completedAWhileAgo,f.push("<div"+g.attr("data-achievement-id",n.id,!0,!0)+g.attr("data-animate",o,!0,!0)+g.cls(["achievement-panel",n.completedAWhileAgo?"earned":""],[null,!0])+">"),s=n.get("rewards")||{},f.push('<div dir="auto" class="achievement-description">'+g.escape(null==(m=n.description)?"":m)+'</div><div class="achievement-rewards">'),r=n.worth,a=n.previousWorth,l=n.gems,c=n.previousGems,r&&f.push("<div"+g.attr("data-number",r,!0,!0)+' data-number-unit="xp"'+g.attr("data-previous-number",a||0,!0,!0)+' class="reward-panel numerical xp"><div'+g.cls(["reward-image-container",o?"pending-reward-image":"show"],[null,!0])+'><img src="/images/pages/play/level/modal/reward_icon_xp.png"></div><div class="reward-text">'+g.escape(null==(m=o?"+0":"+"+r)?"":m)+"</div></div>"),l&&f.push("<div"+g.attr("data-number",l,!0,!0)+' data-number-unit="gem"'+g.attr("data-previous-number",c||0,!0,!0)+' class="reward-panel numerical gems"><div'+g.cls(["reward-image-container",o?"pending-reward-image":"show"],[null,!0])+'><img src="/images/pages/play/level/modal/reward_icon_gems.png"></div><div class="reward-text">'+g.escape(null==(m=o?"+0":"+"+l)?"":m)+"</div></div>"),s.items&&function(){var e=s.items;if("number"==typeof e.length)for(var t=0,i=e.length;t<i;t++){var n=e[t];(n=d[n]).get("subscriber")&&p.freeOnly()||(f.push("<div"+g.attr("data-item-thang-type",n.get("original"),!0,!0)+g.cls(["reward-panel","item",n.get("subscriber")?"premium":""],[null,null,!0])+">"),n.get("subscriber")&&f.push('<div class="reward-border"></div>'),f.push("<div"+g.cls(["reward-image-container",o?"pending-reward-image":"show"],[null,!0])+"><img"+g.attr("src",n.getPortraitURL(),!0,!0)+"></div>"),o?f.push('<div data-i18n="play_level.victory_new_item" class="reward-text">New Item</div>'):f.push('<div dir="auto" class="reward-text">'+g.escape(null==(m=u(n.attributes,"name"))?"":m)+"</div>"),f.push("</div>"))}else{i=0;for(t in e){i++;n=e[t];(n=d[n]).get("subscriber")&&p.freeOnly()||(f.push("<div"+g.attr("data-item-thang-type",n.get("original"),!0,!0)+g.cls(["reward-panel","item",n.get("subscriber")?"premium":""],[null,null,!0])+">"),n.get("subscriber")&&f.push('<div class="reward-border"></div>'),f.push("<div"+g.cls(["reward-image-container",o?"pending-reward-image":"show"],[null,!0])+"><img"+g.attr("src",n.getPortraitURL(),!0,!0)+"></div>"),o?f.push('<div data-i18n="play_level.victory_new_item" class="reward-text">New Item</div>'):f.push('<div dir="auto" class="reward-text">'+g.escape(null==(m=u(n.attributes,"name"))?"":m)+"</div>"),f.push("</div>"))}}}.call(this),f.push("</div></div>"));else{var n,o,s,r,a,l,c,i=0;for(t in e)i++,(n=e[t]).get("hidden")||(o=n.completed&&!n.completedAWhileAgo,f.push("<div"+g.attr("data-achievement-id",n.id,!0,!0)+g.attr("data-animate",o,!0,!0)+g.cls(["achievement-panel",n.completedAWhileAgo?"earned":""],[null,!0])+">"),s=n.get("rewards")||{},f.push('<div dir="auto" class="achievement-description">'+g.escape(null==(m=n.description)?"":m)+'</div><div class="achievement-rewards">'),r=n.worth,a=n.previousWorth,l=n.gems,c=n.previousGems,r&&f.push("<div"+g.attr("data-number",r,!0,!0)+' data-number-unit="xp"'+g.attr("data-previous-number",a||0,!0,!0)+' class="reward-panel numerical xp"><div'+g.cls(["reward-image-container",o?"pending-reward-image":"show"],[null,!0])+'><img src="/images/pages/play/level/modal/reward_icon_xp.png"></div><div class="reward-text">'+g.escape(null==(m=o?"+0":"+"+r)?"":m)+"</div></div>"),l&&f.push("<div"+g.attr("data-number",l,!0,!0)+' data-number-unit="gem"'+g.attr("data-previous-number",c||0,!0,!0)+' class="reward-panel numerical gems"><div'+g.cls(["reward-image-container",o?"pending-reward-image":"show"],[null,!0])+'><img src="/images/pages/play/level/modal/reward_icon_gems.png"></div><div class="reward-text">'+g.escape(null==(m=o?"+0":"+"+l)?"":m)+"</div></div>"),s.items&&function(){var e=s.items;if("number"==typeof e.length)for(var t=0,i=e.length;t<i;t++){var n=e[t];(n=d[n]).get("subscriber")&&p.freeOnly()||(f.push("<div"+g.attr("data-item-thang-type",n.get("original"),!0,!0)+g.cls(["reward-panel","item",n.get("subscriber")?"premium":""],[null,null,!0])+">"),n.get("subscriber")&&f.push('<div class="reward-border"></div>'),f.push("<div"+g.cls(["reward-image-container",o?"pending-reward-image":"show"],[null,!0])+"><img"+g.attr("src",n.getPortraitURL(),!0,!0)+"></div>"),o?f.push('<div data-i18n="play_level.victory_new_item" class="reward-text">New Item</div>'):f.push('<div dir="auto" class="reward-text">'+g.escape(null==(m=u(n.attributes,"name"))?"":m)+"</div>"),f.push("</div>"))}else{i=0;for(t in e){i++;n=e[t];(n=d[n]).get("subscriber")&&p.freeOnly()||(f.push("<div"+g.attr("data-item-thang-type",n.get("original"),!0,!0)+g.cls(["reward-panel","item",n.get("subscriber")?"premium":""],[null,null,!0])+">"),n.get("subscriber")&&f.push('<div class="reward-border"></div>'),f.push("<div"+g.cls(["reward-image-container",o?"pending-reward-image":"show"],[null,!0])+"><img"+g.attr("src",n.getPortraitURL(),!0,!0)+"></div>"),o?f.push('<div data-i18n="play_level.victory_new_item" class="reward-text">New Item</div>'):f.push('<div dir="auto" class="reward-text">'+g.escape(null==(m=u(n.attributes,"name"))?"":m)+"</div>"),f.push("</div>"))}}}.call(this),f.push("</div></div>"))}}.call(this),f.push('</div><div class="row"><div class="col-sm-3 col-sm-offset-9"><button id="continue-btn" data-i18n="common.continue" class="btn btn-illustrated btn-primary btn-block btn-lg text-uppercase"></button></div></div></div></div>')}.call(this,"achievements"in e?e.achievements:"undefined"!=typeof achievements?achievements:void 0,"i18n"in e?e.i18n:"undefined"!=typeof i18n?i18n:void 0,"me"in e?e.me:"undefined"!=typeof me?me:void 0,"thangTypes"in e?e.thangTypes:"undefined"!=typeof thangTypes?thangTypes:void 0,"undefined"in e?e.undefined:void 0),f.join("")}},2660:function(e,t,i){var n,o,s,r={}.hasOwnProperty;function a(){return a.__super__.constructor.apply(this,arguments)}i(2240),o=i(80),s=i(2661),n=i(267),e.exports=(function(e,t){for(var i in t)r.call(t,i)&&(e[i]=t[i]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(a,o),a.prototype.id="picoctf-victory-modal",a.prototype.template=s,a.prototype.closesOnClickOutside=!1,a.prototype.initialize=function(e){var t;return this.session=e.session,this.level=e.level,t={flag:e.world.picoCTFFlag,pid:this.level.picoCTFProblem.pid},this.supermodel.addRequestResource({url:"/picoctf/submit",method:"POST",data:t,success:function(e){return console.log("submitted",t,"and got response",e)}}).load(),(e=this.level.get("nextLevel"))&&(this.nextLevel=(new n).setURL("/db/level/"+e.original+"/version/"+e.majorVersion),this.nextLevel=this.supermodel.loadModel(this.nextLevel).model),this.playSound("victory")},a.prototype.onLoaded=function(){return a.__super__.onLoaded.call(this)},a)},2661:function(e,t,i){var o=i(11);e.exports=function(e){var i,n=[],e=e||{};return function(e,t){n.push('<div class="modal-dialog"><div class="background-wrapper"><div class="modal-content"><div class="modal-header"><div id="close-modal" data-dismiss="modal" class="well well-sm well-parchment"><span class="glyphicon glyphicon-remove"></span></div><div id="victory-header"><div id="victory-title">'),e.get("preferredLanguage")&&"en"!=e.get("preferredLanguage").split("-")[0]?n.push('<h1 data-i18n="play_level.victory">Victory</h1>'):n.push('<img src="/images/pages/play/level/modal/victory_word.png" draggable="false">'),n.push('</div></div></div><div class="modal-body"><div class="container-fluid"><div class="row">');e=t.level.get("victory");e&&e.body&&n.push('<div class="well well-sm well-parchment"><h3>'+o.escape(null==(i=e.body)?"":i)+"</h3></div>"),n.push('</div><div class="row">'),t.nextLevel&&t.nextLevel.get("slug")?n.push('<div class="col-sm-5 col-sm-offset-2"><a href="/play/picoctf" id="done-btn" class="btn btn-illustrated btn-primary btn-block btn-lg text-uppercase">Done</a></div><div class="col-sm-5"><a'+o.attr("href","/play/level/"+t.nextLevel.get("slug"),!0,!0)+' id="continue-button" class="btn btn-illustrated btn-success btn-block btn-lg text-uppercase">Continue</a></div>'):n.push('<div class="col-sm-5 col-sm-offset-2"></div><div class="col-sm-5"><a href="/play/picoctf" id="done-btn" class="btn btn-illustrated btn-primary btn-block btn-lg text-uppercase">Done</a></div>'),n.push("</div></div></div></div></div></div>")}.call(this,"me"in e?e.me:"undefined"!=typeof me?me:void 0,"view"in e?e.view:"undefined"!=typeof view?view:void 0),n.join("")}},2662:function(e,t,i){i(11);e.exports=function(e){var t=[],e=e||{};return function(e){t.push('<div class="modal-dialog game"><div class="background-wrapper"><div class="modal-content"><div class="modal-header">'),e.closeButton&&t.push('<div type="button" data-dismiss="modal" aria-hidden="true" class="button close">&times;</div>'),e.options.nonUserCodeProblem?t.push('<h3 data-i18n="play_level.non_user_code_problem_title">Unable to Load Level</h3>'):t.push('<h3 data-i18n="play_level.infinite_loop_title">Infinite Loop Detected</h3>'),t.push('</div><div class="modal-body"><div class="modal-body"><p data-i18n="play_level.infinite_loop_description">The initial code to build the world never finished running. It\'s probably either really slow or has an infinite loop. Or there might be a bug. You can either try running this code again or reset the code to the default state. If that doesn\'t fix it, please let us know.</p><p><span data-i18n="play_level.check_dev_console" class="spr">You can also open the developer console to see what might be going wrong.</span><a href="http://webmasters.stackexchange.com/questions/8525/how-to-open-the-javascript-console-in-different-browsers/77337#77337" data-i18n="play_level.check_dev_console_link" target="_blank">(instructions)</a></p></div></div><div class="modal-body wait secret"><h3>Reticulating Splines...</h3><div class="progress progress-striped active"><div class="progress-bar"></div></div></div><div class="modal-footer"><a href="#" data-dismiss="modal" aria-hidden="true" data-i18n="play_level.infinite_loop_try_again" id="restart-level-infinite-loop-retry-button" class="btn">Try Again</a><a href="#" data-dismiss="modal" aria-hidden="true" data-i18n="play_level.infinite_loop_reset_level" id="restart-level-infinite-loop-confirm-button" class="btn btn-danger">Reset Level</a><a href="#" data-dismiss="modal" aria-hidden="true" data-i18n="play_level.infinite_loop_comment_out" id="restart-level-infinite-loop-comment-button" class="btn btn-primary">Comment Out My Code</a></div></div></div></div>')}.call(this,"view"in e?e.view:"undefined"!=typeof view?view:void 0),t.join("")}},2663:function(e,t,i){var n,o={}.hasOwnProperty;function s(e){this.supermodel=e.supermodel,s.__super__.constructor.call(this,e),this.level=e.level,this.session=e.session}i(2664),n=i(26),e.exports=(function(e,t){for(var i in t)o.call(t,i)&&(e[i]=t[i]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(s,n),s.prototype.id="surface-context-menu-view",s.prototype.className="surface-context-menu",s.prototype.template=i(2666),s.prototype.events={"click #copy":"onClickCopy"},s.prototype.subscriptions={"level:surface-context-menu-pressed":"showView","level:surface-context-menu-hide":"hideView"},s.prototype.destroy=function(){return s.__super__.destroy.call(this)},s.prototype.afterInsert=function(){return s.__super__.afterInsert.call(this),this.hideView()},s.prototype.afterRender=function(){return s.__super__.afterRender.call(this)},s.prototype.onClickCopy=function(e){var t;return navigator.clipboard?navigator.clipboard.writeText(this.coordinates):document.queryCommandSupported("copy")?((t=document.createElement("textarea")).value=this.coordinates,document.body.appendChild(t),t.focus(),t.select(),document.execCommand("copy"),document.body.removeChild(t)):void 0},s.prototype.setPosition=function(e){return this.$el.css("left",e.posX),this.$el.css("top",e.posY)},s.prototype.setCoordinates=function(e){return this.coordinates=e.wopX+", "+e.wopY,e="copy "+this.coordinates,this.copyMessage=e},s.prototype.hideView=function(){return this.$el.hide()},s.prototype.showView=function(e){return this.$el.show(),this.setCoordinates(e),this.setPosition(e),this.render()},s)},2664:function(e,t,i){var n=i(2665);(n="string"==typeof n?[[e.i,n,""]]:n).locals&&(e.exports=n.locals);(0,i(21).default)("47614aeb",n,!0,{})},2665:function(e,t,i){},2666:function(e,t,i){i(11);e.exports=function(e){var t,i=[],e=e||{};return function(e){i.push('<ul class="menu-options"><li><div id="copy" class="menu-option">'+(null==(t=e.copyMessage)?"":t)+"</div></li></ul>")}.call(this,"view"in e?e.view:"undefined"!=typeof view?view:void 0),i.join("")}},2667:function(e,t,i){var n,o={}.hasOwnProperty;function s(){return s.__super__.constructor.apply(this,arguments)}n=i(1384),e.exports=(function(e,t){for(var i in t)o.call(t,i)&&(e[i]=t[i]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(s,Backbone.Model),s.prototype.initialize=function(e,t){return this.level=t.level,this.session=t.session,this.supermodel=t.supermodel,this.listenTo(this.level,"change:documentation",this.update),this.update()},s.prototype.getHint=function(e){var t;return null!=(t=this.get("hints"))?t[e]:void 0},s.prototype.update=function(){var s,r=this.supermodel.getModels(n),a=null!=(t=this.level.get("documentation"))?t:{},e=_.filter(function(){for(var e,t=a.generalArticles||[],i=[],n=0,o=t.length;n<o;n++)s=t[n],i.push(null!=(e=_.find(r,function(e){return e.get("original")===s.original}))?e.attributes:void 0);return i}()),t=a.specificArticles||[],t=(a.hintsB||a.hints||[]).concat(t).concat(me.useGeneralArticle()?e:[]);return t=_.sortBy(t,function(e){return"Intro"===e.name?-1:0}),e=_.size(t),this.set({hints:t,total:e})},s)},2668:function(e,t,i){var n=i(2669);(n="string"==typeof n?[[e.i,n,""]]:n).locals&&(e.exports=n.locals);(0,i(21).default)("6adae656",n,!0,{})},2669:function(e,t,i){},2670:function(e,t,i){var n,o={}.hasOwnProperty;function s(){return s.__super__.constructor.apply(this,arguments)}i(2671),n=i(80),e.exports=(function(e,t){for(var i in t)o.call(t,i)&&(e[i]=t[i]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(s,n),s.prototype.id="game-dev-victory-modal",s.prototype.template=i(2673),s.prototype.events={"click #replay-game-btn":"onClickReplayButton","click #copy-url-btn":"onClickCopyURLButton","click #play-more-codecombat-btn":"onClickPlayMoreCodeCombatButton"},s.prototype.initialize=function(e){this.shareURL=e.shareURL,this.eventProperties=e.eventProperties,this.victoryMessage=e.victoryMessage},s.prototype.getVictoryMessage=function(){var e;return null!=(e=this.victoryMessage)?e:"You beat the game!"},s.prototype.onClickReplayButton=function(){return this.trigger("replay")},s.prototype.onClickCopyURLButton=function(){var e;return this.$("#copy-url-input").val(this.shareURL).select(),this.tryCopy(),null!=(e=window.tracker)?e.trackEvent("Play GameDev Victory Modal - Copy URL",this.eventProperties,["Mixpanel"]):void 0},s.prototype.onClickPlayMoreCodeCombatButton=function(){var e;return null!=(e=window.tracker)?e.trackEvent("Play GameDev Victory Modal - Click Play More CodeCombat",this.eventProperties,["Mixpanel"]):void 0},s)},2671:function(e,t,i){var n=i(2672);(n="string"==typeof n?[[e.i,n,""]]:n).locals&&(e.exports=n.locals);(0,i(21).default)("1a91f42b",n,!0,{})},2672:function(e,t,i){},2673:function(e,t,i){var n=i(11);e.exports=function(e){var t,i=[],e=e||{};return function(e){i.push('<div class="modal-dialog"><div id="modal-base-flat" class="modal-content style-flat"><div class="modal-header">'),e.closeButton&&i.push('<div type="button" data-dismiss="modal" aria-hidden="true" class="button close">&times;</div>'),i.push('<h3 class="text-center">'+n.escape(null==(t=e.getVictoryMessage())?"":t)+'</h3></div><div class="modal-body"><div class="text-center">Share this level so your friends and family can play it:</div><div class="share-row text-center"><input id="copy-url-input"'+n.attr("value",e.shareURL,!0,!0)+' class="text-h4 semibold form-control input-lg"><button id="copy-url-btn" class="btn btn-lg btn-navy-alt"><span data-i18n="sharing.copy_url"></span></button></div></div><div class="modal-body wait secret"><h3>Reticulating Splines...</h3><div class="progress progress-striped active"><div class="progress-bar"></div></div></div><div class="modal-footer"><div class="text-center"><button id="replay-game-btn" data-dismiss="modal" class="btn btn-navy btn-lg">Replay Game</button><a id="play-more-codecombat-btn" href="/" class="btn btn-navy btn-lg">Play More CodeCombat</a></div></div></div></div>')}.call(this,"view"in e?e.view:"undefined"!=typeof view?view:void 0),i.join("")}},2674:function(e,t,i){var l=i(11);e.exports=function(e){var r,a=[],i={},e=e||{};return function(e){var t=!(e.state.get("errorMessage")||e.state.get("loading"));i["game-dev-goals"]=r=function(o){this&&this.block,this&&this.attributes;a.push('<ul class="goals">');var s=!1;!function(){var e=o;if("number"==typeof e.length)for(var t=0,i=e.length;t<i;t++)"manual"==(n=e[t]).type?a.push('<li class="goal">'+l.escape(null==(r=n.config.description)?"":r)+"</li>"):"survive"==n.type?n.config.seconds?a.push('<li data-i18n="play_game_dev_level.goal_survive_time"'+l.attr("data-i18n-options",{seconds:n.config.seconds},!0,!0)+' class="goal"></li>'):a.push('<li data-i18n="play_game_dev_level.goal_survive" class="goal"></li>'):"defeat"==n.type?n.config.amount?a.push('<li data-i18n="play_game_dev_level.goal_defeat_amount"'+l.attr("data-i18n-options",{amount:n.config.amount},!0,!0)+' class="goal"></li>'):a.push('<li data-i18n="play_game_dev_level.goal_defeat" class="goal"></li>'):"move"!=n.type||s?"collect"==n.type?n.config.amount?a.push('<li data-i18n="play_game_dev_level.goal_collect_amount"'+l.attr("data-i18n-options",{amount:n.config.amount},!0,!0)+' class="goal"></li>'):a.push('<li data-i18n="play_game_dev_level.goal_collect" class="goal"></li>'):"user_defined"==n.type&&a.push('<li class="goal">'+l.escape(null==(r=n.direction)?"":r)+"</li>"):(a.push('<li data-i18n="play_game_dev_level.goal_move" class="goal"></li>'),s=!0);else{var n,i=0;for(t in e)i++,"manual"==(n=e[t]).type?a.push('<li class="goal">'+l.escape(null==(r=n.config.description)?"":r)+"</li>"):"survive"==n.type?n.config.seconds?a.push('<li data-i18n="play_game_dev_level.goal_survive_time"'+l.attr("data-i18n-options",{seconds:n.config.seconds},!0,!0)+' class="goal"></li>'):a.push('<li data-i18n="play_game_dev_level.goal_survive" class="goal"></li>'):"defeat"==n.type?n.config.amount?a.push('<li data-i18n="play_game_dev_level.goal_defeat_amount"'+l.attr("data-i18n-options",{amount:n.config.amount},!0,!0)+' class="goal"></li>'):a.push('<li data-i18n="play_game_dev_level.goal_defeat" class="goal"></li>'):"move"!=n.type||s?"collect"==n.type?n.config.amount?a.push('<li data-i18n="play_game_dev_level.goal_collect_amount"'+l.attr("data-i18n-options",{amount:n.config.amount},!0,!0)+' class="goal"></li>'):a.push('<li data-i18n="play_game_dev_level.goal_collect" class="goal"></li>'):"user_defined"==n.type&&a.push('<li class="goal">'+l.escape(null==(r=n.direction)?"":r)+"</li>"):(a.push('<li data-i18n="play_game_dev_level.goal_move" class="goal"></li>'),s=!0)}}.call(this),a.push("</ul>")},a.push('<div class="container-fluid style-flat"><div id="game-row" class="row"><div class="col-xs-9"><div id="canvas-wrapper"><div id="game-dev-track-view"></div><canvas width="924" height="589" id="webgl-surface"></canvas><canvas width="924" height="589" id="normal-surface"></canvas></div></div><div id="info-col" class="col-xs-3"><div class="panel panel-default"><div id="directions" class="panel-body text-center">'),e.state.get("errorMessage")&&a.push('<div class="alert alert-danger">'+l.escape(null==(r=e.state.get("errorMessage"))?"":r)+"</div>"),e.level.id&&e.session.id&&a.push('<h3 class="m-y-1">'+l.escape(null==(r=e.getLevelName())?"":r)+"</h3><h4>"+l.escape(null==(r=e.state.get("creatorString"))?"":r)+"</h4><hr>"),e.state.get("loading")&&a.push('<h1 data-i18n="common.loading" class="m-y-1"></h1><div class="progress"><div'+l.attr("style","width: "+e.state.get("progress"),!0,!0)+' class="progress-bar"></div></div>'),t&&(a.push('<h3><span data-i18n="play_level.directions"></span>:</h3>'),e.studentGoals&&e.studentGoals.length?i["game-dev-goals"](e.studentGoals):a.push("<p>"+(null==(r=e.howToPlayText)?"":r)+"</p>"),a.push("<hr>")),a.push("</div>"),t&&(a.push('<div class="panel-footer">'),e.state.get("playing")?a.push('<button id="play-btn" data-i18n="play_game_dev_level.restart" class="btn btn-lg btn-burgundy btn-block"></button>'):a.push('<button id="play-btn" data-i18n="play_game_dev_level.play" class="btn btn-lg btn-forest btn-block"></button>'),e.state.get("isOwner")&&a.push('<br><button id="edit-level-btn" data-i18n="play_level.edit_level" class="btn btn-lg btn-warning btn-block"></button>'),a.push("</div>")),a.push('</div></div></div><div id="share-row" class="m-t-3">'),t&&(a.push('<div class="panel panel-default"><div id="share-panel-body" class="panel-body"><div id="share-text-div" class="text-right"><b data-i18n="sharing.share_game"></b></div><input id="copy-url-input"'+l.attr("value",e.state.get("shareURL"),!0,!0)+' class="text-h4 semibold form-control input-lg"><div id="copy-url-div"><button id="copy-url-btn" class="btn btn-lg btn-navy-alt"><span data-i18n="sharing.copy_url"></span></button></div></div>'),e.state.get("isOwner")||a.push('<div class="panel-body"><a id="play-more-codecombat-btn" href="/" data-i18n="play_game_dev_level.play_more_codecombat" class="btn btn-lg btn-navy-alt pull-right"></a></div>'),a.push("</div>")),a.push("</div></div>")}.call(this,"view"in e?e.view:"undefined"!=typeof view?view:void 0),a.join("")}},2675:function(e,t,i){var n=i(2676);(n="string"==typeof n?[[e.i,n,""]]:n).locals&&(e.exports=n.locals);(0,i(21).default)("2b5afb9f",n,!0,{})},2676:function(e,t,i){},2677:function(e,t,i){var n=i(11);e.exports=function(e){var t,i=[],e=e||{};return function(e){i.push('<div id="web-surface-view"></div><div id="info-bar" class="style-flat">'),e.supermodel.finished()?i.push('<h1><span data-i18n="game_dev.creator"></span><span>'+n.escape(t=": ")+"</span>"+n.escape(null==(t=e.session.get("creatorName"))?"":t)+"</h1>"):i.push('<h1 data-i18n="common.loading"></h1>'),i.push("</div>")}.call(this,"view"in e?e.view:"undefined"!=typeof view?view:void 0),i.join("")}},2678:function(e,t,i){var n=i(2679);(n="string"==typeof n?[[e.i,n,""]]:n).locals&&(e.exports=n.locals);(0,i(21).default)("41312764",n,!0,{})},2679:function(e,t,i){},2680:function(e,t,i){var s=i(11);e.exports=function(e){var o=[],e=e||{};return function(e){o.push('<div id="level-loading-view"></div><div class="level-content"><div id="control-bar-view"></div><div id="canvas-wrapper"><canvas width="924" height="589" id="webgl-surface"></canvas><canvas width="924" height="589" id="normal-surface"></canvas><div id="canvas-left-gradient" class="gradient"></div><div id="canvas-top-gradient" class="gradient"></div></div><div id="gold-view" class="secret expanded"></div><div id="level-chat-view"></div><div id="duel-stats-view"></div><div id="playback-view"></div><div id="thang-hud"></div>'),function(){var e=["humans","ogres"];if("number"==typeof e.length)for(var t=0,i=e.length;t<i;t++){var n=e[t];o.push("<div"+s.cls(["spectate-code team-"+n],[!0])+'><img src="/images/level/code_editor_background.png" class="code-background"><span class="code-background"></span><div class="ace"></div><div class="programming-language-container rtl-allowed"><span data-i18n="play_level.programming_language" class="programming-language-label"></span><span class="programming-language-label spr">:</span><span class="programming-language"></span></div></div>')}else{i=0;for(t in e){i++;n=e[t];o.push("<div"+s.cls(["spectate-code team-"+n],[!0])+'><img src="/images/level/code_editor_background.png" class="code-background"><span class="code-background"></span><div class="ace"></div><div class="programming-language-container rtl-allowed"><span data-i18n="play_level.programming_language" class="programming-language-label"></span><span class="programming-language-label spr">:</span><span class="programming-language"></span></div></div>')}}}.call(this),o.push("</div>")}.call(this,"undefined"in e?e.undefined:void 0),o.join("")}},271:function(module,exports,__webpack_require__){var require,COUNTDOWN_LEVELS,Component,DESERIALIZATION_INTERVAL,EXISTS_ORIGINAL,Ellipse,ITEM_ORIGINAL,LineSegment,PROGRESS_UPDATE_INTERVAL,REAL_TIME_BUFFERED_WAIT_INTERVAL,REAL_TIME_BUFFER_MAX,REAL_TIME_BUFFER_MIN,REAL_TIME_COUNTDOWN_DELAY,Rand,Rectangle,System,Thang,ThangState,Vector,World,WorldFrame,WorldScriptNote,_,consolidateThangs,now,ref,typedArraySupport,indexOf=[].indexOf||function(e){for(var t=0,i=this.length;t<i;t++)if(t in this&&this[t]===e)return t;return-1},slice=[].slice,_=__webpack_require__(8);_.string=__webpack_require__(179),Vector=__webpack_require__(47),Rectangle=__webpack_require__(94),Ellipse=__webpack_require__(119),LineSegment=__webpack_require__(82),WorldFrame=__webpack_require__(175),Thang=__webpack_require__(168),ThangState=__webpack_require__(95),Rand=__webpack_require__(120),WorldScriptNote=__webpack_require__(176),ref=__webpack_require__(81),now=ref.now,consolidateThangs=ref.consolidateThangs,typedArraySupport=ref.typedArraySupport,Component=__webpack_require__(171),System=__webpack_require__(174),PROGRESS_UPDATE_INTERVAL=100,DESERIALIZATION_INTERVAL=10,REAL_TIME_BUFFER_MIN=2*PROGRESS_UPDATE_INTERVAL,REAL_TIME_BUFFER_MAX=3*PROGRESS_UPDATE_INTERVAL,REAL_TIME_BUFFERED_WAIT_INTERVAL=.5*PROGRESS_UPDATE_INTERVAL,REAL_TIME_COUNTDOWN_DELAY=3e3,ITEM_ORIGINAL="53e12043b82921000051cdf9",EXISTS_ORIGINAL="524b4150ff92f1f4f8000024",COUNTDOWN_LEVELS=["sky-span"],window.string_score=__webpack_require__(281),__webpack_require__(275),__webpack_require__(282),module.exports=World=function(){function World(e,t){this.userCodeMap=e,this.classMap=null!=t?t:{Vector:Vector,Rectangle:Rectangle,Thang:Thang,Ellipse:Ellipse,LineSegment:LineSegment},Thang.resetThangIDs(),null==this.userCodeMap&&(this.userCodeMap={}),this.thangs=[],this.thangMap={},this.systems=[],this.systemMap={},this.scriptNotes=[],this.rand=new Rand(0),this.frames=[new WorldFrame(this,0)]}return World.className="World",World.prototype.age=0,World.prototype.ended=!1,World.prototype.preloading=!1,World.prototype.debugging=!1,World.prototype.headless=!1,World.prototype.synchronous=!1,World.prototype.framesSerializedSoFar=0,World.prototype.framesClearedSoFar=0,World.prototype.apiProperties=["age","dt"],World.prototype.realTimeBufferMax=REAL_TIME_BUFFER_MAX/1e3,World.prototype.destroy=function(){var e,t,i,n,o;for(null!=(n=this.goalManager)&&n.destroy(),e=0,i=(o=this.thangs).length;e<i;e++)o[e].destroy();for(t in this)this[t]=void 0;return this.destroyed=!0,this.destroy=function(){}},World.prototype.getFrame=function(e){var t,i=this.frames;return this.ended?t=i[e]:e?(t=i[e-1].getNextFrame(),i.push(t)):t=i[0],this.age=e*this.dt,t},World.prototype.getThangByID=function(e){return this.thangMap[e]},World.prototype.setThang=function(e){var t,i,n,o;for(e.stateChanged=!0,t=i=0,n=(o=this.thangs).length;i<n;t=++i)if(o[t].id===e.id){this.thangs[t]=e;break}return this.thangMap[e.id]=e},World.prototype.thangDialogueSounds=function(e){var t,i,n,o,s,r,a,l,c,h,u,p;if(!((e=null==e?0:e)<this.frames.length))return[];for(h=(n=[[],{}])[0],l=n[1],t=i=o=e,s=this.frames.length;o<=s?i<s:s<i;t=o<=s?++i:--i)for(p in r=this.frames[t].thangStateMap)(u=r[p]).thang.say&&(a=u.getStateForProp("sayMessage"))&&(l[c=u.thang.spriteName+":"+a]||(h.push([u.thang.spriteName,a]),l[c]=!0));return h},World.prototype.setGoalManager=function(e){this.goalManager=e},World.prototype.addError=function(e){return(null!=this.runtimeErrors?this.runtimeErrors:this.runtimeErrors=[]).push(e),(null!=this.unhandledRuntimeErrors?this.unhandledRuntimeErrors:this.unhandledRuntimeErrors=[]).push(e)},World.prototype.loadFrames=function(e,t,i,n,o,s){var r,a,l,c,h,u,p,d,m,f,g;if(!this.aborted){if(this.justBegin&&(this.totalFrames=2),this.thangs.length||console.log("Warning: loadFrames called on empty World (no thangs)."),r=function(){if(!g.destroyed)return g.loadFrames(e,t,i,n,o,s)},(g=this).realTime&&!this.countdownFinished){if(this.realTimeSpeedFactor=1,this.showsCountdown||("woodland-cleaver"===(p=this.levelID)||"village-guard"===p||"shield-rush"===p?this.realTimeSpeedFactor=2:"thornbush-farm"!==(p=this.levelID)&&"back-to-back"!==p&&"ogre-encampment"!==p&&"peasant-protection"!==p&&"munchkin-swarm"!==p&&"munchkin-harvest"!==p&&"swift-dagger"!==p&&"shrapnel"!==p&&"arcane-ally"!==p&&"touch-of-death"!==p&&"bonemender"!==p||(this.realTimeSpeedFactor=3)),this.showsCountdown)return setTimeout(this.finishCountdown(r),REAL_TIME_COUNTDOWN_DELAY);this.finishCountdown(r)}for(f=now(),null==this.t0&&(this.t0=f),null==this.worldLoadStartTime&&(this.worldLoadStartTime=f),null==this.lastRealTimeUpdate&&(this.lastRealTimeUpdate=0),l=s?s+1:this.totalFrames,c=this.frames.length;;){if(this.indefiniteLength){if(!this.realTime)break;if(null!=this.victory)break}else{if(l<=c)break;if(c>=this.totalFrames)break}if(!this.shouldContinueLoading(f,i,o,r))return;this.debugging&&this.adjustFlowSettings(s);try{this.getFrame(c),++c}catch(e){this.addError(a=e)}if(!this.preloading&&!this.debugging){for(h=0,u=(m=null!=(d=this.unhandledRuntimeErrors)?d:[]).length;h<u;h++)if(a=m[h],!t(a))return;this.unhandledRuntimeErrors=[]}}return this.finishLoadingFrames(i,e,n)}},World.prototype.finishLoadingFrames=function(e,t,i){var n,o,s;if(!this.debugging)for(this.ended=!0,n=0,o=(s=this.systems).length;n<o;n++)s[n].finish(this.thangs);return this.preloading?i():("function"==typeof e&&e(1),t())},World.prototype.finishCountdown=function(e){return t=this,function(){if(!t.destroyed)return t.countdownFinished=!0,e()};var t},World.prototype.shouldDelayRealTimeSimulation=function(e){return!!this.realTime&&(e=(e-this.worldLoadStartTime)*this.realTimeSpeedFactor,e=this.frames.length*this.dt*1e3-e,this.indefiniteLength?0<e:e>REAL_TIME_BUFFER_MAX*this.realTimeSpeedFactor)},World.prototype.shouldUpdateRealTimePlayback=function(e){return!!this.realTime&&(this.frames.length*this.dt!==this.lastRealTimeUpdate&&(this.frames.length,this.dt,e=(e-this.worldLoadStartTime)*this.realTimeSpeedFactor,e=1e3*this.lastRealTimeUpdate-e,this.indefiniteLength?e<=0:e<REAL_TIME_BUFFER_MIN*this.realTimeSpeedFactor))},World.prototype.shouldContinueLoading=function(e,t,i,n){var o,s=now(),r=this.frames.length-this.framesSerializedSoFar,a=this.frames.length/this.frameRate,l=function(){switch(!1){case!(15<a):return 7;case!(10<a):return 5;case!(5<a):return 3;case!(2<a):return 1;default:return.5}}(),c=Math.max(2e3*l,1e4),h=s-e,h=this.realTime?!(o=this.shouldUpdateRealTimePlayback(s))&&this.shouldDelayRealTimeSimulation(s):(o=PROGRESS_UPDATE_INTERVAL<h&&r/this.frameRate>=l||c<h,!1);return!o&&!h||(o&&(this.realTime&&(this.lastRealTimeUpdate=this.frames.length*this.dt),this.preloading||"function"==typeof t&&t(this.frames.length/this.totalFrames)),1e3<(e=s)-this.t0&&(this.realTime||console.log("  Loaded",this.frames.length,"of",this.totalFrames,"(+"+(s-this.t0).toFixed(0)+"ms)"),this.t0=s),i?n():(i=0,h&&(i=this.indefiniteLength?1e3/30:REAL_TIME_BUFFERED_WAIT_INTERVAL),setTimeout(n,i)),!1)},World.prototype.adjustFlowSettings=function(t){for(var i,n,o,e,s,r=this.thangs,a=[],l=0,c=r.length;l<c;l++)(e=r[l]).isProgrammable&&(s=null!=(e=this.userCodeMap[e.id])?e:{},a.push(function(){var e=[];for(o in s)i=s[o],n="plan"===o||"makeBid"===o?200:1,e.push(i._shouldSkipFlow=this.frames.length<t-n);return e}.call(this)));return a},World.prototype.finalizePreload=function(e){if(this.preloading=!1,this.ended)return e()},World.prototype.abort=function(){return this.aborted=!0},World.prototype.addFlagEvent=function(e){return this.flagHistory.push(e)},World.prototype.addRealTimeInputEvent=function(e){return this.realTimeInputEvents.push(e)},World.prototype.loadFromLevel=function(e,t){var i,n,o,s;for(null==t&&(t=!0),this.levelID=e.slug,this.levelComponents=e.levelComponents,this.thangTypes=e.thangTypes,this.loadScriptsFromLevel(e),this.loadSystemsFromLevel(e),this.loadThangsFromLevel(e,t),this.showsCountdown=(t=this.levelID,0<=indexOf.call(COUNTDOWN_LEVELS,t)||_.any(this.thangs,function(e){return e.programmableProperties&&0<=indexOf.call(e.programmableProperties,"findFlags")||(null!=(e=e.inventory)?e.flag:void 0)})),e.picoCTFProblem&&(this.picoCTFProblem=e.picoCTFProblem),null!=(t=this.picoCTFProblem)&&t.instances&&!this.picoCTFProblem.flag_sha1&&(this.picoCTFProblem=_.merge(this.picoCTFProblem,this.picoCTFProblem.instances[0])),i=0,n=(o=this.systems).length;i<n;i++){s=o[i];try{s.start(this.thangs)}catch(e){console.error("Error starting system!",s,e)}}return this.constrainHeroHealth(e)},World.prototype.loadSystemsFromLevel=function(e){var t,i,n,o,s;for(this.systems=[],this.systemMap={},t=0,i=(n=e.systems).length;t<i;t++)s=(o=n[t]).model,o=o.config,o=new(this.loadClassFromCode(s.js,s.name,"system"))(this,o),this.addSystems(o);return null},World.prototype.loadThangsFromLevel=function(s,e){var t,i,n,r,o;for(this.thangs=[],this.thangMap={},o=function(){for(var e,t=null!=(e=s.thangs)?e:[],i=[],n=0,o=t.length;n<o;n++)r=t[n],i.push(this.loadThangFromLevel(r,s.levelComponents,s.thangTypes));return i}.call(this),e&&!this.synchronous&&(this.extraneousThangs=consolidateThangs(o)),t=0,i=o.length;t<i;t++)n=o[t],this.addThang(n);return null},World.prototype.loadThangFromLevel=function(t,e,i,n){var o,s,r,a,l,c,h,u,p,d,m;for(null==n&&(n=null),a=[],s=h=0,u=(p=t.components).length;h<u;s=++h)o=p[s],r=_.find(e,function(e){return e.original===o.original&&e.version.major===(null!=(e=o.majorVersion)?e:0)}),r=this.loadClassFromCode(r.js,r.name,"component"),a.push([r,o.config]),o.original===ITEM_ORIGINAL?(c=!0,n&&(o.config.ownerID=n)):o.original===EXISTS_ORIGINAL&&(l=s);if(c&&null!=l&&(a[l][1]={exists:!1,stateless:!0}),m=t.thangType,!(i=_.find(i,function(e){return e.original===m})))return console.error(null!=(d=t.id)?d:n,"could not find ThangType for",m);d=i.name,i=new Thang(this,d,t.id);try{i.addComponents.apply(i,a)}catch(e){d=e,console.error("couldn't load components for",m,t.id,"because",d.toString(),d.stack)}return i},World.prototype.addThang=function(e){return this.thangs.unshift(e),this.setThang(e),this.updateThangState(e),e.updateRegistration(),e},World.prototype.loadScriptsFromLevel=function(e){return this.scriptNotes=[],this.scripts=[],this.addScripts.apply(this,e.scripts)},World.prototype.loadClassFromCode=function(js,name,kind){var c,err,map,require;if(null==kind&&(kind="component"),null==this.componentCodeClassMap&&(this.componentCodeClassMap={}),null==this.systemCodeClassMap&&(this.systemCodeClassMap={}),map="component"===kind?this.componentCodeClassMap:this.systemCodeClassMap,c=map[js],c)return c;try{require=window.libWorldRequire,c=map[js]=eval(js)}catch(error1){err=error1,console.error("Couldn't compile "+kind+" code:",err,"\n",js),c=map[js]={}}return c.className=name,c},World.prototype.updateThangState=function(e){return this.frames[this.frames.length-1].thangStateMap[e.id]=e.getState()},World.prototype.size=function(){if(null!=this.width&&null!=this.height||this.calculateBounds(),null!=this.width&&null!=this.height)return[this.width,this.height]},World.prototype.getBounds=function(){return null==this.bounds&&this.calculateBounds(),this.bounds},World.prototype.calculateBounds=function(){for(var e,t={left:0,top:0,right:0,bottom:0},i=_.some(this.thangs,"isLand"),n=this.thangs,o=0,s=n.length;o<s;o++)((e=n[o]).isLand||!i&&e.rectangle)&&(e=e.rectangle().axisAlignedBoundingBox(),t.left=Math.min(t.left,e.x-e.width/2),t.right=Math.max(t.right,e.x+e.width/2),t.bottom=Math.min(t.bottom,e.y-e.height/2),t.top=Math.max(t.top,e.y+e.height/2));return this.width=t.right-t.left,this.height=t.top-t.bottom,this.bounds=t,[this.width,this.height]},World.prototype.publishNote=function(e,t){var i,n,o,s,r;for(null==t&&(t={}),e="world:"+e,i=0,n=(s=null!=(o=this.scripts)?o:[]).length;i<n;i++)(r=s[i]).channel===e&&((r=new WorldScriptNote(r,t)).invalid||this.scriptNotes.push(r));if(this.goalManager)return this.goalManager.submitWorldGenerationEvent(e,t,this.frames.length)},World.prototype.publishCameraEvent=function(e,t){if("undefined"!=typeof Backbone&&null!==Backbone&&Backbone.Mediator)return Backbone.Mediator.publish(e="camera:"+e,t=null==t?{}:t)},World.prototype.getGoalState=function(e){return this.goalManager.getGoalState(e)},World.prototype.setGoalState=function(e,t){return this.goalManager.setGoalState(e,t)},World.prototype.endWorld=function(e,t,i){var n;return null==e&&(e=!1),null==t&&(t=3),null==i&&(i=!1),n=this.indefiniteLength?1/0:this.totalFrames,this.totalFrames=Math.min(n,this.frames.length+Math.floor(t/this.dt)),this.victory=e,this.victoryIsTentative=i,i=this.victory?"won":"lost",this.publishNote(i),console.log("The world ended in "+i+" on frame "+this.totalFrames)},World.prototype.addSystems=function(){var e,t,i,n,o=1<=arguments.length?slice.call(arguments,0):[];for(this.systems=this.systems.concat(o),i=[],e=0,t=o.length;e<t;e++)n=o[e],i.push(this.systemMap[n.constructor.className]=n);return i},World.prototype.getSystem=function(e){var t;return null!=(t=this.systemMap)?t[e]:void 0},World.prototype.addScripts=function(){var e,t=1<=arguments.length?slice.call(arguments,0):[];return this.scripts=(null!=(e=this.scripts)?e:[]).concat(t)},World.prototype.addTrackedProperties=function(){var e,t=1<=arguments.length?slice.call(arguments,0):[];return this.trackedProperties=(null!=(e=this.trackedProperties)?e:[]).concat(t)},World.prototype.serialize=function(){var e,o,t,i,n,s,r,a,l,c,h,u,p,d,m,f,g,y,v,b,w,k,x,S,C,T,L,M,D,I,A,R,P,E,B,F,N,U,V,O,G,z,H,W,q,j,$,J,Y,K,X,Z,Q,ee,te,ie,ne,oe,se,re,ae,le,ce,he,ue;if(this.ended&&this.freeMemoryBeforeFinalSerialization(),j=this.framesSerializedSoFar,e=this.frames.length,this.indefiniteLength){for(Q=Math.max(this.framesSerializedSoFar-10,0),s=0,l=(I=_.range(this.framesClearedSoFar,Q)).length;s<l;s++)n=I[s],this.frames[n]=null;this.framesClearedSoFar=this.framesSerializedSoFar}for(0,Q=function(){for(var e=this.flagHistory,t=[],i=0,n=e.length;i<n;i++)o=e[i],t.push(_.omit(_.clone(o),"processed"));return t}.call(this),S={totalFrames:this.totalFrames,maxTotalFrames:this.maxTotalFrames,frameRate:this.frameRate,dt:this.dt,victory:this.victory,userCodeMap:{},trackedProperties:{},flagHistory:Q,difficulty:this.difficulty,scores:this.getScores(),randomSeed:this.randomSeed,picoCTFFlag:this.picoCTFFlag,keyValueDb:this.keyValueDb},r=0,c=(B=this.trackedProperties||[]).length;r<c;r++)T=B[r],S.trackedProperties[T]=this[T];for(X in F=this.userCodeMap)for(w in k=F[X],H=S.userCodeMap[X]={},k)b=k[w],H[w]=null!=(N="function"==typeof b.serialize?b.serialize():void 0)?N:b;for(now(),S.trackedPropertiesThangIDs=[],S.trackedPropertiesPerThangIndices=[],S.trackedPropertiesPerThangKeys=[],S.trackedPropertiesPerThangTypes=[],ie=[],S.trackedPropertiesPerThangValuesOffsets=[],x=e-j,a=re=0,h=(U=this.thangs).length;a<h;a++)if(!(K=U[a]).stateless||_.some(K.trackedPropertiesUsed,Boolean)){for(S.trackedPropertiesThangIDs.push(K.id),ee=[],te=[],ne=[],L=v=0,u=(V=K.trackedPropertiesUsed).length;v<u;L=++v)V[L]&&(ee.push(L),te.push(K.trackedPropertiesKeys[L]),ne.push(K.trackedPropertiesTypes[L]));for(S.trackedPropertiesPerThangIndices.push(ee),S.trackedPropertiesPerThangKeys.push(te),S.trackedPropertiesPerThangTypes.push(ne),ie.push([]),S.trackedPropertiesPerThangValuesOffsets.push([]),C=0,p=ne.length;C<p;C++)ae=ne[C],re+=ThangState.transferableBytesNeededForType(ae,x)}for(re+=ThangState.transferableBytesNeededForType("number",this.scoreTypes.length*x),S.storageBuffer=typedArraySupport?new ArrayBuffer(re):[],Z=M=J=0,d=ie.length;M<d;Z=++M)for(oe=ie[Z],se=S.trackedPropertiesPerThangValuesOffsets[Z],L=D=0,m=(O=S.trackedPropertiesPerThangTypes[Z]).length;D<m;L=++D)ae=O[L],$=(G=ThangState.createArrayForType(ae,x,S.storageBuffer,J))[0],G=G[1],oe.push($),se.push(J),G&&0,G||0,typedArraySupport?J+=G:(J+=$.length,S.storageBuffer.push($));for(Q=ThangState.createArrayForType("number",x*this.scoreTypes.length,S.storageBuffer,J),S.scoresStorage=Q[0],Q[1],S.specialKeysToValues=[null,1/0,NaN],S.specialValuesToKeys={},n=z=0,f=(A=S.specialKeysToValues).length;z<f;n=++z)q=A[n],S.specialValuesToKeys[q]=n;for(now(),S.frameHashes=[],i=le=R=j,P=e;R<=P?le<P:P<le;i=R<=P?++le:--le)S.frameHashes.push(this.frames[i].serialize(i-j,S.trackedPropertiesThangIDs,S.trackedPropertiesPerThangIndices,S.trackedPropertiesPerThangTypes,ie,S.specialValuesToKeys,S.specialKeysToValues,S.scoresStorage));if(now(),!typedArraySupport){for(t=[],ce=0,g=(E=S.storageBuffer).length;ce<g;ce++)for(ue=0,y=($=E[ce]).length;ue<y;ue++)he=$[ue],t.push(he);S.storageBuffer=t}return S.thangs=function(){for(var e,t=this.thangs.concat(null!=(e=this.extraneousThangs)?e:[]),i=[],n=0,o=t.length;n<o;n++)Y=t[n],i.push(Y.serialize());return i}.call(this),S.scriptNotes=function(){for(var e=this.scriptNotes,t=[],i=0,n=e.length;i<n;i++)W=e[i],t.push(W.serialize());return t}.call(this),200<S.scriptNotes.length&&console.log("Whoa, serializing a lot of WorldScriptNotes here:",S.scriptNotes.length),this.ended||this.freeMemoryAfterEachSerialization(),{serializedWorld:S,transferableObjects:[S.storageBuffer],startFrame:j,endFrame:e}},World.deserialize=function(o,s,e,t,i,n,r,a){var l,c,h,u,p,d,m,f,g,y,v,b,w,k,x,S,C,T,L,M,D,I,A,R,P,E,B,F,N,U,V,O,G,z,H,W,q,j,$,J,Y,K={};if(K.t0=now(),S=n-i,a)for(z in Y=a,D=o.userCodeMap)for(k in x=D[z])for(U=x[k],u=0,m=(A=["flow","metrics","style","problems"]).length;u<m;u++)l=A[u],null==(c=Y.userCodeMap)[z]&&(c[z]={}),null==(c=Y.userCodeMap[z])[k]&&(c[k]={}),Y.userCodeMap[z][k][l]=U[l];else Y=new World(o.userCodeMap,s);for(T in R=[o.totalFrames,o.maxTotalFrames,o.frameRate,o.dt,null!=(R=o.scriptNotes)?R:[],o.victory,o.flagHistory,o.difficulty,o.scores,o.randomSeed,o.picoCTFFlag,o.keyValueDb],Y.totalFrames=R[0],Y.maxTotalFrames=R[1],Y.frameRate=R[2],Y.dt=R[3],Y.scriptNotes=R[4],Y.victory=R[5],Y.flagHistory=R[6],Y.difficulty=R[7],Y.scores=R[8],Y.randomSeed=R[9],Y.picoCTFFlag=R[10],Y.keyValueDb=R[11],P=o.trackedProperties)J=P[T],Y[T]=J;if(K.t1=now(),Y.thangs.length)for(p=0,f=(E=o.thangs).length;p<f;p++)if(G=E[p],O=Y.thangMap[G.id])for(T in B=G.finalState)J=B[T],O[T]=J;else Y.thangs.push(O=Thang.deserialize(G,Y,s,r.levelComponents)),Y.setThang(O);else for(Y.thangs=function(){for(var e=o.thangs,t=[],i=0,n=e.length;i<n;i++)O=e[i],t.push(Thang.deserialize(O,Y,s,r.levelComponents));return t}(),d=0,g=(F=Y.thangs).length;d<g;d++)O=F[d],Y.setThang(O);for(Y.scriptNotes=function(){for(var e=o.scriptNotes,t=[],i=0,n=e.length;i<n;i++)V=e[i],t.push(WorldScriptNote.deserialize(V,Y,s));return t}(),K.t2=now(),o.trackedPropertiesThangs=function(){for(var e=o.trackedPropertiesThangIDs,t=[],i=0,n=e.length;i<n;i++)z=e[i],t.push(Y.getThangByID(z));return t}(),o.trackedPropertiesPerThangValues=[],H=w=0,y=(N=o.trackedPropertiesPerThangTypes).length;w<y;H=++w)for(j=N[H],o.trackedPropertiesPerThangValues.push(W=[]),q=o.trackedPropertiesPerThangValuesOffsets[H],L=C=0,v=j.length;C<v;L=++C)$=j[L],$=ThangState.createArrayForType($,S,o.storageBuffer,q[L])[0],typedArraySupport||(h=q[L],$=o.storageBuffer.slice(h,h+$.length)),W.push($);if(K.t3=now(),K.batches=0,K.framesCPUTime=0,a||(Y.frames=[]),this.deserializationTimeout&&clearTimeout(this.deserializationTimeout),Y.indefiniteLength){if((a=Math.max(Y.frames.length-100,0))>Y.framesClearedSoFar)for(M=0,b=(I=_.range(Y.framesClearedSoFar,a)).length;M<b;M++)h=I[M],Y.frames[h]=null;Y.framesClearedSoFar=a}return this.deserializationTimeout=_.delay(this.deserializeSomeFrames,1,o,Y,t,K,i,n),Y},World.deserializeSomeFrames=function(e,t,i,n,o,s){var r,a,l,c,h,u;for(++n.batches,u=now(),a=l=c=t.frames.length,h=s;c<=h?l<h:h<l;a=c<=h?++l:--l)if(t.frames.push(WorldFrame.deserialize(t,a-o,e.trackedPropertiesThangIDs,e.trackedPropertiesThangs,e.trackedPropertiesPerThangKeys,e.trackedPropertiesPerThangTypes,e.trackedPropertiesPerThangValues,e.specialKeysToValues,e.scoresStorage,e.frameHashes[a-o],t.dt*a)),r=now()-u,DESERIALIZATION_INTERVAL<r&&a<s-1)return n.framesCPUTime+=r,void(World.deserializationTimeout=_.delay(World.deserializeSomeFrames,1,e,t,i,n,o,s));return World.deserializationTimeout=null,n.framesCPUTime+=r,World.finishDeserializing(t,i,n,o,s)},World.finishDeserializing=function(e,t,i,n,o){return i.t4=now(),e.ended=!0,i.t3,i.t0,i.framesCPUTime,t(e)},World.prototype.findFirstChangedFrame=function(e){var t,i,n,o,s,r,a,l;if(!e)return 0;for(i=n=0,o=(a=this.frames).length;n<o&&(s=a[i],(r=e.frames[i])&&(s.hash===r.hash||null==s.hash||null==r.hash));i=++n);return t=i,this.frames.length===this.totalFrames&&(this.frames[i]?console.log("First changed frame is",t,"with hash",this.frames[i].hash,"compared to",null!=(l=e.frames[i])?l.hash:void 0):console.log("No frames were changed out of all",this.frames.length)),t},World.prototype.freeMemoryBeforeFinalSerialization=function(){return this.levelComponents=null,this.thangTypes=null},World.prototype.freeMemoryAfterEachSerialization=function(){for(var e,t=this.frames,i=[],n=e=0,o=t.length;e<o;n=++e)t[n],n<this.frames.length-1&&i.push(this.frames[n]=null);return i},World.prototype.pointsForThang=function(e,t){var i,n,o,s,r,a;if(null==t&&(t=null),null==this.pointsForThangCache&&(this.pointsForThangCache={}),!(i=this.pointsForThangCache[n=e])){for(i=[],r={x:null,y:null},o=s=this.frames.length-1;0<=s;o=s+=-1)(a=this.frames[o])&&((a=null!=(a=a.thangStateMap[e])?a.getStateForProp("pos"):void 0)&&(t&&(a=t.worldToSurface({x:a.x,y:a.y})),(null==r.x||1<Math.abs(r.x-a.x)+Math.abs(r.y-a.y))&&(r=a)),0===r.y&&0===r.x||i.push(r.y,r.x));i.reverse(),this.pointsForThangCache[n]=i}return i},World.prototype.actionsForThang=function(o,e){var t,i,n,s,r,a,l,c,h,u,p;if(null==e&&(e=!1),null==this.actionsForThangCache&&(this.actionsForThangCache={}),n=o+"_"+Boolean(e),s=this.actionsForThangCache[n])return s;for(i=[],c="",a=l=0,h=(p=function(){for(var e=this.frames,t=[],i=0,n=e.length;i<n;i++)r=e[i],t.push(r.thangStateMap[o]);return t}.call(this)).length;l<h;a=++l)(t=null!=(u=p[a])?u.getStateForProp("action"):void 0)&&(t!==c||u.actionActivated)&&("idle"===u.action&&!e||(i.push({frame:a,pos:u.pos,name:t}),c=t));return this.actionsForThangCache[n]=i},World.prototype.getTeamColors=function(){var e,t,i=this.teamConfigs||{},n={};for(t in i)e=i[t],n[t]=e.color;return n},World.prototype.teamForPlayer=function(e){var t=null!=(t=this.playableTeams)?t:["humans"];return"ogres"===t[0]&&"humans"===t[1]&&(t=["humans","ogres"]),null!=e?t[e%t.length]:_.sample(t)},World.prototype.scoreTypes=["time","damage-taken","damage-dealt","gold-collected","difficulty","survival-time","defeated"],World.prototype.getScores=function(){var e,t;return{time:this.age,"damage-taken":null!=(e=this.getSystem("Combat"))?e.damageTakenForTeam("humans"):void 0,"damage-dealt":null!=(e=this.getSystem("Combat"))?e.damageDealtForTeam("humans"):void 0,"gold-collected":null!=(e=this.getSystem("Inventory"))&&null!=(t=e.teamGold.humans)?t.collected:void 0,difficulty:this.difficulty,"code-length":null!=(t=this.getThangByID("Hero Placeholder"))?t.linesOfCodeUsed:void 0,"survival-time":this.age,defeated:null!=(t=this.getSystem("Combat"))?t.defeatedByTeam("humans"):void 0}},World.prototype.constrainHeroHealth=function(e){var t;if(e.constrainHeroHealth)return null!=(t=_.find(this.thangs,{id:"Hero Placeholder"}))?(null!=e.recommendedHealth&&(t.maxHealth=Math.max(t.maxHealth,e.recommendedHealth)),null!=e.maximumHealth&&(t.maxHealth=Math.min(t.maxHealth,e.maximumHealth)),t.health=t.maxHealth):void 0},World}()},272:function(i,e,r){!function(t){var e,n,o={}.hasOwnProperty,c=[].indexOf||function(e){for(var t=0,i=this.length;t<i;t++)if(t in this&&this[t]===e)return t;return-1};function s(e,t,i,n){this.world=e,this.initialGoals=t,this.team=i,s.__super__.constructor.call(this),this.options=n||{},this.init()}e=r(45),n=r(6),i.exports=(function(e,t){for(var i in t)o.call(t,i)&&(e[i]=t[i]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(s,e),s.prototype.nextGoalID=0,s.prototype.nicks=["GoalManager"],s.prototype.init=function(){var e,t,i,n,o;if(this.goals=[],this.goalStates={},this.userCodeMap={},this.thangTeams={},this.initThangTeams(),this.initialGoals){for(o=[],t=0,i=(n=this.initialGoals).length;t<i;t++)e=n[t],o.push(this.addGoal(e));return o}},s.prototype.initThangTeams=function(){var e,t,i,n,o;if(this.world){for(n=[],e=0,t=(i=this.world.thangs).length;e<t;e++)(o=i[e]).team&&o.isAttackable&&o.team&&(this.thangTeams[o.team]||(this.thangTeams[o.team]=[]),n.push(this.thangTeams[o.team].push(o.id)));return n}},s.prototype.subscriptions={"god:new-world-created":"onNewWorldCreated","god:new-html-goal-states":"onNewHTMLGoalStates","level:restarted":"onLevelRestarted"},s.prototype.backgroundSubscriptions={"world:thang-died":"onThangDied","world:thang-touched-goal":"onThangTouchedGoal","world:thang-left-map":"onThangLeftMap","world:thang-collected-item":"onThangCollectedItem","world:user-code-problem":"onUserCodeProblem","world:lines-of-code-counted":"onLinesOfCodeCounted"},s.prototype.onLevelRestarted=function(){var e,t,i,n,o;if(this.goals=[],this.goalStates={},this.userCodeMap={},this.notifyGoalChanges(),this.initialGoals){for(o=[],t=0,i=(n=this.initialGoals).length;t<i;t++)e=n[t],o.push(this.addGoal(e));return o}},s.prototype.getGoals=function(){return this.goals},s.prototype.getRemainingGoals=function(){return _.filter(this.goalStates,function(e){return"success"!==e.status})},s.prototype.setGoals=function(e){this.goals=e},s.prototype.setCode=function(e){return this.userCodeMap=e,this.updateCodeGoalStates()},s.prototype.worldGenerationWillBegin=function(){return this.initGoalStates(),this.checkForInitialUserCodeProblems()},s.prototype.submitWorldGenerationEvent=function(e,t,i){e=this.backgroundSubscriptions[e];if(e=n.normalizeFunc(e,this))return e.call(this,t,i)},s.prototype.worldGenerationEnded=function(e){return this.wrapUpGoalStates(e)},s.prototype.getGoalStates=function(){return this.goalStates},s.prototype.onNewWorldCreated=function(e){if(this.world=e.world,null!=e.goalStates)return this.updateGoalStates(e.goalStates)},s.prototype.onNewHTMLGoalStates=function(e){if(null!=e.goalStates)return this.updateGoalStates(e.goalStates)},s.prototype.updateGoalStates=function(e){var t,i;for(t in e)i=e[t],null!=this.goalStates[t]&&(this.goalStates[t]=i);return this.notifyGoalChanges()},s.prototype.finishLevel=function(){var e="success"===this.checkOverallStatus();return this.options.additionalGoals&&e&&this.addAdditionalGoals(this.options.session,this.options.additionalGoals),e},s.prototype.addGoal=function(e){var i;if(((e=t.extend(!0,{},e)).id||(e.id=this.nextGoalID++),null==this.goalStates[e.id])&&(this.goals.push(e),e.isPositive=this.goalIsPositive(e.id),this.goalStates[e.id]={status:"incomplete",keyFrame:0,team:e.team},this.notifyGoalChanges(),e.notificationGoal))return i=this,e=e.notificationGoal.channel,this.addNewSubscription(e,function(t){return function(e){return i.onNote(t,e)}}(e))},s.prototype.notifyGoalChanges=function(){var e;if(!this.options.headless)return e=this.checkOverallStatus(),e={goalStates:this.goalStates,goals:this.goals,overallStatus:e,timedOut:null!=this.world&&this.world.totalFrames===this.world.maxTotalFrames&&"success"!==e&&"failure"!==e},Backbone.Mediator.publish("goal-manager:new-goal-states",e)},s.prototype.checkOverallStatus=function(t){var e,o,n,s,i,r,a,l;return null==t&&(t=!1),a=null,s=this.goalStates?_.values(this.goalStates):[],s=function(){for(var e=[],t=0,i=s.length;t<i;t++)(o=s[t]).optional||e.push(o);return e}(),this.team&&(s=function(){for(var e,t=[],i=0,n=s.length;i<n;i++)void 0!==(e=(o=s[i]).team)&&e!==this.team||t.push(o);return t}.call(this)),l=function(){for(var e=[],t=0,i=s.length;t<i;t++)n=s[t],e.push(n.status);return e}(),i=function(e){return"success"===e||t&&null===e},_.any(s.map(function(e){return null!=(e=e.concepts)?e.length:void 0}))?(e=s.filter(function(e){return null!=(e=e.concepts)?e.length:void 0}).map(function(e){return e.status}),r=s.filter(function(e){return!(null!=(e=e.concepts)&&e.length)}).map(function(e){return e.status}),a=_.all(r,i)&&_.any(e,i)?"success":"failure"):(0<l.length&&_.every(l,i)&&(a="success"),0<l.length&&0<=c.call(l,"failure")&&(a="failure")),a},s.prototype.initGoalStates=function(){var e,t,i,n,o,s,r,a,l,c,h,u,p,d,m;if(this.goalStates={},this.goals){for(d=[],t=0,o=(a=this.goals).length;t<o;t++){for(m={status:null,keyFrame:0,team:(e=a[t]).team,optional:e.optional,hiddenGoal:e.hiddenGoal,concepts:e.concepts},this.initGoalState(m,[e.killThangs,e.saveThangs],"killed"),i=0,s=(l=null!=(p=e.getAllToLocations)?p:[]).length;i<s;i++)c=l[i],this.initGoalState(m,[null!=(c=c.getToLocation)?c.who:void 0,[]],"arrived");for(n=0,r=(h=null!=(p=e.keepAllFromLocations)?p:[]).length;n<r;n++)u=h[n],this.initGoalState(m,[[],null!=(u=u.keepFromLocation)?u.who:void 0],"arrived");this.initGoalState(m,[null!=(p=e.getToLocations)?p.who:void 0,null!=(p=e.keepFromLocations)?p.who:void 0],"arrived"),this.initGoalState(m,[null!=(p=e.leaveOffSides)?p.who:void 0,null!=(p=e.keepFromLeavingOffSides)?p.who:void 0],"left"),this.initGoalState(m,[null!=(p=e.collectThangs)?p.targets:void 0,null!=(p=e.keepFromCollectingThangs)?p.targets:void 0],"collected"),this.initGoalState(m,[e.codeProblems],"problems"),this.initGoalState(m,[_.keys(null!=(p=e.linesOfCode)?p:{})],"lines"),d.push(this.goalStates[e.id]=m)}return d}},s.prototype.checkForInitialUserCodeProblems=function(){var e,t,i,n,o,s,r;if(this.world){for(s=[],e=0,t=(o=this.world.thangs).length;e<t;e++)(r=o[e]).isProgrammable&&s.push(function(){var e=r.publishedUserCodeProblems,t=[];for(i in e)n=e[i],t.push(this.onUserCodeProblem({thang:r,problem:n},0));return t}.call(this));return s}},s.prototype.onThangDied=function(e,t){for(var i,n,o=null!=(n=this.goals)?n:[],s=[],r=0,a=o.length;r<a;r++)null!=(i=o[r]).killThangs&&this.checkKillThangs(i.id,i.killThangs,e.thang,t),null!=i.saveThangs?s.push(this.checkKillThangs(i.id,i.saveThangs,e.thang,t)):s.push(void 0);return s},s.prototype.checkKillThangs=function(e,t,i,n){var o=i.id;if(0<=c.call(t,o)||(o=i.team,0<=c.call(t,o)))return this.updateGoalState(e,i.id,"killed",n)},s.prototype.onThangTouchedGoal=function(o,s){for(var e,r,t,a,i,n,l,c=null!=(n=this.goals)?n:[],h=[],u=0,p=c.length;u<p;u++){if(null!=(r=c[u]).getToLocations&&this.checkArrived(r.id,r.getToLocations.who,r.getToLocations.targets,o.actor,o.touched.id,s),null!=r.getAllToLocations)for(t=0,i=(l=r.getAllToLocations).length;t<i;t++)e=l[t],this.checkArrived(r.id,e.getToLocation.who,e.getToLocation.targets,o.actor,o.touched.id,s);null!=r.keepFromLocations&&this.checkArrived(r.id,r.keepFromLocations.who,r.keepFromLocations.targets,o.actor,o.touched.id,s),null!=r.keepAllFromLocations?h.push(function(){for(var e=r.keepAllFromLocations,t=[],i=0,n=e.length;i<n;i++)a=e[i],t.push(this.checkArrived(r.id,a.keepFromLocation.who,a.keepFromLocation.targets,o.actor,o.touched.id,s));return t}.call(this)):h.push(void 0)}return h},s.prototype.checkArrived=function(e,t,i,n,o,s){if(!(c.call(i,o)<0)&&(o=n.id,0<=c.call(t,o)||(o=n.team,0<=c.call(t,o))))return this.updateGoalState(e,n.id,"arrived",s)},s.prototype.onThangLeftMap=function(e,t){for(var i,n,o=null!=(n=this.goals)?n:[],s=[],r=0,a=o.length;r<a;r++)null!=(i=o[r]).leaveOffSides&&this.checkLeft(i.id,i.leaveOffSides.who,i.leaveOffSides.sides,e.thang,e.side,t),null!=i.keepFromLeavingOffSides?s.push(this.checkLeft(i.id,i.keepFromLeavingOffSides.who,i.keepFromLeavingOffSides.sides,e.thang,e.side,t)):s.push(void 0);return s},s.prototype.checkLeft=function(e,t,i,n,o,s){if((!i||!o||0<=c.call(i,o))&&(o=n.id,0<=c.call(t,o)||(o=n.team,0<=c.call(t,o))))return this.updateGoalState(e,n.id,"left",s)},s.prototype.onThangCollectedItem=function(e,t){for(var i,n,o=null!=(n=this.goals)?n:[],s=[],r=0,a=o.length;r<a;r++)null!=(i=o[r]).collectThangs&&this.checkCollected(i.id,i.collectThangs.who,i.collectThangs.targets,e.actor,e.item.id,t),null!=i.keepFromCollectingThangs?s.push(this.checkCollected(i.id,i.keepFromCollectingThangs.who,i.keepFromCollectingThangs.targets,e.actor,e.item.id,t)):s.push(void 0);return s},s.prototype.checkCollected=function(e,t,i,n,o,s){if(!(c.call(i,o)<0)&&(i=n.id,0<=c.call(t,i)||(n=n.team,0<=c.call(t,n))))return this.updateGoalState(e,o,"collected",s)},s.prototype.onUserCodeProblem=function(e,t){for(var i,n,o=null!=(n=this.goals)?n:[],s=[],r=0,a=o.length;r<a;r++)(i=o[r]).codeProblems&&s.push(this.checkCodeProblem(i.id,i.codeProblems,e.thang,t));return s},s.prototype.checkCodeProblem=function(e,t,i,n){var o=i.id;if(0<=c.call(t,o)||(o=i.team,0<=c.call(t,o)))return this.updateGoalState(e,i.id,"problems",n)},s.prototype.onLinesOfCodeCounted=function(e,t){for(var i,n,o=null!=(n=this.goals)?n:[],s=[],r=0,a=o.length;r<a;r++)(i=o[r]).linesOfCode&&s.push(this.checkLinesOfCode(i.id,i.linesOfCode,e.thang,e.linesUsed,t));return s},s.prototype.checkLinesOfCode=function(e,t,i,n,o){var s;if(t=null!=(s=t[i.id])?s:t[i.team])return t<n?this.updateGoalState(e,i.id,"lines",o):void 0},s.prototype.wrapUpGoalStates=function(e){var t,i,n=this.goalStates,o=[];for(t in n)null===(i=n[t]).status?this.goalIsPositive(t)?o.push(i.status="incomplete"):(i.status="success",o.push(i.keyFrame="end")):o.push(void 0);return o},s.prototype.onNote=function(e,t){},s.prototype.initGoalState=function(o,n,s){var r,e,t,a,i,l,c,h=function(){for(var e=[],t=0,i=n.length;t<i;t++)null!=(a=n[t])&&a.length&&e.push(a);return e}();if(h.length){for(null==o[s]&&(o[s]={}),i=[],e=0,t=h.length;e<t;e++)r=h[e],i.push(function(){for(var e=[],t=0,i=r.length;t<i;t++)c=r[t],null!=this.thangTeams[c]?e.push(function(){for(var e=this.thangTeams[c],t=[],i=0,n=e.length;i<n;i++)l=e[i],t.push(o[s][l]=!1);return t}.call(this)):e.push(o[s][c]=!1);return e}.call(this));return i}},s.prototype.getGoalState=function(e){return this.goalStates[e].status},s.prototype.setGoalState=function(i,e){var t,n,o,s=this.goalStates[i];if(s)return s.status=e,(n=this.checkOverallStatus(!0))&&(t=function(){var e=this.goalStates,t=[];for(i in e)e[i].status===n&&t.push(_.find(this.goals,{id:i}));return t}.call(this),(t=_.min(t,"worldEndsAfter"))!==1/0)&&null!=(o=this.world)?o.endWorld("success"===n,t.worldEndsAfter,"success"===n):void 0;console.log("Could not set state for goalID ",i)},s.prototype.updateGoalState=function(i,e,t,n){var o,s,r,a=_.find(this.goals,{id:i}),l=this.goalStates[i],c=l[t];if(c[e]=!0,((t=this.goalIsPositive(i))?null!=(e=a.howMany)?e:Math.max(1,_.size(c)):_.size(c)-Math.max(null!=(a=a.howMany)?a:1,_.size(c))+1)<=_.filter(c).length&&(!l.status||t))return l.status=t?"success":"failure",l.keyFrame=n,(s=this.checkOverallStatus(!0))&&(o=function(){var e=this.goalStates,t=[];for(i in e)e[i].status===s&&t.push(_.find(this.goals,{id:i}));return t}.call(this),(o=_.min(o,"worldEndsAfter"))!==1/0)&&null!=(r=this.world)?r.endWorld("success"===s,o.worldEndsAfter,"success"===s):void 0},s.prototype.goalIsPositive=function(e){for(var t in null!=(e=_.find(this.goals,{id:e}))?e:{})if(0===this.positiveGoalMap[t])return!1;return!0},s.prototype.positiveGoalMap={killThangs:1,saveThangs:0,getToLocations:1,getAllToLocations:1,keepFromLocations:0,keepAllFromLocations:0,leaveOffSides:1,keepFromLeavingOffSides:0,collectThangs:1,keepFromCollectingThangs:0,linesOfCode:0,codeProblems:0},s.prototype.updateCodeGoalStates=function(){},s.prototype.destroy=function(){return s.__super__.destroy.call(this)},s)}.call(this,r(3))},275:function(module,exports){!function(root){var CoffeeScript=function(){function require(e){return require[e]}return require["./helpers"]=function(){var t={},e=t;return function(){var n,i,s,c,e;t.starts=function(e,t,i){return t===e.substr(i,t.length)},t.ends=function(e,t,i){var n=t.length;return t===e.substr(e.length-n-(i||0),n)},t.repeat=c=function(e,t){for(var i="";0<t;)1&t&&(i+=e),t>>>=1,e+=e;return i},t.compact=function(e){for(var t,i=[],n=0,o=e.length;n<o;n++)(t=e[n])&&i.push(t);return i},t.count=function(e,t){var i,n=i=0;if(!t.length)return 1/0;for(;i=1+e.indexOf(t,i);)n++;return n},t.merge=function(e,t){return i(i({},e),t)},i=t.extend=function(e,t){var i,n;for(i in t)n=t[i],e[i]=n;return e},t.flatten=s=function(e){for(var t,i=[],n=0,o=e.length;n<o;n++)(t=e[n])instanceof Array?i=i.concat(s(t)):i.push(t);return i},t.del=function(e,t){var i=e[t];return delete e[t],i},t.last=function(e,t){return e[e.length-(t||0)-1]},t.some=null!=(e=Array.prototype.some)?e:function(e){for(var t=0,i=this.length;t<i;t++)if(e(this[t]))return!0;return!1},t.invertLiterate=function(o){var s,r=!0;return function(){for(var e=o.split("\n"),t=[],i=0,n=e.length;i<n;i++)s=e[i],r&&/^([ ]{4}|[ ]{0,3}\t)/.test(s)||(r=/^\s*$/.test(s))?t.push(s):t.push("# "+s);return t}().join("\n")},n=function(e,t){return t?{first_line:e.first_line,first_column:e.first_column,last_line:t.last_line,last_column:t.last_column}:e},t.addLocationDataFn=function(t,i){return function(e){return"object"==typeof e&&e.updateLocationDataIfMissing&&e.updateLocationDataIfMissing(n(t,i)),e}},t.locationDataToString=function(e){var t;return"2"in e&&"first_line"in e[2]?t=e[2]:"first_line"in e&&(t=e),t?t.first_line+1+":"+(t.first_column+1)+"-"+(t.last_line+1)+":"+(t.last_column+1):"No location data"},t.baseFileName=function(e,t,i){return null==t&&(t=!1),e=(i=e.split((i=null==i?!1:i)?/\\|\//:/\//))[i.length-1],t?((i=e.split(".")).pop(),"coffee"===i[i.length-1]&&1<i.length&&i.pop(),i.join(".")):e},t.isCoffee=function(e){return/\.((lit)?coffee|coffee\.md)$/.test(e)},t.isLiterate=function(e){return/\.(litcoffee|coffee\.md)$/.test(e)},t.throwSyntaxError=function(e,t){throw null==t.last_line&&(t.last_line=t.first_line),null==t.last_column&&(t.last_column=t.first_column),(e=new SyntaxError(e)).location=t,e},t.prettyErrorMessage=function(e,t,i,n){var o,s,r,a,l;return e.location?(s=(l=e.location).first_line,o=l.first_column,a=l.last_line,r=l.last_column,l=i.split("\n")[s],i=s===a?r+1:l.length,r=c(" ",a=o)+c("^",i-a),n&&(n=function(e){return"[1;31m"+e+"[0m"},l=l.slice(0,a)+n(l.slice(a,i))+l.slice(i),r=n(r)),t+":"+(s+1)+":"+(o+1)+": error: "+e.message+"\n"+l+"\n"+r):e.stack||""+e}}.call(this),e}(),require["./rewriter"]=function(){var c={},e=c;return function(){var e,n,L,M,D,I,A,R,t,P,i,p,o,s,r,a,E=[].indexOf||function(e){for(var t=0,i=this.length;t<i;t++)if(t in this&&this[t]===e)return t;return-1},d=[].slice,B=function(e,t){t=[e,t];return t.generated=!0,t};for(c.Rewriter=(l.prototype.rewrite=function(e){return this.tokens=e,this.removeLeadingNewlines(),this.removeMidExpressionNewlines(),this.closeOpenCalls(),this.closeOpenIndexes(),this.addImplicitIndentation(),this.tagPostfixConditionals(),this.addImplicitBracesAndParens(),this.addLocationDataToGeneratedTokens(),this.tokens},l.prototype.scanTokens=function(e){for(var t,i=this.tokens,n=0;t=i[n];)n+=e.call(this,t,n,i);return!0},l.prototype.detectEnd=function(e,t,i){for(var n,o,s=this.tokens,r=0;o=s[e];){if(0===r&&t.call(this,o,e))return i.call(this,o,e);if(!o||r<0)return i.call(this,o,e-1);n=o[0],0<=E.call(M,n)?r+=1:(o=o[0],0<=E.call(L,o)&&--r),e+=1}return e-1},l.prototype.removeLeadingNewlines=function(){for(var e,t=this.tokens,i=e=0,n=t.length;e<n&&"TERMINATOR"===t[i][0];i=++e);return i?this.tokens.splice(0,i):void 0},l.prototype.removeMidExpressionNewlines=function(){return this.scanTokens(function(e,t,i){return"TERMINATOR"===e[0]&&(e=this.tag(t+1),0<=E.call(n,e))?(i.splice(t,1),0):1})},l.prototype.closeOpenCalls=function(){var i=function(e,t){var i;return")"===(i=e[0])||"CALL_END"===i||"OUTDENT"===e[0]&&")"===this.tag(t-1)},n=function(e,t){return this.tokens["OUTDENT"===e[0]?t-1:t][0]="CALL_END"};return this.scanTokens(function(e,t){return"CALL_START"===e[0]&&this.detectEnd(t+1,i,n),1})},l.prototype.closeOpenIndexes=function(){var i=function(e){return"]"===(e=e[0])||"INDEX_END"===e},n=function(e){return e[0]="INDEX_END"};return this.scanTokens(function(e,t){return"INDEX_START"===e[0]&&this.detectEnd(t+1,i,n),1})},l.prototype.matchTags=function(){for(var e,t,i=arguments[0],n=2<=arguments.length?d.call(arguments,1):[],o=0,s=e=0,r=n.length;0<=r?e<r:r<e;s=0<=r?++e:--e){for(;"HERECOMMENT"===this.tag(i+s+o);)o+=2;if(null!=n[s]&&("string"==typeof n[s]&&(n[s]=[n[s]]),t=this.tag(i+s+o),E.call(n[s],t)<0))return!1}return!0},l.prototype.looksObjectish=function(e){return this.matchTags(e,"@",null,":")||this.matchTags(e,null,":")},l.prototype.findTagsBackwards=function(e,t){for(var i,n,o,s=[];0<=e&&(s.length||(i=this.tag(e),E.call(t,i)<0&&(i=this.tag(e),E.call(M,i)<0||this.tokens[e].generated)&&(n=this.tag(e),E.call(P,n)<0)));)n=this.tag(e),0<=E.call(L,n)&&s.push(this.tag(e)),n=this.tag(e),0<=E.call(M,n)&&s.length&&s.pop(),--e;return o=this.tag(e),0<=E.call(t,o)},l.prototype.addImplicitBracesAndParens=function(){var T=[];return this.scanTokens(function(e,n,o){var t,i,s,r,a,l,c,h,u,p=e[0],d=(0<n?o[n-1]:[])[0],m=(n<o.length-1?o[n+1]:[])[0],f=function(){return T[T.length-1]},g=n,y=function(e){return n-g+e},v=function(){var e,t;return null!=(e=f())&&null!=(t=e[2])?t.ours:void 0},b=function(){var e;return v()&&"("===(null!=(e=f())?e[0]:void 0)},_=function(){var e;return v()&&"{"===(null!=(e=f())?e[0]:void 0)},w=function(){var e;return"CONTROL"===(null!=(e=f())?e[0]:void 0)},k=function(e){var t=null!=e?e:n;return T.push(["(",t,{ours:!0}]),o.splice(t,0,B("CALL_START","(")),null==e?n+=1:void 0},x=function(){return T.pop(),o.splice(n,0,B("CALL_END",")")),n+=1},S=function(e,t){var i=null!=e?e:n;return T.push(["{",i,{sameLine:!0,startsLine:t=null==t?!0:t,ours:!0}]),o.splice(i,0,B("{",B(new String("{")))),null==e?n+=1:void 0},C=function(e){return e=null!=e?e:n,T.pop(),o.splice(e,0,B("}","}")),n+=1};if(b()&&("IF"===p||"TRY"===p||"FINALLY"===p||"CATCH"===p||"CLASS"===p||"SWITCH"===p))return T.push(["CONTROL",n,{ours:!0}]),y(1);if("INDENT"===p&&v()){if("=>"!==d&&"->"!==d&&"["!==d&&"("!==d&&","!==d&&"{"!==d&&"TRY"!==d&&"ELSE"!==d&&"="!==d)for(;b();)x();return w()&&T.pop(),T.push([p,n]),y(1)}if(0<=E.call(M,p))return T.push([p,n]),y(1);if(0<=E.call(L,p)){for(;v();)b()?x():_()?C():T.pop();T.pop()}if((0<=E.call(A,p)&&e.spaced&&!e.stringEnd||"?"===p&&0<n&&!o[n-1].spaced)&&(0<=E.call(D,m)||0<=E.call(R,m)&&(null==(l=o[n+1])||!l.spaced)&&(null==(l=o[n+1])||!l.newLine)))return"?"===p&&(p=e[0]="FUNC_EXIST"),k(n+1),y(2);if(0<=E.call(A,p)&&this.matchTags(n+1,"INDENT",null,":")&&!this.findTagsBackwards(n,["CLASS","EXTENDS","IF","CATCH","SWITCH","LEADING_WHEN","FOR","WHILE","UNTIL"]))return k(n+1),T.push(["INDENT",n+2]),y(3);if(":"===p){for(i="@"===this.tag(n-2)?n-2:n-1;"HERECOMMENT"===this.tag(i-2);)i-=2;return a=0===i||(c=this.tag(i-1),0<=E.call(P,c))||o[i-1].newLine,f()&&(r=(c=f())[0],s=c[1],("{"===r||"INDENT"===r&&"{"===this.tag(s-1))&&(a||","===this.tag(i-1)||"{"===this.tag(i-1)))?y(1):(S(i,!!a),y(2))}if("OUTDENT"===d&&b()&&("."===p||"?."===p||"::"===p||"?::"===p))return x(),y(1);if(_()&&0<=E.call(P,p)&&(f()[2].sameLine=!1),0<=E.call(I,p))for(;v();)if(r=(h=f())[0],s=h[1],h=(u=h[2]).sameLine,a=u.startsLine,b()&&","!==d)x();else if(_()&&h&&!a)C();else{if(!_()||"TERMINATOR"!==p||","===d||a&&this.looksObjectish(n+1))break;C()}if(","===p&&!this.looksObjectish(n+1)&&_()&&("TERMINATOR"!==m||!this.looksObjectish(n+2)))for(t="OUTDENT"===m?1:0;_();)C(n+t);return y(1)})},l.prototype.addLocationDataToGeneratedTokens=function(){return this.scanTokens(function(e,t,i){var n,o,s;return e[2]||(e.generated||e.explicit)&&("{"===e[0]&&(s=null!=(s=i[t+1])?s[2]:void 0)?(o=s.first_line,n=s.first_column):(t=null!=(t=i[t-1])?t[2]:void 0)?(o=t.last_line,n=t.last_column):o=n=0,e[2]={first_line:o,first_column:n,last_line:o,last_column:n}),1})},l.prototype.addImplicitIndentation=function(){var a,l,c=a=l=null,h=function(e){var t;return";"!==e[1]&&(t=e[0],0<=E.call(i,t))&&!("ELSE"===e[0]&&"THEN"!==c)&&!!("CATCH"!==(e=e[0])&&"FINALLY"!==e||"->"!==c&&"=>"!==c)},u=function(e,t){return this.tokens.splice(","===this.tag(t-1)?t-1:t,0,l)};return this.scanTokens(function(e,t,i){var n,o,s,r=e[0];if("TERMINATOR"===r&&"THEN"===this.tag(t+1))return i.splice(t,1),0;if("ELSE"===r&&"OUTDENT"!==this.tag(t-1))return i.splice.apply(i,[t,0].concat(d.call(this.indentation()))),2;if("CATCH"===r)for(n=o=1;o<=2;n=++o)if("OUTDENT"===(s=this.tag(t+n))||"TERMINATOR"===s||"FINALLY"===s)return i.splice.apply(i,[t+n,0].concat(d.call(this.indentation()))),2+n;return 0<=E.call(p,r)&&"INDENT"!==this.tag(t+1)&&("ELSE"!==r||"IF"!==this.tag(t+1))&&(c=r,e=this.indentation(!0),a=e[0],l=e[1],"THEN"===c&&(a.fromThen=!0),i.splice(t+1,0,a),this.detectEnd(t+2,h,u),"THEN"===r&&i.splice(t,1)),1})},l.prototype.tagPostfixConditionals=function(){var i=null,n=function(e,t){e=e[0],t=this.tokens[t-1][0];return"TERMINATOR"===e||"INDENT"===e&&E.call(p,t)<0},o=function(e){return"INDENT"!==e[0]||e.generated&&!e.fromThen?i[0]="POST_"+i[0]:void 0};return this.scanTokens(function(e,t){return"IF"!==e[0]||(i=e,this.detectEnd(t+1,n,o)),1})},l.prototype.indentation=function(e){var t=["INDENT",2],i=["OUTDENT",2];return(e=null==e?!1:e)&&(t.generated=i.generated=!0),e||(t.explicit=i.explicit=!0),[t,i]},l.prototype.generate=B,l.prototype.tag=function(e){return null!=(e=this.tokens[e])?e[0]:void 0},l),e=[["(",")"],["[","]"],["{","}"],["INDENT","OUTDENT"],["CALL_START","CALL_END"],["PARAM_START","PARAM_END"],["INDEX_START","INDEX_END"]],c.INVERSES=t={},M=[],L=[],s=0,r=e.length;s<r;s++)o=(a=e[s])[0],a=a[1],M.push(t[a]=o),L.push(t[o]=a);function l(){}n=["CATCH","WHEN","ELSE","FINALLY"].concat(L),A=["IDENTIFIER","SUPER",")","CALL_END","]","INDEX_END","@","THIS"],D=["IDENTIFIER","NUMBER","STRING","JS","REGEX","NEW","PARAM_START","CLASS","IF","TRY","SWITCH","THIS","BOOL","NULL","UNDEFINED","UNARY","SUPER","THROW","@","->","=>","[","(","{","--","++"],R=["+","-"],I=["POST_IF","FOR","WHILE","UNTIL","WHEN","BY","LOOP","TERMINATOR"],p=["ELSE","->","=>","TRY","FINALLY","THEN"],i=["TERMINATOR","CATCH","FINALLY","ELSE","OUTDENT","LEADING_WHEN"],P=["TERMINATOR","INDENT","OUTDENT"]}.call(this),e}(),require["./lexer"]=function(){var J={},e=J;return function(){var t,s,r,c,h,u,i,a,l,n,p,d,m,f,g,y,v,o,b,_,w,k,x,S,C,T,L,M,D,I,A,R,P,E,B,F,N,U,V,O,G,z,H,W,q,e,j=[].indexOf||function(e){for(var t=0,i=this.length;t<i;t++)if(t in this&&this[t]===e)return t;return-1};function $(){}e=require("./rewriter"),E=e.Rewriter,v=e.INVERSES,e=require("./helpers"),O=e.count,e.starts,e.compact,H=e.last,W=e.repeat,G=e.invertLiterate,e.locationDataToString,q=e.throwSyntaxError,J.Lexer=($.prototype.tokenize=function(e,t){var i,n,o,s;for(this.literate=(t=null==t?{}:t).literate,this.indent=0,this.indebt=0,this.outdebt=0,this.indents=[],this.ends=[],this.tokens=[],this.chunkLine=t.line||0,this.chunkColumn=t.column||0,e=this.clean(e),n=0;this.chunk=e.slice(n);)i=this.identifierToken()||this.commentToken()||this.whitespaceToken()||this.lineToken()||this.heredocToken()||this.stringToken()||this.numberToken()||this.regexToken()||this.jsToken()||this.literalToken(),s=this.getLineAndColumnFromChunk(i),this.chunkLine=s[0],this.chunkColumn=s[1],n+=i;return this.closeIndentation(),(o=this.ends.pop())&&this.error("missing "+o),!1===t.rewrite?this.tokens:(new E).rewrite(this.tokens)},$.prototype.clean=function(e){return e=(e=e.charCodeAt(0)===t?e.slice(1):e).replace(/\r/g,"").replace(N,""),V.test(e)&&(e="\n"+e,this.chunkLine--),e=this.literate?G(e):e},$.prototype.identifierToken=function(){var e,t,i,n,o,s,r,a,l;return(n=g.exec(this.chunk))?(i=n[0],t=n[1],e=n[2],s=t.length,n=void 0,"own"===t&&"FOR"===this.tag()?(this.token("OWN",t),t.length):(r=e||(a=H(this.tokens))&&("."===(r=a[0])||"?."===r||"::"===r||"?::"===r||!a.spaced&&"@"===a[0]),o="IDENTIFIER",!r&&(0<=j.call(_,t)||0<=j.call(u,t))&&("WHEN"===(o=t.toUpperCase())&&(a=this.tag(),0<=j.call(w,a))?o="LEADING_WHEN":"FOR"===o?this.seenFor=!0:"UNLESS"===o?o="IF":0<=j.call(U,o)?o="UNARY":0<=j.call(R,o)&&("INSTANCEOF"!==o&&this.seenFor?(o="FOR"+o,this.seenFor=!1):(o="RELATION","!"===this.value()&&(n=this.tokens.pop(),t="!"+t)))),0<=j.call(b,t)&&(r?(o="IDENTIFIER",(t=new String(t)).reserved=!0):0<=j.call(P,t)&&this.error('reserved word "'+t+'"')),r||(0<=j.call(c,t)&&(t=h[t]),o=function(){switch(t){case"!":return"UNARY";case"==":case"!=":return"COMPARE";case"&&":case"||":return"LOGIC";case"true":case"false":return"BOOL";case"break":case"continue":return"STATEMENT";default:return o}}()),s=this.token(o,t,0,s),n&&(l=[n[2].first_line,n[2].first_column],s[2].first_line=l[0],s[2].first_column=l[1]),e&&(l=i.lastIndexOf(":"),this.token(":",":",l,e.length)),i.length)):0},$.prototype.numberToken=function(){var e,t,i;return(i=D.exec(this.chunk))?(t=i[0],/^0[BOX]/.test(t)?this.error("radix prefix '"+t+"' must be lowercase"):/E/.test(t)&&!/^0x/.test(t)?this.error("exponential notation '"+t+"' must be indicated with a lowercase 'e'"):/^0\d*[89]/.test(t)?this.error("decimal literal '"+t+"' must not be prefixed with '0'"):/^0\d+/.test(t)&&this.error("octal literal '"+t+"' must be prefixed with '0o'"),e=t.length,(i=/^0o([0-7]+)/.exec(t))&&(t="0x"+parseInt(i[1],8).toString(16)),(i=/^0b([01]+)/.exec(t))&&(t="0x"+parseInt(i[1],2).toString(16)),this.token("NUMBER",t,0,e),e):0},$.prototype.stringToken=function(){var e,t;switch(this.chunk.charAt(0)){case"'":if(!(e=F.exec(this.chunk)))return 0;t=e[0],this.token("STRING",t.replace(C,"\\\n"),0,t.length);break;case'"':if(!(t=this.balancedString(this.chunk,'"')))return 0;0<t.indexOf("#{",1)?this.interpolateString(t.slice(1,-1),{strOffset:1,lexedLength:t.length}):this.token("STRING",this.escapeLines(t,0,t.length));break;default:return 0}return/^(?:\\.|[^\\])*\\(?:0[0-7]|[1-7])/.test(t)&&this.error("octal escape sequences "+t+" are not allowed"),t.length},$.prototype.heredocToken=function(){var e,t,i;return(t=n.exec(this.chunk))?(i=(e=t[0]).charAt(0),t=this.sanitizeHeredoc(t[2],{quote:i,indent:null}),'"'===i&&0<=t.indexOf("#{")?this.interpolateString(t,{heredoc:!0,strOffset:3,lexedLength:e.length}):this.token("STRING",this.makeString(t,i,!0),0,e.length),e.length):0},$.prototype.commentToken=function(){var e,t;return(t=this.chunk.match(i))?(e=t[0],(t=t[1])&&this.token("HERECOMMENT",this.sanitizeHeredoc(t,{herecomment:!0,indent:W(" ",this.indent)}),0,e.length),e.length):0},$.prototype.jsToken=function(){var e;return"`"===this.chunk.charAt(0)&&(e=o.exec(this.chunk))?(this.token("JS",(e=e[0]).slice(1,-1),0,e.length),e.length):0},$.prototype.regexToken=function(){var e,t,i;return"/"!==this.chunk.charAt(0)?0:(e=m.exec(this.chunk))?this.heregexToken(e):!((i=H(this.tokens))&&(t=i[0],0<=j.call(i.spaced?L:M,t)))&&(e=A.exec(this.chunk))?(e=(i=e)[0],t=i[1],i=i[2],"/*"===t.slice(0,2)&&this.error("regular expressions cannot begin with `*`"),this.token("REGEX",""+(t="//"===t?"/(?:)/":t)+i,0,e.length),e.length):0},$.prototype.heregexToken=function(e){var t,i,n,o,s,r,a,l=e[0],c=e[1],h=e[2];if(c.indexOf("#{")<0)return(e=c.replace(f,"").replace(/\//g,"\\/")).match(/^\*/)&&this.error("regular expressions cannot begin with `*`"),this.token("REGEX","/"+(e||"(?:)")+"/"+h,0,l.length),l.length;for(this.token("IDENTIFIER","RegExp",0,0),this.token("CALL_START","(",0,0),n=[],r=(a=this.interpolateString(c,{regex:!(s=0)})).length;s<r;s++){if(t=(i=a[s])[0],o=i[1],"TOKENS"===t)n.push.apply(n,o);else if("NEOSTRING"===t){if(!(o=o.replace(f,"")))continue;o=o.replace(/\\/g,"\\\\"),i[0]="STRING",i[1]=this.makeString(o,'"',!0),n.push(i)}else this.error("Unexpected "+t);i=H(this.tokens),(t=["+","+"])[2]=i[2],n.push(t)}return n.pop(),"STRING"!==(null!=(c=n[0])?c[0]:void 0)&&(this.token("STRING",'""',0,0),this.token("+","+",0,0)),(c=this.tokens).push.apply(c,n),h&&(c=l.lastIndexOf(h),this.token(",",",",c,0),this.token("STRING",'"'+h+'"',c,h.length)),this.token(")",")",l.length-1,0),l.length},$.prototype.lineToken=function(){var e,t,i,n;if(!(t=T.exec(this.chunk)))return 0;if(e=t[0],this.seenFor=!1,n=e.length-1-e.lastIndexOf("\n"),i=this.unfinished(),n-this.indebt===this.indent)return i?this.suppressNewlines():this.newlineToken(0),e.length;if(n>this.indent){if(i)return this.indebt=n-this.indent,this.suppressNewlines(),e.length;t=n-this.indent+this.outdebt,this.token("INDENT",t,e.length-n,n),this.indents.push(t),this.ends.push("OUTDENT"),this.outdebt=this.indebt=0}else this.indebt=0,this.outdentToken(this.indent-n,i,e.length);return this.indent=n,e.length},$.prototype.outdentToken=function(e,t,i){for(var n,o;0<e;)o=this.indents.length-1,void 0===this.indents[o]?e=0:this.indents[o]===this.outdebt?(e-=this.outdebt,this.outdebt=0):this.indents[o]<this.outdebt?(this.outdebt-=this.indents[o],e-=this.indents[o]):(e-=n=this.indents.pop()+this.outdebt,this.outdebt=0,this.pair("OUTDENT"),this.token("OUTDENT",n,0,i));for(n&&(this.outdebt-=e);";"===this.value();)this.tokens.pop();return"TERMINATOR"===this.tag()||t||this.token("TERMINATOR","\n",i,0),this},$.prototype.whitespaceToken=function(){var e,t;return(e=V.exec(this.chunk))||"\n"===this.chunk.charAt(0)?((t=H(this.tokens))&&(t[e?"spaced":"newLine"]=!0),e?e[0].length:0):0},$.prototype.newlineToken=function(e){for(;";"===this.value();)this.tokens.pop();return"TERMINATOR"!==this.tag()&&this.token("TERMINATOR","\n",e,0),this},$.prototype.suppressNewlines=function(){return"\\"===this.value()&&this.tokens.pop(),this},$.prototype.literalToken=function(){var e,t,i,n,o;if((e=I.exec(this.chunk))?(i=e[0],r.test(i)&&this.tagParameters()):i=this.chunk.charAt(0),t=i,e=H(this.tokens),"="===i&&e&&(!e[1].reserved&&(n=e[1],0<=j.call(b,n))&&this.error('reserved word "'+this.value()+"\" can't be assigned"),"||"===(n=e[1])||"&&"===n))return e[0]="COMPOUND_ASSIGN",e[1]+="=",i.length;switch(";"===i?(this.seenFor=!1,t="TERMINATOR"):0<=j.call(S,i)?t="MATH":0<=j.call(a,i)?t="COMPARE":0<=j.call(l,i)?t="COMPOUND_ASSIGN":0<=j.call(U,i)?t="UNARY":0<=j.call(B,i)?t="SHIFT":0<=j.call(x,i)||"?"===i&&null!=e&&e.spaced?t="LOGIC":e&&!e.spaced&&("("===i&&(o=e[0],0<=j.call(s,o))?("?"===e[0]&&(e[0]="FUNC_EXIST"),t="CALL_START"):"["===i&&(o=e[0],0<=j.call(y,o))&&"?"===(t="INDEX_START",e[0])&&(e[0]="INDEX_SOAK")),i){case"(":case"{":case"[":this.ends.push(v[i]);break;case")":case"}":case"]":this.pair(i)}return this.token(t,i),i.length},$.prototype.sanitizeHeredoc=function(e,t){var i,n,o=t.indent;if(t=t.herecomment){if(p.test(e)&&this.error('block comment cannot contain "*/", starting'),e.indexOf("\n")<0)return e}else for(;n=d.exec(e);)i=n[1],(null===o||0<(n=i.length)&&n<o.length)&&(o=i);return o&&(e=e.replace(RegExp("\\n"+o,"g"),"\n")),e=!t?e.replace(/^\n/,""):e},$.prototype.tagParameters=function(){var e,t,i,n;if(")"!==this.tag())return this;for(t=[],e=(n=this.tokens).length,n[--e][0]="PARAM_END";i=n[--e];)switch(i[0]){case")":t.push(i);break;case"(":case"CALL_START":if(!t.length)return"("===i[0]&&(i[0]="PARAM_START"),this;t.pop()}return this},$.prototype.closeIndentation=function(){return this.outdentToken(this.indent)},$.prototype.balancedString=function(e,t){for(var i,n,o,s,r=0,a=[t],l=s=1,c=e.length;1<=c?s<c:c<s;l=1<=c?++s:--s)if(r)--r;else{switch(i=e.charAt(l)){case"\\":++r;continue;case t:if(a.pop(),!a.length)return e.slice(0,+l+1||9e9);t=a[a.length-1];continue}"}"!==t||'"'!==i&&"'"!==i?"}"===t&&"/"===i&&(n=m.exec(e.slice(l))||A.exec(e.slice(l)))?r+=n[0].length-1:("}"===t&&"{"===i||'"'===t&&"#"===o&&"{"===i)&&a.push(t="}"):a.push(t=i),o=i}return this.error("missing "+a.pop()+", starting")},$.prototype.interpolateString=function(e,t){var i,n,o,s,r,a,l,c,h,u,p,d,m,f,g=(t=null==t?{}:t).heredoc,y=t.regex,v=t.offsetInChunk||0,b=(b=t.strOffset)||0,t=(t=t.lexedLength)||e.length;for(g&&0<e.length&&"\n"===e[0]&&(e=e.slice(1),b++),h=[],r=0,n=-1;s=e.charAt(n+=1);)"\\"!==s?"#"===s&&"{"===e.charAt(n+1)&&(i=this.balancedString(e.slice(n+1),"}"))&&(r<n&&h.push(this.makeToken("NEOSTRING",e.slice(r,n),b+r)),(o=i.slice(1,-1)).length&&(s=(m=this.getLineAndColumnFromChunk(b+n+1))[0],m=m[1],(s=(new $).tokenize(o,{line:s,column:m,rewrite:!1})).pop(),"TERMINATOR"===(null!=(m=s[0])?m[0]:void 0)&&s.shift(),(m=s.length)&&(1<m&&(s.unshift(this.makeToken("(","(",b+n+1,0)),s.push(this.makeToken(")",")",b+n+1+o.length,0))),h.push(["TOKENS",s]))),r=(n+=i.length)+1):n+=1;if(r<n&&r<e.length&&h.push(this.makeToken("NEOSTRING",e.slice(r),b+r)),y)return h;if(!h.length)return this.token("STRING",'""',v,t);for("NEOSTRING"!==h[0][0]&&h.unshift(this.makeToken("NEOSTRING","",v)),(y=1<h.length)&&this.token("(","(",v,0),n=p=0,d=h.length;p<d;n=++p)l=(c=h[n])[0],u=c[1],n&&(n&&(a=this.token("+","+")),f="TOKENS"===l?u[0]:c,a[2]={first_line:f[2].first_line,first_column:f[2].first_column,last_line:f[2].first_line,last_column:f[2].first_column}),"TOKENS"===l?(f=this.tokens).push.apply(f,u):"NEOSTRING"===l?(c[0]="STRING",c[1]=this.makeString(u,'"',g),this.tokens.push(c)):this.error("Unexpected "+l);return y&&((t=this.makeToken(")",")",v+t,0)).stringEnd=!0,this.tokens.push(t)),h},$.prototype.pair=function(e){var t;return e!==(t=H(this.ends))?("OUTDENT"!==t&&this.error("unmatched "+e),this.indent-=t=H(this.indents),this.outdentToken(t,!0),this.pair(e)):this.ends.pop()},$.prototype.getLineAndColumnFromChunk=function(e){var t,i,n;return 0===e?[this.chunkLine,this.chunkColumn]:(n=e>=this.chunk.length?this.chunk:this.chunk.slice(0,+(e-1)+1||9e9),i=O(n,"\n"),t=this.chunkColumn,0<i?(e=n.split("\n"),t=H(e).length):t+=n.length,[this.chunkLine+i,t])},$.prototype.makeToken=function(e,t,i,n){var o,s;return null==n&&(n=t.length),o={},s=this.getLineAndColumnFromChunk(i=null==i?0:i),o.first_line=s[0],o.first_column=s[1],n=Math.max(0,n-1),n=this.getLineAndColumnFromChunk(i+n),o.last_line=n[0],o.last_column=n[1],[e,t,o]},$.prototype.token=function(e,t,i,n){n=this.makeToken(e,t,i,n);return this.tokens.push(n),n},$.prototype.tag=function(e,t){return(e=H(this.tokens,e))&&(t?e[0]=t:e[0])},$.prototype.value=function(e,t){return(e=H(this.tokens,e))&&(t?e[1]=t:e[1])},$.prototype.unfinished=function(){var e;return k.test(this.chunk)||"\\"===(e=this.tag())||"."===e||"?."===e||"?::"===e||"UNARY"===e||"MATH"===e||"+"===e||"-"===e||"SHIFT"===e||"RELATION"===e||"COMPARE"===e||"LOGIC"===e||"THROW"===e||"EXTENDS"===e},$.prototype.escapeLines=function(e,t){return e.replace(C,t?"\\n":"")},$.prototype.makeString=function(e,i,t){return e?(e=(e=e.replace(/\\([\s\S])/g,function(e,t){return"\n"===t||t===i?t:e})).replace(RegExp(""+i,"g"),"\\$&"),i+this.escapeLines(e,t)+i):i+i},$.prototype.error=function(e){return q(e,{first_line:this.chunkLine,first_column:this.chunkColumn})},$),_=["true","false","null","this","new","delete","typeof","in","instanceof","return","throw","break","continue","debugger","if","else","switch","for","while","do","try","catch","finally","class","extends","super"],u=["undefined","then","unless","until","loop","of","by","when"],h={and:"&&",or:"||",is:"==",isnt:"!=",not:"!",yes:"true",no:"false",on:"true",off:"false"},c=function(){var e=[];for(z in h)e.push(z);return e}(),u=u.concat(c),P=["case","default","function","var","void","with","const","let","enum","export","import","native","__hasProp","__extends","__slice","__bind","__indexOf","implements","interface","package","private","protected","public","static","yield"],e=["arguments","eval"],b=_.concat(P).concat(e),J.RESERVED=P.concat(_).concat(u).concat(e),J.STRICT_PROSCRIBED=e,t=65279,g=/^([$A-Za-z_\x7f-\uffff][$\w\x7f-\uffff]*)([^\n\S]*:(?!:))?/,D=/^0b[01]+|^0o[0-7]+|^0x[\da-f]+|^\d*\.?\d+(?:e[+-]?\d+)?/i,n=/^("""|''')([\s\S]*?)(?:\n[^\n\S]*)?\1/,I=/^(?:[-=]>|[-+*\/%<>&|^!?=]=|>>>=?|([-+:])\1|([&|<>])\2=?|\?(\.|::)|\.{2,3})/,V=/^[^\n\S]+/,i=/^###([^#][\s\S]*?)(?:###[^\n\S]*|(?:###)$)|^(?:\s*#(?!##[^#]).*)+/,r=/^[-=]>/,T=/^(?:\n[^\n\S]*)+/,F=/^'[^\\']*(?:\\.[^\\']*)*'/,o=/^`[^\\`]*(?:\\.[^\\`]*)*`/,A=/^(\/(?![\s=])[^[\/\n\\]*(?:(?:\\[\s\S]|\[[^\]\n\\]*(?:\\[\s\S][^\]\n\\]*)*])[^[\/\n\\]*)*\/)([imgy]{0,4})(?!\w)/,m=/^\/{3}([\s\S]+?)\/{3}([imgy]{0,4})(?!\w)/,f=/\s+(?:#.*)?/g,C=/\n/g,d=/\n+([^\n\S]*)/g,p=/\*\//,k=/^\s*(?:,|\??\.(?![.\d])|::)/,N=/\s+$/,l=["-=","+=","/=","*=","%=","||=","&&=","?=","<<=",">>=",">>>=","&=","^=","|="],U=["!","~","NEW","TYPEOF","DELETE","DO"],x=["&&","||","&","|","^"],B=["<<",">>",">>>"],a=["==","!=","<",">","<=",">="],S=["*","/","%"],R=["IN","OF","INSTANCEOF"],M=(L=["NUMBER","REGEX","BOOL","NULL","UNDEFINED","++","--"]).concat(")","}","THIS","IDENTIFIER","STRING","]"),y=(s=["IDENTIFIER","STRING","REGEX",")","]","}","?","::","@","THIS","SUPER"]).concat("NUMBER","BOOL","NULL","UNDEFINED"),w=["INDENT","OUTDENT","TERMINATOR"]}.call(this),e}(),require["./parser"]=(Zy2={},$y2={exports:Zy2},bz2={trace:function(){},yy:{},symbols_:{error:2,Root:3,Body:4,Block:5,TERMINATOR:6,Line:7,Expression:8,Statement:9,Return:10,Comment:11,STATEMENT:12,Value:13,Invocation:14,Code:15,Operation:16,Assign:17,If:18,Try:19,While:20,For:21,Switch:22,Class:23,Throw:24,INDENT:25,OUTDENT:26,Identifier:27,IDENTIFIER:28,AlphaNumeric:29,NUMBER:30,STRING:31,Literal:32,JS:33,REGEX:34,DEBUGGER:35,UNDEFINED:36,NULL:37,BOOL:38,Assignable:39,"=":40,AssignObj:41,ObjAssignable:42,":":43,ThisProperty:44,RETURN:45,HERECOMMENT:46,PARAM_START:47,ParamList:48,PARAM_END:49,FuncGlyph:50,"->":51,"=>":52,OptComma:53,",":54,Param:55,ParamVar:56,"...":57,Array:58,Object:59,Splat:60,SimpleAssignable:61,Accessor:62,Parenthetical:63,Range:64,This:65,".":66,"?.":67,"::":68,"?::":69,Index:70,INDEX_START:71,IndexValue:72,INDEX_END:73,INDEX_SOAK:74,Slice:75,"{":76,AssignList:77,"}":78,CLASS:79,EXTENDS:80,OptFuncExist:81,Arguments:82,SUPER:83,FUNC_EXIST:84,CALL_START:85,CALL_END:86,ArgList:87,THIS:88,"@":89,"[":90,"]":91,RangeDots:92,"..":93,Arg:94,SimpleArgs:95,TRY:96,Catch:97,FINALLY:98,CATCH:99,THROW:100,"(":101,")":102,WhileSource:103,WHILE:104,WHEN:105,UNTIL:106,Loop:107,LOOP:108,ForBody:109,FOR:110,ForStart:111,ForSource:112,ForVariables:113,OWN:114,ForValue:115,FORIN:116,FOROF:117,BY:118,SWITCH:119,Whens:120,ELSE:121,When:122,LEADING_WHEN:123,IfBlock:124,IF:125,POST_IF:126,UNARY:127,"-":128,"+":129,"--":130,"++":131,"?":132,MATH:133,SHIFT:134,COMPARE:135,LOGIC:136,RELATION:137,COMPOUND_ASSIGN:138,$accept:0,$end:1},terminals_:{2:"error",6:"TERMINATOR",12:"STATEMENT",25:"INDENT",26:"OUTDENT",28:"IDENTIFIER",30:"NUMBER",31:"STRING",33:"JS",34:"REGEX",35:"DEBUGGER",36:"UNDEFINED",37:"NULL",38:"BOOL",40:"=",43:":",45:"RETURN",46:"HERECOMMENT",47:"PARAM_START",49:"PARAM_END",51:"->",52:"=>",54:",",57:"...",66:".",67:"?.",68:"::",69:"?::",71:"INDEX_START",73:"INDEX_END",74:"INDEX_SOAK",76:"{",78:"}",79:"CLASS",80:"EXTENDS",83:"SUPER",84:"FUNC_EXIST",85:"CALL_START",86:"CALL_END",88:"THIS",89:"@",90:"[",91:"]",93:"..",96:"TRY",98:"FINALLY",99:"CATCH",100:"THROW",101:"(",102:")",104:"WHILE",105:"WHEN",106:"UNTIL",108:"LOOP",110:"FOR",114:"OWN",116:"FORIN",117:"FOROF",118:"BY",119:"SWITCH",121:"ELSE",123:"LEADING_WHEN",125:"IF",126:"POST_IF",127:"UNARY",128:"-",129:"+",130:"--",131:"++",132:"?",133:"MATH",134:"SHIFT",135:"COMPARE",136:"LOGIC",137:"RELATION",138:"COMPOUND_ASSIGN"},productions_:[0,[3,0],[3,1],[3,2],[4,1],[4,3],[4,2],[7,1],[7,1],[9,1],[9,1],[9,1],[8,1],[8,1],[8,1],[8,1],[8,1],[8,1],[8,1],[8,1],[8,1],[8,1],[8,1],[8,1],[5,2],[5,3],[27,1],[29,1],[29,1],[32,1],[32,1],[32,1],[32,1],[32,1],[32,1],[32,1],[17,3],[17,4],[17,5],[41,1],[41,3],[41,5],[41,1],[42,1],[42,1],[42,1],[10,2],[10,1],[11,1],[15,5],[15,2],[50,1],[50,1],[53,0],[53,1],[48,0],[48,1],[48,3],[48,4],[48,6],[55,1],[55,2],[55,3],[56,1],[56,1],[56,1],[56,1],[60,2],[61,1],[61,2],[61,2],[61,1],[39,1],[39,1],[39,1],[13,1],[13,1],[13,1],[13,1],[13,1],[62,2],[62,2],[62,2],[62,2],[62,1],[62,1],[70,3],[70,2],[72,1],[72,1],[59,4],[77,0],[77,1],[77,3],[77,4],[77,6],[23,1],[23,2],[23,3],[23,4],[23,2],[23,3],[23,4],[23,5],[14,3],[14,3],[14,1],[14,2],[81,0],[81,1],[82,2],[82,4],[65,1],[65,1],[44,2],[58,2],[58,4],[92,1],[92,1],[64,5],[75,3],[75,2],[75,2],[75,1],[87,1],[87,3],[87,4],[87,4],[87,6],[94,1],[94,1],[95,1],[95,3],[19,2],[19,3],[19,4],[19,5],[97,3],[97,3],[97,2],[24,2],[63,3],[63,5],[103,2],[103,4],[103,2],[103,4],[20,2],[20,2],[20,2],[20,1],[107,2],[107,2],[21,2],[21,2],[21,2],[109,2],[109,2],[111,2],[111,3],[115,1],[115,1],[115,1],[115,1],[113,1],[113,3],[112,2],[112,2],[112,4],[112,4],[112,4],[112,6],[112,6],[22,5],[22,7],[22,4],[22,6],[120,1],[120,2],[122,3],[122,4],[124,3],[124,5],[18,1],[18,3],[18,3],[18,3],[16,2],[16,2],[16,2],[16,2],[16,2],[16,2],[16,2],[16,2],[16,3],[16,3],[16,3],[16,3],[16,3],[16,3],[16,3],[16,3],[16,5],[16,4],[16,3]],performAction:function(e,t,i,n,o,s,r){var a=s.length-1;switch(o){case 1:return this.$=n.addLocationDataFn(r[a],r[a])(new n.Block);case 2:return this.$=s[a];case 3:return this.$=s[a-1];case 4:this.$=n.addLocationDataFn(r[a],r[a])(n.Block.wrap([s[a]]));break;case 5:this.$=n.addLocationDataFn(r[a-2],r[a])(s[a-2].push(s[a]));break;case 6:this.$=s[a-1];break;case 7:case 8:case 9:case 10:this.$=s[a];break;case 11:this.$=n.addLocationDataFn(r[a],r[a])(new n.Literal(s[a]));break;case 12:case 13:case 14:case 15:case 16:case 17:case 18:case 19:case 20:case 21:case 22:case 23:this.$=s[a];break;case 24:this.$=n.addLocationDataFn(r[a-1],r[a])(new n.Block);break;case 25:this.$=n.addLocationDataFn(r[a-2],r[a])(s[a-1]);break;case 26:case 27:case 28:this.$=n.addLocationDataFn(r[a],r[a])(new n.Literal(s[a]));break;case 29:this.$=s[a];break;case 30:case 31:case 32:this.$=n.addLocationDataFn(r[a],r[a])(new n.Literal(s[a]));break;case 33:this.$=n.addLocationDataFn(r[a],r[a])(new n.Undefined);break;case 34:this.$=n.addLocationDataFn(r[a],r[a])(new n.Null);break;case 35:this.$=n.addLocationDataFn(r[a],r[a])(new n.Bool(s[a]));break;case 36:this.$=n.addLocationDataFn(r[a-2],r[a])(new n.Assign(s[a-2],s[a]));break;case 37:this.$=n.addLocationDataFn(r[a-3],r[a])(new n.Assign(s[a-3],s[a]));break;case 38:this.$=n.addLocationDataFn(r[a-4],r[a])(new n.Assign(s[a-4],s[a-1]));break;case 39:this.$=n.addLocationDataFn(r[a],r[a])(new n.Value(s[a]));break;case 40:this.$=n.addLocationDataFn(r[a-2],r[a])(new n.Assign(n.addLocationDataFn(r[a-2])(new n.Value(s[a-2])),s[a],"object"));break;case 41:this.$=n.addLocationDataFn(r[a-4],r[a])(new n.Assign(n.addLocationDataFn(r[a-4])(new n.Value(s[a-4])),s[a-1],"object"));break;case 42:case 43:case 44:case 45:this.$=s[a];break;case 46:this.$=n.addLocationDataFn(r[a-1],r[a])(new n.Return(s[a]));break;case 47:this.$=n.addLocationDataFn(r[a],r[a])(new n.Return);break;case 48:this.$=n.addLocationDataFn(r[a],r[a])(new n.Comment(s[a]));break;case 49:this.$=n.addLocationDataFn(r[a-4],r[a])(new n.Code(s[a-3],s[a],s[a-1]));break;case 50:this.$=n.addLocationDataFn(r[a-1],r[a])(new n.Code([],s[a],s[a-1]));break;case 51:this.$=n.addLocationDataFn(r[a],r[a])("func");break;case 52:this.$=n.addLocationDataFn(r[a],r[a])("boundfunc");break;case 53:case 54:this.$=s[a];break;case 55:this.$=n.addLocationDataFn(r[a],r[a])([]);break;case 56:this.$=n.addLocationDataFn(r[a],r[a])([s[a]]);break;case 57:this.$=n.addLocationDataFn(r[a-2],r[a])(s[a-2].concat(s[a]));break;case 58:this.$=n.addLocationDataFn(r[a-3],r[a])(s[a-3].concat(s[a]));break;case 59:this.$=n.addLocationDataFn(r[a-5],r[a])(s[a-5].concat(s[a-2]));break;case 60:this.$=n.addLocationDataFn(r[a],r[a])(new n.Param(s[a]));break;case 61:this.$=n.addLocationDataFn(r[a-1],r[a])(new n.Param(s[a-1],null,!0));break;case 62:this.$=n.addLocationDataFn(r[a-2],r[a])(new n.Param(s[a-2],s[a]));break;case 63:case 64:case 65:case 66:this.$=s[a];break;case 67:this.$=n.addLocationDataFn(r[a-1],r[a])(new n.Splat(s[a-1]));break;case 68:this.$=n.addLocationDataFn(r[a],r[a])(new n.Value(s[a]));break;case 69:this.$=n.addLocationDataFn(r[a-1],r[a])(s[a-1].add(s[a]));break;case 70:this.$=n.addLocationDataFn(r[a-1],r[a])(new n.Value(s[a-1],[].concat(s[a])));break;case 71:case 72:this.$=s[a];break;case 73:case 74:this.$=n.addLocationDataFn(r[a],r[a])(new n.Value(s[a]));break;case 75:this.$=s[a];break;case 76:case 77:case 78:this.$=n.addLocationDataFn(r[a],r[a])(new n.Value(s[a]));break;case 79:this.$=s[a];break;case 80:this.$=n.addLocationDataFn(r[a-1],r[a])(new n.Access(s[a]));break;case 81:this.$=n.addLocationDataFn(r[a-1],r[a])(new n.Access(s[a],"soak"));break;case 82:this.$=n.addLocationDataFn(r[a-1],r[a])([n.addLocationDataFn(r[a-1])(new n.Access(new n.Literal("prototype"))),n.addLocationDataFn(r[a])(new n.Access(s[a]))]);break;case 83:this.$=n.addLocationDataFn(r[a-1],r[a])([n.addLocationDataFn(r[a-1])(new n.Access(new n.Literal("prototype"),"soak")),n.addLocationDataFn(r[a])(new n.Access(s[a]))]);break;case 84:this.$=n.addLocationDataFn(r[a],r[a])(new n.Access(new n.Literal("prototype")));break;case 85:this.$=s[a];break;case 86:this.$=n.addLocationDataFn(r[a-2],r[a])(s[a-1]);break;case 87:this.$=n.addLocationDataFn(r[a-1],r[a])(n.extend(s[a],{soak:!0}));break;case 88:this.$=n.addLocationDataFn(r[a],r[a])(new n.Index(s[a]));break;case 89:this.$=n.addLocationDataFn(r[a],r[a])(new n.Slice(s[a]));break;case 90:this.$=n.addLocationDataFn(r[a-3],r[a])(new n.Obj(s[a-2],s[a-3].generated));break;case 91:this.$=n.addLocationDataFn(r[a],r[a])([]);break;case 92:this.$=n.addLocationDataFn(r[a],r[a])([s[a]]);break;case 93:this.$=n.addLocationDataFn(r[a-2],r[a])(s[a-2].concat(s[a]));break;case 94:this.$=n.addLocationDataFn(r[a-3],r[a])(s[a-3].concat(s[a]));break;case 95:this.$=n.addLocationDataFn(r[a-5],r[a])(s[a-5].concat(s[a-2]));break;case 96:this.$=n.addLocationDataFn(r[a],r[a])(new n.Class);break;case 97:this.$=n.addLocationDataFn(r[a-1],r[a])(new n.Class(null,null,s[a]));break;case 98:this.$=n.addLocationDataFn(r[a-2],r[a])(new n.Class(null,s[a]));break;case 99:this.$=n.addLocationDataFn(r[a-3],r[a])(new n.Class(null,s[a-1],s[a]));break;case 100:this.$=n.addLocationDataFn(r[a-1],r[a])(new n.Class(s[a]));break;case 101:this.$=n.addLocationDataFn(r[a-2],r[a])(new n.Class(s[a-1],null,s[a]));break;case 102:this.$=n.addLocationDataFn(r[a-3],r[a])(new n.Class(s[a-2],s[a]));break;case 103:this.$=n.addLocationDataFn(r[a-4],r[a])(new n.Class(s[a-3],s[a-1],s[a]));break;case 104:case 105:this.$=n.addLocationDataFn(r[a-2],r[a])(new n.Call(s[a-2],s[a],s[a-1]));break;case 106:this.$=n.addLocationDataFn(r[a],r[a])(new n.Call("super",[new n.Splat(new n.Literal("arguments"))]));break;case 107:this.$=n.addLocationDataFn(r[a-1],r[a])(new n.Call("super",s[a]));break;case 108:this.$=n.addLocationDataFn(r[a],r[a])(!1);break;case 109:this.$=n.addLocationDataFn(r[a],r[a])(!0);break;case 110:this.$=n.addLocationDataFn(r[a-1],r[a])([]);break;case 111:this.$=n.addLocationDataFn(r[a-3],r[a])(s[a-2]);break;case 112:case 113:this.$=n.addLocationDataFn(r[a],r[a])(new n.Value(new n.Literal("this")));break;case 114:this.$=n.addLocationDataFn(r[a-1],r[a])(new n.Value(n.addLocationDataFn(r[a-1])(new n.Literal("this")),[n.addLocationDataFn(r[a])(new n.Access(s[a]))],"this"));break;case 115:this.$=n.addLocationDataFn(r[a-1],r[a])(new n.Arr([]));break;case 116:this.$=n.addLocationDataFn(r[a-3],r[a])(new n.Arr(s[a-2]));break;case 117:this.$=n.addLocationDataFn(r[a],r[a])("inclusive");break;case 118:this.$=n.addLocationDataFn(r[a],r[a])("exclusive");break;case 119:this.$=n.addLocationDataFn(r[a-4],r[a])(new n.Range(s[a-3],s[a-1],s[a-2]));break;case 120:this.$=n.addLocationDataFn(r[a-2],r[a])(new n.Range(s[a-2],s[a],s[a-1]));break;case 121:this.$=n.addLocationDataFn(r[a-1],r[a])(new n.Range(s[a-1],null,s[a]));break;case 122:this.$=n.addLocationDataFn(r[a-1],r[a])(new n.Range(null,s[a],s[a-1]));break;case 123:this.$=n.addLocationDataFn(r[a],r[a])(new n.Range(null,null,s[a]));break;case 124:this.$=n.addLocationDataFn(r[a],r[a])([s[a]]);break;case 125:this.$=n.addLocationDataFn(r[a-2],r[a])(s[a-2].concat(s[a]));break;case 126:this.$=n.addLocationDataFn(r[a-3],r[a])(s[a-3].concat(s[a]));break;case 127:this.$=n.addLocationDataFn(r[a-3],r[a])(s[a-2]);break;case 128:this.$=n.addLocationDataFn(r[a-5],r[a])(s[a-5].concat(s[a-2]));break;case 129:case 130:case 131:this.$=s[a];break;case 132:this.$=n.addLocationDataFn(r[a-2],r[a])([].concat(s[a-2],s[a]));break;case 133:this.$=n.addLocationDataFn(r[a-1],r[a])(new n.Try(s[a]));break;case 134:this.$=n.addLocationDataFn(r[a-2],r[a])(new n.Try(s[a-1],s[a][0],s[a][1]));break;case 135:this.$=n.addLocationDataFn(r[a-3],r[a])(new n.Try(s[a-2],null,null,s[a]));break;case 136:this.$=n.addLocationDataFn(r[a-4],r[a])(new n.Try(s[a-3],s[a-2][0],s[a-2][1],s[a]));break;case 137:this.$=n.addLocationDataFn(r[a-2],r[a])([s[a-1],s[a]]);break;case 138:this.$=n.addLocationDataFn(r[a-2],r[a])([n.addLocationDataFn(r[a-1])(new n.Value(s[a-1])),s[a]]);break;case 139:this.$=n.addLocationDataFn(r[a-1],r[a])([null,s[a]]);break;case 140:this.$=n.addLocationDataFn(r[a-1],r[a])(new n.Throw(s[a]));break;case 141:this.$=n.addLocationDataFn(r[a-2],r[a])(new n.Parens(s[a-1]));break;case 142:this.$=n.addLocationDataFn(r[a-4],r[a])(new n.Parens(s[a-2]));break;case 143:this.$=n.addLocationDataFn(r[a-1],r[a])(new n.While(s[a]));break;case 144:this.$=n.addLocationDataFn(r[a-3],r[a])(new n.While(s[a-2],{guard:s[a]}));break;case 145:this.$=n.addLocationDataFn(r[a-1],r[a])(new n.While(s[a],{invert:!0}));break;case 146:this.$=n.addLocationDataFn(r[a-3],r[a])(new n.While(s[a-2],{invert:!0,guard:s[a]}));break;case 147:this.$=n.addLocationDataFn(r[a-1],r[a])(s[a-1].addBody(s[a]));break;case 148:case 149:this.$=n.addLocationDataFn(r[a-1],r[a])(s[a].addBody(n.addLocationDataFn(r[a-1])(n.Block.wrap([s[a-1]]))));break;case 150:this.$=n.addLocationDataFn(r[a],r[a])(s[a]);break;case 151:this.$=n.addLocationDataFn(r[a-1],r[a])(new n.While(n.addLocationDataFn(r[a-1])(new n.Literal("true"))).addBody(s[a]));break;case 152:this.$=n.addLocationDataFn(r[a-1],r[a])(new n.While(n.addLocationDataFn(r[a-1])(new n.Literal("true"))).addBody(n.addLocationDataFn(r[a])(n.Block.wrap([s[a]]))));break;case 153:case 154:this.$=n.addLocationDataFn(r[a-1],r[a])(new n.For(s[a-1],s[a]));break;case 155:this.$=n.addLocationDataFn(r[a-1],r[a])(new n.For(s[a],s[a-1]));break;case 156:this.$=n.addLocationDataFn(r[a-1],r[a])({source:n.addLocationDataFn(r[a])(new n.Value(s[a]))});break;case 157:this.$=n.addLocationDataFn(r[a-1],r[a])((s[a].own=s[a-1].own,s[a].name=s[a-1][0],s[a].index=s[a-1][1],s[a]));break;case 158:this.$=n.addLocationDataFn(r[a-1],r[a])(s[a]);break;case 159:this.$=n.addLocationDataFn(r[a-2],r[a])((s[a].own=!0,s[a]));break;case 160:case 161:this.$=s[a];break;case 162:case 163:this.$=n.addLocationDataFn(r[a],r[a])(new n.Value(s[a]));break;case 164:this.$=n.addLocationDataFn(r[a],r[a])([s[a]]);break;case 165:this.$=n.addLocationDataFn(r[a-2],r[a])([s[a-2],s[a]]);break;case 166:this.$=n.addLocationDataFn(r[a-1],r[a])({source:s[a]});break;case 167:this.$=n.addLocationDataFn(r[a-1],r[a])({source:s[a],object:!0});break;case 168:this.$=n.addLocationDataFn(r[a-3],r[a])({source:s[a-2],guard:s[a]});break;case 169:this.$=n.addLocationDataFn(r[a-3],r[a])({source:s[a-2],guard:s[a],object:!0});break;case 170:this.$=n.addLocationDataFn(r[a-3],r[a])({source:s[a-2],step:s[a]});break;case 171:this.$=n.addLocationDataFn(r[a-5],r[a])({source:s[a-4],guard:s[a-2],step:s[a]});break;case 172:this.$=n.addLocationDataFn(r[a-5],r[a])({source:s[a-4],step:s[a-2],guard:s[a]});break;case 173:this.$=n.addLocationDataFn(r[a-4],r[a])(new n.Switch(s[a-3],s[a-1]));break;case 174:this.$=n.addLocationDataFn(r[a-6],r[a])(new n.Switch(s[a-5],s[a-3],s[a-1]));break;case 175:this.$=n.addLocationDataFn(r[a-3],r[a])(new n.Switch(null,s[a-1]));break;case 176:this.$=n.addLocationDataFn(r[a-5],r[a])(new n.Switch(null,s[a-3],s[a-1]));break;case 177:this.$=s[a];break;case 178:this.$=n.addLocationDataFn(r[a-1],r[a])(s[a-1].concat(s[a]));break;case 179:this.$=n.addLocationDataFn(r[a-2],r[a])([[s[a-1],s[a]]]);break;case 180:this.$=n.addLocationDataFn(r[a-3],r[a])([[s[a-2],s[a-1]]]);break;case 181:this.$=n.addLocationDataFn(r[a-2],r[a])(new n.If(s[a-1],s[a],{type:s[a-2]}));break;case 182:this.$=n.addLocationDataFn(r[a-4],r[a])(s[a-4].addElse(new n.If(s[a-1],s[a],{type:s[a-2]})));break;case 183:this.$=s[a];break;case 184:this.$=n.addLocationDataFn(r[a-2],r[a])(s[a-2].addElse(s[a]));break;case 185:case 186:this.$=n.addLocationDataFn(r[a-2],r[a])(new n.If(s[a],n.addLocationDataFn(r[a-2])(n.Block.wrap([s[a-2]])),{type:s[a-1],statement:!0}));break;case 187:this.$=n.addLocationDataFn(r[a-1],r[a])(new n.Op(s[a-1],s[a]));break;case 188:this.$=n.addLocationDataFn(r[a-1],r[a])(new n.Op("-",s[a]));break;case 189:this.$=n.addLocationDataFn(r[a-1],r[a])(new n.Op("+",s[a]));break;case 190:this.$=n.addLocationDataFn(r[a-1],r[a])(new n.Op("--",s[a]));break;case 191:this.$=n.addLocationDataFn(r[a-1],r[a])(new n.Op("++",s[a]));break;case 192:this.$=n.addLocationDataFn(r[a-1],r[a])(new n.Op("--",s[a-1],null,!0));break;case 193:this.$=n.addLocationDataFn(r[a-1],r[a])(new n.Op("++",s[a-1],null,!0));break;case 194:this.$=n.addLocationDataFn(r[a-1],r[a])(new n.Existence(s[a-1]));break;case 195:this.$=n.addLocationDataFn(r[a-2],r[a])(new n.Op("+",s[a-2],s[a]));break;case 196:this.$=n.addLocationDataFn(r[a-2],r[a])(new n.Op("-",s[a-2],s[a]));break;case 197:case 198:case 199:case 200:this.$=n.addLocationDataFn(r[a-2],r[a])(new n.Op(s[a-1],s[a-2],s[a]));break;case 201:this.$=n.addLocationDataFn(r[a-2],r[a])("!"===s[a-1].charAt(0)?new n.Op(s[a-1].slice(1),s[a-2],s[a]).invert():new n.Op(s[a-1],s[a-2],s[a]));break;case 202:this.$=n.addLocationDataFn(r[a-2],r[a])(new n.Assign(s[a-2],s[a],s[a-1]));break;case 203:this.$=n.addLocationDataFn(r[a-4],r[a])(new n.Assign(s[a-4],s[a-1],s[a-3]));break;case 204:this.$=n.addLocationDataFn(r[a-3],r[a])(new n.Assign(s[a-3],s[a],s[a-2]));break;case 205:this.$=n.addLocationDataFn(r[a-2],r[a])(new n.Extends(s[a-2],s[a]))}},table:[{1:[2,1],3:1,4:2,5:3,7:4,8:6,9:7,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,25:[1,5],27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,76:[1,70],79:[1,43],83:[1,28],88:[1,58],89:[1,59],90:[1,57],96:[1,38],100:[1,44],101:[1,56],103:39,104:[1,65],106:[1,66],107:40,108:[1,67],109:41,110:[1,68],111:69,119:[1,42],124:37,125:[1,64],127:[1,31],128:[1,32],129:[1,33],130:[1,34],131:[1,35]},{1:[3]},{1:[2,2],6:[1,74]},{6:[1,75]},{1:[2,4],6:[2,4],26:[2,4],102:[2,4]},{4:77,7:4,8:6,9:7,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,26:[1,76],27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,76:[1,70],79:[1,43],83:[1,28],88:[1,58],89:[1,59],90:[1,57],96:[1,38],100:[1,44],101:[1,56],103:39,104:[1,65],106:[1,66],107:40,108:[1,67],109:41,110:[1,68],111:69,119:[1,42],124:37,125:[1,64],127:[1,31],128:[1,32],129:[1,33],130:[1,34],131:[1,35]},{1:[2,7],6:[2,7],26:[2,7],102:[2,7],103:87,104:[1,65],106:[1,66],109:88,110:[1,68],111:69,126:[1,86],128:[1,80],129:[1,79],132:[1,78],133:[1,81],134:[1,82],135:[1,83],136:[1,84],137:[1,85]},{1:[2,8],6:[2,8],26:[2,8],102:[2,8],103:90,104:[1,65],106:[1,66],109:91,110:[1,68],111:69,126:[1,89]},{1:[2,12],6:[2,12],25:[2,12],26:[2,12],49:[2,12],54:[2,12],57:[2,12],62:93,66:[1,95],67:[1,96],68:[1,97],69:[1,98],70:99,71:[1,100],73:[2,12],74:[1,101],78:[2,12],81:92,84:[1,94],85:[2,108],86:[2,12],91:[2,12],93:[2,12],102:[2,12],104:[2,12],105:[2,12],106:[2,12],110:[2,12],118:[2,12],126:[2,12],128:[2,12],129:[2,12],132:[2,12],133:[2,12],134:[2,12],135:[2,12],136:[2,12],137:[2,12]},{1:[2,13],6:[2,13],25:[2,13],26:[2,13],49:[2,13],54:[2,13],57:[2,13],62:103,66:[1,95],67:[1,96],68:[1,97],69:[1,98],70:99,71:[1,100],73:[2,13],74:[1,101],78:[2,13],81:102,84:[1,94],85:[2,108],86:[2,13],91:[2,13],93:[2,13],102:[2,13],104:[2,13],105:[2,13],106:[2,13],110:[2,13],118:[2,13],126:[2,13],128:[2,13],129:[2,13],132:[2,13],133:[2,13],134:[2,13],135:[2,13],136:[2,13],137:[2,13]},{1:[2,14],6:[2,14],25:[2,14],26:[2,14],49:[2,14],54:[2,14],57:[2,14],73:[2,14],78:[2,14],86:[2,14],91:[2,14],93:[2,14],102:[2,14],104:[2,14],105:[2,14],106:[2,14],110:[2,14],118:[2,14],126:[2,14],128:[2,14],129:[2,14],132:[2,14],133:[2,14],134:[2,14],135:[2,14],136:[2,14],137:[2,14]},{1:[2,15],6:[2,15],25:[2,15],26:[2,15],49:[2,15],54:[2,15],57:[2,15],73:[2,15],78:[2,15],86:[2,15],91:[2,15],93:[2,15],102:[2,15],104:[2,15],105:[2,15],106:[2,15],110:[2,15],118:[2,15],126:[2,15],128:[2,15],129:[2,15],132:[2,15],133:[2,15],134:[2,15],135:[2,15],136:[2,15],137:[2,15]},{1:[2,16],6:[2,16],25:[2,16],26:[2,16],49:[2,16],54:[2,16],57:[2,16],73:[2,16],78:[2,16],86:[2,16],91:[2,16],93:[2,16],102:[2,16],104:[2,16],105:[2,16],106:[2,16],110:[2,16],118:[2,16],126:[2,16],128:[2,16],129:[2,16],132:[2,16],133:[2,16],134:[2,16],135:[2,16],136:[2,16],137:[2,16]},{1:[2,17],6:[2,17],25:[2,17],26:[2,17],49:[2,17],54:[2,17],57:[2,17],73:[2,17],78:[2,17],86:[2,17],91:[2,17],93:[2,17],102:[2,17],104:[2,17],105:[2,17],106:[2,17],110:[2,17],118:[2,17],126:[2,17],128:[2,17],129:[2,17],132:[2,17],133:[2,17],134:[2,17],135:[2,17],136:[2,17],137:[2,17]},{1:[2,18],6:[2,18],25:[2,18],26:[2,18],49:[2,18],54:[2,18],57:[2,18],73:[2,18],78:[2,18],86:[2,18],91:[2,18],93:[2,18],102:[2,18],104:[2,18],105:[2,18],106:[2,18],110:[2,18],118:[2,18],126:[2,18],128:[2,18],129:[2,18],132:[2,18],133:[2,18],134:[2,18],135:[2,18],136:[2,18],137:[2,18]},{1:[2,19],6:[2,19],25:[2,19],26:[2,19],49:[2,19],54:[2,19],57:[2,19],73:[2,19],78:[2,19],86:[2,19],91:[2,19],93:[2,19],102:[2,19],104:[2,19],105:[2,19],106:[2,19],110:[2,19],118:[2,19],126:[2,19],128:[2,19],129:[2,19],132:[2,19],133:[2,19],134:[2,19],135:[2,19],136:[2,19],137:[2,19]},{1:[2,20],6:[2,20],25:[2,20],26:[2,20],49:[2,20],54:[2,20],57:[2,20],73:[2,20],78:[2,20],86:[2,20],91:[2,20],93:[2,20],102:[2,20],104:[2,20],105:[2,20],106:[2,20],110:[2,20],118:[2,20],126:[2,20],128:[2,20],129:[2,20],132:[2,20],133:[2,20],134:[2,20],135:[2,20],136:[2,20],137:[2,20]},{1:[2,21],6:[2,21],25:[2,21],26:[2,21],49:[2,21],54:[2,21],57:[2,21],73:[2,21],78:[2,21],86:[2,21],91:[2,21],93:[2,21],102:[2,21],104:[2,21],105:[2,21],106:[2,21],110:[2,21],118:[2,21],126:[2,21],128:[2,21],129:[2,21],132:[2,21],133:[2,21],134:[2,21],135:[2,21],136:[2,21],137:[2,21]},{1:[2,22],6:[2,22],25:[2,22],26:[2,22],49:[2,22],54:[2,22],57:[2,22],73:[2,22],78:[2,22],86:[2,22],91:[2,22],93:[2,22],102:[2,22],104:[2,22],105:[2,22],106:[2,22],110:[2,22],118:[2,22],126:[2,22],128:[2,22],129:[2,22],132:[2,22],133:[2,22],134:[2,22],135:[2,22],136:[2,22],137:[2,22]},{1:[2,23],6:[2,23],25:[2,23],26:[2,23],49:[2,23],54:[2,23],57:[2,23],73:[2,23],78:[2,23],86:[2,23],91:[2,23],93:[2,23],102:[2,23],104:[2,23],105:[2,23],106:[2,23],110:[2,23],118:[2,23],126:[2,23],128:[2,23],129:[2,23],132:[2,23],133:[2,23],134:[2,23],135:[2,23],136:[2,23],137:[2,23]},{1:[2,9],6:[2,9],26:[2,9],102:[2,9],104:[2,9],106:[2,9],110:[2,9],126:[2,9]},{1:[2,10],6:[2,10],26:[2,10],102:[2,10],104:[2,10],106:[2,10],110:[2,10],126:[2,10]},{1:[2,11],6:[2,11],26:[2,11],102:[2,11],104:[2,11],106:[2,11],110:[2,11],126:[2,11]},{1:[2,75],6:[2,75],25:[2,75],26:[2,75],40:[1,104],49:[2,75],54:[2,75],57:[2,75],66:[2,75],67:[2,75],68:[2,75],69:[2,75],71:[2,75],73:[2,75],74:[2,75],78:[2,75],84:[2,75],85:[2,75],86:[2,75],91:[2,75],93:[2,75],102:[2,75],104:[2,75],105:[2,75],106:[2,75],110:[2,75],118:[2,75],126:[2,75],128:[2,75],129:[2,75],132:[2,75],133:[2,75],134:[2,75],135:[2,75],136:[2,75],137:[2,75]},{1:[2,76],6:[2,76],25:[2,76],26:[2,76],49:[2,76],54:[2,76],57:[2,76],66:[2,76],67:[2,76],68:[2,76],69:[2,76],71:[2,76],73:[2,76],74:[2,76],78:[2,76],84:[2,76],85:[2,76],86:[2,76],91:[2,76],93:[2,76],102:[2,76],104:[2,76],105:[2,76],106:[2,76],110:[2,76],118:[2,76],126:[2,76],128:[2,76],129:[2,76],132:[2,76],133:[2,76],134:[2,76],135:[2,76],136:[2,76],137:[2,76]},{1:[2,77],6:[2,77],25:[2,77],26:[2,77],49:[2,77],54:[2,77],57:[2,77],66:[2,77],67:[2,77],68:[2,77],69:[2,77],71:[2,77],73:[2,77],74:[2,77],78:[2,77],84:[2,77],85:[2,77],86:[2,77],91:[2,77],93:[2,77],102:[2,77],104:[2,77],105:[2,77],106:[2,77],110:[2,77],118:[2,77],126:[2,77],128:[2,77],129:[2,77],132:[2,77],133:[2,77],134:[2,77],135:[2,77],136:[2,77],137:[2,77]},{1:[2,78],6:[2,78],25:[2,78],26:[2,78],49:[2,78],54:[2,78],57:[2,78],66:[2,78],67:[2,78],68:[2,78],69:[2,78],71:[2,78],73:[2,78],74:[2,78],78:[2,78],84:[2,78],85:[2,78],86:[2,78],91:[2,78],93:[2,78],102:[2,78],104:[2,78],105:[2,78],106:[2,78],110:[2,78],118:[2,78],126:[2,78],128:[2,78],129:[2,78],132:[2,78],133:[2,78],134:[2,78],135:[2,78],136:[2,78],137:[2,78]},{1:[2,79],6:[2,79],25:[2,79],26:[2,79],49:[2,79],54:[2,79],57:[2,79],66:[2,79],67:[2,79],68:[2,79],69:[2,79],71:[2,79],73:[2,79],74:[2,79],78:[2,79],84:[2,79],85:[2,79],86:[2,79],91:[2,79],93:[2,79],102:[2,79],104:[2,79],105:[2,79],106:[2,79],110:[2,79],118:[2,79],126:[2,79],128:[2,79],129:[2,79],132:[2,79],133:[2,79],134:[2,79],135:[2,79],136:[2,79],137:[2,79]},{1:[2,106],6:[2,106],25:[2,106],26:[2,106],49:[2,106],54:[2,106],57:[2,106],66:[2,106],67:[2,106],68:[2,106],69:[2,106],71:[2,106],73:[2,106],74:[2,106],78:[2,106],82:105,84:[2,106],85:[1,106],86:[2,106],91:[2,106],93:[2,106],102:[2,106],104:[2,106],105:[2,106],106:[2,106],110:[2,106],118:[2,106],126:[2,106],128:[2,106],129:[2,106],132:[2,106],133:[2,106],134:[2,106],135:[2,106],136:[2,106],137:[2,106]},{6:[2,55],25:[2,55],27:110,28:[1,73],44:111,48:107,49:[2,55],54:[2,55],55:108,56:109,58:112,59:113,76:[1,70],89:[1,114],90:[1,115]},{5:116,25:[1,5]},{8:117,9:118,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,76:[1,70],79:[1,43],83:[1,28],88:[1,58],89:[1,59],90:[1,57],96:[1,38],100:[1,44],101:[1,56],103:39,104:[1,65],106:[1,66],107:40,108:[1,67],109:41,110:[1,68],111:69,119:[1,42],124:37,125:[1,64],127:[1,31],128:[1,32],129:[1,33],130:[1,34],131:[1,35]},{8:119,9:118,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,76:[1,70],79:[1,43],83:[1,28],88:[1,58],89:[1,59],90:[1,57],96:[1,38],100:[1,44],101:[1,56],103:39,104:[1,65],106:[1,66],107:40,108:[1,67],109:41,110:[1,68],111:69,119:[1,42],124:37,125:[1,64],127:[1,31],128:[1,32],129:[1,33],130:[1,34],131:[1,35]},{8:120,9:118,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,76:[1,70],79:[1,43],83:[1,28],88:[1,58],89:[1,59],90:[1,57],96:[1,38],100:[1,44],101:[1,56],103:39,104:[1,65],106:[1,66],107:40,108:[1,67],109:41,110:[1,68],111:69,119:[1,42],124:37,125:[1,64],127:[1,31],128:[1,32],129:[1,33],130:[1,34],131:[1,35]},{13:122,14:123,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:124,44:63,58:47,59:48,61:121,63:25,64:26,65:27,76:[1,70],83:[1,28],88:[1,58],89:[1,59],90:[1,57],101:[1,56]},{13:122,14:123,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:124,44:63,58:47,59:48,61:125,63:25,64:26,65:27,76:[1,70],83:[1,28],88:[1,58],89:[1,59],90:[1,57],101:[1,56]},{1:[2,72],6:[2,72],25:[2,72],26:[2,72],40:[2,72],49:[2,72],54:[2,72],57:[2,72],66:[2,72],67:[2,72],68:[2,72],69:[2,72],71:[2,72],73:[2,72],74:[2,72],78:[2,72],80:[1,129],84:[2,72],85:[2,72],86:[2,72],91:[2,72],93:[2,72],102:[2,72],104:[2,72],105:[2,72],106:[2,72],110:[2,72],118:[2,72],126:[2,72],128:[2,72],129:[2,72],130:[1,126],131:[1,127],132:[2,72],133:[2,72],134:[2,72],135:[2,72],136:[2,72],137:[2,72],138:[1,128]},{1:[2,183],6:[2,183],25:[2,183],26:[2,183],49:[2,183],54:[2,183],57:[2,183],73:[2,183],78:[2,183],86:[2,183],91:[2,183],93:[2,183],102:[2,183],104:[2,183],105:[2,183],106:[2,183],110:[2,183],118:[2,183],121:[1,130],126:[2,183],128:[2,183],129:[2,183],132:[2,183],133:[2,183],134:[2,183],135:[2,183],136:[2,183],137:[2,183]},{5:131,25:[1,5]},{5:132,25:[1,5]},{1:[2,150],6:[2,150],25:[2,150],26:[2,150],49:[2,150],54:[2,150],57:[2,150],73:[2,150],78:[2,150],86:[2,150],91:[2,150],93:[2,150],102:[2,150],104:[2,150],105:[2,150],106:[2,150],110:[2,150],118:[2,150],126:[2,150],128:[2,150],129:[2,150],132:[2,150],133:[2,150],134:[2,150],135:[2,150],136:[2,150],137:[2,150]},{5:133,25:[1,5]},{8:134,9:118,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,25:[1,135],27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,76:[1,70],79:[1,43],83:[1,28],88:[1,58],89:[1,59],90:[1,57],96:[1,38],100:[1,44],101:[1,56],103:39,104:[1,65],106:[1,66],107:40,108:[1,67],109:41,110:[1,68],111:69,119:[1,42],124:37,125:[1,64],127:[1,31],128:[1,32],129:[1,33],130:[1,34],131:[1,35]},{1:[2,96],5:136,6:[2,96],13:122,14:123,25:[1,5],26:[2,96],27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:124,44:63,49:[2,96],54:[2,96],57:[2,96],58:47,59:48,61:138,63:25,64:26,65:27,73:[2,96],76:[1,70],78:[2,96],80:[1,137],83:[1,28],86:[2,96],88:[1,58],89:[1,59],90:[1,57],91:[2,96],93:[2,96],101:[1,56],102:[2,96],104:[2,96],105:[2,96],106:[2,96],110:[2,96],118:[2,96],126:[2,96],128:[2,96],129:[2,96],132:[2,96],133:[2,96],134:[2,96],135:[2,96],136:[2,96],137:[2,96]},{8:139,9:118,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,76:[1,70],79:[1,43],83:[1,28],88:[1,58],89:[1,59],90:[1,57],96:[1,38],100:[1,44],101:[1,56],103:39,104:[1,65],106:[1,66],107:40,108:[1,67],109:41,110:[1,68],111:69,119:[1,42],124:37,125:[1,64],127:[1,31],128:[1,32],129:[1,33],130:[1,34],131:[1,35]},{1:[2,47],6:[2,47],8:140,9:118,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,26:[2,47],27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,76:[1,70],79:[1,43],83:[1,28],88:[1,58],89:[1,59],90:[1,57],96:[1,38],100:[1,44],101:[1,56],102:[2,47],103:39,104:[2,47],106:[2,47],107:40,108:[1,67],109:41,110:[2,47],111:69,119:[1,42],124:37,125:[1,64],126:[2,47],127:[1,31],128:[1,32],129:[1,33],130:[1,34],131:[1,35]},{1:[2,48],6:[2,48],25:[2,48],26:[2,48],54:[2,48],78:[2,48],102:[2,48],104:[2,48],106:[2,48],110:[2,48],126:[2,48]},{1:[2,73],6:[2,73],25:[2,73],26:[2,73],40:[2,73],49:[2,73],54:[2,73],57:[2,73],66:[2,73],67:[2,73],68:[2,73],69:[2,73],71:[2,73],73:[2,73],74:[2,73],78:[2,73],84:[2,73],85:[2,73],86:[2,73],91:[2,73],93:[2,73],102:[2,73],104:[2,73],105:[2,73],106:[2,73],110:[2,73],118:[2,73],126:[2,73],128:[2,73],129:[2,73],132:[2,73],133:[2,73],134:[2,73],135:[2,73],136:[2,73],137:[2,73]},{1:[2,74],6:[2,74],25:[2,74],26:[2,74],40:[2,74],49:[2,74],54:[2,74],57:[2,74],66:[2,74],67:[2,74],68:[2,74],69:[2,74],71:[2,74],73:[2,74],74:[2,74],78:[2,74],84:[2,74],85:[2,74],86:[2,74],91:[2,74],93:[2,74],102:[2,74],104:[2,74],105:[2,74],106:[2,74],110:[2,74],118:[2,74],126:[2,74],128:[2,74],129:[2,74],132:[2,74],133:[2,74],134:[2,74],135:[2,74],136:[2,74],137:[2,74]},{1:[2,29],6:[2,29],25:[2,29],26:[2,29],49:[2,29],54:[2,29],57:[2,29],66:[2,29],67:[2,29],68:[2,29],69:[2,29],71:[2,29],73:[2,29],74:[2,29],78:[2,29],84:[2,29],85:[2,29],86:[2,29],91:[2,29],93:[2,29],102:[2,29],104:[2,29],105:[2,29],106:[2,29],110:[2,29],118:[2,29],126:[2,29],128:[2,29],129:[2,29],132:[2,29],133:[2,29],134:[2,29],135:[2,29],136:[2,29],137:[2,29]},{1:[2,30],6:[2,30],25:[2,30],26:[2,30],49:[2,30],54:[2,30],57:[2,30],66:[2,30],67:[2,30],68:[2,30],69:[2,30],71:[2,30],73:[2,30],74:[2,30],78:[2,30],84:[2,30],85:[2,30],86:[2,30],91:[2,30],93:[2,30],102:[2,30],104:[2,30],105:[2,30],106:[2,30],110:[2,30],118:[2,30],126:[2,30],128:[2,30],129:[2,30],132:[2,30],133:[2,30],134:[2,30],135:[2,30],136:[2,30],137:[2,30]},{1:[2,31],6:[2,31],25:[2,31],26:[2,31],49:[2,31],54:[2,31],57:[2,31],66:[2,31],67:[2,31],68:[2,31],69:[2,31],71:[2,31],73:[2,31],74:[2,31],78:[2,31],84:[2,31],85:[2,31],86:[2,31],91:[2,31],93:[2,31],102:[2,31],104:[2,31],105:[2,31],106:[2,31],110:[2,31],118:[2,31],126:[2,31],128:[2,31],129:[2,31],132:[2,31],133:[2,31],134:[2,31],135:[2,31],136:[2,31],137:[2,31]},{1:[2,32],6:[2,32],25:[2,32],26:[2,32],49:[2,32],54:[2,32],57:[2,32],66:[2,32],67:[2,32],68:[2,32],69:[2,32],71:[2,32],73:[2,32],74:[2,32],78:[2,32],84:[2,32],85:[2,32],86:[2,32],91:[2,32],93:[2,32],102:[2,32],104:[2,32],105:[2,32],106:[2,32],110:[2,32],118:[2,32],126:[2,32],128:[2,32],129:[2,32],132:[2,32],133:[2,32],134:[2,32],135:[2,32],136:[2,32],137:[2,32]},{1:[2,33],6:[2,33],25:[2,33],26:[2,33],49:[2,33],54:[2,33],57:[2,33],66:[2,33],67:[2,33],68:[2,33],69:[2,33],71:[2,33],73:[2,33],74:[2,33],78:[2,33],84:[2,33],85:[2,33],86:[2,33],91:[2,33],93:[2,33],102:[2,33],104:[2,33],105:[2,33],106:[2,33],110:[2,33],118:[2,33],126:[2,33],128:[2,33],129:[2,33],132:[2,33],133:[2,33],134:[2,33],135:[2,33],136:[2,33],137:[2,33]},{1:[2,34],6:[2,34],25:[2,34],26:[2,34],49:[2,34],54:[2,34],57:[2,34],66:[2,34],67:[2,34],68:[2,34],69:[2,34],71:[2,34],73:[2,34],74:[2,34],78:[2,34],84:[2,34],85:[2,34],86:[2,34],91:[2,34],93:[2,34],102:[2,34],104:[2,34],105:[2,34],106:[2,34],110:[2,34],118:[2,34],126:[2,34],128:[2,34],129:[2,34],132:[2,34],133:[2,34],134:[2,34],135:[2,34],136:[2,34],137:[2,34]},{1:[2,35],6:[2,35],25:[2,35],26:[2,35],49:[2,35],54:[2,35],57:[2,35],66:[2,35],67:[2,35],68:[2,35],69:[2,35],71:[2,35],73:[2,35],74:[2,35],78:[2,35],84:[2,35],85:[2,35],86:[2,35],91:[2,35],93:[2,35],102:[2,35],104:[2,35],105:[2,35],106:[2,35],110:[2,35],118:[2,35],126:[2,35],128:[2,35],129:[2,35],132:[2,35],133:[2,35],134:[2,35],135:[2,35],136:[2,35],137:[2,35]},{4:141,7:4,8:6,9:7,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,25:[1,142],27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,76:[1,70],79:[1,43],83:[1,28],88:[1,58],89:[1,59],90:[1,57],96:[1,38],100:[1,44],101:[1,56],103:39,104:[1,65],106:[1,66],107:40,108:[1,67],109:41,110:[1,68],111:69,119:[1,42],124:37,125:[1,64],127:[1,31],128:[1,32],129:[1,33],130:[1,34],131:[1,35]},{8:143,9:118,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,25:[1,147],27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,60:148,61:36,63:25,64:26,65:27,76:[1,70],79:[1,43],83:[1,28],87:145,88:[1,58],89:[1,59],90:[1,57],91:[1,144],94:146,96:[1,38],100:[1,44],101:[1,56],103:39,104:[1,65],106:[1,66],107:40,108:[1,67],109:41,110:[1,68],111:69,119:[1,42],124:37,125:[1,64],127:[1,31],128:[1,32],129:[1,33],130:[1,34],131:[1,35]},{1:[2,112],6:[2,112],25:[2,112],26:[2,112],49:[2,112],54:[2,112],57:[2,112],66:[2,112],67:[2,112],68:[2,112],69:[2,112],71:[2,112],73:[2,112],74:[2,112],78:[2,112],84:[2,112],85:[2,112],86:[2,112],91:[2,112],93:[2,112],102:[2,112],104:[2,112],105:[2,112],106:[2,112],110:[2,112],118:[2,112],126:[2,112],128:[2,112],129:[2,112],132:[2,112],133:[2,112],134:[2,112],135:[2,112],136:[2,112],137:[2,112]},{1:[2,113],6:[2,113],25:[2,113],26:[2,113],27:149,28:[1,73],49:[2,113],54:[2,113],57:[2,113],66:[2,113],67:[2,113],68:[2,113],69:[2,113],71:[2,113],73:[2,113],74:[2,113],78:[2,113],84:[2,113],85:[2,113],86:[2,113],91:[2,113],93:[2,113],102:[2,113],104:[2,113],105:[2,113],106:[2,113],110:[2,113],118:[2,113],126:[2,113],128:[2,113],129:[2,113],132:[2,113],133:[2,113],134:[2,113],135:[2,113],136:[2,113],137:[2,113]},{25:[2,51]},{25:[2,52]},{1:[2,68],6:[2,68],25:[2,68],26:[2,68],40:[2,68],49:[2,68],54:[2,68],57:[2,68],66:[2,68],67:[2,68],68:[2,68],69:[2,68],71:[2,68],73:[2,68],74:[2,68],78:[2,68],80:[2,68],84:[2,68],85:[2,68],86:[2,68],91:[2,68],93:[2,68],102:[2,68],104:[2,68],105:[2,68],106:[2,68],110:[2,68],118:[2,68],126:[2,68],128:[2,68],129:[2,68],130:[2,68],131:[2,68],132:[2,68],133:[2,68],134:[2,68],135:[2,68],136:[2,68],137:[2,68],138:[2,68]},{1:[2,71],6:[2,71],25:[2,71],26:[2,71],40:[2,71],49:[2,71],54:[2,71],57:[2,71],66:[2,71],67:[2,71],68:[2,71],69:[2,71],71:[2,71],73:[2,71],74:[2,71],78:[2,71],80:[2,71],84:[2,71],85:[2,71],86:[2,71],91:[2,71],93:[2,71],102:[2,71],104:[2,71],105:[2,71],106:[2,71],110:[2,71],118:[2,71],126:[2,71],128:[2,71],129:[2,71],130:[2,71],131:[2,71],132:[2,71],133:[2,71],134:[2,71],135:[2,71],136:[2,71],137:[2,71],138:[2,71]},{8:150,9:118,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,76:[1,70],79:[1,43],83:[1,28],88:[1,58],89:[1,59],90:[1,57],96:[1,38],100:[1,44],101:[1,56],103:39,104:[1,65],106:[1,66],107:40,108:[1,67],109:41,110:[1,68],111:69,119:[1,42],124:37,125:[1,64],127:[1,31],128:[1,32],129:[1,33],130:[1,34],131:[1,35]},{8:151,9:118,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,76:[1,70],79:[1,43],83:[1,28],88:[1,58],89:[1,59],90:[1,57],96:[1,38],100:[1,44],101:[1,56],103:39,104:[1,65],106:[1,66],107:40,108:[1,67],109:41,110:[1,68],111:69,119:[1,42],124:37,125:[1,64],127:[1,31],128:[1,32],129:[1,33],130:[1,34],131:[1,35]},{8:152,9:118,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,76:[1,70],79:[1,43],83:[1,28],88:[1,58],89:[1,59],90:[1,57],96:[1,38],100:[1,44],101:[1,56],103:39,104:[1,65],106:[1,66],107:40,108:[1,67],109:41,110:[1,68],111:69,119:[1,42],124:37,125:[1,64],127:[1,31],128:[1,32],129:[1,33],130:[1,34],131:[1,35]},{5:153,8:154,9:118,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,25:[1,5],27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,76:[1,70],79:[1,43],83:[1,28],88:[1,58],89:[1,59],90:[1,57],96:[1,38],100:[1,44],101:[1,56],103:39,104:[1,65],106:[1,66],107:40,108:[1,67],109:41,110:[1,68],111:69,119:[1,42],124:37,125:[1,64],127:[1,31],128:[1,32],129:[1,33],130:[1,34],131:[1,35]},{27:159,28:[1,73],44:160,58:161,59:162,64:155,76:[1,70],89:[1,114],90:[1,57],113:156,114:[1,157],115:158},{112:163,116:[1,164],117:[1,165]},{6:[2,91],11:169,25:[2,91],27:170,28:[1,73],29:171,30:[1,71],31:[1,72],41:167,42:168,44:172,46:[1,46],54:[2,91],77:166,78:[2,91],89:[1,114]},{1:[2,27],6:[2,27],25:[2,27],26:[2,27],43:[2,27],49:[2,27],54:[2,27],57:[2,27],66:[2,27],67:[2,27],68:[2,27],69:[2,27],71:[2,27],73:[2,27],74:[2,27],78:[2,27],84:[2,27],85:[2,27],86:[2,27],91:[2,27],93:[2,27],102:[2,27],104:[2,27],105:[2,27],106:[2,27],110:[2,27],118:[2,27],126:[2,27],128:[2,27],129:[2,27],132:[2,27],133:[2,27],134:[2,27],135:[2,27],136:[2,27],137:[2,27]},{1:[2,28],6:[2,28],25:[2,28],26:[2,28],43:[2,28],49:[2,28],54:[2,28],57:[2,28],66:[2,28],67:[2,28],68:[2,28],69:[2,28],71:[2,28],73:[2,28],74:[2,28],78:[2,28],84:[2,28],85:[2,28],86:[2,28],91:[2,28],93:[2,28],102:[2,28],104:[2,28],105:[2,28],106:[2,28],110:[2,28],118:[2,28],126:[2,28],128:[2,28],129:[2,28],132:[2,28],133:[2,28],134:[2,28],135:[2,28],136:[2,28],137:[2,28]},{1:[2,26],6:[2,26],25:[2,26],26:[2,26],40:[2,26],43:[2,26],49:[2,26],54:[2,26],57:[2,26],66:[2,26],67:[2,26],68:[2,26],69:[2,26],71:[2,26],73:[2,26],74:[2,26],78:[2,26],80:[2,26],84:[2,26],85:[2,26],86:[2,26],91:[2,26],93:[2,26],102:[2,26],104:[2,26],105:[2,26],106:[2,26],110:[2,26],116:[2,26],117:[2,26],118:[2,26],126:[2,26],128:[2,26],129:[2,26],130:[2,26],131:[2,26],132:[2,26],133:[2,26],134:[2,26],135:[2,26],136:[2,26],137:[2,26],138:[2,26]},{1:[2,6],6:[2,6],7:173,8:6,9:7,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,26:[2,6],27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,76:[1,70],79:[1,43],83:[1,28],88:[1,58],89:[1,59],90:[1,57],96:[1,38],100:[1,44],101:[1,56],102:[2,6],103:39,104:[1,65],106:[1,66],107:40,108:[1,67],109:41,110:[1,68],111:69,119:[1,42],124:37,125:[1,64],127:[1,31],128:[1,32],129:[1,33],130:[1,34],131:[1,35]},{1:[2,3]},{1:[2,24],6:[2,24],25:[2,24],26:[2,24],49:[2,24],54:[2,24],57:[2,24],73:[2,24],78:[2,24],86:[2,24],91:[2,24],93:[2,24],98:[2,24],99:[2,24],102:[2,24],104:[2,24],105:[2,24],106:[2,24],110:[2,24],118:[2,24],121:[2,24],123:[2,24],126:[2,24],128:[2,24],129:[2,24],132:[2,24],133:[2,24],134:[2,24],135:[2,24],136:[2,24],137:[2,24]},{6:[1,74],26:[1,174]},{1:[2,194],6:[2,194],25:[2,194],26:[2,194],49:[2,194],54:[2,194],57:[2,194],73:[2,194],78:[2,194],86:[2,194],91:[2,194],93:[2,194],102:[2,194],104:[2,194],105:[2,194],106:[2,194],110:[2,194],118:[2,194],126:[2,194],128:[2,194],129:[2,194],132:[2,194],133:[2,194],134:[2,194],135:[2,194],136:[2,194],137:[2,194]},{8:175,9:118,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,76:[1,70],79:[1,43],83:[1,28],88:[1,58],89:[1,59],90:[1,57],96:[1,38],100:[1,44],101:[1,56],103:39,104:[1,65],106:[1,66],107:40,108:[1,67],109:41,110:[1,68],111:69,119:[1,42],124:37,125:[1,64],127:[1,31],128:[1,32],129:[1,33],130:[1,34],131:[1,35]},{8:176,9:118,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,76:[1,70],79:[1,43],83:[1,28],88:[1,58],89:[1,59],90:[1,57],96:[1,38],100:[1,44],101:[1,56],103:39,104:[1,65],106:[1,66],107:40,108:[1,67],109:41,110:[1,68],111:69,119:[1,42],124:37,125:[1,64],127:[1,31],128:[1,32],129:[1,33],130:[1,34],131:[1,35]},{8:177,9:118,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,76:[1,70],79:[1,43],83:[1,28],88:[1,58],89:[1,59],90:[1,57],96:[1,38],100:[1,44],101:[1,56],103:39,104:[1,65],106:[1,66],107:40,108:[1,67],109:41,110:[1,68],111:69,119:[1,42],124:37,125:[1,64],127:[1,31],128:[1,32],129:[1,33],130:[1,34],131:[1,35]},{8:178,9:118,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,76:[1,70],79:[1,43],83:[1,28],88:[1,58],89:[1,59],90:[1,57],96:[1,38],100:[1,44],101:[1,56],103:39,104:[1,65],106:[1,66],107:40,108:[1,67],109:41,110:[1,68],111:69,119:[1,42],124:37,125:[1,64],127:[1,31],128:[1,32],129:[1,33],130:[1,34],131:[1,35]},{8:179,9:118,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,76:[1,70],79:[1,43],83:[1,28],88:[1,58],89:[1,59],90:[1,57],96:[1,38],100:[1,44],101:[1,56],103:39,104:[1,65],106:[1,66],107:40,108:[1,67],109:41,110:[1,68],111:69,119:[1,42],124:37,125:[1,64],127:[1,31],128:[1,32],129:[1,33],130:[1,34],131:[1,35]},{8:180,9:118,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,76:[1,70],79:[1,43],83:[1,28],88:[1,58],89:[1,59],90:[1,57],96:[1,38],100:[1,44],101:[1,56],103:39,104:[1,65],106:[1,66],107:40,108:[1,67],109:41,110:[1,68],111:69,119:[1,42],124:37,125:[1,64],127:[1,31],128:[1,32],129:[1,33],130:[1,34],131:[1,35]},{8:181,9:118,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,76:[1,70],79:[1,43],83:[1,28],88:[1,58],89:[1,59],90:[1,57],96:[1,38],100:[1,44],101:[1,56],103:39,104:[1,65],106:[1,66],107:40,108:[1,67],109:41,110:[1,68],111:69,119:[1,42],124:37,125:[1,64],127:[1,31],128:[1,32],129:[1,33],130:[1,34],131:[1,35]},{8:182,9:118,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,76:[1,70],79:[1,43],83:[1,28],88:[1,58],89:[1,59],90:[1,57],96:[1,38],100:[1,44],101:[1,56],103:39,104:[1,65],106:[1,66],107:40,108:[1,67],109:41,110:[1,68],111:69,119:[1,42],124:37,125:[1,64],127:[1,31],128:[1,32],129:[1,33],130:[1,34],131:[1,35]},{1:[2,149],6:[2,149],25:[2,149],26:[2,149],49:[2,149],54:[2,149],57:[2,149],73:[2,149],78:[2,149],86:[2,149],91:[2,149],93:[2,149],102:[2,149],104:[2,149],105:[2,149],106:[2,149],110:[2,149],118:[2,149],126:[2,149],128:[2,149],129:[2,149],132:[2,149],133:[2,149],134:[2,149],135:[2,149],136:[2,149],137:[2,149]},{1:[2,154],6:[2,154],25:[2,154],26:[2,154],49:[2,154],54:[2,154],57:[2,154],73:[2,154],78:[2,154],86:[2,154],91:[2,154],93:[2,154],102:[2,154],104:[2,154],105:[2,154],106:[2,154],110:[2,154],118:[2,154],126:[2,154],128:[2,154],129:[2,154],132:[2,154],133:[2,154],134:[2,154],135:[2,154],136:[2,154],137:[2,154]},{8:183,9:118,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,76:[1,70],79:[1,43],83:[1,28],88:[1,58],89:[1,59],90:[1,57],96:[1,38],100:[1,44],101:[1,56],103:39,104:[1,65],106:[1,66],107:40,108:[1,67],109:41,110:[1,68],111:69,119:[1,42],124:37,125:[1,64],127:[1,31],128:[1,32],129:[1,33],130:[1,34],131:[1,35]},{1:[2,148],6:[2,148],25:[2,148],26:[2,148],49:[2,148],54:[2,148],57:[2,148],73:[2,148],78:[2,148],86:[2,148],91:[2,148],93:[2,148],102:[2,148],104:[2,148],105:[2,148],106:[2,148],110:[2,148],118:[2,148],126:[2,148],128:[2,148],129:[2,148],132:[2,148],133:[2,148],134:[2,148],135:[2,148],136:[2,148],137:[2,148]},{1:[2,153],6:[2,153],25:[2,153],26:[2,153],49:[2,153],54:[2,153],57:[2,153],73:[2,153],78:[2,153],86:[2,153],91:[2,153],93:[2,153],102:[2,153],104:[2,153],105:[2,153],106:[2,153],110:[2,153],118:[2,153],126:[2,153],128:[2,153],129:[2,153],132:[2,153],133:[2,153],134:[2,153],135:[2,153],136:[2,153],137:[2,153]},{82:184,85:[1,106]},{1:[2,69],6:[2,69],25:[2,69],26:[2,69],40:[2,69],49:[2,69],54:[2,69],57:[2,69],66:[2,69],67:[2,69],68:[2,69],69:[2,69],71:[2,69],73:[2,69],74:[2,69],78:[2,69],80:[2,69],84:[2,69],85:[2,69],86:[2,69],91:[2,69],93:[2,69],102:[2,69],104:[2,69],105:[2,69],106:[2,69],110:[2,69],118:[2,69],126:[2,69],128:[2,69],129:[2,69],130:[2,69],131:[2,69],132:[2,69],133:[2,69],134:[2,69],135:[2,69],136:[2,69],137:[2,69],138:[2,69]},{85:[2,109]},{27:185,28:[1,73]},{27:186,28:[1,73]},{1:[2,84],6:[2,84],25:[2,84],26:[2,84],27:187,28:[1,73],40:[2,84],49:[2,84],54:[2,84],57:[2,84],66:[2,84],67:[2,84],68:[2,84],69:[2,84],71:[2,84],73:[2,84],74:[2,84],78:[2,84],80:[2,84],84:[2,84],85:[2,84],86:[2,84],91:[2,84],93:[2,84],102:[2,84],104:[2,84],105:[2,84],106:[2,84],110:[2,84],118:[2,84],126:[2,84],128:[2,84],129:[2,84],130:[2,84],131:[2,84],132:[2,84],133:[2,84],134:[2,84],135:[2,84],136:[2,84],137:[2,84],138:[2,84]},{27:188,28:[1,73]},{1:[2,85],6:[2,85],25:[2,85],26:[2,85],40:[2,85],49:[2,85],54:[2,85],57:[2,85],66:[2,85],67:[2,85],68:[2,85],69:[2,85],71:[2,85],73:[2,85],74:[2,85],78:[2,85],80:[2,85],84:[2,85],85:[2,85],86:[2,85],91:[2,85],93:[2,85],102:[2,85],104:[2,85],105:[2,85],106:[2,85],110:[2,85],118:[2,85],126:[2,85],128:[2,85],129:[2,85],130:[2,85],131:[2,85],132:[2,85],133:[2,85],134:[2,85],135:[2,85],136:[2,85],137:[2,85],138:[2,85]},{8:190,9:118,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],57:[1,194],58:47,59:48,61:36,63:25,64:26,65:27,72:189,75:191,76:[1,70],79:[1,43],83:[1,28],88:[1,58],89:[1,59],90:[1,57],92:192,93:[1,193],96:[1,38],100:[1,44],101:[1,56],103:39,104:[1,65],106:[1,66],107:40,108:[1,67],109:41,110:[1,68],111:69,119:[1,42],124:37,125:[1,64],127:[1,31],128:[1,32],129:[1,33],130:[1,34],131:[1,35]},{70:195,71:[1,100],74:[1,101]},{82:196,85:[1,106]},{1:[2,70],6:[2,70],25:[2,70],26:[2,70],40:[2,70],49:[2,70],54:[2,70],57:[2,70],66:[2,70],67:[2,70],68:[2,70],69:[2,70],71:[2,70],73:[2,70],74:[2,70],78:[2,70],80:[2,70],84:[2,70],85:[2,70],86:[2,70],91:[2,70],93:[2,70],102:[2,70],104:[2,70],105:[2,70],106:[2,70],110:[2,70],118:[2,70],126:[2,70],128:[2,70],129:[2,70],130:[2,70],131:[2,70],132:[2,70],133:[2,70],134:[2,70],135:[2,70],136:[2,70],137:[2,70],138:[2,70]},{6:[1,198],8:197,9:118,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,25:[1,199],27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,76:[1,70],79:[1,43],83:[1,28],88:[1,58],89:[1,59],90:[1,57],96:[1,38],100:[1,44],101:[1,56],103:39,104:[1,65],106:[1,66],107:40,108:[1,67],109:41,110:[1,68],111:69,119:[1,42],124:37,125:[1,64],127:[1,31],128:[1,32],129:[1,33],130:[1,34],131:[1,35]},{1:[2,107],6:[2,107],25:[2,107],26:[2,107],49:[2,107],54:[2,107],57:[2,107],66:[2,107],67:[2,107],68:[2,107],69:[2,107],71:[2,107],73:[2,107],74:[2,107],78:[2,107],84:[2,107],85:[2,107],86:[2,107],91:[2,107],93:[2,107],102:[2,107],104:[2,107],105:[2,107],106:[2,107],110:[2,107],118:[2,107],126:[2,107],128:[2,107],129:[2,107],132:[2,107],133:[2,107],134:[2,107],135:[2,107],136:[2,107],137:[2,107]},{8:202,9:118,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,25:[1,147],27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,60:148,61:36,63:25,64:26,65:27,76:[1,70],79:[1,43],83:[1,28],86:[1,200],87:201,88:[1,58],89:[1,59],90:[1,57],94:146,96:[1,38],100:[1,44],101:[1,56],103:39,104:[1,65],106:[1,66],107:40,108:[1,67],109:41,110:[1,68],111:69,119:[1,42],124:37,125:[1,64],127:[1,31],128:[1,32],129:[1,33],130:[1,34],131:[1,35]},{6:[2,53],25:[2,53],49:[1,203],53:205,54:[1,204]},{6:[2,56],25:[2,56],26:[2,56],49:[2,56],54:[2,56]},{6:[2,60],25:[2,60],26:[2,60],40:[1,207],49:[2,60],54:[2,60],57:[1,206]},{6:[2,63],25:[2,63],26:[2,63],40:[2,63],49:[2,63],54:[2,63],57:[2,63]},{6:[2,64],25:[2,64],26:[2,64],40:[2,64],49:[2,64],54:[2,64],57:[2,64]},{6:[2,65],25:[2,65],26:[2,65],40:[2,65],49:[2,65],54:[2,65],57:[2,65]},{6:[2,66],25:[2,66],26:[2,66],40:[2,66],49:[2,66],54:[2,66],57:[2,66]},{27:149,28:[1,73]},{8:202,9:118,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,25:[1,147],27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,60:148,61:36,63:25,64:26,65:27,76:[1,70],79:[1,43],83:[1,28],87:145,88:[1,58],89:[1,59],90:[1,57],91:[1,144],94:146,96:[1,38],100:[1,44],101:[1,56],103:39,104:[1,65],106:[1,66],107:40,108:[1,67],109:41,110:[1,68],111:69,119:[1,42],124:37,125:[1,64],127:[1,31],128:[1,32],129:[1,33],130:[1,34],131:[1,35]},{1:[2,50],6:[2,50],25:[2,50],26:[2,50],49:[2,50],54:[2,50],57:[2,50],73:[2,50],78:[2,50],86:[2,50],91:[2,50],93:[2,50],102:[2,50],104:[2,50],105:[2,50],106:[2,50],110:[2,50],118:[2,50],126:[2,50],128:[2,50],129:[2,50],132:[2,50],133:[2,50],134:[2,50],135:[2,50],136:[2,50],137:[2,50]},{1:[2,187],6:[2,187],25:[2,187],26:[2,187],49:[2,187],54:[2,187],57:[2,187],73:[2,187],78:[2,187],86:[2,187],91:[2,187],93:[2,187],102:[2,187],103:87,104:[2,187],105:[2,187],106:[2,187],109:88,110:[2,187],111:69,118:[2,187],126:[2,187],128:[2,187],129:[2,187],132:[1,78],133:[2,187],134:[2,187],135:[2,187],136:[2,187],137:[2,187]},{103:90,104:[1,65],106:[1,66],109:91,110:[1,68],111:69,126:[1,89]},{1:[2,188],6:[2,188],25:[2,188],26:[2,188],49:[2,188],54:[2,188],57:[2,188],73:[2,188],78:[2,188],86:[2,188],91:[2,188],93:[2,188],102:[2,188],103:87,104:[2,188],105:[2,188],106:[2,188],109:88,110:[2,188],111:69,118:[2,188],126:[2,188],128:[2,188],129:[2,188],132:[1,78],133:[2,188],134:[2,188],135:[2,188],136:[2,188],137:[2,188]},{1:[2,189],6:[2,189],25:[2,189],26:[2,189],49:[2,189],54:[2,189],57:[2,189],73:[2,189],78:[2,189],86:[2,189],91:[2,189],93:[2,189],102:[2,189],103:87,104:[2,189],105:[2,189],106:[2,189],109:88,110:[2,189],111:69,118:[2,189],126:[2,189],128:[2,189],129:[2,189],132:[1,78],133:[2,189],134:[2,189],135:[2,189],136:[2,189],137:[2,189]},{1:[2,190],6:[2,190],25:[2,190],26:[2,190],49:[2,190],54:[2,190],57:[2,190],66:[2,72],67:[2,72],68:[2,72],69:[2,72],71:[2,72],73:[2,190],74:[2,72],78:[2,190],84:[2,72],85:[2,72],86:[2,190],91:[2,190],93:[2,190],102:[2,190],104:[2,190],105:[2,190],106:[2,190],110:[2,190],118:[2,190],126:[2,190],128:[2,190],129:[2,190],132:[2,190],133:[2,190],134:[2,190],135:[2,190],136:[2,190],137:[2,190]},{62:93,66:[1,95],67:[1,96],68:[1,97],69:[1,98],70:99,71:[1,100],74:[1,101],81:92,84:[1,94],85:[2,108]},{62:103,66:[1,95],67:[1,96],68:[1,97],69:[1,98],70:99,71:[1,100],74:[1,101],81:102,84:[1,94],85:[2,108]},{66:[2,75],67:[2,75],68:[2,75],69:[2,75],71:[2,75],74:[2,75],84:[2,75],85:[2,75]},{1:[2,191],6:[2,191],25:[2,191],26:[2,191],49:[2,191],54:[2,191],57:[2,191],66:[2,72],67:[2,72],68:[2,72],69:[2,72],71:[2,72],73:[2,191],74:[2,72],78:[2,191],84:[2,72],85:[2,72],86:[2,191],91:[2,191],93:[2,191],102:[2,191],104:[2,191],105:[2,191],106:[2,191],110:[2,191],118:[2,191],126:[2,191],128:[2,191],129:[2,191],132:[2,191],133:[2,191],134:[2,191],135:[2,191],136:[2,191],137:[2,191]},{1:[2,192],6:[2,192],25:[2,192],26:[2,192],49:[2,192],54:[2,192],57:[2,192],73:[2,192],78:[2,192],86:[2,192],91:[2,192],93:[2,192],102:[2,192],104:[2,192],105:[2,192],106:[2,192],110:[2,192],118:[2,192],126:[2,192],128:[2,192],129:[2,192],132:[2,192],133:[2,192],134:[2,192],135:[2,192],136:[2,192],137:[2,192]},{1:[2,193],6:[2,193],25:[2,193],26:[2,193],49:[2,193],54:[2,193],57:[2,193],73:[2,193],78:[2,193],86:[2,193],91:[2,193],93:[2,193],102:[2,193],104:[2,193],105:[2,193],106:[2,193],110:[2,193],118:[2,193],126:[2,193],128:[2,193],129:[2,193],132:[2,193],133:[2,193],134:[2,193],135:[2,193],136:[2,193],137:[2,193]},{6:[1,210],8:208,9:118,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,25:[1,209],27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,76:[1,70],79:[1,43],83:[1,28],88:[1,58],89:[1,59],90:[1,57],96:[1,38],100:[1,44],101:[1,56],103:39,104:[1,65],106:[1,66],107:40,108:[1,67],109:41,110:[1,68],111:69,119:[1,42],124:37,125:[1,64],127:[1,31],128:[1,32],129:[1,33],130:[1,34],131:[1,35]},{8:211,9:118,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,76:[1,70],79:[1,43],83:[1,28],88:[1,58],89:[1,59],90:[1,57],96:[1,38],100:[1,44],101:[1,56],103:39,104:[1,65],106:[1,66],107:40,108:[1,67],109:41,110:[1,68],111:69,119:[1,42],124:37,125:[1,64],127:[1,31],128:[1,32],129:[1,33],130:[1,34],131:[1,35]},{5:212,25:[1,5],125:[1,213]},{1:[2,133],6:[2,133],25:[2,133],26:[2,133],49:[2,133],54:[2,133],57:[2,133],73:[2,133],78:[2,133],86:[2,133],91:[2,133],93:[2,133],97:214,98:[1,215],99:[1,216],102:[2,133],104:[2,133],105:[2,133],106:[2,133],110:[2,133],118:[2,133],126:[2,133],128:[2,133],129:[2,133],132:[2,133],133:[2,133],134:[2,133],135:[2,133],136:[2,133],137:[2,133]},{1:[2,147],6:[2,147],25:[2,147],26:[2,147],49:[2,147],54:[2,147],57:[2,147],73:[2,147],78:[2,147],86:[2,147],91:[2,147],93:[2,147],102:[2,147],104:[2,147],105:[2,147],106:[2,147],110:[2,147],118:[2,147],126:[2,147],128:[2,147],129:[2,147],132:[2,147],133:[2,147],134:[2,147],135:[2,147],136:[2,147],137:[2,147]},{1:[2,155],6:[2,155],25:[2,155],26:[2,155],49:[2,155],54:[2,155],57:[2,155],73:[2,155],78:[2,155],86:[2,155],91:[2,155],93:[2,155],102:[2,155],104:[2,155],105:[2,155],106:[2,155],110:[2,155],118:[2,155],126:[2,155],128:[2,155],129:[2,155],132:[2,155],133:[2,155],134:[2,155],135:[2,155],136:[2,155],137:[2,155]},{25:[1,217],103:87,104:[1,65],106:[1,66],109:88,110:[1,68],111:69,126:[1,86],128:[1,80],129:[1,79],132:[1,78],133:[1,81],134:[1,82],135:[1,83],136:[1,84],137:[1,85]},{120:218,122:219,123:[1,220]},{1:[2,97],6:[2,97],25:[2,97],26:[2,97],49:[2,97],54:[2,97],57:[2,97],73:[2,97],78:[2,97],86:[2,97],91:[2,97],93:[2,97],102:[2,97],104:[2,97],105:[2,97],106:[2,97],110:[2,97],118:[2,97],126:[2,97],128:[2,97],129:[2,97],132:[2,97],133:[2,97],134:[2,97],135:[2,97],136:[2,97],137:[2,97]},{8:221,9:118,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,76:[1,70],79:[1,43],83:[1,28],88:[1,58],89:[1,59],90:[1,57],96:[1,38],100:[1,44],101:[1,56],103:39,104:[1,65],106:[1,66],107:40,108:[1,67],109:41,110:[1,68],111:69,119:[1,42],124:37,125:[1,64],127:[1,31],128:[1,32],129:[1,33],130:[1,34],131:[1,35]},{1:[2,100],5:222,6:[2,100],25:[1,5],26:[2,100],49:[2,100],54:[2,100],57:[2,100],66:[2,72],67:[2,72],68:[2,72],69:[2,72],71:[2,72],73:[2,100],74:[2,72],78:[2,100],80:[1,223],84:[2,72],85:[2,72],86:[2,100],91:[2,100],93:[2,100],102:[2,100],104:[2,100],105:[2,100],106:[2,100],110:[2,100],118:[2,100],126:[2,100],128:[2,100],129:[2,100],132:[2,100],133:[2,100],134:[2,100],135:[2,100],136:[2,100],137:[2,100]},{1:[2,140],6:[2,140],25:[2,140],26:[2,140],49:[2,140],54:[2,140],57:[2,140],73:[2,140],78:[2,140],86:[2,140],91:[2,140],93:[2,140],102:[2,140],103:87,104:[2,140],105:[2,140],106:[2,140],109:88,110:[2,140],111:69,118:[2,140],126:[2,140],128:[1,80],129:[1,79],132:[1,78],133:[1,81],134:[1,82],135:[1,83],136:[1,84],137:[1,85]},{1:[2,46],6:[2,46],26:[2,46],102:[2,46],103:87,104:[2,46],106:[2,46],109:88,110:[2,46],111:69,126:[2,46],128:[1,80],129:[1,79],132:[1,78],133:[1,81],134:[1,82],135:[1,83],136:[1,84],137:[1,85]},{6:[1,74],102:[1,224]},{4:225,7:4,8:6,9:7,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,76:[1,70],79:[1,43],83:[1,28],88:[1,58],89:[1,59],90:[1,57],96:[1,38],100:[1,44],101:[1,56],103:39,104:[1,65],106:[1,66],107:40,108:[1,67],109:41,110:[1,68],111:69,119:[1,42],124:37,125:[1,64],127:[1,31],128:[1,32],129:[1,33],130:[1,34],131:[1,35]},{6:[2,129],25:[2,129],54:[2,129],57:[1,227],91:[2,129],92:226,93:[1,193],103:87,104:[1,65],106:[1,66],109:88,110:[1,68],111:69,126:[1,86],128:[1,80],129:[1,79],132:[1,78],133:[1,81],134:[1,82],135:[1,83],136:[1,84],137:[1,85]},{1:[2,115],6:[2,115],25:[2,115],26:[2,115],40:[2,115],49:[2,115],54:[2,115],57:[2,115],66:[2,115],67:[2,115],68:[2,115],69:[2,115],71:[2,115],73:[2,115],74:[2,115],78:[2,115],84:[2,115],85:[2,115],86:[2,115],91:[2,115],93:[2,115],102:[2,115],104:[2,115],105:[2,115],106:[2,115],110:[2,115],116:[2,115],117:[2,115],118:[2,115],126:[2,115],128:[2,115],129:[2,115],132:[2,115],133:[2,115],134:[2,115],135:[2,115],136:[2,115],137:[2,115]},{6:[2,53],25:[2,53],53:228,54:[1,229],91:[2,53]},{6:[2,124],25:[2,124],26:[2,124],54:[2,124],86:[2,124],91:[2,124]},{8:202,9:118,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,25:[1,147],27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,60:148,61:36,63:25,64:26,65:27,76:[1,70],79:[1,43],83:[1,28],87:230,88:[1,58],89:[1,59],90:[1,57],94:146,96:[1,38],100:[1,44],101:[1,56],103:39,104:[1,65],106:[1,66],107:40,108:[1,67],109:41,110:[1,68],111:69,119:[1,42],124:37,125:[1,64],127:[1,31],128:[1,32],129:[1,33],130:[1,34],131:[1,35]},{6:[2,130],25:[2,130],26:[2,130],54:[2,130],86:[2,130],91:[2,130]},{1:[2,114],6:[2,114],25:[2,114],26:[2,114],40:[2,114],43:[2,114],49:[2,114],54:[2,114],57:[2,114],66:[2,114],67:[2,114],68:[2,114],69:[2,114],71:[2,114],73:[2,114],74:[2,114],78:[2,114],80:[2,114],84:[2,114],85:[2,114],86:[2,114],91:[2,114],93:[2,114],102:[2,114],104:[2,114],105:[2,114],106:[2,114],110:[2,114],116:[2,114],117:[2,114],118:[2,114],126:[2,114],128:[2,114],129:[2,114],130:[2,114],131:[2,114],132:[2,114],133:[2,114],134:[2,114],135:[2,114],136:[2,114],137:[2,114],138:[2,114]},{5:231,25:[1,5],103:87,104:[1,65],106:[1,66],109:88,110:[1,68],111:69,126:[1,86],128:[1,80],129:[1,79],132:[1,78],133:[1,81],134:[1,82],135:[1,83],136:[1,84],137:[1,85]},{1:[2,143],6:[2,143],25:[2,143],26:[2,143],49:[2,143],54:[2,143],57:[2,143],73:[2,143],78:[2,143],86:[2,143],91:[2,143],93:[2,143],102:[2,143],103:87,104:[1,65],105:[1,232],106:[1,66],109:88,110:[1,68],111:69,118:[2,143],126:[2,143],128:[1,80],129:[1,79],132:[1,78],133:[1,81],134:[1,82],135:[1,83],136:[1,84],137:[1,85]},{1:[2,145],6:[2,145],25:[2,145],26:[2,145],49:[2,145],54:[2,145],57:[2,145],73:[2,145],78:[2,145],86:[2,145],91:[2,145],93:[2,145],102:[2,145],103:87,104:[1,65],105:[1,233],106:[1,66],109:88,110:[1,68],111:69,118:[2,145],126:[2,145],128:[1,80],129:[1,79],132:[1,78],133:[1,81],134:[1,82],135:[1,83],136:[1,84],137:[1,85]},{1:[2,151],6:[2,151],25:[2,151],26:[2,151],49:[2,151],54:[2,151],57:[2,151],73:[2,151],78:[2,151],86:[2,151],91:[2,151],93:[2,151],102:[2,151],104:[2,151],105:[2,151],106:[2,151],110:[2,151],118:[2,151],126:[2,151],128:[2,151],129:[2,151],132:[2,151],133:[2,151],134:[2,151],135:[2,151],136:[2,151],137:[2,151]},{1:[2,152],6:[2,152],25:[2,152],26:[2,152],49:[2,152],54:[2,152],57:[2,152],73:[2,152],78:[2,152],86:[2,152],91:[2,152],93:[2,152],102:[2,152],103:87,104:[1,65],105:[2,152],106:[1,66],109:88,110:[1,68],111:69,118:[2,152],126:[2,152],128:[1,80],129:[1,79],132:[1,78],133:[1,81],134:[1,82],135:[1,83],136:[1,84],137:[1,85]},{1:[2,156],6:[2,156],25:[2,156],26:[2,156],49:[2,156],54:[2,156],57:[2,156],73:[2,156],78:[2,156],86:[2,156],91:[2,156],93:[2,156],102:[2,156],104:[2,156],105:[2,156],106:[2,156],110:[2,156],118:[2,156],126:[2,156],128:[2,156],129:[2,156],132:[2,156],133:[2,156],134:[2,156],135:[2,156],136:[2,156],137:[2,156]},{116:[2,158],117:[2,158]},{27:159,28:[1,73],44:160,58:161,59:162,76:[1,70],89:[1,114],90:[1,115],113:234,115:158},{54:[1,235],116:[2,164],117:[2,164]},{54:[2,160],116:[2,160],117:[2,160]},{54:[2,161],116:[2,161],117:[2,161]},{54:[2,162],116:[2,162],117:[2,162]},{54:[2,163],116:[2,163],117:[2,163]},{1:[2,157],6:[2,157],25:[2,157],26:[2,157],49:[2,157],54:[2,157],57:[2,157],73:[2,157],78:[2,157],86:[2,157],91:[2,157],93:[2,157],102:[2,157],104:[2,157],105:[2,157],106:[2,157],110:[2,157],118:[2,157],126:[2,157],128:[2,157],129:[2,157],132:[2,157],133:[2,157],134:[2,157],135:[2,157],136:[2,157],137:[2,157]},{8:236,9:118,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,76:[1,70],79:[1,43],83:[1,28],88:[1,58],89:[1,59],90:[1,57],96:[1,38],100:[1,44],101:[1,56],103:39,104:[1,65],106:[1,66],107:40,108:[1,67],109:41,110:[1,68],111:69,119:[1,42],124:37,125:[1,64],127:[1,31],128:[1,32],129:[1,33],130:[1,34],131:[1,35]},{8:237,9:118,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,76:[1,70],79:[1,43],83:[1,28],88:[1,58],89:[1,59],90:[1,57],96:[1,38],100:[1,44],101:[1,56],103:39,104:[1,65],106:[1,66],107:40,108:[1,67],109:41,110:[1,68],111:69,119:[1,42],124:37,125:[1,64],127:[1,31],128:[1,32],129:[1,33],130:[1,34],131:[1,35]},{6:[2,53],25:[2,53],53:238,54:[1,239],78:[2,53]},{6:[2,92],25:[2,92],26:[2,92],54:[2,92],78:[2,92]},{6:[2,39],25:[2,39],26:[2,39],43:[1,240],54:[2,39],78:[2,39]},{6:[2,42],25:[2,42],26:[2,42],54:[2,42],78:[2,42]},{6:[2,43],25:[2,43],26:[2,43],43:[2,43],54:[2,43],78:[2,43]},{6:[2,44],25:[2,44],26:[2,44],43:[2,44],54:[2,44],78:[2,44]},{6:[2,45],25:[2,45],26:[2,45],43:[2,45],54:[2,45],78:[2,45]},{1:[2,5],6:[2,5],26:[2,5],102:[2,5]},{1:[2,25],6:[2,25],25:[2,25],26:[2,25],49:[2,25],54:[2,25],57:[2,25],73:[2,25],78:[2,25],86:[2,25],91:[2,25],93:[2,25],98:[2,25],99:[2,25],102:[2,25],104:[2,25],105:[2,25],106:[2,25],110:[2,25],118:[2,25],121:[2,25],123:[2,25],126:[2,25],128:[2,25],129:[2,25],132:[2,25],133:[2,25],134:[2,25],135:[2,25],136:[2,25],137:[2,25]},{1:[2,195],6:[2,195],25:[2,195],26:[2,195],49:[2,195],54:[2,195],57:[2,195],73:[2,195],78:[2,195],86:[2,195],91:[2,195],93:[2,195],102:[2,195],103:87,104:[2,195],105:[2,195],106:[2,195],109:88,110:[2,195],111:69,118:[2,195],126:[2,195],128:[2,195],129:[2,195],132:[1,78],133:[1,81],134:[2,195],135:[2,195],136:[2,195],137:[2,195]},{1:[2,196],6:[2,196],25:[2,196],26:[2,196],49:[2,196],54:[2,196],57:[2,196],73:[2,196],78:[2,196],86:[2,196],91:[2,196],93:[2,196],102:[2,196],103:87,104:[2,196],105:[2,196],106:[2,196],109:88,110:[2,196],111:69,118:[2,196],126:[2,196],128:[2,196],129:[2,196],132:[1,78],133:[1,81],134:[2,196],135:[2,196],136:[2,196],137:[2,196]},{1:[2,197],6:[2,197],25:[2,197],26:[2,197],49:[2,197],54:[2,197],57:[2,197],73:[2,197],78:[2,197],86:[2,197],91:[2,197],93:[2,197],102:[2,197],103:87,104:[2,197],105:[2,197],106:[2,197],109:88,110:[2,197],111:69,118:[2,197],126:[2,197],128:[2,197],129:[2,197],132:[1,78],133:[2,197],134:[2,197],135:[2,197],136:[2,197],137:[2,197]},{1:[2,198],6:[2,198],25:[2,198],26:[2,198],49:[2,198],54:[2,198],57:[2,198],73:[2,198],78:[2,198],86:[2,198],91:[2,198],93:[2,198],102:[2,198],103:87,104:[2,198],105:[2,198],106:[2,198],109:88,110:[2,198],111:69,118:[2,198],126:[2,198],128:[1,80],129:[1,79],132:[1,78],133:[1,81],134:[2,198],135:[2,198],136:[2,198],137:[2,198]},{1:[2,199],6:[2,199],25:[2,199],26:[2,199],49:[2,199],54:[2,199],57:[2,199],73:[2,199],78:[2,199],86:[2,199],91:[2,199],93:[2,199],102:[2,199],103:87,104:[2,199],105:[2,199],106:[2,199],109:88,110:[2,199],111:69,118:[2,199],126:[2,199],128:[1,80],129:[1,79],132:[1,78],133:[1,81],134:[1,82],135:[2,199],136:[2,199],137:[1,85]},{1:[2,200],6:[2,200],25:[2,200],26:[2,200],49:[2,200],54:[2,200],57:[2,200],73:[2,200],78:[2,200],86:[2,200],91:[2,200],93:[2,200],102:[2,200],103:87,104:[2,200],105:[2,200],106:[2,200],109:88,110:[2,200],111:69,118:[2,200],126:[2,200],128:[1,80],129:[1,79],132:[1,78],133:[1,81],134:[1,82],135:[1,83],136:[2,200],137:[1,85]},{1:[2,201],6:[2,201],25:[2,201],26:[2,201],49:[2,201],54:[2,201],57:[2,201],73:[2,201],78:[2,201],86:[2,201],91:[2,201],93:[2,201],102:[2,201],103:87,104:[2,201],105:[2,201],106:[2,201],109:88,110:[2,201],111:69,118:[2,201],126:[2,201],128:[1,80],129:[1,79],132:[1,78],133:[1,81],134:[1,82],135:[2,201],136:[2,201],137:[2,201]},{1:[2,186],6:[2,186],25:[2,186],26:[2,186],49:[2,186],54:[2,186],57:[2,186],73:[2,186],78:[2,186],86:[2,186],91:[2,186],93:[2,186],102:[2,186],103:87,104:[1,65],105:[2,186],106:[1,66],109:88,110:[1,68],111:69,118:[2,186],126:[1,86],128:[1,80],129:[1,79],132:[1,78],133:[1,81],134:[1,82],135:[1,83],136:[1,84],137:[1,85]},{1:[2,185],6:[2,185],25:[2,185],26:[2,185],49:[2,185],54:[2,185],57:[2,185],73:[2,185],78:[2,185],86:[2,185],91:[2,185],93:[2,185],102:[2,185],103:87,104:[1,65],105:[2,185],106:[1,66],109:88,110:[1,68],111:69,118:[2,185],126:[1,86],128:[1,80],129:[1,79],132:[1,78],133:[1,81],134:[1,82],135:[1,83],136:[1,84],137:[1,85]},{1:[2,104],6:[2,104],25:[2,104],26:[2,104],49:[2,104],54:[2,104],57:[2,104],66:[2,104],67:[2,104],68:[2,104],69:[2,104],71:[2,104],73:[2,104],74:[2,104],78:[2,104],84:[2,104],85:[2,104],86:[2,104],91:[2,104],93:[2,104],102:[2,104],104:[2,104],105:[2,104],106:[2,104],110:[2,104],118:[2,104],126:[2,104],128:[2,104],129:[2,104],132:[2,104],133:[2,104],134:[2,104],135:[2,104],136:[2,104],137:[2,104]},{1:[2,80],6:[2,80],25:[2,80],26:[2,80],40:[2,80],49:[2,80],54:[2,80],57:[2,80],66:[2,80],67:[2,80],68:[2,80],69:[2,80],71:[2,80],73:[2,80],74:[2,80],78:[2,80],80:[2,80],84:[2,80],85:[2,80],86:[2,80],91:[2,80],93:[2,80],102:[2,80],104:[2,80],105:[2,80],106:[2,80],110:[2,80],118:[2,80],126:[2,80],128:[2,80],129:[2,80],130:[2,80],131:[2,80],132:[2,80],133:[2,80],134:[2,80],135:[2,80],136:[2,80],137:[2,80],138:[2,80]},{1:[2,81],6:[2,81],25:[2,81],26:[2,81],40:[2,81],49:[2,81],54:[2,81],57:[2,81],66:[2,81],67:[2,81],68:[2,81],69:[2,81],71:[2,81],73:[2,81],74:[2,81],78:[2,81],80:[2,81],84:[2,81],85:[2,81],86:[2,81],91:[2,81],93:[2,81],102:[2,81],104:[2,81],105:[2,81],106:[2,81],110:[2,81],118:[2,81],126:[2,81],128:[2,81],129:[2,81],130:[2,81],131:[2,81],132:[2,81],133:[2,81],134:[2,81],135:[2,81],136:[2,81],137:[2,81],138:[2,81]},{1:[2,82],6:[2,82],25:[2,82],26:[2,82],40:[2,82],49:[2,82],54:[2,82],57:[2,82],66:[2,82],67:[2,82],68:[2,82],69:[2,82],71:[2,82],73:[2,82],74:[2,82],78:[2,82],80:[2,82],84:[2,82],85:[2,82],86:[2,82],91:[2,82],93:[2,82],102:[2,82],104:[2,82],105:[2,82],106:[2,82],110:[2,82],118:[2,82],126:[2,82],128:[2,82],129:[2,82],130:[2,82],131:[2,82],132:[2,82],133:[2,82],134:[2,82],135:[2,82],136:[2,82],137:[2,82],138:[2,82]},{1:[2,83],6:[2,83],25:[2,83],26:[2,83],40:[2,83],49:[2,83],54:[2,83],57:[2,83],66:[2,83],67:[2,83],68:[2,83],69:[2,83],71:[2,83],73:[2,83],74:[2,83],78:[2,83],80:[2,83],84:[2,83],85:[2,83],86:[2,83],91:[2,83],93:[2,83],102:[2,83],104:[2,83],105:[2,83],106:[2,83],110:[2,83],118:[2,83],126:[2,83],128:[2,83],129:[2,83],130:[2,83],131:[2,83],132:[2,83],133:[2,83],134:[2,83],135:[2,83],136:[2,83],137:[2,83],138:[2,83]},{73:[1,241]},{57:[1,194],73:[2,88],92:242,93:[1,193],103:87,104:[1,65],106:[1,66],109:88,110:[1,68],111:69,126:[1,86],128:[1,80],129:[1,79],132:[1,78],133:[1,81],134:[1,82],135:[1,83],136:[1,84],137:[1,85]},{73:[2,89]},{8:243,9:118,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,73:[2,123],76:[1,70],79:[1,43],83:[1,28],88:[1,58],89:[1,59],90:[1,57],96:[1,38],100:[1,44],101:[1,56],103:39,104:[1,65],106:[1,66],107:40,108:[1,67],109:41,110:[1,68],111:69,119:[1,42],124:37,125:[1,64],127:[1,31],128:[1,32],129:[1,33],130:[1,34],131:[1,35]},{12:[2,117],28:[2,117],30:[2,117],31:[2,117],33:[2,117],34:[2,117],35:[2,117],36:[2,117],37:[2,117],38:[2,117],45:[2,117],46:[2,117],47:[2,117],51:[2,117],52:[2,117],73:[2,117],76:[2,117],79:[2,117],83:[2,117],88:[2,117],89:[2,117],90:[2,117],96:[2,117],100:[2,117],101:[2,117],104:[2,117],106:[2,117],108:[2,117],110:[2,117],119:[2,117],125:[2,117],127:[2,117],128:[2,117],129:[2,117],130:[2,117],131:[2,117]},{12:[2,118],28:[2,118],30:[2,118],31:[2,118],33:[2,118],34:[2,118],35:[2,118],36:[2,118],37:[2,118],38:[2,118],45:[2,118],46:[2,118],47:[2,118],51:[2,118],52:[2,118],73:[2,118],76:[2,118],79:[2,118],83:[2,118],88:[2,118],89:[2,118],90:[2,118],96:[2,118],100:[2,118],101:[2,118],104:[2,118],106:[2,118],108:[2,118],110:[2,118],119:[2,118],125:[2,118],127:[2,118],128:[2,118],129:[2,118],130:[2,118],131:[2,118]},{1:[2,87],6:[2,87],25:[2,87],26:[2,87],40:[2,87],49:[2,87],54:[2,87],57:[2,87],66:[2,87],67:[2,87],68:[2,87],69:[2,87],71:[2,87],73:[2,87],74:[2,87],78:[2,87],80:[2,87],84:[2,87],85:[2,87],86:[2,87],91:[2,87],93:[2,87],102:[2,87],104:[2,87],105:[2,87],106:[2,87],110:[2,87],118:[2,87],126:[2,87],128:[2,87],129:[2,87],130:[2,87],131:[2,87],132:[2,87],133:[2,87],134:[2,87],135:[2,87],136:[2,87],137:[2,87],138:[2,87]},{1:[2,105],6:[2,105],25:[2,105],26:[2,105],49:[2,105],54:[2,105],57:[2,105],66:[2,105],67:[2,105],68:[2,105],69:[2,105],71:[2,105],73:[2,105],74:[2,105],78:[2,105],84:[2,105],85:[2,105],86:[2,105],91:[2,105],93:[2,105],102:[2,105],104:[2,105],105:[2,105],106:[2,105],110:[2,105],118:[2,105],126:[2,105],128:[2,105],129:[2,105],132:[2,105],133:[2,105],134:[2,105],135:[2,105],136:[2,105],137:[2,105]},{1:[2,36],6:[2,36],25:[2,36],26:[2,36],49:[2,36],54:[2,36],57:[2,36],73:[2,36],78:[2,36],86:[2,36],91:[2,36],93:[2,36],102:[2,36],103:87,104:[2,36],105:[2,36],106:[2,36],109:88,110:[2,36],111:69,118:[2,36],126:[2,36],128:[1,80],129:[1,79],132:[1,78],133:[1,81],134:[1,82],135:[1,83],136:[1,84],137:[1,85]},{8:244,9:118,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,76:[1,70],79:[1,43],83:[1,28],88:[1,58],89:[1,59],90:[1,57],96:[1,38],100:[1,44],101:[1,56],103:39,104:[1,65],106:[1,66],107:40,108:[1,67],109:41,110:[1,68],111:69,119:[1,42],124:37,125:[1,64],127:[1,31],128:[1,32],129:[1,33],130:[1,34],131:[1,35]},{8:245,9:118,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,76:[1,70],79:[1,43],83:[1,28],88:[1,58],89:[1,59],90:[1,57],96:[1,38],100:[1,44],101:[1,56],103:39,104:[1,65],106:[1,66],107:40,108:[1,67],109:41,110:[1,68],111:69,119:[1,42],124:37,125:[1,64],127:[1,31],128:[1,32],129:[1,33],130:[1,34],131:[1,35]},{1:[2,110],6:[2,110],25:[2,110],26:[2,110],49:[2,110],54:[2,110],57:[2,110],66:[2,110],67:[2,110],68:[2,110],69:[2,110],71:[2,110],73:[2,110],74:[2,110],78:[2,110],84:[2,110],85:[2,110],86:[2,110],91:[2,110],93:[2,110],102:[2,110],104:[2,110],105:[2,110],106:[2,110],110:[2,110],118:[2,110],126:[2,110],128:[2,110],129:[2,110],132:[2,110],133:[2,110],134:[2,110],135:[2,110],136:[2,110],137:[2,110]},{6:[2,53],25:[2,53],53:246,54:[1,229],86:[2,53]},{6:[2,129],25:[2,129],26:[2,129],54:[2,129],57:[1,247],86:[2,129],91:[2,129],103:87,104:[1,65],106:[1,66],109:88,110:[1,68],111:69,126:[1,86],128:[1,80],129:[1,79],132:[1,78],133:[1,81],134:[1,82],135:[1,83],136:[1,84],137:[1,85]},{50:248,51:[1,60],52:[1,61]},{6:[2,54],25:[2,54],26:[2,54],27:110,28:[1,73],44:111,55:249,56:109,58:112,59:113,76:[1,70],89:[1,114],90:[1,115]},{6:[1,250],25:[1,251]},{6:[2,61],25:[2,61],26:[2,61],49:[2,61],54:[2,61]},{8:252,9:118,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,76:[1,70],79:[1,43],83:[1,28],88:[1,58],89:[1,59],90:[1,57],96:[1,38],100:[1,44],101:[1,56],103:39,104:[1,65],106:[1,66],107:40,108:[1,67],109:41,110:[1,68],111:69,119:[1,42],124:37,125:[1,64],127:[1,31],128:[1,32],129:[1,33],130:[1,34],131:[1,35]},{1:[2,202],6:[2,202],25:[2,202],26:[2,202],49:[2,202],54:[2,202],57:[2,202],73:[2,202],78:[2,202],86:[2,202],91:[2,202],93:[2,202],102:[2,202],103:87,104:[2,202],105:[2,202],106:[2,202],109:88,110:[2,202],111:69,118:[2,202],126:[2,202],128:[1,80],129:[1,79],132:[1,78],133:[1,81],134:[1,82],135:[1,83],136:[1,84],137:[1,85]},{8:253,9:118,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,76:[1,70],79:[1,43],83:[1,28],88:[1,58],89:[1,59],90:[1,57],96:[1,38],100:[1,44],101:[1,56],103:39,104:[1,65],106:[1,66],107:40,108:[1,67],109:41,110:[1,68],111:69,119:[1,42],124:37,125:[1,64],127:[1,31],128:[1,32],129:[1,33],130:[1,34],131:[1,35]},{8:254,9:118,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,76:[1,70],79:[1,43],83:[1,28],88:[1,58],89:[1,59],90:[1,57],96:[1,38],100:[1,44],101:[1,56],103:39,104:[1,65],106:[1,66],107:40,108:[1,67],109:41,110:[1,68],111:69,119:[1,42],124:37,125:[1,64],127:[1,31],128:[1,32],129:[1,33],130:[1,34],131:[1,35]},{1:[2,205],6:[2,205],25:[2,205],26:[2,205],49:[2,205],54:[2,205],57:[2,205],73:[2,205],78:[2,205],86:[2,205],91:[2,205],93:[2,205],102:[2,205],103:87,104:[2,205],105:[2,205],106:[2,205],109:88,110:[2,205],111:69,118:[2,205],126:[2,205],128:[1,80],129:[1,79],132:[1,78],133:[1,81],134:[1,82],135:[1,83],136:[1,84],137:[1,85]},{1:[2,184],6:[2,184],25:[2,184],26:[2,184],49:[2,184],54:[2,184],57:[2,184],73:[2,184],78:[2,184],86:[2,184],91:[2,184],93:[2,184],102:[2,184],104:[2,184],105:[2,184],106:[2,184],110:[2,184],118:[2,184],126:[2,184],128:[2,184],129:[2,184],132:[2,184],133:[2,184],134:[2,184],135:[2,184],136:[2,184],137:[2,184]},{8:255,9:118,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,76:[1,70],79:[1,43],83:[1,28],88:[1,58],89:[1,59],90:[1,57],96:[1,38],100:[1,44],101:[1,56],103:39,104:[1,65],106:[1,66],107:40,108:[1,67],109:41,110:[1,68],111:69,119:[1,42],124:37,125:[1,64],127:[1,31],128:[1,32],129:[1,33],130:[1,34],131:[1,35]},{1:[2,134],6:[2,134],25:[2,134],26:[2,134],49:[2,134],54:[2,134],57:[2,134],73:[2,134],78:[2,134],86:[2,134],91:[2,134],93:[2,134],98:[1,256],102:[2,134],104:[2,134],105:[2,134],106:[2,134],110:[2,134],118:[2,134],126:[2,134],128:[2,134],129:[2,134],132:[2,134],133:[2,134],134:[2,134],135:[2,134],136:[2,134],137:[2,134]},{5:257,25:[1,5]},{5:260,25:[1,5],27:258,28:[1,73],59:259,76:[1,70]},{120:261,122:219,123:[1,220]},{26:[1,262],121:[1,263],122:264,123:[1,220]},{26:[2,177],121:[2,177],123:[2,177]},{8:266,9:118,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,76:[1,70],79:[1,43],83:[1,28],88:[1,58],89:[1,59],90:[1,57],95:265,96:[1,38],100:[1,44],101:[1,56],103:39,104:[1,65],106:[1,66],107:40,108:[1,67],109:41,110:[1,68],111:69,119:[1,42],124:37,125:[1,64],127:[1,31],128:[1,32],129:[1,33],130:[1,34],131:[1,35]},{1:[2,98],5:267,6:[2,98],25:[1,5],26:[2,98],49:[2,98],54:[2,98],57:[2,98],73:[2,98],78:[2,98],86:[2,98],91:[2,98],93:[2,98],102:[2,98],103:87,104:[1,65],105:[2,98],106:[1,66],109:88,110:[1,68],111:69,118:[2,98],126:[2,98],128:[1,80],129:[1,79],132:[1,78],133:[1,81],134:[1,82],135:[1,83],136:[1,84],137:[1,85]},{1:[2,101],6:[2,101],25:[2,101],26:[2,101],49:[2,101],54:[2,101],57:[2,101],73:[2,101],78:[2,101],86:[2,101],91:[2,101],93:[2,101],102:[2,101],104:[2,101],105:[2,101],106:[2,101],110:[2,101],118:[2,101],126:[2,101],128:[2,101],129:[2,101],132:[2,101],133:[2,101],134:[2,101],135:[2,101],136:[2,101],137:[2,101]},{8:268,9:118,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,76:[1,70],79:[1,43],83:[1,28],88:[1,58],89:[1,59],90:[1,57],96:[1,38],100:[1,44],101:[1,56],103:39,104:[1,65],106:[1,66],107:40,108:[1,67],109:41,110:[1,68],111:69,119:[1,42],124:37,125:[1,64],127:[1,31],128:[1,32],129:[1,33],130:[1,34],131:[1,35]},{1:[2,141],6:[2,141],25:[2,141],26:[2,141],49:[2,141],54:[2,141],57:[2,141],66:[2,141],67:[2,141],68:[2,141],69:[2,141],71:[2,141],73:[2,141],74:[2,141],78:[2,141],84:[2,141],85:[2,141],86:[2,141],91:[2,141],93:[2,141],102:[2,141],104:[2,141],105:[2,141],106:[2,141],110:[2,141],118:[2,141],126:[2,141],128:[2,141],129:[2,141],132:[2,141],133:[2,141],134:[2,141],135:[2,141],136:[2,141],137:[2,141]},{6:[1,74],26:[1,269]},{8:270,9:118,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,76:[1,70],79:[1,43],83:[1,28],88:[1,58],89:[1,59],90:[1,57],96:[1,38],100:[1,44],101:[1,56],103:39,104:[1,65],106:[1,66],107:40,108:[1,67],109:41,110:[1,68],111:69,119:[1,42],124:37,125:[1,64],127:[1,31],128:[1,32],129:[1,33],130:[1,34],131:[1,35]},{6:[2,67],12:[2,118],25:[2,67],28:[2,118],30:[2,118],31:[2,118],33:[2,118],34:[2,118],35:[2,118],36:[2,118],37:[2,118],38:[2,118],45:[2,118],46:[2,118],47:[2,118],51:[2,118],52:[2,118],54:[2,67],76:[2,118],79:[2,118],83:[2,118],88:[2,118],89:[2,118],90:[2,118],91:[2,67],96:[2,118],100:[2,118],101:[2,118],104:[2,118],106:[2,118],108:[2,118],110:[2,118],119:[2,118],125:[2,118],127:[2,118],128:[2,118],129:[2,118],130:[2,118],131:[2,118]},{6:[1,272],25:[1,273],91:[1,271]},{6:[2,54],8:202,9:118,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,25:[2,54],26:[2,54],27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,60:148,61:36,63:25,64:26,65:27,76:[1,70],79:[1,43],83:[1,28],86:[2,54],88:[1,58],89:[1,59],90:[1,57],91:[2,54],94:274,96:[1,38],100:[1,44],101:[1,56],103:39,104:[1,65],106:[1,66],107:40,108:[1,67],109:41,110:[1,68],111:69,119:[1,42],124:37,125:[1,64],127:[1,31],128:[1,32],129:[1,33],130:[1,34],131:[1,35]},{6:[2,53],25:[2,53],26:[2,53],53:275,54:[1,229]},{1:[2,181],6:[2,181],25:[2,181],26:[2,181],49:[2,181],54:[2,181],57:[2,181],73:[2,181],78:[2,181],86:[2,181],91:[2,181],93:[2,181],102:[2,181],104:[2,181],105:[2,181],106:[2,181],110:[2,181],118:[2,181],121:[2,181],126:[2,181],128:[2,181],129:[2,181],132:[2,181],133:[2,181],134:[2,181],135:[2,181],136:[2,181],137:[2,181]},{8:276,9:118,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,76:[1,70],79:[1,43],83:[1,28],88:[1,58],89:[1,59],90:[1,57],96:[1,38],100:[1,44],101:[1,56],103:39,104:[1,65],106:[1,66],107:40,108:[1,67],109:41,110:[1,68],111:69,119:[1,42],124:37,125:[1,64],127:[1,31],128:[1,32],129:[1,33],130:[1,34],131:[1,35]},{8:277,9:118,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,76:[1,70],79:[1,43],83:[1,28],88:[1,58],89:[1,59],90:[1,57],96:[1,38],100:[1,44],101:[1,56],103:39,104:[1,65],106:[1,66],107:40,108:[1,67],109:41,110:[1,68],111:69,119:[1,42],124:37,125:[1,64],127:[1,31],128:[1,32],129:[1,33],130:[1,34],131:[1,35]},{116:[2,159],117:[2,159]},{27:159,28:[1,73],44:160,58:161,59:162,76:[1,70],89:[1,114],90:[1,115],115:278},{1:[2,166],6:[2,166],25:[2,166],26:[2,166],49:[2,166],54:[2,166],57:[2,166],73:[2,166],78:[2,166],86:[2,166],91:[2,166],93:[2,166],102:[2,166],103:87,104:[2,166],105:[1,279],106:[2,166],109:88,110:[2,166],111:69,118:[1,280],126:[2,166],128:[1,80],129:[1,79],132:[1,78],133:[1,81],134:[1,82],135:[1,83],136:[1,84],137:[1,85]},{1:[2,167],6:[2,167],25:[2,167],26:[2,167],49:[2,167],54:[2,167],57:[2,167],73:[2,167],78:[2,167],86:[2,167],91:[2,167],93:[2,167],102:[2,167],103:87,104:[2,167],105:[1,281],106:[2,167],109:88,110:[2,167],111:69,118:[2,167],126:[2,167],128:[1,80],129:[1,79],132:[1,78],133:[1,81],134:[1,82],135:[1,83],136:[1,84],137:[1,85]},{6:[1,283],25:[1,284],78:[1,282]},{6:[2,54],11:169,25:[2,54],26:[2,54],27:170,28:[1,73],29:171,30:[1,71],31:[1,72],41:285,42:168,44:172,46:[1,46],78:[2,54],89:[1,114]},{8:286,9:118,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,25:[1,287],27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,76:[1,70],79:[1,43],83:[1,28],88:[1,58],89:[1,59],90:[1,57],96:[1,38],100:[1,44],101:[1,56],103:39,104:[1,65],106:[1,66],107:40,108:[1,67],109:41,110:[1,68],111:69,119:[1,42],124:37,125:[1,64],127:[1,31],128:[1,32],129:[1,33],130:[1,34],131:[1,35]},{1:[2,86],6:[2,86],25:[2,86],26:[2,86],40:[2,86],49:[2,86],54:[2,86],57:[2,86],66:[2,86],67:[2,86],68:[2,86],69:[2,86],71:[2,86],73:[2,86],74:[2,86],78:[2,86],80:[2,86],84:[2,86],85:[2,86],86:[2,86],91:[2,86],93:[2,86],102:[2,86],104:[2,86],105:[2,86],106:[2,86],110:[2,86],118:[2,86],126:[2,86],128:[2,86],129:[2,86],130:[2,86],131:[2,86],132:[2,86],133:[2,86],134:[2,86],135:[2,86],136:[2,86],137:[2,86],138:[2,86]},{8:288,9:118,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,73:[2,121],76:[1,70],79:[1,43],83:[1,28],88:[1,58],89:[1,59],90:[1,57],96:[1,38],100:[1,44],101:[1,56],103:39,104:[1,65],106:[1,66],107:40,108:[1,67],109:41,110:[1,68],111:69,119:[1,42],124:37,125:[1,64],127:[1,31],128:[1,32],129:[1,33],130:[1,34],131:[1,35]},{73:[2,122],103:87,104:[1,65],106:[1,66],109:88,110:[1,68],111:69,126:[1,86],128:[1,80],129:[1,79],132:[1,78],133:[1,81],134:[1,82],135:[1,83],136:[1,84],137:[1,85]},{1:[2,37],6:[2,37],25:[2,37],26:[2,37],49:[2,37],54:[2,37],57:[2,37],73:[2,37],78:[2,37],86:[2,37],91:[2,37],93:[2,37],102:[2,37],103:87,104:[2,37],105:[2,37],106:[2,37],109:88,110:[2,37],111:69,118:[2,37],126:[2,37],128:[1,80],129:[1,79],132:[1,78],133:[1,81],134:[1,82],135:[1,83],136:[1,84],137:[1,85]},{26:[1,289],103:87,104:[1,65],106:[1,66],109:88,110:[1,68],111:69,126:[1,86],128:[1,80],129:[1,79],132:[1,78],133:[1,81],134:[1,82],135:[1,83],136:[1,84],137:[1,85]},{6:[1,272],25:[1,273],86:[1,290]},{6:[2,67],25:[2,67],26:[2,67],54:[2,67],86:[2,67],91:[2,67]},{5:291,25:[1,5]},{6:[2,57],25:[2,57],26:[2,57],49:[2,57],54:[2,57]},{27:110,28:[1,73],44:111,55:292,56:109,58:112,59:113,76:[1,70],89:[1,114],90:[1,115]},{6:[2,55],25:[2,55],26:[2,55],27:110,28:[1,73],44:111,48:293,54:[2,55],55:108,56:109,58:112,59:113,76:[1,70],89:[1,114],90:[1,115]},{6:[2,62],25:[2,62],26:[2,62],49:[2,62],54:[2,62],103:87,104:[1,65],106:[1,66],109:88,110:[1,68],111:69,126:[1,86],128:[1,80],129:[1,79],132:[1,78],133:[1,81],134:[1,82],135:[1,83],136:[1,84],137:[1,85]},{26:[1,294],103:87,104:[1,65],106:[1,66],109:88,110:[1,68],111:69,126:[1,86],128:[1,80],129:[1,79],132:[1,78],133:[1,81],134:[1,82],135:[1,83],136:[1,84],137:[1,85]},{1:[2,204],6:[2,204],25:[2,204],26:[2,204],49:[2,204],54:[2,204],57:[2,204],73:[2,204],78:[2,204],86:[2,204],91:[2,204],93:[2,204],102:[2,204],103:87,104:[2,204],105:[2,204],106:[2,204],109:88,110:[2,204],111:69,118:[2,204],126:[2,204],128:[1,80],129:[1,79],132:[1,78],133:[1,81],134:[1,82],135:[1,83],136:[1,84],137:[1,85]},{5:295,25:[1,5],103:87,104:[1,65],106:[1,66],109:88,110:[1,68],111:69,126:[1,86],128:[1,80],129:[1,79],132:[1,78],133:[1,81],134:[1,82],135:[1,83],136:[1,84],137:[1,85]},{5:296,25:[1,5]},{1:[2,135],6:[2,135],25:[2,135],26:[2,135],49:[2,135],54:[2,135],57:[2,135],73:[2,135],78:[2,135],86:[2,135],91:[2,135],93:[2,135],102:[2,135],104:[2,135],105:[2,135],106:[2,135],110:[2,135],118:[2,135],126:[2,135],128:[2,135],129:[2,135],132:[2,135],133:[2,135],134:[2,135],135:[2,135],136:[2,135],137:[2,135]},{5:297,25:[1,5]},{5:298,25:[1,5]},{1:[2,139],6:[2,139],25:[2,139],26:[2,139],49:[2,139],54:[2,139],57:[2,139],73:[2,139],78:[2,139],86:[2,139],91:[2,139],93:[2,139],98:[2,139],102:[2,139],104:[2,139],105:[2,139],106:[2,139],110:[2,139],118:[2,139],126:[2,139],128:[2,139],129:[2,139],132:[2,139],133:[2,139],134:[2,139],135:[2,139],136:[2,139],137:[2,139]},{26:[1,299],121:[1,300],122:264,123:[1,220]},{1:[2,175],6:[2,175],25:[2,175],26:[2,175],49:[2,175],54:[2,175],57:[2,175],73:[2,175],78:[2,175],86:[2,175],91:[2,175],93:[2,175],102:[2,175],104:[2,175],105:[2,175],106:[2,175],110:[2,175],118:[2,175],126:[2,175],128:[2,175],129:[2,175],132:[2,175],133:[2,175],134:[2,175],135:[2,175],136:[2,175],137:[2,175]},{5:301,25:[1,5]},{26:[2,178],121:[2,178],123:[2,178]},{5:302,25:[1,5],54:[1,303]},{25:[2,131],54:[2,131],103:87,104:[1,65],106:[1,66],109:88,110:[1,68],111:69,126:[1,86],128:[1,80],129:[1,79],132:[1,78],133:[1,81],134:[1,82],135:[1,83],136:[1,84],137:[1,85]},{1:[2,99],6:[2,99],25:[2,99],26:[2,99],49:[2,99],54:[2,99],57:[2,99],73:[2,99],78:[2,99],86:[2,99],91:[2,99],93:[2,99],102:[2,99],104:[2,99],105:[2,99],106:[2,99],110:[2,99],118:[2,99],126:[2,99],128:[2,99],129:[2,99],132:[2,99],133:[2,99],134:[2,99],135:[2,99],136:[2,99],137:[2,99]},{1:[2,102],5:304,6:[2,102],25:[1,5],26:[2,102],49:[2,102],54:[2,102],57:[2,102],73:[2,102],78:[2,102],86:[2,102],91:[2,102],93:[2,102],102:[2,102],103:87,104:[1,65],105:[2,102],106:[1,66],109:88,110:[1,68],111:69,118:[2,102],126:[2,102],128:[1,80],129:[1,79],132:[1,78],133:[1,81],134:[1,82],135:[1,83],136:[1,84],137:[1,85]},{102:[1,305]},{91:[1,306],103:87,104:[1,65],106:[1,66],109:88,110:[1,68],111:69,126:[1,86],128:[1,80],129:[1,79],132:[1,78],133:[1,81],134:[1,82],135:[1,83],136:[1,84],137:[1,85]},{1:[2,116],6:[2,116],25:[2,116],26:[2,116],40:[2,116],49:[2,116],54:[2,116],57:[2,116],66:[2,116],67:[2,116],68:[2,116],69:[2,116],71:[2,116],73:[2,116],74:[2,116],78:[2,116],84:[2,116],85:[2,116],86:[2,116],91:[2,116],93:[2,116],102:[2,116],104:[2,116],105:[2,116],106:[2,116],110:[2,116],116:[2,116],117:[2,116],118:[2,116],126:[2,116],128:[2,116],129:[2,116],132:[2,116],133:[2,116],134:[2,116],135:[2,116],136:[2,116],137:[2,116]},{8:202,9:118,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,60:148,61:36,63:25,64:26,65:27,76:[1,70],79:[1,43],83:[1,28],88:[1,58],89:[1,59],90:[1,57],94:307,96:[1,38],100:[1,44],101:[1,56],103:39,104:[1,65],106:[1,66],107:40,108:[1,67],109:41,110:[1,68],111:69,119:[1,42],124:37,125:[1,64],127:[1,31],128:[1,32],129:[1,33],130:[1,34],131:[1,35]},{8:202,9:118,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,25:[1,147],27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,60:148,61:36,63:25,64:26,65:27,76:[1,70],79:[1,43],83:[1,28],87:308,88:[1,58],89:[1,59],90:[1,57],94:146,96:[1,38],100:[1,44],101:[1,56],103:39,104:[1,65],106:[1,66],107:40,108:[1,67],109:41,110:[1,68],111:69,119:[1,42],124:37,125:[1,64],127:[1,31],128:[1,32],129:[1,33],130:[1,34],131:[1,35]},{6:[2,125],25:[2,125],26:[2,125],54:[2,125],86:[2,125],91:[2,125]},{6:[1,272],25:[1,273],26:[1,309]},{1:[2,144],6:[2,144],25:[2,144],26:[2,144],49:[2,144],54:[2,144],57:[2,144],73:[2,144],78:[2,144],86:[2,144],91:[2,144],93:[2,144],102:[2,144],103:87,104:[1,65],105:[2,144],106:[1,66],109:88,110:[1,68],111:69,118:[2,144],126:[2,144],128:[1,80],129:[1,79],132:[1,78],133:[1,81],134:[1,82],135:[1,83],136:[1,84],137:[1,85]},{1:[2,146],6:[2,146],25:[2,146],26:[2,146],49:[2,146],54:[2,146],57:[2,146],73:[2,146],78:[2,146],86:[2,146],91:[2,146],93:[2,146],102:[2,146],103:87,104:[1,65],105:[2,146],106:[1,66],109:88,110:[1,68],111:69,118:[2,146],126:[2,146],128:[1,80],129:[1,79],132:[1,78],133:[1,81],134:[1,82],135:[1,83],136:[1,84],137:[1,85]},{116:[2,165],117:[2,165]},{8:310,9:118,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,76:[1,70],79:[1,43],83:[1,28],88:[1,58],89:[1,59],90:[1,57],96:[1,38],100:[1,44],101:[1,56],103:39,104:[1,65],106:[1,66],107:40,108:[1,67],109:41,110:[1,68],111:69,119:[1,42],124:37,125:[1,64],127:[1,31],128:[1,32],129:[1,33],130:[1,34],131:[1,35]},{8:311,9:118,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,76:[1,70],79:[1,43],83:[1,28],88:[1,58],89:[1,59],90:[1,57],96:[1,38],100:[1,44],101:[1,56],103:39,104:[1,65],106:[1,66],107:40,108:[1,67],109:41,110:[1,68],111:69,119:[1,42],124:37,125:[1,64],127:[1,31],128:[1,32],129:[1,33],130:[1,34],131:[1,35]},{8:312,9:118,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,76:[1,70],79:[1,43],83:[1,28],88:[1,58],89:[1,59],90:[1,57],96:[1,38],100:[1,44],101:[1,56],103:39,104:[1,65],106:[1,66],107:40,108:[1,67],109:41,110:[1,68],111:69,119:[1,42],124:37,125:[1,64],127:[1,31],128:[1,32],129:[1,33],130:[1,34],131:[1,35]},{1:[2,90],6:[2,90],25:[2,90],26:[2,90],40:[2,90],49:[2,90],54:[2,90],57:[2,90],66:[2,90],67:[2,90],68:[2,90],69:[2,90],71:[2,90],73:[2,90],74:[2,90],78:[2,90],84:[2,90],85:[2,90],86:[2,90],91:[2,90],93:[2,90],102:[2,90],104:[2,90],105:[2,90],106:[2,90],110:[2,90],116:[2,90],117:[2,90],118:[2,90],126:[2,90],128:[2,90],129:[2,90],132:[2,90],133:[2,90],134:[2,90],135:[2,90],136:[2,90],137:[2,90]},{11:169,27:170,28:[1,73],29:171,30:[1,71],31:[1,72],41:313,42:168,44:172,46:[1,46],89:[1,114]},{6:[2,91],11:169,25:[2,91],26:[2,91],27:170,28:[1,73],29:171,30:[1,71],31:[1,72],41:167,42:168,44:172,46:[1,46],54:[2,91],77:314,89:[1,114]},{6:[2,93],25:[2,93],26:[2,93],54:[2,93],78:[2,93]},{6:[2,40],25:[2,40],26:[2,40],54:[2,40],78:[2,40],103:87,104:[1,65],106:[1,66],109:88,110:[1,68],111:69,126:[1,86],128:[1,80],129:[1,79],132:[1,78],133:[1,81],134:[1,82],135:[1,83],136:[1,84],137:[1,85]},{8:315,9:118,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,76:[1,70],79:[1,43],83:[1,28],88:[1,58],89:[1,59],90:[1,57],96:[1,38],100:[1,44],101:[1,56],103:39,104:[1,65],106:[1,66],107:40,108:[1,67],109:41,110:[1,68],111:69,119:[1,42],124:37,125:[1,64],127:[1,31],128:[1,32],129:[1,33],130:[1,34],131:[1,35]},{73:[2,120],103:87,104:[1,65],106:[1,66],109:88,110:[1,68],111:69,126:[1,86],128:[1,80],129:[1,79],132:[1,78],133:[1,81],134:[1,82],135:[1,83],136:[1,84],137:[1,85]},{1:[2,38],6:[2,38],25:[2,38],26:[2,38],49:[2,38],54:[2,38],57:[2,38],73:[2,38],78:[2,38],86:[2,38],91:[2,38],93:[2,38],102:[2,38],104:[2,38],105:[2,38],106:[2,38],110:[2,38],118:[2,38],126:[2,38],128:[2,38],129:[2,38],132:[2,38],133:[2,38],134:[2,38],135:[2,38],136:[2,38],137:[2,38]},{1:[2,111],6:[2,111],25:[2,111],26:[2,111],49:[2,111],54:[2,111],57:[2,111],66:[2,111],67:[2,111],68:[2,111],69:[2,111],71:[2,111],73:[2,111],74:[2,111],78:[2,111],84:[2,111],85:[2,111],86:[2,111],91:[2,111],93:[2,111],102:[2,111],104:[2,111],105:[2,111],106:[2,111],110:[2,111],118:[2,111],126:[2,111],128:[2,111],129:[2,111],132:[2,111],133:[2,111],134:[2,111],135:[2,111],136:[2,111],137:[2,111]},{1:[2,49],6:[2,49],25:[2,49],26:[2,49],49:[2,49],54:[2,49],57:[2,49],73:[2,49],78:[2,49],86:[2,49],91:[2,49],93:[2,49],102:[2,49],104:[2,49],105:[2,49],106:[2,49],110:[2,49],118:[2,49],126:[2,49],128:[2,49],129:[2,49],132:[2,49],133:[2,49],134:[2,49],135:[2,49],136:[2,49],137:[2,49]},{6:[2,58],25:[2,58],26:[2,58],49:[2,58],54:[2,58]},{6:[2,53],25:[2,53],26:[2,53],53:316,54:[1,204]},{1:[2,203],6:[2,203],25:[2,203],26:[2,203],49:[2,203],54:[2,203],57:[2,203],73:[2,203],78:[2,203],86:[2,203],91:[2,203],93:[2,203],102:[2,203],104:[2,203],105:[2,203],106:[2,203],110:[2,203],118:[2,203],126:[2,203],128:[2,203],129:[2,203],132:[2,203],133:[2,203],134:[2,203],135:[2,203],136:[2,203],137:[2,203]},{1:[2,182],6:[2,182],25:[2,182],26:[2,182],49:[2,182],54:[2,182],57:[2,182],73:[2,182],78:[2,182],86:[2,182],91:[2,182],93:[2,182],102:[2,182],104:[2,182],105:[2,182],106:[2,182],110:[2,182],118:[2,182],121:[2,182],126:[2,182],128:[2,182],129:[2,182],132:[2,182],133:[2,182],134:[2,182],135:[2,182],136:[2,182],137:[2,182]},{1:[2,136],6:[2,136],25:[2,136],26:[2,136],49:[2,136],54:[2,136],57:[2,136],73:[2,136],78:[2,136],86:[2,136],91:[2,136],93:[2,136],102:[2,136],104:[2,136],105:[2,136],106:[2,136],110:[2,136],118:[2,136],126:[2,136],128:[2,136],129:[2,136],132:[2,136],133:[2,136],134:[2,136],135:[2,136],136:[2,136],137:[2,136]},{1:[2,137],6:[2,137],25:[2,137],26:[2,137],49:[2,137],54:[2,137],57:[2,137],73:[2,137],78:[2,137],86:[2,137],91:[2,137],93:[2,137],98:[2,137],102:[2,137],104:[2,137],105:[2,137],106:[2,137],110:[2,137],118:[2,137],126:[2,137],128:[2,137],129:[2,137],132:[2,137],133:[2,137],134:[2,137],135:[2,137],136:[2,137],137:[2,137]},{1:[2,138],6:[2,138],25:[2,138],26:[2,138],49:[2,138],54:[2,138],57:[2,138],73:[2,138],78:[2,138],86:[2,138],91:[2,138],93:[2,138],98:[2,138],102:[2,138],104:[2,138],105:[2,138],106:[2,138],110:[2,138],118:[2,138],126:[2,138],128:[2,138],129:[2,138],132:[2,138],133:[2,138],134:[2,138],135:[2,138],136:[2,138],137:[2,138]},{1:[2,173],6:[2,173],25:[2,173],26:[2,173],49:[2,173],54:[2,173],57:[2,173],73:[2,173],78:[2,173],86:[2,173],91:[2,173],93:[2,173],102:[2,173],104:[2,173],105:[2,173],106:[2,173],110:[2,173],118:[2,173],126:[2,173],128:[2,173],129:[2,173],132:[2,173],133:[2,173],134:[2,173],135:[2,173],136:[2,173],137:[2,173]},{5:317,25:[1,5]},{26:[1,318]},{6:[1,319],26:[2,179],121:[2,179],123:[2,179]},{8:320,9:118,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,76:[1,70],79:[1,43],83:[1,28],88:[1,58],89:[1,59],90:[1,57],96:[1,38],100:[1,44],101:[1,56],103:39,104:[1,65],106:[1,66],107:40,108:[1,67],109:41,110:[1,68],111:69,119:[1,42],124:37,125:[1,64],127:[1,31],128:[1,32],129:[1,33],130:[1,34],131:[1,35]},{1:[2,103],6:[2,103],25:[2,103],26:[2,103],49:[2,103],54:[2,103],57:[2,103],73:[2,103],78:[2,103],86:[2,103],91:[2,103],93:[2,103],102:[2,103],104:[2,103],105:[2,103],106:[2,103],110:[2,103],118:[2,103],126:[2,103],128:[2,103],129:[2,103],132:[2,103],133:[2,103],134:[2,103],135:[2,103],136:[2,103],137:[2,103]},{1:[2,142],6:[2,142],25:[2,142],26:[2,142],49:[2,142],54:[2,142],57:[2,142],66:[2,142],67:[2,142],68:[2,142],69:[2,142],71:[2,142],73:[2,142],74:[2,142],78:[2,142],84:[2,142],85:[2,142],86:[2,142],91:[2,142],93:[2,142],102:[2,142],104:[2,142],105:[2,142],106:[2,142],110:[2,142],118:[2,142],126:[2,142],128:[2,142],129:[2,142],132:[2,142],133:[2,142],134:[2,142],135:[2,142],136:[2,142],137:[2,142]},{1:[2,119],6:[2,119],25:[2,119],26:[2,119],49:[2,119],54:[2,119],57:[2,119],66:[2,119],67:[2,119],68:[2,119],69:[2,119],71:[2,119],73:[2,119],74:[2,119],78:[2,119],84:[2,119],85:[2,119],86:[2,119],91:[2,119],93:[2,119],102:[2,119],104:[2,119],105:[2,119],106:[2,119],110:[2,119],118:[2,119],126:[2,119],128:[2,119],129:[2,119],132:[2,119],133:[2,119],134:[2,119],135:[2,119],136:[2,119],137:[2,119]},{6:[2,126],25:[2,126],26:[2,126],54:[2,126],86:[2,126],91:[2,126]},{6:[2,53],25:[2,53],26:[2,53],53:321,54:[1,229]},{6:[2,127],25:[2,127],26:[2,127],54:[2,127],86:[2,127],91:[2,127]},{1:[2,168],6:[2,168],25:[2,168],26:[2,168],49:[2,168],54:[2,168],57:[2,168],73:[2,168],78:[2,168],86:[2,168],91:[2,168],93:[2,168],102:[2,168],103:87,104:[2,168],105:[2,168],106:[2,168],109:88,110:[2,168],111:69,118:[1,322],126:[2,168],128:[1,80],129:[1,79],132:[1,78],133:[1,81],134:[1,82],135:[1,83],136:[1,84],137:[1,85]},{1:[2,170],6:[2,170],25:[2,170],26:[2,170],49:[2,170],54:[2,170],57:[2,170],73:[2,170],78:[2,170],86:[2,170],91:[2,170],93:[2,170],102:[2,170],103:87,104:[2,170],105:[1,323],106:[2,170],109:88,110:[2,170],111:69,118:[2,170],126:[2,170],128:[1,80],129:[1,79],132:[1,78],133:[1,81],134:[1,82],135:[1,83],136:[1,84],137:[1,85]},{1:[2,169],6:[2,169],25:[2,169],26:[2,169],49:[2,169],54:[2,169],57:[2,169],73:[2,169],78:[2,169],86:[2,169],91:[2,169],93:[2,169],102:[2,169],103:87,104:[2,169],105:[2,169],106:[2,169],109:88,110:[2,169],111:69,118:[2,169],126:[2,169],128:[1,80],129:[1,79],132:[1,78],133:[1,81],134:[1,82],135:[1,83],136:[1,84],137:[1,85]},{6:[2,94],25:[2,94],26:[2,94],54:[2,94],78:[2,94]},{6:[2,53],25:[2,53],26:[2,53],53:324,54:[1,239]},{26:[1,325],103:87,104:[1,65],106:[1,66],109:88,110:[1,68],111:69,126:[1,86],128:[1,80],129:[1,79],132:[1,78],133:[1,81],134:[1,82],135:[1,83],136:[1,84],137:[1,85]},{6:[1,250],25:[1,251],26:[1,326]},{26:[1,327]},{1:[2,176],6:[2,176],25:[2,176],26:[2,176],49:[2,176],54:[2,176],57:[2,176],73:[2,176],78:[2,176],86:[2,176],91:[2,176],93:[2,176],102:[2,176],104:[2,176],105:[2,176],106:[2,176],110:[2,176],118:[2,176],126:[2,176],128:[2,176],129:[2,176],132:[2,176],133:[2,176],134:[2,176],135:[2,176],136:[2,176],137:[2,176]},{26:[2,180],121:[2,180],123:[2,180]},{25:[2,132],54:[2,132],103:87,104:[1,65],106:[1,66],109:88,110:[1,68],111:69,126:[1,86],128:[1,80],129:[1,79],132:[1,78],133:[1,81],134:[1,82],135:[1,83],136:[1,84],137:[1,85]},{6:[1,272],25:[1,273],26:[1,328]},{8:329,9:118,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,76:[1,70],79:[1,43],83:[1,28],88:[1,58],89:[1,59],90:[1,57],96:[1,38],100:[1,44],101:[1,56],103:39,104:[1,65],106:[1,66],107:40,108:[1,67],109:41,110:[1,68],111:69,119:[1,42],124:37,125:[1,64],127:[1,31],128:[1,32],129:[1,33],130:[1,34],131:[1,35]},{8:330,9:118,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,76:[1,70],79:[1,43],83:[1,28],88:[1,58],89:[1,59],90:[1,57],96:[1,38],100:[1,44],101:[1,56],103:39,104:[1,65],106:[1,66],107:40,108:[1,67],109:41,110:[1,68],111:69,119:[1,42],124:37,125:[1,64],127:[1,31],128:[1,32],129:[1,33],130:[1,34],131:[1,35]},{6:[1,283],25:[1,284],26:[1,331]},{6:[2,41],25:[2,41],26:[2,41],54:[2,41],78:[2,41]},{6:[2,59],25:[2,59],26:[2,59],49:[2,59],54:[2,59]},{1:[2,174],6:[2,174],25:[2,174],26:[2,174],49:[2,174],54:[2,174],57:[2,174],73:[2,174],78:[2,174],86:[2,174],91:[2,174],93:[2,174],102:[2,174],104:[2,174],105:[2,174],106:[2,174],110:[2,174],118:[2,174],126:[2,174],128:[2,174],129:[2,174],132:[2,174],133:[2,174],134:[2,174],135:[2,174],136:[2,174],137:[2,174]},{6:[2,128],25:[2,128],26:[2,128],54:[2,128],86:[2,128],91:[2,128]},{1:[2,171],6:[2,171],25:[2,171],26:[2,171],49:[2,171],54:[2,171],57:[2,171],73:[2,171],78:[2,171],86:[2,171],91:[2,171],93:[2,171],102:[2,171],103:87,104:[2,171],105:[2,171],106:[2,171],109:88,110:[2,171],111:69,118:[2,171],126:[2,171],128:[1,80],129:[1,79],132:[1,78],133:[1,81],134:[1,82],135:[1,83],136:[1,84],137:[1,85]},{1:[2,172],6:[2,172],25:[2,172],26:[2,172],49:[2,172],54:[2,172],57:[2,172],73:[2,172],78:[2,172],86:[2,172],91:[2,172],93:[2,172],102:[2,172],103:87,104:[2,172],105:[2,172],106:[2,172],109:88,110:[2,172],111:69,118:[2,172],126:[2,172],128:[1,80],129:[1,79],132:[1,78],133:[1,81],134:[1,82],135:[1,83],136:[1,84],137:[1,85]},{6:[2,95],25:[2,95],26:[2,95],54:[2,95],78:[2,95]}],defaultActions:{60:[2,51],61:[2,52],75:[2,3],94:[2,109],191:[2,89]},parseError:function(e){throw new Error(e)},parse:function(e){var t=this,i=[0],n=[null],o=[],s=this.table,r="",a=0,l=0,c=0;this.lexer.setInput(e),this.lexer.yy=this.yy,this.yy.lexer=this.lexer,void 0===(this.yy.parser=this).lexer.yylloc&&(this.lexer.yylloc={});var h=this.lexer.yylloc;o.push(h);var u=this.lexer.options&&this.lexer.options.ranges;"function"==typeof this.yy.parseError&&(this.parseError=this.yy.parseError);for(var p,d,m,f,g,y,v,b,_,w={};;){if(m=i[i.length-1],void 0===(f=this.defaultActions[m]||(null==p&&(_=void 0,p=_="number"!=typeof(_=t.lexer.lex()||1)&&t.symbols_[_]||_),s[m]&&s[m][p]))||!f.length||!f[0]){var k;if(!c){for(y in b=[],s[m])this.terminals_[y]&&2<y&&b.push("'"+this.terminals_[y]+"'");k=this.lexer.showPosition?"Parse error on line "+(a+1)+":\n"+this.lexer.showPosition()+"\nExpecting "+b.join(", ")+", got '"+(this.terminals_[p]||p)+"'":"Parse error on line "+(a+1)+": Unexpected "+(1==p?"end of input":"'"+(this.terminals_[p]||p)+"'"),this.parseError(k,{text:this.lexer.match,token:this.terminals_[p]||p,line:this.lexer.yylineno,loc:h,expected:b})}}if(f[0]instanceof Array&&1<f.length)throw new Error("Parse Error: multiple actions possible at state: "+m+", token: "+p);switch(f[0]){case 1:i.push(p),n.push(this.lexer.yytext),o.push(this.lexer.yylloc),i.push(f[1]),p=null,d?(p=d,d=null):(l=this.lexer.yyleng,r=this.lexer.yytext,a=this.lexer.yylineno,h=this.lexer.yylloc,0<c&&c--);break;case 2:if(v=this.productions_[f[1]][1],w.$=n[n.length-v],w._$={first_line:o[o.length-(v||1)].first_line,last_line:o[o.length-1].last_line,first_column:o[o.length-(v||1)].first_column,last_column:o[o.length-1].last_column},u&&(w._$.range=[o[o.length-(v||1)].range[0],o[o.length-1].range[1]]),void 0!==(g=this.performAction.call(w,r,l,a,this.yy,f[1],n,o)))return g;v&&(i=i.slice(0,-2*v),n=n.slice(0,-1*v),o=o.slice(0,-1*v)),i.push(this.productions_[f[1]][0]),n.push(w.$),o.push(w._$),v=s[i[i.length-2]][i[i.length-1]],i.push(v);break;case 3:return!0}}return!0}},_y2=new((az2.prototype=bz2).Parser=az2),void 0!==require&&void 0!==Zy2&&(Zy2.parser=_y2,Zy2.Parser=_y2.Parser,Zy2.parse=function(){return _y2.parse.apply(_y2,arguments)},Zy2.main=function(e){e[1]||(console.log("Usage: "+e[0]+" FILE"),process.exit(1));e=require("fs").readFileSync(require("path").normalize(e[1]),"utf8");return Zy2.parser.parse(e)},void 0!==$y2&&require.main===$y2&&Zy2.main(process.argv.slice(1))),$y2.exports),require["./scope"]=function(){var t={},e=t;return function(){var e;function n(e,t,i){this.parent=e,this.expressions=t,this.method=i,this.variables=[{name:"arguments",type:"arguments"}],this.positions={},this.parent||(n.root=this)}(e=require("./helpers")).extend,e.last,t.Scope=(n.root=null,n.prototype.add=function(e,t,i){return this.shared&&!i?this.parent.add(e,t,i):Object.prototype.hasOwnProperty.call(this.positions,e)?this.variables[this.positions[e]].type=t:this.positions[e]=this.variables.push({name:e,type:t})-1},n.prototype.namedMethod=function(){var e;return null!=(e=this.method)&&e.name||!this.parent?this.method:this.parent.namedMethod()},n.prototype.find=function(e){return!!this.check(e)||(this.add(e,"var"),!1)},n.prototype.parameter=function(e){return this.shared&&this.parent.check(e,!0)?void 0:this.add(e,"param")},n.prototype.check=function(e){var t;return!!(this.type(e)||null!=(t=this.parent)&&t.check(e))},n.prototype.temporary=function(e,t){return 1<e.length?"_"+e+(1<t?t-1:""):"_"+(t+parseInt(e,36)).toString(36).replace(/\d/g,"a")},n.prototype.type=function(e){for(var t,i=this.variables,n=0,o=i.length;n<o;n++)if((t=i[n]).name===e)return t.type;return null},n.prototype.freeVariable=function(e,t){var i,n;for(null==t&&(t=!0),i=0;this.check(n=this.temporary(e,i));)i++;return t&&this.add(n,"var",!0),n},n.prototype.assign=function(e,t){return this.add(e,{value:t,assigned:!0},!0),this.hasAssignments=!0},n.prototype.hasDeclarations=function(){return!!this.declaredVariables().length},n.prototype.declaredVariables=function(){for(var e,t=[],i=[],n=this.variables,o=0,s=n.length;o<s;o++)"var"===(e=n[o]).type&&("_"===e.name.charAt(0)?i:t).push(e.name);return t.sort().concat(i.sort())},n.prototype.assignedVariables=function(){for(var e,t=this.variables,i=[],n=0,o=t.length;n<o;n++)(e=t[n]).type.assigned&&i.push(e.name+" = "+e.type.value);return i},n)}.call(this),e}(),require["./nodes"]=function(){var He={},e=He;return function(){function e(e,t){function i(){this.constructor=e}for(var n in t)ae.call(t,n)&&(e[n]=t[n]);return i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype,e}var k,M,D,x,p,n,d,t,m,u,o,s,S,i,I,r,C,A,a,T,L,f,R,P,l,c,h,E,g,B,F,y,N,U,v,V,b,O,G,_,w,z,H,W,q,j,$,J,Y,K,X,Z,Q,ee,te,ie,ne,oe,se,re,ae={}.hasOwnProperty,le=[].indexOf||function(e){for(var t=0,i=this.length;t<i;t++)if(t in this&&this[t]===e)return t;return-1},ce=[].slice;function he(e,t,i){this.body=t,this.condition="unless"===(i=null==i?{}:i).type?e.invert():e,this.elseBody=null,this.isChain=!1,this.soak=i.soak}function ue(e,t,i){this.subject=e,this.cases=t,this.otherwise=i}function pe(e,t){this.source=t.source,this.guard=t.guard,this.step=t.step,this.name=t.name,this.index=t.index,this.body=x.wrap([e]),this.own=!!t.own,this.object=!!t.object,this.object&&(t=[this.index,this.name],this.name=t[0],this.index=t[1]),this.index instanceof z&&this.index.error("index cannot be a pattern matching expression"),this.range=this.source instanceof z&&this.source.base instanceof y&&!this.source.properties.length,this.pattern=this.name instanceof z,this.range&&this.index&&this.index.error("indexes do not apply to range loops"),this.range&&this.pattern&&this.name.error("cannot pattern match over range loops"),this.own&&!this.object&&this.index.error("cannot use own with for-in"),this.returns=!1}function de(e){this.body=e}function me(e){this.expression=e}function fe(e){this.expression=e}function ge(e,t,i,n){this.attempt=e,this.errorVariable=t,this.recovery=i,this.ensure=n}function ye(e,t){this.object=e,this.array=t}function ve(e,t,i,n){if("in"===e)return new r(t,i);if("do"===e)return this.generateDo(t);if("new"===e){if(t instanceof p&&!t.do&&!t.isNew)return t.newInstance();(t instanceof d&&t.bound||t.do)&&(t=new B(t))}return this.operator=se[e]||e,this.first=t,this.second=i,this.flip=!!n,this}function be(e,t){this.condition=null!=t&&t.invert?e.invert():e,this.guard=null!=t?t.guard:void 0}function _e(e){this.name=e.compile?e:new P(e)}function we(e,t,i){this.name=e,this.value=t,this.splat=i,i=e=this.name.unwrapAll().value,0<=le.call(v,i)&&this.name.error('parameter name "'+e+'" is not allowed')}function ke(e,t,i){this.params=e||[],this.body=t||new x,this.bound="boundfunc"===i,this.bound&&(this.context="_this")}function xe(e,t,i,n){this.variable=e,this.value=t,this.context=i,this.param=n&&n.param,this.subpattern=n&&n.subpattern,n=this.variable.unwrapAll().value,0<=le.call(v,n)&&"object"!==this.context&&this.variable.error('variable name may not be "'+n+'"')}function Se(e,t,i){this.variable=e,this.parent=t,this.body=null!=i?i:new x,this.boundFuncs=[],this.body.classBody=!0}function Ce(e){this.objects=e||[]}function Te(e,t){this.generated=null!=t&&t,this.objects=this.properties=e||[]}function Le(e){this.range=e,Le.__super__.constructor.call(this)}function Me(e,t,i){this.from=e,this.to=t,this.exclusive="exclusive"===i,this.equals=this.exclusive?"":"="}function De(e){this.index=e}function Ie(e,t){this.name=e,this.name.asKey=!0,this.soak="soak"===t}function Ae(e,t){this.child=e,this.parent=t}function Re(e,t,i){this.args=null!=t?t:[],this.soak=i,this.isNew=!1,this.isSuper="super"===e,this.variable=this.isSuper?null:e}function Pe(e){this.comment=e}function Ee(e,t,i){return!t&&e instanceof Ee?e:(this.base=e,this.properties=t||[],i&&(this[i]=!0),this)}function Be(e){e&&!e.unwrap().isUndefined&&(this.expression=e)}function Fe(e){this.val=e}function Ne(){return Ne.__super__.constructor.apply(this,arguments)}function Ue(){return Ue.__super__.constructor.apply(this,arguments)}function Ve(e){this.value=e}function Oe(e){this.expressions=q(J(e||[]))}function Ge(){}function ze(e,t){var i;this.code=""+t,this.locationData=null!=e?e.locationData:void 0,this.type=(null!=e&&null!=(i=e.constructor)?i.name:void 0)||"unknown"}Error.stackTraceLimit=1/0,V=require("./scope").Scope,ne=require("./lexer"),F=ne.RESERVED,v=ne.STRICT_PROSCRIBED,oe=require("./helpers"),q=oe.compact,J=oe.flatten,$=oe.extend,Z=oe.merge,j=oe.del,oe.starts,oe.ends,K=oe.last,oe.some,W=oe.addLocationDataFn,X=oe.locationDataToString,ee=oe.throwSyntaxError,He.extend=$,He.addLocationDataFn=W,H=function(){return!0},c=function(){return!1},_=function(){return this},ne=function(){return this.negated=!this.negated,this},He.CodeFragment=(ze.prototype.toString=function(){return this.code+(this.locationData?": "+X(this.locationData):"")},t=ze),Y=function(n){var o;return function(){for(var e=[],t=0,i=n.length;t<i;t++)o=n[t],e.push(o.code);return e}().join("")},He.Base=(Ge.prototype.compile=function(e,t){return Y(this.compileToFragments(e,t))},Ge.prototype.compileToFragments=function(e,t){return e=$({},e),t&&(e.level=t),(t=this.unfoldSoak(e)||this).tab=e.indent,e.level!==R&&t.isStatement(e)?t.compileClosure(e):t.compileNode(e)},Ge.prototype.compileClosure=function(e){var t;return(t=this.jumps())&&t.error("cannot use a pure statement in an expression"),e.sharedScope=!0,n.wrap(this).compileNode(e)},Ge.prototype.cache=function(e,t,i){var n;return this.isComplex()?(n=new P(i||e.scope.freeVariable("ref")),i=new D(n,this),t?[i.compileToFragments(e,t),[this.makeCode(n.value)]]:[i,n]):[n=t?this.compileToFragments(e,t):this,n]},Ge.prototype.cacheToCodeFragments=function(e){return[Y(e[0]),Y(e[1])]},Ge.prototype.makeReturn=function(e){var t=this.unwrapAll();return e?new p(new P(e+".push"),[t]):new N(t)},Ge.prototype.contains=function(t){var i=void 0;return this.traverseChildren(!1,function(e){return t(e)?(i=e,!1):void 0}),i},Ge.prototype.lastNonComment=function(e){for(var t=e.length;t--;)if(!(e[t]instanceof m))return e[t];return null},Ge.prototype.toString=function(t,e){var i;return null==t&&(t=""),null==e&&(e=this.constructor.name),i="\n"+t+e,this.soak&&(i+="?"),this.eachChild(function(e){return i+=e.toString(t+G)}),i},Ge.prototype.eachChild=function(e){var t,i,n,o,s,r,a;if(!this.children)return this;for(i=0,o=(r=this.children).length;i<o;i++)if(this[t=r[i]])for(n=0,s=(a=J([this[t]])).length;n<s;n++)if(!1===e(a[n]))return this;return this},Ge.prototype.traverseChildren=function(t,i){return this.eachChild(function(e){return!1!==i(e)?e.traverseChildren(t,i):void 0})},Ge.prototype.invert=function(){return new E("!",this)},Ge.prototype.unwrapAll=function(){for(var e=this;e!==(e=e.unwrap()););return e},Ge.prototype.children=[],Ge.prototype.isStatement=c,Ge.prototype.jumps=c,Ge.prototype.isComplex=H,Ge.prototype.isChainable=c,Ge.prototype.isAssignable=c,Ge.prototype.unwrap=_,Ge.prototype.unfoldSoak=c,Ge.prototype.assigns=c,Ge.prototype.updateLocationDataIfMissing=function(t){return this.locationData||(this.locationData=t),this.eachChild(function(e){return e.updateLocationDataIfMissing(t)})},Ge.prototype.error=function(e){return ee(e,this.locationData)},Ge.prototype.makeCode=function(e){return new t(this,e)},Ge.prototype.wrapInBraces=function(e){return[].concat(this.makeCode("("),e,this.makeCode(")"))},Ge.prototype.joinFragmentArrays=function(e,t){for(var i,n,o=[],s=n=0,r=e.length;n<r;s=++n)i=e[s],s&&o.push(this.makeCode(t)),o=o.concat(i);return o},oe=Ge),He.Block=(e(Oe,oe),Oe.prototype.children=["expressions"],Oe.prototype.push=function(e){return this.expressions.push(e),this},Oe.prototype.pop=function(){return this.expressions.pop()},Oe.prototype.unshift=function(e){return this.expressions.unshift(e),this},Oe.prototype.unwrap=function(){return 1===this.expressions.length?this.expressions[0]:this},Oe.prototype.isEmpty=function(){return!this.expressions.length},Oe.prototype.isStatement=function(e){for(var t=this.expressions,i=0,n=t.length;i<n;i++)if(t[i].isStatement(e))return!0;return!1},Oe.prototype.jumps=function(e){for(var t,i=this.expressions,n=0,o=i.length;n<o;n++)if((t=i[n]).jumps(e))return t},Oe.prototype.makeReturn=function(e){for(var t,i=this.expressions.length;i--;)if(!((t=this.expressions[i])instanceof m)){this.expressions[i]=t.makeReturn(e),t instanceof N&&!t.expression&&this.expressions.splice(i,1);break}return this},Oe.prototype.compileToFragments=function(e,t){return(e=null==e?{}:e).scope?Oe.__super__.compileToFragments.call(this,e,t):this.compileRoot(e)},Oe.prototype.compileNode=function(e){var t,i,n,o,s,r,a,l,c;for(this.tab=e.indent,r=e.level===R,i=[],o=a=0,l=(c=this.expressions).length;a<l;o=++a)(s=(s=(s=c[o]).unwrapAll()).unfoldSoak(e)||s)instanceof Oe?i.push(s.compileNode(e)):r?(s.front=!0,n=s.compileToFragments(e),s.isStatement(e)||(n.unshift(this.makeCode(""+this.tab)),n.push(this.makeCode(";"))),i.push(n)):i.push(s.compileToFragments(e,T));return r?this.spaced?[].concat(this.joinFragmentArrays(i,"\n\n"),this.makeCode("\n")):this.joinFragmentArrays(i,"\n"):(t=i.length?this.joinFragmentArrays(i,", "):[this.makeCode("void 0")],1<i.length&&e.level>=T?this.wrapInBraces(t):t)},Oe.prototype.compileRoot=function(e){var o,s,t,i,n,r,a,l,c;for(e.indent=e.bare?"":G,e.level=R,this.spaced=!0,e.scope=new V(null,this,null),a=0,l=(c=e.locals||[]).length;a<l;a++)t=c[a],e.scope.parameter(t);return i=[],e.bare||(n=function(){var e,t,i=this.expressions,n=[];for(s=e=0,t=i.length;e<t&&(o=i[s]).unwrap()instanceof m;s=++e)n.push(o);return n}.call(this),r=this.expressions.slice(n.length),(this.expressions=n).length&&(i=this.compileNode(Z(e,{indent:""}))).push(this.makeCode("\n")),this.expressions=r),r=this.compileWithDeclarations(e),e.bare?r:[].concat(i,this.makeCode("(function() {\n"),r,this.makeCode("\n}).call(this);\n"))},Oe.prototype.compileWithDeclarations=function(e){for(var t,i,n,o,s,r,a=[],l=this.expressions,c=n=0,h=l.length;n<h&&((t=(t=l[c]).unwrap())instanceof m||t instanceof P);c=++n);return e=Z(e,{level:R}),c&&(i=this.expressions.splice(c,9e9),s=(o=[this.spaced,!1])[0],this.spaced=o[1],a=(s=[this.compileNode(e),s])[0],this.spaced=s[1],this.expressions=i),r=this.compileNode(e),(s=e.scope).expressions===this&&(i=e.scope.hasDeclarations(),e=s.hasAssignments,i||e?(c&&a.push(this.makeCode("\n")),a.push(this.makeCode(this.tab+"var ")),i&&a.push(this.makeCode(s.declaredVariables().join(", "))),e&&(i&&a.push(this.makeCode(",\n"+(this.tab+G))),a.push(this.makeCode(s.assignedVariables().join(",\n"+(this.tab+G))))),a.push(this.makeCode(";\n"+(this.spaced?"\n":"")))):a.length&&r.length&&a.push(this.makeCode("\n"))),a.concat(r)},Oe.wrap=function(e){return 1===e.length&&e[0]instanceof Oe?e[0]:new Oe(e)},x=Oe),He.Literal=(e(Ve,oe),Ve.prototype.makeReturn=function(){return this.isStatement()?this:Ve.__super__.makeReturn.apply(this,arguments)},Ve.prototype.isAssignable=function(){return S.test(this.value)},Ve.prototype.isStatement=function(){var e;return"break"===(e=this.value)||"continue"===e||"debugger"===e},Ve.prototype.isComplex=c,Ve.prototype.assigns=function(e){return e===this.value},Ve.prototype.jumps=function(e){return("break"!==this.value||null!=e&&e.loop||null!=e&&e.block)&&("continue"!==this.value||null!=e&&e.loop)?void 0:this},Ve.prototype.compileNode=function(e){var t,e="this"===this.value?null!=(t=e.scope.method)&&t.bound?e.scope.method.context:this.value:this.value.reserved?'"'+this.value+'"':this.value,e=this.isStatement()?""+this.tab+e+";":e;return[this.makeCode(e)]},Ve.prototype.toString=function(){return' "'+this.value+'"'},P=Ve),He.Undefined=(e(Ue,oe),Ue.prototype.isAssignable=c,Ue.prototype.isComplex=c,Ue.prototype.compileNode=function(e){return[this.makeCode(e.level>=A?"(void 0)":"void 0")]},Ue),He.Null=(e(Ne,oe),Ne.prototype.isAssignable=c,Ne.prototype.isComplex=c,Ne.prototype.compileNode=function(){return[this.makeCode("null")]},Ne),He.Bool=(e(Fe,oe),Fe.prototype.isAssignable=c,Fe.prototype.isComplex=c,Fe.prototype.compileNode=function(){return[this.makeCode(this.val)]},Fe),He.Return=(e(Be,oe),Be.prototype.children=["expression"],Be.prototype.isStatement=H,Be.prototype.makeReturn=_,Be.prototype.jumps=_,Be.prototype.compileToFragments=function(e,t){var i=null!=(i=this.expression)?i.makeReturn():void 0;return!i||i instanceof Be?Be.__super__.compileToFragments.call(this,e,t):i.compileToFragments(e,t)},Be.prototype.compileNode=function(e){var t=[];return t.push(this.makeCode(this.tab+("return"+(this.expression?" ":"")))),(t=this.expression?t.concat(this.expression.compileToFragments(e,f)):t).push(this.makeCode(";")),t},N=Be),He.Value=(e(Ee,oe),Ee.prototype.children=["base","properties"],Ee.prototype.add=function(e){return this.properties=this.properties.concat(e),this},Ee.prototype.hasProperties=function(){return!!this.properties.length},Ee.prototype.isArray=function(){return!this.properties.length&&this.base instanceof M},Ee.prototype.isComplex=function(){return this.hasProperties()||this.base.isComplex()},Ee.prototype.isAssignable=function(){return this.hasProperties()||this.base.isAssignable()},Ee.prototype.isSimpleNumber=function(){return this.base instanceof P&&U.test(this.base.value)},Ee.prototype.isString=function(){return this.base instanceof P&&i.test(this.base.value)},Ee.prototype.isAtomic=function(){for(var e,t=this.properties.concat(this.base),i=0,n=t.length;i<n;i++)if((e=t[i]).soak||e instanceof p)return!1;return!0},Ee.prototype.isStatement=function(e){return!this.properties.length&&this.base.isStatement(e)},Ee.prototype.assigns=function(e){return!this.properties.length&&this.base.assigns(e)},Ee.prototype.jumps=function(e){return!this.properties.length&&this.base.jumps(e)},Ee.prototype.isObject=function(e){return!this.properties.length&&(this.base instanceof h&&(!e||this.base.generated))},Ee.prototype.isSplice=function(){return K(this.properties)instanceof b},Ee.prototype.unwrap=function(){return this.properties.length?this:this.base},Ee.prototype.cacheReference=function(e){var t,i,n,o=K(this.properties);return!(this.properties.length<2)||this.base.isComplex()||null!=o&&o.isComplex()?((t=new Ee(this.base,this.properties.slice(0,-1))).isComplex()&&(i=new P(e.scope.freeVariable("base")),t=new Ee(new B(new D(i,t)))),o?(o.isComplex()&&(n=new P(e.scope.freeVariable("name")),o=new C(new D(n,o.index)),n=new C(n)),[t.add(o),new Ee(i||t.base,[n||o])]):[t,i]):[this,this]},Ee.prototype.compileNode=function(e){var t,i,n,o,s;for(this.base.front=this.front,n=this.properties,t=this.base.compileToFragments(e,n.length?A:null),(this.base instanceof B||n.length)&&U.test(Y(t))&&t.push(this.makeCode(".")),o=0,s=n.length;o<s;o++)i=n[o],t.push.apply(t,i.compileToFragments(e));return t},Ee.prototype.unfoldSoak=function(c){var h=this;return null!=this.unfoldedSoak?this.unfoldedSoak:this.unfoldedSoak=function(){var e,t,i,n,o,s,r,a,l;if(i=h.base.unfoldSoak(c))return(a=i.body.properties).push.apply(a,h.properties),i;for(t=s=0,r=(l=h.properties).length;s<r;t=++s)if((n=l[t]).soak)return n.soak=!1,e=new Ee(h.base,h.properties.slice(0,t)),o=new Ee(h.base,h.properties.slice(t)),e.isComplex()&&(n=new P(c.scope.freeVariable("ref")),e=new B(new D(n,e)),o.base=n),new I(new u(e),o,{soak:!0});return!1}()},z=Ee),He.Comment=(e(Pe,oe),Pe.prototype.isStatement=H,Pe.prototype.makeReturn=_,Pe.prototype.compileNode=function(e,t){var i="/*"+Q(this.comment,this.tab)+(0<=le.call(this.comment,"\n")?"\n"+this.tab:"")+"*/\n";return(t||e.level)===R&&(i=e.indent+i),[this.makeCode(i)]},m=Pe),He.Call=(e(Re,oe),Re.prototype.children=["variable","args"],Re.prototype.newInstance=function(){var e=(null!=(e=this.variable)?e.base:void 0)||this.variable;return e instanceof Re&&!e.isNew?e.newInstance():this.isNew=!0,this},Re.prototype.superReference=function(e){var t,i=e.scope.namedMethod();return null!=i&&i.klass?(t=[new k(new P("__super__"))],i.static&&t.push(new k(new P("constructor"))),t.push(new k(new P(i.name))),new z(new P(i.klass),t).compile(e)):null!=i&&i.ctor?i.name+".__super__.constructor":this.error("cannot call super outside of an instance method.")},Re.prototype.superThis=function(e){e=e.scope.method;return e&&!e.klass&&e.context||"this"},Re.prototype.unfoldSoak=function(e){var t,i,n,o,s,r,a,l;if(this.soak){if(this.variable){if(i=te(e,this,"variable"))return i;n=(a=new z(this.variable).cacheReference(e))[0],a=a[1]}else n=new P(this.superReference(e)),a=new z(n);return(a=new Re(a,this.args)).isNew=this.isNew,n=new P("typeof "+n.compile(e)+' === "function"'),new I(n,new z(a),{soak:!0})}for(t=this,o=[];;)if(t.variable instanceof Re)o.push(t),t=t.variable;else{if(!(t.variable instanceof z))break;if(o.push(t),!((t=t.variable.base)instanceof Re))break}for(s=0,r=(l=o.reverse()).length;s<r;s++)t=l[s],i&&(t.variable instanceof Re?t.variable=i:t.variable.base=i),i=te(e,t,"variable");return i},Re.prototype.compileNode=function(e){var t,i,n,o,s,r,a,l;if(null!=(a=this.variable)&&(a.front=this.front),(o=O.compileSplattedArray(e,this.args,!0)).length)return this.compileSplat(e,o);for(n=[],i=s=0,r=(l=this.args).length;s<r;i=++s)t=l[i],i&&n.push(this.makeCode(", ")),n.push.apply(n,t.compileToFragments(e,T));return a=[],this.isSuper?(o=this.superReference(e)+(".call("+this.superThis(e)),n.length&&(o+=", "),a.push(this.makeCode(o))):(this.isNew&&a.push(this.makeCode("new ")),a.push.apply(a,this.variable.compileToFragments(e,A)),a.push(this.makeCode("("))),a.push.apply(a,n),a.push(this.makeCode(")")),a},Re.prototype.compileSplat=function(e,t){var i,n,o,s;return this.isSuper?[].concat(this.makeCode(this.superReference(e)+".apply("+this.superThis(e)+", "),t,this.makeCode(")")):this.isNew?(o=this.tab+G,[].concat(this.makeCode("(function(func, args, ctor) {\n"+o+"ctor.prototype = func.prototype;\n"+o+"var child = new ctor, result = func.apply(child, args);\n"+o+"return Object(result) === result ? result : child;\n"+this.tab+"})("),this.variable.compileToFragments(e,T),this.makeCode(", "),t,this.makeCode(", function(){})"))):(i=[],(i=(o=(n=new z(this.variable)).properties.pop())&&n.isComplex()?(s=e.scope.freeVariable("ref"),i.concat(this.makeCode("("+s+" = "),n.compileToFragments(e,T),this.makeCode(")"),o.compileToFragments(e))):(n=n.compileToFragments(e,A),U.test(Y(n))&&(n=this.wrapInBraces(n)),o?(s=Y(n),n.push.apply(n,o.compileToFragments(e))):s="null",i.concat(n))).concat(this.makeCode(".apply("+s+", "),t,this.makeCode(")")))},p=Re),He.Extends=(e(Ae,oe),Ae.prototype.children=["child","parent"],Ae.prototype.compileToFragments=function(e){return new p(new z(new P(ie("extends"))),[this.child,this.parent]).compileToFragments(e)},o=Ae),He.Access=(e(Ie,oe),Ie.prototype.children=["name"],Ie.prototype.compileToFragments=function(e){e=this.name.compileToFragments(e);return S.test(Y(e))?e.unshift(this.makeCode(".")):(e.unshift(this.makeCode("[")),e.push(this.makeCode("]"))),e},Ie.prototype.isComplex=c,k=Ie),He.Index=(e(De,oe),De.prototype.children=["index"],De.prototype.compileToFragments=function(e){return[].concat(this.makeCode("["),this.index.compileToFragments(e,f),this.makeCode("]"))},De.prototype.isComplex=function(){return this.index.isComplex()},C=De),He.Range=(e(Me,oe),Me.prototype.children=["from","to"],Me.prototype.compileVariables=function(e){var t,i;return e=Z(e,{top:!0}),t=this.cacheToCodeFragments(this.from.cache(e,T)),this.fromC=t[0],this.fromVar=t[1],t=this.cacheToCodeFragments(this.to.cache(e,T)),this.toC=t[0],this.toVar=t[1],(t=j(e,"step"))&&(i=this.cacheToCodeFragments(t.cache(e,T)),this.step=i[0],this.stepVar=i[1]),i=[this.fromVar.match(U),this.toVar.match(U)],this.fromNum=i[0],this.toNum=i[1],this.stepVar?this.stepNum=this.stepVar.match(U):void 0},Me.prototype.compileNode=function(e){var t,i,n,o,s,r,a,l,c,h;return this.fromVar||this.compileVariables(e),e.index?(o=this.fromNum&&this.toNum,a=j(e,"index"),r=(n=j(e,"name"))&&n!==a,l=a+" = "+this.fromC,this.toC!==this.toVar&&(l+=", "+this.toC),this.step!==this.stepVar&&(l+=", "+this.step),s=(c=[a+" <"+this.equals,a+" >"+this.equals])[0],c=c[1],c=this.stepNum?0<+this.stepNum?s+" "+this.toVar:c+" "+this.toVar:o?(i=(h=[+this.fromNum,+this.toNum])[0])<=(h=h[1])?s+" "+h:c+" "+h:(t=this.stepVar?this.stepVar+" > 0":this.fromVar+" <= "+this.toVar)+" ? "+s+" "+this.toVar+" : "+c+" "+this.toVar,a=this.stepVar?a+" += "+this.stepVar:o?r?i<=h?"++"+a:"--"+a:i<=h?a+"++":a+"--":r?t+" ? ++"+a+" : --"+a:t+" ? "+a+"++ : "+a+"--",[this.makeCode((l=r?n+" = "+l:l)+"; "+c+"; "+(a=r?n+" = "+a:a))]):this.compileArray(e)},Me.prototype.compileArray=function(e){var t,i,n,o,s,r,a,l;return this.fromNum&&this.toNum&&Math.abs(this.fromNum-this.toNum)<=20?(s=function(){l=[];for(var e=a=+this.fromNum,t=+this.toNum;a<=t?e<=t:t<=e;a<=t?e++:e--)l.push(e);return l}.apply(this),this.exclusive&&s.pop(),[this.makeCode("["+s.join(", ")+"]")]):(o=this.tab+G,n=e.scope.freeVariable("i"),s="\n"+o+(r=e.scope.freeVariable("results"))+" = [];",i=this.fromNum&&this.toNum?(e.index=n,Y(this.compileNode(e))):"var "+(n+" = "+this.fromC+(this.toC!==this.toVar?", "+this.toC:""))+"; "+(i=this.fromVar+" <= "+this.toVar)+" ? "+n+" <"+this.equals+" "+this.toVar+" : "+n+" >"+this.equals+" "+this.toVar+"; "+i+" ? "+n+"++ : "+n+"--",r="{ "+r+".push("+n+"); }\n"+o+"return "+r+";\n"+e.indent,((e=function(e){return null!=e?e.contains(function(e){return e instanceof P&&"arguments"===e.value&&!e.asKey}):void 0})(this.from)||e(this.to))&&(t=", arguments"),[this.makeCode("(function() {"+s+"\n"+o+"for ("+i+")"+r+"}).apply(this"+(null!=t?t:"")+")")])},y=Me),He.Slice=(e(Le,oe),Le.prototype.children=["range"],Le.prototype.compileNode=function(e){var t,i=this.range,n=i.to,o=i.from,s=o&&o.compileToFragments(e,f)||[this.makeCode("0")];return n&&(i=n.compileToFragments(e,f),o=Y(i),!this.range.exclusive&&-1==+o||(t=", "+(this.range.exclusive?o:U.test(o)?""+(+o+1):(i=n.compileToFragments(e,A),"+"+Y(i)+" + 1 || 9e9")))),[this.makeCode(".slice("+Y(s)+(t||"")+")")]},b=Le),He.Obj=(e(Te,oe),Te.prototype.children=["properties"],Te.prototype.compileNode=function(e){var t,i,n,o,s,r,a,l,c,h,u,p,d=this.properties;if(!d.length)return[this.makeCode(this.front?"({})":"{}")];if(this.generated)for(c=0,u=d.length;c<u;c++)(a=d[c])instanceof z&&a.error("cannot have an implicit value in an implicit object");for(n=e.indent+=G,r=this.lastNonComment(this.properties),t=[],i=h=0,p=d.length;h<p;i=++h)l=d[i],s=i===d.length-1?"":l===r||l instanceof m?"\n":",\n",o=l instanceof m?"":n,l instanceof D&&l.variable instanceof z&&l.variable.hasProperties()&&l.variable.error("Invalid object key"),(l=l instanceof z&&l.this?new D(l.properties[0].name,l,"object"):l)instanceof m||(((l=!(l instanceof D)?new D(l,l,"object"):l).variable.base||l.variable).asKey=!0),o&&t.push(this.makeCode(o)),t.push.apply(t,l.compileToFragments(e,R)),s&&t.push(this.makeCode(s));return t.unshift(this.makeCode("{"+(d.length&&"\n"))),t.push(this.makeCode((d.length&&"\n"+this.tab)+"}")),this.front?this.wrapInBraces(t):t},Te.prototype.assigns=function(e){for(var t=this.properties,i=0,n=t.length;i<n;i++)if(t[i].assigns(e))return!0;return!1},h=Te),He.Arr=(e(Ce,oe),Ce.prototype.children=["objects"],Ce.prototype.compileNode=function(o){var e,t,i,n,s,r,a;if(!this.objects.length)return[this.makeCode("[]")];if(o.indent+=G,(e=O.compileSplattedArray(o,this.objects)).length)return e;for(e=[],n=r=0,a=(t=function(){for(var e=this.objects,t=[],i=0,n=e.length;i<n;i++)s=e[i],t.push(s.compileToFragments(o,T));return t}.call(this)).length;r<a;n=++r)i=t[n],n&&e.push(this.makeCode(", ")),e.push.apply(e,i);return 0<=Y(e).indexOf("\n")?(e.unshift(this.makeCode("[\n"+o.indent)),e.push(this.makeCode("\n"+this.tab+"]"))):(e.unshift(this.makeCode("[")),e.push(this.makeCode("]"))),e},Ce.prototype.assigns=function(e){for(var t=this.objects,i=0,n=t.length;i<n;i++)if(t[i].assigns(e))return!0;return!1},M=Ce),He.Class=(e(Se,oe),Se.prototype.children=["variable","parent","body"],Se.prototype.determineName=function(){var e;return this.variable?(e=(e=K(this.variable.properties))?e instanceof k&&e.name.value:this.variable.base.value,0<=le.call(v,e)&&this.variable.error("class variable name may not be "+e),e&&S.test(e)&&e):null},Se.prototype.setContext=function(t){return this.body.traverseChildren(!1,function(e){return!e.classBody&&(e instanceof P&&"this"===e.value?e.value=t:e instanceof d&&(e.klass=t,e.bound)?e.context=t:void 0)})},Se.prototype.addBoundFunctions=function(e){for(var t,i=this.boundFuncs,n=0,o=i.length;n<o;n++)t=i[n],t=new z(new P("this"),[new k(t)]).compile(e),this.ctor.body.unshift(new P(t+" = "+ie("bind")+"("+t+", this)"))},Se.prototype.addProperties=function(e,t,i){var n,o,s,r=e.base.properties.slice(0),e=function(){for(var e=[];n=r.shift();)n instanceof D&&(o=n.variable.base,delete n.context,s=n.value,"constructor"===o.value?(this.ctor&&n.error("cannot define more than one constructor in a class"),s.bound&&n.error("cannot define a constructor as a bound function"),n=s instanceof d?this.ctor=s:(this.externalCtor=i.scope.freeVariable("class"),new D(new P(this.externalCtor),s))):n.variable.this?(s.static=!0,s.bound&&(s.context=t)):(n.variable=new z(new P(t),[new k(new P("prototype")),new k(o)]),s instanceof d&&s.bound&&(this.boundFuncs.push(o),s.bound=!1))),e.push(n);return e}.call(this);return q(e)},Se.prototype.walkBody=function(l,c){var h=this;return this.traverseChildren(!1,function(e){var t,i,n,o,s,r,a=!0;if(e instanceof Se)return!1;if(e instanceof x){for(i=o=0,s=(r=t=e.expressions).length;o<s;i=++o)(n=r[i])instanceof z&&n.isObject(!0)&&(a=!1,t[i]=h.addProperties(n,l,c));e.expressions=t=J(t)}return a&&!(e instanceof Se)})},Se.prototype.hoistDirectivePrologue=function(){for(var e,t=0,i=this.body.expressions;(e=i[t])&&e instanceof m||e instanceof z&&e.isString();)++t;return this.directives=i.splice(0,t)},Se.prototype.ensureConstructor=function(e,t){var i,n,o=!this.ctor;return this.ctor||(this.ctor=new d),this.ctor.ctor=this.ctor.name=e,this.ctor.klass=null,this.ctor.noReturn=!0,o?(this.parent&&(n=new P(e+".__super__.constructor.apply(this, arguments)")),(n=this.externalCtor?new P(this.externalCtor+".apply(this, arguments)"):n)&&(i=new P(t.scope.freeVariable("ref")),this.ctor.body.unshift(new D(i,n))),this.addBoundFunctions(t),n&&(this.ctor.body.push(i),this.ctor.body.makeReturn()),this.body.expressions.unshift(this.ctor)):this.addBoundFunctions(t)},Se.prototype.compileNode=function(e){var t,i=this.determineName()||"_Class";return i.reserved&&(i="_"+i),t=new P(i),this.hoistDirectivePrologue(),this.setContext(i),this.walkBody(i,e),this.ensureConstructor(i,e),this.body.spaced=!0,this.ctor instanceof d||this.body.expressions.unshift(this.ctor),this.body.expressions.push(t),(i=this.body.expressions).unshift.apply(i,this.directives),i=n.wrap(this.body),this.parent&&(this.superClass=new P(e.scope.freeVariable("super",!1)),this.body.expressions.unshift(new o(t,this.superClass)),i.args.push(this.parent),(i.variable.params||i.variable.base.params).push(new g(this.superClass))),i=new B(i,!0),(i=this.variable?new D(this.variable,i):i).compileToFragments(e)},Se),He.Assign=(e(xe,oe),xe.prototype.children=["variable","value"],xe.prototype.isStatement=function(e){return(null!=e?e.level:void 0)===R&&null!=this.context&&0<=le.call(this.context,"?")},xe.prototype.assigns=function(e){return this["object"===this.context?"value":"variable"].assigns(e)},xe.prototype.unfoldSoak=function(e){return te(e,this,"variable")},xe.prototype.compileNode=function(e){var t,i,n,o;if(this.variable instanceof z){if(this.variable.isArray()||this.variable.isObject())return this.compilePatternMatch(e);if(this.variable.isSplice())return this.compileSplice(e);if("||="===(n=this.context)||"&&="===n||"?="===n)return this.compileConditional(e)}return t=this.variable.compileToFragments(e,T),o=Y(t),this.context||((n=this.variable.unwrapAll()).isAssignable()||this.variable.error('"'+this.variable.compile(e)+'" cannot be assigned'),"function"==typeof n.hasProperties&&n.hasProperties()||(this.param?e.scope.add(o,"var"):e.scope.find(o))),this.value instanceof d&&(i=l.exec(o))&&(i[1]&&(this.value.klass=i[1]),this.value.name=null!=(o=null!=(o=null!=(o=i[2])?o:i[3])?o:i[4])?o:i[5]),i=this.value.compileToFragments(e,T),"object"===this.context?t.concat(this.makeCode(": "),i):(i=t.concat(this.makeCode(" "+(this.context||"=")+" "),i),e.level<=T?i:this.wrapInBraces(i))},xe.prototype.compilePatternMatch=function(e){var t,i,n,o,s,r,a,l,c,h,u,p,d,m,f,g,y,v,b=e.level===R,_=this.value,w=this.variable.base.objects;if(!(h=w.length))return n=_.compileToFragments(e),e.level>=L?this.wrapInBraces(n):n;if(r=this.variable.isObject(),b&&1===h&&!((c=w[0])instanceof O))return c instanceof xe?(s=(g=c).variable.base,c=g.value):s=r?c.this?c.properties[0].name:c:new P(0),t=S.test(s.unwrap().value||0),(_=new z(_)).properties.push(new(t?k:C)(s)),g=c.unwrap().value,0<=le.call(F,g)&&c.error("assignment to a reserved word: "+c.compile(e)),new xe(c,_,null,{param:this.param}).compileToFragments(e,R);for(g=_.compileToFragments(e,T),d=Y(g),u=!(i=[]),S.test(d)&&!this.variable.assigns(d)||(i.push([this.makeCode((_=e.scope.freeVariable("ref"))+" = ")].concat(ce.call(g))),g=[this.makeCode(_)],d=_),o=m=0,f=w.length;m<f;o=++m)c=w[o],s=o,r&&(c instanceof xe?(s=(y=c).variable.base,c=y.value):s=c.base instanceof B?(c=(v=new z(c.unwrapAll()).cacheReference(e))[0],v[1]):c.this?c.properties[0].name:c),!u&&c instanceof O?(l=c.name.unwrap().value,c=c.unwrap(),p=h+" <= "+d+".length ? "+ie("slice")+".call("+d+", "+o,(v=h-o-1)?p+=", "+(a=e.scope.freeVariable("i"))+" = "+d+".length - "+v+") : ("+a+" = "+o+", [])":p+=") : []",p=new P(p),u=a+"++"):(l=c.unwrap().value,c instanceof O&&c.error("multiple splats are disallowed in an assignment"),t="number"==typeof s?(s=new P(u||s),!1):r&&S.test(s.unwrap().value||0),p=new z(new P(d),[new(t?k:C)(s)])),null!=l&&0<=le.call(F,l)&&c.error("assignment to a reserved word: "+c.compile(e)),i.push(new xe(c,p,null,{param:this.param,subpattern:!0}).compileToFragments(e,T));return b||this.subpattern||i.push(g),g=this.joinFragmentArrays(i,", "),e.level<T?g:this.wrapInBraces(g)},xe.prototype.compileConditional=function(e){var t=this.variable.cacheReference(e),i=t[0],t=t[1];return!i.properties.length&&i.base instanceof P&&"this"!==i.base.value&&!e.scope.check(i.base.value)&&this.variable.error('the variable "'+i.base.value+"\" can't be assigned with "+this.context+" because it has not been declared before"),0<=le.call(this.context,"?")&&(e.isExistentialEquals=!0),new E(this.context.slice(0,-1),i,new xe(t,this.value,"=")).compileToFragments(e)},xe.prototype.compileSplice=function(e){var t,i,n=this.variable.properties.pop().range,o=n.from,s=n.to,r=n.exclusive,n=this.variable.compile(e);return o?(t=(i=this.cacheToCodeFragments(o.cache(e,L)))[0],i=i[1]):t=i="0",s?null!=o&&o.isSimpleNumber()&&s.isSimpleNumber()?(s=+s.compile(e)-+i,r||(s+=1)):(s=s.compile(e,A)+" - "+i,r||(s+=" + 1")):s="9e9",r=(i=this.value.cache(e,T))[0],i=i[1],i=[].concat(this.makeCode("[].splice.apply("+n+", ["+t+", "+s+"].concat("),r,this.makeCode(")), "),i),e.level>R?this.wrapInBraces(i):i},D=xe),He.Code=(e(ke,oe),ke.prototype.children=["params","body"],ke.prototype.isStatement=function(){return!!this.ctor},ke.prototype.jumps=c,ke.prototype.compileNode=function(o){var e,t,i,n,s,r,a,l,c,h,u,p,d,m,f,g,y,v,b,_,w,k,x,S,C,T,L;for(o.scope=new V(o.scope,this.body,this),o.scope.shared=j(o,"sharedScope"),o.indent+=G,delete o.bare,delete o.isExistentialEquals,a=[],t=[],this.eachParamName(function(e){return o.scope.check(e)?void 0:o.scope.parameter(e)}),d=0,y=(x=this.params).length;d<y;d++)if((r=x[d]).splat){for(m=0,v=(S=this.params).length;m<v;m++)(s=(s=S[m].name).this?s.properties[0].name:s).value&&o.scope.add(s.value,"var",!0);c=new D(new z(new M(function(){for(var e=this.params,t=[],i=0,n=e.length;i<n;i++)s=e[i],t.push(s.asReference(o));return t}.call(this))),new z(new P("arguments")));break}for(f=0,b=(C=this.params).length;f<b;f++)(r=C[f]).isComplex()?(u=l=r.asReference(o),r.value&&(u=new E("?",l,r.value)),t.push(new D(new z(r.name),u,"=",{param:!0}))):(l=r).value&&(n=new P(l.name.value+" == null"),u=new D(new z(r.name),r.value,"="),t.push(new I(n,u))),c||a.push(l);for(p=this.body.isEmpty(),c&&t.unshift(c),t.length&&(T=this.body.expressions).unshift.apply(T,t),i=g=0,_=a.length;g<_;i=++g)s=a[i],a[i]=s.compileToFragments(o),o.scope.parameter(Y(a[i]));for(h=[],this.eachParamName(function(e,t){return 0<=le.call(h,e)&&t.error("multiple parameters named '"+e+"'"),h.push(e)}),p||this.noReturn||this.body.makeReturn(),this.bound&&(null!=(L=o.scope.parent.method)&&L.bound?this.bound=this.context=o.scope.parent.method.context:this.static||o.scope.parent.assign("_this","this")),o.indent,L="function",this.ctor&&(L+=" "+this.name),e=[this.makeCode(L+="(")],i=k=0,w=a.length;k<w;i=++k)s=a[i],i&&e.push(this.makeCode(", ")),e.push.apply(e,s);return e.push(this.makeCode(") {")),(e=!this.body.isEmpty()?e.concat(this.makeCode("\n"),this.body.compileWithDeclarations(o),this.makeCode("\n"+this.tab)):e).push(this.makeCode("}")),this.ctor?[this.makeCode(this.tab)].concat(ce.call(e)):this.front||o.level>=A?this.wrapInBraces(e):e},ke.prototype.eachParamName=function(e){for(var t,i=this.params,n=[],o=0,s=i.length;o<s;o++)t=i[o],n.push(t.eachName(e));return n},ke.prototype.traverseChildren=function(e,t){return e?ke.__super__.traverseChildren.call(this,e,t):void 0},d=ke),He.Param=(e(we,oe),we.prototype.children=["name","value"],we.prototype.compileToFragments=function(e){return this.name.compileToFragments(e,T)},we.prototype.asReference=function(e){var t;return this.reference||((t=this.name).this?(t=t.properties[0].name).value.reserved&&(t=new P(e.scope.freeVariable(t.value))):t.isComplex()&&(t=new P(e.scope.freeVariable("arg"))),t=new z(t),this.splat&&(t=new O(t)),this.reference=t)},we.prototype.isComplex=function(){return this.name.isComplex()},we.prototype.eachName=function(t,e){var i,n,o,s,r,a=function(e){e=e.properties[0].name;return e.value.reserved?void 0:t(e.value,e)};if((e=null==e?this.name:e)instanceof P)return t(e.value,e);if(e instanceof z)return a(e);for(o=0,s=(r=e.objects).length;o<s;o++)(n=r[o])instanceof D?this.eachName(t,n.value.unwrap()):n instanceof O?(i=n.name.unwrap(),t(i.value,i)):n instanceof z?n.isArray()||n.isObject()?this.eachName(t,n.base):n.this?a(n):t(n.base.value,n.base):n.error("illegal parameter "+n.compile())},g=we),He.Splat=(e(_e,oe),_e.prototype.children=["name"],_e.prototype.isAssignable=H,_e.prototype.assigns=function(e){return this.name.assigns(e)},_e.prototype.compileToFragments=function(e){return this.name.compileToFragments(e)},_e.prototype.unwrap=function(){return this.name},_e.compileSplattedArray=function(o,s,e){for(var t,i,n,r,a,l,c,h,u=-1;(l=s[++u])&&!(l instanceof _e););if(u>=s.length)return[];if(1===s.length)return r=(l=s[0]).compileToFragments(o,T),e?r:[].concat(l.makeCode(ie("slice")+".call("),r,l.makeCode(")"));for(a=c=0,h=(t=s.slice(u)).length;c<h;a=++c)i=(l=t[a]).compileToFragments(o,T),t[a]=l instanceof _e?[].concat(l.makeCode(ie("slice")+".call("),i,l.makeCode(")")):[].concat(l.makeCode("["),i,l.makeCode("]"));return 0===u?(n=(l=s[0]).joinFragmentArrays(t.slice(1),", "),t[0].concat(l.makeCode(".concat("),n,l.makeCode(")"))):(r=function(){for(var e=s.slice(0,u),t=[],i=0,n=e.length;i<n;i++)l=e[i],t.push(l.compileToFragments(o,T));return t}(),r=s[0].joinFragmentArrays(r,", "),n=s[u].joinFragmentArrays(t,", "),[].concat(s[0].makeCode("["),r,s[u].makeCode("].concat("),n,K(s).makeCode(")")))},O=_e),He.While=(e(be,oe),be.prototype.children=["condition","guard","body"],be.prototype.isStatement=H,be.prototype.makeReturn=function(e){return e?be.__super__.makeReturn.apply(this,arguments):(this.returns=!this.jumps({loop:!0}),this)},be.prototype.addBody=function(e){return this.body=e,this},be.prototype.jumps=function(){var e,t,i,n=this.body.expressions;if(!n.length)return!1;for(t=0,i=n.length;t<i;t++)if((e=n[t]).jumps({loop:!0}))return e;return!1},be.prototype.compileNode=function(e){var t,i,n;return e.indent+=G,n="",t=(t=this.body).isEmpty()?this.makeCode(""):(this.returns&&(t.makeReturn(i=e.scope.freeVariable("results")),n=""+this.tab+i+" = [];\n"),this.guard&&(1<t.expressions.length?t.expressions.unshift(new I(new B(this.guard).invert(),new P("continue"))):this.guard&&(t=x.wrap([new I(this.guard,t)]))),[].concat(this.makeCode("\n"),t.compileToFragments(e,R),this.makeCode("\n"+this.tab))),t=[].concat(this.makeCode(n+this.tab+"while ("),this.condition.compileToFragments(e,f),this.makeCode(") {"),t,this.makeCode("}")),this.returns&&t.push(this.makeCode("\n"+this.tab+"return "+i+";")),t},W=be),He.Op=(e(ve,oe),se={"==":"===","!=":"!==",of:"in"},re={"!==":"===","===":"!=="},ve.prototype.children=["first","second"],ve.prototype.isSimpleNumber=c,ve.prototype.isUnary=function(){return!this.second},ve.prototype.isComplex=function(){var e;return!(this.isUnary()&&("+"===(e=this.operator)||"-"===e))||this.first.isComplex()},ve.prototype.isChainable=function(){var e;return"<"===(e=this.operator)||">"===e||">="===e||"<="===e||"==="===e||"!=="===e},ve.prototype.invert=function(){var e,t,i,n;if(this.isChainable()&&this.first.isChainable()){for(e=!0,t=this;t&&t.operator;)e=e&&t.operator in re,t=t.first;if(!e)return new B(this).invert();for(t=this;t&&t.operator;)t.invert=!t.invert,t.operator=re[t.operator],t=t.first;return this}return(n=re[this.operator])?(this.operator=n,this.first.unwrap()instanceof ve&&this.first.invert(),this):this.second?new B(this).invert():"!"===this.operator&&(i=this.first.unwrap())instanceof ve&&("!"===(n=i.operator)||"in"===n||"instanceof"===n)?i:new ve("!",this)},ve.prototype.unfoldSoak=function(e){var t;return("++"===(t=this.operator)||"--"===t||"delete"===t)&&te(e,this,"first")},ve.prototype.generateDo=function(e){for(var t,i,n=[],o=(e instanceof D&&(i=e.value.unwrap())instanceof d?i:e).params||[],s=0,r=o.length;s<r;s++)(t=o[s]).value?(n.push(t.value),delete t.value):n.push(t);return(e=new p(e,n)).do=!0,e},ve.prototype.compileNode=function(e){var t,i=this.isChainable()&&this.first.isChainable();return i||(this.first.front=this.front),"delete"===this.operator&&e.scope.check(this.first.unwrapAll().value)&&this.error("delete operand may not be argument or var"),("--"===(t=this.operator)||"++"===t)&&(t=this.first.unwrapAll().value,0<=le.call(v,t))&&this.error('cannot increment/decrement "'+this.first.unwrapAll().value+'"'),this.isUnary()?this.compileUnary(e):i?this.compileChain(e):"?"===this.operator?this.compileExistence(e):(i=[].concat(this.first.compileToFragments(e,L),this.makeCode(" "+this.operator+" "),this.second.compileToFragments(e,L)),e.level<=L?i:this.wrapInBraces(i))},ve.prototype.compileChain=function(e){var t=this.first.second.cache(e);return this.first.second=t[0],t=t[1],e=this.first.compileToFragments(e,L).concat(this.makeCode(" "+(this.invert?"&&":"||")+" "),t.compileToFragments(e),this.makeCode(" "+this.operator+" "),this.second.compileToFragments(e,L)),this.wrapInBraces(e)},ve.prototype.compileExistence=function(e){var t,i;return!e.isExistentialEquals&&this.first.isComplex()?(i=new P(e.scope.freeVariable("ref")),t=new B(new D(i,this.first))):i=t=this.first,new I(new u(t),i,{type:"if"}).addElse(this.second).compileToFragments(e)},ve.prototype.compileUnary=function(e){var t,i=[],n=this.operator;return i.push([this.makeCode(n)]),"!"===n&&this.first instanceof u?(this.first.negated=!this.first.negated,this.first.compileToFragments(e)):e.level>=A?new B(this).compileToFragments(e):(t="+"===n||"-"===n,("new"===n||"typeof"===n||"delete"===n||t&&this.first instanceof ve&&this.first.operator===n)&&i.push([this.makeCode(" ")]),(t&&this.first instanceof ve||"new"===n&&this.first.isStatement(e))&&(this.first=new B(this.first)),i.push(this.first.compileToFragments(e,L)),this.flip&&i.reverse(),this.joinFragmentArrays(i,""))},ve.prototype.toString=function(e){return ve.__super__.toString.call(this,e,this.constructor.name+" "+this.operator)},E=ve),He.In=(e(ye,oe),ye.prototype.children=["object","array"],ye.prototype.invert=ne,ye.prototype.compileNode=function(e){var t,i,n,o;if(this.array instanceof z&&this.array.isArray()){for(i=0,n=(o=this.array.base.objects).length;i<n;i++)if(o[i]instanceof O){t=!0;break}if(!t)return this.compileOrTest(e)}return this.compileLoopTest(e)},ye.prototype.compileOrTest=function(e){var t,i,n,o,s,r,a,l,c,h,u;if(0===this.array.base.objects.length)return[this.makeCode(""+!!this.negated)];for(r=(h=this.object.cache(e,L))[0],s=h[1],t=(h=this.negated?[" !== "," && "]:[" === "," || "])[0],i=h[1],a=[],n=l=0,c=(u=this.array.base.objects).length;l<c;n=++l)o=u[n],n&&a.push(this.makeCode(i)),a=a.concat(n?s:r,this.makeCode(t),o.compileToFragments(e,A));return e.level<L?a:this.wrapInBraces(a)},ye.prototype.compileLoopTest=function(e){var t=this.object.cache(e,T),i=t[0],n=t[1],t=[].concat(this.makeCode(ie("indexOf")+".call("),this.array.compileToFragments(e,T),this.makeCode(", "),n,this.makeCode(") "+(this.negated?"< 0":">= 0")));return Y(i)===Y(n)?t:(t=i.concat(this.makeCode(", "),t),e.level<T?t:this.wrapInBraces(t))},ye.prototype.toString=function(e){return ye.__super__.toString.call(this,e,this.constructor.name+(this.negated?"!":""))},r=ye),He.Try=(e(ge,oe),ge.prototype.children=["attempt","recovery","ensure"],ge.prototype.isStatement=H,ge.prototype.jumps=function(e){var t;return this.attempt.jumps(e)||(null!=(t=this.recovery)?t.jumps(e):void 0)},ge.prototype.makeReturn=function(e){return this.attempt&&(this.attempt=this.attempt.makeReturn(e)),this.recovery&&(this.recovery=this.recovery.makeReturn(e)),this},ge.prototype.compileNode=function(e){var t,i;return e.indent+=G,i=this.attempt.compileToFragments(e,R),t=this.recovery?(t=new P("_error"),this.errorVariable&&this.recovery.unshift(new D(this.errorVariable,t)),[].concat(this.makeCode(" catch ("),t.compileToFragments(e),this.makeCode(") {\n"),this.recovery.compileToFragments(e,R),this.makeCode("\n"+this.tab+"}"))):this.ensure||this.recovery?[]:[this.makeCode(" catch (_error) {}")],e=this.ensure?[].concat(this.makeCode(" finally {\n"),this.ensure.compileToFragments(e,R),this.makeCode("\n"+this.tab+"}")):[],[].concat(this.makeCode(this.tab+"try {\n"),i,this.makeCode("\n"+this.tab+"}"),t,e)},ge),He.Throw=(e(fe,oe),fe.prototype.children=["expression"],fe.prototype.isStatement=H,fe.prototype.jumps=c,fe.prototype.makeReturn=_,fe.prototype.compileNode=function(e){return[].concat(this.makeCode(this.tab+"throw "),this.expression.compileToFragments(e),this.makeCode(";"))},fe),He.Existence=(e(me,oe),me.prototype.children=["expression"],me.prototype.invert=ne,me.prototype.compileNode=function(e){var t,i,n;return this.expression.front=this.front,i=this.expression.compile(e,L),i=S.test(i)&&!e.scope.check(i)?"typeof "+i+" "+(t=(n=this.negated?["===","||"]:["!==","&&"])[0])+' "undefined" '+n[1]+" "+i+" "+t+" null":i+" "+(this.negated?"==":"!=")+" null",[this.makeCode(e.level<=a?i:"("+i+")")]},u=me),He.Parens=(e(de,oe),de.prototype.children=["body"],de.prototype.unwrap=function(){return this.body},de.prototype.isComplex=function(){return this.body.isComplex()},de.prototype.compileNode=function(e){var t,i=this.body.unwrap();return i instanceof z&&i.isAtomic()?(i.front=this.front,i.compileToFragments(e)):(t=i.compileToFragments(e,f),e.level<L&&(i instanceof E||i instanceof p||i instanceof s&&i.returns)?t:this.wrapInBraces(t))},B=de),He.For=(e(pe,W),pe.prototype.children=["body","source","guard","step"],pe.prototype.compileNode=function(e){var t,i,n,o,s,r,a,l,c,h,u,p,d,m,f,g,y,v,b,_,w=x.wrap([this.body]),k=null!=(b=K(w.expressions))?b.jumps():void 0;return k&&k instanceof N&&(this.returns=!1),m=this.range?this.source.base:this.source,d=e.scope,l=this.name&&this.name.compile(e,T),n=this.index&&this.index.compile(e,T),l&&!this.pattern&&d.find(l),n&&d.find(n),this.returns&&(p=d.freeVariable("results")),o=this.object&&n||d.freeVariable("i"),r=(s=this.range&&l||n||o)!==o?s+" = ":"",this.step&&!this.range&&(f=(_=this.cacheToCodeFragments(this.step.cache(e,T)))[0],g=(y=_[1]).match(U)),this.pattern&&(l=o),n=k=b="",_=this.tab+G,this.range?i=m.compileToFragments(Z(e,{index:o,name:l,step:this.step})):(v=this.source.compile(e,T),!l&&!this.own||S.test(v)||(n+=""+this.tab+(m=d.freeVariable("ref"))+" = "+v+";\n",v=m),l&&!this.pattern&&(c=l+" = "+v+"["+s+"]"),this.object||(f!==y&&(n+=""+this.tab+f+";\n"),l=r+o+" = 0, "+(a=!(this.step&&g&&(t=+g<0))?d.freeVariable("len"):a)+" = "+v+".length",f=r+o+" = "+v+".length - 1",d=o+" < "+a,a=o+" >= 0",o=this.step?(g?t&&(d=a,l=f):(d=y+" > 0 ? "+d+" : "+a,l="("+y+" > 0 ? ("+l+") : "+f+")"),o+" += "+y):s!==o?"++"+o:o+"++",i=[this.makeCode(l+"; "+d+"; "+r+o)])),this.returns&&(h=""+this.tab+p+" = [];\n",u="\n"+this.tab+"return "+p+";",w.makeReturn(p)),this.guard&&(1<w.expressions.length?w.expressions.unshift(new I(new B(this.guard).invert(),new P("continue"))):this.guard&&(w=x.wrap([new I(this.guard,w)]))),this.pattern&&w.expressions.unshift(new D(this.name,new P(v+"["+s+"]"))),n=[].concat(this.makeCode(n),this.pluckDirectCall(e,w)),c&&(b="\n"+_+c+";"),this.object&&(i=[this.makeCode(s+" in "+v)],this.own&&(k="\n"+_+"if (!"+ie("hasProp")+".call("+v+", "+s+")) continue;")),(_=w.compileToFragments(Z(e,{indent:_}),R))&&0<_.length&&(_=[].concat(this.makeCode("\n"),_,this.makeCode("\n"))),[].concat(n,this.makeCode(""+(h||"")+this.tab+"for ("),i,this.makeCode(") {"+k+b),_,this.makeCode(this.tab+"}"+(u||"")))},pe.prototype.pluckDirectCall=function(e,t){for(var i,n,o,s,r,a,l=[],c=t.expressions,h=n=0,u=c.length;n<u;h=++n)(i=(i=c[h]).unwrapAll())instanceof p&&(((a=i.variable.unwrapAll())instanceof d||a instanceof z&&(null!=(r=a.base)?r.unwrapAll():void 0)instanceof d&&1===a.properties.length&&("call"===(o=null!=(s=a.properties[0].name)?s.value:void 0)||"apply"===o))&&(s=(null!=(r=a.base)?r.unwrapAll():void 0)||a,o=new P(e.scope.freeVariable("fn")),r=new z(o),a.base&&(a.base=(a=[r,a])[0],r=a[1]),t.expressions[h]=new p(r,i.args),l=l.concat(this.makeCode(this.tab),new D(o,s).compileToFragments(e,R),this.makeCode(";\n"))));return l},s=pe),He.Switch=(e(ue,oe),ue.prototype.children=["subject","cases","otherwise"],ue.prototype.isStatement=H,ue.prototype.jumps=function(e){var t,i,n,o,s;for(null==e&&(e={block:!0}),t=0,i=(n=this.cases).length;t<i;t++)if((o=n[t])[0],(o=o[1]).jumps(e))return o;return null!=(s=this.otherwise)?s.jumps(e):void 0},ue.prototype.makeReturn=function(e){for(var t,i=this.cases,n=0,o=i.length;n<o;n++)i[n][1].makeReturn(e);return e&&(this.otherwise||(this.otherwise=new x([new P("void 0")]))),null!=(t=this.otherwise)&&t.makeReturn(e),this},ue.prototype.compileNode=function(e){for(var t,i,n,o,s,r,a,l=e.indent+G,c=e.indent=l+G,h=[].concat(this.makeCode(this.tab+"switch ("),this.subject?this.subject.compileToFragments(e,f):this.makeCode("false"),this.makeCode(") {\n")),u=this.cases,p=n=0,d=u.length;n<d;p=++n){for(i=(r=u[p])[0],r=r[1],o=0,s=(a=J([i])).length;o<s;o++)t=a[o],this.subject||(t=t.invert()),h=h.concat(this.makeCode(l+"case "),t.compileToFragments(e,f),this.makeCode(":\n"));if(0<(i=r.compileToFragments(e,R)).length&&(h=h.concat(i,this.makeCode("\n"))),p===this.cases.length-1&&!this.otherwise)break;(r=this.lastNonComment(r.expressions))instanceof N||r instanceof P&&r.jumps()&&"debugger"!==r.value||h.push(t.makeCode(c+"break;\n"))}return this.otherwise&&this.otherwise.expressions.length&&h.push.apply(h,[this.makeCode(l+"default:\n")].concat(ce.call(this.otherwise.compileToFragments(e,R)),[this.makeCode("\n")])),h.push(this.makeCode(this.tab+"}")),h},ue),He.If=(e(he,oe),he.prototype.children=["condition","body","elseBody"],he.prototype.bodyNode=function(){var e;return null!=(e=this.body)?e.unwrap():void 0},he.prototype.elseBodyNode=function(){var e;return null!=(e=this.elseBody)?e.unwrap():void 0},he.prototype.addElse=function(e){return this.isChain?this.elseBodyNode().addElse(e):(this.isChain=e instanceof he,this.elseBody=this.ensureBlock(e)),this},he.prototype.isStatement=function(e){var t;return(null!=e?e.level:void 0)===R||this.bodyNode().isStatement(e)||(null!=(t=this.elseBodyNode())?t.isStatement(e):void 0)},he.prototype.jumps=function(e){var t;return this.body.jumps(e)||(null!=(t=this.elseBody)?t.jumps(e):void 0)},he.prototype.compileNode=function(e){return this.isStatement(e)?this.compileStatement(e):this.compileExpression(e)},he.prototype.makeReturn=function(e){return e&&(this.elseBody||(this.elseBody=new x([new P("void 0")]))),this.body&&(this.body=new x([this.body.makeReturn(e)])),this.elseBody&&(this.elseBody=new x([this.elseBody.makeReturn(e)])),this},he.prototype.ensureBlock=function(e){return e instanceof x?e:new x([e])},he.prototype.compileStatement=function(e){var t,i,n,o=j(e,"chainChild");return j(e,"isExistentialEquals")?new he(this.condition.invert(),this.elseBodyNode(),{type:"if"}).compileToFragments(e):(n=e.indent+G,t=this.condition.compileToFragments(e,f),i=this.ensureBlock(this.body).compileToFragments(Z(e,{indent:n})),i=[].concat(this.makeCode("if ("),t,this.makeCode(") {\n"),i,this.makeCode("\n"+this.tab+"}")),o||i.unshift(this.makeCode(this.tab)),this.elseBody?(o=i.concat(this.makeCode(" else ")),o=this.isChain?(e.chainChild=!0,o.concat(this.elseBody.unwrap().compileToFragments(e,R))):o.concat(this.makeCode("{\n"),this.elseBody.compileToFragments(Z(e,{indent:n}),R),this.makeCode("\n"+this.tab+"}"))):i)},he.prototype.compileExpression=function(e){var t=this.condition.compileToFragments(e,a),i=this.bodyNode().compileToFragments(e,T),n=this.elseBodyNode()?this.elseBodyNode().compileToFragments(e,T):[this.makeCode("void 0")],n=t.concat(this.makeCode(" ? "),i,this.makeCode(" : "),n);return e.level>=a?this.wrapInBraces(n):n},he.prototype.unfoldSoak=function(){return this.soak&&this},I=he),n={wrap:function(e,t,i){var n,o,s;return e.jumps()?e:(s=new d([],x.wrap([e])),o=[],(n=e.contains(this.isLiteralArguments))&&e.classBody&&n.error("Class bodies shouldn't reference arguments"),(n||e.contains(this.isLiteralThis))&&(e=new P(n?"apply":"call"),o=[new P("this")],n&&o.push(new P("arguments")),s=new z(s,[new k(e)])),s.noReturn=i,o=new p(s,o),t?x.wrap([o]):o)},isLiteralArguments:function(e){return e instanceof P&&"arguments"===e.value&&!e.asKey},isLiteralThis:function(e){return e instanceof P&&"this"===e.value&&!e.asKey||e instanceof d&&e.bound||e instanceof p&&e.isSuper}},te=function(e,t,i){if(e=t[i].unfoldSoak(e))return t[i]=e.body,e.body=new z(t),e},w={extends:function(){return"function(child, parent) { for (var key in parent) { if ("+ie("hasProp")+".call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; }"},bind:function(){return"function(fn, me){ return function(){ return fn.apply(me, arguments); }; }"},indexOf:function(){return"[].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; }"},hasProp:function(){return"{}.hasOwnProperty"},slice:function(){return"[].slice"}},R=1,f=2,T=3,a=4,L=5,A=6,G="  ",oe="[$A-Za-z_\\x7f-\\uffff][$\\w\\x7f-\\uffff]*",S=RegExp("^"+oe+"$"),U=/^[+-]?\d+$/,l=RegExp("^(?:("+oe+")\\.prototype(?:\\.("+oe+")|\\[(\"(?:[^\\\\\"\\r\\n]|\\\\.)*\"|'(?:[^\\\\'\\r\\n]|\\\\.)*')\\]|\\[(0x[\\da-fA-F]+|\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\]))|("+oe+")$"),i=/^['"]/,ie=function(e){var t="__"+e;return V.root.assign(t,w[e]()),t},Q=function(e,t){return(e=e.replace(/\n/g,"$&"+t)).replace(/\s+$/,"")}}.call(this),e}(),require["./sourcemap"]=function(){var i={exports:{}};return function(){var s;function e(){this.lines=[]}function t(e){this.line=e,this.columns=[]}t.prototype.add=function(e,t,i){var n=t[0],t=t[1];return null==i&&(i={}),this.columns[e]&&i.noReplace?void 0:this.columns[e]={line:this.line,column:e,sourceLine:n,sourceColumn:t}},t.prototype.sourceLocation=function(e){for(var t;!((t=this.columns[e])||e<=0);)e--;return t&&[t.sourceLine,t.sourceColumn]},s=t,e.prototype.add=function(e,t,i){var n,o;return null==i&&(i={}),o=t[0],n=t[1],((t=this.lines)[o]||(t[o]=new s(o))).add(n,e,i)},e.prototype.sourceLocation=function(e){for(var t,i=e[0],e=e[1];!((t=this.lines[i])||i<=0);)i--;return t&&t.sourceLocation(e)},e.prototype.generate=function(e,t){var i,n,o,s,r,a,l,c,h,u,p,d,m,f,g,y;for(null==e&&(e={}),null==t&&(t=null),c=!1,i="",a=p=o=s=n=u=0,m=(g=this.lines).length;p<m;a=++p)if(r=g[a])for(d=0,f=(y=r.columns).length;d<f;d++)if(l=y[d]){for(;u<l.line;)n=0,c=!1,i+=";",u++;c&&(i+=",",c=!1),i+=this.encodeVlq(l.column-n),n=l.column,i+=this.encodeVlq(0),i+=this.encodeVlq(l.sourceLine-s),s=l.sourceLine,i+=this.encodeVlq(l.sourceColumn-o),o=l.sourceColumn,c=!0}return h={version:3,file:e.generatedFile||"",sourceRoot:e.sourceRoot||"",sources:e.sourceFiles||[""],names:[],mappings:i},e.inline&&(h.sourcesContent=[t]),JSON.stringify(h,null,2)},e.prototype.encodeVlq=function(e){for(var t,i="",n=e<0?1:0,o=(Math.abs(e)<<1)+n;o||!i;)t=31&o,(o>>=5)&&(t|=32),i+=this.encodeBase64(t);return i},e.prototype.encodeBase64=function(e){return"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[e]||function(){throw new Error("Cannot Base64 encode value: "+e)}()},i.exports=e}.call(this),i.exports}(),require["./coffee-script"]=function(){var k={},e=k;return function(){var n,f,i,o,r,p,e,s,t,a,l,c,h,g={}.hasOwnProperty,u=require("fs"),y=require("vm"),v=require("path"),d=require("child_process"),m=require("./lexer").Lexer,b=require("./parser").parser,_=require("./helpers"),w=require("./sourcemap");if(k.VERSION="1.6.3",k.helpers=_,k.compile=f=function(e,t){var i,n,o,s,r,a,l,c,h,u;_.merge;for((t=null==t?{}:t).sourceMap&&(l=new w),r=b.parse(p.tokenize(e,t)).compileToFragments(t),o=0,t.header&&(o+=1),t.shiftLine&&(o+=1),a="",h=n=0,u=r.length;h<u;h++)s=r[h],t.sourceMap&&(s.locationData&&l.add([s.locationData.first_line,s.locationData.first_column],[o,n],{noReplace:!0}),o+=c=_.count(s.code,"\n"),n=s.code.length-(c?s.code.lastIndexOf("\n"):0)),a+=s.code;return t.header&&(a="// "+("Generated by CoffeeScript "+this.VERSION)+"\n"+a),t.sourceMap?((i={js:a}).sourceMap=l,i.v3SourceMap=l.generate(t,e),i):a},k.tokens=function(e,t){return p.tokenize(e,t)},k.nodes=function(e,t){return"string"==typeof e?b.parse(p.tokenize(e,t)):b.parse(e)},k.run=function(e,t){var i=require.main;return null==(t=null==t?{}:t).sourceMap&&(t.sourceMap=!0),i.filename=process.argv[1]=t.filename?u.realpathSync(t.filename):".",i.moduleCache&&(i.moduleCache={}),i.paths=require("module")._nodeModulePaths(v.dirname(u.realpathSync(t.filename||"."))),!_.isCoffee(i.filename)||require.extensions?(t=f(e,t),s(),a[i.filename]=t.sourceMap,i._compile(t.js,i.filename)):i._compile(e,i.filename)},k.eval=function(e,t){var i,n,o,s,r,a,l,c,h,u,p,d,m;if(null==t&&(t={}),e=e.trim()){if(n=y.Script){if(null!=t.sandbox){if(t.sandbox instanceof n.createContext().constructor)a=t.sandbox;else for(o in a=n.createContext(),p=t.sandbox)g.call(p,o)&&(l=p[o],a[o]=l);a.global=a.root=a.GLOBAL=a}else a=global;if(a.__filename=t.filename||"eval",a.__dirname=v.dirname(a.__filename),a===global&&!a.module&&!a.require){for(i=require("module"),a.module=u=new i(t.modulename||"eval"),a.require=m=function(e){return i._load(e,u,!0)},u.filename=a.__filename,c=0,h=(d=Object.getOwnPropertyNames(require)).length;c<h;c++)"paths"!==(r=d[c])&&(m[r]=require[r]);m.paths=u.paths=i._nodeModulePaths(process.cwd()),m.resolve=function(e){return i._resolveFilename(e,u)}}}for(o in s={},t)g.call(t,o)&&(l=t[o],s[o]=l);return s.bare=!0,e=f(e,s),a===global?y.runInThisContext(e):y.runInContext(e,a)}},e=function(e,t){var i=u.readFileSync(t,"utf8"),i=65279===i.charCodeAt(0)?i.substring(1):i,i=f(i,{filename:t,sourceMap:!0,literate:_.isLiterate(t)});return a[t]=i.sourceMap,e._compile(i.js,t)},require.extensions){for(l=0,c=(h=[".coffee",".litcoffee",".coffee.md"]).length;l<c;l++)require.extensions[h[l]]=e;n=require("module"),i=function(e){var t,i=v.basename(e).split(".");for(""===i[0]&&i.shift();i.shift();)if(t="."+i.join("."),n._extensions[t])return t;return".js"},n.prototype.load=function(e){var t;return this.filename=e,this.paths=n._nodeModulePaths(v.dirname(e)),t=i(e),n._extensions[t](this,e),this.loaded=!0}}d&&(o=d.fork,d.fork=function(e,t,i){var n;return null==t&&(t=[]),null==i&&(i={}),n=_.isCoffee(e)?"coffee":null,(i=!Array.isArray(t)?(t=[])||{}:i).execPath||(i.execPath=n),o(e,t,i)}),p=new m,b.lexer={lex:function(){var e,t=this.tokens[this.pos++];return t?(e=t[0],this.yytext=t[1],this.yylloc=t[2],this.yylineno=this.yylloc.first_line):e="",e},setInput:function(e){return this.tokens=e,this.pos=0},upcomingInput:function(){return""}},b.yy=require("./nodes"),b.yy.parseError=function(e,t){t=t.token;return _.throwSyntaxError("unexpected "+(1===t?"end of input":t),b.lexer.yylloc)},t=!1,a={},s=function(){if(!t)return t=!0,require.main,Error.prepareStackTrace=function(e,n){var o,s=function(e,t,i){var n,e=a[e];return(n=e?e.sourceLocation([t-1,i-1]):n)?[n[0]+1,n[1]+1]:null},t=function(){for(var e=[],t=0,i=n.length;t<i&&(o=n[t]).getFunction()!==k.run;t++)e.push("  at "+r(o,s));return e}();return e.name+": "+(null!=(e=e.message)?e:"")+"\n"+t.join("\n")+"\n"}},r=function(e,t){var i,n,o,s=void 0,r="";return r=e.isNative()?"native":(e.isEval()?(s=e.getScriptNameOrSourceURL())||(r=e.getEvalOrigin()+", "):s=e.getFileName(),(n=t(s=s||"<anonymous>",o=e.getLineNumber(),i=e.getColumnNumber()))?s+":"+n[0]+":"+n[1]+", <js>:"+o+":"+i:s+":"+o+":"+i),t=e.getFunctionName(),n=e.isConstructor(),!(e.isToplevel()||n)?(s=e.getMethodName(),o=e.getTypeName(),t?(e=i="",o&&t.indexOf(o)&&(e=o+"."),s&&t.indexOf("."+s)!==t.length-s.length-1&&(i=" [as "+s+"]"),""+e+t+i+" ("+r+")"):o+"."+(s||"<anonymous>")+" ("+r+")"):n?"new "+(t||"<anonymous>")+" ("+r+")":t?t+" ("+r+")":r}}.call(this),e}(),require["./browser"]=function(){var exports={},module={exports:exports};return function(){var CoffeeScript,compile,runScripts,__indexOf=[].indexOf||function(e){for(var t=0,i=this.length;t<i;t++)if(t in this&&this[t]===e)return t;return-1},CoffeeScript=require("./coffee-script");CoffeeScript.require=require,compile=CoffeeScript.compile,CoffeeScript.eval=function(code,options){return null==options&&(options={}),null==options.bare&&(options.bare=!0),eval(compile(code,options))},CoffeeScript.run=function(e,t){return(t=null==t?{}:t).bare=!0,t.shiftLine=!0,Function(compile(e,t))()},"undefined"!=typeof window&&null!==window&&("undefined"!=typeof btoa&&null!==btoa&&"undefined"!=typeof JSON&&null!==JSON&&"undefined"!=typeof unescape&&null!==unescape&&"undefined"!=typeof encodeURIComponent&&null!==encodeURIComponent&&(compile=function(e,t){return(t=null==t?{}:t).sourceMap=!0,t.inline=!0,t=(e=CoffeeScript.compile(e,t)).js,e=e.v3SourceMap,t+"\n//@ sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(e)))+"\n//@ sourceURL=coffeescript"}),CoffeeScript.load=function(t,i,n){var o;return(n=null==n?{}:n).sourceFiles=[t],(o=window.ActiveXObject?new window.ActiveXObject("Microsoft.XMLHTTP"):new window.XMLHttpRequest).open("GET",t,!0),"overrideMimeType"in o&&o.overrideMimeType("text/plain"),o.onreadystatechange=function(){var e;if(4===o.readyState){if(0!==(e=o.status)&&200!==e)throw new Error("Could not load "+t);if(CoffeeScript.run(o.responseText,n),i)return i()}},o.send(null)},runScripts=function(){var i,o,s=window.document.getElementsByTagName("script"),r=["text/coffeescript","text/literate-coffeescript"],n=function(){for(var e,t=[],i=0,n=s.length;i<n;i++)e=(o=s[i]).type,0<=__indexOf.call(r,e)&&t.push(o);return t}(),a=0;n.length;return(i=function(){var e=n[a++],t=null!=e?e.type:void 0;return 0<=__indexOf.call(r,t)?(t={literate:"text/literate-coffeescript"===t},e.src?CoffeeScript.load(e.src,i,t):(t.sourceFiles=["embedded"],CoffeeScript.run(e.innerHTML,t),i())):void 0})(),null},window.addEventListener?window.addEventListener("DOMContentLoaded",runScripts,!1):window.attachEvent("onload",runScripts))}.call(this),module.exports}(),require["./coffee-script"];function az2(){this.yy={}}var bz2,Zy2,$y2,_y2}();"function"==typeof define&&define.amd?define(function(){return CoffeeScript}):root.CoffeeScript=CoffeeScript}(window)},277:function(e,t){"undefined"!=typeof Box2D&&null!==Box2D?(e.exports=window.box2d={b2Vec2:Box2D.Common.Math.b2Vec2,b2BodyDef:Box2D.Dynamics.b2BodyDef,b2Body:Box2D.Dynamics.b2Body,b2FixtureDef:Box2D.Dynamics.b2FixtureDef,b2Fixture:Box2D.Dynamics.b2Fixture,b2FilterData:Box2D.Dynamics.b2FilterData,b2World:Box2D.Dynamics.b2World,b2ContactListener:Box2D.Dynamics.b2ContactListener,b2MassData:Box2D.Collision.Shapes.b2MassData,b2PolygonShape:Box2D.Collision.Shapes.b2PolygonShape,b2CircleShape:Box2D.Collision.Shapes.b2CircleShape},window.BOX2D_ENABLED=!0):e.exports=null},278:function(e,t){e.exports.MAX_COOLDOWN=9001},279:function(e,t){function r(e,t,i){var n,o,s;for(o in this.superteamIndex=null!=t?t:null,this.collisionSystem=i,this.ground=-1!==e.search("ground"),this.air=-1!==e.search("air"),this.name=r.nameFor(e,this.superteamIndex),(this.ground||this.air)&&null==this.superteamIndex&&(this.superteamIndex=0),this.number=1<<this.collisionSystem.totalCategories++,16<this.collisionSystem.totalCategories&&console.log("There should only be 16 collision categories!"),this.mask=0,s=(this.collisionSystem.allCategories[this.name]=this).collisionSystem.allCategories)n=s[o],this.collidesWith(n)&&(this.mask=this.mask|n.number,n.mask=n.mask|this.number)}e.exports.CollisionCategory=(r.className="CollisionCategory",r.prototype.collidesWith=function(e){return"none"!==this.name&&"none"!==e.name&&("obstacles"===e.name||"obstacles"===this.name||("dead"===this.name?"obstacles"===e.name:"dead"===e.name?"obstacles"===this.name:!(this.superteamIndex&&e.superteamIndex===this.superteamIndex&&this.ground&&this.air)&&(!(this.ground&&this.air&&e.ground&&e.air)&&(!(!e.ground||!this.ground)||!(!e.air||!this.air)))))},r.nameFor=function(e,t){return null==t&&(t=null),e.match("ground")||e.match("air")?e+"_"+(t||0):e},r)},280:function(e,t){e.exports.WATER_DENSITY=1e3,e.exports.AIR_DENSITY=1.225,e.exports.VACUUM_DENSITY=129e-17,e.exports.SWAMP_DENSITY=250,e.exports.STANDARD_FRICTION=.7,e.exports.ICE_FRICTION=.1},281:function(e,t,i){var n,o;
/*!
 * string_score.js: String Scoring Algorithm 0.1.10 
 *
 * http://joshaven.com/string_score
 * https://github.com/joshaven/string_score
 *
 * Copyright (C) 2009-2011 Joshaven Potter <yourtech@gmail.com>
 * Special thanks to all of the contributors listed here https://github.com/joshaven/string_score
 * MIT license: http://www.opensource.org/licenses/mit-license.php
 *
 * Date: Tue Mar 1 2011
*/
!function(){"use strict";n=[t],void 0===(o="function"==typeof(o=function(e){"use strict";function t(e,t,i){if(e==t)return 1;if(t=="")return 0;var n=0,o=t.length,s=e.length,r,a,l=1,c;for(var h=0,u,p,d,m,f,g;h<o;++h){d=t.charAt(h);m=e.indexOf(d.toLowerCase());f=e.indexOf(d.toUpperCase());g=Math.min(m,f);p=g>-1?g:Math.max(m,f);if(p===-1)if(i){l+=1-i;continue}else return 0;else u=.1;if(e[p]===d)u+=.1;if(p===0){u+=.6;if(h===0)r=1}else if(e.charAt(p-1)===" ")u+=.8;e=e.substring(p+1,s);n+=u}a=n/o;c=(a*(o/s)+a)/2;c/=l;if(r&&c+.15<1)c+=.15;return c}e.score=t})?o.apply(t,n):o)||(e.exports=o)}()},282:function(e,t,i){e.exports=window.libWorldRequire=function(e){switch(e){case"lib/world/systems/action":return i(278);case"lib/world/systems/collision":return i(279);case"lib/world/systems/movement":return i(280);case"lib/world/box2d":return i(277);case"lib/world/GoalManager":return i(272);case"lib/world/Grid":return i(169);case"lib/world/component":return i(171);case"lib/world/ellipse":return i(119);case"lib/world/errors":return i(172);case"lib/world/line_segment":return i(82);case"lib/world/names":return i(173);case"lib/world/rand":return i(120);case"lib/world/rectangle":return i(94);case"lib/world/script_event_prereqs":return i(170);case"lib/world/system":return i(174);case"lib/world/thang":return i(168);case"lib/world/thang_state":return i(95);case"lib/world/vector":return i(47);case"lib/world/world":return i(271);case"lib/world/world_frame":return i(175);case"lib/world/world_script_note":return i(176);case"lib/world/world_utils":return i(81);default:throw new Error("Whoops, dunno what you're trying to load but I didn't include it in worldLoader")}}},3036:function(e,t,i){"use strict";i.d(t,"a",function(){return n}),i.d(t,"b",function(){return o});var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("ul",{attrs:{id:"primary-goals-list",dir:"auto"}},t._l(t.levelGoals,function(e){return i("level-goal",{attrs:{goal:e,state:t.goalStates[e.id]}})}),1),t.conceptGoals.length?i("level-goal",{attrs:{goal:{name:t.$t("play_level.use_at_least_one_concept")},state:{status:t.conceptStatus}}}):t._e(),t.conceptGoals.length?i("ul",{attrs:{id:"concept-goals-list",dir:"auto"}},t._l(t.conceptGoals,function(e){return i("level-goal",{staticClass:"concept-goal",attrs:{goal:e,state:t.goalStates[e.id]}})}),1):t._e(),t.showStatus?i("div",{staticClass:"goals-status rtl-allowed"},[i("span",[t._v(t._s(t.$t("play_level.goals")))]),i("span",{staticClass:"spr"},[t._v(":")]),"running"===t.classToShow?i("span",{staticClass:"goal-status running"},[t._v(t._s(t.$t("play_level.running")))]):t._e(),"success"===t.classToShow?i("span",{staticClass:"goal-status success"},[t._v(t._s(t.$t("play_level.success")))]):t._e(),"incomplete"===t.classToShow?i("span",{staticClass:"goal-status incomplete"},[t._v(t._s(t.$t("play_level.incomplete")))]):t._e(),"timed-out"===t.classToShow?i("span",{staticClass:"goal-status timed-out"},[t._v(t._s(t.$t("play_level.timed_out")))]):t._e(),"failing"===t.classToShow?i("span",{staticClass:"goal-status failure"},[t._v(t._s(t.$t("play_level.failing")))]):t._e()]):t._e()],1)},o=[]},3049:function(e,t,i){"use strict";i.d(t,"a",function(){return n}),i.d(t,"b",function(){return o});var n=function(){var e=this,t=e.$createElement,t=e._self._c||t;return t("div",{staticClass:"modal-content",attrs:{id:"course-victory-component"}},[t("div",{staticClass:"modal-header"},[t("img",{staticClass:"header-img",attrs:{src:e.headerImage}}),e._m(0)]),t("div",{staticClass:"modal-body"},[t("div",{staticClass:"container-fluid"},[t("div",{staticClass:"row"},[t("div",{staticClass:"col-sm-12"},["cumulative"===e.level.assessment?t("div",{staticClass:"clearfix well well-sm well-parchment combo-results"},[t("div",{staticClass:"text-center text-uppercase left-column"},[t("div",{staticClass:"pie-container"},[t("pie-chart",{attrs:{percent:e.percentConceptsCompleted,"stroke-width":10,color:"#20572B",opacity:1,borderStrokeWidth:0}}),t("img",{staticClass:"combo-img",attrs:{src:e.comboImage}})],1),t("h5",[e._v(e._s(e.$t("play_level.combo_concepts_used",{complete:e.conceptGoalsCompleted,total:e.conceptGoals.length})))])]),t("div",[t("h3",{staticClass:"text-uppercase"},[e._v(e._s(e.$t("play_level.combo_challenge_complete")))]),e.allConceptsUsed?t("div",[e._v(e._s(e.$t("play_level.combo_all_concepts_used")))]):t("div",[e._v(e._s(e.$t("play_level.combo_not_all_concepts_used",{complete:e.conceptGoalsCompleted,total:e.conceptGoals.length})))])])]):e.level.assessment?t("div",{staticClass:"clearfix well well-sm well-parchment",attrs:{id:"level-status"}},[t("h3",{staticClass:"text-uppercase"},[e._v(e._s(e.$t("play_level.concept_challenge_complete")))]),t("img",{staticClass:"hero-img",attrs:{src:e.heroImage}}),t("div",[e._v(e._s(e.$t("play_level.combo_challenge_complete_body",{concept:e.primaryConcept})))])]):e.assessmentNext?t("div",{staticClass:"clearfix well well-sm well-parchment"},[t("img",{staticClass:"lock-banner",attrs:{src:"/images/pages/play/modal/unlocked_banner.png"}}),t("h5",{staticClass:"text-uppercase"},["cumulative"===e.nextAssessment.assessment?t("span",[e._v(e._s(e.$t("play_level.combo_challenge_unlocked"))+":")]):t("span",[e._v(e._s(e.$t("play_level.concept_challenge_unlocked"))+":")])]),t("h3",{staticClass:"text-uppercase"},[e._v(e._s(e.$dbt(e.nextAssessment,"name")))]),t("div",{staticClass:"no-imgs",domProps:{innerHTML:e._s(e.marked(e.$dbt(e.nextAssessment,"description")))}})]):t("div",{staticClass:"clearfix well well-sm well-parchment",attrs:{id:"level-status"}},[t("h3",{staticClass:"text-uppercase"},[e._v(e._s(e.$t("play_level.level_complete"))+": "+e._s(e.$dbt(e.level,"name")))]),t("img",{staticClass:"hero-img",attrs:{src:e.heroImage}}),e.level.victory?t("div",[e._v(e._s(e.$dbt(e.level.victory,"body")))]):e._e()])])]),"cumulative"===e.level.assessment?t("div",{staticClass:"row"},[t("div",{staticClass:"col-sm-5 col-sm-offset-7"},[t("button",{staticClass:"btn btn-illustrated btn-default btn-block btn-lg text-uppercase",attrs:{id:"replay-level-btn"},on:{click:e.onReplayLevel}},[e._v(e._s(e.$t("play_level.replay_level")))])])]):e.assessmentNext&&!e.level.assessment?t("div",{staticClass:"row"},[t("div",{staticClass:"col-sm-6 col-sm-offset-6"},[t("a",{staticClass:"btn btn-illustrated btn-success btn-block btn-lg btn-glow text-uppercase",attrs:{id:"start-challenge-btn",href:e.challengeLink},on:{click:e.onStartChallenge}},[e._v(e._s(e.$t("play_level.start_challenge")))])])]):e._e(),t("div",{staticClass:"row"},[t("div",{staticClass:"col-sm-6 text-uppercase"},[t("div",{staticClass:"well well-sm well-parchment"},[t("h5",[e._v(e._s(e.$t("play_level.completed_level")))]),t("h3",[e._v(e._s(e.$dbt(e.level,"name")))]),t("h5",[e._v(e._s(e.$dbt(e.course,"name")))]),e.stats?t("h3",[e._v("Levels Complete: "+e._s(e.stats.levels.numDone)+"/"+e._s(e.stats.levels.size))]):e._e()])]),e.nextLevelVideo?t("div",{staticClass:"col-sm-6"},[t("div",{staticClass:"well well-sm well-parchment"},[t("h5",{staticClass:"text-uppercase"},[e._v(e._s(e.$t("play.next"))+":")]),t("h3",{staticClass:"text-uppercase"},[e._v(e._s(e.$t("play_level.learn_new_concepts")))]),t("h5",{staticClass:"text-uppercase"},[e._v(e._s(e.$t("play_level.watch_a_video",{concept_name:e.nextLevelVideo.title})))])])]):e.nextLevel._id?t("div",{staticClass:"col-sm-6"},[t("div",{staticClass:"well well-sm well-parchment"},[t("h5",{staticClass:"text-uppercase"},[e._v(e._s(e.$t("play_level.next_level"))+":")]),t("h3",{staticClass:"text-uppercase"},[e._v(e._s(e.$dbt(e.nextLevel,"name")))]),t("div",{staticClass:"no-imgs",domProps:{innerHTML:e._s(e.marked(e.$dbt(e.nextLevel,"description")))}})])]):e._e()]),t("div",{staticClass:"row"},[t("div",{staticClass:"col-sm-6 text-uppercase"},[t("a",{staticClass:"btn btn-illustrated btn-block btn-lg text-uppercase",attrs:{id:"map-btn",href:e.mapLink},on:{click:e.onBackToMap}},[e._v(e._s(e.$t("play_level.back_to_map")))])]),e.nextLevelVideo?t("div",{staticClass:"col-sm-6 text-uppercase"},[t("a",{staticClass:"btn btn-illustrated btn-block btn-lg text-uppercase",class:e.nextLevelLinkClasses,attrs:{id:"next-level-btn",href:e.nextLevelVideoLink},on:{click:e.onNextLevelVideo}},[e._v(e._s(e.$t("play.next")))])]):e.nextLevel._id?t("div",{staticClass:"col-sm-6 text-uppercase"},[t("a",{staticClass:"btn btn-illustrated btn-block btn-lg text-uppercase",class:e.nextLevelLinkClasses,attrs:{id:"next-level-btn",href:e.nextLevelLink},on:{click:e.onNextLevel}},[e._v(e._s(e.$t("play_level.next_level")))])]):e._e()])])])])},o=[function(){var e=this.$createElement,e=this._self._c||e;return e("div",{staticClass:"btn well well-sm well-parchment",attrs:{id:"close-modal","data-dismiss":"modal"}},[e("span",{staticClass:"glyphicon glyphicon-remove"})])}]},3059:function(e,t,i){"use strict";i.d(t,"a",function(){return n}),i.d(t,"b",function(){return o});var n=function(){var e=this,t=e.$createElement,t=e._self._c||t;return e.showGoal?t("li",{class:e.goalClass},["incomplete"===e.state.status&&e.isConceptGoal?t("i",[e._v(e._s("  "))]):t("i",{staticClass:"glyphicon",class:e.iconClass}),e._v(e._s(e.goalText))]):e._e()},o=[]},712:function(e,t){var B={};function n(){}O=B,!(Object.defineProperty instanceof Function)&&Object.prototype.__defineGetter__ instanceof Function&&Object.prototype.__defineSetter__ instanceof Function&&(Object.defineProperty=function(e,t,i){i.get instanceof Function&&e.__defineGetter__(t,i.get),i.set instanceof Function&&e.__defineSetter__(t,i.set)}),O.inherit=function(e,t){var i=e;n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=i},O.generateCallback=function(e,t){return function(){t.apply(e,arguments)}},O.NVector=function(e){void 0===e&&(e=0);for(var t=new Array(e||0),i=0;i<e;++i)t[i]=0;return t},O.is=function(e,t){return null!==e&&(t instanceof Function&&e instanceof t||!(null==e.constructor.__implements||!e.constructor.__implements[t]))},O.parseUInt=function(e){return Math.abs(parseInt(e))};var i,o,s,T,x,r,a,S,g,l,c,L,h,u,b,p,d,m,f,y,v,_,M,w,k,C,D,I,A,R,P,E,F,N,U,V,O,G,z,W=Array,q=B.NVector;function H(){H.b2AABB.apply(this,arguments)}function j(){j.b2Bound.apply(this,arguments)}function $(){$.b2BoundValues.apply(this,arguments),this.constructor===$&&this.b2BoundValues.apply(this,arguments)}function J(){J.b2Collision.apply(this,arguments)}function Y(){Y.b2ContactID.apply(this,arguments),this.constructor===Y&&this.b2ContactID.apply(this,arguments)}function K(){K.b2ContactPoint.apply(this,arguments)}function X(){X.b2Distance.apply(this,arguments)}function Z(){Z.b2DistanceInput.apply(this,arguments)}function Q(){Q.b2DistanceOutput.apply(this,arguments)}function ee(){ee.b2DistanceProxy.apply(this,arguments)}function te(){te.b2DynamicTree.apply(this,arguments),this.constructor===te&&this.b2DynamicTree.apply(this,arguments)}function ie(){ie.b2DynamicTreeBroadPhase.apply(this,arguments)}function ne(){ne.b2DynamicTreeNode.apply(this,arguments)}function oe(){oe.b2DynamicTreePair.apply(this,arguments)}function se(){se.b2Manifold.apply(this,arguments),this.constructor===se&&this.b2Manifold.apply(this,arguments)}function re(){re.b2ManifoldPoint.apply(this,arguments),this.constructor===re&&this.b2ManifoldPoint.apply(this,arguments)}function ae(){ae.b2Point.apply(this,arguments)}function le(){le.b2RayCastInput.apply(this,arguments),this.constructor===le&&this.b2RayCastInput.apply(this,arguments)}function ce(){ce.b2RayCastOutput.apply(this,arguments)}function he(){he.b2Segment.apply(this,arguments)}function ue(){ue.b2SeparationFunction.apply(this,arguments)}function pe(){pe.b2Simplex.apply(this,arguments),this.constructor===pe&&this.b2Simplex.apply(this,arguments)}function de(){de.b2SimplexCache.apply(this,arguments)}function me(){me.b2SimplexVertex.apply(this,arguments)}function fe(){fe.b2TimeOfImpact.apply(this,arguments)}function ge(){ge.b2TOIInput.apply(this,arguments)}function ye(){ye.b2WorldManifold.apply(this,arguments),this.constructor===ye&&this.b2WorldManifold.apply(this,arguments)}function ve(){ve.ClipVertex.apply(this,arguments)}function be(){be.Features.apply(this,arguments)}function _e(){_e.b2CircleShape.apply(this,arguments),this.constructor===_e&&this.b2CircleShape.apply(this,arguments)}function we(){we.b2EdgeChainDef.apply(this,arguments),this.constructor===we&&this.b2EdgeChainDef.apply(this,arguments)}function ke(){ke.b2EdgeShape.apply(this,arguments),this.constructor===ke&&this.b2EdgeShape.apply(this,arguments)}function xe(){xe.b2MassData.apply(this,arguments)}function Se(){Se.b2PolygonShape.apply(this,arguments),this.constructor===Se&&this.b2PolygonShape.apply(this,arguments)}function Ce(){Ce.b2Shape.apply(this,arguments),this.constructor===Ce&&this.b2Shape.apply(this,arguments)}function Te(){Te.b2Color.apply(this,arguments),this.constructor===Te&&this.b2Color.apply(this,arguments)}function Le(){Le.b2Settings.apply(this,arguments)}function Me(){Me.b2Mat22.apply(this,arguments),this.constructor===Me&&this.b2Mat22.apply(this,arguments)}function De(){De.b2Mat33.apply(this,arguments),this.constructor===De&&this.b2Mat33.apply(this,arguments)}function Ie(){Ie.b2Math.apply(this,arguments)}function Ae(){Ae.b2Sweep.apply(this,arguments)}function Re(){Re.b2Transform.apply(this,arguments),this.constructor===Re&&this.b2Transform.apply(this,arguments)}function Pe(){Pe.b2Vec2.apply(this,arguments),this.constructor===Pe&&this.b2Vec2.apply(this,arguments)}function Ee(){Ee.b2Vec3.apply(this,arguments),this.constructor===Ee&&this.b2Vec3.apply(this,arguments)}function Be(){Be.b2Body.apply(this,arguments),this.constructor===Be&&this.b2Body.apply(this,arguments)}function Fe(){Fe.b2BodyDef.apply(this,arguments),this.constructor===Fe&&this.b2BodyDef.apply(this,arguments)}function Ne(){Ne.b2ContactFilter.apply(this,arguments)}function Ue(){Ue.b2ContactImpulse.apply(this,arguments)}function Ve(){Ve.b2ContactListener.apply(this,arguments)}function Oe(){Oe.b2ContactManager.apply(this,arguments),this.constructor===Oe&&this.b2ContactManager.apply(this,arguments)}function Ge(){Ge.b2DebugDraw.apply(this,arguments),this.constructor===Ge&&this.b2DebugDraw.apply(this,arguments)}function ze(){ze.b2DestructionListener.apply(this,arguments)}function He(){He.b2FilterData.apply(this,arguments)}function We(){We.b2Fixture.apply(this,arguments),this.constructor===We&&this.b2Fixture.apply(this,arguments)}function qe(){qe.b2FixtureDef.apply(this,arguments),this.constructor===qe&&this.b2FixtureDef.apply(this,arguments)}function je(){je.b2Island.apply(this,arguments),this.constructor===je&&this.b2Island.apply(this,arguments)}function $e(){$e.b2TimeStep.apply(this,arguments)}function Je(){Je.b2World.apply(this,arguments),this.constructor===Je&&this.b2World.apply(this,arguments)}function Ye(){Ye.b2CircleContact.apply(this,arguments)}function Ke(){Ke.b2Contact.apply(this,arguments),this.constructor===Ke&&this.b2Contact.apply(this,arguments)}function Xe(){Xe.b2ContactConstraint.apply(this,arguments),this.constructor===Xe&&this.b2ContactConstraint.apply(this,arguments)}function Ze(){Ze.b2ContactConstraintPoint.apply(this,arguments)}function Qe(){Qe.b2ContactEdge.apply(this,arguments)}function et(){et.b2ContactFactory.apply(this,arguments),this.constructor===et&&this.b2ContactFactory.apply(this,arguments)}function tt(){tt.b2ContactRegister.apply(this,arguments)}function it(){it.b2ContactResult.apply(this,arguments)}function nt(){nt.b2ContactSolver.apply(this,arguments),this.constructor===nt&&this.b2ContactSolver.apply(this,arguments)}function ot(){ot.b2EdgeAndCircleContact.apply(this,arguments)}function st(){st.b2NullContact.apply(this,arguments),this.constructor===st&&this.b2NullContact.apply(this,arguments)}function rt(){rt.b2PolyAndCircleContact.apply(this,arguments)}function at(){at.b2PolyAndEdgeContact.apply(this,arguments)}function lt(){lt.b2PolygonContact.apply(this,arguments)}function ct(){ct.b2PositionSolverManifold.apply(this,arguments),this.constructor===ct&&this.b2PositionSolverManifold.apply(this,arguments)}function ht(){ht.b2BuoyancyController.apply(this,arguments)}function ut(){ut.b2ConstantAccelController.apply(this,arguments)}function pt(){pt.b2ConstantForceController.apply(this,arguments)}function dt(){dt.b2Controller.apply(this,arguments)}function mt(){mt.b2ControllerEdge.apply(this,arguments)}function ft(){ft.b2GravityController.apply(this,arguments)}function gt(){gt.b2TensorDampingController.apply(this,arguments)}function yt(){yt.b2DistanceJoint.apply(this,arguments),this.constructor===yt&&this.b2DistanceJoint.apply(this,arguments)}function vt(){vt.b2DistanceJointDef.apply(this,arguments),this.constructor===vt&&this.b2DistanceJointDef.apply(this,arguments)}function bt(){bt.b2FrictionJoint.apply(this,arguments),this.constructor===bt&&this.b2FrictionJoint.apply(this,arguments)}function _t(){_t.b2FrictionJointDef.apply(this,arguments),this.constructor===_t&&this.b2FrictionJointDef.apply(this,arguments)}function wt(){wt.b2GearJoint.apply(this,arguments),this.constructor===wt&&this.b2GearJoint.apply(this,arguments)}function kt(){kt.b2GearJointDef.apply(this,arguments),this.constructor===kt&&this.b2GearJointDef.apply(this,arguments)}function xt(){xt.b2Jacobian.apply(this,arguments)}function St(){St.b2Joint.apply(this,arguments),this.constructor===St&&this.b2Joint.apply(this,arguments)}function Ct(){Ct.b2JointDef.apply(this,arguments),this.constructor===Ct&&this.b2JointDef.apply(this,arguments)}function Tt(){Tt.b2JointEdge.apply(this,arguments)}function Lt(){Lt.b2LineJoint.apply(this,arguments),this.constructor===Lt&&this.b2LineJoint.apply(this,arguments)}function Mt(){Mt.b2LineJointDef.apply(this,arguments),this.constructor===Mt&&this.b2LineJointDef.apply(this,arguments)}function Dt(){Dt.b2MouseJoint.apply(this,arguments),this.constructor===Dt&&this.b2MouseJoint.apply(this,arguments)}function It(){It.b2MouseJointDef.apply(this,arguments),this.constructor===It&&this.b2MouseJointDef.apply(this,arguments)}function At(){At.b2PrismaticJoint.apply(this,arguments),this.constructor===At&&this.b2PrismaticJoint.apply(this,arguments)}function Rt(){Rt.b2PrismaticJointDef.apply(this,arguments),this.constructor===Rt&&this.b2PrismaticJointDef.apply(this,arguments)}function Pt(){Pt.b2PulleyJoint.apply(this,arguments),this.constructor===Pt&&this.b2PulleyJoint.apply(this,arguments)}function Et(){Et.b2PulleyJointDef.apply(this,arguments),this.constructor===Et&&this.b2PulleyJointDef.apply(this,arguments)}function Bt(){Bt.b2RevoluteJoint.apply(this,arguments),this.constructor===Bt&&this.b2RevoluteJoint.apply(this,arguments)}function Ft(){Ft.b2RevoluteJointDef.apply(this,arguments),this.constructor===Ft&&this.b2RevoluteJointDef.apply(this,arguments)}function Nt(){Nt.b2WeldJoint.apply(this,arguments),this.constructor===Nt&&this.b2WeldJoint.apply(this,arguments)}function Ut(){Ut.b2WeldJointDef.apply(this,arguments),this.constructor===Ut&&this.b2WeldJointDef.apply(this,arguments)}for(void 0===(B=void 0===B?{}:B).Collision&&(B.Collision={}),void 0===B.Collision.Shapes&&(B.Collision.Shapes={}),void 0===B.Common&&(B.Common={}),void 0===B.Common.Math&&(B.Common.Math={}),void 0===B.Dynamics&&(B.Dynamics={}),void 0===B.Dynamics.Contacts&&(B.Dynamics.Contacts={}),void 0===B.Dynamics.Controllers&&(B.Dynamics.Controllers={}),void 0===B.Dynamics.Joints&&(B.Dynamics.Joints={}),B.Collision.IBroadPhase="Box2D.Collision.IBroadPhase",B.Collision.b2AABB=H,B.Collision.b2Bound=j,B.Collision.b2BoundValues=$,B.Collision.b2Collision=J,B.Collision.b2ContactID=Y,B.Collision.b2ContactPoint=K,B.Collision.b2Distance=X,B.Collision.b2DistanceInput=Z,B.Collision.b2DistanceOutput=Q,B.Collision.b2DistanceProxy=ee,B.Collision.b2DynamicTree=te,B.Collision.b2DynamicTreeBroadPhase=ie,B.Collision.b2DynamicTreeNode=ne,B.Collision.b2DynamicTreePair=oe,B.Collision.b2Manifold=se,B.Collision.b2ManifoldPoint=re,B.Collision.b2Point=ae,B.Collision.b2RayCastInput=le,B.Collision.b2RayCastOutput=ce,B.Collision.b2Segment=he,B.Collision.b2SeparationFunction=ue,B.Collision.b2Simplex=pe,B.Collision.b2SimplexCache=de,B.Collision.b2SimplexVertex=me,B.Collision.b2TimeOfImpact=fe,B.Collision.b2TOIInput=ge,B.Collision.b2WorldManifold=ye,B.Collision.ClipVertex=ve,B.Collision.Features=be,B.Collision.Shapes.b2CircleShape=_e,B.Collision.Shapes.b2EdgeChainDef=we,B.Collision.Shapes.b2EdgeShape=ke,B.Collision.Shapes.b2MassData=xe,B.Collision.Shapes.b2PolygonShape=Se,B.Collision.Shapes.b2Shape=Ce,B.Common.b2internal="Box2D.Common.b2internal",B.Common.b2Color=Te,B.Common.b2Settings=Le,B.Common.Math.b2Mat22=Me,B.Common.Math.b2Mat33=De,B.Common.Math.b2Math=Ie,B.Common.Math.b2Sweep=Ae,B.Common.Math.b2Transform=Re,B.Common.Math.b2Vec2=Pe,B.Common.Math.b2Vec3=Ee,B.Dynamics.b2Body=Be,B.Dynamics.b2BodyDef=Fe,B.Dynamics.b2ContactFilter=Ne,B.Dynamics.b2ContactImpulse=Ue,B.Dynamics.b2ContactListener=Ve,B.Dynamics.b2ContactManager=Oe,B.Dynamics.b2DebugDraw=Ge,B.Dynamics.b2DestructionListener=ze,B.Dynamics.b2FilterData=He,B.Dynamics.b2Fixture=We,B.Dynamics.b2FixtureDef=qe,B.Dynamics.b2Island=je,B.Dynamics.b2TimeStep=$e,B.Dynamics.b2World=Je,B.Dynamics.Contacts.b2CircleContact=Ye,B.Dynamics.Contacts.b2Contact=Ke,B.Dynamics.Contacts.b2ContactConstraint=Xe,B.Dynamics.Contacts.b2ContactConstraintPoint=Ze,B.Dynamics.Contacts.b2ContactEdge=Qe,B.Dynamics.Contacts.b2ContactFactory=et,B.Dynamics.Contacts.b2ContactRegister=tt,B.Dynamics.Contacts.b2ContactResult=it,B.Dynamics.Contacts.b2ContactSolver=nt,B.Dynamics.Contacts.b2EdgeAndCircleContact=ot,B.Dynamics.Contacts.b2NullContact=st,B.Dynamics.Contacts.b2PolyAndCircleContact=rt,B.Dynamics.Contacts.b2PolyAndEdgeContact=at,B.Dynamics.Contacts.b2PolygonContact=lt,B.Dynamics.Contacts.b2PositionSolverManifold=ct,B.Dynamics.Controllers.b2BuoyancyController=ht,B.Dynamics.Controllers.b2ConstantAccelController=ut,B.Dynamics.Controllers.b2ConstantForceController=pt,B.Dynamics.Controllers.b2Controller=dt,B.Dynamics.Controllers.b2ControllerEdge=mt,B.Dynamics.Controllers.b2GravityController=ft,B.Dynamics.Controllers.b2TensorDampingController=gt,B.Dynamics.Joints.b2DistanceJoint=yt,B.Dynamics.Joints.b2DistanceJointDef=vt,B.Dynamics.Joints.b2FrictionJoint=bt,B.Dynamics.Joints.b2FrictionJointDef=_t,B.Dynamics.Joints.b2GearJoint=wt,B.Dynamics.Joints.b2GearJointDef=kt,B.Dynamics.Joints.b2Jacobian=xt,B.Dynamics.Joints.b2Joint=St,B.Dynamics.Joints.b2JointDef=Ct,B.Dynamics.Joints.b2JointEdge=Tt,B.Dynamics.Joints.b2LineJoint=Lt,B.Dynamics.Joints.b2LineJointDef=Mt,B.Dynamics.Joints.b2MouseJoint=Dt,B.Dynamics.Joints.b2MouseJointDef=It,B.Dynamics.Joints.b2PrismaticJoint=At,B.Dynamics.Joints.b2PrismaticJointDef=Rt,B.Dynamics.Joints.b2PulleyJoint=Pt,B.Dynamics.Joints.b2PulleyJointDef=Et,B.Dynamics.Joints.b2RevoluteJoint=Bt,B.Dynamics.Joints.b2RevoluteJointDef=Ft,B.Dynamics.Joints.b2WeldJoint=Nt,B.Dynamics.Joints.b2WeldJointDef=Ut,B.postDefs=[],i=B.Collision.Shapes.b2CircleShape,B.Collision.Shapes.b2EdgeChainDef,B.Collision.Shapes.b2EdgeShape,B.Collision.Shapes.b2MassData,o=B.Collision.Shapes.b2PolygonShape,s=B.Collision.Shapes.b2Shape,B.Common.b2Color,B.Common.b2internal,T=B.Common.b2Settings,B.Common.Math.b2Mat22,B.Common.Math.b2Mat33,x=B.Common.Math.b2Math,r=B.Common.Math.b2Sweep,a=B.Common.Math.b2Transform,S=B.Common.Math.b2Vec2,B.Common.Math.b2Vec3,g=B.Collision.b2AABB,l=B.Collision.b2Bound,c=B.Collision.b2BoundValues,L=B.Collision.b2Collision,h=B.Collision.b2ContactID,u=B.Collision.b2ContactPoint,b=B.Collision.b2Distance,p=B.Collision.b2DistanceInput,d=B.Collision.b2DistanceOutput,m=B.Collision.b2DistanceProxy,f=B.Collision.b2DynamicTree,y=B.Collision.b2DynamicTreeBroadPhase,v=B.Collision.b2DynamicTreeNode,_=B.Collision.b2DynamicTreePair,M=B.Collision.b2Manifold,w=B.Collision.b2ManifoldPoint,k=B.Collision.b2Point,C=B.Collision.b2RayCastInput,D=B.Collision.b2RayCastOutput,I=B.Collision.b2Segment,A=B.Collision.b2SeparationFunction,R=B.Collision.b2Simplex,P=B.Collision.b2SimplexCache,E=B.Collision.b2SimplexVertex,F=B.Collision.b2TimeOfImpact,N=B.Collision.b2TOIInput,G=B.Collision.b2WorldManifold,U=B.Collision.ClipVertex,V=B.Collision.Features,O=B.Collision.IBroadPhase,g.b2AABB=function(){this.lowerBound=new S,this.upperBound=new S},g.prototype.IsValid=function(){var e=this.upperBound.x-this.lowerBound.x,t=this.upperBound.y-this.lowerBound.y;return 0<=e&&0<=t&&this.lowerBound.IsValid()&&this.upperBound.IsValid()},g.prototype.GetCenter=function(){return new S((this.lowerBound.x+this.upperBound.x)/2,(this.lowerBound.y+this.upperBound.y)/2)},g.prototype.GetExtents=function(){return new S((this.upperBound.x-this.lowerBound.x)/2,(this.upperBound.y-this.lowerBound.y)/2)},g.prototype.Contains=function(e){return this.lowerBound.x<=e.lowerBound.x&&this.lowerBound.y<=e.lowerBound.y&&e.upperBound.x<=this.upperBound.x&&e.upperBound.y<=this.upperBound.y},g.prototype.RayCast=function(e,t){var i=-Number.MAX_VALUE,n=Number.MAX_VALUE,o=t.p1.x,s=t.p1.y,r=t.p2.x-t.p1.x,a=t.p2.y-t.p1.y,l=Math.abs(r),c=Math.abs(a),h=e.normal,u=0,p=0,d=0,m=0,t=0;if(l<Number.MIN_VALUE){if(o<this.lowerBound.x||this.upperBound.x<o)return!1}else if(p=(this.lowerBound.x-o)*(u=1/r),t=-1,(d=(this.upperBound.x-o)*u)<p&&(m=p,p=d,d=m,t=1),i<p&&(h.x=t,h.y=0,i=p),(n=Math.min(n,d))<i)return!1;if(c<Number.MIN_VALUE){if(s<this.lowerBound.y||this.upperBound.y<s)return!1}else if(p=(this.lowerBound.y-s)*(u=1/a),t=-1,(d=(this.upperBound.y-s)*u)<p&&(m=p,p=d,d=m,t=1),i<p&&(h.y=t,h.x=0,i=p),(n=Math.min(n,d))<i)return!1;return e.fraction=i,!0},g.prototype.TestOverlap=function(e){var t=e.lowerBound.x-this.upperBound.x,i=e.lowerBound.y-this.upperBound.y,n=this.lowerBound.x-e.upperBound.x,e=this.lowerBound.y-e.upperBound.y;return!(0<t||0<i)&&!(0<n||0<e)},g.Combine=function(e,t){var i=new g;return i.Combine(e,t),i},g.prototype.Combine=function(e,t){this.lowerBound.x=Math.min(e.lowerBound.x,t.lowerBound.x),this.lowerBound.y=Math.min(e.lowerBound.y,t.lowerBound.y),this.upperBound.x=Math.max(e.upperBound.x,t.upperBound.x),this.upperBound.y=Math.max(e.upperBound.y,t.upperBound.y)},l.b2Bound=function(){},l.prototype.IsLower=function(){return 0==(1&this.value)},l.prototype.IsUpper=function(){return 1==(1&this.value)},l.prototype.Swap=function(e){var t=this.value,i=this.proxy,n=this.stabbingCount;this.value=e.value,this.proxy=e.proxy,this.stabbingCount=e.stabbingCount,e.value=t,e.proxy=i,e.stabbingCount=n},c.b2BoundValues=function(){},c.prototype.b2BoundValues=function(){this.lowerValues=new q,this.lowerValues[0]=0,this.lowerValues[1]=0,this.upperValues=new q,this.upperValues[0]=0,this.upperValues[1]=0},L.b2Collision=function(){},L.ClipSegmentToLine=function(e,t,i,n){var o,s=0,r=(o=t[0]).v,a=(o=t[1]).v,l=i.x*r.x+i.y*r.y-(n=void 0===n?0:n),i=i.x*a.x+i.y*a.y-n;return l<=0&&e[s++].Set(t[0]),i<=0&&e[s++].Set(t[1]),l*i<0&&((n=(o=e[s]).v).x=r.x+(i=l/(l-i))*(a.x-r.x),n.y=r.y+i*(a.y-r.y),o=e[s],t=0<l?t[0]:t[1],o.id=t.id,++s),s},L.EdgeSeparation=function(e,t,i,n,o){void 0===i&&(i=0);parseInt(e.m_vertexCount);var s=e.m_vertices,r=e.m_normals,a=parseInt(n.m_vertexCount),l=n.m_vertices,e=t.R;m=r[i];for(var n=e.col1.x*m.x+e.col2.x*m.y,r=e.col1.y*m.x+e.col2.y*m.y,c=(e=o.R).col1.x*n+e.col1.y*r,h=e.col2.x*n+e.col2.y*r,u=0,p=Number.MAX_VALUE,d=0;d<a;++d){var m,f=(m=l[d]).x*c+m.y*h;f<p&&(p=f,u=d)}m=s[i],e=t.R;s=t.position.x+(e.col1.x*m.x+e.col2.x*m.y),i=t.position.y+(e.col1.y*m.x+e.col2.y*m.y);m=l[u],e=o.R;t=o.position.x+(e.col1.x*m.x+e.col2.x*m.y),e=o.position.y+(e.col1.y*m.x+e.col2.y*m.y);return(t-=s)*n+(e-=i)*r},L.FindMaxSeparation=function(e,t,i,n,o){var s=parseInt(t.m_vertexCount),r=t.m_normals,a=o.R;f=n.m_centroid;var l=o.position.x+(a.col1.x*f.x+a.col2.x*f.y),c=o.position.y+(a.col1.y*f.x+a.col2.y*f.y);a=i.R,f=t.m_centroid,l-=i.position.x+(a.col1.x*f.x+a.col2.x*f.y),c-=i.position.y+(a.col1.y*f.x+a.col2.y*f.y);for(var h=l*i.R.col1.x+c*i.R.col1.y,u=l*i.R.col2.x+c*i.R.col2.y,p=0,d=-Number.MAX_VALUE,m=0;m<s;++m){var f,g=(f=r[m]).x*h+f.y*u;d<g&&(d=g,p=m)}var y=L.EdgeSeparation(t,i,p,n,o),v=parseInt(0<=p-1?p-1:s-1),a=L.EdgeSeparation(t,i,v,n,o),l=parseInt(p+1<s?p+1:0),c=L.EdgeSeparation(t,i,l,n,o),b=0,_=0,w=0;if(y<a&&c<a)w=-1,b=v,_=a;else{if(!(y<c))return e[0]=p,y;w=1,b=l,_=c}for(;_<(y=L.EdgeSeparation(t,i,p=-1==w?0<=b-1?b-1:s-1:b+1<s?b+1:0,n,o));)b=p,_=y;return e[0]=b,_},L.FindIncidentEdge=function(e,t,i,n,o,s){void 0===n&&(n=0);parseInt(t.m_vertexCount);var r=t.m_normals,a=parseInt(o.m_vertexCount),l=o.m_vertices,c=o.m_normals,t=i.R;f=r[n];for(var h=t.col1.x*f.x+t.col2.x*f.y,u=t.col1.y*f.x+t.col2.y*f.y,o=(t=s.R).col1.x*h+t.col1.y*u,u=t.col2.x*h+t.col2.y*u,h=o,p=0,d=Number.MAX_VALUE,m=0;m<a;++m){var f,g=h*(f=c[m]).x+u*f.y;g<d&&(d=g,p=m)}i=parseInt(p),r=parseInt(i+1<a?i+1:0),o=e[0];f=l[i],t=s.R,o.v.x=s.position.x+(t.col1.x*f.x+t.col2.x*f.y),o.v.y=s.position.y+(t.col1.y*f.x+t.col2.y*f.y),o.id.features.referenceEdge=n,o.id.features.incidentEdge=i,o.id.features.incidentVertex=0,o=e[1],f=l[r],t=s.R,o.v.x=s.position.x+(t.col1.x*f.x+t.col2.x*f.y),o.v.y=s.position.y+(t.col1.y*f.x+t.col2.y*f.y),o.id.features.referenceEdge=n,o.id.features.incidentEdge=r,o.id.features.incidentVertex=1},L.MakeClipPointVector=function(){var e=new W(2);return e[0]=new U,e[1]=new U,e},L.CollidePolygons=function(e,t,i,n,o){e.m_pointCount=0;var s=t.m_radius+n.m_radius,r=0;L.s_edgeAO[0]=0;var a=L.FindMaxSeparation(L.s_edgeAO,t,i,n,o),r=L.s_edgeAO[0];if(!(s<a)){L.s_edgeBO[0]=0;var l=L.FindMaxSeparation(L.s_edgeBO,n,o,t,i),c=L.s_edgeBO[0];if(!(s<l)){var h,u=0,p=0,p=.98*a+.001<l?(m=n,d=t,y=o,h=i,u=c,e.m_type=M.e_faceB,1):(m=t,d=n,y=i,h=o,u=r,e.m_type=M.e_faceA,0),c=L.s_incidentEdge;L.FindIncidentEdge(c,m,y,u,d,h);t=parseInt(m.m_vertexCount),n=m.m_vertices,i=n[u],o=u+1<t?n[parseInt(u+1)]:n[0],r=L.s_localTangent;r.Set(o.x-i.x,o.y-i.y),r.Normalize();var d=L.s_localNormal;d.x=r.y,d.y=-r.x;var m=L.s_planePoint;m.Set(.5*(i.x+o.x),.5*(i.y+o.y));t=L.s_tangent;k=y.R,t.x=k.col1.x*r.x+k.col2.x*r.y,t.y=k.col1.y*r.x+k.col2.y*r.y;u=L.s_tangent2;u.x=-t.x,u.y=-t.y;var f=L.s_normal;f.x=t.y,f.y=-t.x;n=L.s_v11,r=L.s_v12;n.x=y.position.x+(k.col1.x*i.x+k.col2.x*i.y),n.y=y.position.y+(k.col1.y*i.x+k.col2.y*i.y),r.x=y.position.x+(k.col1.x*o.x+k.col2.x*o.y),r.y=y.position.y+(k.col1.y*o.x+k.col2.y*o.y);var g=f.x*n.x+f.y*n.y,y=-t.x*n.x-t.y*n.y+s,o=t.x*r.x+t.y*r.y+s,n=L.s_clipPoints1,v=L.s_clipPoints2,r=0,r=L.ClipSegmentToLine(n,c,u,y);if(!(r<2||(r=L.ClipSegmentToLine(v,n,t,o))<2)){e.m_localPlaneNormal.SetV(d),e.m_localPoint.SetV(m);for(var b=0,_=0;_<T.b2_maxManifoldPoints;++_){var w,k,x,S,C=v[_];f.x*C.v.x+f.y*C.v.y-g<=s&&(w=e.m_points[b],k=h.R,x=C.v.x-h.position.x,S=C.v.y-h.position.y,w.m_localPoint.x=x*k.col1.x+S*k.col1.y,w.m_localPoint.y=x*k.col2.x+S*k.col2.y,w.m_id.Set(C.id),w.m_id.features.flip=p,++b)}e.m_pointCount=b}}}},L.CollideCircles=function(e,t,i,n,o){e.m_pointCount=0;var s=i.R,r=t.m_p,a=i.position.x+(s.col1.x*r.x+s.col2.x*r.y),i=i.position.y+(s.col1.y*r.x+s.col2.y*r.y);s=o.R,r=n.m_p;a=o.position.x+(s.col1.x*r.x+s.col2.x*r.y)-a,r=o.position.y+(s.col1.y*r.x+s.col2.y*r.y)-i,i=t.m_radius+n.m_radius;i*i<a*a+r*r||(e.m_type=M.e_circles,e.m_localPoint.SetV(t.m_p),e.m_localPlaneNormal.SetZero(),e.m_pointCount=1,e.m_points[0].m_localPoint.SetV(n.m_p),e.m_points[0].m_id.key=0)},L.CollidePolygonAndCircle=function(e,t,i,n,o){e.m_pointCount=0;var s=o.R;g=n.m_p;var r=o.position.x+(s.col1.x*g.x+s.col2.x*g.y),o=o.position.y+(s.col1.y*g.x+s.col2.y*g.y);y=r-i.position.x,v=o-i.position.y;for(var a=y*(s=i.R).col1.x+v*s.col1.y,l=y*s.col2.x+v*s.col2.y,c=0,h=-Number.MAX_VALUE,u=t.m_radius+n.m_radius,p=parseInt(t.m_vertexCount),d=t.m_vertices,m=t.m_normals,f=0;f<p;++f){var g,y=a-(g=d[f]).x,v=l-g.y,b=(g=m[f]).x*y+g.y*v;if(u<b)return;h<b&&(h=b,c=f)}r=parseInt(c),o=parseInt(r+1<p?r+1:0),i=d[r],s=d[o];if(h<Number.MIN_VALUE)return e.m_pointCount=1,e.m_type=M.e_faceA,e.m_localPlaneNormal.SetV(m[c]),e.m_localPoint.x=.5*(i.x+s.x),e.m_localPoint.y=.5*(i.y+s.y),e.m_points[0].m_localPoint.SetV(n.m_p),void(e.m_points[0].m_id.key=0);t=(a-i.x)*(s.x-i.x)+(l-i.y)*(s.y-i.y),o=(a-s.x)*(i.x-s.x)+(l-s.y)*(i.y-s.y);t<=0?(a-i.x)*(a-i.x)+(l-i.y)*(l-i.y)>u*u||(e.m_pointCount=1,e.m_type=M.e_faceA,e.m_localPlaneNormal.x=a-i.x,e.m_localPlaneNormal.y=l-i.y,e.m_localPlaneNormal.Normalize(),e.m_localPoint.SetV(i),e.m_points[0].m_localPoint.SetV(n.m_p),e.m_points[0].m_id.key=0):o<=0?(a-s.x)*(a-s.x)+(l-s.y)*(l-s.y)>u*u||(e.m_pointCount=1,e.m_type=M.e_faceA,e.m_localPlaneNormal.x=a-s.x,e.m_localPlaneNormal.y=l-s.y,e.m_localPlaneNormal.Normalize(),e.m_localPoint.SetV(s),e.m_points[0].m_localPoint.SetV(n.m_p),e.m_points[0].m_id.key=0):(o=.5*(i.x+s.x),s=.5*(i.y+s.y),u<(h=(a-o)*m[r].x+(l-s)*m[r].y)||(e.m_pointCount=1,e.m_type=M.e_faceA,e.m_localPlaneNormal.x=m[r].x,e.m_localPlaneNormal.y=m[r].y,e.m_localPlaneNormal.Normalize(),e.m_localPoint.Set(o,s),e.m_points[0].m_localPoint.SetV(n.m_p),e.m_points[0].m_id.key=0))},L.TestOverlap=function(e,t){var i=t.lowerBound,n=e.upperBound,o=i.x-n.x,s=i.y-n.y,i=e.lowerBound,n=t.upperBound,t=i.x-n.x,n=i.y-n.y;return!(0<o||0<s)&&!(0<t||0<n)},B.postDefs.push(function(){B.Collision.b2Collision.s_incidentEdge=L.MakeClipPointVector(),B.Collision.b2Collision.s_clipPoints1=L.MakeClipPointVector(),B.Collision.b2Collision.s_clipPoints2=L.MakeClipPointVector(),B.Collision.b2Collision.s_edgeAO=new q(1),B.Collision.b2Collision.s_edgeBO=new q(1),B.Collision.b2Collision.s_localTangent=new S,B.Collision.b2Collision.s_localNormal=new S,B.Collision.b2Collision.s_planePoint=new S,B.Collision.b2Collision.s_normal=new S,B.Collision.b2Collision.s_tangent=new S,B.Collision.b2Collision.s_tangent2=new S,B.Collision.b2Collision.s_v11=new S,B.Collision.b2Collision.s_v12=new S,B.Collision.b2Collision.b2CollidePolyTempVec=new S,B.Collision.b2Collision.b2_nullFeature=255}),h.b2ContactID=function(){this.features=new V},h.prototype.b2ContactID=function(){this.features._m_id=this},h.prototype.Set=function(e){this.key=e._key},h.prototype.Copy=function(){var e=new h;return e.key=this.key,e},Object.defineProperty(h.prototype,"key",{enumerable:!1,configurable:!0,get:function(){return this._key}}),Object.defineProperty(h.prototype,"key",{enumerable:!1,configurable:!0,set:function(e){this._key=e=void 0===e?0:e,this.features._referenceEdge=255&this._key,this.features._incidentEdge=(65280&this._key)>>8&255,this.features._incidentVertex=(16711680&this._key)>>16&255,this.features._flip=(4278190080&this._key)>>24&255}}),u.b2ContactPoint=function(){this.position=new S,this.velocity=new S,this.normal=new S,this.id=new h},b.b2Distance=function(){},b.Distance=function(e,t,i){++b.b2_gjkCalls;var n=i.proxyA,o=i.proxyB,s=i.transformA,r=i.transformB,a=b.s_simplex;a.ReadCache(t,n,s,o,r);for(var l,c,h=a.m_vertices,u=b.s_saveA,p=b.s_saveB,d=(a.GetClosestPoint().LengthSquared(),0),m=0;m<20;){for(l=a.m_count,d=0;d<l;d++)u[d]=h[d].indexA,p[d]=h[d].indexB;switch(a.m_count){case 1:break;case 2:a.Solve2();break;case 3:a.Solve3();break;default:T.b2Assert(!1)}if(3==a.m_count)break;(f=a.GetClosestPoint()).LengthSquared();var f,g=a.GetSearchDirection();if(g.LengthSquared()<Number.MIN_VALUE*Number.MIN_VALUE)break;var y=h[a.m_count];y.indexA=n.GetSupport(x.MulTMV(s.R,g.GetNegative())),y.wA=x.MulX(s,n.GetVertex(y.indexA)),y.indexB=o.GetSupport(x.MulTMV(r.R,g)),y.wB=x.MulX(r,o.GetVertex(y.indexB)),y.w=x.SubtractVV(y.wB,y.wA),++m,++b.b2_gjkIters;for(var v=!1,d=0;d<l;d++)if(y.indexA==u[d]&&y.indexB==p[d]){v=!0;break}if(v)break;++a.m_count}b.b2_gjkMaxIters=x.Max(b.b2_gjkMaxIters,m),a.GetWitnessPoints(e.pointA,e.pointB),e.distance=x.SubtractVV(e.pointA,e.pointB).Length(),e.iterations=m,a.WriteCache(t),i.useRadii&&(c=n.m_radius,t=o.m_radius,e.distance>c+t&&e.distance>Number.MIN_VALUE?(e.distance-=c+t,(i=x.SubtractVV(e.pointB,e.pointA)).Normalize(),e.pointA.x+=c*i.x,e.pointA.y+=c*i.y,e.pointB.x-=t*i.x,e.pointB.y-=t*i.y):((f=new S).x=.5*(e.pointA.x+e.pointB.x),f.y=.5*(e.pointA.y+e.pointB.y),e.pointA.x=e.pointB.x=f.x,e.pointA.y=e.pointB.y=f.y,e.distance=0))},B.postDefs.push(function(){B.Collision.b2Distance.s_simplex=new R,B.Collision.b2Distance.s_saveA=new q(3),B.Collision.b2Distance.s_saveB=new q(3)}),p.b2DistanceInput=function(){},d.b2DistanceOutput=function(){this.pointA=new S,this.pointB=new S},m.b2DistanceProxy=function(){},m.prototype.Set=function(e){switch(e.GetType()){case s.e_circleShape:var t=e instanceof i?e:null;this.m_vertices=new W(1,!0),this.m_vertices[0]=t.m_p,this.m_count=1,this.m_radius=t.m_radius;break;case s.e_polygonShape:t=e instanceof o?e:null;this.m_vertices=t.m_vertices,this.m_count=t.m_vertexCount,this.m_radius=t.m_radius;break;default:T.b2Assert(!1)}},m.prototype.GetSupport=function(e){for(var t=0,i=this.m_vertices[0].x*e.x+this.m_vertices[0].y*e.y,n=1;n<this.m_count;++n){var o=this.m_vertices[n].x*e.x+this.m_vertices[n].y*e.y;i<o&&(t=n,i=o)}return t},m.prototype.GetSupportVertex=function(e){for(var t=0,i=this.m_vertices[0].x*e.x+this.m_vertices[0].y*e.y,n=1;n<this.m_count;++n){var o=this.m_vertices[n].x*e.x+this.m_vertices[n].y*e.y;i<o&&(t=n,i=o)}return this.m_vertices[t]},m.prototype.GetVertexCount=function(){return this.m_count},m.prototype.GetVertex=function(e){return T.b2Assert(0<=(e=void 0===e?0:e)&&e<this.m_count),this.m_vertices[e]},f.b2DynamicTree=function(){},f.prototype.b2DynamicTree=function(){this.m_root=null,this.m_freeList=null,this.m_path=0,this.m_insertionCount=0},f.prototype.CreateProxy=function(e,t){var i=this.AllocateNode(),n=T.b2_aabbExtension,o=T.b2_aabbExtension;return i.aabb.lowerBound.x=e.lowerBound.x-n,i.aabb.lowerBound.y=e.lowerBound.y-o,i.aabb.upperBound.x=e.upperBound.x+n,i.aabb.upperBound.y=e.upperBound.y+o,i.userData=t,this.InsertLeaf(i),i},f.prototype.DestroyProxy=function(e){this.RemoveLeaf(e),this.FreeNode(e)},f.prototype.MoveProxy=function(e,t,i){if(T.b2Assert(e.IsLeaf()),e.aabb.Contains(t))return!1;this.RemoveLeaf(e);var n=T.b2_aabbExtension+T.b2_aabbMultiplier*(0<i.x?i.x:-i.x),i=T.b2_aabbExtension+T.b2_aabbMultiplier*(0<i.y?i.y:-i.y);return e.aabb.lowerBound.x=t.lowerBound.x-n,e.aabb.lowerBound.y=t.lowerBound.y-i,e.aabb.upperBound.x=t.upperBound.x+n,e.aabb.upperBound.y=t.upperBound.y+i,this.InsertLeaf(e),!0},f.prototype.Rebalance=function(e){if(void 0===e&&(e=0),null!=this.m_root)for(var t=0;t<e;t++){for(var i=this.m_root,n=0;0==i.IsLeaf();)i=this.m_path>>n&1?i.child2:i.child1,n=n+1&31;++this.m_path,this.RemoveLeaf(i),this.InsertLeaf(i)}},f.prototype.GetFatAABB=function(e){return e.aabb},f.prototype.GetUserData=function(e){return e.userData},f.prototype.Query=function(e,t){if(null!=this.m_root){var i=new W,n=0;for(i[n++]=this.m_root;0<n;){var o=i[--n];if(o.aabb.TestOverlap(t))if(o.IsLeaf()){if(!e(o))return}else i[n++]=o.child1,i[n++]=o.child2}}},f.prototype.RayCast=function(e,t){if(null!=this.m_root){var i=t.p1,n=t.p2,o=x.SubtractVV(i,n);o.Normalize();var s=x.CrossFV(1,o),r=x.AbsV(s),a=t.maxFraction,l=new g,c=i.x+a*(n.x-i.x),h=i.y+a*(n.y-i.y);l.lowerBound.x=Math.min(i.x,c),l.lowerBound.y=Math.min(i.y,h),l.upperBound.x=Math.max(i.x,c),l.upperBound.y=Math.max(i.y,h);var u=new W,p=0;for(u[p++]=this.m_root;0<p;){var d=u[--p];if(0!=d.aabb.TestOverlap(l)){var m=d.aabb.GetCenter(),f=d.aabb.GetExtents();if(!(0<Math.abs(s.x*(i.x-m.x)+s.y*(i.y-m.y))-r.x*f.x-r.y*f.y))if(d.IsLeaf()){f=new C;if(f.p1=t.p1,f.p2=t.p2,f.maxFraction=t.maxFraction,0==(a=e(f,d)))return;0<a&&(c=i.x+a*(n.x-i.x),h=i.y+a*(n.y-i.y),l.lowerBound.x=Math.min(i.x,c),l.lowerBound.y=Math.min(i.y,h),l.upperBound.x=Math.max(i.x,c),l.upperBound.y=Math.max(i.y,h))}else u[p++]=d.child1,u[p++]=d.child2}}}},f.prototype.AllocateNode=function(){if(this.m_freeList){var e=this.m_freeList;return this.m_freeList=e.parent,e.parent=null,e.child1=null,e.child2=null,e}return new v},f.prototype.FreeNode=function(e){e.parent=this.m_freeList,this.m_freeList=e},f.prototype.InsertLeaf=function(e){if(++this.m_insertionCount,null==this.m_root)return this.m_root=e,void(this.m_root.parent=null);var t=e.aabb.GetCenter();if(0==(o=this.m_root).IsLeaf())do{var i=o.child1,n=o.child2,o=Math.abs((i.aabb.lowerBound.x+i.aabb.upperBound.x)/2-t.x)+Math.abs((i.aabb.lowerBound.y+i.aabb.upperBound.y)/2-t.y)<Math.abs((n.aabb.lowerBound.x+n.aabb.upperBound.x)/2-t.x)+Math.abs((n.aabb.lowerBound.y+n.aabb.upperBound.y)/2-t.y)?i:n}while(0==o.IsLeaf());var s=o.parent,r=this.AllocateNode();if(r.parent=s,r.userData=null,r.aabb.Combine(e.aabb,o.aabb),s)for(o.parent.child1==o?s.child1=r:s.child2=r,r.child1=o,r.child2=e,o.parent=r,e.parent=r;!s.aabb.Contains(r.aabb)&&(s.aabb.Combine(s.child1.aabb,s.child2.aabb),s=(r=s).parent););else r.child1=o,r.child2=e,o.parent=r,e.parent=r,this.m_root=r},f.prototype.RemoveLeaf=function(e){if(e!=this.m_root){var t=e.parent,i=t.parent,e=t.child1==e?t.child2:t.child1;if(i)for(i.child1==t?i.child1=e:i.child2=e,e.parent=i,this.FreeNode(t);i;){var n=i.aabb;if(i.aabb=g.Combine(i.child1.aabb,i.child2.aabb),n.Contains(i.aabb))break;i=i.parent}else(this.m_root=e).parent=null,this.FreeNode(t)}else this.m_root=null},y.b2DynamicTreeBroadPhase=function(){this.m_tree=new f,this.m_moveBuffer=new W,this.m_pairBuffer=new W,this.m_pairCount=0},y.prototype.CreateProxy=function(e,t){t=this.m_tree.CreateProxy(e,t);return++this.m_proxyCount,this.BufferMove(t),t},y.prototype.DestroyProxy=function(e){this.UnBufferMove(e),--this.m_proxyCount,this.m_tree.DestroyProxy(e)},y.prototype.MoveProxy=function(e,t,i){this.m_tree.MoveProxy(e,t,i)&&this.BufferMove(e)},y.prototype.TestOverlap=function(e,t){e=this.m_tree.GetFatAABB(e),t=this.m_tree.GetFatAABB(t);return e.TestOverlap(t)},y.prototype.GetUserData=function(e){return this.m_tree.GetUserData(e)},y.prototype.GetFatAABB=function(e){return this.m_tree.GetFatAABB(e)},y.prototype.GetProxyCount=function(){return this.m_proxyCount},y.prototype.UpdatePairs=function(e){var i=this,t=i.m_pairCount=0;for(t=0;t<i.m_moveBuffer.length;++t){function n(e){if(e==o)return!0;i.m_pairCount==i.m_pairBuffer.length&&(i.m_pairBuffer[i.m_pairCount]=new _);var t=i.m_pairBuffer[i.m_pairCount];return t.proxyA=e<o?e:o,t.proxyB=o<=e?e:o,++i.m_pairCount,!0}var o=i.m_moveBuffer[t],s=i.m_tree.GetFatAABB(o);i.m_tree.Query(n,s)}for(t=i.m_moveBuffer.length=0;t<i.m_pairCount;){var r=i.m_pairBuffer[t];for(e(i.m_tree.GetUserData(r.proxyA),i.m_tree.GetUserData(r.proxyB)),++t;t<i.m_pairCount;){var a=i.m_pairBuffer[t];if(a.proxyA!=r.proxyA||a.proxyB!=r.proxyB)break;++t}}},y.prototype.Query=function(e,t){this.m_tree.Query(e,t)},y.prototype.RayCast=function(e,t){this.m_tree.RayCast(e,t)},y.prototype.Validate=function(){},y.prototype.Rebalance=function(e){this.m_tree.Rebalance(e=void 0===e?0:e)},y.prototype.BufferMove=function(e){this.m_moveBuffer[this.m_moveBuffer.length]=e},y.prototype.UnBufferMove=function(e){e=parseInt(this.m_moveBuffer.indexOf(e));this.m_moveBuffer.splice(e,1)},y.prototype.ComparePairs=function(e,t){return 0},y.__implements={},y.__implements[O]=!0,v.b2DynamicTreeNode=function(){this.aabb=new g},v.prototype.IsLeaf=function(){return null==this.child1},_.b2DynamicTreePair=function(){},M.b2Manifold=function(){this.m_pointCount=0},M.prototype.b2Manifold=function(){this.m_points=new W(T.b2_maxManifoldPoints);for(var e=0;e<T.b2_maxManifoldPoints;e++)this.m_points[e]=new w;this.m_localPlaneNormal=new S,this.m_localPoint=new S},M.prototype.Reset=function(){for(var e=0;e<T.b2_maxManifoldPoints;e++)(this.m_points[e]instanceof w?this.m_points[e]:null).Reset();this.m_localPlaneNormal.SetZero(),this.m_localPoint.SetZero(),this.m_type=0,this.m_pointCount=0},M.prototype.Set=function(e){this.m_pointCount=e.m_pointCount;for(var t=0;t<T.b2_maxManifoldPoints;t++)(this.m_points[t]instanceof w?this.m_points[t]:null).Set(e.m_points[t]);this.m_localPlaneNormal.SetV(e.m_localPlaneNormal),this.m_localPoint.SetV(e.m_localPoint),this.m_type=e.m_type},M.prototype.Copy=function(){var e=new M;return e.Set(this),e},B.postDefs.push(function(){B.Collision.b2Manifold.e_circles=1,B.Collision.b2Manifold.e_faceA=2,B.Collision.b2Manifold.e_faceB=4}),w.b2ManifoldPoint=function(){this.m_localPoint=new S,this.m_id=new h},w.prototype.b2ManifoldPoint=function(){this.Reset()},w.prototype.Reset=function(){this.m_localPoint.SetZero(),this.m_normalImpulse=0,this.m_tangentImpulse=0,this.m_id.key=0},w.prototype.Set=function(e){this.m_localPoint.SetV(e.m_localPoint),this.m_normalImpulse=e.m_normalImpulse,this.m_tangentImpulse=e.m_tangentImpulse,this.m_id.Set(e.m_id)},k.b2Point=function(){this.p=new S},k.prototype.Support=function(e,t,i){return void 0===t&&(t=0),void 0===i&&(i=0),this.p},k.prototype.GetFirstVertex=function(e){return this.p},C.b2RayCastInput=function(){this.p1=new S,this.p2=new S},C.prototype.b2RayCastInput=function(e,t,i){void 0===t&&(t=null),void 0===i&&(i=1),(e=void 0===e?null:e)&&this.p1.SetV(e),t&&this.p2.SetV(t),this.maxFraction=i},D.b2RayCastOutput=function(){this.normal=new S},I.b2Segment=function(){this.p1=new S,this.p2=new S},I.prototype.TestSegment=function(e,t,i,n){void 0===n&&(n=0);var o=i.p1,s=i.p2.x-o.x,r=i.p2.y-o.y,a=this.p2.x-this.p1.x,l=this.p2.y-this.p1.y,c=-a,h=100*Number.MIN_VALUE,u=-(s*l+r*c);if(h<u){i=o.x-this.p1.x,a=o.y-this.p1.y,o=i*l+a*c;if(0<=o&&o<=n*u){i=-s*a+r*i;if(-h*u<=i&&i<=u*(1+h)){o/=u;u=Math.sqrt(l*l+c*c);return l/=u,c/=u,e[0]=o,t.Set(l,c),!0}}}return!1},I.prototype.Extend=function(e){this.ExtendForward(e),this.ExtendBackward(e)},I.prototype.ExtendForward=function(e){var t=this.p2.x-this.p1.x,i=this.p2.y-this.p1.y,e=Math.min(0<t?(e.upperBound.x-this.p1.x)/t:t<0?(e.lowerBound.x-this.p1.x)/t:Number.POSITIVE_INFINITY,0<i?(e.upperBound.y-this.p1.y)/i:i<0?(e.lowerBound.y-this.p1.y)/i:Number.POSITIVE_INFINITY);this.p2.x=this.p1.x+t*e,this.p2.y=this.p1.y+i*e},I.prototype.ExtendBackward=function(e){var t=-this.p2.x+this.p1.x,i=-this.p2.y+this.p1.y,e=Math.min(0<t?(e.upperBound.x-this.p2.x)/t:t<0?(e.lowerBound.x-this.p2.x)/t:Number.POSITIVE_INFINITY,0<i?(e.upperBound.y-this.p2.y)/i:i<0?(e.lowerBound.y-this.p2.y)/i:Number.POSITIVE_INFINITY);this.p1.x=this.p2.x+t*e,this.p1.y=this.p2.y+i*e},A.b2SeparationFunction=function(){this.m_localPoint=new S,this.m_axis=new S},A.prototype.Initialize=function(e,t,i,n,o){this.m_proxyA=t,this.m_proxyB=n;var s,r,a=parseInt(e.count);T.b2Assert(0<a&&a<3);var l,c,h,u,p,d,m,f,g=0,y=0,v=0,b=0,_=0,w=0,k=0;1==a?(this.m_type=A.e_points,s=this.m_proxyA.GetVertex(e.indexA[0]),r=this.m_proxyB.GetVertex(e.indexB[0]),c=s,l=i.R,g=i.position.x+(l.col1.x*c.x+l.col2.x*c.y),y=i.position.y+(l.col1.y*c.x+l.col2.y*c.y),c=r,l=o.R,v=o.position.x+(l.col1.x*c.x+l.col2.x*c.y),b=o.position.y+(l.col1.y*c.x+l.col2.y*c.y),this.m_axis.x=v-g,this.m_axis.y=b-y,this.m_axis.Normalize()):e.indexB[0]==e.indexB[1]?(this.m_type=A.e_faceA,h=this.m_proxyA.GetVertex(e.indexA[0]),u=this.m_proxyA.GetVertex(e.indexA[1]),r=this.m_proxyB.GetVertex(e.indexB[0]),this.m_localPoint.x=.5*(h.x+u.x),this.m_localPoint.y=.5*(h.y+u.y),this.m_axis=x.CrossVF(x.SubtractVV(u,h),1),this.m_axis.Normalize(),c=this.m_axis,_=(l=i.R).col1.x*c.x+l.col2.x*c.y,w=l.col1.y*c.x+l.col2.y*c.y,c=this.m_localPoint,l=i.R,g=i.position.x+(l.col1.x*c.x+l.col2.x*c.y),y=i.position.y+(l.col1.y*c.x+l.col2.y*c.y),c=r,l=o.R,(k=((v=o.position.x+(l.col1.x*c.x+l.col2.x*c.y))-g)*_+((b=o.position.y+(l.col1.y*c.x+l.col2.y*c.y))-y)*w)<0&&this.m_axis.NegativeSelf()):e.indexA[0]==e.indexA[0]?(this.m_type=A.e_faceB,p=this.m_proxyB.GetVertex(e.indexB[0]),d=this.m_proxyB.GetVertex(e.indexB[1]),s=this.m_proxyA.GetVertex(e.indexA[0]),this.m_localPoint.x=.5*(p.x+d.x),this.m_localPoint.y=.5*(p.y+d.y),this.m_axis=x.CrossVF(x.SubtractVV(d,p),1),this.m_axis.Normalize(),c=this.m_axis,_=(l=o.R).col1.x*c.x+l.col2.x*c.y,w=l.col1.y*c.x+l.col2.y*c.y,c=this.m_localPoint,l=o.R,v=o.position.x+(l.col1.x*c.x+l.col2.x*c.y),b=o.position.y+(l.col1.y*c.x+l.col2.y*c.y),c=s,l=i.R,(k=((g=i.position.x+(l.col1.x*c.x+l.col2.x*c.y))-v)*_+((y=i.position.y+(l.col1.y*c.x+l.col2.y*c.y))-b)*w)<0&&this.m_axis.NegativeSelf()):(h=this.m_proxyA.GetVertex(e.indexA[0]),u=this.m_proxyA.GetVertex(e.indexA[1]),p=this.m_proxyB.GetVertex(e.indexB[0]),d=this.m_proxyB.GetVertex(e.indexB[1]),x.MulX(i,s),m=x.MulMV(i.R,x.SubtractVV(u,h)),x.MulX(o,r),f=x.MulMV(o.R,x.SubtractVV(d,p)),t=m.x*m.x+m.y*m.y,n=f.x*f.x+f.y*f.y,a=x.SubtractVV(f,m),e=m.x*a.x+m.y*a.y,a=f.x*a.x+f.y*a.y,((m=m.x*f.x+m.y*f.y)*(k=(k=0)!=(f=t*n-m*m)?x.Clamp((m*a-e*n)/f,0,1):k)+a)/n<0&&(k=x.Clamp((m-e)/t,0,1)),(s=new S).x=h.x+k*(u.x-h.x),s.y=h.y+k*(u.y-h.y),(r=new S).x=p.x+k*(d.x-p.x),r.y=p.y+k*(d.y-p.y),0==k||1==k?(this.m_type=A.e_faceB,this.m_axis=x.CrossVF(x.SubtractVV(d,p),1),this.m_axis.Normalize(),this.m_localPoint=r,c=this.m_axis,_=(l=o.R).col1.x*c.x+l.col2.x*c.y,w=l.col1.y*c.x+l.col2.y*c.y,c=this.m_localPoint,l=o.R,v=o.position.x+(l.col1.x*c.x+l.col2.x*c.y),b=o.position.y+(l.col1.y*c.x+l.col2.y*c.y),c=s,l=i.R,g=i.position.x+(l.col1.x*c.x+l.col2.x*c.y),y=i.position.y+(l.col1.y*c.x+l.col2.y*c.y)):(this.m_type=A.e_faceA,this.m_axis=x.CrossVF(x.SubtractVV(u,h),1),this.m_localPoint=s,c=this.m_axis,_=(l=i.R).col1.x*c.x+l.col2.x*c.y,w=l.col1.y*c.x+l.col2.y*c.y,c=this.m_localPoint,l=i.R,g=i.position.x+(l.col1.x*c.x+l.col2.x*c.y),y=i.position.y+(l.col1.y*c.x+l.col2.y*c.y),c=r,l=o.R,v=o.position.x+(l.col1.x*c.x+l.col2.x*c.y),b=o.position.y+(l.col1.y*c.x+l.col2.y*c.y)),k<0&&this.m_axis.NegativeSelf())},A.prototype.Evaluate=function(e,t){var i,n,o,s,r,a,l;switch(this.m_type){case A.e_points:return i=x.MulTMV(e.R,this.m_axis),n=x.MulTMV(t.R,this.m_axis.GetNegative()),o=this.m_proxyA.GetSupportVertex(i),s=this.m_proxyB.GetSupportVertex(n),r=x.MulX(e,o),((a=x.MulX(t,s)).x-r.x)*this.m_axis.x+(a.y-r.y)*this.m_axis.y;case A.e_faceA:return l=x.MulMV(e.R,this.m_axis),r=x.MulX(e,this.m_localPoint),n=x.MulTMV(t.R,l.GetNegative()),s=this.m_proxyB.GetSupportVertex(n),((a=x.MulX(t,s)).x-r.x)*l.x+(a.y-r.y)*l.y;case A.e_faceB:return l=x.MulMV(t.R,this.m_axis),a=x.MulX(t,this.m_localPoint),i=x.MulTMV(e.R,l.GetNegative()),o=this.m_proxyA.GetSupportVertex(i),((r=x.MulX(e,o)).x-a.x)*l.x+(r.y-a.y)*l.y;default:return T.b2Assert(!1),0}},B.postDefs.push(function(){B.Collision.b2SeparationFunction.e_points=1,B.Collision.b2SeparationFunction.e_faceA=2,B.Collision.b2SeparationFunction.e_faceB=4}),R.b2Simplex=function(){this.m_v1=new E,this.m_v2=new E,this.m_v3=new E,this.m_vertices=new W(3)},R.prototype.b2Simplex=function(){this.m_vertices[0]=this.m_v1,this.m_vertices[1]=this.m_v2,this.m_vertices[2]=this.m_v3},R.prototype.ReadCache=function(e,t,i,n,o){var s,r;T.b2Assert(0<=e.count&&e.count<=3),this.m_count=e.count;for(var a,l,c=this.m_vertices,h=0;h<this.m_count;h++){var u=c[h];u.indexA=e.indexA[h],u.indexB=e.indexB[h],s=t.GetVertex(u.indexA),r=n.GetVertex(u.indexB),u.wA=x.MulX(i,s),u.wB=x.MulX(o,r),u.w=x.SubtractVV(u.wB,u.wA),u.a=0}1<this.m_count&&(a=e.metric,((l=this.GetMetric())<.5*a||2*a<l||l<Number.MIN_VALUE)&&(this.m_count=0)),0==this.m_count&&((u=c[0]).indexA=0,u.indexB=0,s=t.GetVertex(0),r=n.GetVertex(0),u.wA=x.MulX(i,s),u.wB=x.MulX(o,r),u.w=x.SubtractVV(u.wB,u.wA),this.m_count=1)},R.prototype.WriteCache=function(e){e.metric=this.GetMetric(),e.count=B.parseUInt(this.m_count);for(var t=this.m_vertices,i=0;i<this.m_count;i++)e.indexA[i]=B.parseUInt(t[i].indexA),e.indexB[i]=B.parseUInt(t[i].indexB)},R.prototype.GetSearchDirection=function(){switch(this.m_count){case 1:return this.m_v1.w.GetNegative();case 2:var e=x.SubtractVV(this.m_v2.w,this.m_v1.w);return 0<x.CrossVV(e,this.m_v1.w.GetNegative())?x.CrossFV(1,e):x.CrossVF(e,1);default:return T.b2Assert(!1),new S}},R.prototype.GetClosestPoint=function(){switch(this.m_count){case 0:return T.b2Assert(!1),new S;case 1:return this.m_v1.w;case 2:return new S(this.m_v1.a*this.m_v1.w.x+this.m_v2.a*this.m_v2.w.x,this.m_v1.a*this.m_v1.w.y+this.m_v2.a*this.m_v2.w.y);default:return T.b2Assert(!1),new S}},R.prototype.GetWitnessPoints=function(e,t){switch(this.m_count){case 0:T.b2Assert(!1);break;case 1:e.SetV(this.m_v1.wA),t.SetV(this.m_v1.wB);break;case 2:e.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x,e.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y,t.x=this.m_v1.a*this.m_v1.wB.x+this.m_v2.a*this.m_v2.wB.x,t.y=this.m_v1.a*this.m_v1.wB.y+this.m_v2.a*this.m_v2.wB.y;break;case 3:t.x=e.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x+this.m_v3.a*this.m_v3.wA.x,t.y=e.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y+this.m_v3.a*this.m_v3.wA.y;break;default:T.b2Assert(!1)}},R.prototype.GetMetric=function(){switch(this.m_count){case 0:return T.b2Assert(!1),0;case 1:return 0;case 2:return x.SubtractVV(this.m_v1.w,this.m_v2.w).Length();case 3:return x.CrossVV(x.SubtractVV(this.m_v2.w,this.m_v1.w),x.SubtractVV(this.m_v3.w,this.m_v1.w));default:return T.b2Assert(!1),0}},R.prototype.Solve2=function(){var e=this.m_v1.w,t=this.m_v2.w,i=x.SubtractVV(t,e),e=-(e.x*i.x+e.y*i.y);if(e<=0)return this.m_v1.a=1,void(this.m_count=1);t=t.x*i.x+t.y*i.y;if(t<=0)return this.m_v2.a=1,this.m_count=1,void this.m_v1.Set(this.m_v2);i=1/(t+e);this.m_v1.a=t*i,this.m_v2.a=e*i,this.m_count=2},R.prototype.Solve3=function(){var e=this.m_v1.w,t=this.m_v2.w,i=this.m_v3.w,n=x.SubtractVV(t,e),o=x.Dot(e,n),s=x.Dot(t,n),r=-o,a=x.SubtractVV(i,e),l=x.Dot(e,a),c=x.Dot(i,a),h=-l,o=x.SubtractVV(i,t),l=x.Dot(t,o),o=x.Dot(i,o),l=-l,n=x.CrossVV(n,a),a=n*x.CrossVV(t,i),i=n*x.CrossVV(i,e),t=n*x.CrossVV(e,t);if(r<=0&&h<=0)return this.m_v1.a=1,void(this.m_count=1);if(0<s&&0<r&&t<=0){var u=1/(s+r);return this.m_v1.a=s*u,this.m_v2.a=r*u,void(this.m_count=2)}if(0<c&&0<h&&i<=0){u=1/(c+h);return this.m_v1.a=c*u,this.m_v3.a=h*u,this.m_count=2,void this.m_v2.Set(this.m_v3)}if(s<=0&&l<=0)return this.m_v2.a=1,this.m_count=1,void this.m_v1.Set(this.m_v2);if(c<=0&&o<=0)return this.m_v3.a=1,this.m_count=1,void this.m_v1.Set(this.m_v3);if(0<o&&0<l&&a<=0){var p=1/(o+l);return this.m_v2.a=o*p,this.m_v3.a=l*p,this.m_count=2,void this.m_v1.Set(this.m_v3)}p=1/(a+i+t);this.m_v1.a=a*p,this.m_v2.a=i*p,this.m_v3.a=t*p,this.m_count=3},P.b2SimplexCache=function(){this.indexA=new q(3),this.indexB=new q(3)},E.b2SimplexVertex=function(){},E.prototype.Set=function(e){this.wA.SetV(e.wA),this.wB.SetV(e.wB),this.w.SetV(e.w),this.a=e.a,this.indexA=e.indexA,this.indexB=e.indexB},F.b2TimeOfImpact=function(){},F.TimeOfImpact=function(e){++F.b2_toiCalls;var t=e.proxyA,i=e.proxyB,n=e.sweepA,o=e.sweepB;T.b2Assert(n.t0==o.t0),T.b2Assert(1-n.t0>Number.MIN_VALUE);var s=t.m_radius+i.m_radius,r=e.tolerance,a=0,l=0,c=0;for(F.s_cache.count=0,F.s_distanceInput.useRadii=!1;;){if(n.GetTransform(F.s_xfA,a),o.GetTransform(F.s_xfB,a),F.s_distanceInput.proxyA=t,F.s_distanceInput.proxyB=i,F.s_distanceInput.transformA=F.s_xfA,F.s_distanceInput.transformB=F.s_xfB,b.Distance(F.s_distanceOutput,F.s_cache,F.s_distanceInput),F.s_distanceOutput.distance<=0){a=1;break}F.s_fcn.Initialize(F.s_cache,t,F.s_xfA,i,F.s_xfB);var h=F.s_fcn.Evaluate(F.s_xfA,F.s_xfB);if(h<=0){a=1;break}if(h-(c=0==l?s<h?x.Max(s-r,.75*s):x.Max(h-r,.02*s):c)<.5*r){if(0!=l)break;a=1;break}var u=a,p=a,d=1,m=h;n.GetTransform(F.s_xfA,d),o.GetTransform(F.s_xfB,d);var f=F.s_fcn.Evaluate(F.s_xfA,F.s_xfB);if(c<=f){a=1;break}for(var g=0;;){var y=0,y=1&g?p+(c-m)*(d-p)/(f-m):.5*(p+d);n.GetTransform(F.s_xfA,y),o.GetTransform(F.s_xfB,y);var v=F.s_fcn.Evaluate(F.s_xfA,F.s_xfB);if(x.Abs(v-c)<.025*r){u=y;break}if(c<v?(p=y,m=v):(d=y,f=v),++g,++F.b2_toiRootIters,50==g)break}if(F.b2_toiMaxRootIters=x.Max(F.b2_toiMaxRootIters,g),u<(1+100*Number.MIN_VALUE)*a)break;if(a=u,l++,++F.b2_toiIters,1e3==l)break}return F.b2_toiMaxIters=x.Max(F.b2_toiMaxIters,l),a},B.postDefs.push(function(){B.Collision.b2TimeOfImpact.b2_toiCalls=0,B.Collision.b2TimeOfImpact.b2_toiIters=0,B.Collision.b2TimeOfImpact.b2_toiMaxIters=0,B.Collision.b2TimeOfImpact.b2_toiRootIters=0,B.Collision.b2TimeOfImpact.b2_toiMaxRootIters=0,B.Collision.b2TimeOfImpact.s_cache=new P,B.Collision.b2TimeOfImpact.s_distanceInput=new p,B.Collision.b2TimeOfImpact.s_xfA=new a,B.Collision.b2TimeOfImpact.s_xfB=new a,B.Collision.b2TimeOfImpact.s_fcn=new A,B.Collision.b2TimeOfImpact.s_distanceOutput=new d}),N.b2TOIInput=function(){this.proxyA=new m,this.proxyB=new m,this.sweepA=new r,this.sweepB=new r},G.b2WorldManifold=function(){this.m_normal=new S},G.prototype.b2WorldManifold=function(){this.m_points=new W(T.b2_maxManifoldPoints);for(var e=0;e<T.b2_maxManifoldPoints;e++)this.m_points[e]=new S},G.prototype.Initialize=function(e,t,i,n,o){if(void 0===i&&(i=0),void 0===o&&(o=0),0!=e.m_pointCount){var s=0,r=0,a=0,l=0,c=0,h=0,u=0;switch(e.m_type){case M.e_circles:var p=t.R,d=e.m_localPoint,m=t.position.x+p.col1.x*d.x+p.col2.x*d.y,f=t.position.y+p.col1.y*d.x+p.col2.y*d.y;p=n.R,d=e.m_points[0].m_localPoint;var g=n.position.x+p.col1.x*d.x+p.col2.x*d.y,y=n.position.y+p.col1.y*d.x+p.col2.y*d.y,v=g-m,b=y-f,_=v*v+b*b;_>Number.MIN_VALUE*Number.MIN_VALUE?(_=Math.sqrt(_),this.m_normal.x=v/_,this.m_normal.y=b/_):(this.m_normal.x=1,this.m_normal.y=0);m=m+i*this.m_normal.x,f=f+i*this.m_normal.y,g=g-o*this.m_normal.x,y=y-o*this.m_normal.y;this.m_points[0].x=.5*(m+g),this.m_points[0].y=.5*(f+y);break;case M.e_faceA:for(p=t.R,d=e.m_localPlaneNormal,r=p.col1.x*d.x+p.col2.x*d.y,a=p.col1.y*d.x+p.col2.y*d.y,p=t.R,d=e.m_localPoint,l=t.position.x+p.col1.x*d.x+p.col2.x*d.y,c=t.position.y+p.col1.y*d.x+p.col2.y*d.y,this.m_normal.x=r,this.m_normal.y=a,s=0;s<e.m_pointCount;s++)p=n.R,d=e.m_points[s].m_localPoint,h=n.position.x+p.col1.x*d.x+p.col2.x*d.y,u=n.position.y+p.col1.y*d.x+p.col2.y*d.y,this.m_points[s].x=h+.5*(i-(h-l)*r-(u-c)*a-o)*r,this.m_points[s].y=u+.5*(i-(h-l)*r-(u-c)*a-o)*a;break;case M.e_faceB:for(p=n.R,d=e.m_localPlaneNormal,r=p.col1.x*d.x+p.col2.x*d.y,a=p.col1.y*d.x+p.col2.y*d.y,p=n.R,d=e.m_localPoint,l=n.position.x+p.col1.x*d.x+p.col2.x*d.y,c=n.position.y+p.col1.y*d.x+p.col2.y*d.y,this.m_normal.x=-r,this.m_normal.y=-a,s=0;s<e.m_pointCount;s++)p=t.R,d=e.m_points[s].m_localPoint,h=t.position.x+p.col1.x*d.x+p.col2.x*d.y,u=t.position.y+p.col1.y*d.x+p.col2.y*d.y,this.m_points[s].x=h+.5*(o-(h-l)*r-(u-c)*a-i)*r,this.m_points[s].y=u+.5*(o-(h-l)*r-(u-c)*a-i)*a}}},U.ClipVertex=function(){this.v=new S,this.id=new h},U.prototype.Set=function(e){this.v.SetV(e.v),this.id.Set(e.id)},V.Features=function(){},Object.defineProperty(V.prototype,"referenceEdge",{enumerable:!1,configurable:!0,get:function(){return this._referenceEdge}}),Object.defineProperty(V.prototype,"referenceEdge",{enumerable:!1,configurable:!0,set:function(e){this._referenceEdge=e=void 0===e?0:e,this._m_id._key=4294967040&this._m_id._key|255&this._referenceEdge}}),Object.defineProperty(V.prototype,"incidentEdge",{enumerable:!1,configurable:!0,get:function(){return this._incidentEdge}}),Object.defineProperty(V.prototype,"incidentEdge",{enumerable:!1,configurable:!0,set:function(e){this._incidentEdge=e=void 0===e?0:e,this._m_id._key=4294902015&this._m_id._key|this._incidentEdge<<8&65280}}),Object.defineProperty(V.prototype,"incidentVertex",{enumerable:!1,configurable:!0,get:function(){return this._incidentVertex}}),Object.defineProperty(V.prototype,"incidentVertex",{enumerable:!1,configurable:!0,set:function(e){this._incidentVertex=e=void 0===e?0:e,this._m_id._key=4278255615&this._m_id._key|this._incidentVertex<<16&16711680}}),Object.defineProperty(V.prototype,"flip",{enumerable:!1,configurable:!0,get:function(){return this._flip}}),Object.defineProperty(V.prototype,"flip",{enumerable:!1,configurable:!0,set:function(e){this._flip=e=void 0===e?0:e,this._m_id._key=16777215&this._m_id._key|this._flip<<24&4278190080}}),function(){B.Common.b2Color,B.Common.b2internal;var s=B.Common.b2Settings,t=B.Collision.Shapes.b2CircleShape,e=B.Collision.Shapes.b2EdgeChainDef,i=B.Collision.Shapes.b2EdgeShape,x=B.Collision.Shapes.b2MassData,r=B.Collision.Shapes.b2PolygonShape,n=B.Collision.Shapes.b2Shape,o=B.Common.Math.b2Mat22,S=(B.Common.Math.b2Mat33,B.Common.Math.b2Math),a=(B.Common.Math.b2Sweep,B.Common.Math.b2Transform),C=B.Common.Math.b2Vec2,l=(B.Common.Math.b2Vec3,B.Dynamics.b2Body,B.Dynamics.b2BodyDef,B.Dynamics.b2ContactFilter,B.Dynamics.b2ContactImpulse,B.Dynamics.b2ContactListener,B.Dynamics.b2ContactManager,B.Dynamics.b2DebugDraw,B.Dynamics.b2DestructionListener,B.Dynamics.b2FilterData,B.Dynamics.b2Fixture,B.Dynamics.b2FixtureDef,B.Dynamics.b2Island,B.Dynamics.b2TimeStep,B.Dynamics.b2World,B.Collision.b2AABB,B.Collision.b2Bound,B.Collision.b2BoundValues,B.Collision.b2Collision,B.Collision.b2ContactID,B.Collision.b2ContactPoint,B.Collision.b2Distance),c=B.Collision.b2DistanceInput,h=B.Collision.b2DistanceOutput,u=B.Collision.b2DistanceProxy,p=(B.Collision.b2DynamicTree,B.Collision.b2DynamicTreeBroadPhase,B.Collision.b2DynamicTreeNode,B.Collision.b2DynamicTreePair,B.Collision.b2Manifold,B.Collision.b2ManifoldPoint,B.Collision.b2Point,B.Collision.b2RayCastInput,B.Collision.b2RayCastOutput,B.Collision.b2Segment,B.Collision.b2SeparationFunction,B.Collision.b2Simplex,B.Collision.b2SimplexCache);B.Collision.b2SimplexVertex,B.Collision.b2TimeOfImpact,B.Collision.b2TOIInput,B.Collision.b2WorldManifold,B.Collision.ClipVertex,B.Collision.Features,B.Collision.IBroadPhase;B.inherit(t,B.Collision.Shapes.b2Shape),t.prototype.__super=B.Collision.Shapes.b2Shape.prototype,t.b2CircleShape=function(){B.Collision.Shapes.b2Shape.b2Shape.apply(this,arguments),this.m_p=new C},t.prototype.Copy=function(){var e=new t;return e.Set(this),e},t.prototype.Set=function(e){this.__super.Set.call(this,e),B.is(e,t)&&this.m_p.SetV((e instanceof t?e:null).m_p)},t.prototype.TestPoint=function(e,t){var i=e.R,n=e.position.x+(i.col1.x*this.m_p.x+i.col2.x*this.m_p.y),i=e.position.y+(i.col1.y*this.m_p.x+i.col2.y*this.m_p.y);return(n=t.x-n)*n+(i=t.y-i)*i<=this.m_radius*this.m_radius},t.prototype.RayCast=function(e,t,i){var n=i.R,o=i.position.x+(n.col1.x*this.m_p.x+n.col2.x*this.m_p.y),s=i.position.y+(n.col1.y*this.m_p.x+n.col2.y*this.m_p.y),r=t.p1.x-o,a=t.p1.y-s,l=r*r+a*a-this.m_radius*this.m_radius,i=t.p2.x-t.p1.x,n=t.p2.y-t.p1.y,o=r*i+a*n,s=i*i+n*n,l=o*o-s*l;if(l<0||s<Number.MIN_VALUE)return!1;l=-(o+Math.sqrt(l));return 0<=l&&l<=t.maxFraction*s&&(e.fraction=l/=s,e.normal.x=r+l*i,e.normal.y=a+l*n,e.normal.Normalize(),!0)},t.prototype.ComputeAABB=function(e,t){var i=t.R,n=t.position.x+(i.col1.x*this.m_p.x+i.col2.x*this.m_p.y),i=t.position.y+(i.col1.y*this.m_p.x+i.col2.y*this.m_p.y);e.lowerBound.Set(n-this.m_radius,i-this.m_radius),e.upperBound.Set(n+this.m_radius,i+this.m_radius)},t.prototype.ComputeMass=function(e,t){e.mass=(t=void 0===t?0:t)*s.b2_pi*this.m_radius*this.m_radius,e.center.SetV(this.m_p),e.I=e.mass*(.5*this.m_radius*this.m_radius+(this.m_p.x*this.m_p.x+this.m_p.y*this.m_p.y))},t.prototype.ComputeSubmergedArea=function(e,t,i,n){void 0===t&&(t=0);var o=S.MulX(i,this.m_p),s=-(S.Dot(e,o)-t);if(s<-this.m_radius+Number.MIN_VALUE)return 0;if(s>this.m_radius)return n.SetV(o),Math.PI*this.m_radius*this.m_radius;i=this.m_radius*this.m_radius,t=s*s,s=i*(Math.asin(s/this.m_radius)+Math.PI/2)+s*Math.sqrt(i-t),t=-2/3*Math.pow(i-t,1.5)/s;return n.x=o.x+e.x*t,n.y=o.y+e.y*t,s},t.prototype.GetLocalPosition=function(){return this.m_p},t.prototype.SetLocalPosition=function(e){this.m_p.SetV(e)},t.prototype.GetRadius=function(){return this.m_radius},t.prototype.SetRadius=function(e){this.m_radius=e=void 0===e?0:e},t.prototype.b2CircleShape=function(e){void 0===e&&(e=0),this.__super.b2Shape.call(this),this.m_type=n.e_circleShape,this.m_radius=e},e.b2EdgeChainDef=function(){},e.prototype.b2EdgeChainDef=function(){this.vertexCount=0,this.isALoop=!0,this.vertices=[]},B.inherit(i,B.Collision.Shapes.b2Shape),i.prototype.__super=B.Collision.Shapes.b2Shape.prototype,i.b2EdgeShape=function(){B.Collision.Shapes.b2Shape.b2Shape.apply(this,arguments),this.s_supportVec=new C,this.m_v1=new C,this.m_v2=new C,this.m_coreV1=new C,this.m_coreV2=new C,this.m_normal=new C,this.m_direction=new C,this.m_cornerDir1=new C,this.m_cornerDir2=new C},i.prototype.TestPoint=function(e,t){return!1},i.prototype.RayCast=function(e,t,i){var n=t.p2.x-t.p1.x,o=t.p2.y-t.p1.y,s=i.R,r=i.position.x+(s.col1.x*this.m_v1.x+s.col2.x*this.m_v1.y),a=i.position.y+(s.col1.y*this.m_v1.x+s.col2.y*this.m_v1.y),l=i.position.y+(s.col1.y*this.m_v2.x+s.col2.y*this.m_v2.y)-a,c=-(i.position.x+(s.col1.x*this.m_v2.x+s.col2.x*this.m_v2.y)-r),h=100*Number.MIN_VALUE,i=-(n*l+o*c);if(h<i){s=t.p1.x-r,r=t.p1.y-a,a=s*l+r*c;if(0<=a&&a<=t.maxFraction*i){s=-n*r+o*s;if(-h*i<=s&&s<=i*(1+h)){e.fraction=a/=i;a=Math.sqrt(l*l+c*c);return e.normal.x=l/a,e.normal.y=c/a,!0}}}return!1},i.prototype.ComputeAABB=function(e,t){var i=t.R,n=t.position.x+(i.col1.x*this.m_v1.x+i.col2.x*this.m_v1.y),o=t.position.y+(i.col1.y*this.m_v1.x+i.col2.y*this.m_v1.y),s=t.position.x+(i.col1.x*this.m_v2.x+i.col2.x*this.m_v2.y),i=t.position.y+(i.col1.y*this.m_v2.x+i.col2.y*this.m_v2.y);n<s?(e.lowerBound.x=n,e.upperBound.x=s):(e.lowerBound.x=s,e.upperBound.x=n),o<i?(e.lowerBound.y=o,e.upperBound.y=i):(e.lowerBound.y=i,e.upperBound.y=o)},i.prototype.ComputeMass=function(e,t){void 0===t&&(t=0),e.mass=0,e.center.SetV(this.m_v1),e.I=0},i.prototype.ComputeSubmergedArea=function(e,t,i,n){var o=new C(e.x*(t=void 0===t?0:t),e.y*t),s=S.MulX(i,this.m_v1),r=S.MulX(i,this.m_v2),i=S.Dot(e,s)-t,t=S.Dot(e,r)-t;if(0<i){if(0<t)return 0;s.x=-t/(i-t)*s.x+i/(i-t)*r.x,s.y=-t/(i-t)*s.y+i/(i-t)*r.y}else 0<t&&(r.x=-t/(i-t)*s.x+i/(i-t)*r.x,r.y=-t/(i-t)*s.y+i/(i-t)*r.y);return n.x=(o.x+s.x+r.x)/3,n.y=(o.y+s.y+r.y)/3,.5*((s.x-o.x)*(r.y-o.y)-(s.y-o.y)*(r.x-o.x))},i.prototype.GetLength=function(){return this.m_length},i.prototype.GetVertex1=function(){return this.m_v1},i.prototype.GetVertex2=function(){return this.m_v2},i.prototype.GetCoreVertex1=function(){return this.m_coreV1},i.prototype.GetCoreVertex2=function(){return this.m_coreV2},i.prototype.GetNormalVector=function(){return this.m_normal},i.prototype.GetDirectionVector=function(){return this.m_direction},i.prototype.GetCorner1Vector=function(){return this.m_cornerDir1},i.prototype.GetCorner2Vector=function(){return this.m_cornerDir2},i.prototype.Corner1IsConvex=function(){return this.m_cornerConvex1},i.prototype.Corner2IsConvex=function(){return this.m_cornerConvex2},i.prototype.GetFirstVertex=function(e){var t=e.R;return new C(e.position.x+(t.col1.x*this.m_coreV1.x+t.col2.x*this.m_coreV1.y),e.position.y+(t.col1.y*this.m_coreV1.x+t.col2.y*this.m_coreV1.y))},i.prototype.GetNextEdge=function(){return this.m_nextEdge},i.prototype.GetPrevEdge=function(){return this.m_prevEdge},i.prototype.Support=function(e,t,i){var n=e.R,o=e.position.x+(n.col1.x*this.m_coreV1.x+n.col2.x*this.m_coreV1.y),s=e.position.y+(n.col1.y*this.m_coreV1.x+n.col2.y*this.m_coreV1.y),r=e.position.x+(n.col1.x*this.m_coreV2.x+n.col2.x*this.m_coreV2.y),n=e.position.y+(n.col1.y*this.m_coreV2.x+n.col2.y*this.m_coreV2.y);return r*(t=void 0===t?0:t)+n*(i=void 0===i?0:i)<o*t+s*i?(this.s_supportVec.x=o,this.s_supportVec.y=s):(this.s_supportVec.x=r,this.s_supportVec.y=n),this.s_supportVec},i.prototype.b2EdgeShape=function(e,t){this.__super.b2Shape.call(this),this.m_type=n.e_edgeShape,this.m_prevEdge=null,this.m_nextEdge=null,this.m_v1=e,this.m_v2=t,this.m_direction.Set(this.m_v2.x-this.m_v1.x,this.m_v2.y-this.m_v1.y),this.m_length=this.m_direction.Normalize(),this.m_normal.Set(this.m_direction.y,-this.m_direction.x),this.m_coreV1.Set(-s.b2_toiSlop*(this.m_normal.x-this.m_direction.x)+this.m_v1.x,-s.b2_toiSlop*(this.m_normal.y-this.m_direction.y)+this.m_v1.y),this.m_coreV2.Set(-s.b2_toiSlop*(this.m_normal.x+this.m_direction.x)+this.m_v2.x,-s.b2_toiSlop*(this.m_normal.y+this.m_direction.y)+this.m_v2.y),this.m_cornerDir1=this.m_normal,this.m_cornerDir2.Set(-this.m_normal.x,-this.m_normal.y)},i.prototype.SetPrevEdge=function(e,t,i,n){this.m_prevEdge=e,this.m_coreV1=t,this.m_cornerDir1=i,this.m_cornerConvex1=n},i.prototype.SetNextEdge=function(e,t,i,n){this.m_nextEdge=e,this.m_coreV2=t,this.m_cornerDir2=i,this.m_cornerConvex2=n},x.b2MassData=function(){this.mass=0,this.center=new C(0,0),this.I=0},B.inherit(r,B.Collision.Shapes.b2Shape),r.prototype.__super=B.Collision.Shapes.b2Shape.prototype,r.b2PolygonShape=function(){B.Collision.Shapes.b2Shape.b2Shape.apply(this,arguments)},r.prototype.Copy=function(){var e=new r;return e.Set(this),e},r.prototype.Set=function(e){if(this.__super.Set.call(this,e),B.is(e,r)){var t=e instanceof r?e:null;this.m_centroid.SetV(t.m_centroid),this.m_vertexCount=t.m_vertexCount,this.Reserve(this.m_vertexCount);for(var i=0;i<this.m_vertexCount;i++)this.m_vertices[i].SetV(t.m_vertices[i]),this.m_normals[i].SetV(t.m_normals[i])}},r.prototype.SetAsArray=function(e,t){void 0===t&&(t=0);for(var i,n=new W,o=0,o=0;o<e.length;++o)i=e[o],n.push(i);this.SetAsVector(n,t)},r.AsArray=function(e,t){void 0===t&&(t=0);var i=new r;return i.SetAsArray(e,t),i},r.prototype.SetAsVector=function(e,t){0==(t=void 0===t?0:t)&&(t=e.length),s.b2Assert(2<=t),this.m_vertexCount=t,this.Reserve(t);for(var i=0,i=0;i<this.m_vertexCount;i++)this.m_vertices[i].SetV(e[i]);for(i=0;i<this.m_vertexCount;++i){var n=parseInt(i),o=parseInt(i+1<this.m_vertexCount?i+1:0),n=S.SubtractVV(this.m_vertices[o],this.m_vertices[n]);s.b2Assert(n.LengthSquared()>Number.MIN_VALUE),this.m_normals[i].SetV(S.CrossVF(n,1)),this.m_normals[i].Normalize()}this.m_centroid=r.ComputeCentroid(this.m_vertices,this.m_vertexCount)},r.AsVector=function(e,t){void 0===t&&(t=0);var i=new r;return i.SetAsVector(e,t),i},r.prototype.SetAsBox=function(e,t){void 0===e&&(e=0),void 0===t&&(t=0),this.m_vertexCount=4,this.Reserve(4),this.m_vertices[0].Set(-e,-t),this.m_vertices[1].Set(e,-t),this.m_vertices[2].Set(e,t),this.m_vertices[3].Set(-e,t),this.m_normals[0].Set(0,-1),this.m_normals[1].Set(1,0),this.m_normals[2].Set(0,1),this.m_normals[3].Set(-1,0),this.m_centroid.SetZero()},r.AsBox=function(e,t){void 0===e&&(e=0),void 0===t&&(t=0);var i=new r;return i.SetAsBox(e,t),i},r.prototype.SetAsOrientedBox=function(e,t,i,n){void 0===e&&(e=0),void 0===t&&(t=0),void 0===i&&(i=null),void 0===n&&(n=0),this.m_vertexCount=4,this.Reserve(4),this.m_vertices[0].Set(-e,-t),this.m_vertices[1].Set(e,-t),this.m_vertices[2].Set(e,t),this.m_vertices[3].Set(-e,t),this.m_normals[0].Set(0,-1),this.m_normals[1].Set(1,0),this.m_normals[2].Set(0,1),this.m_normals[3].Set(-1,0),this.m_centroid=i;var o=new a;o.position=i,o.R.Set(n);for(var s=0;s<this.m_vertexCount;++s)this.m_vertices[s]=S.MulX(o,this.m_vertices[s]),this.m_normals[s]=S.MulMV(o.R,this.m_normals[s])},r.AsOrientedBox=function(e,t,i,n){void 0===e&&(e=0),void 0===t&&(t=0),void 0===i&&(i=null),void 0===n&&(n=0);var o=new r;return o.SetAsOrientedBox(e,t,i,n),o},r.prototype.SetAsEdge=function(e,t){this.m_vertexCount=2,this.Reserve(2),this.m_vertices[0].SetV(e),this.m_vertices[1].SetV(t),this.m_centroid.x=.5*(e.x+t.x),this.m_centroid.y=.5*(e.y+t.y),this.m_normals[0]=S.CrossVF(S.SubtractVV(t,e),1),this.m_normals[0].Normalize(),this.m_normals[1].x=-this.m_normals[0].x,this.m_normals[1].y=-this.m_normals[0].y},r.AsEdge=function(e,t){var i=new r;return i.SetAsEdge(e,t),i},r.prototype.TestPoint=function(e,t){for(var i=e.R,n=t.x-e.position.x,o=t.y-e.position.y,s=n*i.col1.x+o*i.col1.y,r=n*i.col2.x+o*i.col2.y,a=0;a<this.m_vertexCount;++a){var l,n=s-(l=this.m_vertices[a]).x,o=r-l.y;if(0<(l=this.m_normals[a]).x*n+l.y*o)return!1}return!0},r.prototype.RayCast=function(e,t,i){var n=0,o=t.maxFraction;d=t.p1.x-i.position.x,m=t.p1.y-i.position.y;var s,r=d*(s=i.R).col1.x+m*s.col1.y,a=d*s.col2.x+m*s.col2.y;d=t.p2.x-i.position.x,m=t.p2.y-i.position.y;for(var l=d*(s=i.R).col1.x+m*s.col1.y-r,c=d*s.col2.x+m*s.col2.y-a,h=parseInt(-1),u=0;u<this.m_vertexCount;++u){var p,d=(p=this.m_vertices[u]).x-r,m=p.y-a,f=(p=this.m_normals[u]).x*d+p.y*m,g=p.x*l+p.y*c;if(0==g){if(f<0)return!1}else g<0&&f<n*g?(n=f/g,h=u):0<g&&f<o*g&&(o=f/g);if(o<n-Number.MIN_VALUE)return!1}return 0<=h&&(e.fraction=n,s=i.R,p=this.m_normals[h],e.normal.x=s.col1.x*p.x+s.col2.x*p.y,e.normal.y=s.col1.y*p.x+s.col2.y*p.y,!0)},r.prototype.ComputeAABB=function(e,t){for(var i=t.R,n=this.m_vertices[0],o=c=t.position.x+(i.col1.x*n.x+i.col2.x*n.y),s=h=t.position.y+(i.col1.y*n.x+i.col2.y*n.y),r=1;r<this.m_vertexCount;++r)var n=this.m_vertices[r],a=t.position.x+(i.col1.x*n.x+i.col2.x*n.y),l=t.position.y+(i.col1.y*n.x+i.col2.y*n.y),c=c<a?c:a,h=h<l?h:l,o=a<o?o:a,s=l<s?s:l;e.lowerBound.x=c-this.m_radius,e.lowerBound.y=h-this.m_radius,e.upperBound.x=o+this.m_radius,e.upperBound.y=s+this.m_radius},r.prototype.ComputeMass=function(e,t){if(void 0===t&&(t=0),2==this.m_vertexCount)return e.center.x=.5*(this.m_vertices[0].x+this.m_vertices[1].x),e.center.y=.5*(this.m_vertices[0].y+this.m_vertices[1].y),e.mass=0,void(e.I=0);for(var i=0,n=0,o=0,s=0,r=0;r<this.m_vertexCount;++r){var a=this.m_vertices[r],l=r+1<this.m_vertexCount?this.m_vertices[parseInt(r+1)]:this.m_vertices[0],c=+a.x,h=+a.y,u=+l.x,p=+l.y,d=c*p-h*u,m=.5*d;o+=m,i+=1/3*m*(0+a.x+l.x),n+=1/3*m*(0+a.y+l.y);s+=d*(1/3*(.25*(c*c+u*c+u*u)+(0*c+0*u))+0+(1/3*(.25*(h*h+p*h+p*p)+(0*h+0*p))+0))}e.mass=t*o,e.center.Set(i*=1/o,n*=1/o),e.I=t*s},r.prototype.ComputeSubmergedArea=function(e,t,i,n){void 0===t&&(t=0);var o=S.MulTMV(i.R,e),s=t-S.Dot(e,i.position),r=new q,a=0,l=parseInt(-1),c=parseInt(-1),h=!1,u=0;for(u=0;u<this.m_vertexCount;++u){r[u]=S.Dot(o,this.m_vertices[u])-s;var p=r[u]<-Number.MIN_VALUE;0<u&&(p?h||(l=u-1,a++):h&&(c=u-1,a++)),h=p}switch(a){case 0:if(h){var d=new x;return this.ComputeMass(d,1),n.SetV(S.MulX(i,d.center)),d.mass}return 0;case 1:-1==l?l=this.m_vertexCount-1:c=this.m_vertexCount-1}var m=parseInt((l+1)%this.m_vertexCount),f=parseInt((c+1)%this.m_vertexCount),t=(0-r[l])/(r[m]-r[l]),e=(0-r[c])/(r[f]-r[c]),g=new C(this.m_vertices[l].x*(1-t)+this.m_vertices[m].x*t,this.m_vertices[l].y*(1-t)+this.m_vertices[m].y*t),y=new C(this.m_vertices[c].x*(1-e)+this.m_vertices[f].x*e,this.m_vertices[c].y*(1-e)+this.m_vertices[f].y*e),v=0,b=new C,_=this.m_vertices[m];for(u=m;u!=f;){var w=(u=(u+1)%this.m_vertexCount)==f?y:this.m_vertices[u],k=.5*((_.x-g.x)*(w.y-g.y)-(_.y-g.y)*(w.x-g.x));v+=k,b.x+=k*(g.x+_.x+w.x)/3,b.y+=k*(g.y+_.y+w.y)/3,_=w}return b.Multiply(1/v),n.SetV(S.MulX(i,b)),v},r.prototype.GetVertexCount=function(){return this.m_vertexCount},r.prototype.GetVertices=function(){return this.m_vertices},r.prototype.GetNormals=function(){return this.m_normals},r.prototype.GetSupport=function(e){for(var t=0,i=this.m_vertices[0].x*e.x+this.m_vertices[0].y*e.y,n=1;n<this.m_vertexCount;++n){var o=this.m_vertices[n].x*e.x+this.m_vertices[n].y*e.y;i<o&&(t=n,i=o)}return t},r.prototype.GetSupportVertex=function(e){for(var t=0,i=this.m_vertices[0].x*e.x+this.m_vertices[0].y*e.y,n=1;n<this.m_vertexCount;++n){var o=this.m_vertices[n].x*e.x+this.m_vertices[n].y*e.y;i<o&&(t=n,i=o)}return this.m_vertices[t]},r.prototype.Validate=function(){return!1},r.prototype.b2PolygonShape=function(){this.__super.b2Shape.call(this),this.m_type=n.e_polygonShape,this.m_centroid=new C,this.m_vertices=new W,this.m_normals=new W},r.prototype.Reserve=function(e){void 0===e&&(e=0);for(var t=parseInt(this.m_vertices.length);t<e;t++)this.m_vertices[t]=new C,this.m_normals[t]=new C},r.ComputeCentroid=function(e,t){void 0===t&&(t=0);for(var i=new C,n=0,o=0;o<t;++o){var s=e[o],r=o+1<t?e[parseInt(o+1)]:e[0],a=+s.x,l=+s.y,c=+r.x,c=.5*(a*+r.y-l*c);n+=c,i.x+=1/3*c*(0+s.x+r.x),i.y+=1/3*c*(0+s.y+r.y)}return i.x*=1/n,i.y*=1/n,i},r.ComputeOBB=function(e,t,i){for(var n=0,o=new W((i=void 0===i?0:i)+1),n=0;n<i;++n)o[n]=t[n];o[i]=o[0];var s=Number.MAX_VALUE;for(n=1;n<=i;++n){for(var r=o[parseInt(n-1)],a=o[n].x-r.x,l=o[n].y-r.y,c=Math.sqrt(a*a+l*l),h=-(l/=c),u=a/=c,p=Number.MAX_VALUE,d=Number.MAX_VALUE,m=-Number.MAX_VALUE,f=-Number.MAX_VALUE,g=0;g<i;++g){var y=o[g].x-r.x,v=o[g].y-r.y,b=a*y+l*v,v=h*y+u*v;b<p&&(p=b),v<d&&(d=v),m<b&&(m=b),f<v&&(f=v)}var _,w=(m-p)*(f-d);w<.95*s&&(s=w,e.R.col1.x=a,e.R.col1.y=l,e.R.col2.x=h,e.R.col2.y=u,_=e.R,e.center.x=r.x+(_.col1.x*(c=.5*(p+m))+_.col2.x*(w=.5*(d+f))),e.center.y=r.y+(_.col1.y*c+_.col2.y*w),e.extents.x=.5*(m-p),e.extents.y=.5*(f-d))}},B.postDefs.push(function(){B.Collision.Shapes.b2PolygonShape.s_mat=new o}),n.b2Shape=function(){},n.prototype.Copy=function(){return null},n.prototype.Set=function(e){this.m_radius=e.m_radius},n.prototype.GetType=function(){return this.m_type},n.prototype.TestPoint=function(e,t){return!1},n.prototype.RayCast=function(e,t,i){return!1},n.prototype.ComputeAABB=function(e,t){},n.prototype.ComputeMass=function(e,t){void 0===t&&(t=0)},n.prototype.ComputeSubmergedArea=function(e,t,i,n){return void 0===t&&(t=0),0},n.TestOverlap=function(e,t,i,n){var o=new c;o.proxyA=new u,o.proxyA.Set(e),o.proxyB=new u,o.proxyB.Set(i),o.transformA=t,o.transformB=n,o.useRadii=!0;t=new p;t.count=0;n=new h;return l.Distance(n,t,o),n.distance<10*Number.MIN_VALUE},n.prototype.b2Shape=function(){this.m_type=n.e_unknownShape,this.m_radius=s.b2_linearSlop},B.postDefs.push(function(){B.Collision.Shapes.b2Shape.e_unknownShape=parseInt(-1),B.Collision.Shapes.b2Shape.e_circleShape=0,B.Collision.Shapes.b2Shape.e_polygonShape=1,B.Collision.Shapes.b2Shape.e_edgeShape=2,B.Collision.Shapes.b2Shape.e_shapeTypeCount=3,B.Collision.Shapes.b2Shape.e_hitCollide=1,B.Collision.Shapes.b2Shape.e_missCollide=0,B.Collision.Shapes.b2Shape.e_startsInsideCollide=parseInt(-1)})}(),function(){var e=B.Common.b2Color,t=(B.Common.b2internal,B.Common.b2Settings),n=(B.Common.Math.b2Mat22,B.Common.Math.b2Mat33,B.Common.Math.b2Math);B.Common.Math.b2Sweep,B.Common.Math.b2Transform,B.Common.Math.b2Vec2,B.Common.Math.b2Vec3;e.b2Color=function(){this._r=0,this._g=0,this._b=0},e.prototype.b2Color=function(e,t,i){void 0===t&&(t=0),void 0===i&&(i=0),this._r=B.parseUInt(255*n.Clamp(e=void 0===e?0:e,0,1)),this._g=B.parseUInt(255*n.Clamp(t,0,1)),this._b=B.parseUInt(255*n.Clamp(i,0,1))},e.prototype.Set=function(e,t,i){void 0===t&&(t=0),void 0===i&&(i=0),this._r=B.parseUInt(255*n.Clamp(e=void 0===e?0:e,0,1)),this._g=B.parseUInt(255*n.Clamp(t,0,1)),this._b=B.parseUInt(255*n.Clamp(i,0,1))},Object.defineProperty(e.prototype,"r",{enumerable:!1,configurable:!0,set:function(e){this._r=B.parseUInt(255*n.Clamp(e=void 0===e?0:e,0,1))}}),Object.defineProperty(e.prototype,"g",{enumerable:!1,configurable:!0,set:function(e){this._g=B.parseUInt(255*n.Clamp(e=void 0===e?0:e,0,1))}}),Object.defineProperty(e.prototype,"b",{enumerable:!1,configurable:!0,set:function(e){this._b=B.parseUInt(255*n.Clamp(e=void 0===e?0:e,0,1))}}),Object.defineProperty(e.prototype,"color",{enumerable:!1,configurable:!0,get:function(){return this._r<<16|this._g<<8|this._b}}),t.b2Settings=function(){},t.b2MixFriction=function(e,t){return void 0===e&&(e=0),void 0===t&&(t=0),Math.sqrt(e*t)},t.b2MixRestitution=function(e,t){return(t=void 0===t?0:t)<(e=void 0===e?0:e)?e:t},t.b2Assert=function(e){if(!e)throw"Assertion Failed"},B.postDefs.push(function(){B.Common.b2Settings.VERSION="2.1alpha",B.Common.b2Settings.USHRT_MAX=65535,B.Common.b2Settings.b2_pi=Math.PI,B.Common.b2Settings.b2_maxManifoldPoints=2,B.Common.b2Settings.b2_aabbExtension=.1,B.Common.b2Settings.b2_aabbMultiplier=2,B.Common.b2Settings.b2_polygonRadius=2*t.b2_linearSlop,B.Common.b2Settings.b2_linearSlop=.005,B.Common.b2Settings.b2_angularSlop=2/180*t.b2_pi,B.Common.b2Settings.b2_toiSlop=8*t.b2_linearSlop,B.Common.b2Settings.b2_maxTOIContactsPerIsland=32,B.Common.b2Settings.b2_maxTOIJointsPerIsland=32,B.Common.b2Settings.b2_velocityThreshold=1,B.Common.b2Settings.b2_maxLinearCorrection=.2,B.Common.b2Settings.b2_maxAngularCorrection=8/180*t.b2_pi,B.Common.b2Settings.b2_maxTranslation=20,B.Common.b2Settings.b2_maxTranslationSquared=t.b2_maxTranslation*t.b2_maxTranslation,B.Common.b2Settings.b2_maxRotation=.5*t.b2_pi,B.Common.b2Settings.b2_maxRotationSquared=t.b2_maxRotation*t.b2_maxRotation,B.Common.b2Settings.b2_contactBaumgarte=.2,B.Common.b2Settings.b2_timeToSleep=.5,B.Common.b2Settings.b2_linearSleepTolerance=.01,B.Common.b2Settings.b2_angularSleepTolerance=2/180*t.b2_pi})}(),function(){B.Collision.b2AABB,B.Common.b2Color,B.Common.b2internal,B.Common.b2Settings;var n=B.Common.Math.b2Mat22,e=B.Common.Math.b2Mat33,o=B.Common.Math.b2Math,t=B.Common.Math.b2Sweep,i=B.Common.Math.b2Transform,s=B.Common.Math.b2Vec2,r=B.Common.Math.b2Vec3;n.b2Mat22=function(){this.col1=new s,this.col2=new s},n.prototype.b2Mat22=function(){this.SetIdentity()},n.FromAngle=function(e){void 0===e&&(e=0);var t=new n;return t.Set(e),t},n.FromVV=function(e,t){var i=new n;return i.SetVV(e,t),i},n.prototype.Set=function(e){void 0===e&&(e=0);var t=Math.cos(e),e=Math.sin(e);this.col1.x=t,this.col2.x=-e,this.col1.y=e,this.col2.y=t},n.prototype.SetVV=function(e,t){this.col1.SetV(e),this.col2.SetV(t)},n.prototype.Copy=function(){var e=new n;return e.SetM(this),e},n.prototype.SetM=function(e){this.col1.SetV(e.col1),this.col2.SetV(e.col2)},n.prototype.AddM=function(e){this.col1.x+=e.col1.x,this.col1.y+=e.col1.y,this.col2.x+=e.col2.x,this.col2.y+=e.col2.y},n.prototype.SetIdentity=function(){this.col1.x=1,this.col2.x=0,this.col1.y=0,this.col2.y=1},n.prototype.SetZero=function(){this.col1.x=0,this.col2.x=0,this.col1.y=0,this.col2.y=0},n.prototype.GetAngle=function(){return Math.atan2(this.col1.y,this.col1.x)},n.prototype.GetInverse=function(e){var t=this.col1.x,i=this.col2.x,n=this.col1.y,o=this.col2.y,s=t*o-i*n;return e.col1.x=(s=0!=s?1/s:s)*o,e.col2.x=-s*i,e.col1.y=-s*n,e.col2.y=s*t,e},n.prototype.Solve=function(e,t,i){var n=this.col1.x,o=this.col2.x,s=this.col1.y,r=this.col2.y,a=n*r-o*s;return e.x=(a=0!=a?1/a:a)*(r*(t=void 0===t?0:t)-o*(i=void 0===i?0:i)),e.y=a*(n*i-s*t),e},n.prototype.Abs=function(){this.col1.Abs(),this.col2.Abs()},e.b2Mat33=function(){this.col1=new r,this.col2=new r,this.col3=new r},e.prototype.b2Mat33=function(e,t,i){void 0===t&&(t=null),void 0===i&&(i=null),(e=void 0===e?null:e)||t||i?(this.col1.SetV(e),this.col2.SetV(t),this.col3.SetV(i)):(this.col1.SetZero(),this.col2.SetZero(),this.col3.SetZero())},e.prototype.SetVVV=function(e,t,i){this.col1.SetV(e),this.col2.SetV(t),this.col3.SetV(i)},e.prototype.Copy=function(){return new e(this.col1,this.col2,this.col3)},e.prototype.SetM=function(e){this.col1.SetV(e.col1),this.col2.SetV(e.col2),this.col3.SetV(e.col3)},e.prototype.AddM=function(e){this.col1.x+=e.col1.x,this.col1.y+=e.col1.y,this.col1.z+=e.col1.z,this.col2.x+=e.col2.x,this.col2.y+=e.col2.y,this.col2.z+=e.col2.z,this.col3.x+=e.col3.x,this.col3.y+=e.col3.y,this.col3.z+=e.col3.z},e.prototype.SetIdentity=function(){this.col1.x=1,this.col2.x=0,this.col3.x=0,this.col1.y=0,this.col2.y=1,this.col3.y=0,this.col1.z=0,this.col2.z=0,this.col3.z=1},e.prototype.SetZero=function(){this.col1.x=0,this.col2.x=0,this.col3.x=0,this.col1.y=0,this.col2.y=0,this.col3.y=0,this.col1.z=0,this.col2.z=0,this.col3.z=0},e.prototype.Solve22=function(e,t,i){var n=this.col1.x,o=this.col2.x,s=this.col1.y,r=this.col2.y,a=n*r-o*s;return e.x=(a=0!=a?1/a:a)*(r*(t=void 0===t?0:t)-o*(i=void 0===i?0:i)),e.y=a*(n*i-s*t),e},e.prototype.Solve33=function(e,t,i,n){var o=this.col1.x,s=this.col1.y,r=this.col1.z,a=this.col2.x,l=this.col2.y,c=this.col2.z,h=this.col3.x,u=this.col3.y,p=this.col3.z,d=o*(l*p-c*u)+s*(c*h-a*p)+r*(a*u-l*h);return e.x=(d=0!=d?1/d:d)*((t=void 0===t?0:t)*(l*p-c*u)+(i=void 0===i?0:i)*(c*h-a*p)+(n=void 0===n?0:n)*(a*u-l*h)),e.y=d*(o*(i*p-n*u)+s*(n*h-t*p)+r*(t*u-i*h)),e.z=d*(o*(l*n-c*i)+s*(c*t-a*n)+r*(a*i-l*t)),e},o.b2Math=function(){},o.IsValid=function(e){return void 0===e&&(e=0),isFinite(e)},o.Dot=function(e,t){return e.x*t.x+e.y*t.y},o.CrossVV=function(e,t){return e.x*t.y-e.y*t.x},o.CrossVF=function(e,t){return new s((t=void 0===t?0:t)*e.y,-t*e.x)},o.CrossFV=function(e,t){return new s(-(e=void 0===e?0:e)*t.y,e*t.x)},o.MulMV=function(e,t){return new s(e.col1.x*t.x+e.col2.x*t.y,e.col1.y*t.x+e.col2.y*t.y)},o.MulTMV=function(e,t){return new s(o.Dot(t,e.col1),o.Dot(t,e.col2))},o.MulX=function(e,t){t=o.MulMV(e.R,t);return t.x+=e.position.x,t.y+=e.position.y,t},o.MulXT=function(e,t){var i=o.SubtractVV(t,e.position),t=i.x*e.R.col1.x+i.y*e.R.col1.y;return i.y=i.x*e.R.col2.x+i.y*e.R.col2.y,i.x=t,i},o.AddVV=function(e,t){return new s(e.x+t.x,e.y+t.y)},o.SubtractVV=function(e,t){return new s(e.x-t.x,e.y-t.y)},o.Distance=function(e,t){var i=e.x-t.x,t=e.y-t.y;return Math.sqrt(i*i+t*t)},o.DistanceSquared=function(e,t){var i=e.x-t.x,t=e.y-t.y;return i*i+t*t},o.MulFV=function(e,t){return new s((e=void 0===e?0:e)*t.x,e*t.y)},o.AddMM=function(e,t){return n.FromVV(o.AddVV(e.col1,t.col1),o.AddVV(e.col2,t.col2))},o.MulMM=function(e,t){return n.FromVV(o.MulMV(e,t.col1),o.MulMV(e,t.col2))},o.MulTMM=function(e,t){var i=new s(o.Dot(e.col1,t.col1),o.Dot(e.col2,t.col1)),t=new s(o.Dot(e.col1,t.col2),o.Dot(e.col2,t.col2));return n.FromVV(i,t)},o.Abs=function(e){return 0<(e=void 0===e?0:e)?e:-e},o.AbsV=function(e){return new s(o.Abs(e.x),o.Abs(e.y))},o.AbsM=function(e){return n.FromVV(o.AbsV(e.col1),o.AbsV(e.col2))},o.Min=function(e,t){return(e=void 0===e?0:e)<(t=void 0===t?0:t)?e:t},o.MinV=function(e,t){return new s(o.Min(e.x,t.x),o.Min(e.y,t.y))},o.Max=function(e,t){return(t=void 0===t?0:t)<(e=void 0===e?0:e)?e:t},o.MaxV=function(e,t){return new s(o.Max(e.x,t.x),o.Max(e.y,t.y))},o.Clamp=function(e,t,i){return void 0===i&&(i=0),(e=void 0===e?0:e)<(t=void 0===t?0:t)?t:i<e?i:e},o.ClampV=function(e,t,i){return o.MaxV(t,o.MinV(e,i))},o.Swap=function(e,t){var i=e[0];e[0]=t[0],t[0]=i},o.Random=function(){return 2*Math.random()-1},o.RandomRange=function(e,t){return((t=void 0===t?0:t)-(e=void 0===e?0:e))*Math.random()+e},o.NextPowerOfTwo=function(e){return void 0===e&&(e=0),e|=e>>1&2147483647,e|=e>>2&1073741823,e|=e>>4&268435455,e|=e>>8&16777215,(e|=e>>16&65535)+1},o.IsPowerOfTwo=function(e){return 0<(e=void 0===e?0:e)&&0==(e&e-1)},B.postDefs.push(function(){B.Common.Math.b2Math.b2Vec2_zero=new s(0,0),B.Common.Math.b2Math.b2Mat22_identity=n.FromVV(new s(1,0),new s(0,1)),B.Common.Math.b2Math.b2Transform_identity=new i(o.b2Vec2_zero,o.b2Mat22_identity)}),t.b2Sweep=function(){this.localCenter=new s,this.c0=new s,this.c=new s},t.prototype.Set=function(e){this.localCenter.SetV(e.localCenter),this.c0.SetV(e.c0),this.c.SetV(e.c),this.a0=e.a0,this.a=e.a,this.t0=e.t0},t.prototype.Copy=function(){var e=new t;return e.localCenter.SetV(this.localCenter),e.c0.SetV(this.c0),e.c.SetV(this.c),e.a0=this.a0,e.a=this.a,e.t0=this.t0,e},t.prototype.GetTransform=function(e,t){e.position.x=(1-(t=void 0===t?0:t))*this.c0.x+t*this.c.x,e.position.y=(1-t)*this.c0.y+t*this.c.y;t=(1-t)*this.a0+t*this.a;e.R.Set(t);t=e.R;e.position.x-=t.col1.x*this.localCenter.x+t.col2.x*this.localCenter.y,e.position.y-=t.col1.y*this.localCenter.x+t.col2.y*this.localCenter.y},t.prototype.Advance=function(e){var t;this.t0<(e=void 0===e?0:e)&&1-this.t0>Number.MIN_VALUE&&(t=(e-this.t0)/(1-this.t0),this.c0.x=(1-t)*this.c0.x+t*this.c.x,this.c0.y=(1-t)*this.c0.y+t*this.c.y,this.a0=(1-t)*this.a0+t*this.a,this.t0=e)},i.b2Transform=function(){this.position=new s,this.R=new n},i.prototype.b2Transform=function(e,t){void 0===t&&(t=null),(e=void 0===e?null:e)&&(this.position.SetV(e),this.R.SetM(t))},i.prototype.Initialize=function(e,t){this.position.SetV(e),this.R.SetM(t)},i.prototype.SetIdentity=function(){this.position.SetZero(),this.R.SetIdentity()},i.prototype.Set=function(e){this.position.SetV(e.position),this.R.SetM(e.R)},i.prototype.GetAngle=function(){return Math.atan2(this.R.col1.y,this.R.col1.x)},s.b2Vec2=function(){},s.prototype.b2Vec2=function(e,t){void 0===t&&(t=0),this.x=e=void 0===e?0:e,this.y=t},s.prototype.SetZero=function(){this.x=0,this.y=0},s.prototype.Set=function(e,t){void 0===t&&(t=0),this.x=e=void 0===e?0:e,this.y=t},s.prototype.SetV=function(e){this.x=e.x,this.y=e.y},s.prototype.GetNegative=function(){return new s(-this.x,-this.y)},s.prototype.NegativeSelf=function(){this.x=-this.x,this.y=-this.y},s.Make=function(e,t){return new s(e=void 0===e?0:e,t=void 0===t?0:t)},s.prototype.Copy=function(){return new s(this.x,this.y)},s.prototype.Add=function(e){this.x+=e.x,this.y+=e.y},s.prototype.Subtract=function(e){this.x-=e.x,this.y-=e.y},s.prototype.Multiply=function(e){this.x*=e=void 0===e?0:e,this.y*=e},s.prototype.MulM=function(e){var t=this.x;this.x=e.col1.x*t+e.col2.x*this.y,this.y=e.col1.y*t+e.col2.y*this.y},s.prototype.MulTM=function(e){var t=o.Dot(this,e.col1);this.y=o.Dot(this,e.col2),this.x=t},s.prototype.CrossVF=function(e){var t=this.x;this.x=(e=void 0===e?0:e)*this.y,this.y=-e*t},s.prototype.CrossFV=function(e){var t=this.x;this.x=-(e=void 0===e?0:e)*this.y,this.y=e*t},s.prototype.MinV=function(e){this.x=(this.x<e.x?this:e).x,this.y=(this.y<e.y?this:e).y},s.prototype.MaxV=function(e){this.x=(this.x>e.x?this:e).x,this.y=(this.y>e.y?this:e).y},s.prototype.Abs=function(){this.x<0&&(this.x=-this.x),this.y<0&&(this.y=-this.y)},s.prototype.Length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},s.prototype.LengthSquared=function(){return this.x*this.x+this.y*this.y},s.prototype.Normalize=function(){var e=Math.sqrt(this.x*this.x+this.y*this.y);if(e<Number.MIN_VALUE)return 0;var t=1/e;return this.x*=t,this.y*=t,e},s.prototype.IsValid=function(){return o.IsValid(this.x)&&o.IsValid(this.y)},r.b2Vec3=function(){},r.prototype.b2Vec3=function(e,t,i){void 0===t&&(t=0),void 0===i&&(i=0),this.x=e=void 0===e?0:e,this.y=t,this.z=i},r.prototype.SetZero=function(){this.x=this.y=this.z=0},r.prototype.Set=function(e,t,i){void 0===t&&(t=0),void 0===i&&(i=0),this.x=e=void 0===e?0:e,this.y=t,this.z=i},r.prototype.SetV=function(e){this.x=e.x,this.y=e.y,this.z=e.z},r.prototype.GetNegative=function(){return new r(-this.x,-this.y,-this.z)},r.prototype.NegativeSelf=function(){this.x=-this.x,this.y=-this.y,this.z=-this.z},r.prototype.Copy=function(){return new r(this.x,this.y,this.z)},r.prototype.Add=function(e){this.x+=e.x,this.y+=e.y,this.z+=e.z},r.prototype.Subtract=function(e){this.x-=e.x,this.y-=e.y,this.z-=e.z},r.prototype.Multiply=function(e){this.x*=e=void 0===e?0:e,this.y*=e,this.z*=e}}(),function(){B.Dynamics.Controllers.b2ControllerEdge,B.Common.Math.b2Mat22,B.Common.Math.b2Mat33;var m=B.Common.Math.b2Math,e=B.Common.Math.b2Sweep,s=B.Common.Math.b2Transform,f=B.Common.Math.b2Vec2,g=(B.Common.Math.b2Vec3,B.Common.b2Color),w=(B.Common.b2internal,B.Common.b2Settings),y=B.Collision.b2AABB,t=(B.Collision.b2Bound,B.Collision.b2BoundValues,B.Collision.b2Collision,B.Collision.b2ContactID,B.Collision.b2ContactPoint),i=(B.Collision.b2Distance,B.Collision.b2DistanceInput,B.Collision.b2DistanceOutput,B.Collision.b2DistanceProxy,B.Collision.b2DynamicTree,B.Collision.b2DynamicTreeBroadPhase),n=(B.Collision.b2DynamicTreeNode,B.Collision.b2DynamicTreePair,B.Collision.b2Manifold,B.Collision.b2ManifoldPoint,B.Collision.b2Point,B.Collision.b2RayCastInput),c=B.Collision.b2RayCastOutput,u=(B.Collision.b2Segment,B.Collision.b2SeparationFunction,B.Collision.b2Simplex,B.Collision.b2SimplexCache,B.Collision.b2SimplexVertex,B.Collision.b2TimeOfImpact,B.Collision.b2TOIInput,B.Collision.b2WorldManifold,B.Collision.ClipVertex,B.Collision.Features,B.Collision.IBroadPhase,B.Collision.Shapes.b2CircleShape),p=(B.Collision.Shapes.b2EdgeChainDef,B.Collision.Shapes.b2EdgeShape),o=B.Collision.Shapes.b2MassData,d=B.Collision.Shapes.b2PolygonShape,v=B.Collision.Shapes.b2Shape,k=B.Dynamics.b2Body,r=B.Dynamics.b2BodyDef,a=B.Dynamics.b2ContactFilter,l=B.Dynamics.b2ContactImpulse,h=B.Dynamics.b2ContactListener,b=B.Dynamics.b2ContactManager,_=B.Dynamics.b2DebugDraw,x=B.Dynamics.b2DestructionListener,S=B.Dynamics.b2FilterData,C=B.Dynamics.b2Fixture,T=B.Dynamics.b2FixtureDef,L=B.Dynamics.b2Island,M=B.Dynamics.b2TimeStep,D=B.Dynamics.b2World,I=(B.Dynamics.Contacts.b2CircleContact,B.Dynamics.Contacts.b2Contact),A=(B.Dynamics.Contacts.b2ContactConstraint,B.Dynamics.Contacts.b2ContactConstraintPoint,B.Dynamics.Contacts.b2ContactEdge,B.Dynamics.Contacts.b2ContactFactory),R=(B.Dynamics.Contacts.b2ContactRegister,B.Dynamics.Contacts.b2ContactResult,B.Dynamics.Contacts.b2ContactSolver),P=(B.Dynamics.Contacts.b2EdgeAndCircleContact,B.Dynamics.Contacts.b2NullContact,B.Dynamics.Contacts.b2PolyAndCircleContact,B.Dynamics.Contacts.b2PolyAndEdgeContact,B.Dynamics.Contacts.b2PolygonContact,B.Dynamics.Contacts.b2PositionSolverManifold,B.Dynamics.Controllers.b2Controller,B.Dynamics.Joints.b2DistanceJoint,B.Dynamics.Joints.b2DistanceJointDef,B.Dynamics.Joints.b2FrictionJoint,B.Dynamics.Joints.b2FrictionJointDef,B.Dynamics.Joints.b2GearJoint,B.Dynamics.Joints.b2GearJointDef,B.Dynamics.Joints.b2Jacobian,B.Dynamics.Joints.b2Joint),E=(B.Dynamics.Joints.b2JointDef,B.Dynamics.Joints.b2JointEdge,B.Dynamics.Joints.b2LineJoint,B.Dynamics.Joints.b2LineJointDef,B.Dynamics.Joints.b2MouseJoint,B.Dynamics.Joints.b2MouseJointDef,B.Dynamics.Joints.b2PrismaticJoint,B.Dynamics.Joints.b2PrismaticJointDef,B.Dynamics.Joints.b2PulleyJoint);B.Dynamics.Joints.b2PulleyJointDef,B.Dynamics.Joints.b2RevoluteJoint,B.Dynamics.Joints.b2RevoluteJointDef,B.Dynamics.Joints.b2WeldJoint,B.Dynamics.Joints.b2WeldJointDef;k.b2Body=function(){this.m_xf=new s,this.m_sweep=new e,this.m_linearVelocity=new f,this.m_force=new f},k.prototype.connectEdges=function(e,t,i){void 0===i&&(i=0);var n=Math.atan2(t.GetDirectionVector().y,t.GetDirectionVector().x),o=Math.tan(.5*(n-i)),s=m.MulFV(o,t.GetDirectionVector()),s=m.SubtractVV(s,t.GetNormalVector());s=m.MulFV(w.b2_toiSlop,s),s=m.AddVV(s,t.GetVertex1());i=m.AddVV(e.GetDirectionVector(),t.GetDirectionVector());i.Normalize();o=0<m.Dot(e.GetDirectionVector(),t.GetNormalVector());return e.SetNextEdge(t,s,i,o),t.SetPrevEdge(e,s,i,o),n},k.prototype.CreateFixture=function(e){if(1==this.m_world.IsLocked())return null;var t=new C;return t.Create(this,this.m_xf,e),this.m_flags&k.e_activeFlag&&(e=this.m_world.m_contactManager.m_broadPhase,t.CreateProxy(e,this.m_xf)),t.m_next=this.m_fixtureList,this.m_fixtureList=t,++this.m_fixtureCount,t.m_body=this,0<t.m_density&&this.ResetMassData(),this.m_world.m_flags|=D.e_newFixture,t},k.prototype.CreateFixture2=function(e,t){void 0===t&&(t=0);var i=new T;return i.shape=e,i.density=t,this.CreateFixture(i)},k.prototype.DestroyFixture=function(e){if(1!=this.m_world.IsLocked()){for(var t=this.m_fixtureList,i=null;null!=t;){if(t==e){i?i.m_next=e.m_next:this.m_fixtureList=e.m_next;break}t=(i=t).m_next}for(var n,o=this.m_contactList;o;){var s=o.contact,o=o.next,r=s.GetFixtureA(),a=s.GetFixtureB();e!=r&&e!=a||this.m_world.m_contactManager.Destroy(s)}this.m_flags&k.e_activeFlag&&(n=this.m_world.m_contactManager.m_broadPhase,e.DestroyProxy(n)),e.Destroy(),e.m_body=null,e.m_next=null,--this.m_fixtureCount,this.ResetMassData()}},k.prototype.SetPositionAndAngle=function(e,t){if(void 0===t&&(t=0),1!=this.m_world.IsLocked()){this.m_xf.R.Set(t),this.m_xf.position.SetV(e);var i=this.m_xf.R,e=this.m_sweep.localCenter;this.m_sweep.c.x=i.col1.x*e.x+i.col2.x*e.y,this.m_sweep.c.y=i.col1.y*e.x+i.col2.y*e.y,this.m_sweep.c.x+=this.m_xf.position.x,this.m_sweep.c.y+=this.m_xf.position.y,this.m_sweep.c0.SetV(this.m_sweep.c),this.m_sweep.a0=this.m_sweep.a=t;for(var n=this.m_world.m_contactManager.m_broadPhase,o=this.m_fixtureList;o;o=o.m_next)o.Synchronize(n,this.m_xf,this.m_xf);this.m_world.m_contactManager.FindNewContacts()}},k.prototype.SetTransform=function(e){this.SetPositionAndAngle(e.position,e.GetAngle())},k.prototype.GetTransform=function(){return this.m_xf},k.prototype.GetPosition=function(){return this.m_xf.position},k.prototype.SetPosition=function(e){this.SetPositionAndAngle(e,this.GetAngle())},k.prototype.GetAngle=function(){return this.m_sweep.a},k.prototype.SetAngle=function(e){void 0===e&&(e=0),this.SetPositionAndAngle(this.GetPosition(),e)},k.prototype.GetWorldCenter=function(){return this.m_sweep.c},k.prototype.GetLocalCenter=function(){return this.m_sweep.localCenter},k.prototype.SetLinearVelocity=function(e){this.m_type!=k.b2_staticBody&&this.m_linearVelocity.SetV(e)},k.prototype.GetLinearVelocity=function(){return this.m_linearVelocity},k.prototype.SetAngularVelocity=function(e){void 0===e&&(e=0),this.m_type!=k.b2_staticBody&&(this.m_angularVelocity=e)},k.prototype.GetAngularVelocity=function(){return this.m_angularVelocity},k.prototype.GetDefinition=function(){var e=new r;return e.type=this.GetType(),e.allowSleep=(this.m_flags&k.e_allowSleepFlag)==k.e_allowSleepFlag,e.angle=this.GetAngle(),e.angularDamping=this.m_angularDamping,e.angularVelocity=this.m_angularVelocity,e.fixedRotation=(this.m_flags&k.e_fixedRotationFlag)==k.e_fixedRotationFlag,e.bullet=(this.m_flags&k.e_bulletFlag)==k.e_bulletFlag,e.awake=(this.m_flags&k.e_awakeFlag)==k.e_awakeFlag,e.linearDamping=this.m_linearDamping,e.linearVelocity.SetV(this.GetLinearVelocity()),e.position=this.GetPosition(),e.userData=this.GetUserData(),e},k.prototype.ApplyForce=function(e,t){this.m_type==k.b2_dynamicBody&&(0==this.IsAwake()&&this.SetAwake(!0),this.m_force.x+=e.x,this.m_force.y+=e.y,this.m_torque+=(t.x-this.m_sweep.c.x)*e.y-(t.y-this.m_sweep.c.y)*e.x)},k.prototype.ApplyTorque=function(e){void 0===e&&(e=0),this.m_type==k.b2_dynamicBody&&(0==this.IsAwake()&&this.SetAwake(!0),this.m_torque+=e)},k.prototype.ApplyImpulse=function(e,t){this.m_type==k.b2_dynamicBody&&(0==this.IsAwake()&&this.SetAwake(!0),this.m_linearVelocity.x+=this.m_invMass*e.x,this.m_linearVelocity.y+=this.m_invMass*e.y,this.m_angularVelocity+=this.m_invI*((t.x-this.m_sweep.c.x)*e.y-(t.y-this.m_sweep.c.y)*e.x))},k.prototype.Split=function(e){for(var t,i=this.GetLinearVelocity().Copy(),n=this.GetAngularVelocity(),o=this.GetWorldCenter(),s=this.m_world.CreateBody(this.GetDefinition()),r=this.m_fixtureList;r;)var a,r=e(r)?(a=r.m_next,t?t.m_next=a:this.m_fixtureList=a,this.m_fixtureCount--,r.m_next=s.m_fixtureList,s.m_fixtureList=r,s.m_fixtureCount++,r.m_body=s,a):(t=r).m_next;this.ResetMassData(),s.ResetMassData();var l=this.GetWorldCenter(),c=s.GetWorldCenter(),l=m.AddVV(i,m.CrossFV(n,m.SubtractVV(l,o))),o=m.AddVV(i,m.CrossFV(n,m.SubtractVV(c,o)));return this.SetLinearVelocity(l),s.SetLinearVelocity(o),this.SetAngularVelocity(n),s.SetAngularVelocity(n),this.SynchronizeFixtures(),s.SynchronizeFixtures(),s},k.prototype.Merge=function(e){for(var t=e.m_fixtureList;t;){var i=t.m_next;e.m_fixtureCount--,t.m_next=this.m_fixtureList,this.m_fixtureList=t,this.m_fixtureCount++,t.m_body=n,t=i}(void 0).m_fixtureCount=0;var n=e;this.GetWorldCenter(),n.GetWorldCenter(),this.GetLinearVelocity().Copy(),n.GetLinearVelocity().Copy(),this.GetAngularVelocity(),n.GetAngularVelocity();this.ResetMassData(),this.SynchronizeFixtures()},k.prototype.GetMass=function(){return this.m_mass},k.prototype.GetInertia=function(){return this.m_I},k.prototype.GetMassData=function(e){e.mass=this.m_mass,e.I=this.m_I,e.center.SetV(this.m_sweep.localCenter)},k.prototype.SetMassData=function(e){var t;w.b2Assert(0==this.m_world.IsLocked()),1!=this.m_world.IsLocked()&&this.m_type==k.b2_dynamicBody&&(this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_mass=e.mass,this.m_mass<=0&&(this.m_mass=1),this.m_invMass=1/this.m_mass,0<e.I&&0==(this.m_flags&k.e_fixedRotationFlag)&&(this.m_I=e.I-this.m_mass*(e.center.x*e.center.x+e.center.y*e.center.y),this.m_invI=1/this.m_I),t=this.m_sweep.c.Copy(),this.m_sweep.localCenter.SetV(e.center),this.m_sweep.c0.SetV(m.MulX(this.m_xf,this.m_sweep.localCenter)),this.m_sweep.c.SetV(this.m_sweep.c0),this.m_linearVelocity.x+=this.m_angularVelocity*-(this.m_sweep.c.y-t.y),this.m_linearVelocity.y+=this.m_angularVelocity*(this.m_sweep.c.x-t.x))},k.prototype.ResetMassData=function(){if(this.m_mass=0,this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_sweep.localCenter.SetZero(),this.m_type!=k.b2_staticBody&&this.m_type!=k.b2_kinematicBody){for(var e,t=f.Make(0,0),i=this.m_fixtureList;i;i=i.m_next)0!=i.m_density&&(e=i.GetMassData(),this.m_mass+=e.mass,t.x+=e.center.x*e.mass,t.y+=e.center.y*e.mass,this.m_I+=e.I);0<this.m_mass?(this.m_invMass=1/this.m_mass,t.x*=this.m_invMass,t.y*=this.m_invMass):(this.m_mass=1,this.m_invMass=1),0<this.m_I&&0==(this.m_flags&k.e_fixedRotationFlag)?(this.m_I-=this.m_mass*(t.x*t.x+t.y*t.y),this.m_I*=this.m_inertiaScale,w.b2Assert(0<this.m_I),this.m_invI=1/this.m_I):(this.m_I=0,this.m_invI=0);var n=this.m_sweep.c.Copy();this.m_sweep.localCenter.SetV(t),this.m_sweep.c0.SetV(m.MulX(this.m_xf,this.m_sweep.localCenter)),this.m_sweep.c.SetV(this.m_sweep.c0),this.m_linearVelocity.x+=this.m_angularVelocity*-(this.m_sweep.c.y-n.y),this.m_linearVelocity.y+=this.m_angularVelocity*(this.m_sweep.c.x-n.x)}},k.prototype.GetWorldPoint=function(e){var t=this.m_xf.R,e=new f(t.col1.x*e.x+t.col2.x*e.y,t.col1.y*e.x+t.col2.y*e.y);return e.x+=this.m_xf.position.x,e.y+=this.m_xf.position.y,e},k.prototype.GetWorldVector=function(e){return m.MulMV(this.m_xf.R,e)},k.prototype.GetLocalPoint=function(e){return m.MulXT(this.m_xf,e)},k.prototype.GetLocalVector=function(e){return m.MulTMV(this.m_xf.R,e)},k.prototype.GetLinearVelocityFromWorldPoint=function(e){return new f(this.m_linearVelocity.x-this.m_angularVelocity*(e.y-this.m_sweep.c.y),this.m_linearVelocity.y+this.m_angularVelocity*(e.x-this.m_sweep.c.x))},k.prototype.GetLinearVelocityFromLocalPoint=function(e){var t=this.m_xf.R,e=new f(t.col1.x*e.x+t.col2.x*e.y,t.col1.y*e.x+t.col2.y*e.y);return e.x+=this.m_xf.position.x,e.y+=this.m_xf.position.y,new f(this.m_linearVelocity.x-this.m_angularVelocity*(e.y-this.m_sweep.c.y),this.m_linearVelocity.y+this.m_angularVelocity*(e.x-this.m_sweep.c.x))},k.prototype.GetLinearDamping=function(){return this.m_linearDamping},k.prototype.SetLinearDamping=function(e){this.m_linearDamping=e=void 0===e?0:e},k.prototype.GetAngularDamping=function(){return this.m_angularDamping},k.prototype.SetAngularDamping=function(e){this.m_angularDamping=e=void 0===e?0:e},k.prototype.SetType=function(e){if(this.m_type!=(e=void 0===e?0:e)){this.m_type=e,this.ResetMassData(),this.m_type==k.b2_staticBody&&(this.m_linearVelocity.SetZero(),this.m_angularVelocity=0),this.SetAwake(!0),this.m_force.SetZero(),this.m_torque=0;for(var t=this.m_contactList;t;t=t.next)t.contact.FlagForFiltering()}},k.prototype.GetType=function(){return this.m_type},k.prototype.SetBullet=function(e){e?this.m_flags|=k.e_bulletFlag:this.m_flags&=~k.e_bulletFlag},k.prototype.IsBullet=function(){return(this.m_flags&k.e_bulletFlag)==k.e_bulletFlag},k.prototype.SetSleepingAllowed=function(e){e?this.m_flags|=k.e_allowSleepFlag:(this.m_flags&=~k.e_allowSleepFlag,this.SetAwake(!0))},k.prototype.SetAwake=function(e){e?(this.m_flags|=k.e_awakeFlag,this.m_sleepTime=0):(this.m_flags&=~k.e_awakeFlag,this.m_sleepTime=0,this.m_linearVelocity.SetZero(),this.m_angularVelocity=0,this.m_force.SetZero(),this.m_torque=0)},k.prototype.IsAwake=function(){return(this.m_flags&k.e_awakeFlag)==k.e_awakeFlag},k.prototype.SetFixedRotation=function(e){e?this.m_flags|=k.e_fixedRotationFlag:this.m_flags&=~k.e_fixedRotationFlag,this.ResetMassData()},k.prototype.IsFixedRotation=function(){return(this.m_flags&k.e_fixedRotationFlag)==k.e_fixedRotationFlag},k.prototype.SetActive=function(e){var t,i;if(e!=this.IsActive())if(e)for(this.m_flags|=k.e_activeFlag,t=this.m_world.m_contactManager.m_broadPhase,i=this.m_fixtureList;i;i=i.m_next)i.CreateProxy(t,this.m_xf);else{for(this.m_flags&=~k.e_activeFlag,t=this.m_world.m_contactManager.m_broadPhase,i=this.m_fixtureList;i;i=i.m_next)i.DestroyProxy(t);for(var n=this.m_contactList;n;){var o=n,n=n.next;this.m_world.m_contactManager.Destroy(o.contact)}this.m_contactList=null}},k.prototype.IsActive=function(){return(this.m_flags&k.e_activeFlag)==k.e_activeFlag},k.prototype.IsSleepingAllowed=function(){return(this.m_flags&k.e_allowSleepFlag)==k.e_allowSleepFlag},k.prototype.GetFixtureList=function(){return this.m_fixtureList},k.prototype.GetJointList=function(){return this.m_jointList},k.prototype.GetControllerList=function(){return this.m_controllerList},k.prototype.GetContactList=function(){return this.m_contactList},k.prototype.GetNext=function(){return this.m_next},k.prototype.GetUserData=function(){return this.m_userData},k.prototype.SetUserData=function(e){this.m_userData=e},k.prototype.GetWorld=function(){return this.m_world},k.prototype.b2Body=function(e,t){this.m_flags=0,e.bullet&&(this.m_flags|=k.e_bulletFlag),e.fixedRotation&&(this.m_flags|=k.e_fixedRotationFlag),e.allowSleep&&(this.m_flags|=k.e_allowSleepFlag),e.awake&&(this.m_flags|=k.e_awakeFlag),e.active&&(this.m_flags|=k.e_activeFlag),this.m_world=t,this.m_xf.position.SetV(e.position),this.m_xf.R.Set(e.angle),this.m_sweep.localCenter.SetZero(),this.m_sweep.t0=1,this.m_sweep.a0=this.m_sweep.a=e.angle;var i=this.m_xf.R,t=this.m_sweep.localCenter;this.m_sweep.c.x=i.col1.x*t.x+i.col2.x*t.y,this.m_sweep.c.y=i.col1.y*t.x+i.col2.y*t.y,this.m_sweep.c.x+=this.m_xf.position.x,this.m_sweep.c.y+=this.m_xf.position.y,this.m_sweep.c0.SetV(this.m_sweep.c),this.m_jointList=null,this.m_controllerList=null,this.m_contactList=null,this.m_controllerCount=0,this.m_prev=null,this.m_next=null,this.m_linearVelocity.SetV(e.linearVelocity),this.m_angularVelocity=e.angularVelocity,this.m_linearDamping=e.linearDamping,this.m_angularDamping=e.angularDamping,this.m_force.Set(0,0),this.m_torque=0,this.m_sleepTime=0,this.m_type=e.type,this.m_type==k.b2_dynamicBody?(this.m_mass=1,this.m_invMass=1):(this.m_mass=0,this.m_invMass=0),this.m_I=0,this.m_invI=0,this.m_inertiaScale=e.inertiaScale,this.m_userData=e.userData,this.m_fixtureList=null,this.m_fixtureCount=0},k.prototype.SynchronizeFixtures=function(){var e=k.s_xf1;e.R.Set(this.m_sweep.a0);var t=e.R,i=this.m_sweep.localCenter;e.position.x=this.m_sweep.c0.x-(t.col1.x*i.x+t.col2.x*i.y),e.position.y=this.m_sweep.c0.y-(t.col1.y*i.x+t.col2.y*i.y);for(var n=this.m_world.m_contactManager.m_broadPhase,o=this.m_fixtureList;o;o=o.m_next)o.Synchronize(n,e,this.m_xf)},k.prototype.SynchronizeTransform=function(){this.m_xf.R.Set(this.m_sweep.a);var e=this.m_xf.R,t=this.m_sweep.localCenter;this.m_xf.position.x=this.m_sweep.c.x-(e.col1.x*t.x+e.col2.x*t.y),this.m_xf.position.y=this.m_sweep.c.y-(e.col1.y*t.x+e.col2.y*t.y)},k.prototype.ShouldCollide=function(e){if(this.m_type!=k.b2_dynamicBody&&e.m_type!=k.b2_dynamicBody)return!1;for(var t=this.m_jointList;t;t=t.next)if(t.other==e&&0==t.joint.m_collideConnected)return!1;return!0},k.prototype.Advance=function(e){this.m_sweep.Advance(e=void 0===e?0:e),this.m_sweep.c.SetV(this.m_sweep.c0),this.m_sweep.a=this.m_sweep.a0,this.SynchronizeTransform()},B.postDefs.push(function(){B.Dynamics.b2Body.s_xf1=new s,B.Dynamics.b2Body.e_islandFlag=1,B.Dynamics.b2Body.e_awakeFlag=2,B.Dynamics.b2Body.e_allowSleepFlag=4,B.Dynamics.b2Body.e_bulletFlag=8,B.Dynamics.b2Body.e_fixedRotationFlag=16,B.Dynamics.b2Body.e_activeFlag=32,B.Dynamics.b2Body.b2_staticBody=0,B.Dynamics.b2Body.b2_kinematicBody=1,B.Dynamics.b2Body.b2_dynamicBody=2}),r.b2BodyDef=function(){this.position=new f,this.linearVelocity=new f},r.prototype.b2BodyDef=function(){this.userData=null,this.position.Set(0,0),this.angle=0,this.linearVelocity.Set(0,0),this.angularVelocity=0,this.linearDamping=0,this.angularDamping=0,this.allowSleep=!0,this.awake=!0,this.fixedRotation=!1,this.bullet=!1,this.type=k.b2_staticBody,this.active=!0,this.inertiaScale=1},a.b2ContactFilter=function(){},a.prototype.ShouldCollide=function(e,t){e=e.GetFilterData(),t=t.GetFilterData();return e.groupIndex==t.groupIndex&&0!=e.groupIndex?0<e.groupIndex:0!=(e.maskBits&t.categoryBits)&&0!=(e.categoryBits&t.maskBits)},a.prototype.RayCollide=function(e,t){return!e||this.ShouldCollide(e instanceof C?e:null,t)},B.postDefs.push(function(){B.Dynamics.b2ContactFilter.b2_defaultFilter=new a}),l.b2ContactImpulse=function(){this.normalImpulses=new q(w.b2_maxManifoldPoints),this.tangentImpulses=new q(w.b2_maxManifoldPoints)},h.b2ContactListener=function(){},h.prototype.BeginContact=function(e){},h.prototype.EndContact=function(e){},h.prototype.PreSolve=function(e,t){},h.prototype.PostSolve=function(e,t){},B.postDefs.push(function(){B.Dynamics.b2ContactListener.b2_defaultListener=new h}),b.b2ContactManager=function(){},b.prototype.b2ContactManager=function(){this.m_world=null,this.m_contactCount=0,this.m_contactFilter=a.b2_defaultFilter,this.m_contactListener=h.b2_defaultListener,this.m_contactFactory=new A(this.m_allocator),this.m_broadPhase=new i},b.prototype.AddPair=function(e,t){var i=t instanceof C?t:null;if((o=(n=e instanceof C?e:null).GetBody())!=(t=i.GetBody())){for(var n,o,s=t.GetContactList();s;){if(s.other==o){var r=s.contact.GetFixtureA(),a=s.contact.GetFixtureB();if(r==n&&a==i)return;if(r==i&&a==n)return}s=s.next}0!=t.ShouldCollide(o)&&0!=this.m_contactFilter.ShouldCollide(n,i)&&(n=(e=this.m_contactFactory.Create(n,i)).GetFixtureA(),i=e.GetFixtureB(),o=n.m_body,t=i.m_body,e.m_prev=null,e.m_next=this.m_world.m_contactList,null!=this.m_world.m_contactList&&(this.m_world.m_contactList.m_prev=e),((this.m_world.m_contactList=e).m_nodeA.contact=e).m_nodeA.other=t,e.m_nodeA.prev=null,e.m_nodeA.next=o.m_contactList,null!=o.m_contactList&&(o.m_contactList.prev=e.m_nodeA),o.m_contactList=e.m_nodeA,(e.m_nodeB.contact=e).m_nodeB.other=o,e.m_nodeB.prev=null,e.m_nodeB.next=t.m_contactList,null!=t.m_contactList&&(t.m_contactList.prev=e.m_nodeB),t.m_contactList=e.m_nodeB,++this.m_world.m_contactCount)}},b.prototype.FindNewContacts=function(){this.m_broadPhase.UpdatePairs(B.generateCallback(this,this.AddPair))},b.prototype.Destroy=function(e){var t=e.GetFixtureA(),i=e.GetFixtureB(),t=t.GetBody(),i=i.GetBody();e.IsTouching()&&this.m_contactListener.EndContact(e),e.m_prev&&(e.m_prev.m_next=e.m_next),e.m_next&&(e.m_next.m_prev=e.m_prev),e==this.m_world.m_contactList&&(this.m_world.m_contactList=e.m_next),e.m_nodeA.prev&&(e.m_nodeA.prev.next=e.m_nodeA.next),e.m_nodeA.next&&(e.m_nodeA.next.prev=e.m_nodeA.prev),e.m_nodeA==t.m_contactList&&(t.m_contactList=e.m_nodeA.next),e.m_nodeB.prev&&(e.m_nodeB.prev.next=e.m_nodeB.next),e.m_nodeB.next&&(e.m_nodeB.next.prev=e.m_nodeB.prev),e.m_nodeB==i.m_contactList&&(i.m_contactList=e.m_nodeB.next),this.m_contactFactory.Destroy(e),--this.m_contactCount},b.prototype.Collide=function(){for(var e=this.m_world.m_contactList;e;){var t=e.GetFixtureA(),i=e.GetFixtureB(),n=t.GetBody(),o=i.GetBody();if(0!=n.IsAwake()||0!=o.IsAwake()){if(e.m_flags&I.e_filterFlag){if(0==o.ShouldCollide(n)){var s=e,e=s.GetNext();this.Destroy(s);continue}if(0==this.m_contactFilter.ShouldCollide(t,i)){e=(s=e).GetNext(),this.Destroy(s);continue}e.m_flags&=~I.e_filterFlag}t=t.m_proxy,i=i.m_proxy;0!=this.m_broadPhase.TestOverlap(t,i)?(e.Update(this.m_contactListener),e=e.GetNext()):(e=(s=e).GetNext(),this.Destroy(s))}else e=e.GetNext()}},B.postDefs.push(function(){B.Dynamics.b2ContactManager.s_evalCP=new t}),_.b2DebugDraw=function(){},_.prototype.b2DebugDraw=function(){},_.prototype.SetFlags=function(e){void 0===e&&(e=0)},_.prototype.GetFlags=function(){},_.prototype.AppendFlags=function(e){void 0===e&&(e=0)},_.prototype.ClearFlags=function(e){void 0===e&&(e=0)},_.prototype.SetSprite=function(e){},_.prototype.GetSprite=function(){},_.prototype.SetDrawScale=function(e){void 0===e&&(e=0)},_.prototype.GetDrawScale=function(){},_.prototype.SetLineThickness=function(e){void 0===e&&(e=0)},_.prototype.GetLineThickness=function(){},_.prototype.SetAlpha=function(e){void 0===e&&(e=0)},_.prototype.GetAlpha=function(){},_.prototype.SetFillAlpha=function(e){void 0===e&&(e=0)},_.prototype.GetFillAlpha=function(){},_.prototype.SetXFormScale=function(e){void 0===e&&(e=0)},_.prototype.GetXFormScale=function(){},_.prototype.DrawPolygon=function(e,t,i){void 0===t&&(t=0)},_.prototype.DrawSolidPolygon=function(e,t,i){void 0===t&&(t=0)},_.prototype.DrawCircle=function(e,t,i){void 0===t&&(t=0)},_.prototype.DrawSolidCircle=function(e,t,i,n){void 0===t&&(t=0)},_.prototype.DrawSegment=function(e,t,i){},_.prototype.DrawTransform=function(e){},B.postDefs.push(function(){B.Dynamics.b2DebugDraw.e_shapeBit=1,B.Dynamics.b2DebugDraw.e_jointBit=2,B.Dynamics.b2DebugDraw.e_aabbBit=4,B.Dynamics.b2DebugDraw.e_pairBit=8,B.Dynamics.b2DebugDraw.e_centerOfMassBit=16,B.Dynamics.b2DebugDraw.e_controllerBit=32}),x.b2DestructionListener=function(){},x.prototype.SayGoodbyeJoint=function(e){},x.prototype.SayGoodbyeFixture=function(e){},S.b2FilterData=function(){this.categoryBits=1,this.maskBits=65535,this.groupIndex=0},S.prototype.Copy=function(){var e=new S;return e.categoryBits=this.categoryBits,e.maskBits=this.maskBits,e.groupIndex=this.groupIndex,e},C.b2Fixture=function(){this.m_filter=new S},C.prototype.GetType=function(){return this.m_shape.GetType()},C.prototype.GetShape=function(){return this.m_shape},C.prototype.SetSensor=function(e){if(this.m_isSensor!=e&&(this.m_isSensor=e,null!=this.m_body))for(var t=this.m_body.GetContactList();t;){var i=t.contact,n=i.GetFixtureA(),o=i.GetFixtureB();n!=this&&o!=this||i.SetSensor(n.IsSensor()||o.IsSensor()),t=t.next}},C.prototype.IsSensor=function(){return this.m_isSensor},C.prototype.SetFilterData=function(e){if(this.m_filter=e.Copy(),!this.m_body)for(var t=this.m_body.GetContactList();t;){var i=t.contact,n=i.GetFixtureA(),o=i.GetFixtureB();n!=this&&o!=this||i.FlagForFiltering(),t=t.next}},C.prototype.GetFilterData=function(){return this.m_filter.Copy()},C.prototype.GetBody=function(){return this.m_body},C.prototype.GetNext=function(){return this.m_next},C.prototype.GetUserData=function(){return this.m_userData},C.prototype.SetUserData=function(e){this.m_userData=e},C.prototype.TestPoint=function(e){return this.m_shape.TestPoint(this.m_body.GetTransform(),e)},C.prototype.RayCast=function(e,t){return this.m_shape.RayCast(e,t,this.m_body.GetTransform())},C.prototype.GetMassData=function(e){return null==(e=void 0===e?null:e)&&(e=new o),this.m_shape.ComputeMass(e,this.m_density),e},C.prototype.SetDensity=function(e){this.m_density=e=void 0===e?0:e},C.prototype.GetDensity=function(){return this.m_density},C.prototype.GetFriction=function(){return this.m_friction},C.prototype.SetFriction=function(e){this.m_friction=e=void 0===e?0:e},C.prototype.GetRestitution=function(){return this.m_restitution},C.prototype.SetRestitution=function(e){this.m_restitution=e=void 0===e?0:e},C.prototype.GetAABB=function(){return this.m_aabb},C.prototype.b2Fixture=function(){this.m_aabb=new y,this.m_userData=null,this.m_body=null,this.m_next=null,this.m_shape=null,this.m_density=0,this.m_friction=0,this.m_restitution=0},C.prototype.Create=function(e,t,i){this.m_userData=i.userData,this.m_friction=i.friction,this.m_restitution=i.restitution,this.m_body=e,this.m_next=null,this.m_filter=i.filter.Copy(),this.m_isSensor=i.isSensor,this.m_shape=i.shape.Copy(),this.m_density=i.density},C.prototype.Destroy=function(){this.m_shape=null},C.prototype.CreateProxy=function(e,t){this.m_shape.ComputeAABB(this.m_aabb,t),this.m_proxy=e.CreateProxy(this.m_aabb,this)},C.prototype.DestroyProxy=function(e){null!=this.m_proxy&&(e.DestroyProxy(this.m_proxy),this.m_proxy=null)},C.prototype.Synchronize=function(e,t,i){var n,o;this.m_proxy&&(n=new y,o=new y,this.m_shape.ComputeAABB(n,t),this.m_shape.ComputeAABB(o,i),this.m_aabb.Combine(n,o),t=m.SubtractVV(i.position,t.position),e.MoveProxy(this.m_proxy,this.m_aabb,t))},T.b2FixtureDef=function(){this.filter=new S},T.prototype.b2FixtureDef=function(){this.shape=null,this.userData=null,this.friction=.2,this.restitution=0,this.density=0,this.filter.categoryBits=1,this.filter.maskBits=65535,this.filter.groupIndex=0,this.isSensor=!1},L.b2Island=function(){},L.prototype.b2Island=function(){this.m_bodies=new W,this.m_contacts=new W,this.m_joints=new W},L.prototype.Initialize=function(e,t,i,n,o,s){void 0===t&&(t=0),void 0===i&&(i=0);var r=0;for(this.m_bodyCapacity=e=void 0===e?0:e,this.m_contactCapacity=t,this.m_jointCapacity=i,this.m_bodyCount=0,this.m_contactCount=0,this.m_jointCount=0,this.m_allocator=n,this.m_listener=o,this.m_contactSolver=s,r=this.m_bodies.length;r<e;r++)this.m_bodies[r]=null;for(r=this.m_contacts.length;r<t;r++)this.m_contacts[r]=null;for(r=this.m_joints.length;r<i;r++)this.m_joints[r]=null},L.prototype.Clear=function(){this.m_bodyCount=0,this.m_contactCount=0,this.m_jointCount=0},L.prototype.Solve=function(e,t,i){var n=0,o=0;for(n=0;n<this.m_bodyCount;++n)(r=this.m_bodies[n]).GetType()==k.b2_dynamicBody&&(r.m_linearVelocity.x+=e.dt*(t.x+r.m_invMass*r.m_force.x),r.m_linearVelocity.y+=e.dt*(t.y+r.m_invMass*r.m_force.y),r.m_angularVelocity+=e.dt*r.m_invI*r.m_torque,r.m_linearVelocity.Multiply(m.Clamp(1-e.dt*r.m_linearDamping,0,1)),r.m_angularVelocity*=m.Clamp(1-e.dt*r.m_angularDamping,0,1));this.m_contactSolver.Initialize(e,this.m_contacts,this.m_contactCount,this.m_allocator);var s,r,a=this.m_contactSolver;for(a.InitVelocityConstraints(e),n=0;n<this.m_jointCount;++n)this.m_joints[n].InitVelocityConstraints(e);for(n=0;n<e.velocityIterations;++n){for(o=0;o<this.m_jointCount;++o)this.m_joints[o].SolveVelocityConstraints(e);a.SolveVelocityConstraints()}for(n=0;n<this.m_jointCount;++n)this.m_joints[n].FinalizeVelocityConstraints();for(a.FinalizeVelocityConstraints(),n=0;n<this.m_bodyCount;++n)(r=this.m_bodies[n]).GetType()!=k.b2_staticBody&&((s=e.dt*r.m_linearVelocity.x)*s+(s=e.dt*r.m_linearVelocity.y)*s>w.b2_maxTranslationSquared&&(r.m_linearVelocity.Normalize(),r.m_linearVelocity.x*=w.b2_maxTranslation*e.inv_dt,r.m_linearVelocity.y*=w.b2_maxTranslation*e.inv_dt),(s=e.dt*r.m_angularVelocity)*s>w.b2_maxRotationSquared&&(r.m_angularVelocity<0?r.m_angularVelocity=-w.b2_maxRotation*e.inv_dt:r.m_angularVelocity=w.b2_maxRotation*e.inv_dt),r.m_sweep.c0.SetV(r.m_sweep.c),r.m_sweep.a0=r.m_sweep.a,r.m_sweep.c.x+=e.dt*r.m_linearVelocity.x,r.m_sweep.c.y+=e.dt*r.m_linearVelocity.y,r.m_sweep.a+=e.dt*r.m_angularVelocity,r.SynchronizeTransform());for(n=0;n<e.positionIterations;++n){for(var l=a.SolvePositionConstraints(w.b2_contactBaumgarte),c=!0,o=0;o<this.m_jointCount;++o)var h=this.m_joints[o].SolvePositionConstraints(w.b2_contactBaumgarte),c=c&&h;if(l&&c)break}if(this.Report(a.m_constraints),i){for(var u=Number.MAX_VALUE,p=w.b2_linearSleepTolerance*w.b2_linearSleepTolerance,d=w.b2_angularSleepTolerance*w.b2_angularSleepTolerance,n=0;n<this.m_bodyCount;++n)(r=this.m_bodies[n]).GetType()!=k.b2_staticBody&&(0==(r.m_flags&k.e_allowSleepFlag)&&(u=r.m_sleepTime=0),u=0==(r.m_flags&k.e_allowSleepFlag)||r.m_angularVelocity*r.m_angularVelocity>d||m.Dot(r.m_linearVelocity,r.m_linearVelocity)>p?r.m_sleepTime=0:(r.m_sleepTime+=e.dt,m.Min(u,r.m_sleepTime)));if(u>=w.b2_timeToSleep)for(n=0;n<this.m_bodyCount;++n)(r=this.m_bodies[n]).SetAwake(!1)}},L.prototype.SolveTOI=function(e){var t=0,i=0;this.m_contactSolver.Initialize(e,this.m_contacts,this.m_contactCount,this.m_allocator);for(var n=this.m_contactSolver,t=0;t<this.m_jointCount;++t)this.m_joints[t].InitVelocityConstraints(e);for(t=0;t<e.velocityIterations;++t)for(n.SolveVelocityConstraints(),i=0;i<this.m_jointCount;++i)this.m_joints[i].SolveVelocityConstraints(e);for(t=0;t<this.m_bodyCount;++t){var o,s=this.m_bodies[t];s.GetType()!=k.b2_staticBody&&((o=e.dt*s.m_linearVelocity.x)*o+(o=e.dt*s.m_linearVelocity.y)*o>w.b2_maxTranslationSquared&&(s.m_linearVelocity.Normalize(),s.m_linearVelocity.x*=w.b2_maxTranslation*e.inv_dt,s.m_linearVelocity.y*=w.b2_maxTranslation*e.inv_dt),(o=e.dt*s.m_angularVelocity)*o>w.b2_maxRotationSquared&&(s.m_angularVelocity<0?s.m_angularVelocity=-w.b2_maxRotation*e.inv_dt:s.m_angularVelocity=w.b2_maxRotation*e.inv_dt),s.m_sweep.c0.SetV(s.m_sweep.c),s.m_sweep.a0=s.m_sweep.a,s.m_sweep.c.x+=e.dt*s.m_linearVelocity.x,s.m_sweep.c.y+=e.dt*s.m_linearVelocity.y,s.m_sweep.a+=e.dt*s.m_angularVelocity,s.SynchronizeTransform())}for(t=0;t<e.positionIterations;++t){for(var r=n.SolvePositionConstraints(.75),a=!0,i=0;i<this.m_jointCount;++i)var l=this.m_joints[i].SolvePositionConstraints(w.b2_contactBaumgarte),a=a&&l;if(r&&a)break}this.Report(n.m_constraints)},L.prototype.Report=function(e){if(null!=this.m_listener)for(var t=0;t<this.m_contactCount;++t){for(var i=this.m_contacts[t],n=e[t],o=0;o<n.pointCount;++o)L.s_impulse.normalImpulses[o]=n.points[o].normalImpulse,L.s_impulse.tangentImpulses[o]=n.points[o].tangentImpulse;this.m_listener.PostSolve(i,L.s_impulse)}},L.prototype.AddBody=function(e){e.m_islandIndex=this.m_bodyCount,this.m_bodies[this.m_bodyCount++]=e},L.prototype.AddContact=function(e){this.m_contacts[this.m_contactCount++]=e},L.prototype.AddJoint=function(e){this.m_joints[this.m_jointCount++]=e},B.postDefs.push(function(){B.Dynamics.b2Island.s_impulse=new l}),M.b2TimeStep=function(){},M.prototype.Set=function(e){this.dt=e.dt,this.inv_dt=e.inv_dt,this.positionIterations=e.positionIterations,this.velocityIterations=e.velocityIterations,this.warmStarting=e.warmStarting},D.b2World=function(){this.s_stack=new W,this.m_contactManager=new b,this.m_contactSolver=new R,this.m_island=new L},D.prototype.b2World=function(e,t){this.m_destructionListener=null,this.m_debugDraw=null,this.m_bodyList=null,this.m_contactList=null,this.m_jointList=null,this.m_controllerList=null,this.m_bodyCount=0,this.m_contactCount=0,this.m_jointCount=0,this.m_controllerCount=0,D.m_warmStarting=!0,D.m_continuousPhysics=!0,this.m_allowSleep=t,this.m_gravity=e,this.m_inv_dt0=0,this.m_contactManager.m_world=this;e=new r;this.m_groundBody=this.CreateBody(e)},D.prototype.SetDestructionListener=function(e){this.m_destructionListener=e},D.prototype.SetContactFilter=function(e){this.m_contactManager.m_contactFilter=e},D.prototype.SetContactListener=function(e){this.m_contactManager.m_contactListener=e},D.prototype.SetDebugDraw=function(e){this.m_debugDraw=e},D.prototype.SetBroadPhase=function(e){var t=this.m_contactManager.m_broadPhase;this.m_contactManager.m_broadPhase=e;for(var i=this.m_bodyList;i;i=i.m_next)for(var n=i.m_fixtureList;n;n=n.m_next)n.m_proxy=e.CreateProxy(t.GetFatAABB(n.m_proxy),n)},D.prototype.Validate=function(){this.m_contactManager.m_broadPhase.Validate()},D.prototype.GetProxyCount=function(){return this.m_contactManager.m_broadPhase.GetProxyCount()},D.prototype.CreateBody=function(e){if(1==this.IsLocked())return null;e=new k(e,this);return e.m_prev=null,e.m_next=this.m_bodyList,this.m_bodyList&&(this.m_bodyList.m_prev=e),this.m_bodyList=e,++this.m_bodyCount,e},D.prototype.DestroyBody=function(e){if(1!=this.IsLocked()){for(var t=e.m_jointList;t;){var i=t,t=t.next;this.m_destructionListener&&this.m_destructionListener.SayGoodbyeJoint(i.joint),this.DestroyJoint(i.joint)}for(var n=e.m_controllerList;n;){var o=n,n=n.nextController;o.controller.RemoveBody(e)}for(var s=e.m_contactList;s;){var r=s,s=s.next;this.m_contactManager.Destroy(r.contact)}e.m_contactList=null;for(var a=e.m_fixtureList;a;){var l=a,a=a.m_next;this.m_destructionListener&&this.m_destructionListener.SayGoodbyeFixture(l),l.DestroyProxy(this.m_contactManager.m_broadPhase),l.Destroy()}e.m_fixtureList=null,e.m_fixtureCount=0,e.m_prev&&(e.m_prev.m_next=e.m_next),e.m_next&&(e.m_next.m_prev=e.m_prev),e==this.m_bodyList&&(this.m_bodyList=e.m_next),--this.m_bodyCount}},D.prototype.CreateJoint=function(e){var t=P.Create(e,null);t.m_prev=null,t.m_next=this.m_jointList,this.m_jointList&&(this.m_jointList.m_prev=t),this.m_jointList=t,++this.m_jointCount,(t.m_edgeA.joint=t).m_edgeA.other=t.m_bodyB,t.m_edgeA.prev=null,t.m_edgeA.next=t.m_bodyA.m_jointList,t.m_bodyA.m_jointList&&(t.m_bodyA.m_jointList.prev=t.m_edgeA),t.m_bodyA.m_jointList=t.m_edgeA,(t.m_edgeB.joint=t).m_edgeB.other=t.m_bodyA,t.m_edgeB.prev=null,t.m_edgeB.next=t.m_bodyB.m_jointList,t.m_bodyB.m_jointList&&(t.m_bodyB.m_jointList.prev=t.m_edgeB),t.m_bodyB.m_jointList=t.m_edgeB;var i=e.bodyA,n=e.bodyB;if(0==e.collideConnected)for(var o=n.GetContactList();o;)o.other==i&&o.contact.FlagForFiltering(),o=o.next;return t},D.prototype.DestroyJoint=function(e){var t=e.m_collideConnected;e.m_prev&&(e.m_prev.m_next=e.m_next),e.m_next&&(e.m_next.m_prev=e.m_prev),e==this.m_jointList&&(this.m_jointList=e.m_next);var i=e.m_bodyA,n=e.m_bodyB;if(i.SetAwake(!0),n.SetAwake(!0),e.m_edgeA.prev&&(e.m_edgeA.prev.next=e.m_edgeA.next),e.m_edgeA.next&&(e.m_edgeA.next.prev=e.m_edgeA.prev),e.m_edgeA==i.m_jointList&&(i.m_jointList=e.m_edgeA.next),e.m_edgeA.prev=null,e.m_edgeA.next=null,e.m_edgeB.prev&&(e.m_edgeB.prev.next=e.m_edgeB.next),e.m_edgeB.next&&(e.m_edgeB.next.prev=e.m_edgeB.prev),e.m_edgeB==n.m_jointList&&(n.m_jointList=e.m_edgeB.next),e.m_edgeB.prev=null,e.m_edgeB.next=null,P.Destroy(e,null),--this.m_jointCount,0==t)for(var o=n.GetContactList();o;)o.other==i&&o.contact.FlagForFiltering(),o=o.next},D.prototype.AddController=function(e){return e.m_next=this.m_controllerList,e.m_prev=null,((this.m_controllerList=e).m_world=this).m_controllerCount++,e},D.prototype.RemoveController=function(e){e.m_prev&&(e.m_prev.m_next=e.m_next),e.m_next&&(e.m_next.m_prev=e.m_prev),this.m_controllerList==e&&(this.m_controllerList=e.m_next),this.m_controllerCount--},D.prototype.CreateController=function(e){if(e.m_world!=this)throw new Error("Controller can only be a member of one world");return e.m_next=this.m_controllerList,e.m_prev=null,this.m_controllerList&&(this.m_controllerList.m_prev=e),this.m_controllerList=e,++this.m_controllerCount,e.m_world=this,e},D.prototype.DestroyController=function(e){e.Clear(),e.m_next&&(e.m_next.m_prev=e.m_prev),e.m_prev&&(e.m_prev.m_next=e.m_next),e==this.m_controllerList&&(this.m_controllerList=e.m_next),--this.m_controllerCount},D.prototype.SetWarmStarting=function(e){D.m_warmStarting=e},D.prototype.SetContinuousPhysics=function(e){D.m_continuousPhysics=e},D.prototype.GetBodyCount=function(){return this.m_bodyCount},D.prototype.GetJointCount=function(){return this.m_jointCount},D.prototype.GetContactCount=function(){return this.m_contactCount},D.prototype.SetGravity=function(e){this.m_gravity=e},D.prototype.GetGravity=function(){return this.m_gravity},D.prototype.GetGroundBody=function(){return this.m_groundBody},D.prototype.Step=function(e,t,i){void 0===e&&(e=0),void 0===t&&(t=0),void 0===i&&(i=0),this.m_flags&D.e_newFixture&&(this.m_contactManager.FindNewContacts(),this.m_flags&=~D.e_newFixture),this.m_flags|=D.e_locked;var n=D.s_timestep2;n.dt=e,n.velocityIterations=t,n.positionIterations=i,n.inv_dt=0<e?1/e:0,n.dtRatio=this.m_inv_dt0*e,n.warmStarting=D.m_warmStarting,this.m_contactManager.Collide(),0<n.dt&&this.Solve(n),D.m_continuousPhysics&&0<n.dt&&this.SolveTOI(n),0<n.dt&&(this.m_inv_dt0=n.inv_dt),this.m_flags&=~D.e_locked},D.prototype.ClearForces=function(){for(var e=this.m_bodyList;e;e=e.m_next)e.m_force.SetZero(),e.m_torque=0},D.prototype.DrawDebugData=function(){if(null!=this.m_debugDraw){this.m_debugDraw.m_sprite.graphics.clear();var e,t,i,n,o,s,r=this.m_debugDraw.GetFlags(),a=(new f,new f,new f,new y,new y,[new f,new f,new f,new f]),l=new g(0,0,0);if(r&_.e_shapeBit)for(e=this.m_bodyList;e;e=e.m_next)for(s=e.m_xf,t=e.GetFixtureList();t;t=t.m_next)i=t.GetShape(),0==e.IsActive()?l.Set(.5,.5,.3):e.GetType()==k.b2_staticBody?l.Set(.5,.9,.5):e.GetType()==k.b2_kinematicBody?l.Set(.5,.5,.9):0==e.IsAwake()?l.Set(.6,.6,.6):l.Set(.9,.7,.7),this.DrawShape(i,s,l);if(r&_.e_jointBit)for(n=this.m_jointList;n;n=n.m_next)this.DrawJoint(n);if(r&_.e_controllerBit)for(var c=this.m_controllerList;c;c=c.m_next)c.Draw(this.m_debugDraw);if(r&_.e_pairBit){l.Set(.3,.9,.9);for(var h=this.m_contactManager.m_contactList;h;h=h.GetNext()){var u=h.GetFixtureA(),p=h.GetFixtureB(),u=u.GetAABB().GetCenter(),p=p.GetAABB().GetCenter();this.m_debugDraw.DrawSegment(u,p,l)}}if(r&_.e_aabbBit)for(o=this.m_contactManager.m_broadPhase,a=[new f,new f,new f,new f],e=this.m_bodyList;e;e=e.GetNext())if(0!=e.IsActive())for(t=e.GetFixtureList();t;t=t.GetNext()){var d=o.GetFatAABB(t.m_proxy);a[0].Set(d.lowerBound.x,d.lowerBound.y),a[1].Set(d.upperBound.x,d.lowerBound.y),a[2].Set(d.upperBound.x,d.upperBound.y),a[3].Set(d.lowerBound.x,d.upperBound.y),this.m_debugDraw.DrawPolygon(a,4,l)}if(r&_.e_centerOfMassBit)for(e=this.m_bodyList;e;e=e.m_next)(s=D.s_xf).R=e.m_xf.R,s.position=e.GetWorldCenter(),this.m_debugDraw.DrawTransform(s)}},D.prototype.QueryAABB=function(t,e){var i=this.m_contactManager.m_broadPhase;i.Query(function(e){return t(i.GetUserData(e))},e)},D.prototype.QueryShape=function(t,i,n){null==(n=void 0===n?null:n)&&(n=new s).SetIdentity();var o=this.m_contactManager.m_broadPhase;var e=new y;i.ComputeAABB(e,n),o.Query(function(e){return e=o.GetUserData(e)instanceof C?o.GetUserData(e):null,!v.TestOverlap(i,n,e.GetShape(),e.GetBody().GetTransform())||t(e)},e)},D.prototype.QueryPoint=function(t,i){var n=this.m_contactManager.m_broadPhase;var e=new y;e.lowerBound.Set(i.x-w.b2_linearSlop,i.y-w.b2_linearSlop),e.upperBound.Set(i.x+w.b2_linearSlop,i.y+w.b2_linearSlop),n.Query(function(e){return!(e=n.GetUserData(e)instanceof C?n.GetUserData(e):null).TestPoint(i)||t(e)},e)},D.prototype.RayCast=function(o,s,r){var a=this.m_contactManager.m_broadPhase,l=new c;var e=new n(s,r);a.RayCast(function(e,t){var i=a.GetUserData(t),n=i instanceof C?i:null;if(n.RayCast(l,e)){t=l.fraction,i=new f((1-t)*s.x+t*r.x,(1-t)*s.y+t*r.y);return o(n,i,l.normal,t)}return e.maxFraction},e)},D.prototype.RayCastOne=function(e,t){var o;return this.RayCast(function(e,t,i,n){return o=e,n=void 0===n?0:n},e,t),o},D.prototype.RayCastAll=function(e,t){var o=new W;return this.RayCast(function(e,t,i,n){return void 0===n&&(n=0),o[o.length]=e,1},e,t),o},D.prototype.GetBodyList=function(){return this.m_bodyList},D.prototype.GetJointList=function(){return this.m_jointList},D.prototype.GetContactList=function(){return this.m_contactList},D.prototype.IsLocked=function(){return 0<(this.m_flags&D.e_locked)},D.prototype.Solve=function(e){for(var t,i=this.m_controllerList;i;i=i.m_next)i.Step(e);var n=this.m_island;for(n.Initialize(this.m_bodyCount,this.m_contactCount,this.m_jointCount,null,this.m_contactManager.m_contactListener,this.m_contactSolver),t=this.m_bodyList;t;t=t.m_next)t.m_flags&=~k.e_islandFlag;for(var o=this.m_contactList;o;o=o.m_next)o.m_flags&=~I.e_islandFlag;for(var s=this.m_jointList;s;s=s.m_next)s.m_islandFlag=!1;parseInt(this.m_bodyCount);for(var r=this.s_stack,a=this.m_bodyList;a;a=a.m_next)if(!(a.m_flags&k.e_islandFlag)&&0!=a.IsAwake()&&0!=a.IsActive()&&a.GetType()!=k.b2_staticBody){n.Clear();var l=0;for((r[l++]=a).m_flags|=k.e_islandFlag;0<l;)if(t=r[--l],n.AddBody(t),0==t.IsAwake()&&t.SetAwake(!0),t.GetType()!=k.b2_staticBody){for(var c,h=t.m_contactList;h;h=h.next)h.contact.m_flags&I.e_islandFlag||1!=h.contact.IsSensor()&&0!=h.contact.IsEnabled()&&0!=h.contact.IsTouching()&&(n.AddContact(h.contact),h.contact.m_flags|=I.e_islandFlag,(c=h.other).m_flags&k.e_islandFlag||((r[l++]=c).m_flags|=k.e_islandFlag));for(var u=t.m_jointList;u;u=u.next)1!=u.joint.m_islandFlag&&0!=(c=u.other).IsActive()&&(n.AddJoint(u.joint),u.joint.m_islandFlag=!0,c.m_flags&k.e_islandFlag||((r[l++]=c).m_flags|=k.e_islandFlag))}n.Solve(e,this.m_gravity,this.m_allowSleep);for(var p=0;p<n.m_bodyCount;++p)(t=n.m_bodies[p]).GetType()==k.b2_staticBody&&(t.m_flags&=~k.e_islandFlag)}for(p=0;p<r.length&&r[p];++p)r[p]=null;for(t=this.m_bodyList;t;t=t.m_next)0!=t.IsAwake()&&0!=t.IsActive()&&t.GetType()!=k.b2_staticBody&&t.SynchronizeFixtures();this.m_contactManager.FindNewContacts()},D.prototype.SolveTOI=function(e){var t,i,n,o,s,r,a=this.m_island;a.Initialize(this.m_bodyCount,w.b2_maxTOIContactsPerIsland,w.b2_maxTOIJointsPerIsland,null,this.m_contactManager.m_contactListener,this.m_contactSolver);for(var l=D.s_queue,c=this.m_bodyList;c;c=c.m_next)c.m_flags&=~k.e_islandFlag,c.m_sweep.t0=0;for(p=this.m_contactList;p;p=p.m_next)p.m_flags&=~(I.e_toiFlag|I.e_islandFlag);for(r=this.m_jointList;r;r=r.m_next)r.m_islandFlag=!1;for(;;){for(var h=null,u=1,p=this.m_contactList;p;p=p.m_next)if(1!=p.IsSensor()&&0!=p.IsEnabled()&&0!=p.IsContinuous()){var d=1;if(p.m_flags&I.e_toiFlag)d=p.m_toi;else{if(t=p.m_fixtureA,i=p.m_fixtureB,n=t.m_body,o=i.m_body,!(n.GetType()==k.b2_dynamicBody&&0!=n.IsAwake()||o.GetType()==k.b2_dynamicBody&&0!=o.IsAwake()))continue;var m=n.m_sweep.t0;n.m_sweep.t0<o.m_sweep.t0?(m=o.m_sweep.t0,n.m_sweep.Advance(m)):o.m_sweep.t0<n.m_sweep.t0&&(m=n.m_sweep.t0,o.m_sweep.Advance(m)),d=p.ComputeTOI(n.m_sweep,o.m_sweep),w.b2Assert(0<=d&&d<=1),0<d&&d<1&&1<(d=(1-d)*m+d)&&(d=1),p.m_toi=d,p.m_flags|=I.e_toiFlag}Number.MIN_VALUE<d&&d<u&&(h=p,u=d)}if(null==h||1-100*Number.MIN_VALUE<u)break;if(t=h.m_fixtureA,i=h.m_fixtureB,n=t.m_body,o=i.m_body,D.s_backupA.Set(n.m_sweep),D.s_backupB.Set(o.m_sweep),n.Advance(u),o.Advance(u),h.Update(this.m_contactManager.m_contactListener),h.m_flags&=~I.e_toiFlag,1!=h.IsSensor()&&0!=h.IsEnabled()){if(0!=h.IsTouching()){var f=n;f.GetType()!=k.b2_dynamicBody&&(f=o),a.Clear();var g,y=0,v=0;for((l[y+v++]=f).m_flags|=k.e_islandFlag;0<v;)if(c=l[y++],--v,a.AddBody(c),0==c.IsAwake()&&c.SetAwake(!0),c.GetType()==k.b2_dynamicBody){for(s=c.m_contactList;s&&a.m_contactCount!=a.m_contactCapacity;s=s.next)s.contact.m_flags&I.e_islandFlag||1!=s.contact.IsSensor()&&0!=s.contact.IsEnabled()&&0!=s.contact.IsTouching()&&(a.AddContact(s.contact),s.contact.m_flags|=I.e_islandFlag,(g=s.other).m_flags&k.e_islandFlag||(g.GetType()!=k.b2_staticBody&&(g.Advance(u),g.SetAwake(!0)),l[y+v]=g,++v,g.m_flags|=k.e_islandFlag));for(var b=c.m_jointList;b;b=b.next)a.m_jointCount!=a.m_jointCapacity&&1!=b.joint.m_islandFlag&&0!=(g=b.other).IsActive()&&(a.AddJoint(b.joint),b.joint.m_islandFlag=!0,g.m_flags&k.e_islandFlag||(g.GetType()!=k.b2_staticBody&&(g.Advance(u),g.SetAwake(!0)),l[y+v]=g,++v,g.m_flags|=k.e_islandFlag))}f=D.s_timestep;f.warmStarting=!1,f.dt=(1-u)*e.dt,f.inv_dt=1/f.dt,f.dtRatio=0,f.velocityIterations=e.velocityIterations,f.positionIterations=e.positionIterations,a.SolveTOI(f);for(var _=0,_=0;_<a.m_bodyCount;++_)if((c=a.m_bodies[_]).m_flags&=~k.e_islandFlag,0!=c.IsAwake()&&c.GetType()==k.b2_dynamicBody)for(c.SynchronizeFixtures(),s=c.m_contactList;s;s=s.next)s.contact.m_flags&=~I.e_toiFlag;for(_=0;_<a.m_contactCount;++_)(p=a.m_contacts[_]).m_flags&=~(I.e_toiFlag|I.e_islandFlag);for(_=0;_<a.m_jointCount;++_)(r=a.m_joints[_]).m_islandFlag=!1;this.m_contactManager.FindNewContacts()}}else n.m_sweep.Set(D.s_backupA),o.m_sweep.Set(D.s_backupB),n.SynchronizeTransform(),o.SynchronizeTransform()}},D.prototype.DrawJoint=function(e){var t=e.GetBodyA(),i=e.GetBodyB(),n=t.m_xf,o=i.m_xf,s=n.position,r=o.position,a=e.GetAnchorA(),l=e.GetAnchorB(),c=D.s_jointColor;switch(e.m_type){case P.e_distanceJoint:this.m_debugDraw.DrawSegment(a,l,c);break;case P.e_pulleyJoint:var h=e instanceof E?e:null,u=h.GetGroundAnchorA(),h=h.GetGroundAnchorB();this.m_debugDraw.DrawSegment(u,a,c),this.m_debugDraw.DrawSegment(h,l,c),this.m_debugDraw.DrawSegment(u,h,c);break;case P.e_mouseJoint:this.m_debugDraw.DrawSegment(a,l,c);break;default:t!=this.m_groundBody&&this.m_debugDraw.DrawSegment(s,a,c),this.m_debugDraw.DrawSegment(a,l,c),i!=this.m_groundBody&&this.m_debugDraw.DrawSegment(r,l,c)}},D.prototype.DrawShape=function(e,t,i){switch(e.m_type){case v.e_circleShape:var n=e instanceof u?e:null,o=m.MulX(t,n.m_p),s=n.m_radius,n=t.R.col1;this.m_debugDraw.DrawSolidCircle(o,s,n,i);break;case v.e_polygonShape:for(var r=0,a=e instanceof d?e:null,l=parseInt(a.GetVertexCount()),c=a.GetVertices(),h=new W(l),r=0;r<l;++r)h[r]=m.MulX(t,c[r]);this.m_debugDraw.DrawSolidPolygon(h,l,i);break;case v.e_edgeShape:a=e instanceof p?e:null;this.m_debugDraw.DrawSegment(m.MulX(t,a.GetVertex1()),m.MulX(t,a.GetVertex2()),i)}},B.postDefs.push(function(){B.Dynamics.b2World.s_timestep2=new M,B.Dynamics.b2World.s_xf=new s,B.Dynamics.b2World.s_backupA=new e,B.Dynamics.b2World.s_backupB=new e,B.Dynamics.b2World.s_timestep=new M,B.Dynamics.b2World.s_queue=new W,B.Dynamics.b2World.s_jointColor=new g(.5,.8,.8),B.Dynamics.b2World.e_newFixture=1,B.Dynamics.b2World.e_locked=2})}(),function(){var i=B.Collision.Shapes.b2CircleShape,n=(B.Collision.Shapes.b2EdgeChainDef,B.Collision.Shapes.b2EdgeShape),o=(B.Collision.Shapes.b2MassData,B.Collision.Shapes.b2PolygonShape),f=B.Collision.Shapes.b2Shape,s=B.Dynamics.Contacts.b2CircleContact,g=B.Dynamics.Contacts.b2Contact,F=B.Dynamics.Contacts.b2ContactConstraint,t=B.Dynamics.Contacts.b2ContactConstraintPoint,e=B.Dynamics.Contacts.b2ContactEdge,r=B.Dynamics.Contacts.b2ContactFactory,a=B.Dynamics.Contacts.b2ContactRegister,l=B.Dynamics.Contacts.b2ContactResult,N=B.Dynamics.Contacts.b2ContactSolver,c=B.Dynamics.Contacts.b2EdgeAndCircleContact,h=B.Dynamics.Contacts.b2NullContact,u=B.Dynamics.Contacts.b2PolyAndCircleContact,p=B.Dynamics.Contacts.b2PolyAndEdgeContact,d=B.Dynamics.Contacts.b2PolygonContact,m=B.Dynamics.Contacts.b2PositionSolverManifold,y=B.Dynamics.b2Body,v=(B.Dynamics.b2BodyDef,B.Dynamics.b2ContactFilter,B.Dynamics.b2ContactImpulse,B.Dynamics.b2ContactListener,B.Dynamics.b2ContactManager,B.Dynamics.b2DebugDraw,B.Dynamics.b2DestructionListener,B.Dynamics.b2FilterData,B.Dynamics.b2Fixture,B.Dynamics.b2FixtureDef,B.Dynamics.b2Island,B.Dynamics.b2TimeStep),U=(B.Dynamics.b2World,B.Common.b2Color,B.Common.b2internal,B.Common.b2Settings),b=B.Common.Math.b2Mat22,H=(B.Common.Math.b2Mat33,B.Common.Math.b2Math),_=(B.Common.Math.b2Sweep,B.Common.Math.b2Transform,B.Common.Math.b2Vec2),w=(B.Common.Math.b2Vec3,B.Collision.b2AABB,B.Collision.b2Bound,B.Collision.b2BoundValues,B.Collision.b2Collision),k=B.Collision.b2ContactID,x=(B.Collision.b2ContactPoint,B.Collision.b2Distance,B.Collision.b2DistanceInput,B.Collision.b2DistanceOutput,B.Collision.b2DistanceProxy,B.Collision.b2DynamicTree,B.Collision.b2DynamicTreeBroadPhase,B.Collision.b2DynamicTreeNode,B.Collision.b2DynamicTreePair,B.Collision.b2Manifold),S=(B.Collision.b2ManifoldPoint,B.Collision.b2Point,B.Collision.b2RayCastInput,B.Collision.b2RayCastOutput,B.Collision.b2Segment,B.Collision.b2SeparationFunction,B.Collision.b2Simplex,B.Collision.b2SimplexCache,B.Collision.b2SimplexVertex,B.Collision.b2TimeOfImpact),C=B.Collision.b2TOIInput,T=B.Collision.b2WorldManifold;B.Collision.ClipVertex,B.Collision.Features,B.Collision.IBroadPhase;B.inherit(s,B.Dynamics.Contacts.b2Contact),s.prototype.__super=B.Dynamics.Contacts.b2Contact.prototype,s.b2CircleContact=function(){B.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)},s.Create=function(e){return new s},s.Destroy=function(e,t){},s.prototype.Reset=function(e,t){this.__super.Reset.call(this,e,t)},s.prototype.Evaluate=function(){var e=this.m_fixtureA.GetBody(),t=this.m_fixtureB.GetBody();w.CollideCircles(this.m_manifold,this.m_fixtureA.GetShape()instanceof i?this.m_fixtureA.GetShape():null,e.m_xf,this.m_fixtureB.GetShape()instanceof i?this.m_fixtureB.GetShape():null,t.m_xf)},g.b2Contact=function(){this.m_nodeA=new e,this.m_nodeB=new e,this.m_manifold=new x,this.m_oldManifold=new x},g.prototype.GetManifold=function(){return this.m_manifold},g.prototype.GetWorldManifold=function(e){var t=this.m_fixtureA.GetBody(),i=this.m_fixtureB.GetBody(),n=this.m_fixtureA.GetShape(),o=this.m_fixtureB.GetShape();e.Initialize(this.m_manifold,t.GetTransform(),n.m_radius,i.GetTransform(),o.m_radius)},g.prototype.IsTouching=function(){return(this.m_flags&g.e_touchingFlag)==g.e_touchingFlag},g.prototype.IsContinuous=function(){return(this.m_flags&g.e_continuousFlag)==g.e_continuousFlag},g.prototype.SetSensor=function(e){e?this.m_flags|=g.e_sensorFlag:this.m_flags&=~g.e_sensorFlag},g.prototype.IsSensor=function(){return(this.m_flags&g.e_sensorFlag)==g.e_sensorFlag},g.prototype.SetEnabled=function(e){e?this.m_flags|=g.e_enabledFlag:this.m_flags&=~g.e_enabledFlag},g.prototype.IsEnabled=function(){return(this.m_flags&g.e_enabledFlag)==g.e_enabledFlag},g.prototype.GetNext=function(){return this.m_next},g.prototype.GetFixtureA=function(){return this.m_fixtureA},g.prototype.GetFixtureB=function(){return this.m_fixtureB},g.prototype.FlagForFiltering=function(){this.m_flags|=g.e_filterFlag},g.prototype.b2Contact=function(){},g.prototype.Reset=function(e,t){if(void 0===e&&(e=null),void 0===t&&(t=null),this.m_flags=g.e_enabledFlag,!e||!t)return this.m_fixtureA=null,void(this.m_fixtureB=null);(e.IsSensor()||t.IsSensor())&&(this.m_flags|=g.e_sensorFlag);var i=e.GetBody(),n=t.GetBody();(i.GetType()!=y.b2_dynamicBody||i.IsBullet()||n.GetType()!=y.b2_dynamicBody||n.IsBullet())&&(this.m_flags|=g.e_continuousFlag),this.m_fixtureA=e,this.m_fixtureB=t,this.m_manifold.m_pointCount=0,this.m_prev=null,this.m_next=null,this.m_nodeA.contact=null,this.m_nodeA.prev=null,this.m_nodeA.next=null,this.m_nodeA.other=null,this.m_nodeB.contact=null,this.m_nodeB.prev=null,this.m_nodeB.next=null,this.m_nodeB.other=null},g.prototype.Update=function(e){var t=this.m_oldManifold;this.m_oldManifold=this.m_manifold,this.m_manifold=t,this.m_flags|=g.e_enabledFlag;var i,n,o,s=!1,r=(this.m_flags&g.e_touchingFlag)==g.e_touchingFlag,a=this.m_fixtureA.m_body,l=this.m_fixtureB.m_body,c=this.m_fixtureA.m_aabb.TestOverlap(this.m_fixtureB.m_aabb);if(this.m_flags&g.e_sensorFlag)c&&(i=this.m_fixtureA.GetShape(),n=this.m_fixtureB.GetShape(),o=a.GetTransform(),t=l.GetTransform(),s=f.TestOverlap(i,o,n,t)),this.m_manifold.m_pointCount=0;else{if(a.GetType()!=y.b2_dynamicBody||a.IsBullet()||l.GetType()!=y.b2_dynamicBody||l.IsBullet()?this.m_flags|=g.e_continuousFlag:this.m_flags&=~g.e_continuousFlag,c){this.Evaluate(),s=0<this.m_manifold.m_pointCount;for(var h=0;h<this.m_manifold.m_pointCount;++h){var u=this.m_manifold.m_points[h];u.m_normalImpulse=0,u.m_tangentImpulse=0;for(var p=u.m_id,d=0;d<this.m_oldManifold.m_pointCount;++d){var m=this.m_oldManifold.m_points[d];if(m.m_id.key==p.key){u.m_normalImpulse=m.m_normalImpulse,u.m_tangentImpulse=m.m_tangentImpulse;break}}}}else this.m_manifold.m_pointCount=0;s!=r&&(a.SetAwake(!0),l.SetAwake(!0))}s?this.m_flags|=g.e_touchingFlag:this.m_flags&=~g.e_touchingFlag,0==r&&1==s&&e.BeginContact(this),1==r&&0==s&&e.EndContact(this),0==(this.m_flags&g.e_sensorFlag)&&e.PreSolve(this,this.m_oldManifold)},g.prototype.Evaluate=function(){},g.prototype.ComputeTOI=function(e,t){return g.s_input.proxyA.Set(this.m_fixtureA.GetShape()),g.s_input.proxyB.Set(this.m_fixtureB.GetShape()),g.s_input.sweepA=e,g.s_input.sweepB=t,g.s_input.tolerance=U.b2_linearSlop,S.TimeOfImpact(g.s_input)},B.postDefs.push(function(){B.Dynamics.Contacts.b2Contact.e_sensorFlag=1,B.Dynamics.Contacts.b2Contact.e_continuousFlag=2,B.Dynamics.Contacts.b2Contact.e_islandFlag=4,B.Dynamics.Contacts.b2Contact.e_toiFlag=8,B.Dynamics.Contacts.b2Contact.e_touchingFlag=16,B.Dynamics.Contacts.b2Contact.e_enabledFlag=32,B.Dynamics.Contacts.b2Contact.e_filterFlag=64,B.Dynamics.Contacts.b2Contact.s_input=new C}),F.b2ContactConstraint=function(){this.localPlaneNormal=new _,this.localPoint=new _,this.normal=new _,this.normalMass=new b,this.K=new b},F.prototype.b2ContactConstraint=function(){this.points=new W(U.b2_maxManifoldPoints);for(var e=0;e<U.b2_maxManifoldPoints;e++)this.points[e]=new t},t.b2ContactConstraintPoint=function(){this.localPoint=new _,this.rA=new _,this.rB=new _},e.b2ContactEdge=function(){},r.b2ContactFactory=function(){},r.prototype.b2ContactFactory=function(e){this.m_allocator=e,this.InitializeRegisters()},r.prototype.AddType=function(e,t,i,n){this.m_registers[i=void 0===i?0:i][n=void 0===n?0:n].createFcn=e,this.m_registers[i][n].destroyFcn=t,this.m_registers[i][n].primary=!0,i!=n&&(this.m_registers[n][i].createFcn=e,this.m_registers[n][i].destroyFcn=t,this.m_registers[n][i].primary=!1)},r.prototype.InitializeRegisters=function(){this.m_registers=new W(f.e_shapeTypeCount);for(var e=0;e<f.e_shapeTypeCount;e++){this.m_registers[e]=new W(f.e_shapeTypeCount);for(var t=0;t<f.e_shapeTypeCount;t++)this.m_registers[e][t]=new a}this.AddType(s.Create,s.Destroy,f.e_circleShape,f.e_circleShape),this.AddType(u.Create,u.Destroy,f.e_polygonShape,f.e_circleShape),this.AddType(d.Create,d.Destroy,f.e_polygonShape,f.e_polygonShape),this.AddType(c.Create,c.Destroy,f.e_edgeShape,f.e_circleShape),this.AddType(p.Create,p.Destroy,f.e_polygonShape,f.e_edgeShape)},r.prototype.Create=function(e,t){var i,n=parseInt(e.GetType()),o=parseInt(t.GetType()),n=this.m_registers[n][o];if(n.pool)return i=n.pool,n.pool=i.m_next,n.poolCount--,i.Reset(e,t),i;o=n.createFcn;return null!=o?(n.primary?(i=o(this.m_allocator)).Reset(e,t):(i=o(this.m_allocator)).Reset(t,e),i):null},r.prototype.Destroy=function(e){0<e.m_manifold.m_pointCount&&(e.m_fixtureA.m_body.SetAwake(!0),e.m_fixtureB.m_body.SetAwake(!0));var t=parseInt(e.m_fixtureA.GetType()),i=parseInt(e.m_fixtureB.GetType()),i=this.m_registers[t][i];i.poolCount++,e.m_next=i.pool,i.pool=e,(0,i.destroyFcn)(e,this.m_allocator)},a.b2ContactRegister=function(){},l.b2ContactResult=function(){this.position=new _,this.normal=new _,this.id=new k},N.b2ContactSolver=function(){this.m_step=new v,this.m_constraints=new W},N.prototype.b2ContactSolver=function(){},N.prototype.Initialize=function(e,t,i,n){void 0===i&&(i=0),this.m_step.Set(e),this.m_allocator=n;var o=0;for(this.m_constraintCount=i;this.m_constraints.length<this.m_constraintCount;)this.m_constraints[this.m_constraints.length]=new F;for(o=0;o<i;++o){var s=(C=t[o]).m_fixtureA,r=C.m_fixtureB,a=s.m_shape,l=r.m_shape,c=a.m_radius,h=l.m_radius,u=s.m_body,p=r.m_body,d=C.GetManifold(),m=U.b2MixFriction(s.GetFriction(),r.GetFriction()),f=U.b2MixRestitution(s.GetRestitution(),r.GetRestitution()),g=u.m_linearVelocity.x,y=u.m_linearVelocity.y,v=p.m_linearVelocity.x,b=p.m_linearVelocity.y,_=u.m_angularVelocity,w=p.m_angularVelocity;U.b2Assert(0<d.m_pointCount),N.s_worldManifold.Initialize(d,u.m_xf,c,p.m_xf,h);var k=N.s_worldManifold.m_normal.x,x=N.s_worldManifold.m_normal.y,S=this.m_constraints[o];S.bodyA=u,S.bodyB=p,S.manifold=d,S.normal.x=k,S.normal.y=x,S.pointCount=d.m_pointCount,S.friction=m,S.restitution=f,S.localPlaneNormal.x=d.m_localPlaneNormal.x,S.localPlaneNormal.y=d.m_localPlaneNormal.y,S.localPoint.x=d.m_localPoint.x,S.localPoint.y=d.m_localPoint.y,S.radius=c+h,S.type=d.m_type;for(var C,T,L=0;L<S.pointCount;++L){var M=d.m_points[L],D=S.points[L];D.normalImpulse=M.m_normalImpulse,D.tangentImpulse=M.m_tangentImpulse,D.localPoint.SetV(M.m_localPoint);var I=D.rA.x=N.s_worldManifold.m_points[L].x-u.m_sweep.c.x,A=D.rA.y=N.s_worldManifold.m_points[L].y-u.m_sweep.c.y,R=D.rB.x=N.s_worldManifold.m_points[L].x-p.m_sweep.c.x,P=D.rB.y=N.s_worldManifold.m_points[L].y-p.m_sweep.c.y,E=I*x-A*k,B=R*x-P*k;E*=E,B*=B;M=u.m_invMass+p.m_invMass+u.m_invI*E+p.m_invI*B;D.normalMass=1/M;M=u.m_mass*u.m_invMass+p.m_mass*p.m_invMass;M+=u.m_mass*u.m_invI*E+p.m_mass*p.m_invI*B,D.equalizedMass=1/M;B=-k,M=I*B-A*x,B=R*B-P*x;M*=M,B*=B;B=u.m_invMass+p.m_invMass+u.m_invI*M+p.m_invI*B;D.tangentMass=1/B,D.velocityBias=0;I=S.normal.x*(v+-w*P-g- -_*A)+S.normal.y*(b+w*R-y-_*I);I<-U.b2_velocityThreshold&&(D.velocityBias+=-S.restitution*I)}2==S.pointCount&&(T=S.points[0],a=S.points[1],l=u.m_invMass,C=u.m_invI,s=p.m_invMass,r=p.m_invI,(c=l+s+C*(m=T.rA.x*x-T.rA.y*k)*m+r*(f=T.rB.x*x-T.rB.y*k)*f)*c<100*(c*(a=l+s+C*(h=a.rA.x*x-a.rA.y*k)*h+r*(T=a.rB.x*x-a.rB.y*k)*T)-(T=l+s+C*m*h+r*f*T)*T)?(S.K.col1.Set(c,T),S.K.col2.Set(T,a),S.K.GetInverse(S.normalMass)):S.pointCount=1)}},N.prototype.InitVelocityConstraints=function(e){for(var t=0;t<this.m_constraintCount;++t){var i=this.m_constraints[t],n=i.bodyA,o=i.bodyB,s=n.m_invMass,r=n.m_invI,a=o.m_invMass,l=o.m_invI,c=i.normal.x,h=i.normal.y,u=h,p=-c,d=0,m=0;if(e.warmStarting)for(m=i.pointCount,d=0;d<m;++d){var f=i.points[d];f.normalImpulse*=e.dtRatio,f.tangentImpulse*=e.dtRatio;var g=f.normalImpulse*c+f.tangentImpulse*u,y=f.normalImpulse*h+f.tangentImpulse*p;n.m_angularVelocity-=r*(f.rA.x*y-f.rA.y*g),n.m_linearVelocity.x-=s*g,n.m_linearVelocity.y-=s*y,o.m_angularVelocity+=l*(f.rB.x*y-f.rB.y*g),o.m_linearVelocity.x+=a*g,o.m_linearVelocity.y+=a*y}else for(m=i.pointCount,d=0;d<m;++d){var v=i.points[d];v.normalImpulse=0,v.tangentImpulse=0}}},N.prototype.SolveVelocityConstraints=function(){for(var e,t,i=0,n=0,o=0,s=0,r=0,a=0,l=0,c=0,h=0,u=0,p=0,d=0,m=0,f=0;f<this.m_constraintCount;++f){for(var g=this.m_constraints[f],y=g.bodyA,v=g.bodyB,b=y.m_angularVelocity,_=v.m_angularVelocity,w=y.m_linearVelocity,k=v.m_linearVelocity,x=y.m_invMass,S=y.m_invI,C=v.m_invMass,T=v.m_invI,L=g.normal.x,M=g.normal.y,D=M,I=-L,A=g.friction,i=0;i<g.pointCount;i++)e=g.points[i],n=k.x-_*e.rB.y-w.x+b*e.rA.y,o=k.y+_*e.rB.x-w.y-b*e.rA.x,s=e.tangentMass*-(n*D+o*I),t=A*e.normalImpulse,l=(s=(r=H.Clamp(e.tangentImpulse+s,-t,t))-e.tangentImpulse)*I,w.x-=x*(a=s*D),w.y-=x*l,b-=S*(e.rA.x*l-e.rA.y*a),k.x+=C*a,k.y+=C*l,_+=T*(e.rB.x*l-e.rB.y*a),e.tangentImpulse=r;parseInt(g.pointCount);if(1==g.pointCount)e=g.points[0],n=k.x+-_*e.rB.y-w.x- -b*e.rA.y,o=k.y+_*e.rB.x-w.y-b*e.rA.x,s=-e.normalMass*(n*L+o*M-e.velocityBias),l=(s=(r=0<(r=e.normalImpulse+s)?r:0)-e.normalImpulse)*M,w.x-=x*(a=s*L),w.y-=x*l,b-=S*(e.rA.x*l-e.rA.y*a),k.x+=C*a,k.y+=C*l,_+=T*(e.rB.x*l-e.rB.y*a),e.normalImpulse=r;else{var R=g.points[0],P=g.points[1],E=R.normalImpulse,B=P.normalImpulse,F=(k.x-_*R.rB.y-w.x+b*R.rA.y)*L+(k.y+_*R.rB.x-w.y-b*R.rA.x)*M,N=(k.x-_*P.rB.y-w.x+b*P.rA.y)*L+(k.y+_*P.rB.x-w.y-b*P.rA.x)*M,U=F-R.velocityBias,V=N-P.velocityBias;U-=(O=g.K).col1.x*E+O.col2.x*B,V-=O.col1.y*E+O.col2.y*B;for(;;){var O,G=-((O=g.normalMass).col1.x*U+O.col2.x*V),z=-(O.col1.y*U+O.col2.y*V);if(0<=G&&0<=z){p=(c=G-E)*M,m=(h=z-B)*M,w.x-=x*((u=c*L)+(d=h*L)),w.y-=x*(p+m),b-=S*(R.rA.x*p-R.rA.y*u+P.rA.x*m-P.rA.y*d),k.x+=C*(u+d),k.y+=C*(p+m),_+=T*(R.rB.x*p-R.rB.y*u+P.rB.x*m-P.rB.y*d),R.normalImpulse=G,P.normalImpulse=z;break}if(G=-R.normalMass*U,N=g.K.col1.y*G+V,(F=z=0)<=G&&0<=N){p=(c=G-E)*M,m=(h=z-B)*M,w.x-=x*((u=c*L)+(d=h*L)),w.y-=x*(p+m),b-=S*(R.rA.x*p-R.rA.y*u+P.rA.x*m-P.rA.y*d),k.x+=C*(u+d),k.y+=C*(p+m),_+=T*(R.rB.x*p-R.rB.y*u+P.rB.x*m-P.rB.y*d),R.normalImpulse=G,P.normalImpulse=z;break}if(z=-P.normalMass*V,F=g.K.col2.x*z+U,(N=G=0)<=z&&0<=F){p=(c=G-E)*M,m=(h=z-B)*M,w.x-=x*((u=c*L)+(d=h*L)),w.y-=x*(p+m),b-=S*(R.rA.x*p-R.rA.y*u+P.rA.x*m-P.rA.y*d),k.x+=C*(u+d),k.y+=C*(p+m),_+=T*(R.rB.x*p-R.rB.y*u+P.rB.x*m-P.rB.y*d),R.normalImpulse=G,P.normalImpulse=z;break}if(N=V,(z=G=0)<=(F=U)&&0<=N){p=(c=G-E)*M,m=(h=z-B)*M,w.x-=x*((u=c*L)+(d=h*L)),w.y-=x*(p+m),b-=S*(R.rA.x*p-R.rA.y*u+P.rA.x*m-P.rA.y*d),k.x+=C*(u+d),k.y+=C*(p+m),_+=T*(R.rB.x*p-R.rB.y*u+P.rB.x*m-P.rB.y*d),R.normalImpulse=G,P.normalImpulse=z;break}break}}y.m_angularVelocity=b,v.m_angularVelocity=_}},N.prototype.FinalizeVelocityConstraints=function(){for(var e=0;e<this.m_constraintCount;++e)for(var t=this.m_constraints[e],i=t.manifold,n=0;n<t.pointCount;++n){var o=i.m_points[n],s=t.points[n];o.m_normalImpulse=s.normalImpulse,o.m_tangentImpulse=s.tangentImpulse}},N.prototype.SolvePositionConstraints=function(e){void 0===e&&(e=0);for(var t=0,i=0;i<this.m_constraintCount;i++){var n=this.m_constraints[i],o=n.bodyA,s=n.bodyB,r=o.m_mass*o.m_invMass,a=o.m_mass*o.m_invI,l=s.m_mass*s.m_invMass,c=s.m_mass*s.m_invI;N.s_psm.Initialize(n);for(var h=N.s_psm.m_normal,u=0;u<n.pointCount;u++){var p=n.points[u],d=N.s_psm.m_points[u],m=N.s_psm.m_separations[u],f=d.x-o.m_sweep.c.x,g=d.y-o.m_sweep.c.y,y=d.x-s.m_sweep.c.x,d=d.y-s.m_sweep.c.y,t=t<m?t:m,m=H.Clamp(e*(m+U.b2_linearSlop),-U.b2_maxLinearCorrection,0),p=-p.equalizedMass*m,m=p*h.x,p=p*h.y;o.m_sweep.c.x-=r*m,o.m_sweep.c.y-=r*p,o.m_sweep.a-=a*(f*p-g*m),o.SynchronizeTransform(),s.m_sweep.c.x+=l*m,s.m_sweep.c.y+=l*p,s.m_sweep.a+=c*(y*p-d*m),s.SynchronizeTransform()}}return t>-1.5*U.b2_linearSlop},B.postDefs.push(function(){B.Dynamics.Contacts.b2ContactSolver.s_worldManifold=new T,B.Dynamics.Contacts.b2ContactSolver.s_psm=new m}),B.inherit(c,B.Dynamics.Contacts.b2Contact),c.prototype.__super=B.Dynamics.Contacts.b2Contact.prototype,c.b2EdgeAndCircleContact=function(){B.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)},c.Create=function(e){return new c},c.Destroy=function(e,t){},c.prototype.Reset=function(e,t){this.__super.Reset.call(this,e,t)},c.prototype.Evaluate=function(){var e=this.m_fixtureA.GetBody(),t=this.m_fixtureB.GetBody();this.b2CollideEdgeAndCircle(this.m_manifold,this.m_fixtureA.GetShape()instanceof n?this.m_fixtureA.GetShape():null,e.m_xf,this.m_fixtureB.GetShape()instanceof i?this.m_fixtureB.GetShape():null,t.m_xf)},c.prototype.b2CollideEdgeAndCircle=function(e,t,i,n,o){},B.inherit(h,B.Dynamics.Contacts.b2Contact),h.prototype.__super=B.Dynamics.Contacts.b2Contact.prototype,h.b2NullContact=function(){B.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)},h.prototype.b2NullContact=function(){this.__super.b2Contact.call(this)},h.prototype.Evaluate=function(){},B.inherit(u,B.Dynamics.Contacts.b2Contact),u.prototype.__super=B.Dynamics.Contacts.b2Contact.prototype,u.b2PolyAndCircleContact=function(){B.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)},u.Create=function(e){return new u},u.Destroy=function(e,t){},u.prototype.Reset=function(e,t){this.__super.Reset.call(this,e,t),U.b2Assert(e.GetType()==f.e_polygonShape),U.b2Assert(t.GetType()==f.e_circleShape)},u.prototype.Evaluate=function(){var e=this.m_fixtureA.m_body,t=this.m_fixtureB.m_body;w.CollidePolygonAndCircle(this.m_manifold,this.m_fixtureA.GetShape()instanceof o?this.m_fixtureA.GetShape():null,e.m_xf,this.m_fixtureB.GetShape()instanceof i?this.m_fixtureB.GetShape():null,t.m_xf)},B.inherit(p,B.Dynamics.Contacts.b2Contact),p.prototype.__super=B.Dynamics.Contacts.b2Contact.prototype,p.b2PolyAndEdgeContact=function(){B.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)},p.Create=function(e){return new p},p.Destroy=function(e,t){},p.prototype.Reset=function(e,t){this.__super.Reset.call(this,e,t),U.b2Assert(e.GetType()==f.e_polygonShape),U.b2Assert(t.GetType()==f.e_edgeShape)},p.prototype.Evaluate=function(){var e=this.m_fixtureA.GetBody(),t=this.m_fixtureB.GetBody();this.b2CollidePolyAndEdge(this.m_manifold,this.m_fixtureA.GetShape()instanceof o?this.m_fixtureA.GetShape():null,e.m_xf,this.m_fixtureB.GetShape()instanceof n?this.m_fixtureB.GetShape():null,t.m_xf)},p.prototype.b2CollidePolyAndEdge=function(e,t,i,n,o){},B.inherit(d,B.Dynamics.Contacts.b2Contact),d.prototype.__super=B.Dynamics.Contacts.b2Contact.prototype,d.b2PolygonContact=function(){B.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)},d.Create=function(e){return new d},d.Destroy=function(e,t){},d.prototype.Reset=function(e,t){this.__super.Reset.call(this,e,t)},d.prototype.Evaluate=function(){var e=this.m_fixtureA.GetBody(),t=this.m_fixtureB.GetBody();w.CollidePolygons(this.m_manifold,this.m_fixtureA.GetShape()instanceof o?this.m_fixtureA.GetShape():null,e.m_xf,this.m_fixtureB.GetShape()instanceof o?this.m_fixtureB.GetShape():null,t.m_xf)},m.b2PositionSolverManifold=function(){},m.prototype.b2PositionSolverManifold=function(){this.m_normal=new _,this.m_separations=new q(U.b2_maxManifoldPoints),this.m_points=new W(U.b2_maxManifoldPoints);for(var e=0;e<U.b2_maxManifoldPoints;e++)this.m_points[e]=new _},m.prototype.Initialize=function(e){U.b2Assert(0<e.pointCount);var t=0,i=0,n=0,o=0,s=0;switch(e.type){case x.e_circles:var r=e.bodyA.m_xf.R,a=e.localPoint,l=e.bodyA.m_xf.position.x+(r.col1.x*a.x+r.col2.x*a.y),c=e.bodyA.m_xf.position.y+(r.col1.y*a.x+r.col2.y*a.y);r=e.bodyB.m_xf.R,a=e.points[0].localPoint;var h=e.bodyB.m_xf.position.x+(r.col1.x*a.x+r.col2.x*a.y),u=e.bodyB.m_xf.position.y+(r.col1.y*a.x+r.col2.y*a.y),p=h-l,d=u-c,m=p*p+d*d;m>Number.MIN_VALUE*Number.MIN_VALUE?(m=Math.sqrt(m),this.m_normal.x=p/m,this.m_normal.y=d/m):(this.m_normal.x=1,this.m_normal.y=0),this.m_points[0].x=.5*(l+h),this.m_points[0].y=.5*(c+u),this.m_separations[0]=p*this.m_normal.x+d*this.m_normal.y-e.radius;break;case x.e_faceA:for(r=e.bodyA.m_xf.R,a=e.localPlaneNormal,this.m_normal.x=r.col1.x*a.x+r.col2.x*a.y,this.m_normal.y=r.col1.y*a.x+r.col2.y*a.y,r=e.bodyA.m_xf.R,a=e.localPoint,o=e.bodyA.m_xf.position.x+(r.col1.x*a.x+r.col2.x*a.y),s=e.bodyA.m_xf.position.y+(r.col1.y*a.x+r.col2.y*a.y),r=e.bodyB.m_xf.R,t=0;t<e.pointCount;++t)a=e.points[t].localPoint,i=e.bodyB.m_xf.position.x+(r.col1.x*a.x+r.col2.x*a.y),n=e.bodyB.m_xf.position.y+(r.col1.y*a.x+r.col2.y*a.y),this.m_separations[t]=(i-o)*this.m_normal.x+(n-s)*this.m_normal.y-e.radius,this.m_points[t].x=i,this.m_points[t].y=n;break;case x.e_faceB:for(r=e.bodyB.m_xf.R,a=e.localPlaneNormal,this.m_normal.x=r.col1.x*a.x+r.col2.x*a.y,this.m_normal.y=r.col1.y*a.x+r.col2.y*a.y,r=e.bodyB.m_xf.R,a=e.localPoint,o=e.bodyB.m_xf.position.x+(r.col1.x*a.x+r.col2.x*a.y),s=e.bodyB.m_xf.position.y+(r.col1.y*a.x+r.col2.y*a.y),r=e.bodyA.m_xf.R,t=0;t<e.pointCount;++t)a=e.points[t].localPoint,i=e.bodyA.m_xf.position.x+(r.col1.x*a.x+r.col2.x*a.y),n=e.bodyA.m_xf.position.y+(r.col1.y*a.x+r.col2.y*a.y),this.m_separations[t]=(i-o)*this.m_normal.x+(n-s)*this.m_normal.y-e.radius,this.m_points[t].Set(i,n);this.m_normal.x*=-1,this.m_normal.y*=-1}},B.postDefs.push(function(){B.Dynamics.Contacts.b2PositionSolverManifold.circlePointA=new _,B.Dynamics.Contacts.b2PositionSolverManifold.circlePointB=new _})}(),function(){B.Dynamics.b2Body,B.Dynamics.b2BodyDef,B.Dynamics.b2ContactFilter,B.Dynamics.b2ContactImpulse,B.Dynamics.b2ContactListener,B.Dynamics.b2ContactManager,B.Dynamics.b2DebugDraw,B.Dynamics.b2DestructionListener,B.Dynamics.b2FilterData,B.Dynamics.b2Fixture,B.Dynamics.b2FixtureDef,B.Dynamics.b2Island,B.Dynamics.b2TimeStep,B.Dynamics.b2World;var e=B.Common.Math.b2Mat22,s=(B.Common.Math.b2Mat33,B.Common.Math.b2Math),p=(B.Common.Math.b2Sweep,B.Common.Math.b2Transform,B.Common.Math.b2Vec2),o=(B.Common.Math.b2Vec3,B.Common.b2Color),t=(B.Common.b2internal,B.Common.b2Settings,B.Collision.Shapes.b2CircleShape,B.Collision.Shapes.b2EdgeChainDef,B.Collision.Shapes.b2EdgeShape,B.Collision.Shapes.b2MassData,B.Collision.Shapes.b2PolygonShape,B.Collision.Shapes.b2Shape,B.Dynamics.Controllers.b2BuoyancyController),i=B.Dynamics.Controllers.b2ConstantAccelController,n=B.Dynamics.Controllers.b2ConstantForceController,r=B.Dynamics.Controllers.b2Controller,a=B.Dynamics.Controllers.b2ControllerEdge,l=B.Dynamics.Controllers.b2GravityController,c=B.Dynamics.Controllers.b2TensorDampingController;B.inherit(t,B.Dynamics.Controllers.b2Controller),t.prototype.__super=B.Dynamics.Controllers.b2Controller.prototype,t.b2BuoyancyController=function(){B.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments),this.normal=new p(0,-1),this.offset=0,this.density=0,this.velocity=new p(0,0),this.linearDrag=2,this.angularDrag=1,this.useDensity=!1,this.useWorldGravity=!0,this.gravity=null},t.prototype.Step=function(e){if(this.m_bodyList){this.useWorldGravity&&(this.gravity=this.GetWorld().GetGravity().Copy());for(var t=this.m_bodyList;t;t=t.nextBody){var i=t.body;if(0!=i.IsAwake()){for(var n,o=new p,s=new p,r=0,a=0,l=i.GetFixtureList();l;l=l.GetNext()){var c=new p,h=l.GetShape().ComputeSubmergedArea(this.normal,this.offset,i.GetTransform(),c);r+=h,o.x+=h*c.x,o.y+=h*c.y;var u=0;a+=h*(u=(this.useDensity,1)),s.x+=h*c.x*u,s.y+=h*c.y*u}o.x/=r,o.y/=r,s.x/=a,s.y/=a,r<Number.MIN_VALUE||((n=this.gravity.GetNegative()).Multiply(this.density*r),i.ApplyForce(n,s),(n=i.GetLinearVelocityFromWorldPoint(o)).Subtract(this.velocity),n.Multiply(-this.linearDrag*r),i.ApplyForce(n,o),i.ApplyTorque(-i.GetInertia()/i.GetMass()*r*i.GetAngularVelocity()*this.angularDrag))}}}},t.prototype.Draw=function(e){var t=new p,i=new p;t.x=this.normal.x*this.offset+1e3*this.normal.y,t.y=this.normal.y*this.offset-1e3*this.normal.x,i.x=this.normal.x*this.offset-1e3*this.normal.y,i.y=this.normal.y*this.offset+1e3*this.normal.x;var n=new o(0,0,1);e.DrawSegment(t,i,n)},B.inherit(i,B.Dynamics.Controllers.b2Controller),i.prototype.__super=B.Dynamics.Controllers.b2Controller.prototype,i.b2ConstantAccelController=function(){B.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments),this.A=new p(0,0)},i.prototype.Step=function(e){for(var t=new p(this.A.x*e.dt,this.A.y*e.dt),i=this.m_bodyList;i;i=i.nextBody){var n=i.body;n.IsAwake()&&n.SetLinearVelocity(new p(n.GetLinearVelocity().x+t.x,n.GetLinearVelocity().y+t.y))}},B.inherit(n,B.Dynamics.Controllers.b2Controller),n.prototype.__super=B.Dynamics.Controllers.b2Controller.prototype,n.b2ConstantForceController=function(){B.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments),this.F=new p(0,0)},n.prototype.Step=function(e){for(var t=this.m_bodyList;t;t=t.nextBody){var i=t.body;i.IsAwake()&&i.ApplyForce(this.F,i.GetWorldCenter())}},r.b2Controller=function(){},r.prototype.Step=function(e){},r.prototype.Draw=function(e){},r.prototype.AddBody=function(e){var t=new a;t.controller=this,t.body=e,t.nextBody=this.m_bodyList,t.prevBody=null,(this.m_bodyList=t).nextBody&&(t.nextBody.prevBody=t),this.m_bodyCount++,t.nextController=e.m_controllerList,t.prevController=null,(e.m_controllerList=t).nextController&&(t.nextController.prevController=t),e.m_controllerCount++},r.prototype.RemoveBody=function(e){for(var t=e.m_controllerList;t&&t.controller!=this;)t=t.nextController;t.prevBody&&(t.prevBody.nextBody=t.nextBody),t.nextBody&&(t.nextBody.prevBody=t.prevBody),t.nextController&&(t.nextController.prevController=t.prevController),t.prevController&&(t.prevController.nextController=t.nextController),this.m_bodyList==t&&(this.m_bodyList=t.nextBody),e.m_controllerList==t&&(e.m_controllerList=t.nextController),e.m_controllerCount--,this.m_bodyCount--},r.prototype.Clear=function(){for(;this.m_bodyList;)this.RemoveBody(this.m_bodyList.body)},r.prototype.GetNext=function(){return this.m_next},r.prototype.GetWorld=function(){return this.m_world},r.prototype.GetBodyList=function(){return this.m_bodyList},a.b2ControllerEdge=function(){},B.inherit(l,B.Dynamics.Controllers.b2Controller),l.prototype.__super=B.Dynamics.Controllers.b2Controller.prototype,l.b2GravityController=function(){B.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments),this.G=1,this.invSqr=!0},l.prototype.Step=function(e){var t=null,i=null,n=null,o=0,s=null,r=null,a=null,l=0,c=0,h=0,u=null;if(this.invSqr)for(t=this.m_bodyList;t;t=t.nextBody)for(n=(i=t.body).GetWorldCenter(),o=i.GetMass(),s=this.m_bodyList;s!=t;s=s.nextBody)(h=(l=(a=(r=s.body).GetWorldCenter()).x-n.x)*l+(c=a.y-n.y)*c)<Number.MIN_VALUE||((u=new p(l,c)).Multiply(this.G/h/Math.sqrt(h)*o*r.GetMass()),i.IsAwake()&&i.ApplyForce(u,n),u.Multiply(-1),r.IsAwake()&&r.ApplyForce(u,a));else for(t=this.m_bodyList;t;t=t.nextBody)for(n=(i=t.body).GetWorldCenter(),o=i.GetMass(),s=this.m_bodyList;s!=t;s=s.nextBody)(h=(l=(a=(r=s.body).GetWorldCenter()).x-n.x)*l+(c=a.y-n.y)*c)<Number.MIN_VALUE||((u=new p(l,c)).Multiply(this.G/h*o*r.GetMass()),i.IsAwake()&&i.ApplyForce(u,n),u.Multiply(-1),r.IsAwake()&&r.ApplyForce(u,a))},B.inherit(c,B.Dynamics.Controllers.b2Controller),c.prototype.__super=B.Dynamics.Controllers.b2Controller.prototype,c.b2TensorDampingController=function(){B.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments),this.T=new e,this.maxTimestep=0},c.prototype.SetAxisAligned=function(e,t){void 0===t&&(t=0),this.T.col1.x=-(e=void 0===e?0:e),this.T.col1.y=0,this.T.col2.x=0,this.T.col2.y=-t,this.maxTimestep=0<e||0<t?1/Math.max(e,t):0},c.prototype.Step=function(e){var t=e.dt;if(!(t<=Number.MIN_VALUE)){t>this.maxTimestep&&0<this.maxTimestep&&(t=this.maxTimestep);for(var i=this.m_bodyList;i;i=i.nextBody){var n,o=i.body;o.IsAwake()&&(n=o.GetWorldVector(s.MulMV(this.T,o.GetLocalVector(o.GetLinearVelocity()))),o.SetLinearVelocity(new p(o.GetLinearVelocity().x+n.x*t,o.GetLinearVelocity().y+n.y*t)))}}}}(),function(){B.Common.b2Color,B.Common.b2internal;var x=B.Common.b2Settings,S=B.Common.Math.b2Mat22,t=B.Common.Math.b2Mat33,C=B.Common.Math.b2Math,T=(B.Common.Math.b2Sweep,B.Common.Math.b2Transform,B.Common.Math.b2Vec2),L=B.Common.Math.b2Vec3,n=B.Dynamics.Joints.b2DistanceJoint,o=B.Dynamics.Joints.b2DistanceJointDef,s=B.Dynamics.Joints.b2FrictionJoint,r=B.Dynamics.Joints.b2FrictionJointDef,a=B.Dynamics.Joints.b2GearJoint,l=B.Dynamics.Joints.b2GearJointDef,e=B.Dynamics.Joints.b2Jacobian,w=B.Dynamics.Joints.b2Joint,i=B.Dynamics.Joints.b2JointDef,c=B.Dynamics.Joints.b2JointEdge,h=B.Dynamics.Joints.b2LineJoint,u=B.Dynamics.Joints.b2LineJointDef,p=B.Dynamics.Joints.b2MouseJoint,d=B.Dynamics.Joints.b2MouseJointDef,m=B.Dynamics.Joints.b2PrismaticJoint,f=B.Dynamics.Joints.b2PrismaticJointDef,g=B.Dynamics.Joints.b2PulleyJoint,y=B.Dynamics.Joints.b2PulleyJointDef,b=B.Dynamics.Joints.b2RevoluteJoint,v=B.Dynamics.Joints.b2RevoluteJointDef,_=B.Dynamics.Joints.b2WeldJoint,k=B.Dynamics.Joints.b2WeldJointDef;B.Dynamics.b2Body,B.Dynamics.b2BodyDef,B.Dynamics.b2ContactFilter,B.Dynamics.b2ContactImpulse,B.Dynamics.b2ContactListener,B.Dynamics.b2ContactManager,B.Dynamics.b2DebugDraw,B.Dynamics.b2DestructionListener,B.Dynamics.b2FilterData,B.Dynamics.b2Fixture,B.Dynamics.b2FixtureDef,B.Dynamics.b2Island,B.Dynamics.b2TimeStep,B.Dynamics.b2World;B.inherit(n,B.Dynamics.Joints.b2Joint),n.prototype.__super=B.Dynamics.Joints.b2Joint.prototype,n.b2DistanceJoint=function(){B.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_localAnchor1=new T,this.m_localAnchor2=new T,this.m_u=new T},n.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},n.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},n.prototype.GetReactionForce=function(e){return new T((e=void 0===e?0:e)*this.m_impulse*this.m_u.x,e*this.m_impulse*this.m_u.y)},n.prototype.GetReactionTorque=function(e){return void 0===e&&(e=0),0},n.prototype.GetLength=function(){return this.m_length},n.prototype.SetLength=function(e){this.m_length=e=void 0===e?0:e},n.prototype.GetFrequency=function(){return this.m_frequencyHz},n.prototype.SetFrequency=function(e){this.m_frequencyHz=e=void 0===e?0:e},n.prototype.GetDampingRatio=function(){return this.m_dampingRatio},n.prototype.SetDampingRatio=function(e){this.m_dampingRatio=e=void 0===e?0:e},n.prototype.b2DistanceJoint=function(e){this.__super.b2Joint.call(this,e);this.m_localAnchor1.SetV(e.localAnchorA),this.m_localAnchor2.SetV(e.localAnchorB),this.m_length=e.length,this.m_frequencyHz=e.frequencyHz,this.m_dampingRatio=e.dampingRatio,this.m_impulse=0,this.m_gamma=0,this.m_bias=0},n.prototype.InitVelocityConstraints=function(e){var t=0,i=this.m_bodyA,n=this.m_bodyB,o=i.m_xf.R,s=this.m_localAnchor1.x-i.m_sweep.localCenter.x,r=this.m_localAnchor1.y-i.m_sweep.localCenter.y,t=o.col1.x*s+o.col2.x*r,r=o.col1.y*s+o.col2.y*r,s=t;o=n.m_xf.R;var a=this.m_localAnchor2.x-n.m_sweep.localCenter.x,l=this.m_localAnchor2.y-n.m_sweep.localCenter.y;t=o.col1.x*a+o.col2.x*l,l=o.col1.y*a+o.col2.y*l,this.m_u.x=n.m_sweep.c.x+(a=t)-i.m_sweep.c.x-s,this.m_u.y=n.m_sweep.c.y+l-i.m_sweep.c.y-r;var c=Math.sqrt(this.m_u.x*this.m_u.x+this.m_u.y*this.m_u.y);c>x.b2_linearSlop?this.m_u.Multiply(1/c):this.m_u.SetZero();var h=s*this.m_u.y-r*this.m_u.x,o=a*this.m_u.y-l*this.m_u.x,t=i.m_invMass+i.m_invI*h*h+n.m_invMass+n.m_invI*o*o;this.m_mass=0!=t?1/t:0,0<this.m_frequencyHz&&(h=c-this.m_length,o=2*Math.PI*this.m_frequencyHz,c=2*this.m_mass*this.m_dampingRatio*o,o=this.m_mass*o*o,this.m_gamma=e.dt*(c+e.dt*o),this.m_gamma=0!=this.m_gamma?1/this.m_gamma:0,this.m_bias=h*e.dt*o*this.m_gamma,this.m_mass=t+this.m_gamma,this.m_mass=0!=this.m_mass?1/this.m_mass:0),e.warmStarting?(this.m_impulse*=e.dtRatio,t=this.m_impulse*this.m_u.x,e=this.m_impulse*this.m_u.y,i.m_linearVelocity.x-=i.m_invMass*t,i.m_linearVelocity.y-=i.m_invMass*e,i.m_angularVelocity-=i.m_invI*(s*e-r*t),n.m_linearVelocity.x+=n.m_invMass*t,n.m_linearVelocity.y+=n.m_invMass*e,n.m_angularVelocity+=n.m_invI*(a*e-l*t)):this.m_impulse=0},n.prototype.SolveVelocityConstraints=function(e){var t=this.m_bodyA,i=this.m_bodyB,n=t.m_xf.R,o=this.m_localAnchor1.x-t.m_sweep.localCenter.x,s=this.m_localAnchor1.y-t.m_sweep.localCenter.y,r=n.col1.x*o+n.col2.x*s,s=n.col1.y*o+n.col2.y*s,o=r;n=i.m_xf.R;var a=this.m_localAnchor2.x-i.m_sweep.localCenter.x,l=this.m_localAnchor2.y-i.m_sweep.localCenter.y,r=n.col1.x*a+n.col2.x*l,l=n.col1.y*a+n.col2.y*l,c=t.m_linearVelocity.x+-t.m_angularVelocity*s,h=t.m_linearVelocity.y+t.m_angularVelocity*o,n=i.m_linearVelocity.x+-i.m_angularVelocity*l,r=i.m_linearVelocity.y+i.m_angularVelocity*(a=r),r=this.m_u.x*(n-c)+this.m_u.y*(r-h),h=-this.m_mass*(r+this.m_bias+this.m_gamma*this.m_impulse);this.m_impulse+=h;r=h*this.m_u.x,h*=this.m_u.y;t.m_linearVelocity.x-=t.m_invMass*r,t.m_linearVelocity.y-=t.m_invMass*h,t.m_angularVelocity-=t.m_invI*(o*h-s*r),i.m_linearVelocity.x+=i.m_invMass*r,i.m_linearVelocity.y+=i.m_invMass*h,i.m_angularVelocity+=i.m_invI*(a*h-l*r)},n.prototype.SolvePositionConstraints=function(e){if(void 0===e&&(e=0),0<this.m_frequencyHz)return!0;var t=this.m_bodyA,i=this.m_bodyB,n=t.m_xf.R,o=this.m_localAnchor1.x-t.m_sweep.localCenter.x,s=this.m_localAnchor1.y-t.m_sweep.localCenter.y,r=n.col1.x*o+n.col2.x*s,s=n.col1.y*o+n.col2.y*s,o=r;n=i.m_xf.R;var a=this.m_localAnchor2.x-i.m_sweep.localCenter.x,l=this.m_localAnchor2.y-i.m_sweep.localCenter.y,r=n.col1.x*a+n.col2.x*l,l=n.col1.y*a+n.col2.y*l,c=i.m_sweep.c.x+(a=r)-t.m_sweep.c.x-o,e=i.m_sweep.c.y+l-t.m_sweep.c.y-s,n=Math.sqrt(c*c+e*e);c/=n,e/=n;r=n-this.m_length,r=C.Clamp(r,-x.b2_maxLinearCorrection,x.b2_maxLinearCorrection),n=-this.m_mass*r;this.m_u.Set(c,e);e=n*this.m_u.x,n*=this.m_u.y;return t.m_sweep.c.x-=t.m_invMass*e,t.m_sweep.c.y-=t.m_invMass*n,t.m_sweep.a-=t.m_invI*(o*n-s*e),i.m_sweep.c.x+=i.m_invMass*e,i.m_sweep.c.y+=i.m_invMass*n,i.m_sweep.a+=i.m_invI*(a*n-l*e),t.SynchronizeTransform(),i.SynchronizeTransform(),C.Abs(r)<x.b2_linearSlop},B.inherit(o,B.Dynamics.Joints.b2JointDef),o.prototype.__super=B.Dynamics.Joints.b2JointDef.prototype,o.b2DistanceJointDef=function(){B.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.localAnchorA=new T,this.localAnchorB=new T},o.prototype.b2DistanceJointDef=function(){this.__super.b2JointDef.call(this),this.type=w.e_distanceJoint,this.length=1,this.frequencyHz=0,this.dampingRatio=0},o.prototype.Initialize=function(e,t,i,n){this.bodyA=e,this.bodyB=t,this.localAnchorA.SetV(this.bodyA.GetLocalPoint(i)),this.localAnchorB.SetV(this.bodyB.GetLocalPoint(n));t=n.x-i.x,i=n.y-i.y;this.length=Math.sqrt(t*t+i*i),this.frequencyHz=0,this.dampingRatio=0},B.inherit(s,B.Dynamics.Joints.b2Joint),s.prototype.__super=B.Dynamics.Joints.b2Joint.prototype,s.b2FrictionJoint=function(){B.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_localAnchorA=new T,this.m_localAnchorB=new T,this.m_linearMass=new S,this.m_linearImpulse=new T},s.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)},s.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)},s.prototype.GetReactionForce=function(e){return new T((e=void 0===e?0:e)*this.m_linearImpulse.x,e*this.m_linearImpulse.y)},s.prototype.GetReactionTorque=function(e){return(e=void 0===e?0:e)*this.m_angularImpulse},s.prototype.SetMaxForce=function(e){this.m_maxForce=e=void 0===e?0:e},s.prototype.GetMaxForce=function(){return this.m_maxForce},s.prototype.SetMaxTorque=function(e){this.m_maxTorque=e=void 0===e?0:e},s.prototype.GetMaxTorque=function(){return this.m_maxTorque},s.prototype.b2FrictionJoint=function(e){this.__super.b2Joint.call(this,e),this.m_localAnchorA.SetV(e.localAnchorA),this.m_localAnchorB.SetV(e.localAnchorB),this.m_linearMass.SetZero(),this.m_angularMass=0,this.m_linearImpulse.SetZero(),this.m_angularImpulse=0,this.m_maxForce=e.maxForce,this.m_maxTorque=e.maxTorque},s.prototype.InitVelocityConstraints=function(e){var t=0,i=this.m_bodyA,n=this.m_bodyB,o=i.m_xf.R,s=this.m_localAnchorA.x-i.m_sweep.localCenter.x,r=this.m_localAnchorA.y-i.m_sweep.localCenter.y,t=o.col1.x*s+o.col2.x*r,r=o.col1.y*s+o.col2.y*r,s=t;o=n.m_xf.R;var a=this.m_localAnchorB.x-n.m_sweep.localCenter.x,l=this.m_localAnchorB.y-n.m_sweep.localCenter.y;t=o.col1.x*a+o.col2.x*l;var l=o.col1.y*a+o.col2.y*l,a=t,c=i.m_invMass,h=n.m_invMass,u=i.m_invI,o=n.m_invI,t=new S;t.col1.x=c+h,t.col2.x=0,t.col1.y=0,t.col2.y=c+h,t.col1.x+=u*r*r,t.col2.x+=-u*s*r,t.col1.y+=-u*s*r,t.col2.y+=u*s*s,t.col1.x+=o*l*l,t.col2.x+=-o*a*l,t.col1.y+=-o*a*l,t.col2.y+=o*a*a,t.GetInverse(this.m_linearMass),this.m_angularMass=u+o,0<this.m_angularMass&&(this.m_angularMass=1/this.m_angularMass),e.warmStarting?(this.m_linearImpulse.x*=e.dtRatio,this.m_linearImpulse.y*=e.dtRatio,this.m_angularImpulse*=e.dtRatio,e=this.m_linearImpulse,i.m_linearVelocity.x-=c*e.x,i.m_linearVelocity.y-=c*e.y,i.m_angularVelocity-=u*(s*e.y-r*e.x+this.m_angularImpulse),n.m_linearVelocity.x+=h*e.x,n.m_linearVelocity.y+=h*e.y,n.m_angularVelocity+=o*(a*e.y-l*e.x+this.m_angularImpulse)):(this.m_linearImpulse.SetZero(),this.m_angularImpulse=0)},s.prototype.SolveVelocityConstraints=function(e){var t=this.m_bodyA,i=this.m_bodyB,n=t.m_linearVelocity,o=t.m_angularVelocity,s=i.m_linearVelocity,r=i.m_angularVelocity,a=t.m_invMass,l=i.m_invMass,c=t.m_invI,h=i.m_invI,u=t.m_xf.R,p=this.m_localAnchorA.x-t.m_sweep.localCenter.x,d=this.m_localAnchorA.y-t.m_sweep.localCenter.y,m=u.col1.x*p+u.col2.x*d,d=u.col1.y*p+u.col2.y*d,p=m;u=i.m_xf.R;var f=this.m_localAnchorB.x-i.m_sweep.localCenter.x,g=this.m_localAnchorB.y-i.m_sweep.localCenter.y;m=u.col1.x*f+u.col2.x*g;var g=u.col1.y*f+u.col2.y*g,f=m,u=-this.m_angularMass*(r-o),m=this.m_angularImpulse,y=e.dt*this.m_maxTorque;this.m_angularImpulse=C.Clamp(this.m_angularImpulse+u,-y,y),o-=c*(u=this.m_angularImpulse-m);m=s.x-(r+=h*u)*g-n.x+o*d,u=s.y+r*f-n.y-o*p,m=C.MulMV(this.m_linearMass,new T(-m,-u)),u=this.m_linearImpulse.Copy();this.m_linearImpulse.Add(m),y=e.dt*this.m_maxForce,this.m_linearImpulse.LengthSquared()>y*y&&(this.m_linearImpulse.Normalize(),this.m_linearImpulse.Multiply(y)),m=C.SubtractVV(this.m_linearImpulse,u),n.x-=a*m.x,n.y-=a*m.y,o-=c*(p*m.y-d*m.x),s.x+=l*m.x,s.y+=l*m.y,r+=h*(f*m.y-g*m.x),t.m_angularVelocity=o,i.m_angularVelocity=r},s.prototype.SolvePositionConstraints=function(e){return void 0===e&&(e=0),!0},B.inherit(r,B.Dynamics.Joints.b2JointDef),r.prototype.__super=B.Dynamics.Joints.b2JointDef.prototype,r.b2FrictionJointDef=function(){B.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.localAnchorA=new T,this.localAnchorB=new T},r.prototype.b2FrictionJointDef=function(){this.__super.b2JointDef.call(this),this.type=w.e_frictionJoint,this.maxForce=0,this.maxTorque=0},r.prototype.Initialize=function(e,t,i){this.bodyA=e,this.bodyB=t,this.localAnchorA.SetV(this.bodyA.GetLocalPoint(i)),this.localAnchorB.SetV(this.bodyB.GetLocalPoint(i))},B.inherit(a,B.Dynamics.Joints.b2Joint),a.prototype.__super=B.Dynamics.Joints.b2Joint.prototype,a.b2GearJoint=function(){B.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_groundAnchor1=new T,this.m_groundAnchor2=new T,this.m_localAnchor1=new T,this.m_localAnchor2=new T,this.m_J=new e},a.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},a.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},a.prototype.GetReactionForce=function(e){return new T((e=void 0===e?0:e)*this.m_impulse*this.m_J.linearB.x,e*this.m_impulse*this.m_J.linearB.y)},a.prototype.GetReactionTorque=function(e){var t=this.m_bodyB.m_xf.R,i=this.m_localAnchor1.x-this.m_bodyB.m_sweep.localCenter.x,n=this.m_localAnchor1.y-this.m_bodyB.m_sweep.localCenter.y,o=t.col1.x*i+t.col2.x*n,n=t.col1.y*i+t.col2.y*n,s=this.m_impulse*this.m_J.linearB.x,t=this.m_impulse*this.m_J.linearB.y;return(e=void 0===e?0:e)*(this.m_impulse*this.m_J.angularB-(i=o)*t+n*s)},a.prototype.GetRatio=function(){return this.m_ratio},a.prototype.SetRatio=function(e){this.m_ratio=e=void 0===e?0:e},a.prototype.b2GearJoint=function(e){this.__super.b2Joint.call(this,e);var t=parseInt(e.joint1.m_type),i=parseInt(e.joint2.m_type);this.m_revolute1=null,this.m_prismatic1=null,this.m_revolute2=null,this.m_prismatic2=null;var n=0,o=0;this.m_ground1=e.joint1.GetBodyA(),this.m_bodyA=e.joint1.GetBodyB(),n=t==w.e_revoluteJoint?(this.m_revolute1=e.joint1 instanceof b?e.joint1:null,this.m_groundAnchor1.SetV(this.m_revolute1.m_localAnchor1),this.m_localAnchor1.SetV(this.m_revolute1.m_localAnchor2),this.m_revolute1.GetJointAngle()):(this.m_prismatic1=e.joint1 instanceof m?e.joint1:null,this.m_groundAnchor1.SetV(this.m_prismatic1.m_localAnchor1),this.m_localAnchor1.SetV(this.m_prismatic1.m_localAnchor2),this.m_prismatic1.GetJointTranslation()),this.m_ground2=e.joint2.GetBodyA(),this.m_bodyB=e.joint2.GetBodyB(),o=i==w.e_revoluteJoint?(this.m_revolute2=e.joint2 instanceof b?e.joint2:null,this.m_groundAnchor2.SetV(this.m_revolute2.m_localAnchor1),this.m_localAnchor2.SetV(this.m_revolute2.m_localAnchor2),this.m_revolute2.GetJointAngle()):(this.m_prismatic2=e.joint2 instanceof m?e.joint2:null,this.m_groundAnchor2.SetV(this.m_prismatic2.m_localAnchor1),this.m_localAnchor2.SetV(this.m_prismatic2.m_localAnchor2),this.m_prismatic2.GetJointTranslation()),this.m_ratio=e.ratio,this.m_constant=n+this.m_ratio*o,this.m_impulse=0},a.prototype.InitVelocityConstraints=function(e){var t,i,n=this.m_ground1,o=this.m_ground2,s=this.m_bodyA,r=this.m_bodyB,a=0,l=0,c=0,h=0,u=0,p=0,d=0;this.m_J.SetZero(),this.m_revolute1?(this.m_J.angularA=-1,d+=s.m_invI):(t=n.m_xf.R,i=this.m_prismatic1.m_localXAxis1,a=t.col1.x*i.x+t.col2.x*i.y,l=t.col1.y*i.x+t.col2.y*i.y,t=s.m_xf.R,c=this.m_localAnchor1.x-s.m_sweep.localCenter.x,h=this.m_localAnchor1.y-s.m_sweep.localCenter.y,p=t.col1.x*c+t.col2.x*h,h=t.col1.y*c+t.col2.y*h,u=(c=p)*l-h*a,this.m_J.linearA.Set(-a,-l),this.m_J.angularA=-u,d+=s.m_invMass+s.m_invI*u*u),this.m_revolute2?(this.m_J.angularB=-this.m_ratio,d+=this.m_ratio*this.m_ratio*r.m_invI):(t=o.m_xf.R,i=this.m_prismatic2.m_localXAxis1,a=t.col1.x*i.x+t.col2.x*i.y,l=t.col1.y*i.x+t.col2.y*i.y,t=r.m_xf.R,c=this.m_localAnchor2.x-r.m_sweep.localCenter.x,h=this.m_localAnchor2.y-r.m_sweep.localCenter.y,p=t.col1.x*c+t.col2.x*h,h=t.col1.y*c+t.col2.y*h,u=(c=p)*l-h*a,this.m_J.linearB.Set(-this.m_ratio*a,-this.m_ratio*l),this.m_J.angularB=-this.m_ratio*u,d+=this.m_ratio*this.m_ratio*(r.m_invMass+r.m_invI*u*u)),this.m_mass=0<d?1/d:0,e.warmStarting?(s.m_linearVelocity.x+=s.m_invMass*this.m_impulse*this.m_J.linearA.x,s.m_linearVelocity.y+=s.m_invMass*this.m_impulse*this.m_J.linearA.y,s.m_angularVelocity+=s.m_invI*this.m_impulse*this.m_J.angularA,r.m_linearVelocity.x+=r.m_invMass*this.m_impulse*this.m_J.linearB.x,r.m_linearVelocity.y+=r.m_invMass*this.m_impulse*this.m_J.linearB.y,r.m_angularVelocity+=r.m_invI*this.m_impulse*this.m_J.angularB):this.m_impulse=0},a.prototype.SolveVelocityConstraints=function(e){var t=this.m_bodyA,i=this.m_bodyB,n=this.m_J.Compute(t.m_linearVelocity,t.m_angularVelocity,i.m_linearVelocity,i.m_angularVelocity),n=-this.m_mass*n;this.m_impulse+=n,t.m_linearVelocity.x+=t.m_invMass*n*this.m_J.linearA.x,t.m_linearVelocity.y+=t.m_invMass*n*this.m_J.linearA.y,t.m_angularVelocity+=t.m_invI*n*this.m_J.angularA,i.m_linearVelocity.x+=i.m_invMass*n*this.m_J.linearB.x,i.m_linearVelocity.y+=i.m_invMass*n*this.m_J.linearB.y,i.m_angularVelocity+=i.m_invI*n*this.m_J.angularB},a.prototype.SolvePositionConstraints=function(e){void 0===e&&(e=0);var t=this.m_bodyA,i=this.m_bodyB,n=0,e=0,n=this.m_revolute1?this.m_revolute1.GetJointAngle():this.m_prismatic1.GetJointTranslation(),e=this.m_revolute2?this.m_revolute2.GetJointAngle():this.m_prismatic2.GetJointTranslation(),e=this.m_constant-(n+this.m_ratio*e),e=-this.m_mass*e;return t.m_sweep.c.x+=t.m_invMass*e*this.m_J.linearA.x,t.m_sweep.c.y+=t.m_invMass*e*this.m_J.linearA.y,t.m_sweep.a+=t.m_invI*e*this.m_J.angularA,i.m_sweep.c.x+=i.m_invMass*e*this.m_J.linearB.x,i.m_sweep.c.y+=i.m_invMass*e*this.m_J.linearB.y,i.m_sweep.a+=i.m_invI*e*this.m_J.angularB,t.SynchronizeTransform(),i.SynchronizeTransform(),0<x.b2_linearSlop},B.inherit(l,B.Dynamics.Joints.b2JointDef),l.prototype.__super=B.Dynamics.Joints.b2JointDef.prototype,l.b2GearJointDef=function(){B.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments)},l.prototype.b2GearJointDef=function(){this.__super.b2JointDef.call(this),this.type=w.e_gearJoint,this.joint1=null,this.joint2=null,this.ratio=1},e.b2Jacobian=function(){this.linearA=new T,this.linearB=new T},e.prototype.SetZero=function(){this.linearA.SetZero(),this.angularA=0,this.linearB.SetZero(),this.angularB=0},e.prototype.Set=function(e,t,i,n){void 0===t&&(t=0),void 0===n&&(n=0),this.linearA.SetV(e),this.angularA=t,this.linearB.SetV(i),this.angularB=n},e.prototype.Compute=function(e,t,i,n){return this.linearA.x*e.x+this.linearA.y*e.y+this.angularA*(t=void 0===t?0:t)+(this.linearB.x*i.x+this.linearB.y*i.y)+this.angularB*(n=void 0===n?0:n)},w.b2Joint=function(){this.m_edgeA=new c,this.m_edgeB=new c,this.m_localCenterA=new T,this.m_localCenterB=new T},w.prototype.GetType=function(){return this.m_type},w.prototype.GetAnchorA=function(){return null},w.prototype.GetAnchorB=function(){return null},w.prototype.GetReactionForce=function(e){return void 0===e&&(e=0),null},w.prototype.GetReactionTorque=function(e){return void 0===e&&(e=0),0},w.prototype.GetBodyA=function(){return this.m_bodyA},w.prototype.GetBodyB=function(){return this.m_bodyB},w.prototype.GetNext=function(){return this.m_next},w.prototype.GetUserData=function(){return this.m_userData},w.prototype.SetUserData=function(e){this.m_userData=e},w.prototype.IsActive=function(){return this.m_bodyA.IsActive()&&this.m_bodyB.IsActive()},w.Create=function(e,t){var i=null;switch(e.type){case w.e_distanceJoint:i=new n(e instanceof o?e:null);break;case w.e_mouseJoint:i=new p(e instanceof d?e:null);break;case w.e_prismaticJoint:i=new m(e instanceof f?e:null);break;case w.e_revoluteJoint:i=new b(e instanceof v?e:null);break;case w.e_pulleyJoint:i=new g(e instanceof y?e:null);break;case w.e_gearJoint:i=new a(e instanceof l?e:null);break;case w.e_lineJoint:i=new h(e instanceof u?e:null);break;case w.e_weldJoint:i=new _(e instanceof k?e:null);break;case w.e_frictionJoint:i=new s(e instanceof r?e:null)}return i},w.Destroy=function(e,t){},w.prototype.b2Joint=function(e){x.b2Assert(e.bodyA!=e.bodyB),this.m_type=e.type,this.m_prev=null,this.m_next=null,this.m_bodyA=e.bodyA,this.m_bodyB=e.bodyB,this.m_collideConnected=e.collideConnected,this.m_islandFlag=!1,this.m_userData=e.userData},w.prototype.InitVelocityConstraints=function(e){},w.prototype.SolveVelocityConstraints=function(e){},w.prototype.FinalizeVelocityConstraints=function(){},w.prototype.SolvePositionConstraints=function(e){return void 0===e&&(e=0),!1},B.postDefs.push(function(){B.Dynamics.Joints.b2Joint.e_unknownJoint=0,B.Dynamics.Joints.b2Joint.e_revoluteJoint=1,B.Dynamics.Joints.b2Joint.e_prismaticJoint=2,B.Dynamics.Joints.b2Joint.e_distanceJoint=3,B.Dynamics.Joints.b2Joint.e_pulleyJoint=4,B.Dynamics.Joints.b2Joint.e_mouseJoint=5,B.Dynamics.Joints.b2Joint.e_gearJoint=6,B.Dynamics.Joints.b2Joint.e_lineJoint=7,B.Dynamics.Joints.b2Joint.e_weldJoint=8,B.Dynamics.Joints.b2Joint.e_frictionJoint=9,B.Dynamics.Joints.b2Joint.e_inactiveLimit=0,B.Dynamics.Joints.b2Joint.e_atLowerLimit=1,B.Dynamics.Joints.b2Joint.e_atUpperLimit=2,B.Dynamics.Joints.b2Joint.e_equalLimits=3}),i.b2JointDef=function(){},i.prototype.b2JointDef=function(){this.type=w.e_unknownJoint,this.userData=null,this.bodyA=null,this.bodyB=null,this.collideConnected=!1},c.b2JointEdge=function(){},B.inherit(h,B.Dynamics.Joints.b2Joint),h.prototype.__super=B.Dynamics.Joints.b2Joint.prototype,h.b2LineJoint=function(){B.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_localAnchor1=new T,this.m_localAnchor2=new T,this.m_localXAxis1=new T,this.m_localYAxis1=new T,this.m_axis=new T,this.m_perp=new T,this.m_K=new S,this.m_impulse=new T},h.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},h.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},h.prototype.GetReactionForce=function(e){return new T((e=void 0===e?0:e)*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.x),e*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.y))},h.prototype.GetReactionTorque=function(e){return(e=void 0===e?0:e)*this.m_impulse.y},h.prototype.GetJointTranslation=function(){var e=this.m_bodyA,t=this.m_bodyB,i=e.GetWorldPoint(this.m_localAnchor1),n=t.GetWorldPoint(this.m_localAnchor2),t=n.x-i.x,i=n.y-i.y,e=e.GetWorldVector(this.m_localXAxis1);return e.x*t+e.y*i},h.prototype.GetJointSpeed=function(){var e=this.m_bodyA,t=this.m_bodyB,i=e.m_xf.R,n=this.m_localAnchor1.x-e.m_sweep.localCenter.x,o=this.m_localAnchor1.y-e.m_sweep.localCenter.y,s=i.col1.x*n+i.col2.x*o,o=i.col1.y*n+i.col2.y*o,n=s;i=t.m_xf.R;var r=this.m_localAnchor2.x-t.m_sweep.localCenter.x,a=this.m_localAnchor2.y-t.m_sweep.localCenter.y,s=i.col1.x*r+i.col2.x*a,a=i.col1.y*r+i.col2.y*a,l=e.m_sweep.c.x+n,c=e.m_sweep.c.y+o,h=t.m_sweep.c.x+(r=s)-l,i=t.m_sweep.c.y+a-c,s=e.GetWorldVector(this.m_localXAxis1),l=e.m_linearVelocity,c=t.m_linearVelocity,e=e.m_angularVelocity,t=t.m_angularVelocity;return h*(-e*s.y)+i*(e*s.x)+(s.x*(c.x+-t*a-l.x- -e*o)+s.y*(c.y+t*r-l.y-e*n))},h.prototype.IsLimitEnabled=function(){return this.m_enableLimit},h.prototype.EnableLimit=function(e){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=e},h.prototype.GetLowerLimit=function(){return this.m_lowerTranslation},h.prototype.GetUpperLimit=function(){return this.m_upperTranslation},h.prototype.SetLimits=function(e,t){void 0===e&&(e=0),void 0===t&&(t=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_lowerTranslation=e,this.m_upperTranslation=t},h.prototype.IsMotorEnabled=function(){return this.m_enableMotor},h.prototype.EnableMotor=function(e){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=e},h.prototype.SetMotorSpeed=function(e){void 0===e&&(e=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=e},h.prototype.GetMotorSpeed=function(){return this.m_motorSpeed},h.prototype.SetMaxMotorForce=function(e){void 0===e&&(e=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorForce=e},h.prototype.GetMaxMotorForce=function(){return this.m_maxMotorForce},h.prototype.GetMotorForce=function(){return this.m_motorImpulse},h.prototype.b2LineJoint=function(e){this.__super.b2Joint.call(this,e);this.m_localAnchor1.SetV(e.localAnchorA),this.m_localAnchor2.SetV(e.localAnchorB),this.m_localXAxis1.SetV(e.localAxisA),this.m_localYAxis1.x=-this.m_localXAxis1.y,this.m_localYAxis1.y=this.m_localXAxis1.x,this.m_impulse.SetZero(),this.m_motorMass=0,this.m_motorImpulse=0,this.m_lowerTranslation=e.lowerTranslation,this.m_upperTranslation=e.upperTranslation,this.m_maxMotorForce=e.maxMotorForce,this.m_motorSpeed=e.motorSpeed,this.m_enableLimit=e.enableLimit,this.m_enableMotor=e.enableMotor,this.m_limitState=w.e_inactiveLimit,this.m_axis.SetZero(),this.m_perp.SetZero()},h.prototype.InitVelocityConstraints=function(e){var t=this.m_bodyA,i=this.m_bodyB,n=0;this.m_localCenterA.SetV(t.GetLocalCenter()),this.m_localCenterB.SetV(i.GetLocalCenter());var o=t.GetTransform(),s=(i.GetTransform(),t.m_xf.R),r=this.m_localAnchor1.x-this.m_localCenterA.x,a=this.m_localAnchor1.y-this.m_localCenterA.y,n=s.col1.x*r+s.col2.x*a,a=s.col1.y*r+s.col2.y*a,r=n;s=i.m_xf.R;var l=this.m_localAnchor2.x-this.m_localCenterB.x,c=this.m_localAnchor2.y-this.m_localCenterB.y;n=s.col1.x*l+s.col2.x*c;c=s.col1.y*l+s.col2.y*c,s=i.m_sweep.c.x+(l=n)-t.m_sweep.c.x-r,n=i.m_sweep.c.y+c-t.m_sweep.c.y-a;this.m_invMassA=t.m_invMass,this.m_invMassB=i.m_invMass,this.m_invIA=t.m_invI,this.m_invIB=i.m_invI,this.m_axis.SetV(C.MulMV(o.R,this.m_localXAxis1)),this.m_a1=(s+r)*this.m_axis.y-(n+a)*this.m_axis.x,this.m_a2=l*this.m_axis.y-c*this.m_axis.x,this.m_motorMass=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_a1*this.m_a1+this.m_invIB*this.m_a2*this.m_a2,this.m_motorMass=this.m_motorMass>Number.MIN_VALUE?1/this.m_motorMass:0,this.m_perp.SetV(C.MulMV(o.R,this.m_localYAxis1)),this.m_s1=(s+r)*this.m_perp.y-(n+a)*this.m_perp.x,this.m_s2=l*this.m_perp.y-c*this.m_perp.x;var h,r=this.m_invMassA,a=this.m_invMassB,l=this.m_invIA,c=this.m_invIB;this.m_K.col1.x=r+a+l*this.m_s1*this.m_s1+c*this.m_s2*this.m_s2,this.m_K.col1.y=l*this.m_s1*this.m_a1+c*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=r+a+l*this.m_a1*this.m_a1+c*this.m_a2*this.m_a2,this.m_enableLimit?(h=this.m_axis.x*s+this.m_axis.y*n,C.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*x.b2_linearSlop?this.m_limitState=w.e_equalLimits:h<=this.m_lowerTranslation?this.m_limitState!=w.e_atLowerLimit&&(this.m_limitState=w.e_atLowerLimit,this.m_impulse.y=0):h>=this.m_upperTranslation?this.m_limitState!=w.e_atUpperLimit&&(this.m_limitState=w.e_atUpperLimit,this.m_impulse.y=0):(this.m_limitState=w.e_inactiveLimit,this.m_impulse.y=0)):this.m_limitState=w.e_inactiveLimit,0==this.m_enableMotor&&(this.m_motorImpulse=0),e.warmStarting?(this.m_impulse.x*=e.dtRatio,this.m_impulse.y*=e.dtRatio,this.m_motorImpulse*=e.dtRatio,s=this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.x,n=this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.y,h=this.m_impulse.x*this.m_s1+(this.m_motorImpulse+this.m_impulse.y)*this.m_a1,e=this.m_impulse.x*this.m_s2+(this.m_motorImpulse+this.m_impulse.y)*this.m_a2,t.m_linearVelocity.x-=this.m_invMassA*s,t.m_linearVelocity.y-=this.m_invMassA*n,t.m_angularVelocity-=this.m_invIA*h,i.m_linearVelocity.x+=this.m_invMassB*s,i.m_linearVelocity.y+=this.m_invMassB*n,i.m_angularVelocity+=this.m_invIB*e):(this.m_impulse.SetZero(),this.m_motorImpulse=0)},h.prototype.SolveVelocityConstraints=function(e){var t=this.m_bodyA,i=this.m_bodyB,n=t.m_linearVelocity,o=t.m_angularVelocity,s=i.m_linearVelocity,r=i.m_angularVelocity,a=0,l=0,c=0,h=0;this.m_enableMotor&&this.m_limitState!=w.e_equalLimits&&(d=this.m_axis.x*(s.x-n.x)+this.m_axis.y*(s.y-n.y)+this.m_a2*r-this.m_a1*o,p=this.m_motorMass*(this.m_motorSpeed-d),u=this.m_motorImpulse,d=e.dt*this.m_maxMotorForce,this.m_motorImpulse=C.Clamp(this.m_motorImpulse+p,-d,d),a=(p=this.m_motorImpulse-u)*this.m_axis.x,l=p*this.m_axis.y,c=p*this.m_a1,h=p*this.m_a2,n.x-=this.m_invMassA*a,n.y-=this.m_invMassA*l,o-=this.m_invIA*c,s.x+=this.m_invMassB*a,s.y+=this.m_invMassB*l,r+=this.m_invIB*h);var u,p,d,m,e=this.m_perp.x*(s.x-n.x)+this.m_perp.y*(s.y-n.y)+this.m_s2*r-this.m_s1*o;h=this.m_enableLimit&&this.m_limitState!=w.e_inactiveLimit?(d=this.m_axis.x*(s.x-n.x)+this.m_axis.y*(s.y-n.y)+this.m_a2*r-this.m_a1*o,u=this.m_impulse.Copy(),m=this.m_K.Solve(new T,-e,-d),this.m_impulse.Add(m),this.m_limitState==w.e_atLowerLimit?this.m_impulse.y=C.Max(this.m_impulse.y,0):this.m_limitState==w.e_atUpperLimit&&(this.m_impulse.y=C.Min(this.m_impulse.y,0)),p=-e-(this.m_impulse.y-u.y)*this.m_K.col2.x,d=(d=0)!=this.m_K.col1.x?p/this.m_K.col1.x+u.x:u.x,this.m_impulse.x=d,m.x=this.m_impulse.x-u.x,m.y=this.m_impulse.y-u.y,a=m.x*this.m_perp.x+m.y*this.m_axis.x,l=m.x*this.m_perp.y+m.y*this.m_axis.y,c=m.x*this.m_s1+m.y*this.m_a1,m.x*this.m_s2+m.y*this.m_a2):(m=(m=0)!=this.m_K.col1.x?-e/this.m_K.col1.x:0,this.m_impulse.x+=m,a=m*this.m_perp.x,l=m*this.m_perp.y,c=m*this.m_s1,m*this.m_s2),n.x-=this.m_invMassA*a,n.y-=this.m_invMassA*l,o-=this.m_invIA*c,s.x+=this.m_invMassB*a,s.y+=this.m_invMassB*l,r+=this.m_invIB*h,t.m_linearVelocity.SetV(n),t.m_angularVelocity=o,i.m_linearVelocity.SetV(s),i.m_angularVelocity=r},h.prototype.SolvePositionConstraints=function(e){void 0===e&&(e=0);var t=this.m_bodyA,i=this.m_bodyB,n=t.m_sweep.c,o=t.m_sweep.a,s=i.m_sweep.c,r=i.m_sweep.a,a=0,l=0,c=0,h=0,u=0,p=0,d=!1,m=0,f=S.FromAngle(o),g=S.FromAngle(r),y=this.m_localAnchor1.x-this.m_localCenterA.x,v=this.m_localAnchor1.y-this.m_localCenterA.y,a=f.col1.x*y+f.col2.x*v,v=f.col1.y*y+f.col2.y*v,y=a,b=this.m_localAnchor2.x-this.m_localCenterB.x,_=this.m_localAnchor2.y-this.m_localCenterB.y;a=g.col1.x*b+g.col2.x*_;_=g.col1.y*b+g.col2.y*_,e=s.x+(b=a)-n.x-y,g=s.y+_-n.y-v;this.m_enableLimit&&(this.m_axis=C.MulMV(f,this.m_localXAxis1),this.m_a1=(e+y)*this.m_axis.y-(g+v)*this.m_axis.x,this.m_a2=b*this.m_axis.y-_*this.m_axis.x,a=this.m_axis.x*e+this.m_axis.y*g,C.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*x.b2_linearSlop?(m=C.Clamp(a,-x.b2_maxLinearCorrection,x.b2_maxLinearCorrection),p=C.Abs(a),d=!0):a<=this.m_lowerTranslation?(m=C.Clamp(a-this.m_lowerTranslation+x.b2_linearSlop,-x.b2_maxLinearCorrection,0),p=this.m_lowerTranslation-a,d=!0):a>=this.m_upperTranslation&&(m=C.Clamp(a-this.m_upperTranslation+x.b2_linearSlop,0,x.b2_maxLinearCorrection),p=a-this.m_upperTranslation,d=!0)),this.m_perp=C.MulMV(f,this.m_localYAxis1),this.m_s1=(e+y)*this.m_perp.y-(g+v)*this.m_perp.x,this.m_s2=b*this.m_perp.y-_*this.m_perp.x;_=new T,g=this.m_perp.x*e+this.m_perp.y*g,p=C.Max(p,C.Abs(g));d?(l=this.m_invMassA,c=this.m_invMassB,h=this.m_invIA,u=this.m_invIB,this.m_K.col1.x=l+c+h*this.m_s1*this.m_s1+u*this.m_s2*this.m_s2,this.m_K.col1.y=h*this.m_s1*this.m_a1+u*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=l+c+h*this.m_a1*this.m_a1+u*this.m_a2*this.m_a2,this.m_K.Solve(_,-g,-m)):(l=this.m_invMassA,c=this.m_invMassB,h=this.m_invIA,u=this.m_invIB,w=l+c+h*this.m_s1*this.m_s1+u*this.m_s2*this.m_s2,_.x=0!=w?-g/w:0,_.y=0);var u=_.x*this.m_perp.x+_.y*this.m_axis.x,g=_.x*this.m_perp.y+_.y*this.m_axis.y,w=_.x*this.m_s1+_.y*this.m_a1,_=_.x*this.m_s2+_.y*this.m_a2;return n.x-=this.m_invMassA*u,n.y-=this.m_invMassA*g,o-=this.m_invIA*w,s.x+=this.m_invMassB*u,s.y+=this.m_invMassB*g,r+=this.m_invIB*_,t.m_sweep.a=o,i.m_sweep.a=r,t.SynchronizeTransform(),i.SynchronizeTransform(),p<=x.b2_linearSlop&&0<=x.b2_angularSlop},B.inherit(u,B.Dynamics.Joints.b2JointDef),u.prototype.__super=B.Dynamics.Joints.b2JointDef.prototype,u.b2LineJointDef=function(){B.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.localAnchorA=new T,this.localAnchorB=new T,this.localAxisA=new T},u.prototype.b2LineJointDef=function(){this.__super.b2JointDef.call(this),this.type=w.e_lineJoint,this.localAxisA.Set(1,0),this.enableLimit=!1,this.lowerTranslation=0,this.upperTranslation=0,this.enableMotor=!1,this.maxMotorForce=0,this.motorSpeed=0},u.prototype.Initialize=function(e,t,i,n){this.bodyA=e,this.bodyB=t,this.localAnchorA=this.bodyA.GetLocalPoint(i),this.localAnchorB=this.bodyB.GetLocalPoint(i),this.localAxisA=this.bodyA.GetLocalVector(n)},B.inherit(p,B.Dynamics.Joints.b2Joint),p.prototype.__super=B.Dynamics.Joints.b2Joint.prototype,p.b2MouseJoint=function(){B.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.K=new S,this.K1=new S,this.K2=new S,this.m_localAnchor=new T,this.m_target=new T,this.m_impulse=new T,this.m_mass=new S,this.m_C=new T},p.prototype.GetAnchorA=function(){return this.m_target},p.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor)},p.prototype.GetReactionForce=function(e){return new T((e=void 0===e?0:e)*this.m_impulse.x,e*this.m_impulse.y)},p.prototype.GetReactionTorque=function(e){return void 0===e&&(e=0),0},p.prototype.GetTarget=function(){return this.m_target},p.prototype.SetTarget=function(e){0==this.m_bodyB.IsAwake()&&this.m_bodyB.SetAwake(!0),this.m_target=e},p.prototype.GetMaxForce=function(){return this.m_maxForce},p.prototype.SetMaxForce=function(e){this.m_maxForce=e=void 0===e?0:e},p.prototype.GetFrequency=function(){return this.m_frequencyHz},p.prototype.SetFrequency=function(e){this.m_frequencyHz=e=void 0===e?0:e},p.prototype.GetDampingRatio=function(){return this.m_dampingRatio},p.prototype.SetDampingRatio=function(e){this.m_dampingRatio=e=void 0===e?0:e},p.prototype.b2MouseJoint=function(e){this.__super.b2Joint.call(this,e),this.m_target.SetV(e.target);var t=this.m_target.x-this.m_bodyB.m_xf.position.x,i=this.m_target.y-this.m_bodyB.m_xf.position.y,n=this.m_bodyB.m_xf.R;this.m_localAnchor.x=t*n.col1.x+i*n.col1.y,this.m_localAnchor.y=t*n.col2.x+i*n.col2.y,this.m_maxForce=e.maxForce,this.m_impulse.SetZero(),this.m_frequencyHz=e.frequencyHz,this.m_dampingRatio=e.dampingRatio,this.m_beta=0,this.m_gamma=0},p.prototype.InitVelocityConstraints=function(e){var t=this.m_bodyB,i=t.GetMass(),n=2*Math.PI*this.m_frequencyHz,o=2*i*this.m_dampingRatio*n,s=i*n*n;this.m_gamma=e.dt*(o+e.dt*s),this.m_gamma=0!=this.m_gamma?1/this.m_gamma:0,this.m_beta=e.dt*s*this.m_gamma;i=t.m_xf.R,n=this.m_localAnchor.x-t.m_sweep.localCenter.x,o=this.m_localAnchor.y-t.m_sweep.localCenter.y,s=i.col1.x*n+i.col2.x*o,o=i.col1.y*n+i.col2.y*o,n=s,i=t.m_invMass,s=t.m_invI;this.K1.col1.x=i,this.K1.col2.x=0,this.K1.col1.y=0,this.K1.col2.y=i,this.K2.col1.x=s*o*o,this.K2.col2.x=-s*n*o,this.K2.col1.y=-s*n*o,this.K2.col2.y=s*n*n,this.K.SetM(this.K1),this.K.AddM(this.K2),this.K.col1.x+=this.m_gamma,this.K.col2.y+=this.m_gamma,this.K.GetInverse(this.m_mass),this.m_C.x=t.m_sweep.c.x+n-this.m_target.x,this.m_C.y=t.m_sweep.c.y+o-this.m_target.y,t.m_angularVelocity*=.98,this.m_impulse.x*=e.dtRatio,this.m_impulse.y*=e.dtRatio,t.m_linearVelocity.x+=i*this.m_impulse.x,t.m_linearVelocity.y+=i*this.m_impulse.y,t.m_angularVelocity+=s*(n*this.m_impulse.y-o*this.m_impulse.x)},p.prototype.SolveVelocityConstraints=function(e){var t=this.m_bodyB,i=t.m_xf.R,n=this.m_localAnchor.x-t.m_sweep.localCenter.x,o=this.m_localAnchor.y-t.m_sweep.localCenter.y,s=i.col1.x*n+i.col2.x*o,o=i.col1.y*n+i.col2.y*o,r=t.m_linearVelocity.x+-t.m_angularVelocity*o,a=t.m_linearVelocity.y+t.m_angularVelocity*(n=s);i=this.m_mass,s=r+this.m_beta*this.m_C.x+this.m_gamma*this.m_impulse.x;var l=a+this.m_beta*this.m_C.y+this.m_gamma*this.m_impulse.y,a=-(i.col1.x*s+i.col2.x*l),s=-(i.col1.y*s+i.col2.y*l),i=this.m_impulse.x,l=this.m_impulse.y;this.m_impulse.x+=a,this.m_impulse.y+=s;e=e.dt*this.m_maxForce;this.m_impulse.LengthSquared()>e*e&&this.m_impulse.Multiply(e/this.m_impulse.Length()),a=this.m_impulse.x-i,s=this.m_impulse.y-l,t.m_linearVelocity.x+=t.m_invMass*a,t.m_linearVelocity.y+=t.m_invMass*s,t.m_angularVelocity+=t.m_invI*(n*s-o*a)},p.prototype.SolvePositionConstraints=function(e){return void 0===e&&(e=0),!0},B.inherit(d,B.Dynamics.Joints.b2JointDef),d.prototype.__super=B.Dynamics.Joints.b2JointDef.prototype,d.b2MouseJointDef=function(){B.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.target=new T},d.prototype.b2MouseJointDef=function(){this.__super.b2JointDef.call(this),this.type=w.e_mouseJoint,this.maxForce=0,this.frequencyHz=5,this.dampingRatio=.7},B.inherit(m,B.Dynamics.Joints.b2Joint),m.prototype.__super=B.Dynamics.Joints.b2Joint.prototype,m.b2PrismaticJoint=function(){B.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_localAnchor1=new T,this.m_localAnchor2=new T,this.m_localXAxis1=new T,this.m_localYAxis1=new T,this.m_axis=new T,this.m_perp=new T,this.m_K=new t,this.m_impulse=new L},m.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},m.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},m.prototype.GetReactionForce=function(e){return new T((e=void 0===e?0:e)*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x),e*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y))},m.prototype.GetReactionTorque=function(e){return(e=void 0===e?0:e)*this.m_impulse.y},m.prototype.GetJointTranslation=function(){var e=this.m_bodyA,t=this.m_bodyB,i=e.GetWorldPoint(this.m_localAnchor1),n=t.GetWorldPoint(this.m_localAnchor2),t=n.x-i.x,i=n.y-i.y,e=e.GetWorldVector(this.m_localXAxis1);return e.x*t+e.y*i},m.prototype.GetJointSpeed=function(){var e=this.m_bodyA,t=this.m_bodyB,i=e.m_xf.R,n=this.m_localAnchor1.x-e.m_sweep.localCenter.x,o=this.m_localAnchor1.y-e.m_sweep.localCenter.y,s=i.col1.x*n+i.col2.x*o,o=i.col1.y*n+i.col2.y*o,n=s;i=t.m_xf.R;var r=this.m_localAnchor2.x-t.m_sweep.localCenter.x,a=this.m_localAnchor2.y-t.m_sweep.localCenter.y,s=i.col1.x*r+i.col2.x*a,a=i.col1.y*r+i.col2.y*a,l=e.m_sweep.c.x+n,c=e.m_sweep.c.y+o,h=t.m_sweep.c.x+(r=s)-l,i=t.m_sweep.c.y+a-c,s=e.GetWorldVector(this.m_localXAxis1),l=e.m_linearVelocity,c=t.m_linearVelocity,e=e.m_angularVelocity,t=t.m_angularVelocity;return h*(-e*s.y)+i*(e*s.x)+(s.x*(c.x+-t*a-l.x- -e*o)+s.y*(c.y+t*r-l.y-e*n))},m.prototype.IsLimitEnabled=function(){return this.m_enableLimit},m.prototype.EnableLimit=function(e){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=e},m.prototype.GetLowerLimit=function(){return this.m_lowerTranslation},m.prototype.GetUpperLimit=function(){return this.m_upperTranslation},m.prototype.SetLimits=function(e,t){void 0===e&&(e=0),void 0===t&&(t=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_lowerTranslation=e,this.m_upperTranslation=t},m.prototype.IsMotorEnabled=function(){return this.m_enableMotor},m.prototype.EnableMotor=function(e){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=e},m.prototype.SetMotorSpeed=function(e){void 0===e&&(e=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=e},m.prototype.GetMotorSpeed=function(){return this.m_motorSpeed},m.prototype.SetMaxMotorForce=function(e){void 0===e&&(e=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorForce=e},m.prototype.GetMotorForce=function(){return this.m_motorImpulse},m.prototype.b2PrismaticJoint=function(e){this.__super.b2Joint.call(this,e);this.m_localAnchor1.SetV(e.localAnchorA),this.m_localAnchor2.SetV(e.localAnchorB),this.m_localXAxis1.SetV(e.localAxisA),this.m_localYAxis1.x=-this.m_localXAxis1.y,this.m_localYAxis1.y=this.m_localXAxis1.x,this.m_refAngle=e.referenceAngle,this.m_impulse.SetZero(),this.m_motorMass=0,this.m_motorImpulse=0,this.m_lowerTranslation=e.lowerTranslation,this.m_upperTranslation=e.upperTranslation,this.m_maxMotorForce=e.maxMotorForce,this.m_motorSpeed=e.motorSpeed,this.m_enableLimit=e.enableLimit,this.m_enableMotor=e.enableMotor,this.m_limitState=w.e_inactiveLimit,this.m_axis.SetZero(),this.m_perp.SetZero()},m.prototype.InitVelocityConstraints=function(e){var t=this.m_bodyA,i=this.m_bodyB,n=0;this.m_localCenterA.SetV(t.GetLocalCenter()),this.m_localCenterB.SetV(i.GetLocalCenter());var o=t.GetTransform(),s=(i.GetTransform(),t.m_xf.R),r=this.m_localAnchor1.x-this.m_localCenterA.x,a=this.m_localAnchor1.y-this.m_localCenterA.y,n=s.col1.x*r+s.col2.x*a,a=s.col1.y*r+s.col2.y*a,r=n;s=i.m_xf.R;var l=this.m_localAnchor2.x-this.m_localCenterB.x,c=this.m_localAnchor2.y-this.m_localCenterB.y;n=s.col1.x*l+s.col2.x*c;c=s.col1.y*l+s.col2.y*c,s=i.m_sweep.c.x+(l=n)-t.m_sweep.c.x-r,n=i.m_sweep.c.y+c-t.m_sweep.c.y-a;this.m_invMassA=t.m_invMass,this.m_invMassB=i.m_invMass,this.m_invIA=t.m_invI,this.m_invIB=i.m_invI,this.m_axis.SetV(C.MulMV(o.R,this.m_localXAxis1)),this.m_a1=(s+r)*this.m_axis.y-(n+a)*this.m_axis.x,this.m_a2=l*this.m_axis.y-c*this.m_axis.x,this.m_motorMass=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_a1*this.m_a1+this.m_invIB*this.m_a2*this.m_a2,this.m_motorMass>Number.MIN_VALUE&&(this.m_motorMass=1/this.m_motorMass),this.m_perp.SetV(C.MulMV(o.R,this.m_localYAxis1)),this.m_s1=(s+r)*this.m_perp.y-(n+a)*this.m_perp.x,this.m_s2=l*this.m_perp.y-c*this.m_perp.x;var h,r=this.m_invMassA,a=this.m_invMassB,l=this.m_invIA,c=this.m_invIB;this.m_K.col1.x=r+a+l*this.m_s1*this.m_s1+c*this.m_s2*this.m_s2,this.m_K.col1.y=l*this.m_s1+c*this.m_s2,this.m_K.col1.z=l*this.m_s1*this.m_a1+c*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=l+c,this.m_K.col2.z=l*this.m_a1+c*this.m_a2,this.m_K.col3.x=this.m_K.col1.z,this.m_K.col3.y=this.m_K.col2.z,this.m_K.col3.z=r+a+l*this.m_a1*this.m_a1+c*this.m_a2*this.m_a2,this.m_enableLimit?(h=this.m_axis.x*s+this.m_axis.y*n,C.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*x.b2_linearSlop?this.m_limitState=w.e_equalLimits:h<=this.m_lowerTranslation?this.m_limitState!=w.e_atLowerLimit&&(this.m_limitState=w.e_atLowerLimit,this.m_impulse.z=0):h>=this.m_upperTranslation?this.m_limitState!=w.e_atUpperLimit&&(this.m_limitState=w.e_atUpperLimit,this.m_impulse.z=0):(this.m_limitState=w.e_inactiveLimit,this.m_impulse.z=0)):this.m_limitState=w.e_inactiveLimit,0==this.m_enableMotor&&(this.m_motorImpulse=0),e.warmStarting?(this.m_impulse.x*=e.dtRatio,this.m_impulse.y*=e.dtRatio,this.m_motorImpulse*=e.dtRatio,s=this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x,n=this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y,h=this.m_impulse.x*this.m_s1+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a1,e=this.m_impulse.x*this.m_s2+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a2,t.m_linearVelocity.x-=this.m_invMassA*s,t.m_linearVelocity.y-=this.m_invMassA*n,t.m_angularVelocity-=this.m_invIA*h,i.m_linearVelocity.x+=this.m_invMassB*s,i.m_linearVelocity.y+=this.m_invMassB*n,i.m_angularVelocity+=this.m_invIB*e):(this.m_impulse.SetZero(),this.m_motorImpulse=0)},m.prototype.SolveVelocityConstraints=function(e){var t=this.m_bodyA,i=this.m_bodyB,n=t.m_linearVelocity,o=t.m_angularVelocity,s=i.m_linearVelocity,r=i.m_angularVelocity,a=0,l=0,c=0,h=0;this.m_enableMotor&&this.m_limitState!=w.e_equalLimits&&(f=this.m_axis.x*(s.x-n.x)+this.m_axis.y*(s.y-n.y)+this.m_a2*r-this.m_a1*o,d=this.m_motorMass*(this.m_motorSpeed-f),p=this.m_motorImpulse,u=e.dt*this.m_maxMotorForce,this.m_motorImpulse=C.Clamp(this.m_motorImpulse+d,-u,u),a=(d=this.m_motorImpulse-p)*this.m_axis.x,l=d*this.m_axis.y,c=d*this.m_a1,h=d*this.m_a2,n.x-=this.m_invMassA*a,n.y-=this.m_invMassA*l,o-=this.m_invIA*c,s.x+=this.m_invMassB*a,s.y+=this.m_invMassB*l,r+=this.m_invIB*h);var u,p,d,m=this.m_perp.x*(s.x-n.x)+this.m_perp.y*(s.y-n.y)+this.m_s2*r-this.m_s1*o,f=r-o;h=this.m_enableLimit&&this.m_limitState!=w.e_inactiveLimit?(e=this.m_axis.x*(s.x-n.x)+this.m_axis.y*(s.y-n.y)+this.m_a2*r-this.m_a1*o,u=this.m_impulse.Copy(),p=this.m_K.Solve33(new L,-m,-f,-e),this.m_impulse.Add(p),this.m_limitState==w.e_atLowerLimit?this.m_impulse.z=C.Max(this.m_impulse.z,0):this.m_limitState==w.e_atUpperLimit&&(this.m_impulse.z=C.Min(this.m_impulse.z,0)),d=-m-(this.m_impulse.z-u.z)*this.m_K.col3.x,e=-f-(this.m_impulse.z-u.z)*this.m_K.col3.y,(e=this.m_K.Solve22(new T,d,e)).x+=u.x,e.y+=u.y,this.m_impulse.x=e.x,this.m_impulse.y=e.y,p.x=this.m_impulse.x-u.x,p.y=this.m_impulse.y-u.y,p.z=this.m_impulse.z-u.z,a=p.x*this.m_perp.x+p.z*this.m_axis.x,l=p.x*this.m_perp.y+p.z*this.m_axis.y,c=p.x*this.m_s1+p.y+p.z*this.m_a1,p.x*this.m_s2+p.y+p.z*this.m_a2):(f=this.m_K.Solve22(new T,-m,-f),this.m_impulse.x+=f.x,this.m_impulse.y+=f.y,a=f.x*this.m_perp.x,l=f.x*this.m_perp.y,c=f.x*this.m_s1+f.y,f.x*this.m_s2+f.y),n.x-=this.m_invMassA*a,n.y-=this.m_invMassA*l,o-=this.m_invIA*c,s.x+=this.m_invMassB*a,s.y+=this.m_invMassB*l,r+=this.m_invIB*h,t.m_linearVelocity.SetV(n),t.m_angularVelocity=o,i.m_linearVelocity.SetV(s),i.m_angularVelocity=r},m.prototype.SolvePositionConstraints=function(e){void 0===e&&(e=0);var t=this.m_bodyA,i=this.m_bodyB,n=t.m_sweep.c,o=t.m_sweep.a,s=i.m_sweep.c,r=i.m_sweep.a,a=0,l=0,c=0,h=0,u=0,p=0,d=!1,m=0,f=S.FromAngle(o),g=S.FromAngle(r),y=this.m_localAnchor1.x-this.m_localCenterA.x,v=this.m_localAnchor1.y-this.m_localCenterA.y,a=f.col1.x*y+f.col2.x*v,v=f.col1.y*y+f.col2.y*v,y=a,b=this.m_localAnchor2.x-this.m_localCenterB.x,_=this.m_localAnchor2.y-this.m_localCenterB.y;a=g.col1.x*b+g.col2.x*_;_=g.col1.y*b+g.col2.y*_,e=s.x+(b=a)-n.x-y,g=s.y+_-n.y-v;this.m_enableLimit&&(this.m_axis=C.MulMV(f,this.m_localXAxis1),this.m_a1=(e+y)*this.m_axis.y-(g+v)*this.m_axis.x,this.m_a2=b*this.m_axis.y-_*this.m_axis.x,a=this.m_axis.x*e+this.m_axis.y*g,C.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*x.b2_linearSlop?(m=C.Clamp(a,-x.b2_maxLinearCorrection,x.b2_maxLinearCorrection),p=C.Abs(a),d=!0):a<=this.m_lowerTranslation?(m=C.Clamp(a-this.m_lowerTranslation+x.b2_linearSlop,-x.b2_maxLinearCorrection,0),p=this.m_lowerTranslation-a,d=!0):a>=this.m_upperTranslation&&(m=C.Clamp(a-this.m_upperTranslation+x.b2_linearSlop,0,x.b2_maxLinearCorrection),p=a-this.m_upperTranslation,d=!0)),this.m_perp=C.MulMV(f,this.m_localYAxis1),this.m_s1=(e+y)*this.m_perp.y-(g+v)*this.m_perp.x,this.m_s2=b*this.m_perp.y-_*this.m_perp.x;var _=new L,e=this.m_perp.x*e+this.m_perp.y*g,g=r-o-this.m_refAngle,p=C.Max(p,C.Abs(e)),w=C.Abs(g);d?(l=this.m_invMassA,c=this.m_invMassB,h=this.m_invIA,u=this.m_invIB,this.m_K.col1.x=l+c+h*this.m_s1*this.m_s1+u*this.m_s2*this.m_s2,this.m_K.col1.y=h*this.m_s1+u*this.m_s2,this.m_K.col1.z=h*this.m_s1*this.m_a1+u*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=h+u,this.m_K.col2.z=h*this.m_a1+u*this.m_a2,this.m_K.col3.x=this.m_K.col1.z,this.m_K.col3.y=this.m_K.col2.z,this.m_K.col3.z=l+c+h*this.m_a1*this.m_a1+u*this.m_a2*this.m_a2,this.m_K.Solve33(_,-e,-g,-m)):(l=this.m_invMassA,c=this.m_invMassB,h=this.m_invIA,u=this.m_invIB,l=l+c+h*this.m_s1*this.m_s1+u*this.m_s2*this.m_s2,c=h*this.m_s1+u*this.m_s2,k=h+u,this.m_K.col1.Set(l,c,0),this.m_K.col2.Set(c,k,0),k=this.m_K.Solve22(new T,-e,-g),_.x=k.x,_.y=k.y,_.z=0);var e=_.x*this.m_perp.x+_.z*this.m_axis.x,g=_.x*this.m_perp.y+_.z*this.m_axis.y,k=_.x*this.m_s1+_.y+_.z*this.m_a1,_=_.x*this.m_s2+_.y+_.z*this.m_a2;return n.x-=this.m_invMassA*e,n.y-=this.m_invMassA*g,o-=this.m_invIA*k,s.x+=this.m_invMassB*e,s.y+=this.m_invMassB*g,r+=this.m_invIB*_,t.m_sweep.a=o,i.m_sweep.a=r,t.SynchronizeTransform(),i.SynchronizeTransform(),p<=x.b2_linearSlop&&w<=x.b2_angularSlop},B.inherit(f,B.Dynamics.Joints.b2JointDef),f.prototype.__super=B.Dynamics.Joints.b2JointDef.prototype,f.b2PrismaticJointDef=function(){B.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.localAnchorA=new T,this.localAnchorB=new T,this.localAxisA=new T},f.prototype.b2PrismaticJointDef=function(){this.__super.b2JointDef.call(this),this.type=w.e_prismaticJoint,this.localAxisA.Set(1,0),this.referenceAngle=0,this.enableLimit=!1,this.lowerTranslation=0,this.upperTranslation=0,this.enableMotor=!1,this.maxMotorForce=0,this.motorSpeed=0},f.prototype.Initialize=function(e,t,i,n){this.bodyA=e,this.bodyB=t,this.localAnchorA=this.bodyA.GetLocalPoint(i),this.localAnchorB=this.bodyB.GetLocalPoint(i),this.localAxisA=this.bodyA.GetLocalVector(n),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()},B.inherit(g,B.Dynamics.Joints.b2Joint),g.prototype.__super=B.Dynamics.Joints.b2Joint.prototype,g.b2PulleyJoint=function(){B.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_groundAnchor1=new T,this.m_groundAnchor2=new T,this.m_localAnchor1=new T,this.m_localAnchor2=new T,this.m_u1=new T,this.m_u2=new T},g.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},g.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},g.prototype.GetReactionForce=function(e){return new T((e=void 0===e?0:e)*this.m_impulse*this.m_u2.x,e*this.m_impulse*this.m_u2.y)},g.prototype.GetReactionTorque=function(e){return void 0===e&&(e=0),0},g.prototype.GetGroundAnchorA=function(){var e=this.m_ground.m_xf.position.Copy();return e.Add(this.m_groundAnchor1),e},g.prototype.GetGroundAnchorB=function(){var e=this.m_ground.m_xf.position.Copy();return e.Add(this.m_groundAnchor2),e},g.prototype.GetLength1=function(){var e=this.m_bodyA.GetWorldPoint(this.m_localAnchor1),t=this.m_ground.m_xf.position.x+this.m_groundAnchor1.x,i=this.m_ground.m_xf.position.y+this.m_groundAnchor1.y,t=e.x-t,i=e.y-i;return Math.sqrt(t*t+i*i)},g.prototype.GetLength2=function(){var e=this.m_bodyB.GetWorldPoint(this.m_localAnchor2),t=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x,i=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y,t=e.x-t,i=e.y-i;return Math.sqrt(t*t+i*i)},g.prototype.GetRatio=function(){return this.m_ratio},g.prototype.b2PulleyJoint=function(e){this.__super.b2Joint.call(this,e);this.m_ground=this.m_bodyA.m_world.m_groundBody,this.m_groundAnchor1.x=e.groundAnchorA.x-this.m_ground.m_xf.position.x,this.m_groundAnchor1.y=e.groundAnchorA.y-this.m_ground.m_xf.position.y,this.m_groundAnchor2.x=e.groundAnchorB.x-this.m_ground.m_xf.position.x,this.m_groundAnchor2.y=e.groundAnchorB.y-this.m_ground.m_xf.position.y,this.m_localAnchor1.SetV(e.localAnchorA),this.m_localAnchor2.SetV(e.localAnchorB),this.m_ratio=e.ratio,this.m_constant=e.lengthA+this.m_ratio*e.lengthB,this.m_maxLength1=C.Min(e.maxLengthA,this.m_constant-this.m_ratio*g.b2_minPulleyLength),this.m_maxLength2=C.Min(e.maxLengthB,(this.m_constant-g.b2_minPulleyLength)/this.m_ratio),this.m_impulse=0,this.m_limitImpulse1=0,this.m_limitImpulse2=0},g.prototype.InitVelocityConstraints=function(e){var t=this.m_bodyA,i=this.m_bodyB,n=t.m_xf.R,o=this.m_localAnchor1.x-t.m_sweep.localCenter.x,s=this.m_localAnchor1.y-t.m_sweep.localCenter.y,r=n.col1.x*o+n.col2.x*s,s=n.col1.y*o+n.col2.y*s,o=r;n=i.m_xf.R;var a=this.m_localAnchor2.x-i.m_sweep.localCenter.x,l=this.m_localAnchor2.y-i.m_sweep.localCenter.y,r=n.col1.x*a+n.col2.x*l,l=n.col1.y*a+n.col2.y*l,c=t.m_sweep.c.x+o,h=t.m_sweep.c.y+s,u=i.m_sweep.c.x+(a=r),p=i.m_sweep.c.y+l,d=this.m_ground.m_xf.position.x+this.m_groundAnchor1.x,m=this.m_ground.m_xf.position.y+this.m_groundAnchor1.y,n=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x,r=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y;this.m_u1.Set(c-d,h-m),this.m_u2.Set(u-n,p-r);n=this.m_u1.Length(),p=this.m_u2.Length();n>x.b2_linearSlop?this.m_u1.Multiply(1/n):this.m_u1.SetZero(),p>x.b2_linearSlop?this.m_u2.Multiply(1/p):this.m_u2.SetZero(),0<this.m_constant-n-this.m_ratio*p?(this.m_state=w.e_inactiveLimit,this.m_impulse=0):this.m_state=w.e_atUpperLimit,n<this.m_maxLength1?(this.m_limitState1=w.e_inactiveLimit,this.m_limitImpulse1=0):this.m_limitState1=w.e_atUpperLimit,p<this.m_maxLength2?(this.m_limitState2=w.e_inactiveLimit,this.m_limitImpulse2=0):this.m_limitState2=w.e_atUpperLimit;r=o*this.m_u1.y-s*this.m_u1.x,n=a*this.m_u2.y-l*this.m_u2.x;this.m_limitMass1=t.m_invMass+t.m_invI*r*r,this.m_limitMass2=i.m_invMass+i.m_invI*n*n,this.m_pulleyMass=this.m_limitMass1+this.m_ratio*this.m_ratio*this.m_limitMass2,this.m_limitMass1=1/this.m_limitMass1,this.m_limitMass2=1/this.m_limitMass2,this.m_pulleyMass=1/this.m_pulleyMass,e.warmStarting?(this.m_impulse*=e.dtRatio,this.m_limitImpulse1*=e.dtRatio,this.m_limitImpulse2*=e.dtRatio,p=(-this.m_impulse-this.m_limitImpulse1)*this.m_u1.x,r=(-this.m_impulse-this.m_limitImpulse1)*this.m_u1.y,n=(-this.m_ratio*this.m_impulse-this.m_limitImpulse2)*this.m_u2.x,e=(-this.m_ratio*this.m_impulse-this.m_limitImpulse2)*this.m_u2.y,t.m_linearVelocity.x+=t.m_invMass*p,t.m_linearVelocity.y+=t.m_invMass*r,t.m_angularVelocity+=t.m_invI*(o*r-s*p),i.m_linearVelocity.x+=i.m_invMass*n,i.m_linearVelocity.y+=i.m_invMass*e,i.m_angularVelocity+=i.m_invI*(a*e-l*n)):(this.m_impulse=0,this.m_limitImpulse1=0,this.m_limitImpulse2=0)},g.prototype.SolveVelocityConstraints=function(e){var t=this.m_bodyA,i=this.m_bodyB,n=t.m_xf.R,o=this.m_localAnchor1.x-t.m_sweep.localCenter.x,s=this.m_localAnchor1.y-t.m_sweep.localCenter.y,r=n.col1.x*o+n.col2.x*s,s=n.col1.y*o+n.col2.y*s,o=r;n=i.m_xf.R;var a=this.m_localAnchor2.x-i.m_sweep.localCenter.x,l=this.m_localAnchor2.y-i.m_sweep.localCenter.y,r=n.col1.x*a+n.col2.x*l,l=n.col1.y*a+n.col2.y*l,a=r,c=0,h=0,u=0,p=0,d=0,m=0,f=0,g=0,y=0,n=0,r=0;this.m_state==w.e_atUpperLimit&&(c=t.m_linearVelocity.x+-t.m_angularVelocity*s,h=t.m_linearVelocity.y+t.m_angularVelocity*o,u=i.m_linearVelocity.x+-i.m_angularVelocity*l,p=i.m_linearVelocity.y+i.m_angularVelocity*a,y=-(this.m_u1.x*c+this.m_u1.y*h)-this.m_ratio*(this.m_u2.x*u+this.m_u2.y*p),n=this.m_pulleyMass*-y,r=this.m_impulse,this.m_impulse=C.Max(0,this.m_impulse+n),d=-(n=this.m_impulse-r)*this.m_u1.x,m=-n*this.m_u1.y,f=-this.m_ratio*n*this.m_u2.x,g=-this.m_ratio*n*this.m_u2.y,t.m_linearVelocity.x+=t.m_invMass*d,t.m_linearVelocity.y+=t.m_invMass*m,t.m_angularVelocity+=t.m_invI*(o*m-s*d),i.m_linearVelocity.x+=i.m_invMass*f,i.m_linearVelocity.y+=i.m_invMass*g,i.m_angularVelocity+=i.m_invI*(a*g-l*f)),this.m_limitState1==w.e_atUpperLimit&&(c=t.m_linearVelocity.x+-t.m_angularVelocity*s,h=t.m_linearVelocity.y+t.m_angularVelocity*o,y=-(this.m_u1.x*c+this.m_u1.y*h),n=-this.m_limitMass1*y,r=this.m_limitImpulse1,this.m_limitImpulse1=C.Max(0,this.m_limitImpulse1+n),d=-(n=this.m_limitImpulse1-r)*this.m_u1.x,m=-n*this.m_u1.y,t.m_linearVelocity.x+=t.m_invMass*d,t.m_linearVelocity.y+=t.m_invMass*m,t.m_angularVelocity+=t.m_invI*(o*m-s*d)),this.m_limitState2==w.e_atUpperLimit&&(u=i.m_linearVelocity.x+-i.m_angularVelocity*l,p=i.m_linearVelocity.y+i.m_angularVelocity*a,y=-(this.m_u2.x*u+this.m_u2.y*p),n=-this.m_limitMass2*y,r=this.m_limitImpulse2,this.m_limitImpulse2=C.Max(0,this.m_limitImpulse2+n),f=-(n=this.m_limitImpulse2-r)*this.m_u2.x,g=-n*this.m_u2.y,i.m_linearVelocity.x+=i.m_invMass*f,i.m_linearVelocity.y+=i.m_invMass*g,i.m_angularVelocity+=i.m_invI*(a*g-l*f))},g.prototype.SolvePositionConstraints=function(e){void 0===e&&(e=0);var t,i=this.m_bodyA,n=this.m_bodyB,o=this.m_ground.m_xf.position.x+this.m_groundAnchor1.x,s=this.m_ground.m_xf.position.y+this.m_groundAnchor1.y,r=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x,a=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y,l=0,c=0,h=0,u=0,p=0,d=0,m=0,f=0,g=0,y=0,v=0,b=0,_=0,e=0;return this.m_state==w.e_atUpperLimit&&(t=i.m_xf.R,l=this.m_localAnchor1.x-i.m_sweep.localCenter.x,c=this.m_localAnchor1.y-i.m_sweep.localCenter.y,_=t.col1.x*l+t.col2.x*c,c=t.col1.y*l+t.col2.y*c,l=_,t=n.m_xf.R,h=this.m_localAnchor2.x-n.m_sweep.localCenter.x,u=this.m_localAnchor2.y-n.m_sweep.localCenter.y,_=t.col1.x*h+t.col2.x*u,u=t.col1.y*h+t.col2.y*u,h=_,p=i.m_sweep.c.x+l,d=i.m_sweep.c.y+c,m=n.m_sweep.c.x+h,f=n.m_sweep.c.y+u,this.m_u1.Set(p-o,d-s),this.m_u2.Set(m-r,f-a),g=this.m_u1.Length(),y=this.m_u2.Length(),g>x.b2_linearSlop?this.m_u1.Multiply(1/g):this.m_u1.SetZero(),y>x.b2_linearSlop?this.m_u2.Multiply(1/y):this.m_u2.SetZero(),v=this.m_constant-g-this.m_ratio*y,e=C.Max(e,-v),v=C.Clamp(v+x.b2_linearSlop,-x.b2_maxLinearCorrection,0),p=-(b=-this.m_pulleyMass*v)*this.m_u1.x,d=-b*this.m_u1.y,m=-this.m_ratio*b*this.m_u2.x,f=-this.m_ratio*b*this.m_u2.y,i.m_sweep.c.x+=i.m_invMass*p,i.m_sweep.c.y+=i.m_invMass*d,i.m_sweep.a+=i.m_invI*(l*d-c*p),n.m_sweep.c.x+=n.m_invMass*m,n.m_sweep.c.y+=n.m_invMass*f,n.m_sweep.a+=n.m_invI*(h*f-u*m),i.SynchronizeTransform(),n.SynchronizeTransform()),this.m_limitState1==w.e_atUpperLimit&&(t=i.m_xf.R,l=this.m_localAnchor1.x-i.m_sweep.localCenter.x,c=this.m_localAnchor1.y-i.m_sweep.localCenter.y,_=t.col1.x*l+t.col2.x*c,c=t.col1.y*l+t.col2.y*c,l=_,p=i.m_sweep.c.x+l,d=i.m_sweep.c.y+c,this.m_u1.Set(p-o,d-s),(g=this.m_u1.Length())>x.b2_linearSlop?(this.m_u1.x*=1/g,this.m_u1.y*=1/g):this.m_u1.SetZero(),v=this.m_maxLength1-g,e=C.Max(e,-v),v=C.Clamp(v+x.b2_linearSlop,-x.b2_maxLinearCorrection,0),p=-(b=-this.m_limitMass1*v)*this.m_u1.x,d=-b*this.m_u1.y,i.m_sweep.c.x+=i.m_invMass*p,i.m_sweep.c.y+=i.m_invMass*d,i.m_sweep.a+=i.m_invI*(l*d-c*p),i.SynchronizeTransform()),this.m_limitState2==w.e_atUpperLimit&&(t=n.m_xf.R,h=this.m_localAnchor2.x-n.m_sweep.localCenter.x,u=this.m_localAnchor2.y-n.m_sweep.localCenter.y,_=t.col1.x*h+t.col2.x*u,u=t.col1.y*h+t.col2.y*u,h=_,m=n.m_sweep.c.x+h,f=n.m_sweep.c.y+u,this.m_u2.Set(m-r,f-a),(y=this.m_u2.Length())>x.b2_linearSlop?(this.m_u2.x*=1/y,this.m_u2.y*=1/y):this.m_u2.SetZero(),v=this.m_maxLength2-y,e=C.Max(e,-v),v=C.Clamp(v+x.b2_linearSlop,-x.b2_maxLinearCorrection,0),m=-(b=-this.m_limitMass2*v)*this.m_u2.x,f=-b*this.m_u2.y,n.m_sweep.c.x+=n.m_invMass*m,n.m_sweep.c.y+=n.m_invMass*f,n.m_sweep.a+=n.m_invI*(h*f-u*m),n.SynchronizeTransform()),e<x.b2_linearSlop},B.postDefs.push(function(){B.Dynamics.Joints.b2PulleyJoint.b2_minPulleyLength=2}),B.inherit(y,B.Dynamics.Joints.b2JointDef),y.prototype.__super=B.Dynamics.Joints.b2JointDef.prototype,y.b2PulleyJointDef=function(){B.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.groundAnchorA=new T,this.groundAnchorB=new T,this.localAnchorA=new T,this.localAnchorB=new T},y.prototype.b2PulleyJointDef=function(){this.__super.b2JointDef.call(this),this.type=w.e_pulleyJoint,this.groundAnchorA.Set(-1,1),this.groundAnchorB.Set(1,1),this.localAnchorA.Set(-1,0),this.localAnchorB.Set(1,0),this.lengthA=0,this.maxLengthA=0,this.lengthB=0,this.maxLengthB=0,this.ratio=1,this.collideConnected=!0},y.prototype.Initialize=function(e,t,i,n,o,s,r){void 0===r&&(r=0),this.bodyA=e,this.bodyB=t,this.groundAnchorA.SetV(i),this.groundAnchorB.SetV(n),this.localAnchorA=this.bodyA.GetLocalPoint(o),this.localAnchorB=this.bodyB.GetLocalPoint(s);t=o.x-i.x,i=o.y-i.y;this.lengthA=Math.sqrt(t*t+i*i);i=s.x-n.x,n=s.y-n.y;this.lengthB=Math.sqrt(i*i+n*n),this.ratio=r;r=this.lengthA+this.ratio*this.lengthB;this.maxLengthA=r-this.ratio*g.b2_minPulleyLength,this.maxLengthB=(r-g.b2_minPulleyLength)/this.ratio},B.inherit(b,B.Dynamics.Joints.b2Joint),b.prototype.__super=B.Dynamics.Joints.b2Joint.prototype,b.b2RevoluteJoint=function(){B.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.K=new S,this.K1=new S,this.K2=new S,this.K3=new S,this.impulse3=new L,this.impulse2=new T,this.reduced=new T,this.m_localAnchor1=new T,this.m_localAnchor2=new T,this.m_impulse=new L,this.m_mass=new t},b.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},b.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},b.prototype.GetReactionForce=function(e){return new T((e=void 0===e?0:e)*this.m_impulse.x,e*this.m_impulse.y)},b.prototype.GetReactionTorque=function(e){return(e=void 0===e?0:e)*this.m_impulse.z},b.prototype.GetJointAngle=function(){return this.m_bodyB.m_sweep.a-this.m_bodyA.m_sweep.a-this.m_referenceAngle},b.prototype.GetJointSpeed=function(){return this.m_bodyB.m_angularVelocity-this.m_bodyA.m_angularVelocity},b.prototype.IsLimitEnabled=function(){return this.m_enableLimit},b.prototype.EnableLimit=function(e){this.m_enableLimit=e},b.prototype.GetLowerLimit=function(){return this.m_lowerAngle},b.prototype.GetUpperLimit=function(){return this.m_upperAngle},b.prototype.SetLimits=function(e,t){void 0===t&&(t=0),this.m_lowerAngle=e=void 0===e?0:e,this.m_upperAngle=t},b.prototype.IsMotorEnabled=function(){return this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor},b.prototype.EnableMotor=function(e){this.m_enableMotor=e},b.prototype.SetMotorSpeed=function(e){void 0===e&&(e=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=e},b.prototype.GetMotorSpeed=function(){return this.m_motorSpeed},b.prototype.SetMaxMotorTorque=function(e){this.m_maxMotorTorque=e=void 0===e?0:e},b.prototype.GetMotorTorque=function(){return this.m_maxMotorTorque},b.prototype.b2RevoluteJoint=function(e){this.__super.b2Joint.call(this,e),this.m_localAnchor1.SetV(e.localAnchorA),this.m_localAnchor2.SetV(e.localAnchorB),this.m_referenceAngle=e.referenceAngle,this.m_impulse.SetZero(),this.m_motorImpulse=0,this.m_lowerAngle=e.lowerAngle,this.m_upperAngle=e.upperAngle,this.m_maxMotorTorque=e.maxMotorTorque,this.m_motorSpeed=e.motorSpeed,this.m_enableLimit=e.enableLimit,this.m_enableMotor=e.enableMotor,this.m_limitState=w.e_inactiveLimit},b.prototype.InitVelocityConstraints=function(e){var t=this.m_bodyA,i=this.m_bodyB;this.m_enableMotor||this.m_enableLimit;var n=t.m_xf.R,o=this.m_localAnchor1.x-t.m_sweep.localCenter.x,s=this.m_localAnchor1.y-t.m_sweep.localCenter.y,r=n.col1.x*o+n.col2.x*s,s=n.col1.y*o+n.col2.y*s,o=r;n=i.m_xf.R;var a=this.m_localAnchor2.x-i.m_sweep.localCenter.x,l=this.m_localAnchor2.y-i.m_sweep.localCenter.y;r=n.col1.x*a+n.col2.x*l;var c,l=n.col1.y*a+n.col2.y*l,a=r,h=t.m_invMass,u=i.m_invMass,n=t.m_invI,r=i.m_invI;this.m_mass.col1.x=h+u+s*s*n+l*l*r,this.m_mass.col2.x=-s*o*n-l*a*r,this.m_mass.col3.x=-s*n-l*r,this.m_mass.col1.y=this.m_mass.col2.x,this.m_mass.col2.y=h+u+o*o*n+a*a*r,this.m_mass.col3.y=o*n+a*r,this.m_mass.col1.z=this.m_mass.col3.x,this.m_mass.col2.z=this.m_mass.col3.y,this.m_mass.col3.z=n+r,this.m_motorMass=1/(n+r),0==this.m_enableMotor&&(this.m_motorImpulse=0),this.m_enableLimit?(c=i.m_sweep.a-t.m_sweep.a-this.m_referenceAngle,C.Abs(this.m_upperAngle-this.m_lowerAngle)<2*x.b2_angularSlop?this.m_limitState=w.e_equalLimits:c<=this.m_lowerAngle?(this.m_limitState!=w.e_atLowerLimit&&(this.m_impulse.z=0),this.m_limitState=w.e_atLowerLimit):c>=this.m_upperAngle?(this.m_limitState!=w.e_atUpperLimit&&(this.m_impulse.z=0),this.m_limitState=w.e_atUpperLimit):(this.m_limitState=w.e_inactiveLimit,this.m_impulse.z=0)):this.m_limitState=w.e_inactiveLimit,e.warmStarting?(this.m_impulse.x*=e.dtRatio,this.m_impulse.y*=e.dtRatio,this.m_motorImpulse*=e.dtRatio,c=this.m_impulse.x,e=this.m_impulse.y,t.m_linearVelocity.x-=h*c,t.m_linearVelocity.y-=h*e,t.m_angularVelocity-=n*(o*e-s*c+this.m_motorImpulse+this.m_impulse.z),i.m_linearVelocity.x+=u*c,i.m_linearVelocity.y+=u*e,i.m_angularVelocity+=r*(a*e-l*c+this.m_motorImpulse+this.m_impulse.z)):(this.m_impulse.SetZero(),this.m_motorImpulse=0)},b.prototype.SolveVelocityConstraints=function(e){var t,i,n,o=this.m_bodyA,s=this.m_bodyB,r=0,a=0,l=0,c=0,h=0,u=o.m_linearVelocity,p=o.m_angularVelocity,d=s.m_linearVelocity,m=s.m_angularVelocity,f=o.m_invMass,g=s.m_invMass,y=o.m_invI,v=s.m_invI;this.m_enableMotor&&this.m_limitState!=w.e_equalLimits&&(t=m-p-this.m_motorSpeed,i=this.m_motorMass*-t,t=this.m_motorImpulse,e=e.dt*this.m_maxMotorTorque,this.m_motorImpulse=C.Clamp(this.m_motorImpulse+i,-e,e),p-=y*(i=this.m_motorImpulse-t),m+=v*i),this.m_enableLimit&&this.m_limitState!=w.e_inactiveLimit?(n=o.m_xf.R,a=this.m_localAnchor1.x-o.m_sweep.localCenter.x,l=this.m_localAnchor1.y-o.m_sweep.localCenter.y,r=n.col1.x*a+n.col2.x*l,l=n.col1.y*a+n.col2.y*l,a=r,n=s.m_xf.R,c=this.m_localAnchor2.x-s.m_sweep.localCenter.x,h=this.m_localAnchor2.y-s.m_sweep.localCenter.y,r=n.col1.x*c+n.col2.x*h,h=n.col1.y*c+n.col2.y*h,c=r,t=d.x+-m*h-u.x- -p*l,i=d.y+m*c-u.y-p*a,this.m_mass.Solve33(this.impulse3,-t,-i,-(m-p)),this.m_limitState==w.e_equalLimits?this.m_impulse.Add(this.impulse3):this.m_limitState==w.e_atLowerLimit?this.m_impulse.z+this.impulse3.z<0&&(this.m_mass.Solve22(this.reduced,-t,-i),this.impulse3.x=this.reduced.x,this.impulse3.y=this.reduced.y,this.impulse3.z=-this.m_impulse.z,this.m_impulse.x+=this.reduced.x,this.m_impulse.y+=this.reduced.y,this.m_impulse.z=0):this.m_limitState==w.e_atUpperLimit&&0<this.m_impulse.z+this.impulse3.z&&(this.m_mass.Solve22(this.reduced,-t,-i),this.impulse3.x=this.reduced.x,this.impulse3.y=this.reduced.y,this.impulse3.z=-this.m_impulse.z,this.m_impulse.x+=this.reduced.x,this.m_impulse.y+=this.reduced.y,this.m_impulse.z=0),u.x-=f*this.impulse3.x,u.y-=f*this.impulse3.y,p-=y*(a*this.impulse3.y-l*this.impulse3.x+this.impulse3.z),d.x+=g*this.impulse3.x,d.y+=g*this.impulse3.y,m+=v*(c*this.impulse3.y-h*this.impulse3.x+this.impulse3.z)):(n=o.m_xf.R,a=this.m_localAnchor1.x-o.m_sweep.localCenter.x,l=this.m_localAnchor1.y-o.m_sweep.localCenter.y,r=n.col1.x*a+n.col2.x*l,l=n.col1.y*a+n.col2.y*l,a=r,n=s.m_xf.R,c=this.m_localAnchor2.x-s.m_sweep.localCenter.x,h=this.m_localAnchor2.y-s.m_sweep.localCenter.y,r=n.col1.x*c+n.col2.x*h,h=n.col1.y*c+n.col2.y*h,c=r,n=d.x+-m*h-u.x- -p*l,r=d.y+m*c-u.y-p*a,this.m_mass.Solve22(this.impulse2,-n,-r),this.m_impulse.x+=this.impulse2.x,this.m_impulse.y+=this.impulse2.y,u.x-=f*this.impulse2.x,u.y-=f*this.impulse2.y,p-=y*(a*this.impulse2.y-l*this.impulse2.x),d.x+=g*this.impulse2.x,d.y+=g*this.impulse2.y,m+=v*(c*this.impulse2.y-h*this.impulse2.x)),o.m_linearVelocity.SetV(u),o.m_angularVelocity=p,s.m_linearVelocity.SetV(d),s.m_angularVelocity=m},b.prototype.SolvePositionConstraints=function(e){void 0===e&&(e=0);var t=0,i=this.m_bodyA,n=this.m_bodyB,o=0,s=0,r=0;this.m_enableLimit&&this.m_limitState!=w.e_inactiveLimit&&(y=n.m_sweep.a-i.m_sweep.a-this.m_referenceAngle,v=0,this.m_limitState==w.e_equalLimits?(t=C.Clamp(y-this.m_lowerAngle,-x.b2_maxAngularCorrection,x.b2_maxAngularCorrection),v=-this.m_motorMass*t,o=C.Abs(t)):this.m_limitState==w.e_atLowerLimit?(o=-(t=y-this.m_lowerAngle),t=C.Clamp(t+x.b2_angularSlop,-x.b2_maxAngularCorrection,0),v=-this.m_motorMass*t):this.m_limitState==w.e_atUpperLimit&&(o=t=y-this.m_upperAngle,t=C.Clamp(t-x.b2_angularSlop,0,x.b2_maxAngularCorrection),v=-this.m_motorMass*t),i.m_sweep.a-=i.m_invI*v,n.m_sweep.a+=n.m_invI*v,i.SynchronizeTransform(),n.SynchronizeTransform());var a=i.m_xf.R,l=this.m_localAnchor1.x-i.m_sweep.localCenter.x,c=this.m_localAnchor1.y-i.m_sweep.localCenter.y,h=a.col1.x*l+a.col2.x*c,c=a.col1.y*l+a.col2.y*c,l=h;a=n.m_xf.R;var u=this.m_localAnchor2.x-n.m_sweep.localCenter.x,p=this.m_localAnchor2.y-n.m_sweep.localCenter.y;h=a.col1.x*u+a.col2.x*p;var p=a.col1.y*u+a.col2.y*p,d=n.m_sweep.c.x+(u=h)-i.m_sweep.c.x-l,m=n.m_sweep.c.y+p-i.m_sweep.c.y-c,f=d*d+m*m,e=Math.sqrt(f),g=e,y=i.m_invMass,t=n.m_invMass,v=i.m_invI,a=n.m_invI,h=10*x.b2_linearSlop;return h*h<f&&(r=(e=1/(y+t))*-m,i.m_sweep.c.x-=.5*y*(s=e*-d),i.m_sweep.c.y-=.5*y*r,n.m_sweep.c.x+=.5*t*s,n.m_sweep.c.y+=.5*t*r,d=n.m_sweep.c.x+u-i.m_sweep.c.x-l,m=n.m_sweep.c.y+p-i.m_sweep.c.y-c),this.K1.col1.x=y+t,this.K1.col2.x=0,this.K1.col1.y=0,this.K1.col2.y=y+t,this.K2.col1.x=v*c*c,this.K2.col2.x=-v*l*c,this.K2.col1.y=-v*l*c,this.K2.col2.y=v*l*l,this.K3.col1.x=a*p*p,this.K3.col2.x=-a*u*p,this.K3.col1.y=-a*u*p,this.K3.col2.y=a*u*u,this.K.SetM(this.K1),this.K.AddM(this.K2),this.K.AddM(this.K3),this.K.Solve(b.tImpulse,-d,-m),s=b.tImpulse.x,r=b.tImpulse.y,i.m_sweep.c.x-=i.m_invMass*s,i.m_sweep.c.y-=i.m_invMass*r,i.m_sweep.a-=i.m_invI*(l*r-c*s),n.m_sweep.c.x+=n.m_invMass*s,n.m_sweep.c.y+=n.m_invMass*r,n.m_sweep.a+=n.m_invI*(u*r-p*s),i.SynchronizeTransform(),n.SynchronizeTransform(),g<=x.b2_linearSlop&&o<=x.b2_angularSlop},B.postDefs.push(function(){B.Dynamics.Joints.b2RevoluteJoint.tImpulse=new T}),B.inherit(v,B.Dynamics.Joints.b2JointDef),v.prototype.__super=B.Dynamics.Joints.b2JointDef.prototype,v.b2RevoluteJointDef=function(){B.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.localAnchorA=new T,this.localAnchorB=new T},v.prototype.b2RevoluteJointDef=function(){this.__super.b2JointDef.call(this),this.type=w.e_revoluteJoint,this.localAnchorA.Set(0,0),this.localAnchorB.Set(0,0),this.referenceAngle=0,this.lowerAngle=0,this.upperAngle=0,this.maxMotorTorque=0,this.motorSpeed=0,this.enableLimit=!1,this.enableMotor=!1},v.prototype.Initialize=function(e,t,i){this.bodyA=e,this.bodyB=t,this.localAnchorA=this.bodyA.GetLocalPoint(i),this.localAnchorB=this.bodyB.GetLocalPoint(i),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()},B.inherit(_,B.Dynamics.Joints.b2Joint),_.prototype.__super=B.Dynamics.Joints.b2Joint.prototype,_.b2WeldJoint=function(){B.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_localAnchorA=new T,this.m_localAnchorB=new T,this.m_impulse=new L,this.m_mass=new t},_.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)},_.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)},_.prototype.GetReactionForce=function(e){return new T((e=void 0===e?0:e)*this.m_impulse.x,e*this.m_impulse.y)},_.prototype.GetReactionTorque=function(e){return(e=void 0===e?0:e)*this.m_impulse.z},_.prototype.b2WeldJoint=function(e){this.__super.b2Joint.call(this,e),this.m_localAnchorA.SetV(e.localAnchorA),this.m_localAnchorB.SetV(e.localAnchorB),this.m_referenceAngle=e.referenceAngle,this.m_impulse.SetZero(),this.m_mass=new t},_.prototype.InitVelocityConstraints=function(e){var t=this.m_bodyA,i=this.m_bodyB,n=t.m_xf.R,o=this.m_localAnchorA.x-t.m_sweep.localCenter.x,s=this.m_localAnchorA.y-t.m_sweep.localCenter.y,r=n.col1.x*o+n.col2.x*s,s=n.col1.y*o+n.col2.y*s,o=r;n=i.m_xf.R;var a=this.m_localAnchorB.x-i.m_sweep.localCenter.x,l=this.m_localAnchorB.y-i.m_sweep.localCenter.y;r=n.col1.x*a+n.col2.x*l;var l=n.col1.y*a+n.col2.y*l,a=r,c=t.m_invMass,h=i.m_invMass,n=t.m_invI,r=i.m_invI;this.m_mass.col1.x=c+h+s*s*n+l*l*r,this.m_mass.col2.x=-s*o*n-l*a*r,this.m_mass.col3.x=-s*n-l*r,this.m_mass.col1.y=this.m_mass.col2.x,this.m_mass.col2.y=c+h+o*o*n+a*a*r,this.m_mass.col3.y=o*n+a*r,this.m_mass.col1.z=this.m_mass.col3.x,this.m_mass.col2.z=this.m_mass.col3.y,this.m_mass.col3.z=n+r,e.warmStarting?(this.m_impulse.x*=e.dtRatio,this.m_impulse.y*=e.dtRatio,this.m_impulse.z*=e.dtRatio,t.m_linearVelocity.x-=c*this.m_impulse.x,t.m_linearVelocity.y-=c*this.m_impulse.y,t.m_angularVelocity-=n*(o*this.m_impulse.y-s*this.m_impulse.x+this.m_impulse.z),i.m_linearVelocity.x+=h*this.m_impulse.x,i.m_linearVelocity.y+=h*this.m_impulse.y,i.m_angularVelocity+=r*(a*this.m_impulse.y-l*this.m_impulse.x+this.m_impulse.z)):this.m_impulse.SetZero()},_.prototype.SolveVelocityConstraints=function(e){var t=this.m_bodyA,i=this.m_bodyB,n=t.m_linearVelocity,o=t.m_angularVelocity,s=i.m_linearVelocity,r=i.m_angularVelocity,a=t.m_invMass,l=i.m_invMass,c=t.m_invI,h=i.m_invI,u=t.m_xf.R,p=this.m_localAnchorA.x-t.m_sweep.localCenter.x,d=this.m_localAnchorA.y-t.m_sweep.localCenter.y,m=u.col1.x*p+u.col2.x*d,d=u.col1.y*p+u.col2.y*d,p=m;u=i.m_xf.R;var f=this.m_localAnchorB.x-i.m_sweep.localCenter.x,g=this.m_localAnchorB.y-i.m_sweep.localCenter.y;m=u.col1.x*f+u.col2.x*g;var g=u.col1.y*f+u.col2.y*g,y=s.x-r*g-n.x+o*d,v=s.y+r*(f=m)-n.y-o*p,u=r-o,m=new L;this.m_mass.Solve33(m,-y,-v,-u),this.m_impulse.Add(m),n.x-=a*m.x,n.y-=a*m.y,o-=c*(p*m.y-d*m.x+m.z),s.x+=l*m.x,s.y+=l*m.y,r+=h*(f*m.y-g*m.x+m.z),t.m_angularVelocity=o,i.m_angularVelocity=r},_.prototype.SolvePositionConstraints=function(e){void 0===e&&(e=0);var t=this.m_bodyA,i=this.m_bodyB,n=t.m_xf.R,o=this.m_localAnchorA.x-t.m_sweep.localCenter.x,s=this.m_localAnchorA.y-t.m_sweep.localCenter.y,r=n.col1.x*o+n.col2.x*s,s=n.col1.y*o+n.col2.y*s,o=r;n=i.m_xf.R;var a=this.m_localAnchorB.x-i.m_sweep.localCenter.x,l=this.m_localAnchorB.y-i.m_sweep.localCenter.y;r=n.col1.x*a+n.col2.x*l;var l=n.col1.y*a+n.col2.y*l,c=t.m_invMass,h=i.m_invMass,u=t.m_invI,p=i.m_invI,d=i.m_sweep.c.x+(a=r)-t.m_sweep.c.x-o,m=i.m_sweep.c.y+l-t.m_sweep.c.y-s,f=i.m_sweep.a-t.m_sweep.a-this.m_referenceAngle,e=10*x.b2_linearSlop,n=Math.sqrt(d*d+m*m),r=C.Abs(f);e<n&&(u*=1,p*=1),this.m_mass.col1.x=c+h+s*s*u+l*l*p,this.m_mass.col2.x=-s*o*u-l*a*p,this.m_mass.col3.x=-s*u-l*p,this.m_mass.col1.y=this.m_mass.col2.x,this.m_mass.col2.y=c+h+o*o*u+a*a*p,this.m_mass.col3.y=o*u+a*p,this.m_mass.col1.z=this.m_mass.col3.x,this.m_mass.col2.z=this.m_mass.col3.y,this.m_mass.col3.z=u+p;e=new L;return this.m_mass.Solve33(e,-d,-m,-f),t.m_sweep.c.x-=c*e.x,t.m_sweep.c.y-=c*e.y,t.m_sweep.a-=u*(o*e.y-s*e.x+e.z),i.m_sweep.c.x+=h*e.x,i.m_sweep.c.y+=h*e.y,i.m_sweep.a+=p*(a*e.y-l*e.x+e.z),t.SynchronizeTransform(),i.SynchronizeTransform(),n<=x.b2_linearSlop&&r<=x.b2_angularSlop},B.inherit(k,B.Dynamics.Joints.b2JointDef),k.prototype.__super=B.Dynamics.Joints.b2JointDef.prototype,k.b2WeldJointDef=function(){B.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.localAnchorA=new T,this.localAnchorB=new T},k.prototype.b2WeldJointDef=function(){this.__super.b2JointDef.call(this),this.type=w.e_weldJoint,this.referenceAngle=0},k.prototype.Initialize=function(e,t,i){this.bodyA=e,this.bodyB=t,this.localAnchorA.SetV(this.bodyA.GetLocalPoint(i)),this.localAnchorB.SetV(this.bodyB.GetLocalPoint(i)),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()}}(),(G=B.Dynamics.b2DebugDraw).b2DebugDraw=function(){this.m_drawScale=1,this.m_lineThickness=1,this.m_alpha=1,this.m_fillAlpha=1,this.m_xformScale=1;var e=this;this.m_sprite={graphics:{clear:function(){e.m_ctx.clearRect(0,0,e.m_ctx.canvas.width,e.m_ctx.canvas.height)}}}},G.prototype._color=function(e,t){return"rgba("+((16711680&e)>>16)+","+((65280&e)>>8)+","+(255&e)+","+t+")"},G.prototype.b2DebugDraw=function(){this.m_drawFlags=0},G.prototype.SetFlags=function(e){this.m_drawFlags=e=void 0===e?0:e},G.prototype.GetFlags=function(){return this.m_drawFlags},G.prototype.AppendFlags=function(e){this.m_drawFlags|=e=void 0===e?0:e},G.prototype.ClearFlags=function(e){this.m_drawFlags&=~(e=void 0===e?0:e)},G.prototype.SetSprite=function(e){this.m_ctx=e},G.prototype.GetSprite=function(){return this.m_ctx},G.prototype.SetDrawScale=function(e){this.m_drawScale=e=void 0===e?0:e},G.prototype.GetDrawScale=function(){return this.m_drawScale},G.prototype.SetLineThickness=function(e){this.m_lineThickness=e=void 0===e?0:e,this.m_ctx.strokeWidth=e},G.prototype.GetLineThickness=function(){return this.m_lineThickness},G.prototype.SetAlpha=function(e){this.m_alpha=e=void 0===e?0:e},G.prototype.GetAlpha=function(){return this.m_alpha},G.prototype.SetFillAlpha=function(e){this.m_fillAlpha=e=void 0===e?0:e},G.prototype.GetFillAlpha=function(){return this.m_fillAlpha},G.prototype.SetXFormScale=function(e){this.m_xformScale=e=void 0===e?0:e},G.prototype.GetXFormScale=function(){return this.m_xformScale},G.prototype.DrawPolygon=function(e,t,i){if(t){var n=this.m_ctx,o=this.m_drawScale;n.beginPath(),n.strokeStyle=this._color(i.color,this.m_alpha),n.moveTo(e[0].x*o,e[0].y*o);for(var s=1;s<t;s++)n.lineTo(e[s].x*o,e[s].y*o);n.lineTo(e[0].x*o,e[0].y*o),n.closePath(),n.stroke()}},G.prototype.DrawSolidPolygon=function(e,t,i){if(t){var n=this.m_ctx,o=this.m_drawScale;n.beginPath(),n.strokeStyle=this._color(i.color,this.m_alpha),n.fillStyle=this._color(i.color,this.m_fillAlpha),n.moveTo(e[0].x*o,e[0].y*o);for(var s=1;s<t;s++)n.lineTo(e[s].x*o,e[s].y*o);n.lineTo(e[0].x*o,e[0].y*o),n.closePath(),n.fill(),n.stroke()}},G.prototype.DrawCircle=function(e,t,i){var n,o;t&&(n=this.m_ctx,o=this.m_drawScale,n.beginPath(),n.strokeStyle=this._color(i.color,this.m_alpha),n.arc(e.x*o,e.y*o,t*o,0,2*Math.PI,!0),n.closePath(),n.stroke())},G.prototype.DrawSolidCircle=function(e,t,i,n){var o,s,r,a;t&&(o=this.m_ctx,s=this.m_drawScale,r=e.x*s,a=e.y*s,o.moveTo(0,0),o.beginPath(),o.strokeStyle=this._color(n.color,this.m_alpha),o.fillStyle=this._color(n.color,this.m_fillAlpha),o.arc(r,a,t*s,0,2*Math.PI,!0),o.moveTo(r,a),o.lineTo((e.x+i.x*t)*s,(e.y+i.y*t)*s),o.closePath(),o.fill(),o.stroke())},G.prototype.DrawSegment=function(e,t,i){var n=this.m_ctx,o=this.m_drawScale;n.strokeStyle=this._color(i.color,this.m_alpha),n.beginPath(),n.moveTo(e.x*o,e.y*o),n.lineTo(t.x*o,t.y*o),n.closePath(),n.stroke()},G.prototype.DrawTransform=function(e){var t=this.m_ctx,i=this.m_drawScale;t.beginPath(),t.strokeStyle=this._color(16711680,this.m_alpha),t.moveTo(e.position.x*i,e.position.y*i),t.lineTo((e.position.x+this.m_xformScale*e.R.col1.x)*i,(e.position.y+this.m_xformScale*e.R.col1.y)*i),t.strokeStyle=this._color(65280,this.m_alpha),t.moveTo(e.position.x*i,e.position.y*i),t.lineTo((e.position.x+this.m_xformScale*e.R.col2.x)*i,(e.position.y+this.m_xformScale*e.R.col2.y)*i),t.closePath(),t.stroke()},z=0;z<B.postDefs.length;++z)B.postDefs[z]();delete B.postDefs,e.exports=B},81:function(e,t,i){var s,d,r,a,m,f,n,l=i(47),g=i(94),c=i(119),h=i(82),u=i(169);e.exports.typedArraySupport=i="undefined"!=typeof Float32Array&&null!==Float32Array,null==s&&(s=i?((i=new Uint8Array(0)).__proto__?i.__proto__.__proto__:Object.getPrototypeOf(Object.getPrototypeOf(i))).constructor:null),e.exports.clone=r=function(e,t){var i,n,o;if(null==t&&(t=!1),null==e||"object"!=typeof e)return e;if(e instanceof Date)return new Date(e.getTime());if(e instanceof RegExp)return i="",null!=e.global&&(i+="g"),null!=e.ignoreCase&&(i+="i"),null!=e.multiline&&(i+="m"),null!=e.sticky&&(i+="y"),new RegExp(e.source,i);if(e instanceof l||e instanceof g||e instanceof c||e instanceof h)return e.copy();if(t&&e.isThang)return e;if(_.isArray(e))return e.slice();if(s&&e instanceof s)return new e.constructor(e);for(n in o=new e.constructor,e)o[n]=r(e[n],t);return o},e.exports.downTheChain=function(e,t,i){var n;if(null==i&&(i=void 0),!e)return null;if(!_.isArray(t))return e[t];for(n=e;t.length&&n;){if(void 0!==i&&1===t.length)return n[t[0]]=i;n=n[t[0]],t=t.slice(1)}return n},e.exports.now=null!=("undefined"!=typeof window&&null!==window&&null!=(n=window.performance)?n.now:void 0)?function(){return window.performance.now()}:function(){return new Date},e.exports.consolidateThangs=function(e){var i,t,n,o,s,r=_.remove(e,function(e){var t;return e.stateless&&e.collides&&"obstacles"===e.collisionCategory&&("box"===(t=e.shape)||"sheet"===t)&&"Ice Wall"!==e.spriteName&&1===e.restitution&&/Wall/.test(e.spriteName)&&0<=e.pos.x-e.width/2&&0<=e.pos.y-e.height/2});if(r.length)return s=_.max(r,function(e){return e.pos.x+e.width/2}),o=_.max(r,function(e){return e.pos.y+e.height/2}),n=_.min(r,function(e){return e.pos.x-e.width/2}),t=_.min(r,function(e){return e.pos.y-e.height/2}),n=Math.min(0,n.pos.x-n.width/2),t=Math.min(0,t.pos.y-t.height/2),(n<0||t<0)&&console.error("Negative structural Thangs aren't supported, sorry!"),s=+(s.pos.x+s.width/2),n=o.pos.y+o.height/2-(t=0),t=new u(r,s,n,0,0,t),a(t,function(e){var t=r[i.length];return t||console.error("Hmm, our dissection has more Thangs than the original structural Thangs?",i.length),t.pos.x=e.x,t.pos.y=e.y,t.width=e.width,t.height=e.height,t.destroyBody(),t.createBodyDef(),t.createBody(),i.push(t)},!(i=[]),!1),console.log("Turned",r.length,"structural Thangs into",i.length,"dissecting Thangs."),e.push.apply(e,i),r.slice(i.length,r.length)},e.exports.dissectRectangles=a=function(t,i,n,o){var e,s,r,a,l,c,h,u,p;for(o&&console.log(t.toString()),l=[],e=0,s=(a=t.rows(t.left,t.left+t.width)).length;e<s;e++)c=a[e],u=t.clampColumn(t.bottom),l.push(function(){for(var e=[];u<t.clampColumn(t.bottom+t.height);){for(p=u;!m(c,p,t,n);)++p;if(u<p){for(h=c+1;!f(h,u,p,t,n);)++h;r=d(t,c,u,h-c,p-u,n),i(r),o&&console.log(t.toString()),u=p}e.push(++u)}return e}());return l},m=function(e,t,i,n){var o;return t>i.bottom+i.height||e>i.left+i.width||(null!=(o=i.grid[t])&&o[e]||console.error("trying to check invalid coordinates",e,t,"from grid",i.bottom,i.left,i.width,i.height),Boolean(i.grid[t][e].length)===n)},f=function(e,t,i,n,o){for(var s,r,a=s=r=t,l=i;r<=l?s<l:l<s;a=r<=l?++s:--s)if(m(e,a,n,o))return!0;return!1},d=function(e,t,i,n,o,s){for(var r,a,l,c,h,u,p=r=l=t,d=t+n;l<=d?r<d:d<r;p=l<=d?++r:--r)for(h=(u=a=c=i)+o;c<=h?a<h:h<a;u=c<=h?++a:--a)e.grid[u][p]=s?[!0]:[];return new g(t+n/2,i+o/2,n,o)}},82:function(e,t){function n(e,t){this.a=e,this.b=t,this.slope=(this.a.y-this.b.y)/(this.a.x-this.b.x),this.y0=this.a.y-this.slope*this.a.x,this.left=this.a.x<this.b.x?this.a:this.b,this.right=this.a.x>this.b.x?this.a:this.b,this.bottom=this.a.y<this.b.y?this.a:this.b,this.top=this.a.y>this.b.y?this.a:this.b}n.className="LineSegment",n.prototype.y=function(e){return this.slope*e+this.y0},n.prototype.x=function(e){return(e-this.y0)/this.slope},n.prototype.intersectsLineSegment=function(e){var t,i,n,o,s,r;if(e.slope===this.slope){if(e.y0===this.y0){if(e.left.x===this.left.x||e.left.x===this.right.x||e.right.x===this.right.x||e.right.x===this.left.x)return Math.abs(this.slope)!==1/0||(this.bottom.y<=(r=e.top.y)&&r<=this.top.y||e.bottom.y<=(o=this.top.y)&&o<=e.top.y);if((t=(i=e.left.x<this.left.x?[e,this]:[this,e])[0]).right.x>(n=i[1]).left.x)return!0}}else if(Math.abs(this.slope)!==1/0&&Math.abs(e.slope)!==1/0){if((s=(e.y0-this.y0)/(this.slope-e.slope))>=this.left.x&&s<=this.right.x&&s>=e.left.x&&s<=e.right.x)return!0}else if((Math.abs(this.slope)!==1/0||Math.abs(e.slope)!==1/0)&&(s=(o=(r=Math.abs(this.slope)!==1/0?[e,this]:[this,e])[0]).a.x,i=o.bottom.y,e=o.top.y,r=(o=r[1]).y(s),t=o.left.x,n=o.right.x,i<=r&&r<=e&&t<=s&&s<=n))return!0;return!1},n.prototype.pointOnLine=function(e,t){if(null==t&&(t=!0),e.y===this.y(e.x)){if(!t)return!0;if((t=this.a.y<this.b.y?[this.a.y,this.b.y]:[this.b.y,this.a.y])[0]<=e.y&&t[1]>=e.y)return!0}return!1},n.prototype.distanceSquaredToPoint=function(e){var t;return this.a.equals(this.b)?this.a.distanceSquared(e):(Math.min(e.distanceSquared(this.a),e.distanceSquared(this.b)),t=this.a.distanceSquared(this.b),(t=((e.x-this.a.x)*(this.b.x-this.a.x)+(e.y-this.a.y)*(this.b.y-this.a.y))/t)<0?this.a.distanceSquared(e):1<t?this.b.distanceSquared(e):e.distanceSquared({x:this.a.x+t*(this.b.x-this.a.x),y:this.a.y+t*(this.b.y-this.a.y)}))},n.prototype.distanceToPoint=function(e){return Math.sqrt(this.distanceSquaredToPoint(e))},n.prototype.toString=function(){return"lineSegment(a="+this.a+", b="+this.b+", slope="+this.slope+", y0="+this.y0+", left="+this.left+", right="+this.right+", bottom="+this.bottom+", top="+this.top+")"},n.prototype.serialize=function(){return{CN:this.constructor.className,a:this.a,b:this.b}},n.deserialize=function(e,t,i){return new n(e.a,e.b)},n.prototype.serializeForAether=function(){return this.serialize()},n.deserializeFromAether=function(e){return this.deserialize(e)},e.exports=n},94:function(e,t,i){var o=i(47),s=i(82),i=function(){var e,t,i,n;for(l.className="Rectangle",e=function(i){return l[i]=function(e,t){return e.copy()[i](t)}},t=0,i=(n=["add","subtract","multiply","divide"]).length;t<i;t++)e(n[t]);function l(e,t,i,n,o){this.x=null!=e?e:0,this.y=null!=t?t:0,this.width=null!=i?i:0,this.height=null!=n?n:0,this.rotation=null!=o?o:0}return l.prototype.isRectangle=!0,l.prototype.apiProperties=["x","y","width","height","rotation","getPos","vertices","touchesRect","touchesPoint","distanceToPoint","distanceSquaredToPoint","distanceToRectangle","distanceSquaredToRectangle","distanceToEllipse","distanceSquaredToEllipse","distanceToShape","distanceSquaredToShape","containsPoint","copy","intersectsLineSegment","intersectsEllipse","intersectsRectangle","intersectsShape"],l.prototype.copy=function(){return new l(this.x,this.y,this.width,this.height,this.rotation)},l.prototype.getPos=function(){return new o(this.x,this.y)},l.prototype.vertices=function(){var e=[this.width/2,this.height/2,Math.cos(this.rotation),Math.sin(-this.rotation)],t=e[0],i=e[1],n=e[2],e=e[3];return[new o(this.x-(t*n-i*e),this.y-(t*e+i*n)),new o(this.x-(t*n+i*e),this.y-(t*e-i*n)),new o(this.x+(t*n-i*e),this.y+(t*e+i*n)),new o(this.x+(t*n+i*e),this.y+(t*e-i*n))]},l.prototype.lineSegments=function(){var e=this.vertices();return[new s(e[0],e[1]),new s(e[1],e[2]),new s(e[2],e[3]),new s(e[3],e[0])]},l.prototype.touchesRect=function(e){var t=this.vertices(),i=t[0],n=t[1],o=t[2],s=(t[3],e.vertices()),r=s[0],t=s[1],e=s[2];s[3];return!(n.x>e.x||t.x>o.x)&&(!(i.y>t.y||r.y>n.y)&&(n.x===e.x||t.x===o.x||(n.y===r.y||t.y===i.y)))},l.prototype.touchesPoint=function(e){var t=this.vertices(),i=t[0],n=t[1],t=(t[2],t[3]);return e.y>=i.y&&e.y<=n.y&&(e.x>=i.x&&e.x<=t.x&&(e.x===i.x||e.x===t.x||(e.y===i.y||e.y===n.y)))},l.prototype.axisAlignedBoundingBox=function(e){var t,i,n,o,s,r,a;return null==e&&(e=!0),n=Math.cos(this.rotation),s=Math.sin(this.rotation),o=this.rotation%(2*Math.PI),t=this.x-(this.width/2*n-this.height/2*s),i=this.y-(this.width/2*s+this.height/2*n),r=a=0,a=o>Math.PI?o<3*Math.PI/2?(r=t+this.width*n,i+this.height*n+this.width*s):(r=t,i+this.width*s):o>Math.PI/2?(r=t+this.width*n-this.height*s,i+this.height*n):(r=t-this.height*s,i),e&&(r=Math.round(r),a=Math.round(a)),new l(this.x,this.y,2*(this.x-r),2*(this.y-a),0)},l.prototype.distanceToPoint=function(e){var t=Math.cos(this.rotation),i=Math.sin(this.rotation),n=(e.x-this.x)*t-(e.y-this.y)*i,t=(e.x-this.x)*i+(e.y-this.y)*t,n=Math.max(Math.abs(n)-this.width/2,0),t=Math.max(Math.abs(t)-this.height/2,0);return Math.sqrt(n*n+t*t)},l.prototype.distanceSquaredToPoint=function(e){var t=Math.max(Math.abs(e.x-this.x)-this.width/2,0),e=Math.max(Math.abs(e.y-this.y)-this.height/2,0);return t*t+e*e},l.prototype.distanceToRectangle=function(e){return Math.sqrt(this.distanceSquaredToRectangle(e))},l.prototype.distanceSquaredToRectangle=function(e){var t,i,n,o,s,r,a,l,c,h,u,p,d,m,f,g;if(this.intersectsRectangle(e))return 0;for(a=function(e,t,i){var n,o=((i.x-e.x)*(t.x-e.x)+(i.y-e.y)*(t.y-e.y))/e.distanceSquared(t);return o<=0?i.distanceSquared(e):1<=o?i.distanceSquared(t):(n=i.x-(e.x+o*(t.x-e.x)))*n+(e=i.y-(e.y+o*(t.y-e.y)))*e},f=this.vertices(),g=e.vertices(),s=Math.pow(f[0].x-e.x,2)+Math.pow(f[0].y-e.y,2),r=Math.pow(f[1].x-e.x,2)+Math.pow(f[1].y-e.y,2),e=Math.pow(f[2].x-e.x,2)+Math.pow(f[2].y-e.y,2),c=s<r?r<e?2:1:r<e?3:0,s=Math.pow(g[0].x-this.x,2)+Math.pow(g[0].y-this.y,2),r=Math.pow(g[1].x-this.x,2)+Math.pow(g[1].y-this.y,2),e=Math.pow(g[2].x-this.x,2)+Math.pow(g[2].y-this.y,2),h=s<r?r<e?2:1:r<e?3:0,m=1/0,l=p=1;p<=2;l=++p)for(t=f[(c+l)%4],i=f[(c+l+1)%4],n=g[(h+l)%4],o=g[(h+l+1)%4],u=d=1;d<=3;u=++d)m=Math.min(m,a(t,i,g[(h+u)%4]),a(n,o,f[(c+u)%4]));return m},l.prototype.distanceToEllipse=function(e){return Math.sqrt(this.distanceSquaredToEllipse(e))},l.prototype.distanceSquaredToEllipse=function(e){return this.distanceSquaredToRectangle(e.rectangle())},l.prototype.distanceToShape=function(e){return Math.sqrt(this.distanceSquaredToShape(e))},l.prototype.distanceSquaredToShape=function(e){return e.isEllipse?this.distanceSquaredToEllipse(e):this.distanceSquaredToRectangle(e)},l.prototype.containsPoint=function(e,t){var i;return(t=null==t?!0:t)&&this.rotation?!this.distanceToPoint(e):this.x-this.width/2<(t=e.x)&&t<this.x+this.width/2&&this.y-this.height/2<(i=e.y)&&i<this.y+this.height/2},l.prototype.intersectsLineSegment=function(e,t){var i=(e.x+t.x)/2-this.x,n=(e.y+t.y)/2-this.y,o=Math.cos(this.rotation),s=Math.sin(this.rotation),r=-o,a=s,l=s,c=o,h=t.x-e.x,u=t.y-e.y,p=h*h+u*u,s=u/p,o=h/p,t=-s,e=o,u=o,h=s,o=this.width/2,s=this.height/2,p=p/2;return!(Math.abs(i*r+n*a)>o+Math.abs(u*p*r+h*p*a)||Math.abs(i*l+n*c)>s+Math.abs(u*p*l+h*p*c)||Math.abs(i*t+n*e)>Math.abs(r*o*t+a*o*e)+Math.abs(l*s*t+c*s*e)||Math.abs(i*u+n*h)>Math.abs(r*o*u+a*o*h)+Math.abs(l*s*u+c*s*h)+p)},l.prototype.intersectsRectangle=function(e){var t=e.x-this.x,i=e.y-this.y,n=Math.cos(this.rotation),o=Math.sin(this.rotation),s=-n,r=o,a=o,l=n,c=Math.cos(e.rotation),h=Math.sin(e.rotation),u=-c,p=h,d=h,o=c,n=this.width/2,h=this.height/2,c=e.width/2,e=e.height/2;return!(Math.abs(t*s+i*r)>n+Math.abs(u*c*s+p*c*r)+Math.abs(d*e*s+o*e*r)||Math.abs(t*a+i*l)>h+Math.abs(u*c*a+p*c*l)+Math.abs(d*e*a+o*e*l)||Math.abs(t*u+i*p)>Math.abs(s*n*u+r*n*p)+Math.abs(a*h*u+l*h*p)+c||Math.abs(t*d+i*o)>Math.abs(s*n*d+r*n*o)+Math.abs(a*h*d+l*h*o)+e)},l.prototype.intersectsEllipse=function(e){var t,i,n,o;if(this.containsPoint(e.getPos()))return!0;for(t=0,i=(o=this.lineSegments()).length;t<i;t++)if(n=o[t],e.intersectsLineSegment(n.a,n.b))return!0;return!1},l.prototype.intersectsShape=function(e){return e.isEllipse?this.intersectsEllipse(e):this.intersectsRectangle(e)},l.prototype.subtract=function(e){return this.x-=e.x,this.y-=e.y,this.pos.subtract(e),this},l.prototype.add=function(e){return this.x+=e.x,this.y+=e.y,this.pos.add(e),this},l.prototype.divide=function(e){e=[this.width/e,this.height/e];return this.width=e[0],this.height=e[1],this},l.prototype.multiply=function(e){e=[this.width*e,this.height*e];return this.width=e[0],this.height=e[1],this},l.prototype.isEmpty=function(){return 0===this.width&&0===this.height},l.prototype.invalid=function(){return this.x===1/0||isNaN(this.x)||this.y===1/0||isNaN(this.y)||this.width===1/0||isNaN(this.width)||this.height===1/0||isNaN(this.height)||this.rotation===1/0||isNaN(this.rotation)},l.prototype.toString=function(){return"{x: "+this.x.toFixed(0)+", y: "+this.y.toFixed(0)+", w: "+this.width.toFixed(0)+", h: "+this.height.toFixed(0)+", rot: "+this.rotation.toFixed(3)+"}"},l.prototype.serialize=function(){return{CN:this.constructor.className,x:this.x,y:this.y,w:this.width,h:this.height,r:this.rotation}},l.deserialize=function(e,t,i){return new l(e.x,e.y,e.w,e.h,e.r)},l.prototype.serializeForAether=function(){return this.serialize()},l.deserializeFromAether=function(e){return this.deserialize(e)},l.fromVertices=function(e){var t=e[0],i=e[1],n=e[2],e=e[3],e=new o((t.x+e.x)/2,(t.y+e.y)/2),n=new o((i.x+n.x)/2,(i.y+n.y)/2);return new l((e.x+n.x)/2,(e.y+n.y)/2,2*e.distance(t),e.distance(n),Math.atan2(n.x-e.x,n.y-e.y))},l.equals=function(e,t){return e.x===t.x&&e.y===t.y&&e.width===t.width&&e.height===t.height&&e.rotation===t.rotation},l.equalsByVertices=function(e,t){var e=e.vertices(),i=t.vertices();return e.every(function(e,t){return e.x===i[t].x&&e.y===i[t].y})},l.approxEquals=function(e,t,i){return null==i&&(i=1e-13),Math.abs(e.x-t.x)<i&&Math.abs(e.y-t.y)<i&&Math.abs(e.width-t.width)<i&&Math.abs(e.height-t.height)<i&&Math.abs(e.rotation-t.rotation)<i},l.approxEqualsByVertices=function(e,t,i){var n;return null==i&&(i=1e-13),e=e.vertices(),n=t.vertices(),e.every(function(e,t){return Math.abs(e.x-n[t].x)<i&&Math.abs(e.y-n[t].y)<i})},l}();e.exports=i},95:function(e,t,i){var s,o,n,a,r;function l(e){var t,i,n,o,s,r;if(this.props=[],e)for(n=t=0,i=(o=(this.thang=e).trackedPropertiesKeys).length;t<i;n=++t)r=o[n],s=e.trackedPropertiesTypes[n],r=e[r],"Vector"===s?this.props.push(null!=r?r.copy():void 0):"object"===s||"array"===s?this.props.push(a(r,!0)):this.props.push(r)}r=i(81),a=r.clone,r=r.typedArraySupport,o=i(47),n=r?null!=(i=(s=Float32Array).BYTES_PER_ELEMENT)?i:s.prototype.BYTES_PER_ELEMENT:4,e.exports=(l.className="ThangState",l.trackedPropertyTypes=["boolean","number","string","array","object","Vector","Thang"],l.prototype.hasRestored=!1,l.prototype.getStoredProp=function(e,t,i){var n;return t||(t=this.trackedPropertyTypes[e],i=this.trackedPropertyValues[e]),"Vector"===t?new o(i[3*this.frameIndex],i[3*this.frameIndex+1],i[3*this.frameIndex+2]):"string"===t?(n=i[this.frameIndex],this.specialKeysToValues[n]):"Thang"===t?(n=i[this.frameIndex],this.thang.world.getThangByID(this.specialKeysToValues[n])):"array"===t?(n=i[this.frameIndex],(n=this.specialKeysToValues[n])&&1<n.length?n.substring(1,n.length-1).split(""):[]):i[this.frameIndex]},l.prototype.getStateForProp=function(e){var t,i;return this.thang.world.synchronous?this.thang[e]:-1===(t=this.trackedPropertyKeys.indexOf(e))?-1===(i=this.thang.unusedTrackedPropertyKeys.indexOf(e))?null:this.thang.unusedTrackedPropertyValues[i]:void 0!==(i=this.props[t])||this.hasRestored?i:this.props[t]=this.getStoredProp(t)},l.prototype.restore=function(){var e,t,i,n,o,s,r,a,l,c,h,u,p,d,m,f,g;if(this.thang._state===this&&!this.thang.partialState)return this;if(this.hasRestored){for(c=i=0,s=(d=this.thang.unusedTrackedPropertyKeys).length;i<s;c=++i)l=d[c],-1===this.trackedPropertyKeys.indexOf(l)&&(this.thang[l]=this.thang.unusedTrackedPropertyValues[c]);for(c=a=0,r=(m=this.trackedPropertyKeys).length;a<r;c=++a)l=m[c],this.thang[l]=this.props[c]}else{if(this.thang.world.synchronous)return this;for(c=e=0,n=(u=this.thang.unusedTrackedPropertyKeys).length;e<n;c=++e)l=u[c],-1===this.trackedPropertyKeys.indexOf(l)&&(this.thang[l]=this.thang.unusedTrackedPropertyValues[c]);for(h=[],c=t=0,o=(p=this.trackedPropertyKeys).length;t<o;c=++t)l=p[c],g=this.trackedPropertyTypes[c],f=this.trackedPropertyValues[c],h.push(this.thang[l]=this.getStoredProp(c,g,f));this.props=h,this.trackedPropertyTypes=this.trackedPropertyValues=this.specialKeysToValues=null,this.hasRestored=!0}return this.thang.partialState=!1,this.thang.stateChanged=!0,this},l.prototype.restorePartial=function(e){for(var t,i,n,o,s=1-e,r=this.trackedPropertyKeys,a=t=0,l=r.length;t<l;a=++t)"pos"!==(i=r[a])&&"rotation"!==i||(o=this.hasRestored?this.props[a]:(n=this.trackedPropertyTypes[a],o=this.trackedPropertyValues[a],this.getStoredProp(a,n,o)),"pos"===i?this.thang.teleport&&900<this.thang.pos.distanceSquared(o)||0===this.thang.pos.x&&0===this.thang.pos.y?this.thang.pos=o:(this.thang.pos=this.thang.pos.copy(),this.thang.pos.x=s*this.thang.pos.x+e*o.x,this.thang.pos.y=s*this.thang.pos.y+e*o.y,this.thang.pos.z=s*this.thang.pos.z+e*o.z):"rotation"===i&&(this.thang.rotation=s*this.thang.rotation+e*o),this.thang.partialState=!0);return this.thang.stateChanged=!0,this},l.prototype.serialize=function(e,t,i,n,o,s){for(var r,a,l,c,h,u,p,d,m,f,g=a=0,y=i.length;a<y;g=++a)if(m=i[g],h=t[g],p=n[g],f=this.props[h])if("Vector"===m)p[3*e]=f.x,p[3*e+1]=f.y,p[3*e+2]=f.z;else if("string"===m)(u=o[f])||(u=s.length,o[f]=u,s.push(f),p[e]=u),p[e]=u;else if("Thang"===m)(u=o[f=f.id])||(u=s.length,o[f]=u,s.push(f),p[e]=u),p[e]=u;else if("array"===m){for(d=[""],l=0,c=f.length;l<c;l++)(r=f[l])&&r.id&&(r=r.id),d.push(r,"");(u=o[f=d.join("")])||(u=s.length,o[f]=u,s.push(f),p[e]=u),p[e]=u}else p[e]=f;return null},l.deserialize=function(e,t,i,n,o,s,r){var a=new l;return a.thang=i,a.frameIndex=t,a.trackedPropertyKeys=n,a.trackedPropertyTypes=o,a.trackedPropertyValues=s,a.specialKeysToValues=r,a},l.transferableBytesNeededForType=function(e,t){var i=function(){switch(e){case"boolean":return 1;case"number":return n;case"Vector":return 3*n;case"string":case"Thang":case"array":return 4;default:return 0}}();return n*Math.ceil(t*i/n)},l.createArrayForType=function(e,t,i,n){var o=this.transferableBytesNeededForType(e,t);return[function(){switch(e){case"boolean":return new Uint8Array(i,n,t);case"number":return new s(i,n,t);case"Vector":return new s(i,n,3*t);case"string":case"Thang":case"array":return new Uint32Array(i,n,t);default:return[]}}(),o]},l),r||(l.createArrayForType=function(e,n,t,i){var o=this.transferableBytesNeededForType(e,n),s="Vector"===e?3:1;return[function(){var e,t,i=[];for(e=0,t=n*s;0<=t?e<t:t<e;0<=t?++e:--e)i.push(0);return i}(),o]})}}]);